ä½ å¥½ï¼Œæˆ‘æ˜¯æœˆå½±ã€‚

å‰é¢ï¼Œæˆ‘ä»¬ç”¨äº†3ä¸ªæ¨¡å—çš„æ—¶é—´ï¼Œå­¦ä¹ äº†å¤§é‡çš„å›¾å½¢å­¦å’Œæ•°å­¦çŸ¥è¯†ï¼Œæ˜¯ä¸æ˜¯è®©ä½ çš„è„‘è¢‹æœ‰ä¸€ç‚¹æ˜æ²‰ï¼Ÿæ²¡å…³ç³»ï¼Œä½ åªæ˜¯éœ€è¦ä¸€ç‚¹æ—¶é—´æ¥æ¶ˆåŒ–è¿™äº›çŸ¥è¯†è€Œå·²ã€‚æˆ‘èƒ½ç»™ä½ çš„å»ºè®®å°±æ˜¯å¤šæ€è€ƒã€å¤šç»ƒä¹ ï¼Œæœ‰äº†æ—¶é—´çš„ç§¯ç´¯ï¼Œä½ ä¸€å®šå¯ä»¥æŒæ¡è¿™äº›åŸºç¡€çŸ¥è¯†å’Œæ€ç»´æ–¹æ³•ã€‚

ä»è¿™ä¸€èŠ‚è¯¾å¼€å§‹ï¼Œæˆ‘ä»¬è¦å­¦ä¹ ä¸€ä¸ªéå¸¸æœ‰æ„æ€çš„æ–°æ¨¡å—ï¼Œé‚£å°±æ˜¯åŠ¨ç”»å’Œ3Dç»˜å›¾ã€‚å¯¹äºå¯è§†åŒ–å±•ç°æ¥è¯´ï¼ŒåŠ¨ç”»å’Œ3Déƒ½æ˜¯ç”¨æ¥å¼ºåŒ–æ•°æ®è¡¨è¾¾ï¼Œå¸å¼•ç”¨æˆ·çš„é‡è¦æŠ€æœ¯æ‰‹æ®µã€‚å®ƒä»¬å¾€å¾€æ¯”äºŒç»´å¹³é¢å›¾å½¢èƒ½å¤Ÿè¡¨è¾¾æ›´å¤æ‚çš„æ•°æ®ï¼Œå®ç°æ›´å¸å¼•äººçš„è§†è§‰æ•ˆæœã€‚

é‚£ä»Šå¤©ï¼Œæˆ‘ä»¬å…ˆæ¥èŠèŠåŠ¨ç”»çš„å®ç°ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬ä¹‹å‰ä¹Ÿå®ç°äº†ä¸å°‘åŠ¨æ€æ•ˆæœï¼Œä½†ä½ å¯èƒ½è¿˜æ˜¯ä¸çŸ¥é“æ€ä¹ˆå»å®ç°åŠ¨ç”»ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥ç³»ç»Ÿåœ°æ¢³ç†ä¸€ä¸‹åŠ¨ç”»å®ç°çš„æ ‡å‡†æ–¹æ³•ã€‚

## åŠ¨ç”»çš„ä¸‰ç§å½¢å¼

ä»€ä¹ˆæ˜¯åŠ¨ç”»å‘¢ï¼Ÿç®€å•æ¥è¯´ï¼ŒåŠ¨ç”»å°±æ˜¯å°†è®¸å¤šå¸§é™æ­¢çš„ç”»é¢ä»¥å›ºå®šçš„é€Ÿç‡è¿ç»­æ’­æ”¾å‡ºæ¥ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒåŠ¨ç”»æœ‰ä¸‰ç§å½¢å¼ï¼Œåˆ†åˆ«æ˜¯å›ºå®šå¸§åŠ¨ç”»ã€å¢é‡åŠ¨ç”»å’Œæ—¶åºåŠ¨ç”»ã€‚

ç¬¬ä¸€ç§å½¢å¼æ˜¯æˆ‘ä»¬é¢„å…ˆå‡†å¤‡å¥½è¦æ’­æ”¾çš„é™æ€å›¾åƒï¼Œç„¶åå°†è¿™äº›å›¾ä¾æ¬¡æ’­æ”¾ï¼Œæ‰€ä»¥å®ƒå«åš**å›ºå®šå¸§åŠ¨ç”»**ã€‚**å¢é‡åŠ¨ç”»**æ˜¯åœ¨åŠ¨æ€ç»˜åˆ¶å›¾åƒçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¿®æ”¹æ¯ä¸€å¸§ä¸­æŸä¸ªæˆ–æŸå‡ ä¸ªå±æ€§çš„å€¼ï¼Œç»™å®ƒä»¬ä¸€å®šçš„å¢é‡ã€‚ç¬¬ä¸‰ç§å½¢å¼æ˜¯åœ¨åŠ¨æ€ç»˜åˆ¶å›¾åƒçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ ¹æ®æ—¶é—´å’ŒåŠ¨ç”»å‡½æ•°è®¡ç®—æ¯ä¸€å¸§ä¸­çš„å…³é”®å±æ€§å€¼ï¼Œç„¶åæ›´æ–°è¿™äº›å±æ€§ï¼Œæ‰€ä»¥å®ƒå«åš**æ—¶åºåŠ¨ç”»**ã€‚

è¿™ä¹ˆè¯´è¿˜æ˜¯æ¯”è¾ƒæŠ½è±¡ï¼Œä¸‹é¢ï¼Œæˆ‘å°±ä»¥HTML/CSSä¸ºä¾‹ï¼Œæ¥å¸¦ä½ ç†Ÿæ‚‰è¿™ä¸‰ç§åŠ¨ç”»çš„åŸºæœ¬å½¢å¼ã€‚ä¸ºä»€ä¹ˆé€‰HTML/CSSå‘¢ï¼Ÿå› ä¸ºä¸€èˆ¬æ¥è¯´ï¼ŒHTML/CSSã€SVGå’ŒCanvas2Då®ç°åŠ¨ç”»çš„æ–¹å¼å¤§åŒå°å¼‚ï¼Œæ‰€ä»¥æˆ‘å°±ç›´æ¥é€‰æ‹©ä½ æœ€ç†Ÿæ‚‰çš„HTML/CSSäº†ã€‚è€ŒWebGLå®ç°åŠ¨ç”»çš„æ–¹å¼å’Œå…¶ä»–ä¸‰ç§å›¾å½¢ç³»ç»Ÿéƒ½æœ‰å·®åˆ«ï¼Œæ‰€ä»¥æˆ‘ä¼šåœ¨ä¸‹ä¸€èŠ‚è¯¾å•ç‹¬æ¥è¯´ã€‚

### 1. å®ç°å›ºå®šå¸§åŠ¨ç”»

é¦–å…ˆï¼Œæˆ‘ä»¬æ¥è¯´è¯´å¦‚ä½•å®ç°å›ºå®šå¸§åŠ¨ç”»ã€‚

ç»“åˆå›ºå®šå¸§åŠ¨ç”»çš„å®šä¹‰ï¼Œæˆ‘ä»¬å®ç°å®ƒçš„ç¬¬ä¸€æ­¥ï¼Œå°±æ˜¯ä¸ºæ¯ä¸€å¸§å‡†å¤‡ä¸€å¼ é™æ€å›¾åƒã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬è¦å®ç°ä¸€ä¸ªå¾ªç¯æ’­æ”¾3å¸§çš„åŠ¨ç”»ï¼Œå°±è¦å‡†å¤‡3ä¸ªå¦‚ä¸‹çš„å›¾åƒã€‚

![](https://static001.geekbang.org/resource/image/80/0e/80532862be3yy41356172c40b547f30e.jpeg?wh=1920%2A269 "3ä¸ªé™æ€å›¾åƒ")

ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬è¦ä¾æ¬¡æ’­æ”¾è¿™äº›å›¾åƒã€‚åœ¨CSSé‡Œå®ç°çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨å›¾ç‰‡ä½œä¸ºèƒŒæ™¯ï¼Œå°±å¯ä»¥è®©å®ƒä»¬é€å¸§åˆ‡æ¢äº†ã€‚ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

```
.bird {
  position: absolute;
  left: 100px;
  top: 100px;
  width:86px;
  height:60px;
  zoom: 0.5;
  background-repeat: no-repeat;
  background-image: url(https://p.ssl.qhimg.com/t01f265b6b6479fffc4.png);
  background-position: -178px -2px;
  animation: flappy .5s step-end infinite;
}

@keyframes flappy {
  0% {background-position: -178px -2px;}
  33% {background-position: -90px -2px;}
  66% {background-position: -2px -2px;}
}

```

![](https://static001.geekbang.org/resource/image/e5/8a/e5cfe9afc454013c3913bfbb03b9548a.gif?wh=491%2A136 "åŠ¨æ€çš„å°é¸Ÿ")

è™½ç„¶å›ºå®šå¸§åŠ¨ç”»å®ç°èµ·æ¥éå¸¸ç®€å•ï¼Œä½†å®ƒä¸é€‚åˆç”Ÿæˆéœ€è¦åŠ¨æ€ç»˜åˆ¶çš„å›¾åƒï¼Œæ›´é€‚åˆåœ¨æ¸¸æˆç­‰åº”ç”¨åœºæ™¯ä¸­ï¼Œç”Ÿæˆç”±ç¾æœ¯æä¾›ç°æˆå›¾ç‰‡çš„åŠ¨ç”»å¸§å›¾åƒã€‚è€Œå¯¹äºåŠ¨æ€ç»˜åˆ¶çš„å›¾åƒï¼Œä¹Ÿå°±æ˜¯éå›ºå®šå¸§åŠ¨ç”»ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨å¦å¤–ä¸¤ç§æ–¹å¼ã€‚

### 2. å®ç°å¢é‡åŠ¨ç”»

æˆ‘ä»¬å…ˆæ¥è¯´æ¯”è¾ƒç®€å•çš„å¢é‡åŠ¨ç”»ï¼Œå³æ¯å¸§ç»™å±æ€§ä¸€ä¸ªå¢é‡ã€‚æ€ä¹ˆç†è§£å‘¢ï¼Ÿæˆ‘ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªè“è‰²çš„æ–¹å—ï¼Œç„¶åç»™è¿™ä¸ªæ–¹å—çš„æ¯ä¸€å¸§å¢åŠ ä¸€ä¸ªrotateè§’åº¦ã€‚è¿™æ ·å°±èƒ½å®ç°è“è‰²æ–¹å—æ—‹è½¬çš„åŠ¨ç”»ã€‚å…·ä½“çš„ä»£ç å’Œæ•ˆæœå¦‚ä¸‹æ‰€ç¤ºã€‚

```
<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    .block {
      width: 100px;
      height: 100px;
      top: 100px;
      left: 100px;
      transform-origin: 50% 50%;
      position: absolute;
      background: blue;
    }
  </style>
</head>
<body>
  <div class="block"></div>
  <script>
  const block = document.querySelector('.block');
  let rotation = 0;
  requestAnimationFrame(function update() {
    block.style.transform = `rotate(${rotation++}deg)`;
    requestAnimationFrame(update);
  });
  </script>
</body>
</html>
```

![](https://static001.geekbang.org/resource/image/fe/41/fe5fd08150d43ff6305042b6ea2ba041.gif?wh=506%2A268 "æ—‹è½¬çš„è“è‰²æ–¹å—")

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨ç¬¬22åˆ°26è¿™5è¡ŒJavaScriptä»£ç å°±è¡Œäº†ï¼Œå…³é”®é€»è¾‘åœ¨äºæˆ‘ä»¬ä¿®æ”¹rotatationå€¼ï¼Œæ¯æ¬¡ç»˜åˆ¶çš„æ—¶å€™å°†å®ƒåŠ 1ã€‚è¿™æ ·æˆ‘ä»¬å°±å®ç°å¢é‡åŠ¨ç”»ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿå¾ˆç®€å•ï¼Ÿ

ç¡®å®ï¼Œå¢é‡åŠ¨ç”»çš„ä¼˜ç‚¹å°±æ˜¯å®ç°ç®€å•ã€‚ä½†å®ƒä¹Ÿæœ‰2ä¸ªç¼ºç‚¹ã€‚é¦–å…ˆï¼Œå› ä¸ºå®ƒä½¿ç”¨å¢é‡æ¥æ§åˆ¶åŠ¨ç”»ï¼Œä»æ•°å­¦è§’åº¦æ¥è¯´ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç›´æ¥ä½¿ç”¨äº†ä¸€é˜¶å¯¼æ•°æ¥å®šä¹‰çš„åŠ¨ç”»ã€‚è¿™æ ·çš„ç»˜å›¾æ–¹å¼ä¸å¤ªå¥½æ§åˆ¶åŠ¨ç”»çš„ç»†èŠ‚ï¼Œæ¯”å¦‚åŠ¨ç”»å‘¨æœŸã€å˜åŒ–ç‡ã€è½¨è¿¹ç­‰ç­‰ï¼Œæ‰€ä»¥è¿™ç§æ–¹æ³•åªèƒ½ç”¨æ¥å®ç°ç®€å•åŠ¨ç”»ã€‚

å…¶æ¬¡ï¼Œå¢é‡åŠ¨ç”»å®šä¹‰çš„æ˜¯çŠ¶æ€å˜åŒ–ã€‚å¦‚æœæˆ‘ä»¬è¦åœ¨shaderä¸­ä½¿ç”¨åŠ¨ç”»ï¼Œå°±åªèƒ½é‡‡ç”¨åæœŸå¤„ç†é€šé“æ¥å®ç°ã€‚ä½†æ˜¯åæœŸå¤„ç†é€šé“è¦è¿›è¡Œå¤šæ¬¡æ¸²æŸ“ï¼Œå®ç°èµ·æ¥æ¯”è¾ƒç¹çï¼Œè€Œä¸”æ€§èƒ½å¼€é”€ä¹Ÿæ¯”è¾ƒå¤§ã€‚æ‰€ä»¥ï¼Œæ›´åŠ å¤æ‚çš„è½¨è¿¹åŠ¨ç”»ï¼Œæˆ‘ä»¬ä¸€èˆ¬é‡‡ç”¨ç¬¬ä¸‰ç§æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡å®šä¹‰æ—¶é—´å’ŒåŠ¨ç”»å‡½æ•°æ¥å®ç°ã€‚

### 3. å®ç°æ—¶åºåŠ¨ç”»

è¿˜æ˜¯ä»¥æ—‹è½¬çš„è“è‰²æ–¹å—ä¸ºä¾‹ï¼Œæˆ‘ä»¬æ”¹å†™ä¸€ä¸‹å®ƒçš„JavaScriptä»£ç ã€‚

```
const block = document.querySelector('.block');
const startAngle = 0;
const T = 2000;
let startTime = null;
function update() {
  startTime = startTime == null ? Date.now() : startTime;
  const p = (Date.now() - startTime) / T;
  const angle = startAngle + p * 360;
  block.style.transform = `rotate(${angle}deg)`;
  requestAnimationFrame(update);
}
update();
```

é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰2ä¸ªå˜é‡ï¼ŒstartAngleheå’ŒTã€‚å…¶ä¸­ï¼ŒstartAngleheæ˜¯èµ·å§‹æ—‹è½¬è§’åº¦ï¼ŒTæ˜¯æ—‹è½¬å‘¨æœŸã€‚åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨updateçš„æ—¶å€™ï¼Œæˆ‘ä»¬è®¾ç½®åˆå§‹æ—‹è½¬çš„æ—¶é—´ä¸ºstartTimeï¼Œé‚£ä¹ˆåœ¨æ¯æ¬¡è°ƒç”¨updateçš„æ—¶å€™ï¼Œå½“å‰ç»è¿‡çš„æ—¶é—´å°±æ˜¯ Date.now() - startTimeã€‚

æ¥ç€ï¼Œæˆ‘ä»¬å°†å®ƒé™¤ä»¥å‘¨æœŸTï¼Œå°±èƒ½å¾—åˆ°æ—‹è½¬è¿›åº¦pï¼Œé‚£ä¹ˆå½“å‰è§’åº¦å°±ç­‰äº startAngle + p * 360ã€‚ç„¶åæˆ‘ä»¬å°†å½“å‰è§’åº¦è®¾ç½®ä¸ºå…ƒç´ çš„rotateå€¼ï¼Œå°±å®ç°äº†åŒæ ·çš„æ—‹è½¬åŠ¨ç”»ã€‚

æ€»çš„æ¥è¯´ï¼Œæ—¶åºåŠ¨ç”»çš„å®ç°å¯ä»¥æ€»ç»“ä¸ºä¸‰æ­¥ï¼šé¦–å…ˆå®šä¹‰åˆå§‹æ—¶é—´å’Œå‘¨æœŸï¼Œç„¶ååœ¨updateä¸­è®¡ç®—å½“å‰ç»è¿‡æ—¶é—´å’Œè¿›åº¦pï¼Œæœ€åé€šè¿‡pæ¥æ›´æ–°åŠ¨ç”»å…ƒç´ çš„å±æ€§ã€‚è™½ç„¶æ—¶åºåŠ¨ç”»å®ç°èµ·æ¥æ¯”å¢é‡åŠ¨ç”»å†™æ³•æ›´å¤æ‚ï¼Œä½†æˆ‘ä»¬å¯ä»¥æ›´ç›´è§‚ã€ç²¾ç¡®åœ°æ§åˆ¶æ—‹è½¬åŠ¨ç”»çš„å‘¨æœŸï¼ˆé€Ÿåº¦ï¼‰ã€èµ·å§‹è§’åº¦ç­‰å‚æ•°ã€‚

ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œè¿™ç§æ–¹å¼åœ¨åŠ¨ç”»å®ç°ä¸­æœ€ä¸ºå¸¸ç”¨ã€‚é‚£ä¸ºäº†æ›´æ–¹ä¾¿ä½¿ç”¨å’Œæ‹“å±•ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ç°æ—¶åºåŠ¨ç”»çš„ä¸‰ä¸ªæ­¥éª¤æŠ½è±¡æˆæ ‡å‡†çš„åŠ¨ç”»æ¨¡å‹ã€‚å…·ä½“æ€ä¹ˆåšå‘¢ï¼Ÿæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ã€‚

## å®šä¹‰æ ‡å‡†åŠ¨ç”»æ¨¡å‹

é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç±» Timingç”¨æ¥å¤„ç†æ—¶é—´ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š

```
export class Timing {
  constructor({duration, iterations = 1} = {}) {
    this.startTime = Date.now();
    this.duration = duration;
    this.iterations = iterations;
  }

  get time() {
    return Date.now() - this.startTime;
  }

  get p() {
    const progress = Math.min(this.time / this.duration, this.iterations);
    return this.isFinished ? 1 : progress % 1;
  }

  get isFinished() {
    return this.time / this.duration >= this.iterations;
  }
}
```

ç„¶åï¼Œæˆ‘ä»¬å®ç°ä¸€ä¸ªAnimatorç±»ï¼Œç”¨æ¥çœŸæ­£æ§åˆ¶åŠ¨ç”»è¿‡ç¨‹ã€‚

```
import {Timing} from './timing.js';

export class Animator {
  constructor({duration, iterations}) {
    this.timing = {duration, iterations};
  }

  animate(target, update) {
    let frameIndex = 0;
    const timing = new Timing(this.timing);

    return new Promise((resolve) => {
      function next() {
        if(update({target, frameIndex, timing}) !== false && !timing.isFinished) {
          requestAnimationFrame(next);
        } else {
          resolve(timing);
        }
        frameIndex++;
      }
      next();
    });
  }
}
```

Animatoræ„é€ å™¨æ¥å—{duration, iterations}ä½œä¸ºå‚æ•°ï¼Œå®ƒæœ‰ä¸€ä¸ªanimateæ–¹æ³•ï¼Œä¼šåœ¨æ‰§è¡Œæ—¶åˆ›å»ºä¸€ä¸ªtimingå¯¹è±¡ï¼Œç„¶åé€šè¿‡æ‰§è¡Œupdate({target, frameIndex, timing})æ›´æ–°åŠ¨ç”»ï¼Œå¹¶ä¸”ä¼šè¿”å›ä¸€ä¸ªpromiseå¯¹è±¡ã€‚è¿™æ ·ï¼Œåœ¨åŠ¨ç”»ç»“æŸæ—¶ï¼Œresolveè¿™ä¸ªpromiseï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿå¾ˆæ–¹ä¾¿åœ°å®ç°è¿ç»­åŠ¨ç”»äº†ã€‚

æ¥ä¸‹æ¥ï¼Œä½ å¯ä»¥æƒ³ä¸€ä¸ªåŠ¨ç”»æ•ˆæœï¼Œæ¥è¯•éªŒä¸€ä¸‹è¿™ä¸ªæ¨¡å‹çš„æ•ˆæœã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨Animatorå®ç°å››ä¸ªæ–¹å—çš„è½®æ¢è½¬åŠ¨ï¼Œè®©æ¯ä¸ªæ–¹å—è½¬åŠ¨çš„å‘¨æœŸæ˜¯1ç§’ï¼Œä¸€å…±æ—‹è½¬1.5ä¸ªå‘¨æœŸï¼ˆå³540åº¦ï¼‰ã€‚ä»£ç å’Œæ•ˆæœå¦‚ä¸‹æ‰€ç¤ºã€‚

```
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    .container {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      width: 300px;
    }
    .block {
      width: 100px;
      height: 100px;
      margin: 20px;
      flex-shrink: 0;
      transform-origin: 50% 50%;
    }
    .block:nth-child(1) {background: red;}
    .block:nth-child(2) {background: blue;}
    .block:nth-child(3) {background: green;}
    .block:nth-child(4) {background: orange;}
  </style>
</head>
<body>
  <div class="container">
    <div class="block"></div>
    <div class="block"></div>
    <div class="block"></div>
    <div class="block"></div>
  </div>
  <script type="module">
    import {Animator} from '../common/lib/animator/index.js';
    const blocks = document.querySelectorAll('.block');
    const animator = new Animator({duration: 1000, iterations: 1.5});
    (async function () {
      let i = 0;
      while(true) { // eslint-disable-next-line no-await-in-loop
        await animator.animate(blocks[i++ % 4], ({target, timing}) => {
          target.style.transform = `rotate(${timing.p * 360}deg)`;
        });
      }
    }());
  </script>
</body>
</html>
```

![](https://static001.geekbang.org/resource/image/d2/81/d28f5b8c8cdf8f20dc20566ab45f7181.gif?wh=593%2A285 "é¡ºåºæ—‹è½¬çš„å››ä¸ªæ–¹å—")

## æ’å€¼ä¸ç¼“åŠ¨å‡½æ•°

æˆ‘ä»¬å‰é¢è¯´è¿‡ï¼Œæ—¶åºåŠ¨ç”»çš„å¥½å¤„å°±åœ¨äºï¼Œå®ƒèƒ½æ›´å®¹æ˜“åœ°æ§åˆ¶åŠ¨ç”»çš„ç»†èŠ‚ã€‚é‚£é’ˆå¯¹æˆ‘ä»¬æ€»ç»“å‡ºçš„è¿™ä¸ªæ ‡å‡†çš„åŠ¨ç”»æ¨¡å‹ï¼Œå®ƒåˆå¦‚ä½•æ§åˆ¶åŠ¨ç”»ç»†èŠ‚å‘¢ï¼Ÿ

å‡è®¾ï¼Œæˆ‘ä»¬å·²çŸ¥å…ƒç´ çš„èµ·å§‹çŠ¶æ€ã€ç»“æŸçŠ¶æ€å’Œè¿åŠ¨å‘¨æœŸã€‚å¦‚æœæƒ³è¦è®©å®ƒè¿›è¡Œä¸è§„åˆ™è¿åŠ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ’å€¼çš„æ–¹å¼æ¥æ§åˆ¶æ¯ä¸€å¸§çš„å±•ç°ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå®ç°ä¸€ä¸ªåŒ€é€Ÿè¿åŠ¨çš„æ–¹å—ï¼Œå†é€šè¿‡æ’å€¼ä¸ç¼“åŠ¨å‡½æ•°æ¥å®ç°å˜é€Ÿè¿åŠ¨ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬ç”¨Animatorå®ç°ä¸€ä¸ªæ–¹å—ï¼Œè®©å®ƒä»100pxå¤„**åŒ€é€Ÿè¿åŠ¨**åˆ°400pxå¤„ã€‚æ³¨æ„ï¼Œåœ¨ä»£ç å®ç°çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªçº¿æ€§æ’å€¼æ–¹æ³•ï¼šleft = start * (1 - p) + end * pã€‚çº¿æ€§æ’å€¼å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®ç°å±æ€§çš„å‡åŒ€å˜åŒ–ï¼Œæ‰€ä»¥ç”¨å®ƒæ¥è®©æ–¹å—åšåŒ€é€Ÿè¿åŠ¨æ˜¯éå¸¸ç®€å•çš„ã€‚ä½†å¦‚æœæ˜¯è®©æ–¹å—éåŒ€é€Ÿè¿åŠ¨ï¼Œæ¯”å¦‚åŒ€åŠ é€Ÿè¿åŠ¨ï¼Œæˆ‘ä»¬è¦æ€ä¹ˆåŠå‘¢ï¼Ÿ

```
import {Animator} from '../common/lib/animator/index.js';
const block = document.querySelector('.block');
const animator = new Animator({duration: 3000});
document.addEventListener('click', () => {
  animator.animate({el: block, start: 100, end: 400}, ({target: {el, start, end}, timing: {p}}) => {
    const left = start * (1 - p) + end * p;
    el.style.left = `${left}px`;
  });
});
```

å®ç°æŠ€å·§ä¹Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨çº¿æ€§æ’å€¼ï¼Œåªä¸è¿‡è¦å¯¹æ’å€¼å‚æ•°påšä¸€ä¸ªå‡½æ•°æ˜ å°„ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœè¦è®©æ–¹å—åšåˆé€Ÿåº¦ä¸º0çš„åŒ€åŠ é€Ÿè¿åŠ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†pæ˜ å°„ä¸ºp^2ã€‚

```
p = p ** 2;
const left = start * (1 - p) + end * p;
```

å†æ¯”å¦‚è¯´ï¼Œå¦‚æœè¦è®©å®ƒåšæœ«é€Ÿåº¦ä¸º0çš„åŒ€å‡é€Ÿè¿åŠ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†pæ˜ å°„ä¸ºp * (2 - p)ã€‚

```
p = p * (2 - p);
const left = start * (1 - p) + end * p;
```

é‚£ä¸ºä»€ä¹ˆåŒ€åŠ é€Ÿã€åŒ€å‡é€Ÿçš„æ—¶å€™ï¼Œpè¦è¿™æ ·æ˜ å°„å‘¢ï¼Ÿè¦ç†è§£è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°±å¾—å…ˆæ¥å›å¿†ä¸€ä¸‹ï¼ŒåŒ€åŠ é€Ÿå’ŒåŒ€å‡é€Ÿè¿åŠ¨çš„ç‰©ç†è®¡ç®—å…¬å¼ã€‚

å‡è®¾ï¼ŒæŸä¸ªç‰©ä½“åœ¨åšåˆé€Ÿåº¦ä¸º0çš„åŒ€åŠ é€Ÿè¿åŠ¨ï¼Œè¿åŠ¨çš„æ€»æ—¶é—´ä¸ºTï¼Œæ€»ä½ç§»ä¸ºSã€‚é‚£ä¹ˆï¼Œå®ƒåœ¨tæ—¶åˆ»çš„ä½ç§»å’ŒåŠ é€Ÿåº¦çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š

![](https://static001.geekbang.org/resource/image/fb/f3/fb1502fd6d2bca1db9921a5847409cf3.jpeg?wh=1920%2A784 "åŒ€åŠ é€Ÿè¿åŠ¨çš„è®¡ç®—å…¬å¼")

æ‰€ä»¥æˆ‘ä»¬æŠŠpæ˜ å°„ä¸ºpçš„å¹³æ–¹ã€‚

è¿˜æ˜¯åŒæ ·çš„æƒ…å†µä¸‹ï¼Œå¦‚æœç‰©ä½“åœ¨åšåŒ€å‡é€Ÿè¿åŠ¨ï¼Œé‚£ä¹ˆï¼Œå®ƒåœ¨tæ—¶åˆ»çš„ä½ç§»å’ŒåŠ é€Ÿåº¦çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š

![](https://static001.geekbang.org/resource/image/5f/d2/5f9726b346e444775080ac98b8e93dd2.jpeg?wh=1920%2A749 "åŒ€å˜é€Ÿè¿åŠ¨çš„è®¡ç®—å…¬å¼")

æ‰€ä»¥æˆ‘ä»¬æŠŠpæ˜ å°„ä¸ºp(2-p)ã€‚

é™¤æ­¤ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°†pæ˜ å°„ä¸ºä¸‰æ¬¡æ›²çº¿ p * p * (3.0 - 2.0 * p) ï¼Œæ¥å®ç°smoothstepçš„æ’å€¼æ•ˆæœç­‰ç­‰ã€‚é‚£ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ä»¥åŠå®ç°æ›´å¤šçš„æ•ˆæœï¼Œæˆ‘ä»¬å¯ä»¥æŠ½è±¡å‡ºä¸€ä¸ªæ˜ å°„å‡½æ•°ä¸“é—¨å¤„ç†pçš„æ˜ å°„ï¼Œè¿™ä¸ªå‡½æ•°å«åš**ç¼“åŠ¨å‡½æ•°**ï¼ˆEasing Functionï¼‰ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨å‰é¢å®ç°è¿‡çš„Timingç±»ä¸­ï¼Œç›´æ¥å¢åŠ ä¸€ä¸ªç¼“åŠ¨å‡½æ•°easingã€‚è¿™æ ·åœ¨è·å–på€¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨ this.easing(progress) å–ä»£ä¹‹å‰çš„ progressï¼Œå°±å¯ä»¥è®©åŠ¨ç”»å˜é€Ÿè¿åŠ¨äº†ã€‚ä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹ï¼š

```
export class Timing {
  constructor({duration, iterations = 1, easing = p => p} = {}) {
    this.startTime = Date.now();
    this.duration = duration;
    this.iterations = iterations;
    this.easing = easing;
  }

  get time() {
    return Date.now() - this.startTime;
  }

  get p() {
    const progress = Math.min(this.time / this.duration, this.iterations);
    return this.isFinished ? 1 : this.easing(progress % 1);
  }

  get isFinished() {
    return this.time / this.duration >= this.iterations;
  }
}
```

é‚£å¸¦å…¥åˆ°å…·ä½“çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªè¦å¤šç»™animatorä¼ ä¸€ä¸ªeasingå‚æ•°ï¼Œå°±å¯ä»¥è®©ä¸€å¼€å§‹åŒ€é€Ÿè¿åŠ¨çš„å°æ–¹å—å˜æˆåŒ€åŠ é€Ÿè¿åŠ¨äº†ã€‚ä¸‹é¢å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªç¼“åŠ¨å‡½æ•°çš„å…·ä½“ä»£ç ï¼š

```
import {Animator} from '../common/lib/animator/index.js';
const block = document.querySelector('.block');
const animator = new Animator({duration: 3000, easing: p => p ** 2});
document.addEventListener('click', () => {
  animator.animate({el: block, start: 100, end: 400}, ({target: {el, start, end}, timing: {p}}) => {
    const left = start * (1 - p) + end * p;
    el.style.left = `${left}px`;
  });
});
```

## è´å¡å°”æ›²çº¿ç¼“åŠ¨

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»ç¼“åŠ¨å‡½æ•°çš„åº”ç”¨äº†ã€‚ç¼“åŠ¨å‡½æ•°æœ‰å¾ˆå¤šç§ï¼Œå…¶ä¸­æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯è´å¡å°”æ›²çº¿ç¼“åŠ¨ï¼ˆBezier-easingï¼‰ï¼Œå‡†ç¡®åœ°è¯´ï¼Œæ˜¯ä¸‰æ¬¡è´å¡å°”æ›²çº¿ç¼“åŠ¨å‡½æ•°ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥ä¸€èµ·æ¥å®ç°ä¸€ä¸ªç®€å•çš„è´å¡å°”æ›²çº¿ç¼“åŠ¨ã€‚

æˆ‘ä»¬å…ˆæ¥å¤ä¹ ä¸€ä¸‹ä¸‰æ¬¡è´å¡å°”æ›²çº¿çš„å‚æ•°æ–¹ç¨‹ï¼š

![](https://static001.geekbang.org/resource/image/50/6e/50dea3d53d0d81a49b6a3cb982629e6e.jpg?wh=1920%2A149)

å¯¹äºè´å¡å°”æ›²çº¿å›¾å½¢æ¥è¯´ï¼Œtæ˜¯å‚æ•°ï¼ŒPæ˜¯åæ ‡ã€‚è€Œè´å¡å°”æ›²çº¿ç¼“åŠ¨å‡½æ•°ï¼Œåˆ™æ˜¯æŠŠPxä½œä¸ºæ—¶é—´å‚æ•°pï¼ŒæŠŠPyä½œä¸ºpçš„æ˜ å°„ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±çŸ¥é“äº†å‚æ•°æ–¹ç¨‹å’Œç¼“åŠ¨å‡½æ•°ä¹‹é—´æ˜ å°„å…³ç³»äº†ã€‚

[![](https://static001.geekbang.org/resource/image/f7/0b/f764285ab9554604937917e38f7c440b.jpg?wh=1920%2A1080 "è´å¡å°”ç¼“åŠ¨å‡½æ•°ï¼Œå›¾ç›˜æ¥æºï¼šReact.js")](https://react.rocks/example/bezier-easing-editor)

é‚£è¦æƒ³æŠŠä¸‰æ¬¡è´å¡å°”æ›²çº¿å‚æ•°æ–¹ç¨‹å˜æ¢æˆè´å¡å°”æ›²çº¿ç¼“åŠ¨å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ç§æ•°å­¦æ–¹æ³•ï¼Œå«åš[**ç‰›é¡¿è¿­ä»£æ³•**](https://baike.baidu.com/item/%E7%89%9B%E9%A1%BF%E8%BF%AD%E4%BB%A3%E6%B3%95/10887580?fr=aladdin)ï¼ˆNewtonâ€™s methodï¼‰ã€‚å› ä¸ºè¿™ä¸ªæ–¹æ³•æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥æˆ‘å°±ä¸å±•å¼€ç»†è¯´äº†ã€‚

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç°æˆçš„JavaScriptåº“[bezier-easing](https://github.com/gre/bezier-easing)æ¥ç”Ÿæˆè´å¡å°”ç¼“åŠ¨å‡½æ•°ï¼Œä¾‹å¦‚ï¼š

```
import {Animator} from '../common/lib/animator/index.js';
const block = document.querySelector('.block');
const animator = new Animator({duration: 3000, easing: BezierEasing(0.5, -1.5, 0.5, 2.5)});
document.addEventListener('click', () => {
  animator.animate({el: block, start: 100, end: 400}, ({target: {el, start, end}, timing: {p}}) => {
    const left = start * (1 - p) + end * p;
    el.style.left = `${left}px`;
  });
});
```

è¿™æ ·ï¼Œæˆ‘ä»¬èƒ½å¾—åˆ°å¦‚ä¸‹çš„æ•ˆæœï¼š

![](https://static001.geekbang.org/resource/image/a8/18/a81289f987f354f7bdd1e983c9472418.gif?wh=670%2A296)

å®é™…ä¸Šï¼ŒCSS3åŠ¨ç”»åŸç”Ÿæ”¯æŒbezier-easingã€‚æ‰€ä»¥ä¸Šé¢çš„æ•ˆæœï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨CSS3åŠ¨ç”»æ¥å®ç°ã€‚

```
.container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  width: 300px;
}
.block {
  width: 100px;
  height: 100px;
  position: absolute;
  top: 100px;
  left: 100px;
  background: blue;
  flex-shrink: 0;
  transform-origin: 50% 50%;
}
.animate {
  animation: mymove 3s cubic-bezier(0.5, -1.5, 0.5, 2.5) forwards;
}
@keyframes mymove {
  from {left: 100px}
  to {left: 400px}
}
```

å…¶å®è´å¡å°”ç¼“åŠ¨å‡½æ•°è¿˜æœ‰å¾ˆå¤šç§ï¼Œä½ å¯ä»¥å»[easing.net](https://easings.net/)è¿™ä¸ªç½‘ç«™é‡Œçœ‹ä¸€çœ‹ï¼Œç„¶åå°è¯•åˆ©ç”¨é‡Œé¢æä¾›çš„ç¼“åŠ¨å‡½æ•°ï¼Œæ¥ä¿®æ”¹æˆ‘ä»¬ä¾‹å­ä»£ç ä¸­çš„æ•ˆæœï¼Œçœ‹çœ‹åŠ¨ç”»è¿‡ç¨‹æœ‰ä»€ä¹ˆä¸åŒã€‚

## è¦ç‚¹æ€»ç»“

è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬è®²äº†åŠ¨ç”»çš„ä¸‰ç§å½¢å¼å’Œå®ç°å®ƒä»¬çš„åŸºæœ¬æ–¹æ³•ï¼Œå¹¶ä¸”æˆ‘ä»¬é‡ç‚¹è®¨è®ºäº†ç”±æ—¶åºåŠ¨ç”»è¡ç”Ÿçš„æ ‡å‡†åŠ¨ç”»æ¨¡å‹ï¼Œä»¥åŠåœ¨æ­¤åŸºç¡€ä¸Šï¼Œåˆ©ç”¨çº¿æ€§æ’å€¼å’Œç¼“åŠ¨å‡½æ•°æ¥æ§åˆ¶æ›´å¤šåŠ¨ç”»ç»†èŠ‚ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹è¿™ä¸‰ç§å½¢å¼çš„å®ç°æ–¹æ³•å’Œå„è‡ªçš„ç‰¹ç‚¹ï¼š

- ç¬¬ä¸€ç§ï¼Œå›ºå®šå¸§åŠ¨ç”»ã€‚å®ƒå®ç°èµ·æ¥æœ€ç®€å•ï¼Œåªéœ€è¦æˆ‘ä»¬ä¸ºæ¯ä¸€å¸§å‡†å¤‡ä¸€å¼ å›¾ç‰‡ï¼Œç„¶åå¾ªç¯æ’­æ”¾å°±å¯ä»¥äº†ã€‚
- ç¬¬äºŒç§ï¼Œå¢é‡åŠ¨ç”»ã€‚è™½ç„¶åœ¨å®ç°çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ¯å¸§ç»™å…ƒç´ çš„ç›¸å…³å±æ€§å¢åŠ ä¸€å®šçš„é‡ï¼Œä½†ä¹Ÿå¾ˆå¥½æ“ä½œï¼Œå°±æ˜¯ä¸å¥½ç²¾ç¡®æ§åˆ¶åŠ¨ç”»ç»†èŠ‚ã€‚
- ç¬¬ä¸‰ç§æ˜¯ä½¿ç”¨æ—¶é—´å’ŒåŠ¨ç”»å‡½æ•°æ¥æè¿°çš„åŠ¨ç”»ï¼Œä¹Ÿå«åšæ—¶åºåŠ¨ç”»ã€‚è¿™ç§æ–¹æ³•èƒ½å¤Ÿéå¸¸ç²¾ç¡®åœ°æ§åˆ¶åŠ¨ç”»çš„ç»†èŠ‚ï¼Œæ‰€ä»¥å®ƒèƒ½å®ç°çš„åŠ¨ç”»æ•ˆæœæ›´ä¸°å¯Œï¼Œåº”ç”¨æœ€å¹¿æ³›ã€‚

ç„¶åï¼Œä¸ºäº†æ›´æ–¹ä¾¿ä½¿ç”¨ï¼Œæˆ‘ä»¬æ ¹æ®æ—¶åºåŠ¨ç”»å®šä¹‰äº†æ ‡å‡†åŠ¨ç”»æ¨¡å‹ï¼Œå®ç°äº†Animatorç±»ã€‚åŸºäºæ­¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨çº¿æ€§æ’å€¼æ¥å®ç°åŠ¨ç”»çš„åŒ€é€Ÿè¿åŠ¨ï¼Œé€šè¿‡ç¼“åŠ¨å‡½æ•°æ¥æ”¹å˜åŠ¨ç”»çš„è¿åŠ¨é€Ÿåº¦ã€‚

åœ¨åŠ¨ç”»çš„å®ç°ä¸­ï¼Œæ¯”è¾ƒå¸¸ç”¨è´å¡å°”æ›²çº¿ç¼“åŠ¨å‡½æ•°ã€‚å®ƒæ˜¯é€šè¿‡å¯¹è´å¡å°”æ›²çº¿æ–¹ç¨‹è¿›è¡Œç‰›é¡¿è¿­ä»£æ±‚å‡ºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨bezier-easingåº“æ¥åˆ›å»ºè´å¡å°”ç¼“åŠ¨å‡½æ•°ã€‚CSS3åŠ¨ç”»åŸç”Ÿæ”¯æŒbezier-easingï¼Œæ‰€ä»¥å¦‚æœä½¿ç”¨HTML/CSSæ–¹å¼ç»˜åˆ¶å…ƒç´ ï¼Œæˆ‘ä»¬å¯ä»¥å°½é‡ä½¿ç”¨CSS3åŠ¨ç”»ã€‚

## å°è¯•ç‰›åˆ€

æœ€åï¼Œæˆ‘å¸Œæœ›ä½ èƒ½åˆ©ç”¨æˆ‘ä»¬ä»Šå¤©å­¦åˆ°çš„æ—¶åºåŠ¨ç”»ï¼Œæ¥å®ç°ä¸€ä¸ªç®€å•çš„åŠ¨ç”»æ•ˆæœã€‚å°±æ˜¯æˆ‘ä»¬å‡è®¾ï¼Œæœ‰ä¸€ä¸ªåŠå¾„ä¸º10pxçš„å¼¹æ€§å°çƒï¼Œæˆ‘ä»¬è®©å®ƒä»¥è‡ªç”±è½ä½“çš„æ–¹å¼ä¸‹è½200pxé«˜åº¦ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå°çƒæ¯æ¬¡è½åœ°åå¼¹èµ·çš„é«˜åº¦ä¼šæ˜¯ä¹‹å‰çš„ä¸€åŠï¼Œç„¶åå®ƒä¼šä¸æ–­é‡å¤è‡ªç”±ä¸‹è½çš„è¿‡ç¨‹ï¼Œç›´åˆ°é™æ­¢åœ¨åœ°é¢ä¸Šã€‚

ä½ èƒ½è¯•ç€ç”¨æ ‡å‡†åŠ¨ç”»æ¨¡å‹å°è£…å¥½çš„Animatoræ¨¡å—ï¼Œæ¥å®ç°è¿™ä¸ªæ•ˆæœå—ï¼ŸAnimatoræ¨¡å—çš„ä»£ç ä½ å¯ä»¥åœ¨Githubä»“åº“ä¸­æ‰¾åˆ°ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æŒ‰ç…§æˆ‘ä»¬å‰é¢è®²è§£å†…å®¹è‡ªå·±å®ç°ä¸€ä¸‹ã€‚

* * *

## æºç 

æœ¬èŠ‚è¯¾çš„å®Œæ•´ç¤ºä¾‹ä»£ç è§[GitHubä»“åº“](https://github.com/akira-cn/graphics/tree/master/animate)

## æ¨èé˜…è¯»

\[1] [ç‰›é¡¿è¿­ä»£æ³•](https://zh.wikipedia.org/wiki/%E7%89%9B%E9%A1%BF%E6%B3%95)  
\[2] [Bezier-easing](https://github.com/gre/bezier-easing)  
\[3] [Easing.net](https://easings.net/)
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ7ï¼‰</strong></div><ul>
<li><span>ç½— ä¹¾ æ—</span> ğŸ‘ï¼ˆ5ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>æœ€ç›´æ¥çš„æƒ³æ³•

async function run_animator() {
      let _duration = 400
      const start_pos = 100
      const end_pos = 300
      let h = end_pos - start_pos

      const animator = new Animator({ duration: _duration, easing: p =&gt; p ** 2 });
      await animator.animate({ el: block, start: start_pos, end: end_pos }, ({ target: { el, start, end }, timing: { p, isFinished } }) =&gt; {
        const top = start * (1 - p) + end * p;
        el.style.top = `${top}px`;
      });

      
      while (h &gt; 2) {
        h &#47;= 2
        const top = end_pos - h
        _duration &#47;= Math.sqrt(2)
        &#47;&#47; console.log(`${h} ${_duration}`)
        const animator_up = new Animator({ duration: _duration, easing: p =&gt; p * (2 - p) });
        const animator_down = new Animator({ duration: _duration, easing: p =&gt; p ** 2 });

        await animator_up.animate({ el: block, start: end_pos, end: top }, ({ target: { el, start, end }, timing: { p, isFinished } }) =&gt; {
          const top = start * (1 - p) + end * p;
          el.style.top = `${top}px`;
        });

        await animator_down.animate({ el: block, start: top, end: end_pos }, ({ target: { el, start, end }, timing: { p, isFinished } }) =&gt; {
          const top = start * (1 - p) + end * p;
          el.style.top = `${top}px`;
        });
      }
    }</p>2020-08-04</li><br/><li><span>ä»¥æ¢¦ä¸ºé©¬</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆä½ å¥½ï¼Œtransformä¸­Matrixæ˜¯ä¸æ˜¯é™¤äº†è£…Bå¤–å°±æ²¡ä»€ä¹ˆç”¨å‘€.... ä¸€ç›´æ²¡å‘ç°å®ƒçš„ç”¨æ­¦ä¹‹åœ°</p>2020-08-22</li><br/><li><span>é‡å­è”·è–‡</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>&#47;&#47; å°è¯•ç‰›åˆ€ï¼Œè¿™é‡Œç»™å‡ºå…³é”®ä»£ç ï¼Œå‡½æ•° fallï¼š
async function fall(h, duration, k = 0.5) {
    await new Animator({ duration, easing: p =&gt; p ** 2 }).animate(circle, ({ target, timing }) =&gt; {
        target.y = h * (1 - timing.p);
    });
    const nextH = h * k;
    const nextDuration = (duration ** 2 * k) ** 0.5;
    if (nextDuration &gt; 16) {
        await new Animator({ duration: nextDuration, easing: p =&gt; p * (2 - p) }).animate(circle, ({ target, timing }) =&gt; {
            target.y = nextH * timing.p;
        });
        fall(nextH, nextDuration, k);
    }
}
&#47;&#47; h ä¸ºä¸‹è½é«˜åº¦ï¼Œduration ä¸ºæŒç»­æ—¶é—´ï¼Œk æ˜¯è¡°å‡ç³»æ•°ï¼Œé»˜è®¤æ¯æ¬¡å¼¹èµ·åé«˜åº¦å‡åŠ
&#47;&#47; åˆ©ç”¨äº†é€’å½’çš„æ€æƒ³ï¼Œå½“ nextDuration å°äº16ï¼ˆ60fps çš„å¸§é—´éš”æ˜¯16.666â€¦ï¼‰æ—¶åœæ­¢å¼¹èµ·
</p>2022-10-29</li><br/><li><span>KaygNas</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>è¯·é—®æœˆå½±å¤§å¤§ï¼Œå°†çº¿æ€§çš„ f(p) = p æ˜ å°„æˆä»»æ„çš„å‡½æ•°æœ‰æ›´é€šç”¨çš„æ±‚è§£æ–¹å¼å—ï¼Ÿ</p>2023-06-05</li><br/><li><span>æˆ‘å«å¼ å°å’©Â²â°Â¹â¹</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>import {Animator} from &#39;..&#47;common&#47;lib&#47;animator&#47;index.js&#39;;
    const ball = document.querySelector(&#39;.ball&#39;);
    (async function () {
      let start = 0;
      let end = 200;
      let _duration = 1000
      while(start &lt; 200) { &#47;&#47; eslint-disable-next-line no-await-in-loop
        const animeFall = new Animator({duration: _duration, easing: p =&gt; p ** 2 });
        await animeFall.animate(ball, ({target, timing: { p }}) =&gt; {
          const top = start * (1 - p) + end * p;
          target.style.top = `${top}px`;
        });

        start = Math.ceil((end - start) &#47; 2 + start)
        _duration &#47;= Math.sqrt(2)

        const animeBound = new Animator({duration: _duration, easing: p =&gt; p * (2 - p) });
        await animeBound.animate({ el: ball, start: end, end: start }, ({target: { el, start, end }, timing: { p }}) =&gt; {
          const top = start * (1 - p) + end * p;
          el.style.top = `${top}px`;
        });
        
        console.log(start, end)
      }
    }());</p>2023-05-19</li><br/><li><span>Geek_q04ku5</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>const ball = document.querySelector(&#39;.ball&#39;)
const downAnimator = new Animator({ duration: 700, iterations: 1, easing: p =&gt; p ** 2 })
const upAnimator = new Animator({ duration: 700, iterations: 1, easing: p =&gt; p * (2 - p) })

setTimeout(async () =&gt; {
    let start = 0;
    let end = 200;
    let T = 200;

    while (Math.round(start) !== end) {
        await downAnimator.animate({ el: ball, start, end }, (({ target: { el, start, end }, timing }) =&gt; {
            const { p } = timing
            const top = start * (1 - p) + end * p
            el.style.top = `${top}px`
        }))

        start += T &#47;= 2;

        await upAnimator.animate({ el: ball, start: end, end: start }, (({ target: { el, start, end }, timing }) =&gt; {
            const { p } = timing
            const top = start * (1 - p) + end * p
            el.style.top = `${top}px`
        }))
    }
}, 1000);</p>2022-02-07</li><br/><li><span>MG.Fre</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>        &#47;&#47; p = p ** 2; &#47;&#47; åŒ€åŠ é€Ÿè¿åŠ¨
        &#47;&#47; p = p * (2 - p); &#47;&#47; åŒ€å‡é€Ÿè¿åŠ¨
        let start = 0, end = 200, duration = 800;
        let distance = end - start;
        const animator = new Animator({ duration, easing: p =&gt; p ** 2 });

        document.addEventListener(&#39;click&#39;, async () =&gt; {
            while(Math.abs(distance) &gt;= 0.1){
                &#47;&#47; æ ¹æ®æ–¹å‘æ›´æ–°åŠ¨ç”»å‡½æ•°
                if(distance &gt; 0)
                    &#47;&#47; å‘ä¸‹è¿åŠ¨ï¼ŒåŒ€åŠ é€Ÿ
                    animator.updateTiming({easing: p =&gt; p ** 2});
                else
                    &#47;&#47; å‘ä¸Šè¿åŠ¨ï¼ŒåŒ€å‡é€Ÿ
                    animator.updateTiming({easing: p =&gt; p * (2 - p)});

                &#47;&#47; æ›´æ–°åŠ¨ç”»çš„å‘¨æœŸæ—¶é—´ï¼ˆä¿æŒåŠ é€Ÿåº¦æ’å®šï¼‰ 
                animator.updateTiming({duration: duration *= 0.7});

                await animator.animate({el: block, start, end}, ({target: {el, start, end}, timing: {p}}) =&gt; {
                    const top = start * (1 - p) + end * p;
                    el.style.top = `${top}px`;
                });

                &#47;&#47; é€šè¿‡distanceè®°å½•è¿åŠ¨æ–¹å‘
                distance = - distance &#47; 2;
                &#47;&#47; æ›´æ–°å¼€å§‹ä¸ç»“æŸçš„ä½ç½®å˜åŒ–
                if(distance &lt; 0){
                    [start, end] = [end, end + distance];
                }else{
                    [start, end] = [end, start];
                }
            }
        });</p>2021-08-10</li><br/>
</ul>