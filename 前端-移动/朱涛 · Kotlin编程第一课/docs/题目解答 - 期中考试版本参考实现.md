ä½ å¥½ï¼Œæˆ‘æ˜¯æœ±æ¶›ã€‚ä¸ŠèŠ‚è¯¾æˆ‘ç»™ä½ å¸ƒç½®äº†ä¸€ä»½è€ƒè¯•é¢˜ï¼Œä½ å®Œæˆå¾—æ€ä¹ˆæ ·äº†å‘¢ï¼Ÿè¿™èŠ‚è¯¾å‘¢ï¼Œæˆ‘ä¼šæ¥å‘Šè¯‰ä½ æˆ‘æ˜¯å¦‚ä½•ç”¨Kotlinæ¥åšè¿™ä¸ªå›¾ç‰‡å¤„ç†ç¨‹åºçš„ï¼Œä¾›ä½ å‚è€ƒã€‚

ç”±äºä¸ŠèŠ‚è¯¾æˆ‘ä»¬å·²ç»åšå¥½äº†å‰æœŸå‡†å¤‡ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ç›´æ¥å†™ä»£ç å°±è¡Œäº†ã€‚

## 1.0ç‰ˆæœ¬

å¯¹äºå›¾ç‰‡åè½¬å’Œè£åˆ‡çš„è¿™ä¸ªé—®é¢˜ï¼Œå¦‚æœä¸€å¼€å§‹ä½ å°±å»æƒ³è±¡ä¸€ä¸ªå¤§å›¾ç‰‡ï¼Œé‡Œé¢æœ‰å‡ ä¸‡ä¸ªåƒç´ ç‚¹ï¼Œé‚£ä½ å¯èƒ½ä¼šè¢«å“åˆ°ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ å°†æ•°æ®è§„æ¨¡ç¼©å°ï¼Œå†æ¥åˆ†æçš„è¯ï¼Œä½ ä¼šå‘ç°è¿™ä¸ªé—®é¢˜å…¶å®å¾ˆç®€å•ã€‚

è¿™é‡Œï¼Œæˆ‘ä»¬å°±ä»¥ä¸€å¼ 4X4åƒç´ çš„ç…§ç‰‡ä¸ºä¾‹æ¥åˆ†æä¸€ä¸‹ã€‚

![](https://static001.geekbang.org/resource/image/2f/20/2f31e490e0b973c9511e4aaa921f0520.jpg?wh=1498x646)

è¿™å…¶å®å°±ç›¸å½“äºä¸€ä¸ªæŠ½è±¡çš„æ¨¡å‹ï¼Œå¦‚æœæˆ‘ä»¬åŸºäºè¿™å¼ 4X4çš„ç…§ç‰‡ï¼Œç»§ç»­åˆ†æç¿»è½¬å’Œè£åˆ‡ï¼Œå°±ä¼šå®¹æ˜“å¾ˆå¤šã€‚æˆ‘ä»¬å¯ä»¥æ¥ç”»ä¸€ä¸ªç®€å•çš„å›¾å½¢ï¼š

![](https://static001.geekbang.org/resource/image/b6/8d/b6a1a1f3b70b9b1a8132c51a92660d8d.jpg?wh=2000x814)

ä¸Šé¢è¿™å¼ å›¾ï¼Œä»å·¦åˆ°å³åˆ†åˆ«æ˜¯åŸå›¾ã€æ¨ªå‘ç¿»è½¬ã€çºµå‘ç¿»è½¬ã€è£åˆ‡ã€‚å…¶ä¸­ï¼Œç¿»è½¬çœ‹èµ·æ¥æ˜¯è¦å¤æ‚ä¸€äº›ï¼Œè€Œè£åˆ‡æ˜¯æœ€ç®€å•çš„ã€‚

![](https://static001.geekbang.org/resource/image/64/c3/64001cb039dbcff66c4e9eec48dcf6c3.jpg?wh=2000x789)

æˆ‘ä»¬å…ˆæ¥å¤„ç†è£åˆ‡ã€‚å¯¹äºè£åˆ‡ï¼Œå…¶å®åªéœ€è¦å°†å›¾ç‰‡å½“ä¸­æŸä¸ªéƒ¨åˆ†çš„åƒç´ æ‹·è´åˆ°å†…å­˜ï¼Œç„¶åå­˜å‚¨æˆä¸ºä¸€å¼ æ–°å›¾ç‰‡å°±è¡Œäº†ã€‚

```plain
/**
 * å›¾ç‰‡è£åˆ‡
 */
fun Image.crop(startY: Int, startX: Int, width: Int, height: Int): Image {
    val pixels = Array(height) { y ->
        Array(width) { x ->
            getPixel(startY + y, startX + x)
        }
    }
    return Image(pixels)
}
```

ä»¥ä¸Šä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°æ•°ç»„pixelsï¼Œå®ƒçš„åˆ›å»ºæ–¹å¼æ˜¯é€šè¿‡Lambdaæ¥å®ç°çš„ï¼Œè€ŒLambdaå½“ä¸­æœ€å…³é”®çš„é€»è¾‘ï¼Œå°±æ˜¯ `getPixel(startY + y, startX + x)`ï¼Œä¹Ÿå°±æ˜¯ä»åŸå›¾å½“ä¸­å–åƒç´ ç‚¹ã€‚

è¿™ä»£ç æ˜¯ä¸æ˜¯æ¯”ä½ æƒ³è±¡ä¸­ç®€å•å¾ˆå¤šï¼Ÿå…¶å®ï¼Œå›¾ç‰‡çš„ç¿»è½¬ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚åªè¦æˆ‘ä»¬èƒ½**æ‰¾å‡ºåæ ‡çš„å¯¹åº”å…³ç³»**ï¼Œä»£ç ä¹Ÿéå¸¸ç®€å•ã€‚

![](https://static001.geekbang.org/resource/image/7a/c8/7aeeb78bb0a4a6f8cb4a3308e2842fc8.jpg?wh=1633x880)

å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºåŸå›¾çš„(1, 0)è¿™ä¸ªåƒç´ ç‚¹æ¥è¯´ï¼Œå®ƒæ¨ªå‘ç¿»è½¬ä»¥åå°±å˜æˆäº†(2, 0)ã€‚æ‰€ä»¥ï¼Œå¯¹äº(x, y)åæ ‡æ¥è¯´ï¼Œæ¨ªå‘ç¿»è½¬ä»¥åï¼Œå°±åº”è¯¥å˜æˆ(width-1-x, y)ã€‚æ‰¾åˆ°è¿™ä¸ªå¯¹åº”å…³ç³»ä»¥åï¼Œæˆ‘ä»¬å°±ç›´æ¥æŠ„ä»£ç äº†ï¼

```plain
/**
 * æ¨ªå‘ç¿»è½¬å›¾ç‰‡
 */
fun Image.flipHorizontal(): Image {
    val pixels = Array(height()) { y ->
        Array(width()) { x ->
            getPixel(y, width() - 1 - x)
        }
    }
    return Image(pixels)
}
```

å¯è§ï¼Œä»¥ä¸Šè¿™æ®µä»£ç å‡ ä¹è·Ÿè£åˆ‡æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œåªæ˜¯è¯´ï¼Œè£åˆ‡è¦é™åˆ¶å®½é«˜ï¼Œè€Œç¿»è½¬åˆ™æ˜¯è·ŸåŸå›¾ä¿æŒä¸€è‡´ã€‚

çœ‹åˆ°è¿™é‡Œï¼Œç›¸ä¿¡ä½ ä¹Ÿé©¬ä¸Šå°±èƒ½æƒ³æ˜ç™½çºµå‘ç¿»è½¬çš„ä»£ç è¯¥å¦‚ä½•å†™äº†ï¼

![](https://static001.geekbang.org/resource/image/2e/1e/2e7ae2ec91856141ff2881ec2cdb441e.jpg?wh=1671x899)

æˆ‘ä»¬è¿˜æ˜¯ä»¥(1, 0)è¿™ä¸ªåƒç´ ç‚¹ä¸ºä¾‹ï¼Œåœ¨çºµå‘ç¿»è½¬ä»¥åå°±å˜æˆäº†(1, 3)ï¼Œå®ƒä»¬çš„è½¬æ¢è§„åˆ™æ˜¯(x, height-1-y)ã€‚

```plain
/**
 * çºµå‘ç¿»è½¬å›¾ç‰‡
 */
fun Image.flipVertical(): Image {
    val pixels = Array(height()) { y ->
        Array(width()) { x ->
            getPixel(height() - 1 - y, x) // æ”¹åŠ¨è¿™é‡Œ
        }
    }
    return Image(pixels)
}
```

æ‰€ä»¥è¯´ï¼Œåªè¦æˆ‘ä»¬èƒ½æ‰¾åˆ°ä¸­é—´çš„è½¬æ¢å…³ç³»ï¼Œçºµå‘ç¿»è½¬çš„ä»£ç ï¼Œåªéœ€è¦åœ¨æ¨ªå‘ç¿»è½¬çš„åŸºç¡€ä¸Šï¼Œæ”¹åŠ¨ä¸€è¡Œå³å¯ã€‚

### å•å…ƒæµ‹è¯•

å…¶å®é’ˆå¯¹å›¾åƒç®—æ³•çš„å•å…ƒæµ‹è¯•ï¼Œæˆ‘ä»¬æœ€å¥½çš„æ–¹å¼ï¼Œå°±æ˜¯å‡†å¤‡ä¸€äº›ç°æœ‰çš„å›¾ç‰‡æ¡ˆä¾‹ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬éšä¾¿æ‰¾ä¸€å¼ å›¾ï¼Œç”¨å…¶ä»–çš„è½¯ä»¶å·¥å…·ï¼Œå¯¹å®ƒè¿›è¡Œç¿»è½¬ã€è£åˆ‡ï¼Œç„¶åå­˜å‚¨èµ·æ¥ã€‚æ¯”å¦‚è¿˜æ˜¯è¿™å››å¼ å›¾ï¼š

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/85/d8/85f71d3914e23b7ed8664ae57f0e9fd8.png?wh=1128x424)

æˆ‘ä»¬å¯ä»¥æŠŠå¤„ç†åçš„å›¾ç‰‡ä¿å­˜åœ¨å•å…ƒæµ‹è¯•çš„æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–¹ä¾¿æˆ‘ä»¬å†™å¯¹åº”çš„æµ‹è¯•ç”¨ä¾‹ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/47/d2/47ff01b7fd65dcf6e99e298be6e104d2.png?wh=478x327)

é‚£ä¹ˆï¼Œæœ‰äº†è¿™äº›å›¾ç‰‡ä¹‹åï¼Œæˆ‘æƒ³ä½ åº”è¯¥å°±èƒ½æƒ³åˆ°è¦æ€ä¹ˆåŠäº†ã€‚è¿™æ—¶å€™ï¼Œä½ åªéœ€è¦å†™ä¸€ä¸ªå›¾ç‰‡åƒç´ å¯¹æ¯”çš„æ–¹æ³•checkImageSame()å°±å¥½åŠäº†ã€‚

```plain
private fun checkImageSame(picture: Image, expected: Image) {
    assertEquals(picture.height(), expected.height())
    assertEquals(picture.width(), expected.width())
    for (row in 0 until picture.height()) {
        for (column in 0 until picture.width()) {
            val actualPixel = picture.getPixel(row, column)
            val expectedPixel = expected.getPixel(row, column)
            assertEquals(actualPixel, expectedPixel)
        }
    }
}
```

å…¶å®ï¼Œè¿™ä¸ªå‡½æ•°çš„æ€è·¯ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯é€ä¸ªå¯¹æ¯”ä¸¤å¼ å›¾ç‰‡ä¹‹é—´çš„åƒç´ ï¼Œçœ‹çœ‹å®ƒä»¬æ˜¯ä¸æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœä¸¤å¼ å›¾æ‰€æœ‰çš„åƒç´ éƒ½ä¸€æ ·ï¼Œé‚£è‚¯å®šå°±æ˜¯ä¸€æ ·çš„ã€‚

æœ‰äº†è¿™ä¸ªæ–¹æ³•ä»¥åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¿«é€Ÿå®ç°å•å…ƒæµ‹è¯•ä»£ç äº†ã€‚æ•´ä½“æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/d3/a6/d37e162b313258fa01ed4f1a99d7d0a6.png?wh=1114x394)

```plain
@Test
fun testCrop() {
    val image = loadImage(File("${TEST_BASE_PATH}android.png"))
    val height = image.height() / 2
    val width = image.width() / 2
    val target = loadImage(File("${TEST_BASE_PATH}android_half_crop.png"))

    val crop = image.crop(0, 0, width, height)
    checkImageSame(crop, target)
}

@Test
fun testFlipVertical() {
    val origin = loadImage(File("${TEST_BASE_PATH}android.png"))
    val target = loadImage(File("${TEST_BASE_PATH}android_up_side_down.png"))
    val flipped = origin.flipVertical()
    checkImageSame(flipped, target)
}

@Test
fun testFlipHorizontal() {
    val origin = loadImage(File("${TEST_BASE_PATH}android.png"))
    val target = loadImage(File("${TEST_BASE_PATH}android_flipped.png"))
    val flipped = origin.flipHorizontal()
    checkImageSame(flipped, target)
}
```

æœ‰äº†å•å…ƒæµ‹è¯•ï¼Œæˆ‘ä»¬å°±å†ä¹Ÿä¸ç”¨æ‹…å¿ƒä»¥åæ”¹ä»£ç çš„æ—¶å€™ï¼Œä¸å°å¿ƒæ”¹å‡ºé—®é¢˜äº†ã€‚

å¥½ï¼Œé‚£ä¹ˆåˆ°è¿™é‡Œï¼Œ1.0ç‰ˆæœ¬å°±ç®—æ˜¯å®Œæˆäº†ã€‚æˆ‘ä»¬æ¥ç€æ¥çœ‹çœ‹2.0ç‰ˆæœ¬ã€‚

## 2.0ç‰ˆæœ¬

2.0ç‰ˆæœ¬çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦æ”¯æŒä¸‹è½½ç½‘ç»œä¸Šé¢çš„å›¾ç‰‡ï¼Œå¹¶ä¸”è¿˜è¦èƒ½å¤Ÿå­˜èµ·æ¥ã€‚ç”±äºè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒè€—æ—¶çš„æ“ä½œï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒæ˜¯ä¸€ä¸ªæŒ‚èµ·å‡½æ•°ã€‚

å…³äºä¸‹è½½HTTPçš„å›¾ç‰‡ï¼Œå…¶å®ï¼Œæˆ‘ä»¬å€ŸåŠ©OkHttpå°±å¯ä»¥ç®€å•å®ç°ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹ä»£ç ã€‚

> è¡¥å……ï¼šä¸ºäº†ä¸åç¦»ä¸»é¢˜ï¼Œæˆ‘ä»¬ä¸è€ƒè™‘HTTPSçš„é—®é¢˜ã€‚

```plain
fun downloadSync() {
    logX("Download start!")
    val okHttpClient = OkHttpClient().newBuilder()
        .connectTimeout(10L, TimeUnit.SECONDS)
        .readTimeout(10L, TimeUnit.SECONDS)
        .build()

    val request = Request.Builder().url(url).build()
    val response = okHttpClient.newCall(request).execute()

    val body = response.body
    val responseCode = response.code

    if (responseCode >= HttpURLConnection.HTTP_OK &&
        responseCode < HttpURLConnection.HTTP_MULT_CHOICE &&
        body != null
    ) {
        // 1ï¼Œ æ³¨æ„è¿™é‡Œ
        body.byteStream().apply {
            outputFile.outputStream().use { fileOut ->
                copyTo(fileOut)
            }
        }
    }
    logX("Download finish!")
}
```

ä»¥ä¸Šä»£ç ä¸­ï¼Œæœ‰ä¸€ä¸ªåœ°æ–¹æ˜¯éœ€è¦æ³¨æ„çš„ï¼Œæˆ‘ç”¨æ³¨é‡Šæ ‡è®°äº†ã€‚ä¹Ÿå°±æ˜¯å½“æˆ‘ä»¬æƒ³è¦æŠŠç½‘ç»œæµä¸­çš„æ•°æ®å­˜èµ·æ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©Kotlinæä¾›çš„ **IOæ‰©å±•å‡½æ•°**å¿«é€Ÿå®ç°ï¼Œè¿™æ ·ä¸ä»…æ–¹ä¾¿ï¼Œè€Œä¸”è¿˜ä¸ç”¨æ‹…å¿ƒFileOutputStreamè°ƒç”¨close()çš„é—®é¢˜ã€‚è¿™ä¸ªéƒ¨åˆ†çš„ä»£ç ï¼Œåœ¨Javaå½“ä¸­ï¼Œæ˜¯è¦å†™ä¸€å †æ¨¡æ¿ä»£ç çš„ã€‚

ä¸‹è½½æœ¬èº«çš„åŠŸèƒ½å®ç°ä»¥åï¼ŒæŒ‚èµ·å‡½æ•°çš„å°è£…ä¹Ÿå°±å®¹æ˜“äº†ã€‚

```plain
suspend fun downloadImage(url: String, outputFile: File): Boolean {
    return withContext(Dispatchers.IO) {
        try {
            downloadSync()
        } catch (e: Exception) {
            println(e)
            // return@withContext  ä¸å¯çœç•¥
            return@withContext false
        }
        // return@withContext å¯çœç•¥
        return@withContext true
    }
}
```

è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨ **withContext**ï¼Œè®©ä¸‹è½½çš„ä»»åŠ¡ç›´æ¥åˆ†å‘åˆ°IOçº¿ç¨‹ã€‚

ä»£ç å†™åˆ°è¿™é‡Œï¼Œ2.0ç‰ˆæœ¬è¦æ±‚çš„åŠŸèƒ½åŸºæœ¬ä¸Šå°±ç®—æ˜¯å®Œæˆäº†ã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨mainå‡½æ•°å½“ä¸­å»è°ƒç”¨å®ƒäº†ã€‚

```plain
fun main() = runBlocking {
    val url = "http://xxxx.jpg"
    val path = "${BASE_PATH}downloaded.png"

    downloadImage(url, File(path))

    loadImage(File(path))
        .flipVertical()
        .writeToFile(File("${BASE_PATH}download_flip_vertical.png"))

    logX("Done")
}

// å°†å†…å­˜å›¾ç‰‡ä¿å­˜åˆ°ç¡¬ç›˜
fun Image.writeToFile(outputFile: File): Boolean {
    return try {
        val width = width()
        val height = height()
        val image = BufferedImage(width, height, BufferedImage.TYPE_INT_RGB)
        for (x in 0 until width) {
            for (y in 0 until height) {
                val awtColor = getPixel(y, x)
                image.setRGB(x, y, awtColor.rgb)
            }
        }
        ImageIO.write(image, "png", outputFile)
        true
    } catch (e: Exception) {
        println(e)
        false
    }
}

/*
è¾“å‡ºç»“æœï¼š
================================
Download start!
Thread:DefaultDispatcher-worker-1
================================
================================
Download finish!
Thread:DefaultDispatcher-worker-1
================================
================================
Done
Thread:main
================================
*/
```

é€šè¿‡è¿è¡Œç»“æœï¼Œæˆ‘ä»¬ä¼šå‘ç°å›¾ç‰‡ä¸‹è½½çš„ä»»åŠ¡ï¼Œå·²ç»è¢«åˆ†å‘åˆ°IOçº¿ç¨‹æ± äº†ï¼Œè€Œå…¶ä»–çš„ä»£ç ä»ç„¶åœ¨ä¸»çº¿ç¨‹ä¹‹ä¸Šã€‚

## å°ç»“

å…¶å®ï¼Œè¯¾ç¨‹è¿›è¡Œåˆ°è¿™é‡Œï¼Œä½ å°±ä¼šå‘ç°ï¼ŒKotlinå’ŒJavaã€Cä¹‹ç±»çš„è¯­è¨€çš„ç¼–ç¨‹æ–¹å¼æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ã€‚Kotlinæä¾›äº†ä¸°å¯Œçš„æ‰©å±•å‡½æ•°ï¼Œåœ¨å¾ˆå¤šä¸šåŠ¡åœºæ™¯ä¸‹ï¼ŒKotlinæ˜¯å¯ä»¥å¤§å¤§å‡å°‘ä»£ç é‡çš„ã€‚

å¦å¤–ï¼Œä½ ä¹Ÿä¼šå‘ç°ï¼Œå½“ä½ ç†Ÿæ‚‰Kotlinåç¨‹ä»¥åï¼Œå®ƒçš„ä½¿ç”¨ä¸€ç‚¹éƒ½ä¸éš¾ã€‚å¯¹äºä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬é€šè¿‡withContext(Dispatchers.IO)å°±èƒ½åˆ‡æ¢çº¿ç¨‹ï¼Œä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨åç¨‹ä½œç”¨åŸŸå½“ä¸­éšæ„è°ƒç”¨äº†ï¼

## æ€è€ƒé¢˜

ä½ è§‰å¾—ï¼Œæˆ‘ä»¬åœ¨downloadImage()è¿™ä¸ªæŒ‚èµ·å‡½æ•°å†…éƒ¨ï¼Œç›´æ¥å†™æ­»Dispatchers.IOçš„æ–¹å¼å¥½å—ï¼Ÿå¦‚æœæ¢æˆä¸‹é¢è¿™ç§å†™æ³•ï¼Œä¼šä¸ä¼šæ›´å¥½ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ

```plain
suspend fun downloadImage(
    coroutineContext: CoroutineContext = Dispatchers.IO,
    url: String,
    outputFile: File
): Boolean {

    return withContext(coroutineContext) {
        try {
            downloadSync()
        } catch (e: Exception) {
            println(e)
            return@withContext false
        }
        return@withContext true
    }
}
```
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ10ï¼‰</strong></div><ul>
<li><span>Allen</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>æ€è€ƒé¢˜ä¸­å…³äºè°ƒåº¦å™¨çš„ä½¿ç”¨ä¸å¤ªå¥½ï¼Œä¸€èˆ¬çš„ä½¿ç”¨æ–¹å¼æ˜¯é€šè¿‡æš´éœ²å‚æ•°çš„æ–¹å¼è®©ä½¿ç”¨è€…æ¥ä¼ ã€‚

é€šè¿‡ä¼ å‚çš„æ–¹å¼æœ‰ä¸¤ä¸ªå¥½å¤„ï¼š 
1. å¢åŠ äº†ä»£ç çš„çµæ´»æ€§å’Œå¯ç”¨æ€§ã€‚
2. æœ‰åˆ©äºå•å…ƒæµ‹è¯•ã€‚</p>2022-02-28</li><br/><li><span>ç™½ä¹¾æ¶›</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>class Image(private val pixels: Array&lt;Array&lt;Color&gt;&gt;) {
    val height: Int = pixels.size
    val width: Int = pixels[0].size
    private fun getPixel(y: Int, x: Int): Color = pixels[y][x]

    fun flipHorizontal() = changeImage { y, x -&gt; getPixel(y, width - 1 - x) } &#47;&#47;æ¨ªå‘ç¿»è½¬å›¾ç‰‡

    fun flipVertical() = changeImage { y, x -&gt; getPixel(height - 1 - y, x) }  &#47;&#47;çºµå‘ç¿»è½¬å›¾ç‰‡

    fun crop(startY: Int, startX: Int, width: Int, height: Int): Image =
        toImage(height, width) { y, x -&gt; getPixel(startY + y, startX + x) } &#47;&#47;å›¾ç‰‡è£åˆ‡
}

fun Image.changeImage(init: (Int, Int) -&gt; Color): Image = toImage(height, width, init)

fun loadImage(imageFile: File): Image =
    ImageIO.read(imageFile)
        .let { toImage(it.height, it.width) { x, y -&gt; Color(it.getRGB(x, y)) } }

fun toImage(height: Int, width: Int, init: (Int, Int) -&gt; Color): Image =
    Array(height) { y -&gt; &#47;&#47; åˆ›å»ºä¸€ä¸ª Arrayï¼Œå…ƒç´ ç±»å‹ä¹Ÿæ˜¯ Array
        Array(width) { x -&gt; &#47;&#47; åˆ›å»ºä¸€ä¸ª Arrayï¼Œå…ƒç´ ç±»å‹æ˜¯ Color
            init(x, y) &#47;&#47; æ¯ä¸ªå…ƒç´ éƒ½æ˜¯åœ¨ init() ä¸­åˆå§‹åŒ–çš„
        }
    }.let { Image(it) }</p>2022-03-06</li><br/><li><span>PoPlus</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>æš‚æ—¶æ²¡æƒ³åˆ° context åŠ¨æ€ä¼ å…¥æœ‰ä»€ä¹ˆå¥½å¤„ï¼ŒæŒ‰ç†è¯´ä¸‹è½½å›¾ç‰‡åªéœ€è¦ IO å°±è¡Œäº†ï¼Œå¸Œæœ›è€å¸ˆèƒ½è§£æƒ‘ã€‚</p>2022-03-01</li><br/><li><span>Allen</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è¿™ä¸ªä¸‹è½½å›¾ç‰‡çš„å®ç°å’Œæˆ‘ä»¬æ™®é€šå¼€çº¿ç¨‹ä¸‹è½½çš„ä¸»è¦åŒºåˆ«å°±æ˜¯ä½¿ç”¨åŒæ­¥çš„å†™æ³•ï¼ˆä¸éœ€è¦å†™ callbackï¼‰æ¥å®ç°äº†å¼‚æ­¥çš„æ“ä½œã€‚</p>2022-02-28</li><br/><li><span>Geek_Adr</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>çµæ´»ä¼šå¸¦æ¥APIéš¾ç”¨ï¼Œå¢åŠ çŠ¯é”™çš„æ¦‚ç‡ï¼Œä½†åˆä¸èƒ½æŠŠçµæ´»ä¸¢æ‰

å…¼å¾—çš„æ–¹æ³•ï¼šå…ˆç»™ä¸€å¥—é»˜è®¤æœ€ä½³å®ç°ï¼Œæ»¡è¶³å¤§å¤šæ•°æƒ…å†µï¼Œä½¿ç”¨è€…æ¸…æ™°çŸ¥é“é»˜è®¤å®ç°ä¸æ»¡è¶³æ—¶å†ç»™çµæ´»çš„æ–¹æ¡ˆ

æˆ‘è®¤ä¸ºå¯é…æœ‰é»˜è®¤å®ç°çš„æ–¹å¼æ›´å¥½</p>2022-03-12</li><br/><li><span>æ›¾å¸…</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è¿™ä¸ªé—®é¢˜ æˆ–è®¸ å¯ä»¥æ ¹æ®é¡¹ç›®æ¥ï¼Œæœ‰äº›é¡¹ç›®å¯èƒ½æœ‰è‡ªå·±çš„ çº¿ç¨‹æ±  æˆ–è€…ä¸€äº› ç”Ÿå‘½å‘¨æœŸ çš„è¦æ±‚ï¼Œå°±å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚è¿›è¡Œä¼ å‚è¿›è¡Œå¤„ç†ã€‚å¦‚æœæ²¡æœ‰è¿™äº›éœ€æ±‚çš„è¯ï¼Œç›´æ¥ç”¨ IO ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p>2022-03-02</li><br/><li><span>Lå…ˆç”Ÿ</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>æˆ‘è§‰å¾—ä¼šå¥½ç‚¹ï¼Œç»™è°ƒç”¨è€…é€‰æ‹©çš„æƒåˆ©ï¼Œå¹¶ä¸”èµ‹äºˆé»˜è®¤å€¼ï¼Œæ–¹ä¾¿å•å…ƒæµ‹è¯•</p>2022-03-01</li><br/><li><span>24éš‹å¿ƒæ‰€æ¬²</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>ä½¿ç”¨ withContext() çš„ä¸»æ„ä½œç”¨å°±æ˜¯åˆ‡æ¢çº¿ç¨‹å—ï¼Ÿ</p>2022-10-29</li><br/><li><span>éƒ‘å³°</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>InputStreamåº”è¯¥ä¹Ÿéœ€è¦æ­£å¸¸closeå§ï¼Ÿä¾‹å¦‚

        body.byteStream().use {
            outputFile.outputStream().use { fileOut -&gt;
                it.copyTo(fileOut)
            }
        }</p>2022-08-19</li><br/><li><span>Link</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>æœ‰ä¸ªç–‘æƒ‘ï¼Œç±»ä¼¼ fun Image.writeToFileï¼ˆï¼‰ï¼Œè¿™æ ·çš„æ‰©å±•å¤šäº†è¯ä¼šä¸ä¼šå¯¼è‡´å…¶ä»–åœ°æ–¹åœ¨ä½¿ç”¨Imageç±»çš„æ—¶å€™äº§ç”Ÿç–‘æƒ‘ï¼ˆè¿‡åº¦æ‰©å±•ï¼Ÿï¼‰ï¼Œä½†å‡½æ•°å¼é£æ ¼çš„ç¼–ç¨‹ä¼¼ä¹å°±å¿…é¡»å†™ä¸€å †æ‰©å±•æ–¹æ³•ï¼Ÿæœ›è€å¸ˆè§£æƒ‘</p>2022-06-09</li><br/>
</ul>