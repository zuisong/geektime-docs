ä½ å¥½ï¼Œæˆ‘æ˜¯å®‹ä¸€ç®ï¼Œæ¬¢è¿å›åˆ°Reactåº”ç”¨å¼€å‘çš„å­¦ä¹ ã€‚

ä»ä¸ŠèŠ‚è¯¾å¼€å§‹ï¼Œæˆ‘ä»¬è¿›å…¥äº†å¤§ä¸­å‹Reacté¡¹ç›®æœ€é‡è¦çš„å®è·µä¹‹ä¸€ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•çš„å­¦ä¹ ã€‚

æˆ‘ä»¬é¦–å…ˆäº†è§£äº†äººå·¥æµ‹è¯•ä¸è‡ªåŠ¨åŒ–æµ‹è¯•çš„åŒºåˆ«ï¼Œä»¥åŠè‡ªåŠ¨åŒ–æµ‹è¯•å¯¹å¤§å‹å‰ç«¯é¡¹ç›®çš„é‡è¦æ„ä¹‰ï¼Œä¹Ÿå»ºè®®ç”±ä¸šåŠ¡åŠŸèƒ½çš„å¼€å‘è€…äº²è‡ªæ¥ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ã€‚ç„¶åæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•åˆ©ç”¨ç°ä»£è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶Playwrightï¼Œå¼€å‘è‡ªåŠ¨åŒ–E2Eæµ‹è¯•ç”¨ä¾‹ã€‚

è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬ä¼šç»§ç»­å­¦ä¹ å¤§ä¸­å‹Reacté¡¹ç›®çš„è´¨é‡ä¿è¯ï¼Œåˆ©ç”¨å•å…ƒæµ‹è¯•è¿›ä¸€æ­¥æå‡é¡¹ç›®è´¨é‡ã€‚åŒæ—¶ä¹Ÿäº†è§£ä¸€ä¸‹æµ‹è¯•é‡‘å­—å¡”çš„ç†è®ºï¼Œæœ‰åŠ©äºä½ æ›´æ·±å…¥ç†è§£ç«¯åˆ°ç«¯å’Œå•å…ƒæµ‹è¯•çš„å…³ç³»ã€‚

ä¸‹é¢å¼€å§‹è¿™èŠ‚è¯¾çš„å†…å®¹ã€‚

## å‰ç«¯å¼€å‘è€…åº”è¯¥äº†è§£çš„æµ‹è¯•é‡‘å­—å¡”

é¦–å…ˆå›é¡¾ä¸€ä¸‹ä¸ŠèŠ‚è¯¾æåˆ°çš„å…³äºæµ‹è¯•èŒƒå›´çš„è§‚ç‚¹ï¼š

> â€¦â€¦ä¸ä¼šå»å°è¯•ç©·ä¸¾æ‰€æœ‰å¯èƒ½æ€§ï¼Œå¦åˆ™å¼€å‘å‡ºæ¥çš„æµ‹è¯•ç”¨ä¾‹å°±ç®—æ¯”æºç éƒ½å¤§å¥½å¤šå¥½å¤šå€ï¼Œä¹Ÿéƒ½ä¸ä¸€å®šèƒ½è¾¾åˆ°100%è¦†ç›–ã€‚

å‡è®¾ä¸€æ®µç¨‹åºå…ˆåæœ‰2ä¸ªæ¡ä»¶åˆ†æ”¯ï¼Œé‚£ä¹ˆå¦‚æœå¸Œæœ›å…¨è¦†ç›–åˆ°ï¼Œåˆ™éœ€è¦è®¾è®¡4ä¸ªæµ‹è¯•ç”¨ä¾‹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/c4/88/c440d3d59c709c73c61780d9d6a9a988.jpg?wh=1920x1080)

å›¾ä¸­çš„4æ¡é¢œè‰²çš„è¿çº¿å¯¹åº”äº†4ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œåˆ†åˆ«æ˜¯ï¼š

- A â†’ B1 â†’ C1 â†’ Dï¼›
- A â†’ B1 â†’ C2 â†’ Dï¼›
- A â†’ B2 â†’ C1 â†’ Dï¼›
- A â†’ B2 â†’ C2 â†’ Dã€‚

è€Œåœ¨ä¸€ä¸ªå®Œæ•´çš„å‰ç«¯åº”ç”¨ä¸­ï¼Œè¿™æ ·çš„åˆ†æ”¯ç»ä¸åœ¨å°‘æ•°ã€‚å¯æƒ³è€ŒçŸ¥ï¼Œæ— è®ºä»ç¼–å†™æ•ˆç‡è¿˜æ˜¯æ‰§è¡Œæ•ˆç‡æ¥çœ‹ï¼ŒE2Eæµ‹è¯•éƒ½æ— æ³•è¦†ç›–æ‰€æœ‰é€»è¾‘å’Œäº¤äº’åˆ†æ”¯ã€‚

é‚£æ¢ä¸ªæ€è·¯ï¼Œå¦‚æœæŠŠE2Eæ— æ³•è¦†ç›–çš„éƒ¨åˆ†æµ‹è¯•ç‚¹æ‰“æ•£ï¼Œæ”¹ç”¨å…¶ä»–æ›´åŠ é«˜æ•ˆçš„æ–¹å¼æµ‹è¯•å®ƒä»¬ï¼Œä¸å°±èƒ½æé«˜è¦†ç›–ç‡äº†å—ï¼Ÿ

è¿™å°±å¼•å‡ºäº†ä¸€ä¸ªè½¯ä»¶æµ‹è¯•é¢†åŸŸçš„é‡è¦æ¦‚å¿µï¼šæµ‹è¯•é‡‘å­—å¡”ã€‚

**æµ‹è¯•é‡‘å­—å¡”ï¼ˆTest Pyramidï¼‰æœ€åˆç”±æ•æ·å¼€å‘é¼»ç¥–Mike Cohnåœ¨å…¶è‘—ä½œã€ŠScrumæ•æ·è½¯ä»¶å¼€å‘ã€‹ä¸­æå‡ºï¼Œä¸»å¼ åˆ†å±‚æ¬¡å¼€å±•è‡ªåŠ¨åŒ–æµ‹è¯•ä»¥æé«˜æµ‹è¯•æ•ˆç‡**ã€‚

é‡‘å­—å¡”ä»ä¸Šåˆ°ä¸‹ä¸‰å±‚åˆ†åˆ«æ˜¯E2Eæµ‹è¯•ã€æ•´åˆæµ‹è¯•å’Œå•å…ƒæµ‹è¯•ã€‚å…¶ä¸­E2Eå’Œæ•´åˆæµ‹è¯•å±äºé»‘ç›’æµ‹è¯•ï¼Œæ•´åˆç¨‹åº¦æ›´é«˜ï¼Œå•å…ƒæµ‹è¯•å±äºç™½ç›’æµ‹è¯•ï¼Œè¿è¡Œè€—æ—¶æ›´çŸ­ã€‚ä¹‹æ‰€ä»¥å‘ˆé‡‘å­—å¡”å½¢çŠ¶ï¼Œæ˜¯å› ä¸ºä»æµ‹è¯•ç”¨ä¾‹çš„æ¯”é‡çœ‹ï¼ŒE2Eçš„æœ€å°‘ï¼ˆå 10%å·¦å³ï¼‰ï¼Œå•å…ƒæµ‹è¯•æœ€å¤šï¼ˆå 70%å·¦å³ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/1e/24/1ec2ceda9f19ce962f023f7b61536924.jpg?wh=1920x1080)

æˆ‘ä»¬ä¸ŠèŠ‚è¯¾å­¦ä¹ äº†E2Eæµ‹è¯•ï¼ŒçŸ¥é“E2EåŒ…å«äº†å‰ç«¯å’Œåç«¯ï¼Œæ•´åˆæµ‹è¯•ä¼šå°†è½¯ä»¶æ¨¡å—å’Œå®ƒçš„çœŸå®ä¾èµ–ä¸€èµ·æµ‹è¯•ï¼Œå¦‚åç«¯çš„HTTPæ¥å£æµ‹è¯•ã€‚è€Œå•å…ƒæµ‹è¯•åˆ™ä¼šè®¾å®šç‰¹å®šçš„è¾“å…¥å’Œè¾“å‡ºï¼Œå¯¹è½¯ä»¶ä¸­å°½é‡å°çš„æ„æˆå•å…ƒè¿›è¡Œæµ‹è¯•ï¼Œå‰ç«¯ã€åç«¯éƒ½å¯ä»¥åšå•å…ƒæµ‹è¯•ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥å­¦ä¹ Reactåº”ç”¨çš„å•å…ƒæµ‹è¯•ã€‚

## Reactå•å…ƒæµ‹è¯•çš„èŒƒå›´å’Œç›®æ ‡

ç†æƒ³æƒ…å†µè‡ªç„¶æ˜¯ä¸ºReacté¡¹ç›®ä¸­çš„æ‰€æœ‰æºç éƒ½åŠ ä¸Šå•å…ƒæµ‹è¯•ï¼Œè¿™ä¸ªèŒƒå›´åœ¨å°å‹Reacté¡¹ç›®è¿˜èƒ½åšå¾—åˆ°ï¼Œä½†å¤§ä¸­å‹é¡¹ç›®å¾€å¾€å°±æ¯”è¾ƒéš¾äº†ã€‚ä»æµ‹è¯•ä¼˜å…ˆçº§æ¥æ’åºï¼Œéœ€è¦æµ‹è¯•çš„ä»£ç ç±»å‹åŒ…æ‹¬ï¼š

- Reactç»„ä»¶ï¼›
- è‡ªå®šä¹‰Hooksï¼›
- Reduxçš„Actionã€Reducerã€Selectorç­‰ï¼›
- å…¶ä»–ã€‚

éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œè¿‘å¹´æ¥Reactç»„ä»¶æµ‹è¯•å®è·µè¶Šæ¥è¶Šä¸°å¯Œï¼Œæ ¹æ®å®é™…éœ€è¦ï¼Œå¯ä»¥å°†çˆ¶å­ç»„ä»¶å†™åœ¨åŒä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹é‡Œï¼Œä¹Ÿå¯ä»¥ç»„ä»¶å¸¦ç€è‡ªå®šä¹‰Hooksä¸€èµ·æµ‹ã€‚å¯ä»¥è¯´ï¼Œè¿™å·²ç»é€æ¸æ¨¡ç³Šäº†ç»„ä»¶å•å…ƒæµ‹è¯•å’Œæ•´åˆæµ‹è¯•çš„ç•Œé™ã€‚

ä½†ç±»æ¯”è¿ç€çœŸå®æ•°æ®åº“ä¸€èµ·æµ‹çš„åç«¯æ•´åˆæµ‹è¯•ï¼Œå‰ç«¯Reactç»„ä»¶æµ‹è¯•ä½¿ç”¨**æ¨¡æ‹Ÿï¼ˆMockï¼‰**çš„æ¯”é‡è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œæ‰€ä»¥è¿™é‡Œä¾æ—§æŠŠç»„ä»¶æµ‹è¯•å½’ç±»åˆ°å•å…ƒæµ‹è¯•çš„èŒƒç•´ã€‚

å•å…ƒæµ‹è¯•çš„ç›®æ ‡æ˜¯æ¯”è¾ƒå®¹æ˜“é‡åŒ–çš„ï¼Œå¤§éƒ¨åˆ†å•å…ƒæµ‹è¯•æ¡†æ¶éƒ½æ”¯æŒç»Ÿè®¡**ä»£ç è¦†ç›–ç‡ï¼ˆCode Coverageï¼‰**ï¼Œå³è¿è¡Œæµ‹è¯•ç”¨ä¾‹æ—¶æ‰€æ‰§è¡Œçš„æºç å æºç æ€»é‡çš„æ¯”é‡ã€‚è‹¥æƒ³æé«˜æµ‹è¯•çš„è¦†ç›–ç‡ï¼Œéœ€è¦æµ‹è¯•ç”¨ä¾‹å°½å¯èƒ½è¿›å…¥æºç ä¸­æ›´å¤šçš„åˆ†æ”¯ã€‚

å½“ä¼ä¸šè¦æ±‚äº§å“æºç çš„æµ‹è¯•è¦†ç›–ç‡ï¼Œæ— è®ºå‰ç«¯è¿˜æ˜¯åç«¯éƒ½è¦è¾¾åˆ°90%ä»¥ä¸Šæ—¶ï¼Œå¤šå°‘æ˜¯å¯ä»¥ä½“ç°å‡ºä¼ä¸šå¯¹è½¯ä»¶è´¨é‡çš„é‡è§†ç¨‹åº¦çš„ã€‚

## ç”¨Jest + RTLç¼–å†™å•å…ƒæµ‹è¯•

ç›®å‰ReactæŠ€æœ¯ç¤¾åŒºæœ€ä¸ºæµè¡Œçš„å•å…ƒæµ‹è¯•æ¡†æ¶æ˜¯**Jest + RTLï¼ˆReact Testing Libraryï¼‰**ã€‚Jestæ˜¯FBæ¨å‡ºçš„ä¸€æ¬¾å¼€æºJavaScriptæµ‹è¯•æ¡†æ¶ï¼ˆ[å®˜ç½‘](https://jestjs.io/zh-Hans/)ï¼‰ï¼ŒRTLï¼ˆReact Testing Libraryï¼‰æ˜¯ä¸€æ¬¾å¼€æºçš„è½»é‡çº§Reactç»„ä»¶æµ‹è¯•åº“ï¼ˆ[å®˜ç½‘](https://testing-library.com/docs/react-testing-library/intro/)ï¼‰ã€‚

å…¶å®ä½ æ—©åœ¨[ç¬¬ä¸‰èŠ‚è¯¾](https://time.geekbang.org/column/article/553817)ç”¨CRAåˆ›å»ºReacté¡¹ç›®æ—¶å°±å·²ç»æ¥è§¦è¿‡Jest + RTLäº†ï¼Œè¿˜è®°å¾—é‚£ä¸ª `src/App.test.js` æ–‡ä»¶å—ï¼Ÿé‚£ä¸ªå°±æ˜¯Jestçš„å•å…ƒæµ‹è¯•æ–‡ä»¶ï¼š

```typescript
import { render, screen } from '@testing-library/react';
import App from './App';

test('renders learn react link', () => {
Â  render(<App />);
Â  const linkElement = screen.getByText(/learn react/i);
Â  expect(linkElement).toBeInTheDocument();
});
```

å¦‚æœç°åœ¨åœ¨oh-my-kanbanä¸‹è·‘ä¸€ä¸‹ `npm test` ï¼Œå®ƒåº”è¯¥ä¼šå¤±è´¥ï¼Œå¹¶æ˜¾ç¤ºå¦‚ä¸‹æç¤ºï¼š

```bash
Â FAILÂ  src/App.test.js
Â  âœ• renders learn react link (29 ms)

Â  â— renders learn react link

Â  Â  TestingLibraryElementError: Unable to find an element with the text: /learn react/i. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

Â  Â  Ignored nodes: comments, <script />, <style />
Â  Â  <body>
Â  Â  Â  <div>
Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  class="App"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  <header
Â  Â  Â  Â  Â  Â  class="App-header"
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  <h1>
Â  Â  Â  Â  Â  Â  Â  æˆ‘çš„çœ‹æ¿
Â  Â  Â  Â  Â  Â  Â  <button>
Â  Â  Â  Â  Â  Â  Â  Â  ä¿å­˜æ‰€æœ‰å¡ç‰‡
Â  Â  Â  Â  Â  Â  Â  </button>
    # ...
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </body>

Â  Â  Â  4 | test('renders learn react link', () => {
Â  Â  Â  5 |Â  Â render(<App />);
Â  Â  > 6 |Â  Â const linkElement = screen.getByText(/learn react/i);
Â  Â  Â  Â  |Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ^
Â  Â  Â  7 |Â  Â expect(linkElement).toBeInTheDocument();
Â  Â  Â  8 | });
Â  Â  Â  9 |

Â  Â  Â  at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:38:19)
Â  Â  Â  at node_modules/@testing-library/dom/dist/query-helpers.js:90:38
Â  Â  Â  at node_modules/@testing-library/dom/dist/query-helpers.js:62:17
Â  Â  Â  at getByText (node_modules/@testing-library/dom/dist/query-helpers.js:111:19)
Â  Â  Â  at Object.<anonymous> (src/App.test.js:6:30)
Â  Â  Â  at TestScheduler.scheduleTests (node_modules/@jest/core/build/TestScheduler.js:333:13)
Â  Â  Â  at runJest (node_modules/@jest/core/build/runJest.js:404:19)

Test Suites: 1 failed, 1 total
Tests:Â  Â  Â  Â 1 failed, 1 total
Snapshots:Â  Â 0 total
Time:Â  Â  Â  Â  0.665 s, estimated 1 s
Ran all test suites related to changed files.

Watch Usage
Â â€º Press a to run all tests.
Â â€º Press f to run only failed tests.
Â â€º Press q to quit watch mode.
Â â€º Press i to run failing tests interactively.
Â â€º Press p to filter by a filename regex pattern.
Â â€º Press t to filter by a test name regex pattern.
Â â€º Press Enter to trigger a test run.
```

å¾ˆå¿«ä¿®å¤ä¸€ä¸‹ï¼Ÿæœ‰é”™çš„ä¸æ˜¯æºç ï¼Œè€Œæ˜¯æµ‹è¯•ç”¨ä¾‹ï¼š

```bash
test('æ¸²æŸ“ä¿å­˜æ‰€æœ‰å¡ç‰‡æŒ‰é’®', () => {
Â  render(<App />);
Â  const btnElem = screen.getByText(/ä¿å­˜æ‰€æœ‰å¡ç‰‡/i);
Â  expect(btnElem).toBeInTheDocument();
});
```

Jestä¼šè‡ªåŠ¨é‡æ–°è¿è¡Œå¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹ï¼Œè¿™æ¬¡é€šè¿‡äº†ï¼š

```bash
Â PASSÂ  src/App.test.js
Â  âœ“ æ¸²æŸ“ä¿å­˜æ‰€æœ‰å¡ç‰‡æŒ‰é’® (27 ms)

Test Suites: 1 passed, 1 total
Tests:Â  Â  Â  Â 1 passed, 1 total
Snapshots:Â  Â 0 total
Time:Â  Â  Â  Â  0.709 s, estimated 1 s
Ran all test suites related to changed files.

Watch Usage: Press w to show more.
```

å¦‚æœReacté¡¹ç›®ä¸æ˜¯ç”¨CRAæ­å»ºçš„ï¼Œåˆ™éœ€è¦å®‰è£…Jest + RTLã€‚Jestçš„å®‰è£…å¯ä»¥å‚è€ƒå®˜ç½‘çš„[å¿«é€Ÿå¼€å§‹æ–‡æ¡£](https://jestjs.io/zh-Hans/docs/getting-started)ï¼ŒRTLåˆ™ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```bash
npm install -D @testing-library/react
```

åœ¨ `package.json` ä¸­åŠ å…¥ä¸€ä¸ª `test` è„šæœ¬ï¼š

```bash
Â  "scripts": {
Â  Â  "test": "jest"
Â  },
```

ä¸è®ºæ˜¯å¦æ˜¯CRAåˆ›å»ºçš„Reacté¡¹ç›®ï¼Œåªè¦è£…å¥½äº†Jestï¼Œåœ¨å•å…ƒæµ‹è¯•çš„åŒæ—¶å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç»Ÿè®¡ä»£ç è¦†ç›–ç‡ã€‚åœ¨ `package.json` ä¸­åŠ å…¥ä¸€ä¸ª `cov` è„šæœ¬ï¼š

```bash
Â  "scripts": {
Â  Â  "cov": "jest --coverage"
Â  },
```

è¿è¡Œ `npm run cov` å°±å¯ä»¥çœ‹åˆ°è¦†ç›–ç‡æŠ¥å‘Šï¼ˆå¥½ä½ï¼‰ï¼š

```bash
Â PASSÂ  src/App.test.js
Â  âœ“ æ¸²æŸ“ä¿å­˜æ‰€æœ‰å¡ç‰‡æŒ‰é’® (27 ms)

-----------------|---------|----------|---------|---------|-------------------------
FileÂ  Â  Â  Â  Â  Â  Â | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s
-----------------|---------|----------|---------|---------|-------------------------
All filesÂ  Â  Â  Â  |Â  Â 39.21 |Â  Â  35.29 |Â  Â 13.63 |Â  Â 40.81 |
Â App.jsÂ  Â  Â  Â  Â  |Â  Â 51.72 |Â  Â  Â  Â  0 |Â  Â  Â  20 |Â  Â 55.55 | 34-40,44-49,57,60-61,66
Â KanbanColumn.js |Â  Â 22.72 |Â  Â  Â  Â 40 |Â  Â  8.33 |Â  Â 22.72 | 54,57-58,64-102
-----------------|---------|----------|---------|---------|-------------------------
Test Suites: 1 passed, 1 total
Tests:Â  Â  Â  Â 1 passed, 1 total
Snapshots:Â  Â 0 total
Time:Â  Â  Â  Â  0.439 s, estimated 1 s
Ran all test suites.
```

å¼€å‘æµ‹è¯•ç”¨ä¾‹æ—¶ï¼Œä½ å¯ä»¥å‚ç…§å•å…ƒæµ‹è¯•çš„[3Aæ¨¡å¼](https://wiki.c2.com/?ArrangeActAssert)**ï¼šArrangeï¼ˆå‡†å¤‡ï¼‰â†’ Actï¼ˆåŠ¨ä½œï¼‰â†’ Assertï¼ˆæ–­è¨€ï¼‰**ã€‚

### ä¸ºReactç»„ä»¶ç¼–å†™å•å…ƒæµ‹è¯•

æˆ‘ä»¬ä¾æ—§ä»¥ `oh-my-kanban` é¡¹ç›®ä¸ºä¾‹ï¼Œå­¦ä¹ ä¸€ä¸‹å¦‚ä½•ä¸ºReactç»„ä»¶ç¼–å†™å•å…ƒæµ‹è¯•ã€‚

è™½ç„¶ä¸ŠèŠ‚è¯¾æ·»åŠ E2Eæµ‹è¯•æ—¶åˆ›å»ºäº†ä¸€ä¸ªtestç›®å½•ï¼Œä½†å»ºè®®æŠŠå•å…ƒæµ‹è¯•æ–‡ä»¶æ”¾åœ¨ä¸è¢«æµ‹è¯•çš„æºç æ–‡ä»¶å°½é‡è¿‘çš„ä½ç½®ï¼ˆä½†ä¹Ÿä¸ç”¨åƒCRAé»˜è®¤çš„ `src/App.test.js` é‚£ä¹ˆè¿‘ï¼‰ã€‚Jesté¼“åŠ±æŠŠæµ‹è¯•æ–‡ä»¶æ”¾åœ¨æºç æ–‡ä»¶åŒçº§çš„ `__tests__` ç›®å½•ä¸‹ï¼Œåç¼€æ’å…¥ `.test` ï¼Œé‚£æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª `src/__tests__/KanbanNewCard.test.js` æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```javascript
import { act, fireEvent, render } from '@testing-library/react';
import KanbanNewCard from '../KanbanNewCard';

describe('KanbanNewCard', () => {
Â  it('æ·»åŠ æ–°å¡ç‰‡', async () => {
Â  Â  // Arrange å‡†å¤‡
Â  Â  const onSubmit = jest.fn();
Â  Â  // Act åŠ¨ä½œ
Â  Â  const { findByText, findByRole } = render(
Â  Â  Â  <KanbanNewCard onSubmit={onSubmit} />
Â  Â  );

Â  Â  // Assert æ–­è¨€
Â  Â  const titleElem = await findByText('æ·»åŠ æ–°å¡ç‰‡');
Â  Â  expect(titleElem).toBeInTheDocument();

Â  Â  const inputElem = await findByRole('textbox');
Â  Â  expect(inputElem).toHaveFocus();

Â  Â  // Act åŠ¨ä½œ
Â  Â  act(() => {
Â  Â  Â  fireEvent.change(inputElem, { target: { value: 'å•å…ƒæµ‹è¯•æ–°å¡ç‰‡-1' } });
Â  Â  Â  fireEvent.keyDown(inputElem, { key: 'Enter' });
Â  Â  });

Â  Â  // Assert æ–­è¨€
Â  Â  expect(onSubmit).toHaveBeenCalledTimes(1);
Â  Â  expect(onSubmit.mock.lastCall[0]).toHaveProperty('title', 'å•å…ƒæµ‹è¯•æ–°å¡ç‰‡-1');
Â  });
});
```

ä¿å­˜æ–‡ä»¶ï¼ŒJestä¼šè‡ªåŠ¨æ‰§è¡Œï¼š

```bash
Â PASSÂ  src/App.test.js
Â PASSÂ  src/__tests__/KanbanNewCard.test.js

Test Suites: 2 passed, 2 total
Tests:Â  Â  Â  Â 2 passed, 2 total
Snapshots:Â  Â 0 total
Time:Â  Â  Â  Â  0.788 s, estimated 1 s
Ran all test suites.

Watch Usage: Press w to show more.
```

ä»ä»£ç å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªæµ‹è¯•ç”¨ä¾‹æ˜¯å…¸å‹çš„3Aæ¨¡å¼ã€‚æµ‹è¯•ç”¨ä¾‹itçš„å›è°ƒå‡½æ•°æ˜¯ä¸€ä¸ª `async` å¼‚æ­¥å‡½æ•°ï¼Œå…ˆç”¨jest.fn()æ–¹æ³•å‡†å¤‡æ¨¡æ‹Ÿå‡½æ•° `onSubmit` ï¼Œç„¶åç”¨RTLæä¾›çš„ `render` APIæ¸²æŸ“ `KanbanNewCard` ç»„ä»¶ï¼Œæ¥ç€ç”¨ `render` è¿”å›ç»“æœä¸­çš„æŸ¥è¯¢å™¨ï¼Œå¼‚æ­¥æŸ¥æ‰¾æ ‡é¢˜æ–‡å­—å¹¶æ–­è¨€æ ‡é¢˜è¢«æ¸²æŸ“å‡ºæ¥äº†ã€‚

æ¥ä¸‹æ¥çš„ `findByRole` æ˜¯RTLé‡Œæ¯”è¾ƒæœ‰ç‰¹è‰²çš„ä¸€ä¸ªæ–¹æ³•ã€‚

RTLåº“çš„[è®¾è®¡åŸåˆ™](https://testing-library.com/docs/guiding-principles)æ˜¯ï¼šâ€œ**ä½ çš„æµ‹è¯•ä»£ç è¶Šæ˜¯è´´è¿‘è½¯ä»¶çš„çœŸå®ç”¨æ³•ï¼Œä½ ä»æµ‹è¯•ä¸­å¾—åˆ°çš„ä¿¡å¿ƒå°±è¶Šè¶³**ã€‚â€

æ‰€ä»¥RTLé‡Œçš„APIè®¾è®¡ï¼ŒåŸºæœ¬éƒ½**ä¸é¼“åŠ±**å»æ·±æŒ–DOMç»“æ„è¿™ç§å®ç°ç»†èŠ‚ã€‚ `findByRole` é‡Œçš„Roleç‰¹æŒ‡[WAI-ARIA](https://www.w3.org/TR/wai-aria-1.2/)ï¼Œå³W3Cæ¨å‡ºçš„å¯Œäº’è”ç½‘åº”ç”¨å¯è®¿é—®æ€§æ ‡å‡†ä¸­çš„Rolesã€‚HTMLé‡ŒåŒ…æ‹¬ `<input type="text">` åœ¨å†…çš„å¤§éƒ¨åˆ†æ ‡ç­¾éƒ½æœ‰é»˜è®¤çš„Roleï¼Œæ¯”æ ‡ç­¾åæœ¬èº«æ›´å…·ä¸šåŠ¡æ„ä¹‰ï¼Œå…·ä½“å¯ä»¥å‚è€ƒè¿™ä¸ª[æ ‡å‡†è¡¨æ ¼](https://www.w3.org/TR/html-aria/#docconformance)ã€‚å› ä¸ºæ–‡æœ¬æ¡†é»˜è®¤ `role="textbox"` ï¼Œè€Œ `KanbanNewCard` ç»„ä»¶ä¸­åªå­˜åœ¨ä¸€ä¸ªæ–‡æœ¬æ¡†ï¼Œæ‰€ä»¥å¯ä»¥å¾ˆå®¹æ˜“å®šä½åˆ°ã€‚

å¦‚æœä½ å®åœ¨æ‰‹ç—’æƒ³ç”¨CSSé€‰æ‹©å™¨æˆ–è€…XPathæ¥æŸ¥æ‰¾DOMèŠ‚ç‚¹ï¼Œå¯ä»¥æŠ˜ä¸­ä¸€ä¸‹ï¼Œä¸ºHTMLæ ‡ç­¾åŠ å…¥ `data-testid` ã€‚å¯¹ï¼Œå°±æ˜¯ä¸ŠèŠ‚è¯¾E2Eé‡Œç”¨åˆ°çš„é‚£ä¸ªåŒæ¬¾å±æ€§ï¼Œç„¶åè°ƒç”¨RTLçš„ `findByTestId` æ¥æŸ¥æ‰¾ã€‚

å®šä½åˆ°æ–‡æœ¬æ¡†ï¼Œæ–­è¨€å®ƒå·²ç»è·å¾—äº†ç„¦ç‚¹ï¼Œç„¶åå¼€å§‹è°ƒç”¨RTLçš„ `act` APIå¼€å±•åŠ¨ä½œã€‚å…ˆåˆ©ç”¨ `fireEvent` è¾“å…¥ä¸€ä¸ªå¡ç‰‡æ ‡é¢˜ï¼Œç„¶åå›è½¦ã€‚æœ€åæ¥æ–­è¨€ä¸€å¼€å§‹å‡†å¤‡çš„æ¨¡æ‹Ÿå‡½æ•° `onSubmit` è¢«è°ƒç”¨è¿‡ä¸€æ¬¡ï¼Œä¸”å‚æ•°åŒ…å«åˆšè¾“å…¥çš„å¡ç‰‡æ ‡é¢˜ã€‚

åˆ°è¿™é‡Œï¼Œä½ å°±å®Œæˆäº†ä¸€ä¸ªåŸºç¡€çš„Reactç»„ä»¶å•å…ƒæµ‹è¯•ç”¨ä¾‹ã€‚é™¤äº†è¿™ç§**é¢„æœŸè·¯å¾„ï¼ˆHappy Pathï¼‰**ï¼Œä½ è¿˜éœ€è¦ç¼–å†™ä¸€äº›**è´Ÿå‘çš„ç”¨ä¾‹ï¼ˆNegative Casesï¼‰**ï¼Œç”¨æ¥æµ‹è¯•å‡ºé”™çš„æƒ…å†µä»¥åŠä¸€äº›**è¾¹ç•Œæƒ…å†µ**ã€‚

æ­£å¦‚è¿™èŠ‚è¯¾ä¸€å¼€å§‹çš„å‰åä¸¤ä¸ªåˆ†æ”¯çš„ä¾‹å­ï¼Œå¦‚æœç”¨å•å…ƒæµ‹è¯•æ¥è¦†ç›–ï¼Œé‚£æˆ‘ä»¬éœ€è¦åˆ†åˆ«ç¼–å†™Aã€B1ã€B2ã€C1ã€C2ã€Dçš„å•å…ƒæµ‹è¯•ï¼Œçœ‹ä¼¼æ•°é‡ä¸Šæ¯”4æ¡è·¯å¾„å¤šï¼Œä½†å¼€å‘å’Œè¿è¡Œæˆæœ¬è¦ä½å¾—å¤šã€‚

å¦‚æœä¸º `src/App.js` ç¼–å†™ä¸€ä¸ªçœŸæ­£çš„å•å…ƒæµ‹è¯•ï¼Œå¾ˆéš¾é¿å…æµ‹è¯•ç”¨ä¾‹ä¸­ä¼šåŒæ—¶æ¸²æŸ“å­ç»„ä»¶ `KanbanBoard` å’Œåä»£ç»„ä»¶ `KanbanColumn` ï¼Œè¿™æ˜¯ä¸æ˜¯ç±»ä¼¼ä¸ŠèŠ‚è¯¾æåˆ°çš„â€œ `App` ç»„ä»¶çš„å¯æµ‹è¯•æ€§æœ‰é—®é¢˜ï¼Ÿâ€å…¶å®è¿˜å¥½ã€‚

æ—©æœŸåœ¨ReactæŠ€æœ¯ç¤¾åŒºï¼Œå¼€å‘è€…ä¼šåˆ©ç”¨ä¸€æ¬¾æµ‹è¯•æ¡†æ¶Enzymeå¯¹ç»„ä»¶åšâ€œæµ…æ¸²æŸ“â€ï¼Œå¯ä»¥å°†æ¸²æŸ“å’Œæµ‹è¯•çš„èŒƒå›´é™åˆ¶åœ¨ `App` æœ¬èº«ï¼›è€ŒReactè¿›å…¥æ–°ç‰ˆåï¼Œå¼€å‘è€…ç»å¸¸ä¼šé‡åˆ°éœ€è¦æ¸²æŸ“ç¨å¾®â€œæ·±â€ä¸€ç‚¹çš„æƒ…å†µï¼ŒåŸæ¥çš„â€œæµ…æ¸²æŸ“â€ä¸å¤Ÿçµæ´»äº†ã€‚

ç°åœ¨æ›´å¸¸è§çš„æ–¹æ³•ï¼Œæ˜¯åˆ©ç”¨Jestå¼ºå¤§çš„æ¨¡æ‹ŸåŠŸèƒ½ï¼Œå°†è¢«æµ‹ç»„ä»¶æ‰€å¯¼å…¥çš„å…¶ä»–ç»„ä»¶æ›¿æ¢æˆç®€åŒ–çš„æ¨¡æ‹Ÿç‰ˆæœ¬ï¼Œå…·ä½“å¯ä»¥å‚è€ƒReactå®˜æ–¹æ–‡æ¡£çš„[Mockæ¨¡å—ç« èŠ‚](https://zh-hans.reactjs.org/docs/testing-recipes.html#mocking-modules)ã€‚

### ä¸ºHooksç¼–å†™å•å…ƒæµ‹è¯•

è¿™é‡Œç®€å•æä¸€ä¸‹ï¼Œå¦‚ä½•ä¸ºè‡ªå®šä¹‰Hooksç¼–å†™å•å…ƒæµ‹è¯•ã€‚

å› ä¸ºè‡ªå®šä¹‰Hooksä¸èƒ½åœ¨Reactå‡½æ•°ç»„ä»¶ä»¥å¤–çš„ç¯å¢ƒä¸­æ‰§è¡Œï¼Œæ‰€ä»¥é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªå°è£…å™¨ç»„ä»¶æ¥è°ƒç”¨è‡ªå®šä¹‰Hooksï¼Œåœ¨æµ‹è¯•ç”¨ä¾‹é‡Œæ¸²æŸ“è¯¥ç»„ä»¶åå†åšæ–­è¨€ã€‚RTLåº“å›¢é˜Ÿæ›¾æ¨å‡ºä¸€æ¬¾å¼€æºåº“ [react-hooks-testing-library](https://github.com/testing-library/react-hooks-testing-library) ï¼Œå°è£…äº†ä¸Šé¢æåˆ°çš„é€»è¾‘ï¼Œåæ¥å·²ç»åˆå¹¶åˆ°RTL 13.1ä»¥ä¸Šçš„ç‰ˆæœ¬ä¸­ï¼Œæˆä¸ºäº†å…¶ä¸­çš„ `renderHook` APIã€‚

ç›®å‰ `oh-my-kanban` ä¸­æ²¡æœ‰è‡ªå®šä¹‰Hooksçš„ä¾‹å­ï¼Œæˆ‘ä»¬å§‘ä¸”çœ‹ä¸€ä¸‹[ç¬¬19èŠ‚è¯¾](https://time.geekbang.org/column/article/579582)çš„ `useFetchBooks` ï¼š

```javascript
const MagazineList = ({ categoryId }) => {
Â  const {
Â  Â  books,
Â  Â  isLoading,
Â  Â  hasNextPage,
Â  Â  onNextPage
Â  } = useFetchBooks(categoryId, '/api/magazines');
  // ...
```

ä¸ºå®ƒå¼€å‘ä¸€ä¸ªå•å…ƒæµ‹è¯•ï¼Œä¸‹é¢æ˜¯éƒ¨åˆ†ä»£ç ï¼š

```javascript
describe('useFetchBooks', () => {
Â  it('è·å–ä¹¦ç±åˆ—è¡¨', async () => {
Â  Â  jest.spyOn(global, 'fetch').mockImplementation(() =>
Â  Â  Â  Promise.resolve({
Â  Â  Â  Â  json: () => Promise.resolve({
Â  Â  Â  Â  Â  items: [
Â  Â  Â  Â  Â  Â  { id: 1, title: 'ç™¾å¹´å­¤ç‹¬' },
Â  Â  Â  Â  Â  Â  { id: 2, title: 'å«Œç–‘äººXçš„çŒ®èº«' },
Â  Â  Â  Â  Â  ], totalPages: 5
Â  Â  Â  Â  })
Â  Â  Â  })
Â  Â  );

Â  Â  const { result, rerender } = renderHook(() => useFetchBooks(categoryId));
Â  Â  const {
Â  Â  Â  books,
Â  Â  Â  isLoading,
Â  Â  Â  hasNextPage,
Â  Â  Â  onNextPage
Â  Â  } = result.current;
Â  Â  expect(/*...*/);

Â  Â  global.fetch.mockRestore();
Â  });
});
```

å•å…ƒæµ‹è¯•æ˜¯ä¸åº”è¯¥æœ‰å‰¯ä½œç”¨çš„ã€‚ä»è¿™æ®µä»£ç ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°åœ¨æµ‹è¯•ç”¨ä¾‹å¼€å¤´ï¼Œå…ˆç”¨ `jest.spyOn` æ–¹æ³•å°†å…¨å±€çš„ `fetch` æ–¹æ³•æ›¿æ¢æˆäº†æ¨¡æ‹Ÿå‡½æ•°ï¼Œç»è¿‡åŠ¨ä½œã€æ–­è¨€ï¼Œæœ€åè¦è®°å¾—æŠŠè¢«æ›¿æ¢çš„å…¨å±€ `fetch` æ–¹æ³•è¿˜åŸã€‚å¦åˆ™ï¼Œæœ‰å¯èƒ½å½±å“åˆ°å…¶ä»–æµ‹è¯•ç”¨ä¾‹ã€‚

## å°ç»“

è¿™èŠ‚è¯¾æˆ‘ä»¬å­¦ä¹ äº†æµ‹è¯•é‡‘å­—å¡”çš„æ¦‚å¿µï¼Œè®¤è¯†åˆ°å¯ä»¥ç”¨æ›´å¤šçš„ã€æˆæœ¬æ›´ä½çš„å•å…ƒæµ‹è¯•æ¥å¼¥è¡¥E2Eè¦†ç›–ä¸åˆ°çš„åœ°æ–¹ã€‚ç„¶åæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ç”¨Jest + RTLä¸ºReactç»„ä»¶å’ŒHooksç¼–å†™å•å…ƒæµ‹è¯•ã€‚ç»è¿‡ä¸ŠèŠ‚è¯¾å’Œè¿™èŠ‚è¯¾çš„å­¦ä¹ ï¼Œæˆ‘ç›¸ä¿¡ä½ å¯¹å¤§ä¸­å‹Reacté¡¹ç›®çš„è´¨é‡ä¿è¯æœ‰äº†ä¸€å®šçš„æŒæ¡ã€‚

æ¯”èµ·â€œç‹¬ç‹¼â€å¼€å‘ï¼Œåœ¨å›¢é˜Ÿåä½œè¿‡ç¨‹ä¸­ï¼Œäººä¸äººäº¤æµé¢‘ç‡ä¼šæ›´é«˜ï¼Œä¿¡æ¯å¤±çœŸä¹Ÿä¼šæˆä¸ºé—®é¢˜ï¼Œæœ€ç»ˆå½±å“åˆ°å¼€å‘æ•ˆç‡å’Œæ•ˆæœã€‚åŒ…æ‹¬è‡ªåŠ¨åŒ–æµ‹è¯•åœ¨å†…çš„ç°ä»£å‰ç«¯å·¥ç¨‹åŒ–å®è·µï¼Œå°±æˆä¸ºå›¢é˜Ÿå¼€å‘å¤§ä¸­å‹Reactåº”ç”¨çš„å¿…ç»ä¹‹è·¯ã€‚

ä¸‹èŠ‚è¯¾æ˜¯è¿™ä¸ªä¸“æ çš„æœ€åä¸€èŠ‚æ­£è¯¾å†…å®¹ï¼Œæˆ‘ä¼šå¸¦ç€ä½ æ€»ç»“ä¸€ä¸‹å‰é¢çš„å†…å®¹ï¼Œç„¶åä¸ºä½ ä»‹ç»å¤§å‹Reactåº”ç”¨é¡¹ç›®ä¸­çš„å›¢é˜Ÿåä½œå’Œå·¥ç¨‹åŒ–ã€‚æœ€åè¿˜ä¼šå¸¦æ¥ä¸€ä¸ªç‰¹åˆ«ä¼åˆ’ï¼Œè¯·ä½ è·Ÿæˆ‘ä¸€èµ·ï¼Œä»¥å¼€æºè½¯ä»¶çš„æ–¹å¼åˆä½œå¼€å‘ä¸€ä¸ªå¤§å‹Reacté¡¹ç›®ã€‚

## æ€è€ƒé¢˜

1. è¯·ä½ ç”¨å­¦åˆ°çš„çŸ¥è¯†é…åˆJestå’ŒRTLçš„æ–‡æ¡£ï¼Œä¸ºKanbanColumnå†™å•å…ƒæµ‹è¯•ã€‚
2. è¯·ä½ å¤ä¹ ä¸€éæ¨¡å—ä¸‰çš„å†…å®¹ï¼Œæƒ³æƒ³æ¯èŠ‚è¯¾çš„çŸ¥è¯†ç‚¹éƒ½åœ¨å¤§ä¸­å‹Reacté¡¹ç›®å’Œå›¢é˜Ÿåä½œä¸­èƒ½å‘æŒ¥ä»€ä¹ˆä½œç”¨ï¼Ÿ

è¿™èŠ‚è¯¾å†…å®¹å°±åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾ä¸è§ä¸æ•£ï¼
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ1ï¼‰</strong></div><ul>
<li><span>Echo!!!</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>å¤§ä½¬æœ€è¿‘çš„ä»£ç æ˜¯ä¸æ˜¯æ²¡æœ‰pushå‘€</p>2022-10-26</li><br/>
</ul>