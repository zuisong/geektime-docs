ä½ å¥½ï¼Œæˆ‘æ˜¯winterã€‚

åœ¨å‰é¢çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘åœ¨JavaScriptå’ŒCSSçš„éƒ¨åˆ†ï¼Œå¤šæ¬¡æåˆ°äº†ç¼–è¯‘åŸç†ç›¸å…³çš„çŸ¥è¯†ã€‚è¿™ä¸€éƒ¨åˆ†çš„çŸ¥è¯†ï¼Œå¦‚æœæˆ‘ä»¬ä»ç¼–è¯‘åŸç†â€œé¾™ä¹¦â€ç­‰æ­£è§„çš„èµ„æ–™ä¸­å­¦ä¹ ï¼Œå°±ä¼šè€—è´¹æ‰ä¸å°‘çš„æ—¶é—´ï¼Œæ‰€ä»¥æˆ‘åœ¨è¿™é‡Œè®¾è®¡äº†ä¸€ä¸ªå°å®éªŒï¼Œå¸®åŠ©ä½ å¿«é€Ÿç†è§£ç¼–è¯‘åŸç†ç›¸å…³çš„çŸ¥è¯†ã€‚

ä»Šå¤©çš„å†…å®¹æ¯”è¾ƒç‰¹æ®Šï¼Œæˆ‘ä»¬æ¥åšä¸€æ®µè¯¦ç»†çš„ä»£ç å®éªŒï¼Œè¯¦ç»†çš„ä»£ç æˆ‘æ”¾åœ¨äº†æ–‡ç« é‡Œï¼Œå¦‚æœä½ æ­£åœ¨æ”¶å¬éŸ³é¢‘ï¼Œå¯ä»¥ç‚¹å‡»æ–‡ç« æŸ¥çœ‹è¯¦æƒ…ã€‚

## åˆ†æ

æŒ‰ç…§ç¼–è¯‘åŸç†ç›¸å…³çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬æ¥è®¾è®¡ä¸€ä¸‹å·¥ä½œï¼Œè¿™é‡Œæˆ‘ä»¬åˆ†æˆå‡ ä¸ªæ­¥éª¤ã€‚

- å®šä¹‰å››åˆ™è¿ç®—ï¼šäº§å‡ºå››åˆ™è¿ç®—çš„è¯æ³•å®šä¹‰å’Œè¯­æ³•å®šä¹‰ã€‚
- è¯æ³•åˆ†æï¼šæŠŠè¾“å…¥çš„å­—ç¬¦ä¸²æµå˜æˆtokenã€‚
- è¯­æ³•åˆ†æï¼šæŠŠtokenå˜æˆæŠ½è±¡è¯­æ³•æ ‘ASTã€‚
- è§£é‡Šæ‰§è¡Œï¼šååºéå†ASTï¼Œæ‰§è¡Œå¾—å‡ºç»“æœã€‚

## å®šä¹‰å››åˆ™è¿ç®—

å››åˆ™è¿ç®—å°±æ˜¯åŠ å‡ä¹˜é™¤å››ç§è¿ç®—ï¼Œä¾‹å¦‚ï¼š

```
1 + 2 * 3
```

é¦–å…ˆæˆ‘ä»¬æ¥å®šä¹‰è¯æ³•ï¼Œå››åˆ™è¿ç®—é‡Œé¢åªæœ‰æ•°å­—å’Œè¿ç®—ç¬¦ï¼Œæ‰€ä»¥å®šä¹‰å¾ˆç®€å•ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜è¦æ³¨æ„ç©ºæ ¼å’Œæ¢è¡Œç¬¦ï¼Œæ‰€ä»¥è¯æ³•å®šä¹‰å¤§æ¦‚æ˜¯ä¸‹é¢è¿™æ ·çš„ã€‚

- Token
  
  - Number: `1` `2` `3` `4` `5` `6` `7` `8` `9` `0` çš„ç»„åˆ
  - Operator: `+` ã€`-`ã€ `*`ã€ `/` ä¹‹ä¸€
- Whitespace: `<sp>`
- LineTerminatorï¼š`<LF>` `<CR>`

è¿™é‡Œæˆ‘ä»¬å¯¹ç©ºç™½å’Œæ¢è¡Œç¬¦æ²¡æœ‰ä»»ä½•çš„å¤„ç†ï¼Œæ‰€ä»¥è¯æ³•åˆ†æé˜¶æ®µä¼šç›´æ¥ä¸¢å¼ƒã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ26ï¼‰</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/11/ae/e9/48703ee9.jpg" width="30px"><span>Rango</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è¿™è¾¹æŠŠä¸­ç¼€è¡¨è¾¾å¼è§£ææˆåç¼€è¡¨è¾¾å¼ä¼šä¸ä¼šæ›´å®¹æ˜“ç†è§£ä¸€ç‚¹ï¼Ÿ</div>2019-06-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/35/d0/f2ac6d91.jpg" width="30px"><span>é˜¿æˆ</span> ğŸ‘ï¼ˆ29ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>* ä»¥å‰æˆ‘åªå¤§æ¦‚äº†è§£ä¸€èˆ¬çš„åšæ³•æ˜¯æ¶ˆé™¤æ–‡æ³•ä¸­çš„å·¦é€’å½’ï¼Œè¿™ä¸€è¯¾è®©æˆ‘çŸ¥é“åŸæ¥è¿˜å¯ä»¥é€šè¿‡â€œå±‚å±‚å±•å¼€â€å»å¤„ç†ã€‚
* è¯æ³•åˆ†ææˆ‘å°è¯•äº†æ­£åˆ™çš„æ–¹å¼
* æ‹¬å·çš„å¤„ç†è´¹äº†äº›æ—¶é—´ï¼Œè¿™é‡Œæˆ‘æ˜¯ä¿®æ”¹äº†æ–‡æ³•ï¼ˆæ„Ÿè§‰æˆ‘çš„ Expression äº§ç”Ÿå¼[åœ¨æºç æ³¨é‡Šé‡Œ]æ€ªæ€ªçš„ï¼Œå¸Œæœ› winter è€å¸ˆæœ‰æ—¶é—´çš„è¯å¯ä»¥æŒ‡ç‚¹ä¸€ä¸‹ï¼‰ï¼Œå¦ä¸€ç§åšæ³•æ˜¯ï¼Œå…ˆæŠŠä¸­ç¼€è¡¨è¾¾å¼å˜æˆå‰ç¼€è¡¨è¾¾å¼
* å­¦ä¹ ä¸€äº›ç¼–è¯‘åŸç†çš„çŸ¥è¯†è¿˜æ˜¯å¾ˆæœ‰å¿…è¦ä¹Ÿå¾ˆæœ‰è¶£çš„ï¼Œå¯ä»¥å»å†™ä¸€äº›webpackçš„loaderå•Šï¼Œæ’ä»¶å•Šï¼Œvscodeçš„æ’ä»¶ç­‰ç­‰
https:&#47;&#47;github.com&#47;aimergenge&#47;arithmetic-executor</div>2019-03-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/21/30/8ecce1e1.jpg" width="30px"><span>åŒ—å¤©é­”ç‹¼</span> ğŸ‘ï¼ˆ17ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<div>æ„Ÿè§‰æ¯ä¸€ç¯‡éƒ½éœ€è¦çœ‹ä¸‰éï¼Œæ‰èƒ½çœ‹æ‡‚ä¸€ç‚¹å†™çš„æ˜¯å•¥ã€‚åç«¯å…¥è¡Œï¼Œå¤§å‰ç«¯ï¼Œå…¨æ ˆï¼Œæ¶æ„å¸ˆã€‚è·¯è¿˜å¾ˆé•¿ï¼Œæ¥¼ä¸Šçš„ï¼šæ—¥æ‹±ä¸€å’ï¼Œå…±å‹‰</div>2019-07-09</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoLw2qjwoaVCDq8BqCcXOibyTG3rxiaJlDy2lt62IkiaDrrHeVwq4Pe8RpBbYJTIiadyicZ7InBCLCjJtQ/132" width="30px"><span>Bojack</span> ğŸ‘ï¼ˆ7ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>å®ç°äº†å°æ•°ä¸è´Ÿæ•°çš„ç¼–è¯‘å™¨ https:&#47;&#47;gist.github.com&#47;OPY-bbt&#47;8ee387122550326f60592b94b7908d19</div>2019-03-24</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/EJZoM46wR6QqTeibhPZsO5wJTeUia4RndGicWfDZLw153WibjsnJXqEtGZICxAa8icb36pDkficTic3FViaySd1z9HmQBw/132" width="30px"><span>ç¿°å¼Ÿ</span> ğŸ‘ï¼ˆ7ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>æ—¥æ‹±ä¸€å’</div>2019-03-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/36/84/e19b05dd.jpg" width="30px"><span>ç¼ºä¸ªè±†é¥¼å—</span> ğŸ‘ï¼ˆ5ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>ä¹‹å‰å†™äº†ä¸€ä¸ªJSçš„ç¼–è¯‘å™¨çš„è¯æ³•å’Œè¯­æ³•åˆ†æã€‚å¯ä»¥å¤„ç†å˜é‡å£°æ˜ï¼ŒåŠ å‡ä¹˜é™¤è¿ç®—åŠèµ‹å€¼è¿ç®—ã€‚
https:&#47;&#47;github.com&#47;yuguomin&#47;my-compiler</div>2019-12-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/fd/c5/1f13bed2.jpg" width="30px"><span>chang.xu</span> ğŸ‘ï¼ˆ5ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>æ ‡è®°ï¼Œéœ€è¦åŸºç¡€å†å›æ¥</div>2019-08-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/f8/3b/a338f925.jpg" width="30px"><span>ä¸€æ¡ä¸ä¼šæŒ£æ‰çš„å’¸é±¼ğŸŸ</span> ğŸ‘ï¼ˆ5ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>æƒ³é—®ä¸‹è€å¸ˆæœ‰æ²¡æœ‰æ¨èçš„å›½å¤–è®ºå›|YouTubeä½œè€…|ä¸ªäººåšå®¢</div>2019-03-21</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/BWDhMILusuficY2zo10KiaetDPjW08aBJ5sn7cLy2VV91hicacriaibDoqDAexLc0Mr4fnwpbllOLZ0BEFib3tic5WtHA/132" width="30px"><span>Geek_e6f5a9</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>æ„Ÿè§‰åƒåœ¨çœ‹å¤©ä¹¦ğŸ˜­ï¼Œç‰¹åˆ«æ˜¯è§£æExpressionæ±‚closureé‚£éƒ¨åˆ†ä»£ç ï¼Œè¯·é—®winterè€å¸ˆå­¦ä¹ è¿™ä¸ªçš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿæ€æ ·æ‰èƒ½çœ‹æ‡‚ï¼Ÿ</div>2020-12-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/31/4b/0f5b3a0a.jpg" width="30px"><span>Glee</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>æ—¥æ‹±ä¸€å’</div>2019-10-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/f6/a1/debef255.jpg" width="30px"><span>çˆ±çš„ç¥</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>å¤§ä¸‰æ­£åœ¨å­¦ä¹ ç¼–è¯‘åŸç†ï¼Œç›®å‰ä»…èƒ½çœ‹æ‡‚è¯æ³•åˆ†æé‚£äº›ï¼Œåé¢è¿˜ä¸èƒ½çœ‹æ‡‚ã€‚è¡¥å…¨äº†emmitTokenå‡½æ•°ã€‚
var tokens = []
emmitToken(typeï¼Œvalue){
   tokens.push({
      type :  typeï¼Œ
      value:  value
   })
}
ä¸çŸ¥é“å¯¹ä¸å¯¹ğŸ¤”</div>2019-03-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/1f/86/3a7eeac4.jpg" width="30px"><span>leslee</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>BNF é‚£é‡Œæœ‰æ²¡æœ‰è¯¦ç»†ä¸€ç‚¹çš„èµ„æ–™å‘¢ æˆ–è€…æœ‰æ²¡æœ‰æ›´åŠ é€šä¿—çš„å†™æ³•ï¼Ÿ çœ‹ä¸æ‡‚äº†â€¦â€¦</div>2019-03-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/bd/ac/c9154dfe.jpg" width="30px"><span>Huayra</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>ç¡¬å•ƒé¾™ä¹¦ï¼Œå¯¹ç¼–ç¨‹è¯­è¨€çš„ç†è§£æ›´ä¸Šä¸€å±‚æ¥¼</div>2019-03-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/c4/ad/79b8a12c.jpg" width="30px"><span>ä¸€æ­¥</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>è¿™è¯¾ç¨‹æ˜¯åœ¨æŠŠç®€å•çš„çŸ¥è¯†è®²å¤æ‚äº† å¤æ‚çš„çŸ¥è¯†è®²æŠ½è±¡äº†äº†å§ã€‚ã€‚ã€‚</div>2024-01-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/80/5d/b870bb08.jpg" width="30px"><span>ä»æ–°å¼€å§‹</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>æ—¥æ‹±ä¸€å’</div>2020-12-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/84/04/4607749e.jpg" width="30px"><span>å¤šå¤š</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>é€šè¿‡Symbol(&#39;EOF&#39;)æ€ä¹ˆæ‹¿åˆ°&#39;EOF&#39;ï¼Ÿæ˜¯ä¸æ˜¯åº”è¯¥ç”¨Symbol.for(&#39;EOF&#39;)ï¼Ÿ</div>2019-12-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/c7/dc/9408c8c2.jpg" width="30px"><span>ban</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆï¼Œåšåç«¯çš„æ„Ÿè§‰è¶Šåˆ°åé¢è¶Šçœ‹ä¸åˆ°ï¼Œè¯·é—®è¯¥æ€ä¹ˆåšï¼Œæ±‚è§£</div>2019-03-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2e/f9/8a/791d0f5e.jpg" width="30px"><span>kkkä¸¶kk</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>æ„Ÿè§‰å’Œå‰ç«¯çš„æ¨¡æ¿å¼•æ“å·®ä¸å¤šï¼Œéƒ½æ˜¯ä»å­—ç¬¦ä¸²è§£æåˆ°tokenï¼Œæœ€åå†è§£ætoken</div>2022-08-08</li><br/><li><img src="" width="30px"><span>æœ¨å­ææ</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>ä¸€ç¯‡æ›´æ¯”ä¸€ç¯‡éš¾</div>2022-02-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/21/31/1c/51f4d08e.jpg" width="30px"><span>zly</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>
&#47;**
 * numberè½¬MultiplicativeExpressionå¯¹è±¡åï¼Œåˆ¤æ–­æ˜¯å¦æœ‰ä¹˜é™¤ï¼Œæœ‰å°±åˆæˆæ–°çš„MultiplicativeExpression
 * @param {Token[]} tokenList
 *&#47;
function MultiplicativeExpression(tokenList: Token[]): Token {
  let first = tokenList[0];
  let second = tokenList[1];
  if (first.type == &quot;number&quot;) {
    let newToken: Token = {
      type: &quot;MultiplicativeExpression&quot;,
      children: [first],
    };
    tokenList[0] = newToken;
  } else if (
    first.type == &quot;MultiplicativeExpression&quot; &amp;&amp;
    second &amp;&amp;
    (second.type == &quot;&#47;&quot; || second.type == &quot;*&quot;)
  ) {
    let newToken: Token = {
      type: &quot;MultiplicativeExpression&quot;,
      operating: second.type,
      children: [],
    };
    newToken.children.push(tokenList.shift());
    tokenList.shift();
    newToken.children.push(tokenList.shift());
    tokenList.unshift(newToken);
  } else if (first.type == &quot;MultiplicativeExpression&quot;) {
    return first;
  }
  return MultiplicativeExpression(tokenList);
}

&#47;**
 * æ ¹æ®astè¯­æ³•æ ‘è¿›è¡Œè®¡ç®—å¹¶è¿”å›ç»“æœ
 * @param {Token[]} tokenList
 *&#47;
function executeTree(token: Token): number {
  if (token.type == &quot;number&quot;) {
    return Number(token.value);
  }
  let first = token.children[0];
  let second = token.children[1];
  if (token.type == &quot;AdditiveExpression&quot;) {
    if (token.operating) {
      let firstResult = executeTree(first);
      let secondResult = second ? executeTree(second) : 0;
      return firstResult + (token.operating == &quot;-&quot; ? -1 : 1) * secondResult;
    } else {
      return executeTree(first);
    }
  }
  if (token.type == &quot;MultiplicativeExpression&quot;) {
    let firstResult = executeTree(first);
    if (token.operating == &quot;&#47;&quot;) {
      return firstResult &#47; (second ? executeTree(second) : 1);
    } else if (token.operating == &quot;*&quot;) {
      return firstResult * (second ? executeTree(second) : 1);
    } else {
      return firstResult;
    }
  }
  if (token.type == &quot;Expression&quot;) {
    return executeTree(first);
  }
}

&#47;&#47;test code
let result = arithmeticEval(&quot;1.4+2.2*3+3&#47;3&quot;);
&#47;&#47;expected value
console.log(result);
9;
</div>2020-09-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/21/31/1c/51f4d08e.jpg" width="30px"><span>zly</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>&#47;**
 * MultiplicativeExpressionå¯¹è±¡è½¬AdditiveExpressionå¯¹è±¡åï¼Œåˆ¤æ–­æ˜¯å¦æœ‰åŠ å‡ï¼Œæœ‰åŠ å‡å°±åˆæˆæ–°çš„AdditiveExpression
 * @param {Token[]} tokenList
 *&#47;
function AdditiveExpression(tokenList: Token[]): Token {
  let first = tokenList[0];
  let second = tokenList[1];
  if (first.type == &quot;MultiplicativeExpression&quot;) {
    let newToken: Token = {
      type: &quot;AdditiveExpression&quot;,
      children: [first],
    };
    tokenList[0] = newToken;
  } else if (
    first.type == &quot;AdditiveExpression&quot; &amp;&amp;
    second &amp;&amp;
    (second.type == &quot;+&quot; || second.type == &quot;-&quot;)
  ) {
    let newToken: Token = {
      type: &quot;AdditiveExpression&quot;,
      operating: second.type,
      children: [],
    };
    newToken.children.push(tokenList.shift());
    tokenList.shift();
    MultiplicativeExpression(tokenList);
    newToken.children.push(tokenList.shift());
    tokenList.unshift(newToken);
  } else if (first.type == &quot;AdditiveExpression&quot;) {
    return first;
  } else {
    MultiplicativeExpression(tokenList);
  }
  return AdditiveExpression(tokenList);
}</div>2020-09-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/21/31/1c/51f4d08e.jpg" width="30px"><span>zly</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>&#47;&#47;åˆæ­¥ç›®æ ‡ï¼šä¸å¸¦æ‹¬å·çš„åŠ å‡ä¹˜é™¤çš„å››åˆ™è¿ç®—æ‰§è¡Œå™¨
type Operating = &quot;+&quot; | &quot;-&quot; | &quot;*&quot; | &quot;&#47;&quot;;

type TokenType =
  | &quot;number&quot;
  | &quot;EOF&quot;
  | &quot;MultiplicativeExpression&quot;
  | &quot;AdditiveExpression&quot;
  | &quot;Expression&quot;
  | Operating;

interface Token {
  type: TokenType;
  value?: string;
  children?: Token[];
  operating?: Operating;
}
&#47;&#47;tokenæ•°
let tokenList: Token[] = [];
let numberToken = [&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;, &quot;0&quot;, &quot;.&quot;];
let operatingToken: string[] = [&quot;+&quot;, &quot;-&quot;, &quot;&#47;&quot;, &quot;*&quot;];
&#47;**
 * è‡ªå·±å®ç°å››åˆ™è¿ç®—çš„ä¸€ä¸ªevalæ‰§è¡Œå™¨
 *
 * @param {string} str
 *&#47;
function arithmeticEval(str: string): number {
  tokenList = [];
  let tokenStateMachine = new TokenStateMachine(str);
  tokenStateMachine.lexicalAnalysis();
  tokenList.push({ type: &quot;EOF&quot; });
  let tree = Expression(tokenList);
  let result = executeTree(tree);
  return result;
}

&#47;**
 * tokençŠ¶æ€æœº
 * @class TokenStateMachine
 *&#47;
class TokenStateMachine {
  state: () =&gt; void;
  index: number = 0;
  str: string;
  numberStr = &quot;&quot;;
  constructor(str: string) {
    this.str = str;
    this.index = 0;
    this.state = this.start;
  }
  &#47;**
   *  è¯æ³•åˆ†æ
   * @memberof TokenStateMachine
   *&#47;
  lexicalAnalysis() {
    while (this.index &lt;= this.str.length) {
      this.state();
    }
  }
  start() {
    let key = this.str[this.index];
    if (numberToken.includes(key)) {
      this.numberStr = &quot;&quot;;
      this.numberStr += key;
      this.state = this.number;
    } else if (operatingToken.includes(key)) {
      emitToken(key as TokenType, key);
    }
    this.index += 1;
  }
  number() {
    let key = this.str[this.index];
    if (numberToken.includes(key)) {
      this.numberStr += key;
      this.index += 1;
    } else {
      emitToken(&quot;number&quot;, this.numberStr);
      this.state = this.start;
    }
  }
}
&#47;**
 * è§¦å‘tokenï¼Œå¢åŠ tokenåˆ°tokenæ ‘ä¸­
 * @param {TokenType} tokenType
 * @param {string} key
 *&#47;
function emitToken(tokenType: TokenType, key: string) {
  tokenList.push({
    type: tokenType,
    value: key,
  });
}</div>2020-09-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/a5/65/ca607ded.jpg" width="30px"><span>ä¸‰çš®</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>ç¨åå†çœ‹</div>2020-04-11</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/xpAsb3hl87UbMPCkYhgdvC3pSx2WYaic9vu8qibksibttGveDbibohibsicxk0AQayNriciaeV3HYrCEd0dQkp4Q83nTqQ/132" width="30px"><span>é«˜å®å†›</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>ç•™çš„æŒ‘æˆ˜æ˜¯ä¸æ˜¯åªæœ‰æœ€åä¸€ä¸ªæ·»åŠ æ‹¬å·çš„éœ€è¦åœ¨closureé‡Œå¤„ç†ï¼Œå°æ•°å’Œè´Ÿæ•°çš„åœ¨è¯æ³•åˆ†æé‡Œå°±å¯ä»¥ï¼Ÿ</div>2020-03-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/7e/7d/d3345d7f.jpg" width="30px"><span>èŠ¬èŠ¬é¢œ</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>äº§ç”Ÿå¼å¦‚ä¸‹
Expr = Add &lt;EOF&gt;
Add = Multiply | Add + Multiply | Add - Multiply
Multiply = Num | Multiply * Multiply | Multiply &#47; Multiply | ( Add )
Num = æœ‰ç†æ•°

å¯¹äºæ‹¬å·çš„å¤„ç†ï¼Œå…³é”®åœ¨MultiplicativeExpressionæ–¹æ³•ä¸­åˆ¤æ–­è¿ç®—ç¬¦å·¦å³ä¸¤ä¾§çš„å˜é‡æ˜¯å¦ä¸º(Add)
function MultiplicativeExpression(source) {
  if (source[0].type === &quot;Number&quot;) {
    let node = {
      type: &quot;MultiplicativeExpression&quot;,
      children: [source[0]]
    }
    source[0] = node;
    return MultiplicativeExpression(source);
  }
  if (source[0].type === &quot;parentness&quot;) {
    let addExpr = [];
    let i = 0;
    while (i++ &lt; source.length &amp;&amp; source[i].type !== &quot;parenthese&quot;) {
      addExpr.push(source[i]);
    }
    source.splice(0, addExpr.length + 2, AdditiveExpression([...addExpr]));
    source[0].type = &quot;MultiplicativeExpression&quot;;
  }
  if (source[2] &amp;&amp; source[2].type === &quot;parenthese&quot;) {
    let addExpr = [];
    let i = 2;
    while (i++ &lt; source.length &amp;&amp; source[i].type !== &quot;parenthese&quot;) {
      addExpr.push(source[i]);
    }
    source.splice(2, addExpr.length + 2, AdditiveExpression([...addExpr]));
    source[2].type = &quot;MultiplicativeExpression&quot;;
  }
...
</div>2019-05-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/25/f8/4a6062b1.jpg" width="30px"><span>ç–¯äºŒä¸­</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>æ¶¨çŸ¥è¯†äº†ï¼ŒBNFå’ŒLLçœŸæ˜¯ç²¾å¦™</div>2019-03-24</li><br/>
</ul>