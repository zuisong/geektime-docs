ä½ å¥½ï¼Œæˆ‘æ˜¯æ¨æ–‡åšã€‚

ä¸ŠèŠ‚è¯¾ï¼Œæˆ‘ä»¬åŸºäºæœåŠ¡ç«¯çš„çºµå‘å’Œæ¨ªå‘åˆ‡é¢ï¼ŒæŠŠNode.jsæœåŠ¡åŒ–æ•´ä¸ºé›¶ï¼Œåˆ†è§£æˆäº†æœåŠ¡çš„å„ä¸ªæœ€å°é¢—ç²’åº¦æ¨¡å—ï¼›ç„¶åæ ¹æ®è¿™äº›æ¨¡å—é€»è¾‘ï¼Œè®¾è®¡å‡ºä¸¤ç§æ–¹å‘åˆ‡é¢çš„æ‰©å±•è§„èŒƒï¼›æœ€åæ ¹æ®æ‰©å±•è§„èŒƒè®¾è®¡å’ŒæœåŠ¡ç«¯ç»“æ„åˆ†æï¼Œæˆ‘ä»¬è¯¦ç»†å±•ç¤ºäº†æœåŠ¡ç«¯â€œæŠ€æœ¯åº•åº§â€ï¼Œåˆ†æäº†å¦‚ä½•æ ¹æ®æŠ€æœ¯æ¡†æ¶ä¼˜åŠ¿ï¼Œæ›´ä¼˜é›…åœ°æ‰©å±•åŠŸèƒ½ã€‚

åˆ°ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†æ­å»ºåŠŸèƒ½ï¼Œä¹Ÿåšå¥½åŠŸèƒ½æ‰©å±•å·¥ä½œï¼Œé‚£æœåŠ¡ç«¯å¼€å‘æ–¹é¢çš„å·¥ä½œï¼Œæ˜¯å¦èƒ½å‘Šä¸€æ®µè½å‘¢ï¼Ÿ

ç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚è¿˜è®°å¾—å—ï¼Œä¹‹å‰æˆ‘ä»¬åœ¨é˜¶æ®µæ€§å®Œæˆå‰ç«¯é¡µé¢çš„å¼€å‘å·¥ä½œåï¼Œè¿˜ç”¨ä¸€èŠ‚è¯¾çš„æ—¶é—´ï¼Œå­¦ä¹ äº†å¦‚ä½•ä¼˜åŒ–æ­å»ºå¹³å°çš„å‰ç«¯æ€§èƒ½ã€‚æœåŠ¡ç«¯çš„å¼€å‘å·¥ä½œä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œé™¤äº†å®ŒæˆåŠŸèƒ½ï¼Œè¿˜éœ€è¦åšæœåŠ¡ç«¯çš„æ€§èƒ½ä¼˜åŒ–ã€‚

åœ¨å‰ç«¯é¡µé¢æ€§èƒ½ä¼˜åŒ–ä¸­ï¼Œæˆ‘æåˆ°ä¸¤ç§ä¼˜åŒ–æ€è·¯ï¼Œâ€œå‰ç½®ä¼˜åŒ–â€å’Œâ€œåç½®ä¼˜åŒ–â€ã€‚æ— è®ºé€‰æ‹©å“ªç§ä¼˜åŒ–æ€è·¯ï¼Œéƒ½è¦è€ƒè™‘å¸¸è§çš„æ€§èƒ½é—®é¢˜åœºæ™¯ï¼Œä¹Ÿä¸èƒ½â€œè¿‡åº¦è®¾è®¡â€é€ æˆå¼€å‘èµ„æºæµªè´¹ã€‚æ‰€ä»¥ï¼ŒæœåŠ¡ç«¯æ€§èƒ½ä¼˜åŒ–çš„å·¥ä½œï¼Œæˆ‘ä»¬ä¹Ÿè¦å°½é‡â€œå¥½é’¢ç”¨åœ¨åˆ€åˆƒä¸Šâ€ï¼Œä¼˜å…ˆè€ƒè™‘å¤§æ¦‚ç‡çš„æ€§èƒ½åœºæ™¯é—®é¢˜ï¼Œåšå¥½ä¼˜åŒ–å‡†å¤‡ã€‚

é‚£æœåŠ¡ç«¯å¤§æ¦‚ç‡çš„æ€§èƒ½é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ä¼˜åŒ–è§£å†³å‘¢ï¼Ÿæˆ‘ä»¬å¼€å§‹ä»Šå¤©çš„å­¦ä¹ ã€‚

## ä¸ºä»€ä¹ˆNode.jsä¼šå‘ç”Ÿé˜»å¡

æœåŠ¡ç«¯çš„æ€§èƒ½é—®é¢˜ï¼Œè¯´åˆ°åº•å…¶å®å°±æ˜¯æœºå™¨èµ„æºçš„ä½¿ç”¨é—®é¢˜ï¼Œä¸»è¦æ˜¯CPUå’Œå†…å­˜çš„åˆ©ç”¨é—®é¢˜ã€‚é€šå¸¸æœ‰ä¸¤ç§æç«¯æƒ…å†µï¼Œæœºå™¨èµ„æºä¸å¤Ÿç”¨ã€æœºå™¨èµ„æºåˆ©ç”¨ä¸å……åˆ†ï¼Œæˆ‘ä»¬ç»Ÿç§°ä¸ºæœºå™¨èµ„æºä½¿ç”¨ä¸åˆç†ã€‚

å¯¹äºNode.jsæœåŠ¡æ¥è¯´ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæœºå™¨èµ„æºä½¿ç”¨ä¸åˆç†ï¼Œé€šå¸¸ä¼šå¯¼è‡´ç¨‹åºé˜»å¡ã€‚**é‚£ä¸ºä»€ä¹ˆNode.jsä¼šå‘ç”Ÿé˜»å¡é—®é¢˜å‘¢ï¼Ÿ**

Node.jsæ˜¯è¿è¡ŒJavaScriptè¯­è¨€çš„ä¸€ç§ç¯å¢ƒï¼Œè€ŒJavaScriptæ˜¯â€œå•çº¿ç¨‹è¯­è¨€â€ï¼ŒæŒ‰ç…§JavaScriptè¯­æ³•æ‰§è¡Œé€»è¾‘ï¼Œåœ¨Node.jsç¯å¢ƒé‡Œçš„æ‰§è¡Œè¿‡ç¨‹ä¹Ÿæ˜¯å•çº¿ç¨‹çš„ã€‚

æ’å¥é¢˜å¤–è¯ï¼Œè¦æ³¨æ„ï¼Œâ€œå¤šçº¿ç¨‹â€å’Œâ€œå¤šè¿›ç¨‹â€æ˜¯ä¸¤ä¸ªä¸åŒçš„æŠ€æœ¯æ¦‚å¿µï¼Œåˆ«æ··æ·†äº†ã€‚

å¯èƒ½ä½ å¬è¯´è¿‡ï¼Œæµè§ˆå™¨å¯ä»¥ç”¨Web Workers APIå®ç°å¤šçº¿ç¨‹ï¼Œæˆ–è€…Node.jsè‡ªå¸¦äº†å¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹æ¨¡å—ï¼Œä½†æ˜¯è¿™äº›éƒ½ä¸æ˜¯JavaScriptæœ¬èº«çš„æ ‡å‡†èƒ½åŠ›ï¼Œè€Œæ˜¯æµè§ˆå™¨å’ŒNode.jså€ŸåŠ©åº•å±‚çš„èƒ½åŠ›ï¼Œå®ç°å¤šçº¿ç¨‹æˆ–è€…å¤šè¿›ç¨‹ï¼Œå±äºè¿è¡Œç¯å¢ƒæä¾›çš„èƒ½åŠ›ã€‚

å¦‚æœä½ ä¸å¤ªç†è§£ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘ä»¬åé¢ä¼šè®²Node.jså¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹çš„ä½¿ç”¨ï¼Œ**ç°åœ¨ä½ å¯ä»¥ç›´æ¥ç†è§£ï¼Œåœ¨Node.jsç¯å¢ƒé‡Œï¼Œé»˜è®¤å•çº¿ç¨‹æ‰§è¡Œç¨‹åºã€‚**

å¥½ï¼Œè®²å›æ¥ã€‚Node.jsçš„å•çº¿ç¨‹ï¼Œå› ä¸ºçœå»äº†å¤šçº¿ç¨‹é¢‘ç¹åˆ‡æ¢æ“ä½œï¼Œé¿å…å…±äº«èµ„æºå†²çªç­‰é£é™©ï¼Œä¹Ÿæ²¡æœ‰çº¿ç¨‹é”æ“ä½œç­‰ç¹çé€»è¾‘ï¼Œèƒ½è®©æœåŠ¡ç¨‹åºå˜å¾—è½»é‡å’Œç®€ä¾¿ã€‚

ä½ å¯ä»¥ç±»æ¯”æˆâ€œå‘å¿«é€’â€ã€‚å•çº¿ç¨‹å°±æ˜¯ä¸€ä¸ªå¿«é€’å‘˜æ´¾ä»¶ï¼Œä»–çŸ¥é“æ‰€æœ‰åœ°å€ï¼Œäº¤é€šå·¥å…·åªæœ‰è‡ªå·±ç”¨ï¼ŒæŒ‰éƒ¨å°±ç­è¿›è¡Œæ´¾ä»¶ã€‚å¤šçº¿ç¨‹å°±æ˜¯å¤šä¸ªå¿«é€’å‘˜æ´¾ä»¶ï¼Œè™½ç„¶å¤šäººå¹¶è¡Œæ´¾ä»¶ï¼Œä½†æ˜¯è¦åˆ†é…å·¥ä½œäº‹é¡¹ã€å…±ç”¨äº¤é€šå·¥å…·ï¼Œå¢åŠ äº†å¾ˆå¤šâ€œç®¡ç†æˆæœ¬â€ï¼Œç±»ä¼¼å¤šçº¿ç¨‹çš„â€œç¹çæ“ä½œé€»è¾‘â€ã€‚

![](https://static001.geekbang.org/resource/image/b6/4c/b6595844a030b8a5fab2f206006e234c.jpg?wh=4000x2636)

è™½ç„¶å•çº¿ç¨‹ç®¡ç†ç®€å•ï¼Œä½†æ˜¯å› ä¸º**åªæœ‰ä¸€ä¸ªâ€œæ‰§è¡Œå•å…ƒâ€ï¼Œå¦‚æœé‡åˆ°CPUå¯†é›†è®¡ç®—çš„æ‰§è¡Œæµç¨‹ï¼Œå°±ä¼šè¢«é˜»æ–­ä½ï¼Œå¯¼è‡´åç»­ç¨‹åºå†…å®¹æ‰§è¡Œä¸äº†**ï¼Œè¿™å°±æ˜¯Node.jså‘ç”Ÿé˜»å¡çš„åŸå› ã€‚

è¿™ä¹ˆæè¿°æœ‰ç‚¹æŠ½è±¡ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ªå®é™…çš„Node.jsæœåŠ¡ä»£ç æ¡ˆä¾‹ã€‚

```typescript
// demos/http.cjs
const Koa = require('Koa');
const Router = require('@koa/router');

const app = new Koa();
const router = new Router();
const port = 9001;

router.get('/001', async (ctx) => {
  ctx.body = '<div>æ™®é€šé¡µé¢ç»“æœ</div>';
});

router.get('/002', async (ctx) => {
  let count = 0;
  for (let i = 0; i < 9999999999; i++) {
    count++;
  }
  ctx.body = `<div>CPUå¯†é›†è®¡ç®—æ•°æ® - å…±[${count}]æ¬¡è®¡ç®—</div>`;
});

app.use(router.routes());

app.listen(port, () => {
  console.log('æœåŠ¡å·²å¯åŠ¨');
  console.log(`è®¿é—®æ™®é€šè¯·æ±‚ http://127.0.0.1:${port}/001`);
  console.log(`è®¿é—®CPUå¯†é›†è®¡ç®—è¯·æ±‚ http://127.0.0.1:${port}/002`);
});

```

è¿™æ®µä»£ç æ˜¯ä¸€ä¸ªç®€å•çš„Koa.jså®ç°çš„Node.jsæœåŠ¡ï¼Œæä¾›äº†ä¸¤ä¸ªHTTPé¡µé¢ï¼Œé¡µé¢è·¯å¾„åˆ†åˆ«æ˜¯ â€œ/001â€å’Œâ€œ/002â€ã€‚å…¶ä¸­ï¼Œè·¯å¾„â€œ/001â€è¯·æ±‚æ˜¯æ™®é€šçš„HTMLé¡µé¢ï¼Œè·¯å¾„â€œ/002â€è¯·æ±‚æ˜¯ç»è¿‡ä¹åå¤šäº¿æ¬¡è®¡ç®—åæ‰å“åº”çš„HTMLé¡µé¢ã€‚è¿™é‡Œï¼Œä¹åå¤šäº¿æ¬¡çš„è®¡ç®—å±äºCPUå¯†é›†è®¡ç®—ï¼Œåœ¨è¿™ä¸ªç¯èŠ‚ï¼ŒNode.jså•çº¿ç¨‹æœåŠ¡ä¼šè¢«é˜»å¡ä½ï¼Œç›´åˆ°è¢«å ç”¨CPUçš„èµ„æºè¢«é‡Šæ”¾ã€‚

æˆ‘ä»¬å†™ä¸€ä¸ªè¯·æ±‚HTTPè„šæœ¬ï¼Œè¯·æ±‚è¿™ä¸¤ä¸ªè·¯å¾„ï¼ŒéªŒè¯ä¸€ä¸‹æ•ˆæœã€‚

é¦–å…ˆæ˜¯å•ç‹¬è¯·æ±‚æ™®é€šHTMLé¡µé¢è·¯å¾„â€œ/001â€ã€‚

```typescript
// demos/http-get.cjs
// å•ç‹¬è¯·æ±‚ /001
const start = Date.now();
fetch('http://127.0.0.1:9001/001')
  .then((res) => res.text())
  .then(() => {
    console.log(`/001 è¯·æ±‚è€—æ—¶ ${Date.now() - start}ms`);
  });
```

åœ¨Node.jsç¯å¢ƒæ‰§è¡Œè¿™æ®µä»£ç ï¼Œç»“æœå°±æ˜¯è¿™å¼ æˆªå›¾ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/f1/88/f139ccca916fe190e8bba53df3bba288.png?wh=1390x438)

å¯ä»¥çœ‹å‡ºï¼Œè·¯å¾„ä¸ºâ€œ/001â€æ™®é€šé¡µé¢è¯·æ±‚å¤„ç†ï¼Œå¤§æ¦‚éœ€è¦å‡ åæ¯«ç§’è€—æ—¶ã€‚

æ¥ä¸‹æ¥æ¢æˆå•ç‹¬è¯·æ±‚CPUå¯†é›†è®¡ç®—è·¯å¾„â€œ/002â€ã€‚

```typescript
// demos/http-get.cjs
// å•ç‹¬è¯·æ±‚ /002
const start = Date.now();
fetch('http://127.0.0.1:9001/002')
  .then((res) => res.text())
  .then(() => {
    console.log(`/002 è¯·æ±‚è€—æ—¶ ${Date.now() - start}ms`);
  });
```

åœ¨Node.jsç¯å¢ƒæ‰§è¡Œä»£ç ï¼Œç»“æœå°±æ˜¯è¿™æ ·ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/4f/6f/4f5fe90ea2f19b1yy69c78340af8056f.png?wh=1390x438)

ä»æˆªå›¾å¯ä»¥çœ‹å‡ºï¼Œè·¯å¾„ä¸ºâ€œ/002â€CPUå¯†é›†è®¡ç®—è¯·æ±‚å¤„ç†ï¼Œå¤§æ¦‚éœ€è¦ä¸€ä¸‡å¤šæ¯«ç§’çš„è€—æ—¶ï¼Œä¹Ÿå°±æ˜¯ä¹åäº¿çš„åŠ æ³•è®¡ç®—ï¼Œåœ¨æˆ‘æœ¬åœ°ç”µè„‘ä¸­ï¼Œæ˜¯åå‡ ç§’çº§åˆ«çš„å»¶æ—¶ã€‚

ç°åœ¨æœ‰ä¸¤ä¸ªè·¯å¾„çš„å•ç‹¬è¯·æ±‚è€—æ—¶ï¼Œæˆ‘ä»¬æ¥æ¨¡æ‹Ÿä¸€ä¸‹åŒæ—¶è¯·æ±‚æ“ä½œï¼ŒéªŒè¯é˜»å¡çš„æ•ˆæœã€‚

```typescript
// demos/http-get.cjs
// æ¨¡æ‹Ÿå¹¶å‘è¯·æ±‚ä¸¤ç§è·¯å¾„
const startFor002 = Date.now();
console.log('å¼€å§‹æ‰§è¡Œè¯·æ±‚ /002 ...');
fetch('http://127.0.0.1:9001/002')
  .then((res) => res.text())
  .then(() => {
    console.log(`/002 è¯·æ±‚è€—æ—¶ ${Date.now() - startFor002}ms`);
  });

const startFor001 = Date.now();
console.log('å¼€å§‹æ‰§è¡Œè¯·æ±‚ /001 ...');
fetch('http://127.0.0.1:9001/001')
  .then((res) => res.text())
  .then(() => {
    console.log(`/001 è¯·æ±‚è€—æ—¶ ${Date.now() - startFor001}ms`);
  });
```

æ‰§è¡Œä»£ç åï¼Œçœ‹ç»“æœçš„æˆªå›¾ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/bb/bc/bb27c5a6a5a9bafeeb2ee9624d4936bc.png?wh=1390x538)

å¯ä»¥çœ‹å‡ºï¼Œå…ˆè¯·æ±‚CPUå¯†é›†è®¡ç®—çš„â€œ/002â€è·¯å¾„ï¼Œä¼šé˜»å¡ä½åé¢æ™®é€šé¡µé¢çš„â€œ/001â€è·¯å¾„è¯·æ±‚ï¼Œå¯¼è‡´åŸæœ¬â€œ/001â€è¯·æ±‚ä»è€—æ—¶å‡ åæ¯«ç§’ä¸Šå‡åˆ°åå‡ ç§’ï¼Œç¬é—´ä»â€œæ¯«ç§’çº§â€é™çº§åˆ°â€œç§’çº§â€ã€‚

ä¸è¿‡ï¼Œä½ å¯èƒ½ä¼šæœ‰ç–‘é—®ï¼Œæˆ‘ä»¬è¿™ä¸ªä»£ç æ¡ˆä¾‹é‡Œå‡ åäº¿çš„åŠ æ³•è®¡ç®—ï¼Œå·²ç»æ˜¯å¤©æ–‡æ•°é‡çº§åˆ«äº†ï¼Œç°å®å·¥ä½œä¼šé‡åˆ°è¿™ç±»åœºæ™¯å—ï¼Ÿ

å¥½é—®é¢˜ï¼Œç°å®å·¥ä½œé‡Œï¼Œæˆ‘ä»¬ç¡®å®å¾ˆå°‘ç¢°åˆ°â€œå‡ åäº¿â€çº§åˆ«çš„è®¡ç®—é‡ï¼Œä½†æ˜¯å¯¼è‡´CPUå¯†é›†è®¡ç®—ä¸åªè¿™ä¸€ä¸ªåŸå› ï¼Œè¿˜å¯èƒ½æ˜¯å¤šä¸ªå¹¶å‘æ“ä½œç´¯ç§¯å¯¼è‡´çš„ã€‚ä¾‹å¦‚ï¼Œåœ¨Vue.jsçš„æœåŠ¡ç«¯æ¸²æŸ“åœºæ™¯ï¼Œéœ€è¦åœ¨æœåŠ¡è¿›è¡ŒHTMLå­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œï¼Œè¿™ä¹Ÿå ç”¨CPUè®¡ç®—èµ„æºã€‚å¦‚æœç¢°åˆ°HTMLå­—ç¬¦ä¸²è®¡ç®—å¤æ‚çš„æƒ…å†µï¼Œå†å åŠ å¹¶å‘è¯·æ±‚è¿‡å¤šï¼Œå°±å¾ˆå®¹æ˜“å¯¼è‡´æœåŠ¡è¯·æ±‚è¢«é˜»å¡ã€‚

æ‰€ä»¥ï¼Œ**Node.jsæœåŠ¡ä¸­ä¸€æ—¦å‡ºç°å¯†é›†è®¡ç®—çš„è¿‡ç¨‹ï¼Œå°±å®¹æ˜“å¯¼è‡´é˜»å¡é—®é¢˜ï¼Œé˜»å¡äº†åç»­è¯·æ±‚è¿‡ç¨‹ï¼Œå¯¼è‡´å¹¶å‘é—®é¢˜**ã€‚è¿™ç±»WebæœåŠ¡çš„å¯†é›†è®¡ç®—åœºæ™¯ï¼Œå…¶å®å¾ˆå¸¸è§ï¼Œæˆ‘ä»¬ä¹Ÿé¿å…ä¸äº†çš„ã€‚

é‚£ä¹ˆæœ‰æ²¡æœ‰åŠæ³•ï¼Œæ¥è§£å†³è¿™ç±»é—®é¢˜å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æœ‰çš„ï¼Œå°±æ˜¯åˆ©ç”¨å¤šè¿›ç¨‹æˆ–å¤šçº¿ç¨‹ã€‚

## ä»€ä¹ˆæ˜¯è¿›ç¨‹å’Œçº¿ç¨‹

ç›¸ä¿¡ä½ åœ¨æ—¥å¸¸å·¥ä½œæˆ–è€…å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œä¸€å®šå¬è¯´â€œçº¿ç¨‹â€å’Œâ€œè¿›ç¨‹â€ï¼Œä½†æ˜¯å¾ˆå¤šäººä¼šæ··æ·†è¿™ä¸¤ä¸ªæŠ€æœ¯è¯æ±‡ã€‚å®é™…ä¸Šï¼Œçº¿ç¨‹å’Œè¿›ç¨‹æ˜¯ä¸åŒçš„æŠ€æœ¯æ¦‚å¿µï¼Œä½†æ˜¯ä¸¤è€…ä¹Ÿæœ‰ä¸€å®šæŠ€æœ¯å…³ç³»ã€‚

è¿›ç¨‹ï¼Œè‹±æ–‡ç§°ä¸ºProcessï¼Œæ˜¯è®¡ç®—æœºç³»ç»Ÿé‡Œè°ƒåº¦å’Œåˆ†é…èµ„æºçš„å•ä½ï¼Œä¹Ÿæ˜¯çº¿ç¨‹çš„è¿è¡Œçš„å®¿ä¸»å®¹å™¨ã€‚

çº¿ç¨‹ï¼ŒThreadï¼Œæ˜¯è®¡ç®—æœºç³»ç»Ÿé‡Œè¿ç®—çš„æœ€å°å•ä½ï¼Œåœ¨è¿›ç¨‹ä¸­è¿è¡Œï¼Œä¹Ÿæ˜¯è¿›ç¨‹ä¸­å®é™…è¿è¡Œç¨‹åºçš„å•ä½ã€‚æˆ‘ä»¬ç»å¸¸æåˆ°çš„â€œå¤šçº¿ç¨‹â€ï¼Œå°±æ˜¯æŒ‡åœ¨â€œåŒä¸€è¿›ç¨‹â€é‡Œï¼Œæœ‰â€œå¤šä¸ªçº¿ç¨‹â€æ¥æ‰§è¡Œç¨‹åºï¼Œå¹¶ä¸”å…±äº«â€œåŒä¸€è¿›ç¨‹åˆ†é…çš„èµ„æºâ€ã€‚

å¬èµ·æ¥æœ‰ç‚¹æŠ½è±¡ï¼Œæˆ‘ä»¬è¿˜æ˜¯ç”¨â€œå‘å¿«é€’â€çš„ä¾‹å­æ¥ç±»æ¯”â€œå¤šè¿›ç¨‹â€å’Œâ€œå¤šçº¿ç¨‹â€ã€‚

![](https://static001.geekbang.org/resource/image/3f/64/3f809086yy1b38e010d4c61369d5b364.jpg?wh=4000x2636)

å¦‚æœæŠŠè®¡ç®—æœºç³»ç»Ÿç±»æ¯”æˆä¸€ä¸ªåŸå¸‚çš„å¿«é€’ä½“ç³»ï¼Œé‚£ä¹ˆï¼š

- è¿›ç¨‹ï¼Œå°±æ˜¯åŸå¸‚é‡Œæ¯ä¸€ä¸ªå¿«é€’ç‚¹ï¼Œå¯ä»¥è°ƒåº¦å’Œåˆ†é…å¿«é€’çš„è¿åŠ›èµ„æºã€‚
- çº¿ç¨‹ï¼Œå°±æ˜¯å¿«é€’ç‚¹é‡Œçš„å¿«é€’å‘˜ï¼Œæ˜¯å®é™…å¿«é€’ç‚¹æ‰§è¡Œé…é€å¿«é€’çš„æœ€å°å•å…ƒã€‚

è¿™ä¸ªåŸå¸‚æœ‰å¤šä¸ªå¿«é€’ç‚¹åŒæ—¶æ‰§è¡Œå¿«é€’è¿è¾“ï¼Œå°±åƒä¸€ä¸ªè®¡ç®—æœºç³»ç»Ÿé‡Œå¤šè¿›ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡ã€‚æ¯ä¸ªå¿«é€’ç‚¹ï¼ŒåŒæ—¶æœ‰å¤šä¸ªå¿«é€’å‘˜è¿›è¡Œå¿«ä»¶é…é€ï¼Œå°±åƒåŒä¸ªè¿›ç¨‹ï¼Œå¯ä»¥å¤šçº¿ç¨‹æ‰§è¡Œç¨‹åºä»»åŠ¡ï¼Œè€Œä¸”ï¼Œæ¯ä¸ªå¿«é€’å‘˜æ‰§è¡Œçš„æ˜¯æœ€åçš„é€ä»¶å·¥ä½œï¼Œæ„å‘³ç€çº¿ç¨‹æ˜¯æœ€å°è¿è¡Œå•å…ƒã€‚

åŒä¸ªå¿«é€’ç‚¹ï¼Œæ‰€æœ‰å¿«é€’å‘˜ï¼Œå¯ä»¥äº’ç›¸å…±äº«äº¤é€šå·¥å…·ï¼Œç±»ä¼¼**çº¿ç¨‹ä¹‹é—´å¯ä»¥å…±ç”¨èµ„æº**ï¼Œä¾‹å¦‚å†…å­˜ç­‰ã€‚

ä¸åŒå¿«é€’ç«™ç‚¹ï¼Œè´£ä»»åˆ†æ˜ï¼Œäº¤é€šå·¥å…·ä¸èƒ½è·¨ç«™ç‚¹å…±ç”¨ï¼Œç±»ä¼¼è¿›ç¨‹ä¹‹é—´çš„èµ„æºä¸èƒ½å…±ç”¨ã€‚è™½ç„¶ä¸èƒ½å…±ç”¨äº¤é€šå·¥å…·ï¼Œä½†æ˜¯ï¼Œä¸åŒå¿«é€’ç«™ç‚¹ï¼Œå¯ä»¥äº’ç›¸è”ç³»å‘ŠçŸ¥å·¥ä½œæƒ…å†µï¼Œç±»ä¼¼**è¿›ç¨‹ä¹‹é—´è™½ç„¶ä¸èƒ½å…±äº«èµ„æºï¼Œä½†æ˜¯å¯ä»¥è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ï¼Œå…¨ç§° InterProcess communicationï¼Œç®€ç§°IPC**ã€‚

![](https://static001.geekbang.org/resource/image/0e/fd/0ef5192b94998360e43609cf298738fd.jpg?wh=4000x2636)

ç†æ¸…äº†è¿›ç¨‹å’Œçº¿ç¨‹ï¼Œæˆ‘ä»¬å›åˆ°è¯¾ç¨‹Vue.jså’ŒNode.jsçš„å…¨æ ˆé¡¹ç›®é‡Œï¼Œç”¨Koa.jsæ­å»ºWebæœåŠ¡ï¼Œå¤§æ¦‚ç‡é‡åˆ°çš„CPUå¯†é›†è®¡ç®—çš„åœºæ™¯ï¼Œä¸»è¦é›†ä¸­åœ¨æœåŠ¡ç«¯æ¸²æŸ“ç¯èŠ‚ï¼Œä¹Ÿå°±æ˜¯åœ¨æœåŠ¡ç«¯è¿è¡ŒVue.jsä»£ç ï¼Œé€šè¿‡è®¡ç®—å’Œæ‹¼æ¥å­—ç¬¦ä¸²ï¼Œæ¥ç”ŸæˆHTMLå†…å®¹ã€‚

å¦‚æœè¿™ä¸ªé¡µé¢çš„HTMLç»“æ„éå¸¸å¤æ‚ï¼Œè¯·æ±‚é¡µé¢çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯å°±ä¼šæ‰§è¡ŒVue.jsä»£ç ï¼Œè¿›è¡Œå¤§é‡HTMLå­—ç¬¦ä¸²æ‹¼æ¥è®¡ç®—ï¼Œå±äºCPUçš„å¯†é›†è®¡ç®—ã€‚è¿™ä¸ªæ—¶å€™ï¼Œé»˜è®¤Node.jsæœåŠ¡åªæœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿›ç¨‹é‡Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯å•è¿›ç¨‹å•çº¿ç¨‹æœåŠ¡ã€‚å¦‚æœé¡µé¢å†å åŠ ä¸Šå¹¶å‘è¯·æ±‚ï¼Œå°±å¯èƒ½é€ æˆé˜»å¡é—®é¢˜ã€‚

ç°åœ¨æˆ‘ä»¬è§£å†³çš„åŠæ³•å°±æ˜¯ï¼Œåˆ©ç”¨å¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹æ¥å¹¶è¡Œæ‰§è¡Œä»»åŠ¡ï¼Œç¼“è§£å¯†é›†è®¡ç®—çš„ä»»åŠ¡å‹åŠ›ï¼Œé¿å…å‘ç”Ÿé˜»å¡æˆ–å¹¶å‘é—®é¢˜ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•åœ¨Node.jsæœåŠ¡ä¸­ä½¿ç”¨å¤šè¿›ç¨‹æˆ–å¤šçº¿ç¨‹å‘¢ï¼Ÿ

## å¦‚ä½•ä½¿ç”¨Node.jsçš„å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹

å‰é¢æè¿‡ï¼Œç›®å‰Node.jså¤©ç„¶æä¾›äº†è¿›ç¨‹å’Œçº¿ç¨‹çš„æ§åˆ¶æ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚

æƒ³å‘æŒ¥å¤šçº¿ç¨‹å¤šè¿›ç¨‹çš„ä¼˜åŠ¿ï¼Œé¦–å…ˆè¦æœ‰ç“¶é¢ˆåœºæ™¯ï¼Œé‚£æˆ‘ä»¬å…ˆæ¨¡æ‹Ÿå¤æ‚çš„Vue.jsæœåŠ¡ç«¯æ¸²æŸ“åœºæ™¯ã€‚

```typescript
// demos/html-action.js
const { h, renderList, toDisplayString, createSSRApp } = require('vue');
const { renderToString } = require('vue/server-renderer');

// Vue.jsç»„ä»¶
const Item = {
  props: { index: Number, text: String },
  setup(props) {
    const { text, index } = props;
    return () => {
      return h('div', { class: 'v-item' }, [
        toDisplayString(index),
        toDisplayString(text)
      ]);
    };
  }
};

// Vue.jsç»„ä»¶
const List = {
  props: {
    list: Array
  },
  setup(props) {
    const { list } = props;
    return () => {
      return h(
        'ul',
        { class: 'v-list' },
        renderList(list, (item, index) => {
          return h('li', null, [
            h('li', null, [h(Item, { text: item.text, index: index })])
          ]);
        })
      );
    };
  }
};

// Vue.jsæœåŠ¡ç«¯æ¸²æŸ“ä»£ç 
// æŒ‰countæ•°é‡ï¼Œå¾ªç¯æ‹¼æ¥Vue.jsç»„ä»¶HTMLå­—ç¬¦ä¸²
async function createAppHTML(count) {
  const list = [];
  for (let i = 0; i < count; i++) {
    list.push({ text: `data-${i}` });
  }
  const app = createSSRApp(List, { list });
  const html = await renderToString(app);
  return html;
}

// å¾ªç¯æ¬¡æ•°åˆ—è¡¨
const dataList = [100000, 200000, 300000, 400000];

module.exports = {
  createAppHTML,
  dataList
};
```

å¦‚æœç”¨é»˜è®¤â€œå•è¿›ç¨‹å•çº¿ç¨‹â€çš„æ–¹å¼æ¥æ‰§è¡Œï¼Œä»£ç å°±æ˜¯è¿™æ ·çš„ï¼š

```typescript
// demos/html.js
const { createAppHTML, dataList } = require('./html-action');

async function main() {
  const htmlList = [];
  const start = Date.now();
  for (let i = 0; i < dataList.length; i++) {
    const s = Date.now();
    const html = await createAppHTML(dataList[i]);
    htmlList.push(html);
    console.log(
      `ç¼–è¯‘æ•°æ®é‡ä¸º [${dataList[i]}] çš„Vueæ¨¡æ¿ï¼Œè€—æ—¶ ${Date.now() - s}ms`
    );
  }
  console.log(`ç¼–è¯‘HTMLç»“æŸï¼Œæ€»è€—æ—¶ä¸º ${Date.now() - start}ms`);
}

main();
```

æ¥ç€ï¼Œæˆ‘ä»¬åœ¨Linuxæˆ–MacOSç³»ç»Ÿç¯å¢ƒä¸‹ï¼Œç”¨â€œtimeâ€å‘½ä»¤æ¥è¾…åŠ©æ‰§è¡Œä»£ç ï¼Œç»Ÿè®¡ä¸€ä¸‹è€—æ—¶å’Œèµ„æºä½¿ç”¨æƒ…å†µï¼Œçœ‹ç»“æœæˆªå›¾ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/1a/19/1a8edc71f9055167daf8728285148b19.png?wh=1632x638)

å¯ä»¥çœ‹åˆ°ï¼Œå•è¿›ç¨‹å•çº¿ç¨‹æ¨¡å¼ä¸‹ï¼Œè€—æ—¶55å¤šç§’ï¼ŒCPUä½¿ç”¨ç‡96%ã€‚

è¿™ä¸ªCPUä½¿ç”¨ç‡æ€ä¹ˆç†è§£å‘¢ï¼Ÿå¦‚æœæ˜¯å¤šæ ¸CPUçš„æœºå™¨ï¼Œ96%ä½¿ç”¨ç‡æ˜¯æ¯”è¾ƒä½çš„ã€‚æˆ‘ä»¬å¯ä»¥ç”¨Node.jså¤šçº¿ç¨‹çš„æ–¹å¼æ¥å¤„ç†ï¼Œå¾—åˆ°æ–°çš„CPUä½¿ç”¨ç‡ï¼Œå¯¹æ¯”ä¸€ä¸‹ã€‚

```typescript
// demos/html-thread.js 
const {
  isMainThread,
  workerData,
  Worker,
  parentPort
} = require('worker_threads');
const { createAppHTML, dataList } = require('./html-action');

const htmlList = [];
// çº¿ç¨‹æ•°é‡ä¸º å¤šæ¬¡å¯†é›†è®¡ç®—çš„æ•°é‡
const threadCount = dataList.length;

if (isMainThread) {
  // å¦‚æœæ˜¯åœ¨ä¸»çº¿ç¨‹å†…
  console.log('Main Thread: ä¸»çº¿ç¨‹');
  const mainStart = Date.now();
  // è§¦å‘å¤šçº¿ç¨‹
  for (let i = 0; i < threadCount; i++) {
    // å°†å¤šæ¬¡Vue.jsæœåŠ¡ç«¯æ¸²æŸ“çš„å¯†é›†è®¡ç®—åˆ†é…ç»™å­çº¿ç¨‹
    const worker = new Worker(__filename, {
      workerData: { count: dataList[i] }
    });
    // çº¿ç¨‹é—´çš„é€šä¿¡
    worker.on('message', (data) => {
      htmlList.push(data.html);
      console.log(
        `Child Thread (${worker.threadId}) å­çº¿ç¨‹æ‰§è¡Œè€—æ—¶ï¼š${data.time}ms`
      );
      if (htmlList.length >= dataList.length) {
        console.log(`æ‰§è¡Œå…¨éƒ¨ç»“æŸï¼Œæ€»è€—æ—¶: ${Date.now() - mainStart}ms`);
      }
      // å­çº¿ç¨‹æ‰§è¡Œå®Œè®¡ç®—åï¼Œè§¦å‘ç»“æŸå­çº¿ç¨‹
      worker.emit('end');
    });
  }
} else {
  // å¦‚æœè¿›å…¥å­çº¿ç¨‹
  // å¹¶è¡Œå¸®å¿™æ‰§è¡Œåˆ†é…çš„ä»»åŠ¡
  console.log(`Child Thread: å¯åŠ¨å­çº¿ç¨‹ï¼Œ åˆå§‹æ•°æ®ï¼š${workerData.count}`);
  const start = Date.now();
  createAppHTML(workerData.count).then((html) => {
    parentPort.postMessage({ html, time: Date.now() - start });
  });
}
```

æˆ‘ä»¬ç”¨Node.jsçš„å¤šçº¿ç¨‹æ¨¡å—æ¥è¿è¡ŒVue.jsä»£ç çš„å¯†é›†è®¡ç®—ï¼Œä¹Ÿç”¨Linuxä¸‹çš„â€œtimeâ€å‘½ä»¤æ‰§è¡Œï¼Œå¯ä»¥çœ‹åˆ°ç»“æœã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/58/67/58a246dd09867c91d93fb42e3e3dfc67.png?wh=1720x838)

ç”¨å¤šçº¿ç¨‹æ¨¡å¼ï¼ˆå•è¿›ç¨‹çš„å¤šçº¿ç¨‹ï¼‰ï¼Œè€—æ—¶25ç§’å·¦å³ï¼ŒCPUä½¿ç”¨ç‡è¾¾åˆ°222%ï¼Œæ¯”åˆšæ‰çš„å•çº¿ç¨‹96%ä½¿ç”¨ç‡é«˜ï¼Œè¿™æ˜¯å› ä¸ºåˆ©ç”¨å¤šçº¿ç¨‹ï¼Œå‘æŒ¥äº†å¤šæ ¸CPUçš„ç®—åŠ›ï¼Œå¾—åˆ°æ€§èƒ½çš„æå‡ï¼Œæé«˜è¿è¡Œé€Ÿåº¦ï¼Œé™ä½è¿è¡Œæ—¶é—´ã€‚

çœ‹äº†å¤šçº¿ç¨‹çš„æ“ä½œï¼Œæˆ‘ä»¬æ¢æˆå¤šè¿›ç¨‹çš„æ–¹å¼è¯•è¯•çœ‹ï¼Œä¹Ÿå°±æ˜¯å¤šè¿›ç¨‹çš„å•çº¿ç¨‹æ¨¡å¼ã€‚

```typescript
// demos/html-process.js
const cluster = require('cluster');
const { createAppHTML, dataList } = require('./html-action');

const htmlList = [];
// è¿›ç¨‹æ•°é‡ä¸º å¤šæ¬¡å¯†é›†è®¡ç®—çš„æ•°é‡
const processCount = dataList.length;

if (cluster.isMaster) {
  // è¿›å…¥ä¸»è¿›ç¨‹
  console.log('Main Process: ä¸»è¿›ç¨‹');
  const mainStart = Date.now();

  for (let i = 0; i < processCount; i++) {
    // å¯åŠ¨å¤šè¿›ç¨‹æ¥å¹¶å‘æ‰§è¡Œä»»åŠ¡
    const worker = cluster.fork();
    worker.send({ count: dataList[i] });

    // è¿›ç¨‹ä¹‹é—´çš„IPCé€šä¿¡
    // ä¸»è¿›ç¨‹å‘å­è¿›ç¨‹å‘é€ä»»åŠ¡æ•°æ®
    worker.on('message', (data) => {
      htmlList.push(data.html);
      console.log(
        `Child Process (${worker.process.pid}) å­è¿›ç¨‹æ‰§è¡Œè€—æ—¶ï¼š${data.time}ms`
      );
      if (htmlList.length >= dataList.length) {
        console.log(`æ‰§è¡Œå…¨éƒ¨ç»“æŸï¼Œæ€»è€—æ—¶: ${Date.now() - mainStart}ms`);
      }
      // å­è¿›ç¨‹æ‰§è¡Œå®Œä»»åŠ¡åï¼Œé€€å‡ºå­è¿›ç¨‹
      worker.kill();
    });
  }
} else {
  console.log(`Child Process: å¯åŠ¨å­è¿›ç¨‹ (pid: ${process.pid})`);
  // è¿›ç¨‹ä¹‹é—´çš„IPCé€šä¿¡
  // æ¥æ”¶ä¸»è¿›ç¨‹çš„æ¶ˆæ¯
  process.on('message', (data) => {
    const start = Date.now();
    // æ‰§è¡ŒVue.jsæœåŠ¡ç«¯æ¸²æŸ“çš„å¯†é›†è®¡ç®—
    createAppHTML(data.count).then((html) => {
      // é€šè¿‡IPCï¼Œå‘ä¸»è¿›ç¨‹å‘é€æ¶ˆæ¯
      process.send({ html, time: Date.now() - start });
    });
  });
}
```

æ‰§è¡Œä»£ç ï¼ŒæŸ¥çœ‹å¤šè¿›ç¨‹çš„æ€§èƒ½ä½¿ç”¨æƒ…å†µã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/b7/d8/b751ae6fa1e99a20868dd8ede9a1c5d8.png?wh=1720x838)

ä»æˆªå›¾å¯ä»¥çœ‹å‡ºï¼Œå¤šçº¿ç¨‹æ‰§è¡Œçš„è€—æ—¶24ç§’å·¦å³ï¼ŒCPUä½¿ç”¨ç‡è¾¾åˆ°143%ï¼Œè¿™æ˜¯å› ä¸ºä½¿ç”¨äº†å¤šè¿›ç¨‹ï¼Œä¹ŸåŒæ ·å‘æŒ¥äº†å¤šæ ¸CPUçš„ç®—åŠ›ï¼Œå¾—åˆ°äº†æ€§èƒ½çš„æå‡ã€‚

å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹ä¸¤æ¬¡è¿è¡Œå¯¹æ¯”ï¼Œé™¤äº†CPUä½¿ç”¨ç‡æœ‰å·®å¼‚ï¼Œè€—æ—¶æ˜¯å·®ä¸å¤šçš„ï¼Œè€Œä¸”éƒ½æ¯”å•è¿›ç¨‹å•çº¿ç¨‹æ‰§è¡Œçš„è€—æ—¶å°‘ã€‚æˆ‘ä»¬å½’çº³ä¸€ä¸‹å¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹çš„ä¼˜åŠ£ã€‚

![](https://static001.geekbang.org/resource/image/7f/1d/7f66249b9f534c63fb4b28cf433bfb1d.jpg?wh=4000x1990)

å¤šçº¿ç¨‹æ¯”å¤šè¿›ç¨‹çœå†…å­˜ç­‰èµ„æºï¼Œä½†æ˜¯ï¼Œå¤šè¿›ç¨‹æ¯”å¤šçº¿ç¨‹ç¨³å®šæ€§å¼ºä¸€äº›ã€‚ä½ å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œ**å¤šçº¿ç¨‹æ¯”è¾ƒé€‚åˆå•ç‹¬è§£å†³å¯†é›†è®¡ç®—é—®é¢˜ï¼Œå¤šè¿›ç¨‹è¾ƒé€‚åˆç®¡ç†æœåŠ¡çš„ç¨³å®šæ€§**ã€‚

æ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘ä»¬å°±é€‰æ‹©å¤šè¿›ç¨‹çš„æ–¹å¼ï¼Œæ¥æé«˜CPUç­‰æœºå™¨èµ„æºçš„åˆ©ç”¨ç‡ï¼Œæå‡æ€§èƒ½ã€‚é‚£ä¹ˆè¿è¥æ­å»ºå¹³å°ï¼Œå¦‚ä½•ç”¨å¤šè¿›ç¨‹æ¥éƒ¨ç½²Node.jsæœåŠ¡å‘¢ï¼Ÿ

## å¦‚ä½•éƒ¨ç½²æ­å»ºå¹³å°å¤šè¿›ç¨‹æœåŠ¡

ä»å‰é¢Node.jsçš„å¤šè¿›ç¨‹æ¡ˆä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå¼€å¯å¤šè¿›ç¨‹æ˜¯ç›´æ¥æ‰©å±•å‡ºå­è¿›ç¨‹ï¼Œæ‰§è¡ŒNode.jsçš„åº”ç”¨ç¨‹åºï¼Œä¸éœ€è¦æ”¹åŠ¨åŸæœ‰çš„åº”ç”¨ä»£ç ã€‚

é‚£ä¹ˆé¢å‘æœ¬è¯¾ç¨‹çš„è¿è¥æ­å»ºå¹³å°ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ è¿™ä¸ªæœåŠ¡è¿›ç¨‹ç®¡ç†æ–‡ä»¶ï¼Œæ‰§è¡ŒæœåŠ¡çš„å¤šè¿›ç¨‹ã€‚

```typescript
// packages/work-server/start.cjs
const cluster = require('cluster');
const path = require('path');
const os = require('os');

const processCount = os.cpus().length;
const entryFile = path.join(__dirname, 'dist', 'index.cjs');

cluster.setupMaster({
  exec: entryFile
});

// æ ¹æ®CPUæ ¸æ•°ï¼Œå¯åŠ¨å¤šè¿›ç¨‹
for (let i = 0; i < processCount; i++) {
  cluster.fork();
}
```

ä»ä»£ç å¯ä»¥çœ‹å‡ºï¼ŒNode.jsæœåŠ¡ï¼Œåªéœ€è¦æ–°å¢ä¸€ä¸ªè„šæœ¬æ¥å¯åŠ¨å¤šè¿›ç¨‹ã€‚è¿™é‡Œï¼Œå¤šè¿›ç¨‹çš„æ•°é‡ï¼Œå»ºè®®è·Ÿå½“å‰æœåŠ¡å™¨å™¨çš„CPUæ ¸æ•°ä¿æŒä¸€è‡´ï¼Œèƒ½æœ€å¤§é™åº¦å‘æŒ¥å¤šæ ¸CPUçš„èµ„æºå’Œèƒ½åŠ›ã€‚

æœ‰ä¸€ç‚¹ä½ è¦ç‰¹åˆ«æ³¨æ„ï¼Œ**å¤šè¿›ç¨‹æ¨¡å¼ï¼Œä¸»è¦åœ¨ç”Ÿäº§æ¨¡å¼ä¸­ä½¿ç”¨ï¼Œä¸è¦åœ¨å¼€å‘æ¨¡å¼ä¸‹ä½¿ç”¨**ã€‚

å› ä¸ºåœ¨å¼€å‘æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬æ˜¯åŸºäºTypeScriptè¯­æ³•è¿›è¡Œä»£ç å¼€å‘ï¼ŒåŒæ—¶åˆæœ‰nodemonè¿›è¡Œä»£ç çƒ­æ›´æ–°ï¼Œå¦‚æœè¿™æ—¶å€™å¼€å‘æ¨¡å¼åŠ ä¸Šäº†å¤šè¿›ç¨‹ï¼Œä¼šå¸¦æ¥å¾ˆå¤šå¼€å‘ä¸Šçš„å¹²æ‰°ã€‚è€Œä¸”ï¼Œå¤šè¿›ç¨‹çš„ä½¿ç”¨ï¼Œæ˜¯ä¸ºäº†è§£å†³ç”Ÿäº§ç¯å¢ƒä¸‹çš„é‡åˆ°æœåŠ¡é˜»å¡é—®é¢˜æˆ–å¹¶å‘é—®é¢˜ï¼Œæ˜¯ä¸€ç§æœåŠ¡ç«¯æ€§èƒ½ä¼˜åŒ–çš„æŠ€æœ¯æªæ–½ï¼Œå¹¶ä¸æ˜¯å¿…è¦çš„æŠ€æœ¯æªæ–½ã€‚æ‰€ä»¥åœ¨è¯¾ç¨‹çš„ä»£ç æ¡ˆä¾‹é‡Œï¼Œæˆ‘ä»¬åœ¨ç”Ÿäº§æ¨¡å¼ä¸­å¯åŠ¨å¤šè¿›ç¨‹æœåŠ¡ã€‚

å½“ç„¶ï¼Œæˆ‘ä»¬åŸºäºåŸç”ŸNode.jsçš„è¿›ç¨‹æ¨¡å—ï¼Œå¯åŠ¨äº†æœåŠ¡çš„å¤šè¿›ç¨‹ï¼Œç¤¾åŒºä¹Ÿæœ‰æˆç†Ÿçš„ç°æˆå·¥å…·æ¥ç›´æ¥è¾…åŠ©å¯åŠ¨å¤šè¿›ç¨‹ï¼Œä½ å¯ä»¥è€ƒè™‘ä½¿ç”¨pm2ï¼Œå…·ä½“å·¥å…·ä¿¡æ¯å¯ä»¥æŸ¥çœ‹è¿™é‡Œï¼š[https://www.npmjs.com/package/pm2](https://www.npmjs.com/package/pm2)ã€‚

## æ€»ç»“

å›´ç»•æœåŠ¡â€œé˜»å¡é—®é¢˜â€è¿™ä¸€å¸¸è§çš„æœåŠ¡ç«¯æ€§èƒ½ç“¶é¢ˆç‚¹ï¼Œæˆ‘ä»¬å±•å¼€äº†å¯¹Node.jsæœåŠ¡çš„æ€§èƒ½ä¼˜åŒ–åˆ†æã€‚æ€§èƒ½é—®é¢˜ï¼Œæ ¹æœ¬åŸå› å¯ä»¥å½’çº³æˆä¸¤ç§ã€‚

- ä»£ç é€»è¾‘ä¸åˆç†ï¼Œå¯¼è‡´å¤§é‡CPUå¯†é›†è®¡ç®—ç›´æ¥è¿è¡Œã€‚
- æœºå™¨èµ„æºåˆ©ç”¨ä¸åˆç†ï¼Œå•çº¿ç¨‹å•è¿›ç¨‹æ‰§è¡Œä»£ç ï¼Œæ²¡å……åˆ†åˆ©ç”¨æœºå™¨èµ„æºã€‚

æˆ‘ä»¬æœ‰ä¸¤ä¸ªè§£å†³æ€è·¯ã€‚

- ç›´æ¥æ€è·¯ï¼šç›´æ¥ä¼˜åŒ–èµ„æºåˆ©ç”¨ï¼Œå› ä¸ºæ€§èƒ½ç“¶é¢ˆé—®é¢˜ï¼Œè¯´åˆ°åº•å°±æ˜¯èµ„æºä½¿ç”¨æˆ–åˆ©ç”¨é—®é¢˜ã€‚
- æ ¹æ²»æ€è·¯ï¼šä¼˜åŒ–ä»£ç é€»è¾‘ï¼Œå°½é‡æŒ‰éœ€è®¾è®¡ä»£ç ï¼ŒæŒ‰éœ€æ‰§è¡Œç¨‹åºï¼Œé¿å…ç›´æ¥æ‰§è¡ŒCPUå¯†é›†è®¡ç®—çš„é€»è¾‘ã€‚

å…³äºNode.jsçš„æ€§èƒ½ä¼˜åŒ–ï¼Œä¹Ÿå¯ä»¥å½’çº³æˆä¸¤ä¸ªæ–¹é¢ï¼ŒCPUå¯†é›†è®¡ç®—ä¼˜åŒ–å’Œæœºå™¨èµ„æºä½¿ç”¨ä¼˜åŒ–ã€‚

- CPUå¯†é›†è®¡ç®—ä¼˜åŒ–æ–¹é¢ï¼šä¼˜å…ˆå°½é‡å°‘åšå¯†é›†è®¡ç®—é€»è¾‘ï¼Œæ ¹æ®åŠŸèƒ½æœ€å°éœ€æ±‚ï¼ŒæŒ‰éœ€è®¡ç®—ã€‚å¦‚æœçœŸçš„é¿å…ä¸äº†å¯†é›†è®¡ç®—ï¼Œå¯ä»¥é€‰æ‹©Node.jsç¯å¢ƒæä¾›çš„å¤šçº¿ç¨‹æ¨¡å—è¿›è¡Œå¯†é›†è®¡ç®—ã€‚
- æœºå™¨èµ„æºä¼˜åŒ–æ–¹é¢ï¼šå¦‚æœæœºå™¨æ¡ä»¶å…è®¸ï¼Œå¯ä»¥å°½é‡ä½¿ç”¨å¤šçº¿ç¨‹æ¥å¯åŠ¨æœåŠ¡ç¨‹åºï¼Œä¿è¯æœºå™¨èµ„æºçš„å……åˆ†åˆ©ç”¨ã€‚

çº¿ç¨‹å’Œè¿›ç¨‹ï¼Œè¿›ç¨‹æ˜¯è°ƒåº¦èµ„æºæœ€å°å•ä½ï¼Œçº¿ç¨‹æ˜¯è¿›ç¨‹é‡Œæ‰§è¡Œæ“ä½œæœ€å°å•ä½ã€‚ä¸¤è€…å„æœ‰åˆ©å¼Šï¼Œå„æœ‰é€‚ç”¨çš„åœºæ™¯ï¼Œåº”è¯¥æ‰¬é•¿é¿çŸ­åœ°é€‰æ‹©ä½¿ç”¨ã€‚

## æ€è€ƒé¢˜

æœåŠ¡ç«¯çš„æ€§èƒ½ä¼˜åŒ–æªæ–½ï¼Œé™¤äº†å¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹çš„ä¼˜åŒ–æªæ–½å¤–ï¼Œè¿˜æœ‰å…¶å®ƒä¼˜åŒ–æ–¹æ¡ˆå—ï¼Ÿ

æ¬¢è¿ç•™è¨€åˆ†äº«ä½ çš„æ€è€ƒã€‚åœ¨æŒæ¡Node.jsæœåŠ¡ç«¯çš„æ€§èƒ½ä¼˜åŒ–æ“ä½œçš„åŒæ—¶ï¼Œä¹Ÿè¦è®°å¾—ä¸¾ä¸€åä¸‰åº”ç”¨åˆ°å…¶å®ƒå¼€å‘åœºæ™¯ä¸­ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ã€‚

### [å®Œæ•´çš„ä»£ç åœ¨è¿™é‡Œ](https://github.com/FE-star/vue3-course/tree/main/chapter/35)
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ1ï¼‰</strong></div><ul>
<li><span>ifelse</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>å¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹ä¸»è¦æ˜¯è§£å†³cpué˜»å¡æ“ä½œé—®é¢˜ï¼Œæ¯”å¦‚ioé˜»å¡ï¼Œç½‘ç»œé˜»å¡é—®é¢˜ã€‚
è‡³äºè®¡ç®—å¯†é›†å‹ï¼Œä¸€èˆ¬å°±æ˜¯è¦æ”¹ä»£ç æ‰èƒ½å……åˆ†åˆ©ç”¨cpuå¤šæ ¸çš„æ€§èƒ½ä¼˜åŠ¿ï¼Œæ¯”å¦‚å¤§ä»»åŠ¡åˆ‡åˆ†ä¸ºå°ä»»åŠ¡ï¼Œç„¶ååˆ©ç”¨å¤šä»»åŠ¡æ‰§è¡Œæé«˜æ€§èƒ½ã€‚</p>2024-10-08</li><br/>
</ul>