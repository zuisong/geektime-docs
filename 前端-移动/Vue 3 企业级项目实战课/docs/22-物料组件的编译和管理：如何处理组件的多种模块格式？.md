ä½ å¥½ï¼Œæˆ‘æ˜¯æ¨æ–‡åšã€‚

æˆ‘ä»¬è¯¾ç¨‹çš„å¹³å°é¡¹ç›®ï¼Œåœ¨æ•°æ®è®¾è®¡ç¯èŠ‚ï¼ŒæŠŠå¹³å°çš„æ•°æ®åˆ’åˆ†æˆäº†ä¸‰ä¸ªæ•°æ®ç»´åº¦ï¼šç”¨æˆ·ã€ç‰©æ–™å’Œé¡µé¢ï¼Œå¯¹åº”çš„è¿è¥æ­å»ºå¹³å°åŠŸèƒ½å°±æœ‰ä¸‰ç§åŠŸèƒ½ç»´åº¦ï¼šç”¨æˆ·ã€ç‰©æ–™å’Œé¡µé¢ã€‚

ä¸ŠèŠ‚è¯¾æˆ‘ä»¬å­¦ä¹ äº†ç”¨æˆ·çš„æ³¨å†Œå’Œç™»å½•ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·æ•°æ®çš„æ“ä½œï¼Œå±äºç”¨æˆ·åŠŸèƒ½ç»´åº¦ã€‚ä»è¿™èŠ‚è¯¾å¼€å§‹ï¼Œæˆ‘ä»¬è¿›å…¥ç‰©æ–™åŠŸèƒ½ç»´åº¦ï¼Œå¯¹è¿è¥æ­å»ºå¹³å°çš„ç‰©æ–™ä½“ç³»è¿›è¡ŒåŠŸèƒ½åˆ†æã€æ–¹æ¡ˆè®¾è®¡ã€æŠ€æœ¯è§£æ„å’Œä»£ç å®ç°ã€‚

â€œç‰©æ–™â€åŠŸèƒ½ï¼Œæ ¸å¿ƒå°±æ˜¯æ“ä½œç‰©æ–™çš„é™æ€èµ„æºå’Œæ•°æ®åº“æ•°æ®ã€‚å…¶ä¸­ï¼Œç‰©æ–™é™æ€èµ„æºæŒ‡çš„æ˜¯æ¯ä¸ªç‰©æ–™ç»„ä»¶çš„äº§ç‰©ï¼Œä¹Ÿå°±æ˜¯JavaScriptå’ŒCSSæ–‡ä»¶ï¼Œå¯ä»¥ç‹¬ç«‹åœ¨æµè§ˆå™¨æˆ–è€…Node.jsç¯å¢ƒä¸­è¿›è¡Œæ¸²æŸ“æˆ–è€…æ‰§è¡Œã€‚

è€Œè¿è¥æ­å»ºå¹³å°ï¼Œåº•å±‚åŠŸèƒ½é‡Œæœ€æ ¸å¿ƒå°±æ˜¯ç”¨ç‰©æ–™æ­å»ºé¡µé¢ã€‚**å¦‚ä½•æ­å»ºï¼Œå…¶å®å°±æ˜¯æŠŠè¿™äº›ç‰©æ–™çš„JavaScriptå’ŒCSSæ–‡ä»¶ç»„è£…èµ·æ¥è¿è¡Œã€‚ç”¨å‰ç«¯æŠ€æœ¯è§†è§’çœ‹ï¼Œå°±æ˜¯ç”¨ç»„ä»¶ï¼ˆç‰©æ–™ï¼‰æ¥ç»„è£…é¡µé¢**ã€‚

æƒ³ç”¨ç»„ä»¶ç»„è£…æˆé¡µé¢ï¼Œé¦–å…ˆè¦æŠŠç»„ä»¶æ¨¡å—åŒ–ï¼Œæ–¹ä¾¿åç»­ç»„è£…ï¼Œè€Œä¸”ï¼Œè¦è®©ç»„ä»¶åœ¨ä¸åŒçš„ç¯å¢ƒï¼ˆæµè§ˆå™¨æˆ–è€…Node.jsï¼‰é‡Œçš„è¿è¡Œï¼ŒæŠŠç»„ä»¶ç¼–è¯‘æˆå¯¹åº”æ¨¡å—åŒ–æ ¼å¼åæ‰èƒ½è¿è¡Œã€‚é‚£ä¹ˆå‰ç«¯ç»„ä»¶æœ‰å“ªäº›æ¨¡å—åŒ–æ–¹æ¡ˆå‘¢ï¼Ÿ

## å‰ç«¯ç»„ä»¶æœ‰å“ªäº›æ¨¡å—åŒ–æ–¹æ¡ˆï¼Ÿ

å‰ç«¯ç»„ä»¶æ¨¡å—åŒ–æ–¹æ¡ˆï¼Œå…¶å®å½’æ ¹ç»“åº•å°±æ˜¯JavaScriptçš„æ¨¡å—åŒ–æ–¹æ¡ˆã€‚å› ä¸ºä¸ç®¡æ˜¯Vue.jsç»„ä»¶ã€React.jsç»„ä»¶æˆ–å…¶ä»–å‰ç«¯æ¡†æ¶ç»„ä»¶ï¼Œæœ€ç»ˆè¦åœ¨æµè§ˆå™¨æˆ–è€…Node.jsç¯å¢ƒè¿è¡Œï¼Œéƒ½éœ€è¦ç¼–è¯‘æˆJavaScriptä»£ç ã€‚

é‚£ä¹ˆï¼Œæˆ‘ä»¬ç°åœ¨çš„å…³æ³¨ç‚¹å°±æ˜¯**JavaScriptçš„æ¨¡å—åŒ–æ–¹æ¡ˆ**ã€‚

JavaScript ä½œä¸ºä¸€é—¨â€œåŠ¨æ€è„šæœ¬è¯­è¨€â€ï¼Œåœ¨ES6è‰æ¡ˆç¡®å®šå‰ï¼Œæ²¡æœ‰â€œå®˜æ–¹æ ‡å‡†â€çš„æ¨¡å¿«åŒ–æ–¹æ¡ˆã€‚å¦‚æœè¦å¯¹è·¨JavaScriptæ–‡ä»¶çš„æ–¹æ³•å’Œæ•°æ®è¿›è¡Œâ€œè”åŠ¨â€ï¼Œåªèƒ½é å…¨å±€å˜é‡è¿›è¡Œâ€œé€šä¿¡è”é€šâ€ã€‚åæ¥ç»è¿‡æŠ€æœ¯ç¤¾åŒºçš„æ¢ç´¢ï¼ŒåŸºäºES5è§„èŒƒçš„JavaScriptèƒ½åŠ›ï¼Œå®ç°äº†å¤šç§æ¨¡å—åŒ–æ–¹æ¡ˆã€‚æ¯”è¾ƒå‡ºåçš„æœ‰AMDæ¨¡å—åŒ–æ–¹æ¡ˆã€CJSæ¨¡å—åŒ–æ–¹æ¡ˆã€‚

JavaScrip åœ¨ES6è‰æ¡ˆç¡®å®šåï¼Œç¡®å®šäº†åœ¨JavaScriptåŸç”Ÿè¯­è¨€å±‚é¢çš„æ ‡å‡†æ¨¡å—åŒ–æ–¹æ¡ˆï¼ŒES Modulesï¼Œç®€ç§°ESMã€‚

å¾ˆå¤šäººç–‘æƒ‘ï¼ŒESM æ—¢ç„¶æ˜¯JavaScriptè¯­è¨€å®˜æ–¹çš„æ¨¡å—åŒ–æ–¹æ¡ˆï¼Œé‚£ES6è§„èŒƒä¹‹å‰çš„â€œé‡ç”Ÿâ€æ¨¡å—åŒ–æ–¹æ¡ˆæ˜¯ä¸æ˜¯å°±ä¸é€‚ç”¨äº†å‘¢ï¼Ÿå…¶å®å¹¶ä¸æ˜¯çš„ï¼Œå¾ˆå¤šä»¥å‰çš„æ¨¡å—åŒ–æ–¹æ¡ˆä¾ç„¶æœ‰é€‚ç”¨åœºæ™¯ï¼Œå¸¸ç”¨çš„ä¸»è¦æœ‰å››ä¸ªã€‚

- ESM æ¨¡å—åŒ–æ–¹æ¡ˆ
- AMDæ¨¡å—åŒ–æ–¹æ¡ˆ
- IIFEï¼ˆå…¨å±€å˜é‡ï¼‰æ¨¡å—åŒ–æ–¹æ¡ˆ
- CJSæ¨¡å—åŒ–æ–¹æ¡ˆ

æ¥çœ‹æ¯ä¸ªæ¨¡å—åŒ–æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹å’Œä½¿ç”¨åœºæ™¯ï¼Œæˆ‘ä¹Ÿä¼šç”¨ä»£ç æ¼”ç¤ºå…·ä½“åŸç†å’Œå®ç°è¿‡ç¨‹ã€‚

### 1. ESMæ¨¡å—åŒ–æ–¹æ¡ˆ

è¿™ä¸ªESå®˜æ–¹è§„èŒƒçš„æ¨¡å—åŒ–æ–¹æ¡ˆï¼Œåœ¨é«˜ç‰ˆæœ¬æµè§ˆå™¨å’Œé«˜ç‰ˆæœ¬Node.jsç¯å¢ƒä¸‹æ‰èƒ½ç›´æ¥ä½¿ç”¨ã€‚Node.jsåœ¨æœåŠ¡ç«¯å¼€å‘å¯ä»¥ç»Ÿä¸€çº¦å®šä½¿ç”¨é«˜ç‰ˆæœ¬ï¼Œä½†æ˜¯æµè§ˆå™¨æ˜¯ç”¨æˆ·è‡ªè¡Œé€‰æ‹©çš„ï¼Œæ§åˆ¶ä¸äº†ç‰ˆæœ¬ï¼Œæ‰€ä»¥ESMåœ¨å®é™…å·¥ä½œä¸­è¦é¢ä¸´æµè§ˆå™¨å…¼å®¹é—®é¢˜ã€‚

ESMçš„æµè§ˆå™¨å…¼å®¹æƒ…å†µï¼ˆæ¥è‡ª [https://caniuse.com/es6-module](https://caniuse.com/es6-module) ï¼‰ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/31/0f/31ce6dccc5f06085e70d5c0340d77c0f.png?wh=1920x443)

ESMåœ¨Node.jsç¯å¢ƒä¸‹çš„æ”¯æŒæƒ…å†µæˆªå›¾ï¼ˆæ¥è‡ª [https://nodejs.org/api/esm.html#modules-ecmascript-modules](https://nodejs.org/api/esm.html#modules-ecmascript-modules) ï¼‰ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/b5/2f/b59faf73125012a76828ea3ac74f452f.png?wh=1920x1169)

æ€»ç»“ä¸€ä¸‹ESMçš„å‡ ç§åœºæ™¯ç‰¹æ€§ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/37/dc/377e9e0b1dd543e9a995680d16b527dc.jpg?wh=1920x1395)

æˆ‘ä»¬è¿™èŠ‚è¯¾ä¸»è¦æ˜¯å­¦ä¹ ç»„ä»¶çš„æ¨¡å—åŒ–æ–¹æ¡ˆï¼Œå› ä¸ºç‰©æ–™ç»„ä»·çš„æ‹¼è£…æ˜¯åœ¨æµè§ˆå™¨æ“ä½œè¿›è¡Œçš„ï¼Œé‚£å°±ä¼˜å…ˆè€ƒè™‘åœ¨æµè§ˆå™¨é‡Œä½¿ç”¨ã€‚çœ‹ä¸€ä¸ªä»£ç æ¡ˆä¾‹ï¼Œç”¨ESMç»„è£…æ¸²æŸ“ä¸€ä¸ªVue.jsåº”ç”¨ã€‚

é¦–å…ˆæ˜¯ä»£ç çš„ç›®å½•ã€‚

```shell
. # packages/mock-cdn/demos/esm/ 
â”œâ”€â”€ index.html
â”œâ”€â”€ index.js
â””â”€â”€ material
Â  Â  â”œâ”€â”€ counter-decrease.js
Â  Â  â””â”€â”€ counter-increase.js
```

å…¶ä¸­æœ‰ä¸¤ä¸ªç‰©æ–™ç»„ä»¶ counter-decrease.js å’Œ counter-increase.jsã€‚

```typescript
// packages/mock-cdn/demos/esm/material/counter-decrease.js
import { h, ref, toDisplayString } from 'vue';
const Counter = {
  setup() {
    const num = ref(0);
    const click = () => {
      num.value -= 1;
    };
    return () => {
      return h('div', { class: 'v-counter' }, [
        h('div', { class: 'v-text' }, toDisplayString(num.value)),
        h(
          'button',
          {
            class: 'v-btn',
            onClick: click
          },
          'ç‚¹å‡»å‡1'
        )
      ]);
    };
  }
};
export default Counter;
```

```typescript
// packages/mock-cdn/demos/esm/material/counter-increase.js
import { h, ref, toDisplayString } from 'vue';
const Counter = {
  setup() {
    const num = ref(0);
    const click = () => {
      num.value += 1;
    };
    return () => {
      return h('div', { class: 'v-counter' }, [
        h('div', { class: 'v-text' }, toDisplayString(num.value)),
        h(
          'button',
          {
            class: 'v-btn',
            onClick: click
          },
          'ç‚¹å‡»åŠ 1'
        )
      ]);
    };
  }
};
export default Counter;
```

æœ‰äº†ESMç‰©æ–™äº§ç‰©ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç‰©æ–™çš„ç»„è£…å’Œæ¸²æŸ“ã€‚

```xml
<!-- packages/mock-cdn/demos/esm/index.html -->
<html>
  <head>
    <meta charset="utf-8" />
    <script type="importmap">
      {
        "imports": {
          "vue": "/public/pkg/vue/3.2.45/dist/vue.runtime.esm-browser.js",
          "vue-router": "/public/pkg/vue/3.2.45/dist/vue.runtime.esm-browser.js"
        }
      }
    </script>
  </head>
  <body>
    <div id="app">é¡µé¢åŠ è½½ä¸­...</div>
    <script type="module" src="./index.js"></script>
  </body>
</html>
```

```typescript
// packages/mock-cdn/demos/esm/index.js
import { createApp, h } from 'vue';
const layout = {
  materials: [
    { name: 'counter-increase' },
    { name: 'counter-decrease' }
  ]
};

async function runtime() {
  const children = [];
  for (const m of layout.materials) {
    const Module = await import(`/demos/esm/material/${m.name}.js`);
    children.push(h(Module?.default || Module));
  }
  const App = h('div', {}, children);
  const app = createApp({
    render() {
      return h(App, {});
    }
  });
  app.mount('#app');
}

runtime();
```

ä»£ç ä¸­ï¼Œæˆ‘ä»¬åœ¨index.htmlæ–‡ä»¶é‡Œç”¨äº†importmapçš„ç‰¹æ€§ï¼Œæ–¹ä¾¿ESMé‡Œç›´æ¥ç”¨ import vueçš„æ–¹å¼æ¥è°ƒç”¨ï¼›åœ¨index.jsç”¨import()ï¼Œä¹Ÿå°±æ˜¯ESMçš„å¼‚æ­¥è°ƒç”¨æ¨¡å—æ–¹æ³•ï¼Œè·å–ä¾èµ–çš„ç‰©æ–™ç»„ä»¶ã€‚æœ€ç»ˆåŸºäºVue.jsçš„éç¼–è¯‘æ¨¡å¼çš„è¯­æ³•ï¼Œæˆ‘ä»¬æˆåŠŸæŠŠä¸¤ä¸ªç»„ä»¶ç»„è£…ä¸€èµ·æ¸²æŸ“ã€‚

### 2. AMDæ¨¡å—åŒ–æ–¹æ¡ˆ

AMDï¼Œå…¨ç§°æ˜¯Asynchronous Module Definitionï¼Œâ€œå¼‚æ­¥æ¨¡å—å®šä¹‰â€ï¼Œæ˜¯ä¸€ç§é¢å‘æµè§ˆå™¨è¿è¡Œçš„æ¨¡å—åŒ–æ–¹æ¡ˆã€‚

AMDåœ¨ES6è¿˜æ²¡å‡ºç°ä¹‹å‰ï¼Œæ˜¯ES5ç¯å¢ƒä¸‹å¸¸è§ç”¨çš„æ¨¡å—åŒ–æ–¹æ¡ˆã€‚è¿™é‡Œæåˆ°çš„â€œå¼‚æ­¥æ¨¡å—â€ï¼Œæ˜¯æŒ‡æŒ‰æ¨¡å—çš„ä¾èµ–æ¥å¼‚æ­¥åŠ è½½AMDæ¨¡å—ï¼Œç­‰å¾…ä¾èµ–æ¨¡å—å¼‚æ­¥åŠ è½½å®Œï¼Œå°±å¼€å§‹æ‰§è¡Œä¸»ä½“ä»£ç ã€‚å…¨ç¨‹çš„è¿è¡Œæ—¶æ‰§è¡Œè¿‡ç¨‹ï¼Œéƒ½æ˜¯åŸºäºES5çš„è¯­æ³•èƒ½åŠ›æ¥å®ç°çš„ã€‚ä½†æ˜¯ï¼ŒAMDåªæ˜¯ä¸€ç§æŠ€æœ¯æ–¹æ¡ˆï¼Œä¹Ÿå°±æ˜¯è§„èŒƒï¼Œå…·ä½“æŠ€æœ¯å®ç°éœ€è¦æ ¹æ®è§„èŒƒï¼Œå®ç°å…¶è¿è¡Œæ—¶ã€‚ç›®å‰ä¸»æµçš„AMDæŠ€æœ¯æ¡†æ¶æœ‰RequireJSã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/f0/1a/f01011e7aaec82203f166c84e4889c1a.jpg?wh=1920x1450)

çœ‹ä¸€ä¸ªä»£ç æ¡ˆä¾‹ï¼ŒåŸºäºRequireJSç”¨AMDè§„èŒƒæ¥ç»„è£…ç‰©æ–™ï¼Œæ¸²æŸ“ä¸€ä¸ªVue.jsåº”ç”¨ã€‚

ä»£ç çš„ç›®å½•ã€‚

```shell
. # packages/mock-cdn/demos/amd/ 
â”œâ”€â”€ index.html
â”œâ”€â”€ index.js
â””â”€â”€ material
Â  Â  â”œâ”€â”€ counter-decrease.js
Â  Â  â””â”€â”€ counter-increase.js
```

ä¸¤ä¸ªAMDæ¨¡å—æ ¼å¼çš„ç‰©æ–™ç»„ä»¶ counter-decrease.js å’Œ counter-increase.jsã€‚

```typescript
// packages/mock-cdn/demos/amd/material/counter-decrease.js
define('counter-decrease', ['vue'], function (Vue) {
  const { h, ref, toDisplayString } = Vue;
  const Counter = {
    setup() {
      const num = ref(0);
      const click = () => {
        num.value -= 1;
      };
      return () => {
        return h('div', { class: 'v-counter' }, [
          h('div', { class: 'v-text' }, toDisplayString(num.value)),
          h(
            'button',
            {
              class: 'v-btn',
              onClick: click
            },
            'ç‚¹å‡»å‡1'
          )
        ]);
      };
    }
  };
  return Counter;
});
```

```typescript
// packages/mock-cdn/demos/amd/material/counter-increase.js
define('counter-increase', ['vue'], function (Vue) {
  const { h, ref, toDisplayString } = Vue;
  const Counter = {
    setup() {
      const num = ref(0);
      const click = () => {
        num.value += 1;
      };
      return () => {
        return h('div', { class: 'v-counter' }, [
          h('div', { class: 'v-text' }, toDisplayString(num.value)),
          h(
            'button',
            {
              class: 'v-btn',
              onClick: click
            },
            'ç‚¹å‡»åŠ 1'
          )
        ]);
      };
    }
  };
  return Counter;
});
```

AMDæ ¼å¼ç‰©æ–™çš„ç»„è£…å’Œæ¸²æŸ“ã€‚

```xml
<!-- packages/mock-cdn/demos/amd/index.html -->
<html>
  <head>
    <meta charset="utf-8" />
    <script src="/public/pkg/requirejs/2.3.6/require.js"></script>
    <script src="/public/pkg/vue/3.2.45/dist/vue.runtime.global.js"></script>
  </head>
  <body>
    <div id="app">é¡µé¢åŠ è½½ä¸­...</div>
    <script src="./index.js"></script>
  </body>
</html>
```

```typescript
// packages/mock-cdn/demos/amd/index.js
const layout = {
  materials: [
    { name: 'counter-increase'  },
    { name: 'counter-decrease' }
  ]
};

window.requirejs.config({
  baseUrl: '/demos/amd/material/',
  paths: {}
});

window.define('vue', [], function () {
  return window.Vue;
});

function runtime() {
  window.require(
    ['vue', 'require', ...layout.materials.map((m) => m.name)],
    function (Vue, require) {
      const { createApp, h } = Vue;
      const children = [];
      for (const m of layout.materials) {
        const Module = require(m.name);
        children.push(h(Module?.default || Module));
      }
      const App = h('div', {}, children);
      const app = createApp({
        render() {
          return h(App, {});
        }
      });
      app.mount('#app');
    }
  );
}

runtime();
```

ä»ä¸Šé¢ä»£ç ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°AMDæ¨¡å—çš„è¿è¡Œä¾èµ–äº†RequireJSçš„è¿è¡Œï¼ŒRequireJSæä¾›ä¸€ä¸ªdefineçš„å…¨å±€æ–¹æ³•ï¼Œç»™å¼€å‘è€…ç”¨æ¥å®šä¹‰æ¨¡å—ã€‚

è¿™é‡Œçš„RequireJSï¼Œæ˜¯ä¸€ç§AMDæ¨¡å—åŒ–è§„èŒƒçš„ä»£ç å®ç°ï¼Œçœ‹å®šä¹‰è¿‡ç¨‹ã€‚

```typescript
define('æ¨¡å—id', [
 // æ¨¡å—ä¾èµ–id
], function( /*æ¨¡å—ä¾èµ–çš„è·å–*/ ) {
  // æ¨¡å—ä¸»ä½“ä»£ç 
})
```

RequireJSé€šè¿‡è§£æä¾èµ–ï¼Œæ¥å¼‚æ­¥åŠ è½½æ‰€æœ‰çš„ä¾èµ–çš„AMDæ¨¡å—ï¼Œç­‰å¾…ä¾èµ–åŠ è½½å®Œåï¼Œå°±æ‰§è¡Œæ¨¡å—ä¸»ä½“ä»£ç ã€‚

### 3. IIFEæ¨¡å—åŒ–æ–¹æ¡ˆ

IIFEï¼Œå…¨ç§°æ˜¯Immediately Invoked Function Expressionï¼Œâ€œç«‹å³æ‰§è¡Œå‡½æ•°â€çš„æ„æ€ã€‚å¦‚æœè¦å®ç°æ¨¡å—åŒ–ï¼Œå°±éœ€è¦åœ¨IIFEä¸­ï¼ŒæŠŠä»£ç æŒ‚è½½åœ¨å…¨å±€å˜é‡ä¸Šã€‚

è¿™ä¹Ÿæ˜¯æ—©æœŸJavaScriptçš„æ¨¡å—åŒ–æ–¹æ¡ˆï¼Œæ ¹æ®ä¸åŒç¯å¢ƒï¼ŒæŠŠæ¨¡å—å…¨éƒ¨æŒ‚è½½åœ¨å¯¹åº”ç¯å¢ƒçš„å…¨å±€å˜é‡ä¸Šï¼Œæµè§ˆå™¨å°±æŒ‚è½½åœ¨â€œwindowâ€å¯¹è±¡ä¸Šï¼ŒNode.jså°±æŒ‚è½½åœ¨globalå…¨å±€å˜é‡ä¸Šã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/31/d1/318bc1393a3401a9c83d405f349333d1.jpg?wh=1920x1398)

å…³äºIIFEå…¨å±€å˜é‡æ¨¡å—åŒ–æ–¹æ¡ˆçš„ä»£ç æ¡ˆä¾‹ï¼Œæˆ‘ä»¬å°±ä¸å¤šè®²äº†ï¼Œéå¸¸ç®€å•ï¼Œå…·ä½“ä½ å¯ä»¥å‚è€ƒä»£ç æ¡ˆä¾‹æ‰€åœ¨ç›®å½•ï¼ˆpackages/mock-cdn/demos/iife/ï¼‰ã€‚

### 4. CJSæ¨¡å—åŒ–æ–¹æ¡ˆ

CJSï¼Œå…¨ç§°æ˜¯CommonJSæ¨¡å—åŒ–è§„èŒƒï¼Œç›®å‰ç”¨çš„æ¯”è¾ƒå¹¿æ³›æ˜¯åœ¨Node.jsç¯å¢ƒé‡Œï¼Œå› ä¸ºNode.jsåˆšè¯ç”Ÿçš„æ—¶å€™ï¼Œæ¨¡å—åŒ–æ–¹æ¡ˆæ˜¯åŸºäºCommonJSè§„èŒƒæ¥å®ç°çš„ï¼Œè€Œä¸”ï¼ŒCJSè§„èŒƒä¹Ÿæ˜¯åœ¨ES6è‰æ¡ˆç¡®å®šä¹‹å‰è¯ç”Ÿçš„ã€å…¼å®¹ES5çš„ç¯å¢ƒã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/f7/40/f7c62dce3e186255d8ed29fc95f3c440.jpg?wh=1920x1385)

CJSæ¯”è¾ƒé€‚åˆåœ¨Node.jsç¯å¢ƒä¸­ä½¿ç”¨ï¼Œåœ¨Node.jsæœåŠ¡ç«¯ä¸­æ‹¼æ¥ç‰©æ–™äº§ç‰©ï¼Œåœ¨æœåŠ¡ç«¯ç»„è£…æˆé¡µé¢çš„HTMLã€‚

ä»Šå¤©æˆ‘ä»¬ä¸»è¦è®²ç‰©æ–™äº§ç‰©çš„ç¼–è¯‘å’Œå‰ç«¯æµè§ˆå™¨é‡Œç‰©æ–™è¿è¡Œï¼Œå…³äºNode.jsæœåŠ¡ç«¯ç‰©æ–™äº§ç‰©ç»„è£…ï¼Œä¸å¤šè®²ï¼Œåé¢ä¼šä¸“é—¨åˆ†ææ­å»ºå¹³å°çš„ç‰©æ–™SSRæ¸²æŸ“ã€‚

å‰ç«¯ç»„ä»¶çš„å››ç§å¸¸è§æ¨¡å—åŒ–æ–¹æ¡ˆæˆ‘ä»¬å°±éƒ½äº†è§£äº†ï¼Œæ¯ä¸ªæ¨¡å—åŒ–æ–¹æ¡ˆéƒ½æœ‰ä¼˜ç¼ºç‚¹å’Œé€‚ç”¨åœºæ™¯ï¼Œå¯ä»¥æ ¹æ®ä¸åŒåœºæ™¯ï¼Œé€‰æ‹©å¯¹åº”çš„æ¨¡å—åŒ–æ–¹æ¡ˆã€‚

æˆ‘ä»¬æ—¥å¸¸å¼€å‘Vue.jsç»„ä»¶éƒ½æ˜¯TypeScriptè¯­æ³•æ¥å¼€å‘çš„ï¼Œé‚£ä¹ˆå¦‚ä½•ç¼–è¯‘æˆå¤šç§æ¨¡å—åŒ–æ ¼å¼å‘¢ï¼Ÿ

## Vue.jsç»„ä»¶å¦‚ä½•ç¼–è¯‘æˆå¤šç§æ¨¡å—ï¼Ÿ

ç›®å‰ä¸»æµçš„æ„å»ºå·¥å…·ï¼Œæ¯”å¦‚Webpackã€Rollupå’ŒViteï¼Œéƒ½å¯ä»¥åŸºäºå…¶æ’ä»¶ä½“ç³»ï¼Œæ¥æŠŠTypeScriptçš„Vue.jsç»„ä»¶ç¼–è¯‘æˆå¤šç§æ¨¡å—åŒ–æ ¼å¼æ–‡ä»¶ã€‚æ—¢ç„¶éƒ½å¯ä»¥æ¸²æŸ“ï¼Œæˆ‘ä»¬å°±ä¼˜å…ˆé€‰ç”¨Vue.jså®˜æ–¹æ ‡é…çš„æ„å»ºå·¥å…·Viteï¼Œè¿›è¡Œå¤šç§æ¨¡å—åŒ–ç¼–è¯‘ã€‚

ç›®å‰ï¼ŒViteé»˜è®¤æ”¯æŒESMã€AMDã€IIFEå’ŒCJSã€‚é‚£ä¹ˆViteå¦‚ä½•å®ç°AMDæ¨¡å—ç¼–è¯‘å‘¢ï¼Ÿ

å…¶å®Viteåº•å±‚ç”Ÿäº§æ¨¡å¼æ˜¯åŸºäºRollupæ¥è¿›è¡Œç¼–è¯‘çš„ï¼Œæˆ‘ä»¬å¯ä»¥å¼ºè¡Œä¼ å…¥AMDçš„é…ç½®æ¥æ‰§è¡Œç¼–è¯‘ã€‚çœ‹å…·ä½“é…ç½®ä»£ç ã€‚

```typescript
// scripts/build-materials.ts
import { build } from 'vite';
import pluginVue from '@vitejs/plugin-vue';
import pluginVueJsx from '@vitejs/plugin-vue-jsx';
import { resolvePackagePath, readFile } from './util';
import type { InlineConfig } from 'vite';

function getBuildConfig(opts: {
  name: string;
  version: string;
  dirName: string;
  libName: string;
}): InlineConfig {
  const { dirName, libName } = opts;
  const config: InlineConfig = {
    plugins: [pluginVue(), pluginVueJsx()],
    build: {
      target: 'esnext',
      minify: false,
      emptyOutDir: true,
      outDir: resolvePackagePath(dirName, 'dist'),
      lib: {
        name: libName,
        entry: resolvePackagePath(dirName, 'src', 'index.ts'),
        formats: ['es', 'cjs', 'iife'],
        fileName: (format) => {
          if (format === 'es') {
            format = 'esm';
          }
          return `index.${format}.js`;
        }
      },
      rollupOptions: {
        preserveEntrySignatures: 'strict',
        external: ['vue', '@vue/components'],
        output: {
          globals: {
            vue: 'Vue',
            '@vue/components': 'MyVueComponents'
          },
          assetFileNames: 'index[extname]'
        }
      }
    }
  };
  return config;
}

function getBuildAMDConfig(opts: {
  name: string;
  version: string;
  dirName: string;
  libName: string;
}): InlineConfig {
  const { dirName, name, libName } = opts;
  const config: InlineConfig = {
    plugins: [pluginVue(), pluginVueJsx()],
    build: {
      // target: 'esnext',
      minify: false,
      emptyOutDir: false,
      outDir: resolvePackagePath(dirName, 'dist'),
      lib: {
        name: libName,
        entry: resolvePackagePath(dirName, 'src', 'index.ts'),
        // eslint-disable-next-line @typescript-eslint/ban-ts-comment
        // @ts-ignore
        formats: ['amd'],
        fileName: () => {
          return 'index.amd.js';
        }
      },
      rollupOptions: {
        preserveEntrySignatures: 'strict',
        external: ['vue', '@vue/components'],
        output: {
          name: name,
          format: 'amd',
          amd: {
            id: name
          },
          globals: {
            vue: 'vue',
            '@vue/components': '@vue/components'
          },
          assetFileNames: 'index.amd[extname]'
        }
      }
    }
  };
  return config;
}

async function main() {
  console.log('æ‰§è¡Œç‰©æ–™ç¼–è¯‘...');
  const materialList = [
    {
      name: require('../packages/material-product-list/package.json').name,
      version: require('../packages/material-product-list/package.json')
        .version,
      dirName: 'material-product-list',
      libName: 'MyMaterialProdcutList'
    },
    {
      name: require('../packages/material-banner-slides/package.json').name,
      version: require('../packages/material-banner-slides/package.json')
        .version,
      dirName: 'material-banner-slides',
      libName: 'MyMaterialBannerSlides'
    }
  ];
  for (const opts of materialList) {
    console.log(`å¼€å§‹ç¼–è¯‘ç‰©æ–™ ${opts.dirName}`);
    const config = getBuildConfig(opts);
    const configAMD = getBuildAMDConfig(opts);
    await build(config);
    await build(configAMD);
  }
}

main();

```

åœ¨Viteç¼–è¯‘ä»£ç ä¸­ï¼Œæˆ‘ç”¨ä¸€ä¸ªViteé…ç½®ç¼–è¯‘å‡ºESMã€CJSå’ŒIIFEçš„æ¨¡å—åŒ–æ ¼å¼ä»£ç ï¼Œç”¨å¦ä¸€ä¸ªç‹¬ç«‹çš„Viteé…ç½®ç¼–è¯‘AMDæ¨¡å—ä»£ç ã€‚å¦‚æœä»¥åViteä¸æ”¯æŒå¼ºè¡Œç¼–è¯‘AMDçš„æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç‹¬ç«‹ç”¨Rollupæ¥è¿›è¡Œç¼–è¯‘ã€‚

åœ¨ä»Šå¤©æ¡ˆä¾‹çš„Â scripts/build-materials.ts æ–‡ä»¶é‡Œï¼Œæˆ‘å°±ç”¨ä¸€ä¸ªVite ç¼–è¯‘è„šæœ¬ï¼Œç¼–è¯‘äº†æ¡ˆä¾‹çš„ä¸¤ä¸ªç‰©æ–™ç»„ä»¶ï¼Œå½¢æˆå¤šç§æ¨¡å—åŒ–æ ¼å¼ï¼Œå…·ä½“ä½ å¯ä»¥è¯¾åçœ‹æ¡ˆä¾‹ä»£ç å®ç°ã€‚

ç°åœ¨æˆ‘ä»¬ç¼–è¯‘å‡ºäº†å¤šç§æ¨¡å—æ ¼å¼ï¼Œåœ¨æ­å»ºå¹³å°é¡¹ç›®ä¸­ï¼Œå¦‚ä½•å®ç°ç‰©æ–™äº§ç‰©çš„ç®¡ç†å’Œè¿è¡Œå‘¢ï¼Ÿ

## å¦‚ä½•ç®¡ç†å’Œè¿è¡Œå„ç§æ¨¡å—åŒ–çš„ç‰©æ–™ç»„ä»¶ï¼Ÿ

æ—¢ç„¶æˆ‘ä»¬å®ç°äº†ç‰©æ–™ï¼Œä¹Ÿå°±æ˜¯Vue.jsç»„ä»¶å„ç§æ¨¡å—åŒ–æ ¼å¼çš„ç¼–è¯‘äº§ç‰©ã€‚æ¥ä¸‹æ¥å¯¹äº§ç‰©çš„ç®¡ç†å’Œè¿è¡Œï¼Œä¸»è¦æœ‰å››æ­¥ã€‚

- ç¬¬ä¸€æ­¥ï¼ŒæŠŠç‰©æ–™çš„Vue.jsç»„ä»¶ç¼–è¯‘å¤šç§æ¨¡å—åŒ–æ ¼å¼ã€‚
- ç¬¬äºŒæ­¥ï¼ŒæŠŠå„ç§æ¨¡å—åŒ–æ–‡ä»¶å‘å¸ƒåˆ°ç§æœ‰NPMç«™ç‚¹æˆ–è€…CDNæœåŠ¡ã€‚
- ç¬¬ä¸‰æ­¥ï¼Œå‰å°å’Œåå°æœåŠ¡å„è‡ªè¯»å–CDNä¸Šçš„ç‰©æ–™ï¼Œè¿›è¡Œæ‹¼æ¥é¡µé¢ã€‚
- ç¬¬å››æ­¥ï¼Œå®ç°å„ç§æ¨¡å—åŒ–ä»£ç æ‰§è¡Œçš„è¿è¡Œæ—¶ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/b9/11/b9f3ca16a6473e31fbf486a53a0b8111.jpg?wh=1920x1033)

æˆ‘ä»¬é€æ­¥åˆ†æã€‚

ç¬¬ä¸€æ­¥ï¼Œç¼–è¯‘Vue.jsç»„ä»¶ï¼Œéœ€è¦ä½ æ ¹æ®è‡ªå·±ä¼ä¸šçš„æŠ€æœ¯åŸºå»ºåšé€‰æ‹©ï¼Œæˆ‘ä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼Œå°±åœ¨è¯¾ç¨‹ä»£ç æ¡ˆä¾‹çš„monorepoä»“åº“ä¸­ï¼Œç®¡ç†äº†ä¸¤ä¸ªç‰©æ–™ç»„ä»¶material-banner-slideså’Œmaterial-product-listï¼Œç„¶åè¿›è¡ŒViteçš„æ„å»ºç¼–è¯‘ã€‚

ç¬¬äºŒæ­¥ï¼ŒæŠŠå„ç§æ¨¡å—åŒ–æ–‡ä»¶å‘å¸ƒåˆ°CDNä¸Šã€‚å¦‚æœä½ è‡ªå·±ä¼ä¸šå†…éƒ¨æœ‰ç§æœ‰NPMç«™ç‚¹ï¼Œå°±å‘å¸ƒåˆ°ç§æœ‰NPMç«™ç‚¹ï¼Œå¦‚æœæœ‰CDNæœåŠ¡ï¼Œå°±å‘å¸ƒåˆ°CDNæœåŠ¡ä¸Šã€‚æŸç§æ„ä¹‰ä¸Šè®²ï¼ŒNPMä¹Ÿæ˜¯ä¸€ç§CDNæœåŠ¡ã€‚

è¿™é‡Œä½ éœ€è¦æ³¨æ„ï¼Œ**æ¯æ¬¡å‘å¸ƒç‰©æ–™æ¨¡å—æ–‡ä»¶ï¼Œéƒ½éœ€è¦ä¿®æ”¹ç»„ä»¶çš„ç‰ˆæœ¬**ï¼Œå› ä¸ºæ¯æ¬¡ç”Ÿäº§çš„ç‰©æ–™æ–‡ä»¶éƒ½æ˜¯ä¸ä¼šè¢«è¦†ç›–çš„ï¼Œä¼šéšç€ç‰ˆæœ¬å¢åŠ ï¼Œæ–¹ä¾¿åç»­ç‰©æ–™å‡ºé—®é¢˜åå¯ä»¥è¿›è¡Œå¿«é€Ÿå›æ»šå¤„ç†ã€‚

åœ¨è¯¾ç¨‹çš„ä»£ç æ¡ˆä¾‹é‡Œï¼Œä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼Œæˆ‘åœ¨monorepoé¡¹ç›®ä¸­ç”¨ä¸€ä¸ªå­é¡¹ç›®mock-cdnï¼Œæ¨¡æ‹Ÿäº†ä¸€ä¸ªCDNæ¥å­˜å‚¨å…¬å…±ç‰©æ–™ã€‚ä¹‹åæˆ‘æŠŠä¸¤ä¸ªç‰©æ–™å‘å¸ƒåˆ°monorepoçš„â€œæ¨¡æ‹ŸCDNâ€ ä¸­ã€‚

ç¬¬ä¸‰æ­¥ï¼Œå‰å°å’Œåå°æœåŠ¡ï¼Œæ ¹æ®è‡ªå·±æ‰€éœ€è¦ç”¨åˆ°çš„ç‰©æ–™äº§ç‰©ï¼Œå„è‡ªè¯»å–CDNä¸Šçš„ç‰©æ–™ï¼Œæ–¹ä¾¿åç»­æµè§ˆå™¨è·å–å¯¹åº”æœåŠ¡çš„ç‰©æ–™äº§ç‰©ã€‚è¯¾ç¨‹çš„ä»£ç æ¡ˆä¾‹ï¼Œæˆ‘å°±ä»mock-cdnè¿™ä¸ªæ¨¡æ‹ŸCDNæ¥è·å–å…¬å…±ç‰©æ–™æ–‡ä»¶ã€‚

ç¬¬å››æ­¥ï¼Œå®ç°å„ç§æ¨¡å—åŒ–ä»£ç æ‰§è¡Œçš„è¿è¡Œæ—¶ï¼Œæ ¹æ®é¡µé¢çš„é…ç½®æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯é¡µé¢ç”¨äº†å“ªäº›ç‰©æ–™ï¼Œè¿›è¡Œæ‹¼æ¥æ¸²æŸ“é¡µé¢ã€‚

æˆ‘åœ¨è¯¾ç¨‹çš„ä»£ç æ¡ˆä¾‹ä¸­ï¼ŒåŸºäºå‰å°åœºæ™¯ï¼Œåœ¨æµè§ˆå™¨ä¸­ï¼Œå®ç°äº†ESMæ¨¡å—åŒ–çš„è¿è¡Œæ—¶ã€AMDæ¨¡å—åŒ–è¿è¡Œæ—¶å’ŒIIFEæ¨¡å—åŒ–è¿è¡Œæ—¶ã€‚å…ˆå®šä¹‰äº†å…¬ç”¨çš„é¡µé¢ç‰©æ–™é…ç½®æ•°æ®ã€‚

```typescript
// packages/portal-front/src/demos/util.ts
export interface LayoutConfig {
  materials: Array<{
    name: string;
    globalName: string;
    version: string;
    props: Record<string, any>;
  }>;
}

export const layout: LayoutConfig = {
  materials: [
    {
      name: '@my/material-banner-slides',
      version: '0.1.0',
      globalName: 'MyMaterialBannerSlides',
      props: {
        style: { height: 100 }
      }
    },
    {
      name: '@my/material-product-list',
      version: '0.1.0',
      globalName: 'MyMaterialProdcutList',
      props: {}
    }
  ]
};
```

ç„¶åå®ç°äº†ä¸€äº›å…¬å…±å·¥å…·æ–¹æ³•å’Œå…¬ç”¨é…ç½®ã€‚

```typescript
// packages/portal-front/src/demos/util.ts
export const CDN_BASE_URL = '/public/cdn/';

export async function loadMaterialStyle(params: {
  name: string;
  version: string;
}) {
  const { name, version } = params;
  const materialId = `${name}/${version}`;
  if (
    document.querySelectorAll(`style[data-material-id="${materialId}"]`)
      ?.length > 0
  ) {
    return;
  }
  const url = `${CDN_BASE_URL}/material/${name}/${version}/index.css`;
  const text = await fetch(url).then((res) => res.text());
  const style = document.createElement('style');
  style.setAttribute('data-material-id', materialId);
  style.innerHTML = text;
  const head =
    document.querySelector('head') ||
    document.querySelector('body') ||
    document.querySelector('html');

  head?.appendChild(style);
}

export function loadScript(url: string): Promise<void> {
  return new Promise((resolve, reject) => {
    const script = document.createElement('script');
    script.src = url;
    document.body.appendChild(script);
    script.onload = () => {
      resolve();
    };
    script.onerror = () => {
      reject();
    };
  });
}

export async function render(opts: {
  Vue: any;
  moduleMap: { [id: string]: any | { default: any } };
  layout: LayoutConfig;
}) {
  const { moduleMap, layout, Vue } = opts;
  const { h, createApp } = Vue;
  const children = layout.materials.map((item: any) => {
    return h(
      moduleMap[item.name]?.default || moduleMap[item.name],
      item?.props || {}
    );
  });
  const App = {
    setup() {
      return () => {
        return h('div', {}, children);
      };
    }
  };

  const app = createApp({
    render() {
      return h(App, {});
    }
  });
  app.mount('#app');
}

```

æœ€åå®ç°ESMã€AMDå’ŒIIFEä¸‰ç§æ¨¡å—æ ¼å¼åœ¨æµè§ˆå™¨çš„è¿è¡Œæ—¶ã€‚

ESMç‰©æ–™ç»„è£…è¿è¡Œæ—¶ã€‚

```typescript
import { CDN_BASE_URL, render, loadMaterialStyle, layout } from '../util';

async function loadMaterialESModule(params: { name: string; version: string }) {
  const { name, version } = params;
  return import(
    /* @vite-ignore */
    `${CDN_BASE_URL}material/${name}/${version}/index.esm.js`
  );
}

async function loadESModule(name: string) {
  return import(
    /* @vite-ignore */
    `${name}`
  );
}

async function runtime() {
  const moduleMap: any = {};
  for (const item of layout.materials) {
    const { name, version } = item;
    const Module = await loadMaterialESModule({
      name,
      version
    });
    await loadMaterialStyle({ name, version });
    moduleMap[name] = Module;
  }
  const Vue: any = await loadESModule('vue');
  await render({ Vue, moduleMap, layout });
}

runtime();
```

AMDç‰©æ–™ç»„è£…è¿è¡Œæ—¶ã€‚

```typescript
import { CDN_BASE_URL, render, loadMaterialStyle, layout } from '../util';

async function runtime() {
  const paths: Record<string, string> = {};
  layout.materials.forEach((m) => {
    paths[m.name] = `material/${m.name}/${m.version}/index.amd`;
  });
 
  window.requirejs.config({
    baseUrl: CDN_BASE_URL,
    paths
  });
 
  window.require(
    ['vue', 'require', ...layout.materials.map((m) => m.name)],
    (Vue: any, require: any) => {
      const moduleMap: any = {};
      for (const m of layout.materials) {
        const { name, version } = m;
        loadMaterialStyle({ name, version });
        moduleMap[name] = require(name);
      }
      render({ Vue, moduleMap, layout });
    }
  );
}

runtime();
```

è¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹ï¼Œ**AMDè¿è¡Œæ—¶éœ€è¦ä¾èµ–RequireJSï¼Œæ¥å®ç°AMDæ¨¡å—çš„åŠ è½½å’Œè¿è¡Œ**ã€‚

IIFEç‰©æ–™ç»„è£…è¿è¡Œæ—¶ã€‚

```typescript
import {
  CDN_BASE_URL,
  render,
  loadMaterialStyle,
  layout,
  loadScript
} from '../util';

async function runtime() {
  const moduleMap: any = {};
  for (const item of layout.materials) {
    const { name, version, globalName } = item;
    await loadScript(
      `${CDN_BASE_URL}/material/${name}/${version}/index.iife.js`
    );
    await loadMaterialStyle({ name, version });
    moduleMap[name] = window[globalName] as any;
  }

  const Vue: any = window.Vue;
  await render({ Vue, moduleMap, layout });
}

runtime();

```

åœ¨æ‰€æœ‰ç»„è£…ç‰©æ–™çš„è¿è¡Œæ—¶ä»£ç ä¸­ï¼Œä½ è¦æ³¨æ„ï¼Œ**æˆ‘ä»¬éœ€è¦åœ¨è¿è¡Œæ—¶ä¸­ï¼Œç”¨JavaScriptæ¥æ‰‹åŠ¨åŠ è½½CSSæ–‡ä»¶**ã€‚è¿™ä¸ªCSSæ˜¯æ²¡æœ‰æ¨¡å—åŒ–åŒºåˆ†çš„ï¼Œé¢å‘æ‰€æœ‰æ¨¡å—åŒ–æ ¼å¼ï¼Œéƒ½æ˜¯é€šç”¨çš„ã€‚

ä»£ç ä¸­æœ€ç»ˆç»„è£…ç‰©æ–™çš„æ•ˆæœå›¾ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/c1/ec/c1cd75cb16447df0d57e5234fae5edec.png?wh=1920x1385)

## æ€»ç»“

ä»Šå¤©æˆ‘ä»¬å­¦ä¹ äº†å‰ç«¯ç»„ä»¶çš„æ¨¡å—åŒ–å’Œè¿è¥æ­å»ºå¹³å°ç‰©æ–™çš„äº§ç‰©ç®¡ç†ï¼Œä¹Ÿå°±æ˜¯Vue.jsç»„ä»¶çš„æ¨¡å—åŒ–ç®¡ç†ï¼Œä¸ºåé¢ç‰©æ–™æ­å»ºé¡µé¢æ‰“å¥½åŸºç¡€ã€‚

æ€»ç»“ä¸€ä¸‹ä¸åŒæ¨¡å—æ ¼å¼çš„ä¼˜ç¼ºç‚¹ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/f7/40/f7c62dce3e186255d8ed29fc95f3c440.jpg?wh=1920x1385)

å¦‚æœç°åœ¨éœ€è¦ä½ åšä¸ªç»ˆæé€‰æ‹©ï¼Œæˆ‘ä»¬å¹³å°é¡¹ç›®ä¸­è¦é€‰æ‹©å“ªç§æ¨¡å—æ–¹å¼å‘¢ï¼Ÿ

ç­”æ¡ˆæ˜¯å…¨éƒ½è¦ã€‚å› ä¸ºæµè§ˆå™¨ç«¯æŠŠæ¡åœ¨ç”¨æˆ·æ‰‹é‡Œï¼Œæˆ‘ä»¬æ— æ³•é¢„æµ‹å®é™…ä»£ç åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¼šå‡ºç°ä»€ä¹ˆå…¼å®¹é—®é¢˜ï¼Œå¦‚æœå¹³å°æ¸²æŸ“èƒ½æ”¯æŒå¤šé‡æ¨¡å—æ ¼å¼ï¼Œå°±æ„å‘³ç€å¯ä»¥åšä¸€äº›ä¼˜åŒ–ç­–ç•¥ï¼Œåœ¨ä½ç‰ˆæœ¬æµè§ˆå™¨ä¸­ï¼Œå°±å¯ä»¥ä¼˜å…ˆé€‰æ‹©å¯¹åº”èƒ½æ”¯æŒçš„æ¨¡å—æ ¼å¼ã€‚

åœ¨å®ç°è¿è¥æ­å»ºå¹³å°çš„ç‰©æ–™äº§ç‰©ç®¡ç†æ—¶ï¼Œæœ‰ä¸¤ç‚¹è¦æ³¨æ„ï¼š

- å¹³å°ä¸æ˜¯ç‹¬ç«‹çš„ä¸€ä¸ªå·¥ç¨‹ï¼Œä½ éœ€è¦æ ¹æ®è‡ªèº«ä¼ä¸šæŠ€æœ¯åŸºå»ºï¼Œè¿›è¡Œå·¥ç¨‹èƒ½åŠ›æ•´åˆï¼Œä¾‹å¦‚å¯¹ä¼ä¸šå†…éƒ¨çš„CDNæœåŠ¡æˆ–è€…NPMç§æœ‰æœåŠ¡çš„å¯¹æ¥ã€‚
- ç‰©æ–™äº§ç‰©éœ€è¦ç‰ˆæœ¬åŒ–ç®¡ç†ï¼Œä¹Ÿå°±æ˜¯Vue.jsç»„ä»¶æ¯æ¬¡è¿­ä»£ç¼–è¯‘ï¼Œéƒ½éœ€è¦å‘å¸ƒä¸€ä¸ªæ–°ç‰ˆæœ¬ï¼Œæ–¹ä¾¿å‡ºé—®é¢˜åå¿«é€Ÿå›æ»šçº¿ä¸Šä»£ç ã€‚

## æ€è€ƒé¢˜

å‰å°åœºæ™¯è¿è¡Œé¡µé¢æ—¶ï¼Œé€šè¿‡ESMæˆ–è€…AMDæ ¼å¼è¿›è¡Œå¼‚æ­¥åŠ è½½ç‰©æ–™çš„ä»£ç æ–‡ä»¶ï¼Œå¦‚æœé¡µé¢ä¾èµ–çš„ç‰©æ–™å˜å¤šäº†ï¼Œç‰©æ–™æ–‡ä»¶è¯·æ±‚ä¹Ÿä¼šå˜å¤šï¼Œè¿™ä¼šå½±å“é¡µé¢æ‰“å¼€æ—¶é—´å—ï¼Ÿæœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥æé«˜é¡µé¢æ‰“å¼€æ—¶é—´å—ï¼Ÿ

æ¬¢è¿ç•™è¨€å‚ä¸è®¨è®ºï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ã€‚

### [å®Œæ•´çš„](https://github.com/FE-star/vue3-course/tree/main/chapter/18)[ä»£ç åœ¨è¿™é‡Œ](https://github.com/FE-star/vue3-course/tree/main/chapter/22)
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ4ï¼‰</strong></div><ul>
<li><span>å¨˜å¨˜é©¾åˆ°***çš‡ä¸Šè·ªä¸‹</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆæä¸ªé—®é¢˜ï¼šè¿™ä¸ª@my&#47;componentæ˜¯æ€ä¹ˆè¢«ä½œä¸ºä¾èµ–å®‰è£…åˆ°node_modulesä¸‹çš„ï¼Œpackageä¸‹å­åº”ç”¨ä¹‹é—´çš„ç›¸äº’å¼•ç”¨ä¹ˆï¼Ÿè¿™ä¸ªå…·ä½“çœ‹å“ªä¸€å—ï¼Ÿ</p>2023-03-14</li><br/><li><span>ifelse</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>å­¦ä¹ æ‰“å¡</p>2024-09-23</li><br/><li><span>å‰ç«¯WLOP</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>ESMçš„importä¸æ”¯æŒè·¯å¾„çš„åŠ¨æ€å¯¼å…¥å•Š

const Module = await import(`&#47;demos&#47;esm&#47;material&#47;${m.name}.js`)</p>2024-08-30</li><br/><li><span>Akili</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>å­¦ä¹ äº†ã€‚</p>2023-02-19</li><br/>
</ul>