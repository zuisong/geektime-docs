<!--geek time docs 🚀, MIT license-->


<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="极客时间文档">
      
      
        <meta name="author" content="zkep">
      
      
        <link rel="canonical" href="https://github.com/uaxe/geektime-docs/%E5%89%8D%E7%AB%AF-%E7%A7%BB%E5%8A%A8/React%20Native%20%E6%96%B0%E6%9E%B6%E6%9E%84%E5%AE%9E%E6%88%98%E8%AF%BE/22-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6%EF%BC%9A%E5%A6%82%E4%BD%95%E6%BB%A1%E8%B6%B3%E4%B8%9A%E5%8A%A1%E7%9A%84%E4%B8%AA%E6%80%A7%E5%8C%96%E9%9C%80%E6%B1%82%EF%BC%9F/">
      
      
        <link rel="prev" href="../21-%E6%B7%B7%E5%90%88%E5%BA%94%E7%94%A8%EF%BC%9A%E5%A6%82%E4%BD%95%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E9%9B%86%E6%88%90React%20Native%EF%BC%9F/">
      
      
        <link rel="next" href="../23-%E7%83%AD%E6%9B%B4%E6%96%B0%EF%BC%9A%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%83%AD%E6%9B%B4%E6%96%B0%E5%B9%B3%E5%8F%B0%EF%BC%9F/">
      
      
      <link rel="icon" href="../../../None">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.5">
    
    
      
        <title>22 自定义组件：如何满足业务的个性化需求？ - 极客时间文档</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../stylesheets/style.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            


          </div>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="极客时间文档" class="md-header__button md-logo" aria-label="极客时间文档" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            极客时间文档
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              22 自定义组件：如何满足业务的个性化需求？
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/zkep/my-geektime" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    zkep/my-geektime
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../AI-%E5%A4%A7%E6%95%B0%E6%8D%AE/" class="md-tabs__link">
          
  
    
  
  AI-大数据

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E4%BA%A7%E5%93%81-%E8%BF%90%E8%90%A5/" class="md-tabs__link">
          
  
    
  
  产品-运营

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
    
  
  前端-移动

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E5%90%8E%E7%AB%AF-%E6%9E%B6%E6%9E%84/" class="md-tabs__link">
          
  
    
  
  后端-架构

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E7%AE%A1%E7%90%86-%E6%88%90%E9%95%BF/" class="md-tabs__link">
          
  
    
  
  管理-成长

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" class="md-tabs__link">
          
  
    
  
  计算机基础

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E8%BF%90%E7%BB%B4-%E6%B5%8B%E8%AF%95/" class="md-tabs__link">
          
  
    
  
  运维-测试

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="极客时间文档" class="md-nav__button md-logo" aria-label="极客时间文档" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    极客时间文档
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/zkep/my-geektime" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    zkep/my-geektime
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../AI-%E5%A4%A7%E6%95%B0%E6%8D%AE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    AI-大数据
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E4%BA%A7%E5%93%81-%E8%BF%90%E8%90%A5/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    产品-运营
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    前端-移动
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            前端-移动
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Android%E5%BC%80%E5%8F%91%E9%AB%98%E6%89%8B%E8%AF%BE/Android%E5%BC%80%E5%8F%91%E9%AB%98%E6%89%8B%E8%AF%BE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Android开发高手课
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Flutter%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/Flutter%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Flutter核心技术与实战
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../JavaScript%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/JavaScript%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    JavaScript核心原理解析
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../JavaScript%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98%E8%AF%BE/JavaScript%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98%E8%AF%BE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    JavaScript进阶实战课
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../React%20Hooks%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98/React%20Hooks%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    React Hooks 核心原理与实战
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" checked>
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    React Native 新架构实战课
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            React Native 新架构实战课
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../React%20Native%20%E6%96%B0%E6%9E%B6%E6%9E%84%E5%AE%9E%E6%88%98%E8%AF%BE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React Native 新架构实战课
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%BC%80%E7%AF%87%E8%AF%8D-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E9%80%89%E6%8B%A9React%20Native%E5%81%9A%E4%BD%A0%E7%9A%84%E8%B7%A8%E7%AB%AF%E6%96%B9%E6%A1%88%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    开篇词 为什么要选择React Native做你的跨端方案？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%8A%A0%E9%A4%90-%E9%9B%86%E4%B8%AD%E7%AD%94%E7%96%91%EF%BC%9A%E8%AF%A6%E8%A7%A3Android%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    加餐 集中答疑：详解Android环境搭建
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%8A%A0%E9%A4%90-%E9%9B%86%E4%B8%AD%E7%AD%94%E7%96%91%EF%BC%9A%E8%AF%A6%E8%A7%A3iOS%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    加餐 集中答疑：详解iOS环境搭建
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-%E5%AD%A6%E4%B9%A0React%20Native%EF%BC%8C%E4%BD%A0%E9%9C%80%E8%A6%81%E6%8E%8C%E6%8F%A1%E5%93%AA%E4%BA%9B%E7%9F%A5%E8%AF%86%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    01 学习React Native，你需要掌握哪些知识？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-Component%EF%BC%9A%E6%90%AD%E5%BB%BA%E9%9D%99%E6%80%81%E9%A1%B5%E9%9D%A2%E7%9A%84%E6%AD%A3%E7%A1%AE%E6%80%9D%E8%B7%AF%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    02 Component：搭建静态页面的正确思路是什么？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-Style%EF%BC%9A%E5%85%B3%E4%BA%8E%E6%A0%B7%E5%BC%8F%E4%BD%A0%E9%9C%80%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%B8%89%E4%BB%B6%E4%BA%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    03 Style：关于样式你需要知道的三件事
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-State%EF%BC%9A%E5%A6%82%E4%BD%95%E8%AE%A9%E9%A1%B5%E9%9D%A2%E2%80%9C%E5%8A%A8%E2%80%9D%E8%B5%B7%E6%9D%A5%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    04 State：如何让页面“动”起来？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-Image%EF%BC%9A%E9%80%89%E6%8B%A9%E9%80%82%E5%90%88%E4%BD%A0%E7%9A%84%E5%9B%BE%E7%89%87%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    05 Image：选择适合你的图片加载方式
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-Pressable%EF%BC%9A%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E4%BD%93%E9%AA%8C%E5%A5%BD%E7%9A%84%E7%82%B9%E6%8C%89%E7%BB%84%E4%BB%B6%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    06 Pressable：如何实现一个体验好的点按组件？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07-TextInput%EF%BC%9A%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E4%BD%93%E9%AA%8C%E5%A5%BD%E7%9A%84%E8%BE%93%E5%85%A5%E6%A1%86%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    07 TextInput：如何实现一个体验好的输入框？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../08-List%EF%BC%9A%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%E6%97%A0%E9%99%90%E5%88%97%E8%A1%A8%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    08 List：如何实现高性能的无限列表？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../09-Fast%20Refresh%EF%BC%9A%E6%8F%90%E9%AB%98UI%E8%B0%83%E8%AF%95%E6%95%88%E7%8E%87%E7%A5%9E%E5%99%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    09 Fast Refresh：提高UI调试效率神器
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-Debug%EF%BC%9A%E8%A7%A3%E5%86%B3BUG%E6%80%9D%E8%B7%AF%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10 Debug：解决BUG思路有哪些？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../11-%E7%BB%84%E4%BB%B6%E5%AE%9E%E6%88%98%EF%BC%9A%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%80%91%E5%B8%83%E6%B5%81%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    11 组件实战：如何实现瀑布流？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../12-%E9%A1%B5%E9%9D%A2%E5%AE%9E%E6%88%98%EF%BC%9A%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%94%B5%E5%95%86%E9%A6%96%E9%A1%B5%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    12 页面实战：如何搭建一个电商首页？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%9B%B4%E6%92%AD%E5%8A%A0%E9%A4%90-%E4%B8%83%E5%B9%B4%EF%BC%8C%E6%88%91%E7%9A%84%E8%B7%A8%E7%AB%AF%E5%AE%9E%E8%B7%B5%E5%92%8C%E6%8E%A2%E7%B4%A2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    直播加餐 七年，我的跨端实践和探索
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../13-%E7%94%9F%E6%80%81%EF%BC%9AReact%20Native%20Awesome/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    13 生态：React Native Awesome
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../14-Reanimated%EF%BC%9A%E5%A6%82%E4%BD%95%E8%AE%A9%E5%8A%A8%E7%94%BB%E5%8F%98%E5%BE%97%E6%9B%B4%E6%B5%81%E7%95%85%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    14 Reanimated：如何让动画变得更流畅？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../15-Gesture%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9A%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E6%8B%96%E6%8B%BD%E5%8A%A8%E6%95%88%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    15 Gesture（上）：如何实现一个拖拽动效？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../16-Gesture%EF%BC%88%E4%B8%AD%EF%BC%89%EF%BC%9A%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%8D%95%E8%A7%86%E5%9B%BE%E5%A4%9A%E6%89%8B%E5%8A%BF%E7%9A%84%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    16 Gesture（中）：如何解决单视图多手势的冲突问题？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../17-Gesture%EF%BC%88%E4%B8%8B%EF%BC%89%EF%BC%9A%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%A4%9A%E8%A7%86%E5%9B%BE%E5%A4%9A%E6%89%8B%E5%8A%BF%E7%9A%84%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    17 Gesture（下）：如何解决多视图多手势的冲突问题？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../18-Navigation%EF%BC%9A%E9%A1%B5%E9%9D%A2%E4%B9%8B%E9%97%B4%E6%80%8E%E4%B9%88%E8%B7%B3%E8%BD%AC%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    18 Navigation：页面之间怎么跳转？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../19-Redux%EF%BC%9A%E5%A4%A7%E5%9E%8B%E5%BA%94%E7%94%A8%E5%BA%94%E8%AF%A5%E5%A6%82%E4%BD%95%E7%AE%A1%E7%90%86%E7%8A%B6%E6%80%81%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    19 Redux：大型应用应该如何管理状态？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../20-Sentry%EF%BC%9A%E7%BA%BF%E4%B8%8A%E9%94%99%E8%AF%AF%E4%B8%8E%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E6%80%8E%E4%B9%88%E5%A4%84%E7%90%86%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    20 Sentry：线上错误与性能监控怎么处理？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../21-%E6%B7%B7%E5%90%88%E5%BA%94%E7%94%A8%EF%BC%9A%E5%A6%82%E4%BD%95%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E9%9B%86%E6%88%90React%20Native%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    21 混合应用：如何从零开始集成React Native？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    22 自定义组件：如何满足业务的个性化需求？
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    22 自定义组件：如何满足业务的个性化需求？
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      新架构介绍
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      组件的生命周期
    </span>
  </a>
  
    <nav class="md-nav" aria-label="组件的生命周期">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#android" class="md-nav__link">
    <span class="md-ellipsis">
      Android
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ios" class="md-nav__link">
    <span class="md-ellipsis">
      iOS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      组件传输数据类型
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#react-native" class="md-nav__link">
    <span class="md-ellipsis">
      React Native 与原生的通信方式
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#turbomodule" class="md-nav__link">
    <span class="md-ellipsis">
      TurboModule：数据存取
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TurboModule：数据存取">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#javascript" class="md-nav__link">
    <span class="md-ellipsis">
      JavaScript
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#android_1" class="md-nav__link">
    <span class="md-ellipsis">
      Android
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ios_1" class="md-nav__link">
    <span class="md-ellipsis">
      iOS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fabric" class="md-nav__link">
    <span class="md-ellipsis">
      Fabric：视频播放
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fabric：视频播放">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#javascipt" class="md-nav__link">
    <span class="md-ellipsis">
      JavaScipt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#android_2" class="md-nav__link">
    <span class="md-ellipsis">
      Android
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ios_2" class="md-nav__link">
    <span class="md-ellipsis">
      iOS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      作业
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../23-%E7%83%AD%E6%9B%B4%E6%96%B0%EF%BC%9A%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%83%AD%E6%9B%B4%E6%96%B0%E5%B9%B3%E5%8F%B0%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    23 热更新：如何搭建一个热更新平台？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../24-%E6%8B%86%E5%8C%85%EF%BC%9AMetro%E6%8B%86%E5%8C%85%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    24 拆包：Metro拆包的工作原理是什么？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../25-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%EF%BC%9A%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E5%90%88%E9%80%82%E7%9A%84%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    25 性能优化：如何设计一个合适的性能优化方案？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../26-%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BC%98%E5%8C%96%EF%BC%9A%E5%A6%82%E4%BD%95%E6%8A%8A%E6%80%A7%E8%83%BD%E6%8F%90%E5%8D%87%E5%88%B0%E6%9E%81%E8%87%B4%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    26 客户端优化：如何把性能提升到极致？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E9%98%B6%E6%AE%B5%E6%B5%8B%E8%AF%95-React%20Native%E7%9A%84%E8%BF%99%E4%BA%9B%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%EF%BC%8C%E4%BD%A0%E9%83%BD%E6%8E%8C%E6%8F%A1%E4%BA%86%E5%90%97%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    阶段测试 React Native的这些核心知识，你都掌握了吗？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%80%BB%E7%BB%93%E4%B8%8E%E5%B1%95%E6%9C%9B-%E6%96%B0%E6%9E%B6%E6%9E%84%E6%8E%A2%E7%B4%A2%E4%B9%8B%E6%97%85%EF%BC%8C%E9%A9%AC%E4%B8%8A%E5%BC%80%E5%A7%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    总结与展望 新架构探索之旅，马上开始
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../27-%E8%B7%A8%E7%AB%AF%E7%9A%84%E6%9C%BA%E9%81%87%EF%BC%9A%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%81Flutter%E5%92%8CReact%20Native%E5%8E%9F%E7%90%86%E5%AF%B9%E6%AF%94/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    27 跨端的机遇：小程序、Flutter和React Native原理对比
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../28-%E8%BF%BD%E6%9C%AC%E6%BA%AF%E6%BA%90%EF%BC%9A%E4%BB%8E%E7%AC%AC%E4%B8%80%E7%89%88React%20Native%E5%BC%80%E5%A7%8B%E5%AD%A6%E4%BC%9A%E8%AF%BB%E6%87%82%E6%BA%90%E7%A0%81/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    28 追本溯源：从第一版React Native开始学会读懂源码
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../29-%E5%BC%84%E6%B8%85%E7%8E%B0%E7%8A%B6%EF%BC%9A%E6%96%B0%E6%9E%B6%E6%9E%84%E9%A2%84%E8%A7%88%E7%89%88%E7%A9%B6%E7%AB%9F%E9%95%BF%E4%BB%80%E4%B9%88%E6%A0%B7%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    29 弄清现状：新架构预览版究竟长什么样？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../30-JavaScript%E5%BC%95%E6%93%8E%EF%BC%9A%E5%8F%8C%E5%90%91%E9%80%9A%E8%AE%AF%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    30 JavaScript引擎：双向通讯底层原理是什么？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../31-%E5%A4%9A%E7%BA%BF%E7%A8%8B%EF%BC%9ARN%E5%BA%95%E5%B1%82%E6%98%AF%E5%A6%82%E4%BD%95%E4%BF%9D%E9%9A%9C%E4%BA%A4%E4%BA%92%E4%BD%93%E9%AA%8C%E7%9A%84%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    31 多线程：RN底层是如何保障交互体验的？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../32-Fabric%EF%BC%9A%E6%96%B0%E6%B8%B2%E6%9F%93%E5%99%A8%E7%9A%84%E6%BC%94%E8%BF%9B%E4%B9%8B%E8%B7%AF/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    32 Fabric：新渲染器的演进之路
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../33-AI%E5%89%8D%E6%B2%BF%EF%BC%9AChatGPT%E8%B5%84%E6%96%99%E7%B2%BE%E9%80%89%E9%9B%86/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    33 AI前沿：ChatGPT资料精选集
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../34-%E5%8D%87%E7%BA%A7%E6%94%B6%E7%9B%8A%EF%BC%9A%E8%BF%99%E4%B8%A4%E5%B9%B4React%20Native%E9%83%BD%E5%81%9A%E4%BA%86%E5%93%AA%E4%BA%9B%E5%8D%87%E7%BA%A7%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    34 升级收益：这两年React Native都做了哪些升级？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../35-%E8%87%AA%E5%8A%A8%E5%8C%96%EF%BC%9A%E5%8D%87%E7%BA%A70.72%E6%96%B0%E6%9E%B6%E6%9E%84%E7%9A%84%E6%AD%A5%E9%AA%A4%E5%92%8C%E5%85%B3%E9%94%AE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    35 自动化：升级0.72新架构的步骤和关键
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../36-%E5%8D%87%E6%96%B0%E4%B8%8D%E5%8D%87%E6%97%A7%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6%E5%A6%82%E4%BD%95%E5%8D%87%E7%BA%A7%E5%88%B0%E6%96%B0%E6%9E%B6%E6%9E%84%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    36 升新不升旧：自定义组件如何升级到新架构？
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Serverless%E5%85%A5%E9%97%A8%E8%AF%BE/Serverless%E5%85%A5%E9%97%A8%E8%AF%BE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Serverless入门课
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Vue%203%20%E4%BC%81%E4%B8%9A%E7%BA%A7%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E8%AF%BE/Vue%203%20%E4%BC%81%E4%B8%9A%E7%BA%A7%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E8%AF%BE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Vue 3 企业级项目实战课
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../WebAssembly%E5%85%A5%E9%97%A8%E8%AF%BE/WebAssembly%E5%85%A5%E9%97%A8%E8%AF%BE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    WebAssembly入门课
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../iOS%E5%BC%80%E5%8F%91%E9%AB%98%E6%89%8B%E8%AF%BE/iOS%E5%BC%80%E5%8F%91%E9%AB%98%E6%89%8B%E8%AF%BE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    iOS开发高手课
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E4%BB%8E0%E6%89%93%E9%80%A0%E9%9F%B3%E8%A7%86%E9%A2%91%E7%9B%B4%E6%92%AD%E7%B3%BB%E7%BB%9F/%E4%BB%8E0%E6%89%93%E9%80%A0%E9%9F%B3%E8%A7%86%E9%A2%91%E7%9B%B4%E6%92%AD%E7%B3%BB%E7%BB%9F/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    从0打造音视频直播系统
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E5%89%8D%E7%AB%AF%E5%85%A8%E9%93%BE%E8%B7%AF%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98%E8%AF%BE/%E5%89%8D%E7%AB%AF%E5%85%A8%E9%93%BE%E8%B7%AF%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98%E8%AF%BE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    前端全链路优化实战课
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E5%9B%BE%E8%A7%A3%20Google%20V8/%E5%9B%BE%E8%A7%A3%20Google%20V8/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    图解 Google V8
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E5%BF%AB%E6%89%8B%20%C2%B7%20%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%9F%B3%E8%A7%86%E9%A2%91%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/%E5%BF%AB%E6%89%8B%20%C2%B7%20%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%9F%B3%E8%A7%86%E9%A2%91%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    快手 · 移动端音视频开发实战
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E5%BF%AB%E6%89%8B%20%C2%B7%20%E9%9F%B3%E8%A7%86%E9%A2%91%E6%8A%80%E6%9C%AF%E5%85%A5%E9%97%A8%E8%AF%BE/%E5%BF%AB%E6%89%8B%20%C2%B7%20%E9%9F%B3%E8%A7%86%E9%A2%91%E6%8A%80%E6%9C%AF%E5%85%A5%E9%97%A8%E8%AF%BE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    快手 · 音视频技术入门课
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E6%90%9E%E5%AE%9A%E9%9F%B3%E9%A2%91%E6%8A%80%E6%9C%AF/%E6%90%9E%E5%AE%9A%E9%9F%B3%E9%A2%91%E6%8A%80%E6%9C%AF/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    搞定音频技术
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E6%94%BB%E5%85%8B%E8%A7%86%E9%A2%91%E6%8A%80%E6%9C%AF/%E6%94%BB%E5%85%8B%E8%A7%86%E9%A2%91%E6%8A%80%E6%9C%AF/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    攻克视频技术
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E6%9C%B1%E6%B6%9B%20%C2%B7%20Kotlin%E7%BC%96%E7%A8%8B%E7%AC%AC%E4%B8%80%E8%AF%BE/%E6%9C%B1%E6%B6%9B%20%C2%B7%20Kotlin%E7%BC%96%E7%A8%8B%E7%AC%AC%E4%B8%80%E8%AF%BE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    朱涛 · Kotlin编程第一课
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    浏览器工作原理与实践
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E7%8E%A9%E8%BD%ACVue%203%E5%85%A8%E5%AE%B6%E6%A1%B6/%E7%8E%A9%E8%BD%ACVue%203%E5%85%A8%E5%AE%B6%E6%A1%B6/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    玩转Vue 3全家桶
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E7%8E%B0%E4%BB%A3React%20Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/%E7%8E%B0%E4%BB%A3React%20Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    现代React Web开发实战
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E8%AF%B4%E9%80%8F%E4%BD%8E%E4%BB%A3%E7%A0%81/%E8%AF%B4%E9%80%8F%E4%BD%8E%E4%BB%A3%E7%A0%81/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    说透低代码
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E8%B7%9F%E6%9C%88%E5%BD%B1%E5%AD%A6%E5%8F%AF%E8%A7%86%E5%8C%96/%E8%B7%9F%E6%9C%88%E5%BD%B1%E5%AD%A6%E5%8F%AF%E8%A7%86%E5%8C%96/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    跟月影学可视化
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E9%87%8D%E5%AD%A6%E5%89%8D%E7%AB%AF/%E9%87%8D%E5%AD%A6%E5%89%8D%E7%AB%AF/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    重学前端
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E5%90%8E%E7%AB%AF-%E6%9E%B6%E6%9E%84/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    后端-架构
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E7%AE%A1%E7%90%86-%E6%88%90%E9%95%BF/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    管理-成长
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    计算机基础
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E8%BF%90%E7%BB%B4-%E6%B5%8B%E8%AF%95/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    运维-测试
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      新架构介绍
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      组件的生命周期
    </span>
  </a>
  
    <nav class="md-nav" aria-label="组件的生命周期">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#android" class="md-nav__link">
    <span class="md-ellipsis">
      Android
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ios" class="md-nav__link">
    <span class="md-ellipsis">
      iOS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      组件传输数据类型
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#react-native" class="md-nav__link">
    <span class="md-ellipsis">
      React Native 与原生的通信方式
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#turbomodule" class="md-nav__link">
    <span class="md-ellipsis">
      TurboModule：数据存取
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TurboModule：数据存取">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#javascript" class="md-nav__link">
    <span class="md-ellipsis">
      JavaScript
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#android_1" class="md-nav__link">
    <span class="md-ellipsis">
      Android
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ios_1" class="md-nav__link">
    <span class="md-ellipsis">
      iOS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fabric" class="md-nav__link">
    <span class="md-ellipsis">
      Fabric：视频播放
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fabric：视频播放">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#javascipt" class="md-nav__link">
    <span class="md-ellipsis">
      JavaScipt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#android_2" class="md-nav__link">
    <span class="md-ellipsis">
      Android
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ios_2" class="md-nav__link">
    <span class="md-ellipsis">
      iOS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      作业
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>22 自定义组件：如何满足业务的个性化需求？</h1>

<p>你好，我是众文，这一讲还是由我和惠姝来讲解。</p>
<p>上一讲，我们讲了如何构建混合应用。当环境配置、载体页、调试打包都 OK 后，我们就要开始复杂业务的开发了。在实际开发中，除了负责 React Native 框架本身的维护迭代外，另一个重要的工作就是配合前端业务，开发对应的 Native 组件。</p>
<p>那么什么时候用这些自定义的 Native 组件呢？</p>
<p>比如，有时候 App 需要访问平台 API，但 React Native 可能还没有相应的模块包装；或者你需要复用公司内的一些用 Java/OC 写的通用组件，而不是用 JavaScript 重新实现一遍；又或者你需要实现某些高性能的、多线程的代码，譬如图片处理、数据库，或者各种高级扩展等。</p>
<p>当然，你可以通过官方文档（<a href="https://reactnative.cn/docs/native-modules-android">Android</a>/<a href="https://reactnative.cn/docs/native-modules-ios">iOS</a>），快速访问你的原生模块。但官方文档提供的主要是简单的 Demo 和步骤，在实际开发中，你可能还需要自定义组件的方方面面，包括新架构定义组件的全流程，以及实际业务中的踩坑指南等。</p>
<p>今天这一讲，我们会先带你补齐组件的相关基础知识，包括组件的生命周期、组件传输数据类型，并以新架构的TurboModule 和 Fabric 为案例，带你了解自定义组件的方方面面。你也能借此对React Native新架构建立起初步认识。接下来让我们先了解下期待已久的 React Native 新架构。</p>
<h2 id="_1">新架构介绍</h2>
<p>我们现在先通过下面这张图简单对比下新老架构：</p>
<p><img alt="图片" src="https://static001.geekbang.org/resource/image/3e/31/3eb92714433185cd0a095yy2e1a36331.jpg?wh=1920x932" /></p>
<p>新架构变更点主要在下面这几个方面：</p>
<p><img alt="图片" src="https://static001.geekbang.org/resource/image/4d/8d/4df0702732be0a4922444d575980828d.png?wh=1894x1216" /></p>
<p>前面也说了，我们一讲将以 TurboModule 和 Fabric 为案例对自定义组件进行讲解。所以你现在需要对新架构有一个初步的认识，特别是要注意，TurboModule 和 Fabric 对比旧版的 Native Module 和 UIManager 有哪些差异和优势。</p>
<p>如果你还想了解新架构的更多信息，你可以参考<a href="https://reactnative.dev/docs/new-architecture-intro">官方文档</a>。这里包括了新架构介绍、如何在 Android、iOS 上开启新架构、如何在 Android、iOS 上开启使用 TurboModule 和 Fabric等。你也可以根据官方文档试着编译运行新架构。</p>
<p>而且，<a href="https://github.com/software-mansion/react-native-screens">react-native-screens</a>、<a href="https://github.com/software-mansion/react-native-gesture-handler">react-native-gesture-handler</a> 等知名 React Native 库的新版都已适配了新架构，感兴趣的话，你可以去了解下。</p>
<p>好的，现在我们进入这一讲的正题，先来了解一下组件的生命周期。</p>
<h2 id="_2">组件的生命周期</h2>
<p>组件的生命周期，指的是在组件创建、更新、销毁的过程中伴随的各种各样的函数执行。这些在组件特定的时期被触发的函数，统称为组件的生命周期。</p>
<p>让组件拥有生命周期，我们就可以更好地管理组件的状态、内存，跟随载体页的生命周期做相应的处理。</p>
<h3 id="android">Android</h3>
<p>在Android端，一个 Module 组件的生命周期包括：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>构造 -&gt; 初始化 -&gt; onHostResume() -&gt; onHostPause() -&gt; onHostDestroy()
</code></pre></div>
<p>这几个生命周期的意思是：</p>
<p><img alt="图片" src="https://static001.geekbang.org/resource/image/1b/1b/1bdfff7c48055490ce06ab49eff5f01b.png?wh=1824x1110" /></p>
<p>如果你不熟悉 Android Activity/Fragment 生命周期，那你可以看下<a href="https://www.jianshu.com/p/1b3f829810a1">这篇文章</a>加深下理解。</p>
<p>那么如何让 Native Module 具备生命周期呢？</p>
<p>React Native 给我们提供了一个接口：com.facebook.react.bridge.LifecycleEventListener。我们只需要在组件中添加这个接口的注册和取消注册，就可以让组件具备生命周期了。这里要注意，不要忘记在 onHostDestroy() 中移除注册，否则会造成内存泄漏。示例代码如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>public class TestJavaModule extends ReactContextBaseJavaModule 
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a> implements LifecycleEventListener, ReactModuleWithSpec, TurboModule {
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    public TestJavaModule(ReactApplicationContext reactContext) {
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>       super(reactContext.real());
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>       reactContext.addLifecycleEventListener(this);
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    }
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>    @Override
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>    public String getName() {
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>       return getClass().getSimpleName();
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>    }
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>    @Override
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>    public void onHostResume() {
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>    }
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>    @Override
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>    public void onHostPause() {
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>    }
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>    @Override
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>    public void onHostDestroy() {
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>       getReactApplicationContext().removeLifecycleEventListener(this); 
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>    }
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>}
</code></pre></div>
<p>其实组件的生命周期原理很简单，就是观察者模式。当载体页触发自身的生命周期回调时，调用 ReactInstanceManager 的 onHostXXX() 方法，ReactInstanceManager 进而调用 ReactContext 的对应回调。</p>
<p>比如载体页调用 onResume() 时，最终会调用 ReactContext 的 onHostResume()，内部会遍历注册的事件进行回调：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>public void onHostResume(@Nullable Activity activity) {
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    Iterator iterator = this.mLifecycleEventListeners.iterator();
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    while(iterator.hasNext()) {
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>        LifecycleEventListener listener = (LifecycleEventListener) iterator.next();
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>        // 观察者模式，载体页时调用已注册组件的生命周期回调
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>        listener.onHostResume();
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>    }
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>}
</code></pre></div>
<p>以上就是 Android 端组件生命周期的讲解，我们再来看看 iOS 端。</p>
<h3 id="ios">iOS</h3>
<p>iOS中 NativeModules 组件的创建销毁时机，与bridge的创建销毁时机完全一致：</p>
<ul>
<li>alloc：创建当前组件；</li>
<li>dealloc：销毁当前组件。</li>
</ul>
<p>创建一个组件TestNativeModule，通过RCT_EXPORT_MODULE() 声明组件，默认会根据类名声明组件名，当然也可以通过在参数中传入其他字符串作为组件的名。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>@implementation TestNativeModule
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>RCT_EXPORT_MODULE()
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>- (instancetype)init{
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>  self = [super init];
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>  return self;
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>}
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>- (void)dealloc{
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>  NSLog(@&quot;dealloc&quot;);
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>}
</code></pre></div>
<p>而 <strong>TurboModule</strong> 组件的生命周期却与 NativeModule 不同。TurboModule 采用懒加载模式，在 Bridge 创建后页面中第一次 import 当前TurboModule ，也就是 JavaScript 端通过 <strong>TurboModuleRegistry.getEnforcing</strong>方法加载组件时， Native 会创建对应的 TurboModule 并进行缓存。如果 JS 端没有加载当前自定义组件，该组件就不会进行初始化。</p>
<p>JS 端加载组件方式如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>export default (TurboModuleRegistry.getEnforcing&lt;Spec&gt;(
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>   &#39;TestTurboModule&#39;)
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>  : Spec);
</code></pre></div>
<p>而TurboModule 的销毁时机与 Bridge 的销毁时机一致。 Bridge 进行销毁时会发送一个 RCTBridgeDidInvalidateModulesNotification 通知，TurboModuleManager会监听该事件，依次对所有已创建的 TurboModule 进行销毁。示例代码如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>- (void)bridgeDidInvalidateModules:(NSNotification *)notification
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>{
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>  RCTBridge *bridge = notification.userInfo[@&quot;bridge&quot;];
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>  if (bridge != _bridge) {
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>    return;
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>  }
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>  [self _invalidateModules];//销毁所有TurboModules
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>}
</code></pre></div>
<p>了解完了组件的生命周期，我们再来看下组件的传输数据类型。在组件运行过程中，Native 与 JavaScript 不可避免地需要进行数据交互，如 JavaScript 调用组件方法传入数据，Native 向 JavaScript 回传结果，而 React Native 也帮我们封装好了对应的数据类型。</p>
<h2 id="_3">组件传输数据类型</h2>
<p>在 Native 与 JavaScript 通信的过程中，组件需要获取输入参数、回传结果，对此 React Native 给我们包装了相应的数据类型，方便快速操作，我们通过一个Demo来简单了解下。</p>
<p>现在，我们让JavaScript端调用 TestModule 的 testMethod 方法，传入参数 type 和 message，接收 native 回传数据：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>NativeModules.TestModule.testMethod({type: 1, message: &quot;fromJS&quot;}, (result)=&gt;{
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    console.info(result);
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>  }
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>);
</code></pre></div>
<p>然后我们来看TestModule 在 Android、iOS 侧的实现。先来看 Android 端是怎么做的。</p>
<p>不过，在实现 TestModule 之前，我们需要先了解下 Android 端的组件传输数据类型：</p>
<p><img alt="图片" src="https://static001.geekbang.org/resource/image/61/87/615f0162574e42c30557a1356472ee87.png?wh=744x924" /></p>
<p>这里你要注意，数字类型有点特殊。因为 JavaScript 不支持 long 64 位长类型，只支持 int (32)和double，所以对于长数字，JavaScript端统一用 double 表示。那么 Android 端如何转换成自己需要的数据类型呢？</p>
<p>我们以 long 为例，可以这样参考<a href="https://github.com/facebook/react-native/issues/12506">官方issue</a>这样处理：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>double value = readableMap.getDouble(key);
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>try {
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    // 判断是否为 long 的范围: 超过了 int 的最大值且为整数
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    if (value &gt; Integer.MAX_VALUE &amp;&amp; value % 1 == 0) {
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>        long cv = (long) value;
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>        // 转换成 long 型返回
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>    }
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>} catch (Exception e) {
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>    // 异常时，仍使用 double
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>}
</code></pre></div>
<p>这段代码中，我们先将 JavaScript 传入的数值统一以双精度浮点数 double 来获取。获取完后，判断这个值是否超出了整数的最大值且不为小数，条件符合就将它转换成长整数 long，否则还是以 double 来返回。</p>
<p>了解完 Android 端的组件数据传输类型后，我们就可以来实现上文中的 TestModule了：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>public class TestModule extends ReactContextBaseJavaModule implements ReactModuleWithSpec, TurboModule {
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>   public TestModule(ReactApplicationContext reactContext) {
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>      super(reactContext.real());
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>   }
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>   @Override
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>   public String getName() {
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>      return getClass().getSimpleName();
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>   }
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>   @ReactMethod
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>   public void testMethod(ReadableMap data, Callback callback) {
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>      // 获取 JS 的调用输入参数
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>      int type = data.getInt(&quot;type&quot;);
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>      String message = data.getString(&quot;message&quot;);
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>      // 回传数据给 JS
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>      WritableMap resultMap = new WritableNativeMap();
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>      map.putInt(&quot;code&quot;, 1);
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>      map.putString(&quot;message&quot;, &quot;success&quot;);
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>      callback.invoke(resultMap);
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>   }
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>}
</code></pre></div>
<p>上面代码中，我们定义了 Native 组件 TestModule，内部实现了 JavaScript 需要调用的 testMethod 方法。此方法包含两个参数：ReadableMap 和 Callback。ReadableMap 为 JavaScript 传入参数的字典，我们可以通过对应的 key 获取到 JavaScript 的入参值，而 Callback 是在 Native 回传数据时需要使用的，后面我们还有对通信方式这部分的讲解，这里我们只需要了解一下就好。</p>
<p>具体实现上，我们是首先获取 JavaScript 调用传入的 type 和 message，然后再通过 WritableMap 写入数据，最后通过 callback 回传给 JavaScript。</p>
<p>以上就是 Android 端的 React Native 读写数据类型，我们再来看下 iOS 端。</p>
<p>iOS端也是一样，在实现前面这个 demo 前，我们需要先看下 iOS 端支持的传入数据类型：</p>
<p><img alt="图片" src="https://static001.geekbang.org/resource/image/af/f8/afbea1f2yyfa12fec0df7248913d97f8.png?wh=772x956" /></p>
<p>那么，iOS端中是如何实现上文中的TestModule的呢？我们可以在Module中进行callback，然后通过NSArray来返回，如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>RCT_EXPORT_METHOD(getValueWithCallback : (RCTResponseSenderBlock)callback){
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>  if (!callback) {
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    return;
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>  }
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>  callback(@[ @&quot;value from callback!&quot; ]);
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>}
</code></pre></div>
<p>不过，我们这个组件案例，只是演示了 Native 可以通过 callback 向 JavaScript 回传数据。那么除了 callback，React Native 与原生还有什么通信方式呢？</p>
<h2 id="react-native">React Native 与原生的通信方式</h2>
<p>总体来说，native 向 JavaScript 传递数据的方式分成以下三种：</p>
<ul>
<li>Callback：由 JavaScript 主导触发，Native 进行回传，一次触发只能传递一次；</li>
<li>Promise：由 JavaScript 主导触发，Native 进行回传，一次触发只能传递一次。Promise 是 ES6 的新特性，类似 RXJava 的链式调用。Promise 有三种状态，分别是pending (进行时)、resolve (已完成)、reject (已失败)；</li>
<li>发送事件：由 Native 主导触发，可传递多次，类似 Android 的广播和 iOS 的通知中心。</li>
</ul>
<p>Callback 在上面的例子中已经出现过了，我们通过 callback.invoke(xx) 就可以将数据回传给 JavaScript，使用起来比较简单，这边我们就不再赘述了。现在我们主要来看下 Promise 和发送事件的示例，以便更好地了解 React Native 和原生之间是如何进行通信的。</p>
<p><strong>首先我们来看下Promise 示例</strong>，我们从 JavaScript 如何触发、Native 如何回传数据两方面来进行讲解。</p>
<p>首先，JavaScript 端调用客户端定义的 SystemPropsModule 的 getSystemModel 来获取手机的设备类型，获取结果的方式使用 Promise 方式 （then… catch…）：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>NativeModules.SystemPropsModule.getSystemModel().then(result=&gt; {
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>  console.log(result);
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>}).catch(error=&gt; {
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>   console.log(error);
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>});
</code></pre></div>
<p>然后，Native 端定义 SystemPropsModule，实现 getSystemModel 方法，内部使用 promise 获取手机的 model 数据。使用 promise.reolve(xx) 为成功，promise.reject(xx) 为失败：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>SystemPropsModule：
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>...
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>@ReactMethod
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>public void getSystemModel(Promise promise) {
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>    // 回传成功，使用 resolve
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>    promise.resolve(Build.MODEL);
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>}
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>...
</code></pre></div>
<p><strong>接下来看发送事件示例</strong>，我们从 JavaScript 如何监听 Native 事件、Native 如何发送事件这两方面来进行讲解。</p>
<p>首先，JavaScript 端使用 EventEmitterManager 来注册 Native 的事件监听。通过 NativeModules 获取 EventEmitterManager，随后使用它构建出 NativeEventEmitter，最后通过 NativeEventEmitter 注册监听：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>componentWillMount(){
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>   // 拿到原生模块
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>   var eventEmitterManager = NativeModules.EventEmitterManager;
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>   const nativeEventEmitter = new NativeEventEmitter(eventEmitterManager);
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>   const eventEmitterManagerEvent = EventEmitterManager.EventEmitterManagerEvent;
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>   // 监听 Native 发送的通知
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>   this.listener = nativeEventEmitter.addListener(eventEmitterManagerEvent, (data) =&gt; 
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>       console.log(&quot;Receive native event: &quot; + data);
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>   );
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>}
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>componentWillUnmount(){
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>   // 移除监听
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>   this.listener.remove();
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>}
</code></pre></div>
<p>在 Native 端的使用则很简单。我们获取 RCTDeviceEventEmitter 这个 JSModule，使用 emit 方法就可以向 JavaScript 发送事件了：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>reactContext.getJSModule(DeviceEventManagerModule.RCTDeviceEventEmitter.class)
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>  .emit(&quot;msg&quot;, &quot;say hello&quot;);
</code></pre></div>
<p>自定义组件相关的知识点，我们先介绍到这里。接下来进入实战阶段，我们将分别以一个数据存取 TurboModule 和视频播放 Fabric component 的案例，加深你对自定义组件的理解。我们先来看TurboModule。</p>
<h2 id="turbomodule">TurboModule：数据存取</h2>
<p>TurboModule 采用懒加载模式，在运行时第一次 import 该 TurboModule 时， Native 会创建对应的 TurboModule 并进行缓存。而旧版本的 NativeModule 都是在创建环境时统一进行构造的，会对 React Native 的启动性能有比较大的影响。</p>
<p>接下来我们以一个实际的案例来带你了解 TurboModule。当你需要使用 native 数据存取相关能力，如跨进程存取、偏好存取、加密存取等，而 React Native 自带的数据存储 module 满足不了你的需求，你可以通过自定义数据存储的 TurboMoudle 来实现。我们先来看下 JavaScript 侧。</p>
<h3 id="javascript">JavaScript</h3>
<p>在 Spec 中定义方法，定义好存和取的方法后，再导出 StorageModule：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>export interface Spec extends TurboModule {
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>+save: (key: string, value: string, callback: (value: Object) =&gt; void) =&gt; void;
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>+get: (key: string, callback: (value: Object) =&gt; void) =&gt; void;
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>}
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>// 导出 StorageModule
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>export default (TurboModuleRegistry.getEnforcing&lt;Spec&gt;(
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>&#39;StorageModule&#39;,
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>): Spec);
</code></pre></div>
<p>调用：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>NativeModules.StorageModule.save(&quot;testKey&quot;, &quot;testValue&quot;, (result)=&gt;{
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>    console.info(result);
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>  }
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>);
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>NativeModules.StorageModule.get(&quot;testKey&quot;, (result)=&gt;{
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>    console.info(result);
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>  }
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>);
</code></pre></div>
<p>接下来我们再看看 Android 端和 iOS 端的实现。</p>
<h3 id="android_1">Android</h3>
<p>在实现 StorageModule 之前，我们需要在混合工程中，将 React Native 新架构的运行配置搭建好，这套配置可以运行 TurboModule、Fabric，后面的 Fabric 案例也是基于此配置来运行的。</p>
<p>而且，上一讲在我们已经讲解了如何基于 React Native 最新版本（0.68.0）搭建混合应用，我们再这个基础上开启新架构配置就好了。</p>
<p><strong>第一步，我们要做些准备工作，也就是获取 newarchitecture 的模版代码。</strong></p>
<p>我们以 0.68.0 版本创建一个 React Native 工程，来获取新架构的模版代码，我们把这个工程名叫做ReactNativeNewArch：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>npx react-native init ReactNativeNewArch --version 0.68.0
</code></pre></div>
<p>创建好后，你将看到如下工程代码，包含 Java 和 C++：</p>
<p><img alt="图片" src="https://static001.geekbang.org/resource/image/f6/3a/f64e5f3da0730b6a6a8928dc9736ea3a.png?wh=1164x1394" /></p>
<p>这些工程代码主要是新架构的 JSI、Fabric、TurboModule 的注册和加载代码，内部逻辑非常复杂，这一讲我们就不做过多分析了，先专注于实操部分。</p>
<p>如果我们想基于这个 Demo 去运行新架构，可以做如下操作：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>1. 修改 android 目录下的 gradle.properties:
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a># 开启新架构
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>newArchEnabled=true
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a># 配置 java home 为 JDK 11
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>org.gradle.java.home=/Library/Java/JavaVirtualMachines/jdk-11.0.2.jdk/Contents/Home
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>2. 运行
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>yarn react-native run-android
</code></pre></div>
<p><strong>第二步，拷贝 newarchitecture 的模版代码到我们之前的混合工程。</strong></p>
<p>这一步中，我们需要将 Java 层和 C++ 层代码拷贝到混合工程中，需要拷贝的相关代码如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>Java 层：
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>- MainComponentsRegistry.java
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>- MainApplicationTurboModuleManagerDelegate.java
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>C++ 层：
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>- jni 目录
</code></pre></div>
<p>拷贝完的效果是这样的：</p>
<p><img alt="图片" src="https://static001.geekbang.org/resource/image/b5/73/b51022154e4d1831428ced687c224173.png?wh=880x1076" /></p>
<p><strong>第三步是修改拷贝的代码，主要是下面这四点。</strong></p>
<p><strong>1.MainApplicationTurboModuleManagerDelegate.java：</strong></p>
<p>修改 so 库名称为我们自定义名称 geektime_new_arch。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>@Override
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>protected synchronized void maybeLoadOtherSoLibraries() {
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>  if (!sIsSoLibraryLoaded) {
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>    SoLoader.loadLibrary(&quot;geektime_new_arch&quot;);
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>    sIsSoLibraryLoaded = true;
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>  }
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>}
</code></pre></div>
<p><strong>2.jni/Android.mk：</strong>修改 Android.mk 中的 so 库名称为上面的 geektime_new_arch。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a># You can customize the name of your application .so file here.
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>LOCAL_MODULE := geektime_new_arch
</code></pre></div>
<p><strong>3.jni/MainApplicationTurboModuleManagerDelegate.h：</strong>修改 MainApplicationTurboModuleManagerDelegate 对应的 Java 类路径，截图中拷贝好的 MainApplicationTurboModuleManagerDelegate.java 路径为 com/reactnativenewarch/newarchitecture/modules。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>static constexpr auto kJavaDescriptor =
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>    &quot;Lcom/reactnativenewarch/newarchitecture/modules/MainApplicationTurboModuleManagerDelegate;&quot;;
</code></pre></div>
<p><strong>4.jni/MainComponentsRegistry.h：</strong>修改 MainComponentsRegistry 对应的 Java 类路径，截图中拷贝好的 MainComponentsRegistry.java 路径为 com/reactnativenewarch/newarchitecture/components。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>constexpr static auto kJavaDescriptor =
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>    &quot;Lcom/reactnativenewarch/newarchitecture/components/MainComponentsRegistry;&quot;;
</code></pre></div>
<p><strong>做完后，最后一步就是修改 React Native 初始化代码了。</strong></p>
<p>这里有两处要修改。第一处是设置 ReactPackageTurboModuleManagerDelegateBuilder 为上面的 MainApplicationTurboModuleManagerDelegate（TurboModule 用）；第二处是设置 setJSIModulesPackage（Fabric 用，JSI 实现）：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>public void initRN() {
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>    ReactInstanceManagerBuilder builder = ReactInstanceManager.builder()
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>        .setApplication((Application) getApplicationContext())
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>        .addPackage(new MainReactPackage())
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>        .setJSMainModulePath(&quot;index.android&quot;)
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>        .setInitialLifecycleState(LifecycleState.BEFORE_CREATE)
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>        .setReactPackageTurboModuleManagerDelegateBuilder(new MainApplicationTurboModuleManagerDelegate.Builder())
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>        .setJSIModulesPackage(getJSIModulePackage());
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>    ReactInstanceManager reactInstanceManager = builder.build();
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>}
</code></pre></div>
<p>其中 getJSIModulePackage() 我特意摘出来放在了下面。这段代码实现需要从模版代码的 MainApplicationReactNativeHost 的 getJSIModulePackage 拷贝，内部调用了上面的 MainComponentsRegistry 进行注册：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>static JSIModulePackage getJSIModulePackage() {
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>  return new JSIModulePackage() {
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>    @Override
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>    public List&lt;JSIModuleSpec&gt; getJSIModules(
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>      final ReactApplicationContext reactApplicationContext,
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>      final JavaScriptContextHolder jsContext) {
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>      final List&lt;JSIModuleSpec&gt; specs = new ArrayList&lt;&gt;();
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>      specs.add(
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>          new JSIModuleSpec() {
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>            @Override
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>            public JSIModuleType getJSIModuleType() {
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>              return JSIModuleType.UIManager;
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>            }
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>            @Override
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>            public JSIModuleProvider&lt;UIManager&gt; getJSIModuleProvider() {
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a>              final ComponentFactory componentFactory = new ComponentFactory();
<a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>              CoreComponentsRegistry.register(componentFactory);
<a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a>              MainComponentsRegistry.register(componentFactory);
<a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a>
<a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a>              List&lt;ViewManager&gt; viewManagers = new ArrayList&lt;&gt;();
<a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a>              ViewManagerRegistry viewManagerRegistry = new ViewManagerRegistry(viewManagers);
<a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a>              return new FabricJSIModuleProvider(
<a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a>                  reactApplicationContext,
<a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a>                  componentFactory,
<a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a>                  new EmptyReactNativeConfig(),
<a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a>                  viewManagerRegistry);
<a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a>            }
<a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a>          });
<a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a>      return specs;
<a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a>    }
<a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a>  };
<a id="__codelineno-24-33" name="__codelineno-24-33" href="#__codelineno-24-33"></a>}
</code></pre></div>
<p>至此，我们新架构的运行环境就配置好了。由于目前新架构文章非常少，几乎没有混合工程运行新架构的方案，上面这些主要是我们用了大量的时间去调研和测试的结果，你可以参考一下。</p>
<p>好了，回到正题。在混合工程中，新架构的运行环境搭建好后，我们就可以简单快速地来写 TurboModule 和 Fabric 了。</p>
<p>我们继续来进行数据存储的 Demo 在 Java 层定义并实现 StorageModule。Android 端我们使用 SharedPreferences 来实现轻量级偏好存取。这里要注意，你需要继承 ReactModuleWithSpec和TurboModule，具体代码如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>// 1. 定义 StorageModule，继承 ReactContextBaseJavaModule 类
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>// 实现 ReactModuleWithSpec &amp; TurboModule 接口
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>public class StorageModule extends ReactContextBaseJavaModule
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>    implements ReactModuleWithSpec, TurboModule {
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>    // native 存储的 sp 文件名称
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>    private static final String SP_NAME = &quot;rn_storage&quot;;
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>    // 返回给 JS 的结果码
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>    private static final int CODE_SUCCESS = 1;
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>    private static final int CODE_ERROR = 2;
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>    public StorageModule(ReactApplicationContextWrapper reactContext) {
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>       super(reactContext);
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>    }
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>    // 返回 module 名称，一般以类名作为 module 名称
<a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a>    @Override
<a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a>    public String getName() {
<a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a>       return StorageModule.class.getSimpleName();
<a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a>    }
<a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a>
<a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a>    // 定义供 JS 调用的存储数据方法，isBlockingSynchronousMethod 表示是否同步执行
<a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a>    @ReactMethod(isBlockingSynchronousMethod = true)
<a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a>    public void save(String key, String value, Callback callback) {
<a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a>       WritableMap result = new WritableNativeMap();
<a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a>       // 如果 js 传入的 key 为空，则回传失败码和信息
<a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a>       if (TextUtils.isEmpty(key)) {
<a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a>           result.putInt(&quot;code&quot;, CODE_ERROR);
<a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a>           result.putString(&quot;msg&quot;, &quot;key is empty or null&quot;);
<a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a>           callback.invoke(result);
<a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a>           return;
<a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a>       }
<a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a>       // 调用 native 的 sp 进行数据存储
<a id="__codelineno-25-33" name="__codelineno-25-33" href="#__codelineno-25-33"></a>       SharedPreferences sp = getReactApplicationContext().getSharedPreferences(SP_NAME, Context.MODE_PRIVATE);
<a id="__codelineno-25-34" name="__codelineno-25-34" href="#__codelineno-25-34"></a>       sp.edit().putString(key, value).apply();
<a id="__codelineno-25-35" name="__codelineno-25-35" href="#__codelineno-25-35"></a>       result.putInt(&quot;code&quot;, CODE_SUCCESS);
<a id="__codelineno-25-36" name="__codelineno-25-36" href="#__codelineno-25-36"></a>       result.putString(&quot;msg&quot;, &quot;save success&quot;);
<a id="__codelineno-25-37" name="__codelineno-25-37" href="#__codelineno-25-37"></a>       // 回传 js 告知存储成功
<a id="__codelineno-25-38" name="__codelineno-25-38" href="#__codelineno-25-38"></a>       callback.invoke(result);
<a id="__codelineno-25-39" name="__codelineno-25-39" href="#__codelineno-25-39"></a>   }
<a id="__codelineno-25-40" name="__codelineno-25-40" href="#__codelineno-25-40"></a>
<a id="__codelineno-25-41" name="__codelineno-25-41" href="#__codelineno-25-41"></a>    // 定义供 JS 调用的获取数据方法，isBlockingSynchronousMethod 表示是否同步执行
<a id="__codelineno-25-42" name="__codelineno-25-42" href="#__codelineno-25-42"></a>   @ReactMethod(isBlockingSynchronousMethod = true)
<a id="__codelineno-25-43" name="__codelineno-25-43" href="#__codelineno-25-43"></a>   public void get(String key, Callback callback) {
<a id="__codelineno-25-44" name="__codelineno-25-44" href="#__codelineno-25-44"></a>      // 如果 js 传入的 key 为空，则回传失败码和信息
<a id="__codelineno-25-45" name="__codelineno-25-45" href="#__codelineno-25-45"></a>      WritableMap result = new WritableNativeMap();
<a id="__codelineno-25-46" name="__codelineno-25-46" href="#__codelineno-25-46"></a>      if (TextUtils.isEmpty(key)) {
<a id="__codelineno-25-47" name="__codelineno-25-47" href="#__codelineno-25-47"></a>         result.putInt(&quot;code&quot;, CODE_ERROR);
<a id="__codelineno-25-48" name="__codelineno-25-48" href="#__codelineno-25-48"></a>         result.putString(&quot;msg&quot;, &quot;key is empty or null&quot;);
<a id="__codelineno-25-49" name="__codelineno-25-49" href="#__codelineno-25-49"></a>         callback.invoke(result);
<a id="__codelineno-25-50" name="__codelineno-25-50" href="#__codelineno-25-50"></a>         return;
<a id="__codelineno-25-51" name="__codelineno-25-51" href="#__codelineno-25-51"></a>      }
<a id="__codelineno-25-52" name="__codelineno-25-52" href="#__codelineno-25-52"></a>      // 调用 native 的 sp 获取 key 对应的 value 值
<a id="__codelineno-25-53" name="__codelineno-25-53" href="#__codelineno-25-53"></a>      SharedPreferences sp = getReactApplicationContext().getSharedPreferences(SP_NAME, Context.MODE_PRIVATE);
<a id="__codelineno-25-54" name="__codelineno-25-54" href="#__codelineno-25-54"></a>      String value = sp.getString(key, &quot;&quot;);
<a id="__codelineno-25-55" name="__codelineno-25-55" href="#__codelineno-25-55"></a>      result.putInt(&quot;code&quot;, CODE_SUCCESS);
<a id="__codelineno-25-56" name="__codelineno-25-56" href="#__codelineno-25-56"></a>      result.putString(&quot;data&quot;, value);
<a id="__codelineno-25-57" name="__codelineno-25-57" href="#__codelineno-25-57"></a>      // 将结果回传给 js
<a id="__codelineno-25-58" name="__codelineno-25-58" href="#__codelineno-25-58"></a>      callback.invoke(result);
<a id="__codelineno-25-59" name="__codelineno-25-59" href="#__codelineno-25-59"></a>  }
<a id="__codelineno-25-60" name="__codelineno-25-60" href="#__codelineno-25-60"></a>}
</code></pre></div>
<p>然后是注册组件，注意 Package 需要继承 TurboReactPackage：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>public class MyTurboModulePackage extends TurboReactPackage {
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>    @Override
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>    public NativeModule getModule(String name, ReactApplicationContext reactContext) {
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>        switch(name) {
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>           case &quot;StorageModule&quot;:
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>              return new StorageModule(reactContext);
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>              break;
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>           default:
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>              return null;
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>        }
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>    }
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>    @Override
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>    public ReactModuleInfoProvider getReactModuleInfoProvider() {
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>      //...
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>    }
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>}
</code></pre></div>
<p>接下来注册到 ReactInstanceManager （使用 reactInstanceManagerBuilder注册）：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>ReactInstanceManagerBuilder builder = ReactInstanceManager.builder()
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>   .addPackage(new MyTurboModulePackage());
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>... // 其他 RN 初始化配置
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>ReactInstanceManager reactInstanceManager = builder.build();
</code></pre></div>
<p>然后我们利用新架构提供的 Codegen，生成新架构需要的 native 代码。不过，在使用 codegen 之前，我们需要在项目中应用相关的插件：</p>
<p>(1) 在工程根目录安装 react-native-gradle-plugin。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>yarn add react-native-gradle-plugin
</code></pre></div>
<p>(2) 在工程根目路的 settings.gradle 中配置 react-native-gradle-plugin，使用复合构建引入。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>include &#39;:app&#39;
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>rootProject.name = &quot;GeekTimeRNAndroid&quot;
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>includeBuild(&#39;./node_modules/react-native-gradle-plugin&#39;)
</code></pre></div>
<p>(3) 在 app/build.gradle 中应用插件。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>apply plugin: &quot;com.facebook.react&quot;
</code></pre></div>
<p>这样做后，工程的 gradle 任务中就会出现 generateCodegenArtifactsFromSchema task。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>配置好后，我们以后就可以使用 codegen 能力了，然后执行 generateCodegenArtifactsFromSchema，最后运行App就可以了。
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>../gradlew generateCodegenArtifactsFromSchema
</code></pre></div>
<p>Android端的就是这样，现在我们看iOS端需要怎么做。</p>
<h3 id="ios_1">iOS</h3>
<p>在iOS端中，首先我们要创建一个类并遵循一个协议 spec ，协议中包含注册的API声明。而且，该协议需要遵循 RCTBridgeModule 协议和 RCTTurboModule 协议，并且创建一个JSI。示例代码如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>//定义一个Spec协议
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>@protocol DataStorageTurboModuleSpec &lt;RCTBridgeModule, RCTTurboModule&gt;
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>- (NSString *)getString:(NSString *)string;
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>@end
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>//JSI实现
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>namespace facebook {
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>namespace react {
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>class JSI_EXPORT DataStorageTurboModuleSpecJSI : public ObjCTurboModule {
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>   public:
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>    DataStorageTurboModuleSpecJSI(const ObjCTurboModule::InitParams &amp;params);
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>  };
<a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a>} // namespace react
<a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a>} // namespace facebook
<a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a>
<a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a>//定义一些方法
<a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a>namespace facebook {
<a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a>  namespace react {
<a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a>    static facebook::jsi::Value __hostFunction_DataStorageTurboModuleSpecJSI_getString(
<a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a>    facebook::jsi::Runtime &amp;rt,
<a id="__codelineno-32-21" name="__codelineno-32-21" href="#__codelineno-32-21"></a>    TurboModule &amp;turboModule,
<a id="__codelineno-32-22" name="__codelineno-32-22" href="#__codelineno-32-22"></a>    const facebook::jsi::Value *args,
<a id="__codelineno-32-23" name="__codelineno-32-23" href="#__codelineno-32-23"></a>    size_t count){
<a id="__codelineno-32-24" name="__codelineno-32-24" href="#__codelineno-32-24"></a>    return static_cast&lt;ObjCTurboModule &amp;&gt;(turboModule)
<a id="__codelineno-32-25" name="__codelineno-32-25" href="#__codelineno-32-25"></a>      .invokeObjCMethod(rt, VoidKind, &quot;getString&quot;, @selector(getString:), args, count);
<a id="__codelineno-32-26" name="__codelineno-32-26" href="#__codelineno-32-26"></a>  }
<a id="__codelineno-32-27" name="__codelineno-32-27" href="#__codelineno-32-27"></a>   DataStorageTurboModuleSpecJSI::NativeSampleTurboModuleSpecJSI(const ObjCTurboModule::InitParams &amp;params)
<a id="__codelineno-32-28" name="__codelineno-32-28" href="#__codelineno-32-28"></a>    : ObjCTurboModule(params)
<a id="__codelineno-32-29" name="__codelineno-32-29" href="#__codelineno-32-29"></a>  {
<a id="__codelineno-32-30" name="__codelineno-32-30" href="#__codelineno-32-30"></a>    //MethodMetadata 第一个参数为0代表该方法有一个参数
<a id="__codelineno-32-31" name="__codelineno-32-31" href="#__codelineno-32-31"></a>    methodMap_[&quot;getString&quot;] = MethodMetadata{1, __hostFunction_DataStorageTurboModuleSpecJSI_getString};
<a id="__codelineno-32-32" name="__codelineno-32-32" href="#__codelineno-32-32"></a>  }
<a id="__codelineno-32-33" name="__codelineno-32-33" href="#__codelineno-32-33"></a>}
<a id="__codelineno-32-34" name="__codelineno-32-34" href="#__codelineno-32-34"></a>}
<a id="__codelineno-32-35" name="__codelineno-32-35" href="#__codelineno-32-35"></a>
<a id="__codelineno-32-36" name="__codelineno-32-36" href="#__codelineno-32-36"></a>//TurboModule遵循Spec协议
<a id="__codelineno-32-37" name="__codelineno-32-37" href="#__codelineno-32-37"></a>@interface DataStorageTurboModule : NSObject &lt;DataStorageTurboModuleSpec&gt;
<a id="__codelineno-32-38" name="__codelineno-32-38" href="#__codelineno-32-38"></a>
<a id="__codelineno-32-39" name="__codelineno-32-39" href="#__codelineno-32-39"></a>@end
</code></pre></div>
<p>之后，我们要在该类中注册组件名和API：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>//DataStorageTurboModule.mm
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>@implementation DataStorageTurboModule
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>RCT_EXPORT_MODULE()
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>- (std::shared_ptr&lt;facebook::react::TurboModule&gt;)getTurboModule:
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>    (const facebook::react::ObjCTurboModule::InitParams &amp;)params{
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>  //指定JSI
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>  return std::make_shared&lt;DataStorageTurboModuleSpecJSI&gt;(params);
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>}
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a>RCT_EXPORT_METHOD(getString:(NSString *)string){
<a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>  NSLog(@&quot;&quot;);
<a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a>}
<a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a>@end
</code></pre></div>
<p>以上便是自定义一个 TurboModule的流程。其实定义 TurboModule 并不复杂，而且 Facebook 也提供了代码生成工具 codegen，比较复杂的是在混合工程中搭建新架构的运行环境。前面我们花了不少内容讲述如何在客户端开启新架构，接下来的 Fabric 组件介绍也将在新架构环境基础上进行讲解，接下来我们继续来看Fabric 自定义组件。</p>
<h2 id="fabric">Fabric：视频播放</h2>
<p>Fabric 对标旧框架的 UIManager。FabricUIManager 可以和 C++ 层直接进行通讯，解除了原有的 UIManager 依赖单个 bridge 的问题。有了 JSI 后，以前批量依赖 bridge 的 UI 操作，都可以同步执行到 C++ 层，性能得到大幅提升，特别是在列表快速滑动、复杂动画交互方面提升更加明显。</p>
<p>现在，我们以一个视频播放组件为例，讲讲如何定义 Fabric 组件。我们先来看下 JavaScript 端的实现。</p>
<h3 id="javascipt">JavaScipt</h3>
<p>JavaScript需要定义属性以及 API，并 export 组件。示例代码如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>type NativeProps = $ReadOnly&lt;{|
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>  ...ViewProps,
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>  url?: string
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>|}&gt;; // 定义视频播放的属性，url 为视频地址
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>export type VideoViewType = HostComponent&lt;NativeProps&gt;;
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>// 定义视频播放的方法，包括开始播放、停止播放、暂停播放
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>interface NativeCommands {
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>  +callNativeMethodToPlayVideo: (
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a>  ) =&gt; void;
<a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a>  +callNativeMethodToStopVideo: (
<a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a>  ) =&gt; void;
<a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a>  +callNativeMethodToPauseVideo: (
<a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a>  ) =&gt; void;
<a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a>}
<a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a>
<a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a>//导出外部调用的命令，包括开始播放、停止播放、暂停播放
<a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a>export const Commands: NativeCommands = codegenNativeCommands&lt;NativeCommands&gt;({
<a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a>  supportedCommands: [&#39;callNativeMethodToPlayVideo&#39;],
<a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a>  supportedCommands: [&#39;callNativeMethodToStopVideo&#39;],
<a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a>  supportedCommands: [&#39;callNativeMethodToPauseVideo&#39;],
<a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a>});
<a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a>
<a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a>// 导出包装好的组件，其中 VideoView 为引入 Native 的组件
<a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a>export default (codegenNativeComponent&lt;NativeProps&gt;(
<a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a>  &#39;VideoView&#39;,
<a id="__codelineno-34-28" name="__codelineno-34-28" href="#__codelineno-34-28"></a>): VideoViewType);
</code></pre></div>
<p>JavaScript 端使用该组件：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>// 导入 ViewView 组件和工具
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>import VideoView, {
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>  Commands as VideoViewCommands,
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>} from &#39;./VideoNativeComponent&#39;;
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>// 外部调用此方法即可调用 ViewView 视频播放能力
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a>export default function MyView(props: {}): React.Node {
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a>  return (
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a>     &lt;View&gt;
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a>         &lt;VideoView url={&quot;url&quot;} style={{flex: 1}} /&gt;
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a>         &lt;Button title=&quot;play&quot; onPress={()=&gt;{
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a>             VideoViewCommands.callNativeMethodToPlayVideo();
<a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a>           }
<a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a>         }
<a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a>     &lt;/View&gt;
<a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a>  )
<a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a>}
</code></pre></div>
<p>接下来我们再看看 Android 端和 iOS 端的实现。</p>
<h3 id="android_2">Android</h3>
<p>由于在前面 TurboModule 的部分，我们已经讲解了如何在混合工程中开启新架构运行模式，我么这里就不再重复了。前面的方法同样适用于 Fabric，我们只需要搭建一次就好了。所以现在要在 Android 端实现 Fabric 组件也非常简单，我们来看下具体实现。</p>
<p><strong>第一步，定义视频播放接口。</strong></p>
<p>这里我们要定义 VideoViewManagerInterface，其中包含三个方法：播放视频、停止播放、暂停播放：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>public interface VideoViewManagerInterface&lt;T extends View&gt; {
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>   void playVideo(T view, String url);
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>   void stopVideo(T view);
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>   void pauseVideo(T view);
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>}
</code></pre></div>
<p><strong>第二步，定义视频播放 View。</strong></p>
<p>这一步中，我们要实现视频播放的 View。在 View 中，我们需要实现视频的播放、停止和暂停功能。但播放能力的实现并不是我们讲解的重点，我们这一讲侧重于新架构中 Frabic 组件的实现流程，所以我们这边使用伪代码：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>public class MyVideoView extends View {
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>   // ...
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>   public void playVideo(String url) {
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>       // 播放视频实现
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>   }
<a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a>
<a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>   public void stopVideo() {
<a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a>      // 停止视频播放实现
<a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a>   }
<a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a>
<a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a>   public void pauseVideo() {
<a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a>      // 暂停视频播放实现
<a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a>   }
<a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a>}
</code></pre></div>
<p><strong>第三步，定义 ViewManager。</strong></p>
<p>在这一步中，我们要实现暴露给 React Native 调用的能力，包括视频播放、停止，以及暂停，内部会转发到上面我们定义的视频播放 View 的实现中。示例代码如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>@ReactModule(name = VideoViewManager.REACT_CLASS)
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>public class VideoViewManager: ViewGroupManager&lt;VideoView&gt;(), VideoViewManagerInterface&lt;VideoView&gt; {
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>     private static final String REACT_CLASS = &quot;VideoView&quot;;
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a>     public VideoViewManager() {
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a>     }
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a>
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a>     override
<a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a>     public String getName() {
<a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a>        return REACT_CLASS;
<a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a>     }
<a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a>
<a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a>     override
<a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a>     public VideoView createViewInstance(ThemedReactContext reactContext) {
<a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a>        return new MyVideoView(reactContext);
<a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a>     }
<a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a>
<a id="__codelineno-38-18" name="__codelineno-38-18" href="#__codelineno-38-18"></a>     @ReactProp(name = &quot;url&quot;)
<a id="__codelineno-38-19" name="__codelineno-38-19" href="#__codelineno-38-19"></a>     override 
<a id="__codelineno-38-20" name="__codelineno-38-20" href="#__codelineno-38-20"></a>     public void playVideo(VideoView view, String url) {
<a id="__codelineno-38-21" name="__codelineno-38-21" href="#__codelineno-38-21"></a>        view.playVideo(url);
<a id="__codelineno-38-22" name="__codelineno-38-22" href="#__codelineno-38-22"></a>     }
<a id="__codelineno-38-23" name="__codelineno-38-23" href="#__codelineno-38-23"></a>
<a id="__codelineno-38-24" name="__codelineno-38-24" href="#__codelineno-38-24"></a>     override 
<a id="__codelineno-38-25" name="__codelineno-38-25" href="#__codelineno-38-25"></a>     public void stopVideo(VideoView view) {
<a id="__codelineno-38-26" name="__codelineno-38-26" href="#__codelineno-38-26"></a>        view.stopVideo();
<a id="__codelineno-38-27" name="__codelineno-38-27" href="#__codelineno-38-27"></a>     }
<a id="__codelineno-38-28" name="__codelineno-38-28" href="#__codelineno-38-28"></a>
<a id="__codelineno-38-29" name="__codelineno-38-29" href="#__codelineno-38-29"></a>     override 
<a id="__codelineno-38-30" name="__codelineno-38-30" href="#__codelineno-38-30"></a>     public void pauseVideo(VideoView view) {
<a id="__codelineno-38-31" name="__codelineno-38-31" href="#__codelineno-38-31"></a>        view.pauseVideo();
<a id="__codelineno-38-32" name="__codelineno-38-32" href="#__codelineno-38-32"></a>     }
<a id="__codelineno-38-33" name="__codelineno-38-33" href="#__codelineno-38-33"></a>}
</code></pre></div>
<p><strong>最后一步就是注册 ViewManager。</strong>我们在 ReactInstanceManager 的 JSIModulesPackage 中注册 VideoViewManager：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>List&lt;ViewManager&gt; viewManagers = new ArrayList&lt;&gt;();
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>viewManagers.add(new VideoViewManager())
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>ViewManagerRegistry viewManagerRegistry = new ViewManagerRegistry(viewManagers);
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a>
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a>return new FabricJSIModuleProvider(
<a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a>    reactApplicationContext,
<a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a>    componentFactory,
<a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a>    new EmptyReactNativeConfig(),
<a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a>    viewManagerRegistry);
</code></pre></div>
<p>然后我们利用新架构提供的 Codegen，调用 gradlew generateCodegenArtifactsFromSchema 生成代码 Native 代码：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>../gradlew generateCodegenArtifactsFromSchema
</code></pre></div>
<p>最后，运行即可。Android 端的实现就是这样，接下来我们再看下 iOS 端。</p>
<h3 id="ios_2">iOS</h3>
<p>在iOS端汇总，首先我们要创建一个继承于RCTViewComponentView 的一个类作为视频组件，如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>@interface VideoComponentView : RCTViewComponentView
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>//声明播放器组件的一些方法
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>//播放视频
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>- (void)playVideo;
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>//停止视频
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a>- (void)stopVideo;
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a>//暂停视频
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a>- (void)pauseVideo;
<a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a>@end
</code></pre></div>
<p>之后，该类需要遵循一个协议，协议中需要声明执行Command的方法名，示例代码如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>@protocol VideoComponentViewProtocol &lt;NSObject&gt;
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>- (void)callNativeMethodToPlayVideo;
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>- (void)callNativeMethodToStopyVideo;
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>- (void)callNativeMethodToPauseVideo;
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>@end
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a>RCT_EXTERN inline void VideoComponentCommand(
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a>        id&lt;VideoComponentViewProtocol&gt; componentView,
<a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a>        NSString const *commandName,
<a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a>        NSArray const *args)
<a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a>
<a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a>    if([commandName isEqualToString:@&quot;callNativeMethodToPlayVideo&quot;]){
<a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a>        [componentView callNativeMethodToPlayVideo];
<a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a>        return;
<a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a>    }
<a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a>
<a id="__codelineno-42-17" name="__codelineno-42-17" href="#__codelineno-42-17"></a>    if(![commandName isEqualToString:@&quot;callNativeMethodToStopVideo&quot;]){
<a id="__codelineno-42-18" name="__codelineno-42-18" href="#__codelineno-42-18"></a>        [componentView callNativeMethodToStopVideo];
<a id="__codelineno-42-19" name="__codelineno-42-19" href="#__codelineno-42-19"></a>        return;
<a id="__codelineno-42-20" name="__codelineno-42-20" href="#__codelineno-42-20"></a>    }
<a id="__codelineno-42-21" name="__codelineno-42-21" href="#__codelineno-42-21"></a>
<a id="__codelineno-42-22" name="__codelineno-42-22" href="#__codelineno-42-22"></a>    if(![commandName isEqualToString:@&quot;callNativeMethodToPauseVideo&quot;]){
<a id="__codelineno-42-23" name="__codelineno-42-23" href="#__codelineno-42-23"></a>        [componentView callNativeMethodToPauseVideo];    
<a id="__codelineno-42-24" name="__codelineno-42-24" href="#__codelineno-42-24"></a>        return;
<a id="__codelineno-42-25" name="__codelineno-42-25" href="#__codelineno-42-25"></a>    }
<a id="__codelineno-42-26" name="__codelineno-42-26" href="#__codelineno-42-26"></a>    return;
<a id="__codelineno-42-27" name="__codelineno-42-27" href="#__codelineno-42-27"></a>)
</code></pre></div>
<p>接下来，ComponentView需要遵循该Protocol协议，并在执行common时调用对应的方法。此外，我们还可以设置组件的属性：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>using namespace facebook::react;
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>@interface VideoComponentView() &lt;VideoComponentViewProtocol&gt;
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>@end
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a>@implementation VideoComponentView{
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a>  VideoPlayer *_videoPlayer;
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a>}
<a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a>
<a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a>#pragma mark - Native Commands
<a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a>- (void)handleCommand:(const NSString *)commandName args:(const NSArray *)args{
<a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a>  VideoComponentCommand(self, commandName, args);
<a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a>}
<a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a>
<a id="__codelineno-43-15" name="__codelineno-43-15" href="#__codelineno-43-15"></a>- (void)callNativeMethodToPlayVideo{
<a id="__codelineno-43-16" name="__codelineno-43-16" href="#__codelineno-43-16"></a>  //实现视频播放功能
<a id="__codelineno-43-17" name="__codelineno-43-17" href="#__codelineno-43-17"></a>  [_videoPlayer startPlay];
<a id="__codelineno-43-18" name="__codelineno-43-18" href="#__codelineno-43-18"></a>}
<a id="__codelineno-43-19" name="__codelineno-43-19" href="#__codelineno-43-19"></a>
<a id="__codelineno-43-20" name="__codelineno-43-20" href="#__codelineno-43-20"></a>- (void)callNativeMethodToStopVideo{
<a id="__codelineno-43-21" name="__codelineno-43-21" href="#__codelineno-43-21"></a>  //实现视频停止功能
<a id="__codelineno-43-22" name="__codelineno-43-22" href="#__codelineno-43-22"></a>  [_videoPlayer stopPlay];
<a id="__codelineno-43-23" name="__codelineno-43-23" href="#__codelineno-43-23"></a>}
<a id="__codelineno-43-24" name="__codelineno-43-24" href="#__codelineno-43-24"></a>
<a id="__codelineno-43-25" name="__codelineno-43-25" href="#__codelineno-43-25"></a>- (void)callNativeMethodToPauseVideo{
<a id="__codelineno-43-26" name="__codelineno-43-26" href="#__codelineno-43-26"></a>  //实现视频暂停功能
<a id="__codelineno-43-27" name="__codelineno-43-27" href="#__codelineno-43-27"></a>  [_videoPlayer pausePlay];
<a id="__codelineno-43-28" name="__codelineno-43-28" href="#__codelineno-43-28"></a>}
<a id="__codelineno-43-29" name="__codelineno-43-29" href="#__codelineno-43-29"></a>
<a id="__codelineno-43-30" name="__codelineno-43-30" href="#__codelineno-43-30"></a>#pragma mark - Props
<a id="__codelineno-43-31" name="__codelineno-43-31" href="#__codelineno-43-31"></a>//遵循descriptor协议
<a id="__codelineno-43-32" name="__codelineno-43-32" href="#__codelineno-43-32"></a>+ (ComponentDescriptorProvider)componentDescriptorProvider{
<a id="__codelineno-43-33" name="__codelineno-43-33" href="#__codelineno-43-33"></a>  return concreteComponentDescriptorProvider&lt;VideoComponentDescriptor&gt;();
<a id="__codelineno-43-34" name="__codelineno-43-34" href="#__codelineno-43-34"></a>}
<a id="__codelineno-43-35" name="__codelineno-43-35" href="#__codelineno-43-35"></a>
<a id="__codelineno-43-36" name="__codelineno-43-36" href="#__codelineno-43-36"></a>- (instancetype)initWithFrame:(CGRect)frame{
<a id="__codelineno-43-37" name="__codelineno-43-37" href="#__codelineno-43-37"></a>  if (self = [super initWithFrame:frame]) {
<a id="__codelineno-43-38" name="__codelineno-43-38" href="#__codelineno-43-38"></a>    static const auto defaultProps = std::make_shared&lt;const ComponentViewProps&gt;();
<a id="__codelineno-43-39" name="__codelineno-43-39" href="#__codelineno-43-39"></a>    _props = defaultProps;
<a id="__codelineno-43-40" name="__codelineno-43-40" href="#__codelineno-43-40"></a>
<a id="__codelineno-43-41" name="__codelineno-43-41" href="#__codelineno-43-41"></a>    _videoPlayer = [[VideoPlayer alloc] init];
<a id="__codelineno-43-42" name="__codelineno-43-42" href="#__codelineno-43-42"></a>    self.contentView = _videoPlayer;
<a id="__codelineno-43-43" name="__codelineno-43-43" href="#__codelineno-43-43"></a>  }
<a id="__codelineno-43-44" name="__codelineno-43-44" href="#__codelineno-43-44"></a>  return self;
<a id="__codelineno-43-45" name="__codelineno-43-45" href="#__codelineno-43-45"></a>}
<a id="__codelineno-43-46" name="__codelineno-43-46" href="#__codelineno-43-46"></a>
<a id="__codelineno-43-47" name="__codelineno-43-47" href="#__codelineno-43-47"></a>- (void)updateProps:(Props::Shared const &amp;)props oldProps:(Props::Shared const &amp;)oldProps{
<a id="__codelineno-43-48" name="__codelineno-43-48" href="#__codelineno-43-48"></a>  [super updateProps:props oldProps:oldProps];
<a id="__codelineno-43-49" name="__codelineno-43-49" href="#__codelineno-43-49"></a>}
<a id="__codelineno-43-50" name="__codelineno-43-50" href="#__codelineno-43-50"></a>
<a id="__codelineno-43-51" name="__codelineno-43-51" href="#__codelineno-43-51"></a>- (void)onChange:(UIView *)sender{
<a id="__codelineno-43-52" name="__codelineno-43-52" href="#__codelineno-43-52"></a>  // No-op
<a id="__codelineno-43-53" name="__codelineno-43-53" href="#__codelineno-43-53"></a>  //  std::dynamic_pointer_cast&lt;const ViewEventEmitter&gt;(_eventEmitter)
<a id="__codelineno-43-54" name="__codelineno-43-54" href="#__codelineno-43-54"></a>  //      -&gt;onChange(ViewEventEmitter::OnChange{.value = static_cast&lt;bool&gt;(sender.on)});
<a id="__codelineno-43-55" name="__codelineno-43-55" href="#__codelineno-43-55"></a>}
<a id="__codelineno-43-56" name="__codelineno-43-56" href="#__codelineno-43-56"></a>
<a id="__codelineno-43-57" name="__codelineno-43-57" href="#__codelineno-43-57"></a>@end
<a id="__codelineno-43-58" name="__codelineno-43-58" href="#__codelineno-43-58"></a>
<a id="__codelineno-43-59" name="__codelineno-43-59" href="#__codelineno-43-59"></a>Class&lt;RCTComponentViewProtocol&gt; VideoViewCls(void){
<a id="__codelineno-43-60" name="__codelineno-43-60" href="#__codelineno-43-60"></a>  return VideoComponentView.class;
<a id="__codelineno-43-61" name="__codelineno-43-61" href="#__codelineno-43-61"></a>}
</code></pre></div>
<p>接着，注册属性遵循VideoComponentDescriptor，并且需要指定该组件的名字：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>namespace facebook {
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>namespace react {
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>using VideoComponentDescriptor = ConcreteComponentDescriptor&lt;VideoViewShadowNode&gt;;
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>} // namespace react
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a>} // namespace facebook
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a>
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a>namespace facebook {
<a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a>namespace react {
<a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a>    extern const char VideoViewComponentName[];
<a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a>    using VideoViewShadowNode = ConcreteViewShadowNode&lt;
<a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a>         VideoViewComponentName,//组件名
<a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a>         VideoViewProps&gt;;//注册属性
<a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a>} // namespace react
<a id="__codelineno-44-14" name="__codelineno-44-14" href="#__codelineno-44-14"></a>} // namespace facebook
<a id="__codelineno-44-15" name="__codelineno-44-15" href="#__codelineno-44-15"></a>
<a id="__codelineno-44-16" name="__codelineno-44-16" href="#__codelineno-44-16"></a>namespace facebook {
<a id="__codelineno-44-17" name="__codelineno-44-17" href="#__codelineno-44-17"></a>namespace react {
<a id="__codelineno-44-18" name="__codelineno-44-18" href="#__codelineno-44-18"></a>extern const char VideoViewComponentName[] = &quot;VideoView&quot;;//组件名
<a id="__codelineno-44-19" name="__codelineno-44-19" href="#__codelineno-44-19"></a>} // namespace react
<a id="__codelineno-44-20" name="__codelineno-44-20" href="#__codelineno-44-20"></a>} // namespace facebook
<a id="__codelineno-44-21" name="__codelineno-44-21" href="#__codelineno-44-21"></a>
<a id="__codelineno-44-22" name="__codelineno-44-22" href="#__codelineno-44-22"></a>namespace facebook {
<a id="__codelineno-44-23" name="__codelineno-44-23" href="#__codelineno-44-23"></a>namespace react {
<a id="__codelineno-44-24" name="__codelineno-44-24" href="#__codelineno-44-24"></a>//属性定义
<a id="__codelineno-44-25" name="__codelineno-44-25" href="#__codelineno-44-25"></a>class VideoViewProps final : public ViewProps {
<a id="__codelineno-44-26" name="__codelineno-44-26" href="#__codelineno-44-26"></a> public:
<a id="__codelineno-44-27" name="__codelineno-44-27" href="#__codelineno-44-27"></a>  VideoViewProps() = default;
<a id="__codelineno-44-28" name="__codelineno-44-28" href="#__codelineno-44-28"></a>  VideoViewProps(const PropsParserContext&amp; context, const VideoViewProps &amp;sourceProps, const RawProps &amp;rawProps);
<a id="__codelineno-44-29" name="__codelineno-44-29" href="#__codelineno-44-29"></a>
<a id="__codelineno-44-30" name="__codelineno-44-30" href="#__codelineno-44-30"></a>  #pragma mark - Props
<a id="__codelineno-44-31" name="__codelineno-44-31" href="#__codelineno-44-31"></a>  std::string url{&quot;&quot;};//视频url
<a id="__codelineno-44-32" name="__codelineno-44-32" href="#__codelineno-44-32"></a>};
<a id="__codelineno-44-33" name="__codelineno-44-33" href="#__codelineno-44-33"></a>} // namespace react
<a id="__codelineno-44-34" name="__codelineno-44-34" href="#__codelineno-44-34"></a>} // namespace facebook
</code></pre></div>
<p>这样，我们就创建好了一个 React Native 的 Fabric 组件、定义属性以及 API 的方法。<br />
以上便是如何使用 Fabric 自定义视频播放组件，在混合工程中搭建好新架构的运行环境后，只需要遵守 Fabric 的组件定义方式，进行接口定义、功能实现和组件注册即可。关于一些复杂的 Fabric 组件，可以查看 <a href="https://github.com/software-mansion/react-native-gesture-handler/tree/main/FabricExample">https://github.com/software-mansion/react-native-gesture-handler/tree/main/FabricExample</a>，<a href="https://github.com/software-mansion/react-native-reanimated/tree/main/FabricExample">https://github.com/software-mansion/react-native-reanimated/tree/main/FabricExample</a>，目前 react-native-gesture-handler、react-native-reanimated 都已经适配了新架构，感兴趣的同学可以去学习下。</p>
<h2 id="_4">总结</h2>
<p>这一讲，我们系统讲解了个性化组件的使用场景、生命周期、传输类型，以及通信方式，并通过两个实际案例讲解了如何在新架构下定制个性化的 TurboModules 与 Fabric。而且，我们也简单介绍了一下React Native新架构，你可以通过官方文档进行新架构的体验。</p>
<p>这一讲是我们 Native 相关的三讲中花的时间最长的，也是最“伤肝”的，我们前前后后加调研花了两个月的时间。但我们相信，新架构在未来会有很好的发展，这是可以预见的。因为它解决了 React Native 几个最痛的点，包括启动速度、运行时性能等。如果新架构还能在易用性上继续优化，将会大大拓展 React Native 的用户群体。</p>
<p>因为目前新架构还处于未发布的状态，网上相关的文章大都是对官方纯 React Native 模式 Demo 和介绍，少数几篇会深挖原理，但讲混合模式的新架构运行文章几乎没有。我们这一讲中对 TurboModule 和 Fabric 的讲解，更侧重于如何在混合工程中开启并运行。如果有对 TurboModule、Fabric、JSI 的原理感兴趣的同学，后面有机会我们再来分享。</p>
<h2 id="_5">作业</h2>
<ol>
<li>设计一个打印 Native 日志的 TurboModule，以及一个 Native 加载进度条的 Fabric 组件。</li>
</ol>
<p>欢迎在评论区写下你的想法和经验，和我们多多交流。我们下一讲见。</p>
<div><strong>精选留言（2）</strong></div>
<ul>
<li><span>陈彦祖</span> 👍（0） 💬（0）<p>WritableMap resultMap = new WritableNativeMap(); 下面两行有问题
这行底下的代码有问题，变量名错了，应该是 resultMap.putInt(&quot;code&quot;, 1) 而不是 map
</p>2023-07-12</li><br/><li><span>Geek_ce9101</span> 👍（0） 💬（1）<p>最近有个项目，想直接上rn，但怕未来搞不定，搜了很多，没发现有什么是原声可以而rn不可以的，除了一些动画性能之类的</p>2022-05-27</li><br/>
</ul>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../21-%E6%B7%B7%E5%90%88%E5%BA%94%E7%94%A8%EF%BC%9A%E5%A6%82%E4%BD%95%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E9%9B%86%E6%88%90React%20Native%EF%BC%9F/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 21 混合应用：如何从零开始集成React Native？">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                21 混合应用：如何从零开始集成React Native？
              </div>
            </div>
          </a>
        
        
          
          <a href="../23-%E7%83%AD%E6%9B%B4%E6%96%B0%EF%BC%9A%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%83%AD%E6%9B%B4%E6%96%B0%E5%B9%B3%E5%8F%B0%EF%BC%9F/" class="md-footer__link md-footer__link--next" aria-label="下一页: 23 热更新：如何搭建一个热更新平台？">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                23 热更新：如何搭建一个热更新平台？
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © 2025-Present zkep
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.annotate", "content.code.copy", "content.tooltips", "toc.follow", "navigation.top", "navigation.tabs", "navigation.tabs.sticky", "navigation.prune", "navigation.footer", "navigation.tracking", "navigation.instant", "navigation.instant.progress", "navigation.indexes", "content.tabs.link"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
        <script src="../../../javascript/extra.js"></script>
      
        <script src="../../../javascript/giscus.js"></script>
      
    
  </body>
</html>