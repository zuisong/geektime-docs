ä½ å¥½ï¼Œæˆ‘æ˜¯ç‹æ²›ã€‚ä»Šå¤©æˆ‘ä»¬æ¥èŠèŠ React ä¸­çš„äº‹ä»¶å¤„ç†ã€‚

æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ React ä¸­ï¼Œçˆ¶å­ç»„ä»¶çš„äº¤äº’æ˜¯é€šè¿‡ propsã€‚è¿™ä¸ªæœºåˆ¶å…¶å®æ˜¯åŒå‘çš„ï¼Œçˆ¶ç»„ä»¶é€šè¿‡ props æŠŠå€¼ä¼ é€’ç»™å­ç»„ä»¶ï¼Œè€Œå­ç»„ä»¶åˆ™é€šè¿‡æš´éœ²ä¸€äº›äº‹ä»¶ï¼Œç»™çˆ¶ç»„ä»¶åé¦ˆåˆ°ä¸€äº›çŠ¶æ€æˆ–æ•°æ®ã€‚è¿™ä¸¤ä¸ªç¯èŠ‚æ˜¯**ç»„ä»¶ä¹‹é—´é€šä¿¡çš„åŸºç¡€**ï¼Œæ‰€ä»¥éƒ½éœ€è¦ç†Ÿç»ƒæŒæ¡ã€‚

æˆ‘ä»¬å‰é¢çš„è¯¾ç¨‹å·²ç»æœ‰å¾ˆå¤šé€šè¿‡ props ä»çˆ¶ç»„ä»¶ä¼ é€’å‚æ•°çš„å­ç»„ä»¶çš„åœºæ™¯äº†ï¼Œé‚£ä¹ˆä»Šå¤©è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹åœ¨ React ä¸­äº‹ä»¶çš„æœºåˆ¶æ˜¯æ€æ ·çš„ï¼Œä»åŸç†å‡ºå‘ï¼Œå¸®åŠ©ä½ æ·±å…¥ç†è§£ã€‚åŒæ—¶å‘¢ï¼Œä¹Ÿæ¥å­¦ä¹ ä¸€ä¸‹å¯¹äºè‡ªå®šä¹‰äº‹ä»¶ï¼Œä¸€èˆ¬éƒ½æœ‰å“ªäº›å…¸å‹çš„åº”ç”¨åœºæ™¯ï¼Œå¸®åŠ©ä½ å­¦ä»¥è‡´ç”¨ã€‚

## åœ¨ React ä¸­ä½¿ç”¨åŸç”Ÿäº‹ä»¶

åœ¨ React ä¸­è¿›è¡Œäº‹ä»¶ç›‘å¬çš„è¯­æ³•ï¼Œå’ŒåŸç”Ÿ DOM äº‹ä»¶çš„å†™æ³•æ˜¯éå¸¸ç±»ä¼¼çš„ï¼Œéƒ½æ˜¯åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸ŠåŠ ä¸€ä¸ªå›è°ƒå‡½æ•°çš„å±æ€§æ¥å®ç°ã€‚æ¯”å¦‚ä¸‹é¢çš„æ–¹å¼ï¼š

```
<button onClick={handler}>Hello</button> 

```

åœ¨å‰é¢çš„è¯¾ç¨‹ä¸­æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¾ˆå¤šç±»ä¼¼çš„ä¾‹å­ã€‚ä¸è¿‡è¿˜è¦ç‰¹åˆ«è¯´æ˜ä¸€ç‚¹ï¼Œå¯¹äºåŸç”Ÿ DOM çš„äº‹ä»¶ï¼Œæ ‡å‡†çš„çš„å†™æ³•å¯èƒ½æ˜¯éƒ½å°å†™ï¼Œæ¯”å¦‚ onclickã€‚ä½†æ˜¯åœ¨ React ä¸­ï¼Œéƒ½æ˜¯**çº¦å®šä½¿ç”¨éª†é©¼ä½“**ï¼ˆCamel Caseï¼‰ã€‚

é€šè¿‡è¿™ä¸ªè§„å¾‹ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šä¸ç”¨åˆ»æ„å»è®°äº‹ä»¶çš„åç§°ã€‚æˆ‘ä»¬è¦å§‹ç»ˆè®°å¾—ï¼Œ**åªè¦åŸç”Ÿ DOM æœ‰çš„äº‹ä»¶ï¼Œåœ¨ React ä¸­åŸºæœ¬éƒ½å¯ä»¥ä½¿ç”¨ï¼Œåªæ˜¯å†™æ³•ä¸Šé‡‡ç”¨éª†é©¼ä½“å°±å¯ä»¥äº†**ï¼Œæ¯”å¦‚ onMouseOverã€onChange ç­‰ã€‚

æ­¤å¤–ï¼Œå…³äºäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œé‚£å°±è¦å›åˆ°å¾ˆå¤šåŒå­¦ä¹‹å‰åœ¨ç•™è¨€åŒºæåˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼šæ˜¯ä¸æ˜¯æ‰€æœ‰çš„å›è°ƒå‡½æ•°éƒ½éœ€è¦ç”¨ useCallback è¿›è¡Œå°è£…å‘¢ï¼Ÿæ˜¯ä¸æ˜¯ç®€å•çš„å›è°ƒå‡½æ•°å°±å¯ä»¥ä¸ç”¨å°è£…äº†å‘¢ï¼Ÿ

å…¶å®æ˜¯å¦éœ€è¦ useCallback ï¼Œå’Œå‡½æ•°çš„å¤æ‚åº¦æ²¡æœ‰å¿…ç„¶å…³ç³»ï¼Œè€Œæ˜¯**å’Œå›è°ƒå‡½æ•°ç»‘å®šåˆ°å“ªä¸ªç»„ä»¶æœ‰å…³**ã€‚è¿™æ˜¯ä¸ºäº†é¿å…å› ç»„ä»¶å±æ€§å˜åŒ–è€Œå¯¼è‡´ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ã€‚

è€Œå¯¹äºåŸç”Ÿçš„ DOM èŠ‚ç‚¹ï¼Œæ¯”å¦‚ buttonã€input ç­‰ï¼Œæˆ‘ä»¬æ˜¯ä¸ç”¨æ‹…å¿ƒé‡æ–°æ¸²æŸ“çš„ã€‚æ‰€ä»¥å‘¢ï¼Œå¦‚æœä½ çš„äº‹ä»¶å¤„ç†å‡½æ•°æ˜¯ä¼ é€’ç»™åŸç”ŸèŠ‚ç‚¹ï¼Œé‚£ä¹ˆä¸å†™ callbackï¼Œä¹Ÿå‡ ä¹ä¸ä¼šæœ‰ä»»ä½•æ€§èƒ½çš„å½±å“ã€‚

ä½†æ˜¯**å¦‚æœä½ ä½¿ç”¨çš„æ˜¯è‡ªå®šä¹‰ç»„ä»¶ï¼Œæˆ–è€…ä¸€äº› UI æ¡†æ¶çš„ç»„ä»¶ï¼Œé‚£ä¹ˆå›è°ƒå‡½æ•°è¿˜éƒ½åº”è¯¥ç”¨ useCallback è¿›è¡Œå°è£…**ã€‚

##React åŸç”Ÿäº‹ä»¶çš„åŸç†ï¼šåˆæˆäº‹ä»¶ï¼ˆSynthetic Eventsï¼‰

å› ä¸ºåŸç”Ÿäº‹ä»¶çš„æœºåˆ¶æ¯”è¾ƒç‰¹åˆ«ï¼Œæ‰€ä»¥æˆ‘åœ¨è¿™é‡Œè¦ç‰¹åˆ«å¼ºè°ƒä¸€ä¸‹å®ƒçš„åŸç†ã€‚

ç”±äºè™šæ‹Ÿ DOM çš„å­˜åœ¨ï¼Œåœ¨ React ä¸­å³ä½¿ç»‘å®šä¸€ä¸ªäº‹ä»¶åˆ°åŸç”Ÿçš„ DOM èŠ‚ç‚¹ï¼Œäº‹ä»¶ä¹Ÿå¹¶ä¸æ˜¯ç»‘å®šåœ¨å¯¹åº”çš„èŠ‚ç‚¹ä¸Šï¼Œè€Œæ˜¯**æ‰€æœ‰çš„äº‹ä»¶éƒ½æ˜¯ç»‘å®šåœ¨æ ¹èŠ‚ç‚¹ä¸Š**ã€‚ç„¶åç”± React ç»Ÿä¸€ç›‘å¬å’Œç®¡ç†ï¼Œè·å–äº‹ä»¶åå†åˆ†å‘åˆ°å…·ä½“çš„è™šæ‹Ÿ DOM èŠ‚ç‚¹ä¸Šã€‚

åœ¨ React 17 ä¹‹å‰ï¼Œæ‰€æœ‰çš„äº‹ä»¶éƒ½æ˜¯ç»‘å®šåœ¨ document ä¸Šçš„ï¼Œè€Œä»React 17 å¼€å§‹ï¼Œ**æ‰€æœ‰çš„äº‹ä»¶éƒ½ç»‘å®šåœ¨æ•´ä¸ª App ä¸Šçš„æ ¹èŠ‚ç‚¹ä¸Š**ï¼Œè¿™ä¸»è¦æ˜¯ä¸ºäº†ä»¥åé¡µé¢ä¸Šå¯èƒ½å­˜åœ¨å¤šç‰ˆæœ¬ React çš„è€ƒè™‘ã€‚

å…·ä½“æ¥è¯´ï¼ŒReact è¿™ä¹ˆåšçš„åŸå› ä¸»è¦æœ‰ä¸¤ä¸ªã€‚

ç¬¬ä¸€ï¼Œè™šæ‹Ÿ DOM render çš„æ—¶å€™ï¼Œ DOM å¾ˆå¯èƒ½è¿˜æ²¡æœ‰çœŸå®åœ° render åˆ°é¡µé¢ä¸Šï¼Œæ‰€ä»¥æ— æ³•ç»‘å®šäº‹ä»¶ã€‚

ç¬¬äºŒï¼ŒReact å¯ä»¥å±è”½åº•å±‚äº‹ä»¶çš„ç»†èŠ‚ï¼Œé¿å…æµè§ˆå™¨çš„å…¼å®¹æ€§é—®é¢˜ã€‚åŒæ—¶å‘¢ï¼Œå¯¹äº React Native è¿™ç§ä¸æ˜¯é€šè¿‡æµè§ˆå™¨ render çš„è¿è¡Œæ—¶ï¼Œä¹Ÿèƒ½æä¾›ä¸€è‡´çš„ APIã€‚

è¿™é‡Œæœ‰ä¸€ç‚¹æˆ‘è¦å¤šè§£é‡Šä¸‹ã€‚é‚£å°±æ˜¯ä¸ºä»€ä¹ˆäº‹ä»¶ç»‘å®šåœ¨æŸä¸ªæ ¹èŠ‚ç‚¹ä¸Šï¼Œä¹Ÿèƒ½è§¦å‘å®é™… DOM èŠ‚ç‚¹çš„äº‹ä»¶ã€‚

æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨æµè§ˆå™¨çš„åŸç”Ÿæœºåˆ¶ä¸­ï¼Œäº‹ä»¶ä¼šä»è¢«è§¦å‘çš„èŠ‚ç‚¹å¾€çˆ¶èŠ‚ç‚¹å†’æ³¡ï¼Œç„¶åæ²¿ç€æ•´ä¸ªè·¯å¾„ä¸€ç›´åˆ°æ ¹èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ ¹èŠ‚ç‚¹å…¶å®æ˜¯å¯ä»¥æ”¶åˆ°æ‰€æœ‰çš„äº‹ä»¶çš„ã€‚è¿™ä¹Ÿç§°ä¹‹ä¸º**æµè§ˆå™¨äº‹ä»¶çš„å†’æ³¡æ¨¡å‹**ã€‚

å› æ­¤ï¼Œæ— è®ºäº‹ä»¶åœ¨å“ªä¸ªèŠ‚ç‚¹è¢«è§¦å‘ï¼Œ React éƒ½å¯ä»¥é€šè¿‡äº‹ä»¶çš„ srcElement è¿™ä¸ªå±æ€§ï¼ŒçŸ¥é“å®ƒæ˜¯ä»å“ªä¸ªèŠ‚ç‚¹å¼€å§‹å‘å‡ºçš„ï¼Œè¿™æ · React å°±å¯ä»¥æ”¶é›†ç®¡ç†æ‰€æœ‰çš„äº‹ä»¶ï¼Œç„¶åå†ä»¥ä¸€è‡´çš„API æš´éœ²å‡ºæ¥ã€‚

è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬åœ¨å†™åŸç”Ÿäº‹ä»¶çš„æ—¶å€™ï¼Œå°±å†ä¹Ÿä¸ç”¨å†æ‹…å¿ƒæµè§ˆå™¨å…¼å®¹æ€§çš„é—®é¢˜äº†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå°±å±•ç¤ºäº†äº‹ä»¶æœºåˆ¶å†’æ³¡æ¨¡å‹çš„åŸç†ï¼š

![](https://static001.geekbang.org/resource/image/1b/06/1bd06yy56b1103376d0ec45fb87b7906.png?wh=556x862)

å¯¹äºåŸç”Ÿäº‹ä»¶çš„å¤„ç†ï¼Œå¯ä»¥è¯´æ˜¯ React çš„ä¸€ä¸ªåˆ›æ–°ï¼Œä¸ä»…èƒ½å¤Ÿè®©ä½ åƒä»¥å‰åœ¨åŸç”Ÿ DOM èŠ‚ç‚¹ä¸Šå®šä¹‰äº‹ä»¶çš„æ–¹å¼ä¸€æ ·ï¼Œè€Œä¸”è¿˜æä¾›äº†ä¸€è‡´çš„ APIï¼Œè®©æˆ‘ä»¬ä¸ç”¨å†æ‹…å¿ƒæµè§ˆå™¨çš„å…¼å®¹é—®é¢˜ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ›´åŠ å®¹æ˜“ã€‚

## åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶

å¯¹äºä¸€ä¸ªè‡ªå®šä¹‰ç»„ä»¶ï¼Œé™¤äº†å¯ä»¥ä» props æ¥æ”¶å‚æ•°å¹¶ç”¨äºæ¸²æŸ“ä¹‹å¤–ï¼Œè¿˜å¾ˆå¯èƒ½**éœ€è¦å’Œçˆ¶ç»„ä»¶è¿›è¡Œäº¤äº’**ï¼Œä»è€Œåé¦ˆä¿¡æ¯ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦**ä¸ºç»„ä»¶åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶**ï¼Œè¿™ä¹Ÿæ˜¯ React æ•´ä¸ª UI æ¨¡å‹ä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªç¯èŠ‚ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶è‡ªå®šä¹‰äº‹ä»¶å’ŒåŸç”Ÿäº‹ä»¶çœ‹ä¸Šå»ç±»ä¼¼ï¼Œä½†æ˜¯ä¸¤è€…çš„æœºåˆ¶æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ï¼š

- åŸç”Ÿäº‹ä»¶æ˜¯æµè§ˆå™¨çš„æœºåˆ¶ï¼›
- è€Œè‡ªå®šä¹‰äº‹ä»¶åˆ™æ˜¯çº¯ç²¹çš„ç»„ä»¶è‡ªå·±çš„è¡Œä¸ºï¼Œæœ¬è´¨æ˜¯ä¸€ç§å›è°ƒå‡½æ•°æœºåˆ¶ã€‚

å¯èƒ½ä½ ä¸€å¬è‡ªå®šä¹‰äº‹ä»¶ï¼Œä¸‹æ„è¯†å°±è§‰å¾—æœ‰äº›éº»çƒ¦ã€‚ä½†å…¶å®åœ¨ React ä¸­ï¼Œè‡ªå®šä¹‰äº‹ä»¶ä¸ç”¨é€šè¿‡ä»»ä½•ç‰¹æ®Šçš„ APIï¼Œåªéœ€è¦é€šè¿‡ props ç»™ç»„ä»¶ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œç„¶ååœ¨ç»„ä»¶ä¸­çš„æŸä¸ªæ—¶æœºï¼Œæ¯”å¦‚ç”¨æˆ·è¾“å…¥ï¼Œæˆ–è€…æŸä¸ªè¯·æ±‚å®Œæˆæ—¶ï¼Œå»è°ƒç”¨è¿™ä¸ªä¼ è¿‡æ¥çš„å›è°ƒå‡½æ•°å°±å¯ä»¥äº†ã€‚

å½“ç„¶ï¼Œä¹ æƒ¯ä¸Šæˆ‘ä»¬éƒ½ä¼š**å°†è¿™æ ·çš„å›è°ƒå‡½æ•°å‘½åä¸º onSomething è¿™ç§ä»¥â€œ on â€å¼€å¤´çš„åå­—**ï¼Œæ–¹ä¾¿åœ¨ä½¿ç”¨çš„æ—¶å€™ç†è§£ã€‚

å…¶å®åœ¨[ç¬¬6è®²](https://time.geekbang.org/column/article/381423)ä¸­ï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºä¸€ä¸ªä»·æ ¼è¾“å…¥ç»„ä»¶æ—¶å·²ç»å®ç°äº†è‡ªå®šä¹‰äº‹ä»¶ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å…·ä½“åœ°è§£é‡Šã€‚é‚£ä¹ˆåœ¨è¿™é‡Œå†ç»™ä½ ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå®ç°ä¸€ä¸ª on/off çš„åˆ‡æ¢æŒ‰é’®ï¼Œé‚£ä¹ˆç†è§£è‡ªå®šä¹‰äº‹ä»¶ï¼Œå…¶å®å°±éå¸¸ç®€å•äº†ã€‚

ä¸‹é¢å°±æ˜¯å®ç°çš„ä»£ç ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡æ–‡æœ«çš„é“¾æ¥åœ¨çº¿æŸ¥çœ‹ä»£ç å’Œè¿è¡Œæ•ˆæœï¼š

```
import { useState } from "react";

// åˆ›å»ºä¸€ä¸ªæ— çŠ¶æ€çš„å—æ§ç»„ä»¶
function ToggleButton({ value, onChange }) {
  const handleClick = () => {
    onChange(!value);
  };
  return (
    <button style={{ width: "60px" }} onClick={handleClick}>
      <span>{value ? "On" : "Off"}</span>
    </button>
  );
}
```

å¯ä»¥çœ‹åˆ°ï¼Œæ‰€è°“è‡ªå®šä¹‰äº‹ä»¶ï¼Œå°±æ˜¯å®šä¹‰äº†ä¸€ä¸ª onChange è¿™æ ·çš„å±æ€§ï¼Œå…è®¸ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°ç»™è¿™ä¸ªç»„ä»¶ï¼Œåœ¨æŸä¸ªæ—¶æœºå»è°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°ï¼Œä»è€Œå®ç°äº‹ä»¶çš„åŠŸèƒ½ã€‚

é‚£ä¹ˆä¸‹é¢çš„ä»£ç å°±æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨è¿™æ ·ä¸€ä¸ªç»„ä»¶ï¼š

```
import { useState } from "react";
import ToggleButton from './ToggleButton';

function ToggleButtonExample() {
  const [on, setOn] = useState(true);
  return (
    <>
      <h1>Toggle Button</h1>
      <ToggleButton value={on} onChange={(value) => setOn(value)} />
    </>
  );
};
```

è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼ŒToggleButton ç»„ä»¶å†…éƒ¨è°ƒç”¨äº† onChange è¿™ä¸ªé€šè¿‡å±æ€§ä¼ é€’è¿›æ¥çš„å›è°ƒå‡½æ•°ï¼Œå¹¶ä¼ é€’äº†å½“å‰å€¼ç»™å›è°ƒå‡½æ•°ï¼Œä»è€Œå®ç°äº†å­ç»„ä»¶åˆ°çˆ¶ç»„ä»¶çš„é€šä¿¡ã€‚

## ä½¿ç”¨ Hooks å°è£…é”®ç›˜äº‹ä»¶

å¼€ç¯‡è¯å°±æåˆ°ï¼Œæ•´ä¸ªè¯¾ç¨‹æˆ‘ä»¬éƒ½æ˜¯å›´ç»• React Hooks å±•å¼€çš„ï¼Œé‚£ä¹ˆ Hooks åœ¨äº‹ä»¶å¤„ç†æ–¹é¢åˆå¯ä»¥å¸¦æ¥å“ªäº›æ–°çš„æ€è·¯å‘¢ï¼Ÿ

åœ¨[ç¬¬6è®²](https://time.geekbang.org/column/article/381423)æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†ä¸€ä¸ª useScroll çš„ä¾‹å­ï¼Œé€šè¿‡ Hooks ç»‘å®šäº†æ»šåŠ¨æ¡ä½ç½®è¿™ä¸ªæ•°æ®æºã€‚é‚£ä¹ˆè¿™é‡Œå†ç»™å¤§å®¶çœ‹ä¸€ä¸ªç»‘å®šé”®ç›˜æŒ‰é”®çš„ä¾‹å­ï¼Œçœ‹çœ‹å¦‚ä½•ä½¿ç”¨ Hooksï¼Œè®©ä»£ç è¯­ä¹‰æ›´åŠ æ¸…æ™°ã€‚

ç›¸æ¯” useScrollï¼Œé”®ç›˜äº‹ä»¶å¯èƒ½çœ‹ä¸Šå»æ›´åŠ å’Œ Hooks æ²¡æœ‰å…³ç³»ã€‚å› ä¸ºæ»šåŠ¨æ¡ä½ç½®è‡³å°‘åœ¨ç›´è§‚ä¸Šæ˜¯ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„æ•°æ®ï¼Œä½†æ˜¯é”®ç›˜å‘¢ï¼Œå´å®Œå…¨æ˜¯ä¸€ä¸ªä¸ªç‹¬ç«‹çš„äº‹ä»¶ã€‚

ä¸è¿‡ï¼Œå¦‚æœä½ å……åˆ†è®¤è¯†åˆ° **Hooks å…·å¤‡ç»‘å®šä»»ä½•æ•°æ®æºçš„èƒ½åŠ›**ï¼Œé‚£ä½ å°±ä¼šçŸ¥é“ï¼Œé”®ç›˜è¾“å…¥æ­£æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„æ•°æ®æºã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠé”®ç›˜è¾“å…¥å˜æˆæŸä¸ªçŠ¶æ€ï¼Œæ–¹ä¾¿åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ã€‚

åœ¨æ²¡æœ‰ Hooks çš„æ—¶å€™ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬è¦è®©æŸä¸ªæ˜¾ç¤ºè¡¨æ ¼çš„é¡µé¢ï¼Œæ”¯æŒé€šè¿‡å·¦å³é”®è¿›è¡Œç¿»é¡µçš„åŠŸèƒ½ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦åœ¨ useEffect é‡Œå»åš window.addEventListnnerï¼Œç„¶ååœ¨è¿”å›çš„å›è°ƒå‡½æ•°é‡Œå» window.removeEventListnnerï¼Œå®ç°èµ·æ¥å°±å¾ˆéº»çƒ¦ã€‚

ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ç”¨ä¸€ä¸ª Hook æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œé‚£ä¹ˆåªè¦å®ç°ä¸€æ¬¡ï¼Œå°±å¯ä»¥åœ¨å¤šä¸ªç»„ä»¶ä¸­ä½¿ç”¨äº†ã€‚ä¸‹é¢å°±æ˜¯è¿™ä¸ª Hook çš„å®ç°ä»£ç ï¼š

```
import { useEffect, useState } from "react";

// ä½¿ç”¨ document.body ä½œä¸ºé»˜è®¤çš„ç›‘å¬èŠ‚ç‚¹
const useKeyPress = (domNode = document.body) => {
  const [key, setKey] = useState(null);
  useEffect(() => {
    const handleKeyPress = (evt) => {
      setKey(evt.keyCode);
    };
    // ç›‘å¬æŒ‰é”®äº‹ä»¶
    domNode.addEventListener("keypress", handleKeyPress);
    return () => {
      // æ¥è§¦ç›‘å¬æŒ‰é”®äº‹ä»¶
      domNode.removeEventListener("keypress", handleKeyPress);
    };
  }, [domNode]);
  return key;
};
```

æœ‰äº†è¿™ä¸ª Hookï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™å°±éå¸¸æ–¹ä¾¿ï¼Œæ— éœ€åšä»»ä½•äº‹ä»¶çš„ç»‘å®šï¼Œè€Œæ˜¯**åªè¦æŠŠé”®ç›˜æŒ‰é”®çœ‹åšæ˜¯ä¸€ä¸ªä¸æ–­å˜åŒ–çš„æ•°æ®æº**ï¼Œè¿™æ ·ï¼Œå°±å¯ä»¥å»å®æ—¶ç›‘å¬æŸä¸ª DOM èŠ‚ç‚¹ä¸Šè§¦å‘çš„é”®ç›˜äº‹ä»¶äº†ã€‚

æ¯”å¦‚ä¸‹é¢å°±æ˜¯å»æ˜¾ç¤ºå½“å‰æŒ‰é”®çš„ä¸€ä¸ªç®€å•ä½¿ç”¨ä¾‹å­ï¼š

```
import useKeyPress from './useKeyPress';

function UseKeyPressExample() => {
  const key = useKeyPress();
  return (
    <div>
      <h1>UseKeyPress</h1>
      <label>Key pressed: {key || "N/A"}</label>
    </div>
  );
};
```

## å°ç»“

åœ¨è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬ä¸»è¦å­¦ä¹ äº† React ä¸­çš„äº‹ä»¶æœºåˆ¶ã€‚äº‹ä»¶å…¶å®åˆ†ä¸ºä¸¤ç§ã€‚

ä¸€ç§æ˜¯**åŸç”Ÿçš„DOM äº‹ä»¶**ï¼Œåœ¨ç”¨æ³•ä¸Šå’Œæ ‡å‡†çš„ DOM API æ˜¯åŸºæœ¬ä¸€ä¸€æ˜ å°„çš„ï¼Œé€šè¿‡äº‹ä»¶åˆæˆçš„æœºåˆ¶ï¼ŒReact èƒ½å¤Ÿæä¾›ç»Ÿä¸€çš„ API æ¥æŠ¹å¹³æµè§ˆå™¨ä¹‹é—´çš„å·®å¼‚ï¼Œè®©å¼€å‘æ›´åŠ ç®€å•ã€‚

å¦ä¸€ç§äº‹ä»¶åˆ™æ˜¯**è‡ªå®šä¹‰äº‹ä»¶**ï¼Œæ‰€è°“çš„è‡ªå®šä¹‰äº‹ä»¶ï¼Œå…¶å®å°±æ˜¯åˆ©ç”¨äº†å±æ€§ä¼ é€’å›è°ƒå‡½æ•°ç»™å­ç»„ä»¶ï¼Œå®ç°äº‹ä»¶çš„è§¦å‘ã€‚æœ¬è´¨ä¸Šï¼Œå®ƒå’ŒåŸç”Ÿäº‹ä»¶çš„æœºåˆ¶æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ï¼ŒåŸç”Ÿäº‹ä»¶æ˜¯æµè§ˆå™¨å±‚é¢çš„äº‹ä»¶ï¼Œè€Œè‡ªå®šä¹‰äº‹ä»¶åˆ™æ˜¯çº¯ç»„ä»¶å®ç°çš„ä¸€ç§æœºåˆ¶ã€‚

æœ€åå‘¢ï¼Œæˆ‘ä»¬åˆ†æäº†ä¸€ä¸ªä¾‹å­ï¼šå¦‚ä½•ç”¨ Hooks å»ç®€åŒ–äº‹ä»¶çš„å¤„ç†ã€‚å°†é”®ç›˜æŒ‰é”®è¿™ä¸ªäº‹ä»¶å°è£…æˆäº†ä¸€ä¸ª Hookï¼Œå°±å¯ä»¥ç®€åŒ–é”®ç›˜äº‹ä»¶çš„ä½¿ç”¨ï¼Œä¹Ÿå¾ˆå¥½åœ°å±•ç¤ºäº† Hooks çš„æ€è·¯å¸¦ç»™æˆ‘ä»¬çš„æƒŠå–œï¼Œå¯ä»¥è®©æœ¬æ¥å¾ˆæŠ€æœ¯çš„ä¸€äº›å®ç°ï¼Œæ¯”å¦‚äº‹ä»¶çš„ç›‘å¬å’Œè§£ç»‘ï¼Œå˜å¾—æ›´åŠ å…·æœ‰è¯­ä¹‰ï¼Œä»è€Œä¹Ÿè®©ä»£ç æ›´å®¹æ˜“ç†è§£å’Œç»´æŠ¤ã€‚

æœ€åï¼Œé™„ä¸Šè¿™èŠ‚è¯¾æ‰€æœ‰çš„ä»£ç å’Œè¿è¡Œç»“æœçš„é“¾æ¥ï¼š[https://codesandbox.io/s/react-hooks-course-20vzg](https://codesandbox.io/s/react-hooks-course-20vzg)ã€‚

## æ€è€ƒé¢˜

åœ¨é”®ç›˜æŒ‰é”®çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯å®ç°äº†å•ä¸ªæŒ‰é”®çš„ç›‘å¬ï¼Œå¦‚æœæˆ‘ä»¬è¦å®ç°åŒæ—¶ä¸¤ä¸ªæŒ‰é”®çš„ç›‘å¬å‘¢ï¼Ÿæ¯”å¦‚åŒæ—¶æŒ‰ä¸‹ A å’Œ Bï¼Œé‚£ä¹ˆç”¨ Hooks æ€ä¹ˆå»æ¯”è¾ƒå¥½çš„å®ç°ï¼Ÿ

è¿™èŠ‚è¯¾çš„é¢˜ç›®æœ‰ç‚¹éš¾åº¦ï¼Œä½†æ˜¯ä¼šå¯¹ä½ çš„å­¦ä¹ å¾ˆæœ‰å¸®åŠ©ï¼Œå¸Œæœ›ä½ å¯ä»¥æ·±åº¦æ€è€ƒä¸€ä¸‹ï¼Œå¹¶åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„æƒ³æ³•å’Œæ€è€ƒã€‚åŒæ—¶ï¼Œæˆ‘ä¹Ÿä¼šæŠŠä¸€äº›ä¸é”™çš„å›ç­”è¿›è¡Œç½®é¡¶ï¼Œä¾›å¤§å®¶å­¦ä¹ äº¤æµã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ15ï¼‰</strong></div><ul>
<li><span>lugusliu</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<p>â€é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦åœ¨ useEffect é‡Œå»åš window.addEventListnerï¼Œç„¶ååœ¨è¿”å›çš„å›è°ƒå‡½æ•°é‡Œå» window.removeEventListnerï¼Œå®ç°èµ·æ¥å°±å¾ˆéº»çƒ¦â€œ
è¿™é‡Œæœ‰ä¸¤å¤„ç¬”è¯¯
addEventListner -&gt; addEventListener
removeEventListner -&gt; removeEventListener</p>2021-08-16</li><br/><li><span>å–µå’ªçˆ±åƒè‚‰</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è¿½ç•ªï½</p>2021-06-19</li><br/><li><span>å‰ç«¯å°çŒª</span> ğŸ‘ï¼ˆ12ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>å› ä¸ºç‚¹å‡»äº†ä¸¤ä¸ªæŒ‰é’®ä¼šè§¦å‘ä¸¤ä¸ªäº‹ä»¶ï¼Œæ‰€ä»¥æˆ‘çš„æƒ³æ³•æ˜¯ï¼šä½¿ç”¨æ•°ç»„çš„æ–¹å¼å­˜å‚¨keyå€¼,keyupçš„æ—¶å€™æ¸…ç©ºæ•°ç»„å°±è¡Œäº†ï¼š
const useKeyPress = (domNode = document.body) =&gt; {
    const [keys, setKeys] = useState([])
    useEffect(() =&gt; {
      const handleKeyPress = evt =&gt; {
        setKeys(prevKeys =&gt; {
          if (prevKeys.length !== 2) {
            return [...prevKeys, evt.keyCode]
          } else {
            return prevKeys
          }
        })
      }
      domNode.addEventListener(&#39;keypress&#39;, handleKeyPress)
      return () =&gt; {
        domNode.removeEventListener(&#39;keypress&#39;, handleKeyPress)
      }
    }, [domNode])
    return keys
  }</p>2021-06-20</li><br/><li><span>Geek_9ab0c7</span> ğŸ‘ï¼ˆ11ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>åŸºæœ¬æ€è·¯ï¼š 1. ä½¿ç”¨æ•°ç»„å­˜å€¼ï¼›2. keydownå­˜å€¼ï¼› 3. å½“keyupè¡¨ç¤ºå•é”®æˆ–è€…ç»„åˆé”®æŒ‰é”®ç»“æŸï¼Œæ¸…ç©ºæ•°ç»„ï¼›4.å½“é•¿æŒ‰é”®ä¸æ”¾ä¼šå¤šæ¬¡è§¦å‘äº‹ä»¶ï¼Œæ‰€ä»¥setKeyæ—¶éœ€è¦å»é‡

export default function useKeyPress (dom = document.body) {
  const [key, setKey] = useState([])
  const isNext = useRef(true) &#47;&#47; å½“keyupä¹‹åï¼ŒisNextç½®ä¸ºtrueè¡¨ç¤ºåˆæ˜¯æ–°ä¸€è½®çš„æŒ‰é”®ç›‘å¬
  useEffect(() =&gt; {
    const handleKeyPress = (e) =&gt; {
      if (e.type === &#39;keydown&#39;) {
        if (isNext.current) setKey([])
        setKey(keys =&gt; [...new Set([...keys, e.key])]) &#47;&#47; å»é‡
        isNext.current = false
      } else {
        isNext.current = true
      }
    }
    dom.addEventListener(&#39;keydown&#39;, handleKeyPress)
    dom.addEventListener(&#39;keyup&#39;, handleKeyPress)
    return () =&gt; {
      dom.removeEventListener(&#39;keydown&#39;, handleKeyPress)
      dom.removeEventListener(&#39;keydown&#39;, handleKeyPress)
    }
  }, [dom])
  return key.join(&#39;,&#39;)
}</p>2021-07-14</li><br/><li><span>çŸ¥æ•…</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>æˆ‘ä»¬å¯ä»¥åˆ†åˆ«å»ºç«‹2ä¸ªæŒ‰ä¸‹çš„hooksï¼Œä»¥åŠ2ä¸ªå¼¹èµ·çš„hooks, ä½œä¸ºæ•°æ®æºï¼Œç”¨ä¸€ä¸ªuseMemoæ¥ç›‘æ§è¿™2ä¸ªé”®åŒæ—¶æŒ‰ä¸‹çš„çŠ¶æ€</p>2021-08-29</li><br/><li><span>ç½—å¤§æ˜</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>è€å¸ˆï¼Œè¿™æ ·æ‹¿åˆ°çš„keyCodeå…¶å®æ˜¯ä¸Šä¸€æ¬¡çš„å§ï¼ˆä¹Ÿå°±æ˜¯ä¸Šä¸€ä¸ªæŒ‰ä¸‹çš„é”®ç›˜ï¼‰è¿™æ ·ç›‘å¬æ²¡ä»€ä¹ˆæ„ä¹‰å•Š</p>2021-08-05</li><br/><li><span>é—²é—²</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆæˆ‘æœ‰ä¸¤ä¸ªé—®é¢˜ï¼Œéº»çƒ¦å¸®å¿™è§£ç­”ä¸‹ï¼š
1ã€ä¸Šé¢ç»‘å®šçš„é”®ç›˜äº‹ä»¶ï¼Œhooké‡Œé¢å…·ä½“ä»€ä¹ˆæ—¶å€™å›æ³¨é”€è¿™ä¸ªäº‹ä»¶å‘¢ï¼Œä»£ç æ˜¯åœ¨useEffect returné‡Œé¢æ³¨é”€äº‹ä»¶çš„ï¼Œé‚£å…·ä½“ä»€ä¹ˆæ—¶å€™ä¼šèµ°åˆ°è¿™ä»£ç é‡Œé¢å‘¢ï¼Ÿ
2ã€çœ‹åˆ°è¿™èŠ‚è¯¾å†…å®¹æˆ‘æƒ³èµ·æ¥ä¹‹å‰å°è£…ç»„ä»¶é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼Œåœºæ™¯æ˜¯è¿™æ ·ï¼Œéœ€è¦å°è£…ä¸€ä¸ªå…¬å…±ç»„ä»¶ï¼Œå¯¹äºåŸç”Ÿdomäº‹ä»¶éœ€è¦éƒ½èƒ½æ¥å—ï¼Œå…¶ä»–çš„æ— ç”¨çš„propsä¸æƒ³æ¥å—ï¼Œreactæœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥åˆ¤æ–­å½“å‰çš„äº‹ä»¶æ˜¯ä¸æ˜¯åŸç”Ÿdomæ”¯æŒçš„å—ï¼Ÿè¿˜æ˜¯è¯´æˆ‘éœ€è¦å…·ä½“çš„ä¸€ä¸€ç½—åˆ—ï¼Ÿ</p>2021-06-29</li><br/><li><span>23568</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>const useKeyPress = (domNode = document.body) =&gt; {
  const [key, setKey] = useState([]);
  useEffect(() =&gt; {
    const handleKeyPress = (evt) =&gt; {
      if (key.length === 2) {
        const tmpKey = [...key];
        tmpKey.shift();
        tmpKey.push(evt.key);
        setKey(tmpKey);
      } else {
        setKey((prev) =&gt; {
          return [...prev, evt.key];
        });
      }
    };
    domNode.addEventListener(&quot;keypress&quot;, handleKeyPress);
    return () =&gt; {
      domNode.removeEventListener(&quot;keypress&quot;, handleKeyPress);
    };
  }, [domNode, key]);
  return key;
};</p>2022-11-28</li><br/><li><span>INFRA_UEX</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>React åº”è¯¥ä¹Ÿå¯ä»¥åœ¨æ•è·é˜¶æ®µç›‘å¬äº‹ä»¶ã€‚ä¾‹å¦‚ `onClickCapture`ã€‚</p>2022-11-07</li><br/><li><span>Geek_d15b65</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>const useKeyPress = (domNode = document.body ) =&gt; {
  const [key1, setKey1] = useState(null);
  const [key2, setKey2] = useState(null);
  const [flag, setFlag] = useState(0);
  useEffect(() =&gt; {
    const handleKeyPress = (evt) =&gt; {
      &#47;&#47; è®¾ç½®ä¸¤ç§çŠ¶æ€ï¼Œ 0 æ˜¯key1ï¼Œ1æ˜¯key2
      if(flag === 0){
        setKey1(evt.keyCode);
        setKey2(null);
        setFlag(1);
      }else if (flag === 1){
        setKey2(evt.keyCode);
        setFlag(0);
      }

    };
    &#47;&#47; ç›‘å¬æŒ‰é”®äº‹ä»¶
    domNode.addEventListener(&#39;keypress&#39;, handleKeyPress);
    return () =&gt; {
      domNode.removeEventListener(&#39;keypress&#39;, handleKeyPress);
    }
  },[domNode, flag]);
  return { key1, key2 };
}
</p>2022-06-20</li><br/><li><span>æˆ‘æ˜¯æµ‹è¯•å°è¾¾äºº</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>const useKeyboard = (domNode = document.body) =&gt; {
  const [keys, setKeys] = useState([]);
  useEffect(() =&gt; {
    const handleKeyPress = evt =&gt; setKeys(keys =&gt; [...keys, evt.keyCode]);
    const handleKeyUp = evt =&gt; setKeys(keys =&gt; keys.filter(k =&gt; k !== evt.keyCode));
    domNode.addEventListener(&quot;keypress&quot;, handleKeyPress); &#47;&#47; æŒ‰ä¸‹
    domNode.addEventListener(&quot;keyup&quot;, handleKeyUp); &#47;&#47; æŒ‰ä¸‹
    return () =&gt; {
      &#47;&#47; æ¥è§¦ç›‘å¬æŒ‰é”®äº‹ä»¶
      domNode.removeEventListener(&quot;keypress&quot;, handleKeyPress);
      domNode.removeEventListener(&quot;keyup&quot;, handleKeyUp);
    };
  }, [domNode]);
  return keys;
}</p>2021-07-01</li><br/><li><span>ä½™ç†™</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<p>â€œå¦‚æœä½ çš„äº‹ä»¶å¤„ç†å‡½æ•°æ˜¯ä¼ é€’ç»™åŸç”ŸèŠ‚ç‚¹ï¼Œé‚£ä¹ˆä¸å†™ callbackï¼Œä¹Ÿå‡ ä¹ä¸ä¼šæœ‰ä»»ä½•æ€§èƒ½çš„å½±å“ã€‚â€
ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Œæ˜¯ä¸æ˜¯å› ä¸ºåŸç”ŸèŠ‚ç‚¹ï¼Œæœ¬æ¥å°±è¦ä¸æ–­æ¸²æŸ“</p>2021-06-28</li><br/><li><span>å´å°ä¸½</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>ä¸å¤ªç†è§£[domNode]æœ‰å•¥ä½œç”¨ï¼Œä¸ç”¨å®ƒï¼Œä¾‹å­ä¹Ÿèƒ½æˆ</p>2021-06-21</li><br/><li><span>Free fall</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>å¯ä»¥æŒ‰å¤šä¸ª
const useKeypress = (node = document.body) =&gt; {
  const [key, setKey] = useState(null)

  function reset() {
    setKey(null)
  }

  useEffect(() =&gt; {
    function handleKeypress(e) {
      setKey((key) =&gt; key + &#39;,&#39; + e.keyCode)
    }

    node &amp;&amp; node.addEventListener(&#39;keypress&#39;, handleKeypress)

    return () =&gt; {
      node.removeEventListener(&#39;keypress&#39;, handleKeypress)
    }
  }, [node])

  return [key, reset]
}</p>2021-06-20</li><br/><li><span>é”™è¯¯ä»£ç 0000</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆï¼Œä¼šæœ‰è‡ªå®šä¹‰hookå˜›ã€‚ã€‚ æƒ³å¯¹å…¶åœºæ™¯å’Œå°è£…åŠ æ·±ç†è§£</p>2021-06-20</li><br/>
</ul>