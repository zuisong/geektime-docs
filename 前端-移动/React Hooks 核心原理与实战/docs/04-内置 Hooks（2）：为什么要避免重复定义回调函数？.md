ä½ å¥½ï¼Œæˆ‘æ˜¯ç‹æ²›ã€‚è¿™èŠ‚è¯¾æˆ‘ä»¬æ¥ç»§ç»­å­¦ä¹ å†…ç½® Hooks çš„ç”¨æ³•ã€‚

åœ¨ä¸ŠèŠ‚è¯¾ä½ å·²ç»çœ‹åˆ°äº† useState å’Œ useEffect è¿™ä¸¤ä¸ªæœ€ä¸ºæ ¸å¿ƒçš„ Hooks çš„ç”¨æ³•ã€‚ç†è§£äº†å®ƒä»¬ï¼Œä½ åŸºæœ¬ä¸Šå°±æŒæ¡äº† React å‡½æ•°ç»„ä»¶çš„å¼€å‘æ€è·¯ã€‚

ä½†æ˜¯è¿˜æœ‰ä¸€äº›ç»†èŠ‚é—®é¢˜ï¼Œä¾‹å¦‚äº‹ä»¶å¤„ç†å‡½æ•°ä¼šè¢«é‡å¤å®šä¹‰ã€æ•°æ®è®¡ç®—è¿‡ç¨‹æ²¡æœ‰ç¼“å­˜ç­‰ï¼Œè¿˜éƒ½éœ€è¦ä¸€äº›æœºåˆ¶æ¥å¤„ç†ã€‚æ‰€ä»¥åœ¨è¿™èŠ‚è¯¾ï¼Œä½ ä¼šçœ‹åˆ°å…¶å®ƒå››ä¸ªæœ€ä¸ºå¸¸ç”¨çš„å†…ç½® Hooks ï¼ˆåŒ…æ‹¬useCallbackã€useMemoã€useRefå’ŒuseContextï¼‰çš„ä½œç”¨å’Œç”¨æ³•ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨è¿™äº› Hooks è¿›è¡ŒåŠŸèƒ½å¼€å‘ã€‚

# useCallbackï¼šç¼“å­˜å›è°ƒå‡½æ•°

åœ¨ React å‡½æ•°ç»„ä»¶ä¸­ï¼Œæ¯ä¸€æ¬¡ UI çš„å˜åŒ–ï¼Œéƒ½æ˜¯é€šè¿‡é‡æ–°æ‰§è¡Œæ•´ä¸ªå‡½æ•°æ¥å®Œæˆçš„ï¼Œè¿™å’Œä¼ ç»Ÿçš„ Class ç»„ä»¶æœ‰å¾ˆå¤§åŒºåˆ«ï¼šå‡½æ•°ç»„ä»¶ä¸­å¹¶æ²¡æœ‰ä¸€ä¸ªç›´æ¥çš„æ–¹å¼åœ¨å¤šæ¬¡æ¸²æŸ“ä¹‹é—´ç»´æŒä¸€ä¸ªçŠ¶æ€ã€‚

æ¯”å¦‚ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åœ¨åŠ å·æŒ‰é’®ä¸Šå®šä¹‰äº†ä¸€ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç”¨æ¥è®©è®¡æ•°å™¨åŠ 1ã€‚ä½†æ˜¯å› ä¸ºå®šä¹‰æ˜¯åœ¨å‡½æ•°ç»„ä»¶å†…éƒ¨ï¼Œå› æ­¤åœ¨å¤šæ¬¡æ¸²æŸ“ä¹‹é—´ï¼Œæ˜¯æ— æ³•é‡ç”¨ handleIncrement è¿™ä¸ªå‡½æ•°çš„ï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ï¼š

```
function Counter() {
  const [count, setCount] = useState(0);
  const handleIncrement = () => setCount(count + 1);
  // ...
  return <button onClick={handleIncrement}>+</button>
}
```

ä½ ä¸å¦¨æ€è€ƒä¸‹è¿™ä¸ªè¿‡ç¨‹ã€‚æ¯æ¬¡ç»„ä»¶çŠ¶æ€å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå‡½æ•°ç»„ä»¶å®é™…ä¸Šéƒ½ä¼šé‡æ–°æ‰§è¡Œä¸€éã€‚åœ¨æ¯æ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œå®é™…ä¸Šéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹ä»¶å¤„ç†å‡½æ•° handleIncrementã€‚è¿™ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ä¸­å‘¢ï¼ŒåŒ…å«äº† count è¿™ä¸ªå˜é‡çš„é—­åŒ…ï¼Œä»¥ç¡®ä¿æ¯æ¬¡èƒ½å¤Ÿå¾—åˆ°æ­£ç¡®çš„ç»“æœã€‚

è¿™ä¹Ÿæ„å‘³ç€ï¼Œå³ä½¿ count æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å‡½æ•°ç»„ä»¶å› ä¸ºå…¶å®ƒçŠ¶æ€å‘ç”Ÿå˜åŒ–è€Œé‡æ–°æ¸²æŸ“æ—¶ï¼Œè¿™ç§å†™æ³•ä¹Ÿä¼šæ¯æ¬¡åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ã€‚åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè™½ç„¶ä¸å½±å“ç»“æœçš„æ­£ç¡®æ€§ï¼Œä½†å…¶å®æ˜¯æ²¡å¿…è¦çš„ã€‚å› ä¸ºè¿™æ ·åšä¸ä»…å¢åŠ äº†ç³»ç»Ÿçš„å¼€é”€ï¼Œæ›´é‡è¦çš„æ˜¯ï¼š**æ¯æ¬¡åˆ›å»ºæ–°å‡½æ•°çš„æ–¹å¼ä¼šè®©æ¥æ”¶äº‹ä»¶å¤„ç†å‡½æ•°çš„ç»„ä»¶ï¼Œéœ€è¦é‡æ–°æ¸²æŸ“**ã€‚

æ¯”å¦‚è¿™ä¸ªä¾‹å­ä¸­çš„ button ç»„ä»¶ï¼Œæ¥æ”¶äº† `handleIncrement` ï¼Œå¹¶ä½œä¸ºä¸€ä¸ªå±æ€§ã€‚å¦‚æœæ¯æ¬¡éƒ½æ˜¯ä¸€ä¸ªæ–°çš„ï¼Œé‚£ä¹ˆè¿™ä¸ª React å°±ä¼šè®¤ä¸ºè¿™ä¸ªç»„ä»¶çš„ props å‘ç”Ÿäº†å˜åŒ–ï¼Œä»è€Œå¿…é¡»é‡æ–°æ¸²æŸ“ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åšåˆ°çš„æ˜¯ï¼š**åªæœ‰å½“ count å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæˆ‘ä»¬æ‰éœ€è¦é‡æ–°å®šä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚è€Œ**è¿™æ­£æ˜¯ useCallback è¿™ä¸ª Hook çš„ä½œç”¨ã€‚

å®ƒçš„ API ç­¾åå¦‚ä¸‹ï¼š

```
useCallback(fn, deps)
```

è¿™é‡Œfnæ˜¯å®šä¹‰çš„å›è°ƒå‡½æ•°ï¼Œdepsæ˜¯ä¾èµ–çš„å˜é‡æ•°ç»„ã€‚åªæœ‰å½“æŸä¸ªä¾èµ–å˜é‡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰ä¼šé‡æ–°å£°æ˜ fnè¿™ä¸ªå›è°ƒå‡½æ•°ã€‚é‚£ä¹ˆå¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ handleIncrementè¿™ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°é€šè¿‡ useCallback æ¥è¿›è¡Œæ€§èƒ½çš„ä¼˜åŒ–ï¼š

```
import React, { useState, useCallback } from 'react';

function Counter() {
  const [count, setCount] = useState(0);
  const handleIncrement = useCallback(
    () => setCount(count + 1),
    [count], // åªæœ‰å½“ count å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰ä¼šé‡æ–°åˆ›å»ºå›è°ƒå‡½æ•°
  );
  // ...
  return <button onClick={handleIncrement}>+</button>
}

```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æŠŠ count è¿™ä¸ª state ï¼Œä½œä¸ºä¸€ä¸ªä¾èµ–ä¼ é€’ç»™ useCallbackã€‚è¿™æ ·ï¼Œåªæœ‰ count å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œæ‰éœ€è¦é‡æ–°åˆ›å»ºä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¿™æ ·å°±ä¿è¯äº†ç»„ä»¶ä¸ä¼šåˆ›å»ºé‡å¤çš„å›è°ƒå‡½æ•°ã€‚è€Œæ¥æ”¶è¿™ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå±æ€§çš„ç»„ä»¶ï¼Œä¹Ÿä¸ä¼šé¢‘ç¹åœ°éœ€è¦é‡æ–°æ¸²æŸ“ã€‚

é™¤äº†useCallbackï¼ŒuseMemoä¹Ÿæ˜¯ä¸ºäº†ç¼“å­˜è€Œè®¾è®¡çš„ã€‚åªä¸è¿‡ï¼ŒuseCallbackç¼“å­˜çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè€ŒuseMemoç¼“å­˜çš„æ˜¯è®¡ç®—çš„ç»“æœã€‚é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä¸€èµ·å­¦ä¹ ä¸‹useMemoçš„ç”¨æ³•å§ã€‚

# useMemoï¼šç¼“å­˜è®¡ç®—çš„ç»“æœ

useMemo çš„ API ç­¾åå¦‚ä¸‹ï¼š

```
useMemo(fn, deps);
```

è¿™é‡Œçš„fnæ˜¯äº§ç”Ÿæ‰€éœ€æ•°æ®çš„ä¸€ä¸ªè®¡ç®—å‡½æ•°ã€‚é€šå¸¸æ¥è¯´ï¼Œfnä¼šä½¿ç”¨ deps ä¸­å£°æ˜çš„ä¸€äº›å˜é‡æ¥ç”Ÿæˆä¸€ä¸ªç»“æœï¼Œç”¨æ¥æ¸²æŸ“å‡ºæœ€ç»ˆçš„ UIã€‚

è¿™ä¸ªåœºæ™¯åº”è¯¥å¾ˆå®¹æ˜“ç†è§£ï¼š**å¦‚æœæŸä¸ªæ•°æ®æ˜¯é€šè¿‡å…¶å®ƒæ•°æ®è®¡ç®—å¾—åˆ°çš„ï¼Œé‚£ä¹ˆåªæœ‰å½“ç”¨åˆ°çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¾èµ–çš„æ•°æ®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œæ‰åº”è¯¥éœ€è¦é‡æ–°è®¡ç®—**ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œå¯¹äºä¸€ä¸ªæ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯çš„åˆ—è¡¨ï¼Œç°åœ¨éœ€è¦å¯¹ç”¨æˆ·åè¿›è¡Œæœç´¢ï¼Œä¸” UI ä¸Šéœ€è¦æ ¹æ®æœç´¢å…³é”®å­—æ˜¾ç¤ºè¿‡æ»¤åçš„ç”¨æˆ·ï¼Œé‚£ä¹ˆè¿™æ ·ä¸€ä¸ªåŠŸèƒ½éœ€è¦æœ‰ä¸¤ä¸ªçŠ¶æ€ï¼š

1. ç”¨æˆ·åˆ—è¡¨æ•°æ®æœ¬èº«ï¼šæ¥è‡ªæŸä¸ªè¯·æ±‚ã€‚
2. æœç´¢å…³é”®å­—ï¼šç”¨æˆ·åœ¨æœç´¢æ¡†è¾“å…¥çš„æ•°æ®ã€‚

æ— è®ºæ˜¯ä¸¤ä¸ªæ•°æ®ä¸­çš„å“ªä¸€ä¸ªå‘ç”Ÿå˜åŒ–ï¼Œéƒ½éœ€è¦è¿‡æ»¤ç”¨æˆ·åˆ—è¡¨ä»¥è·å¾—éœ€è¦å±•ç¤ºçš„æ•°æ®ã€‚é‚£ä¹ˆå¦‚æœä¸ä½¿ç”¨ useMemo çš„è¯ï¼Œå°±éœ€è¦ç”¨è¿™æ ·çš„ä»£ç å®ç°ï¼š

```
import React, { useState, useEffect } from "react";

export default function SearchUserList() {
  const [users, setUsers] = useState(null);
  const [searchKey, setSearchKey] = useState("");

  useEffect(() => {
    const doFetch = async () => {
      // ç»„ä»¶é¦–æ¬¡åŠ è½½æ—¶å‘è¯·æ±‚è·å–ç”¨æˆ·æ•°æ®
      const res = await fetch("https://reqres.in/api/users/");
      setUsers(await res.json());
    };
    doFetch();
  }, []);
  let usersToShow = null;

  if (users) {
    // æ— è®ºç»„ä»¶ä¸ºä½•åˆ·æ–°ï¼Œè¿™é‡Œä¸€å®šä¼šå¯¹æ•°ç»„åšä¸€æ¬¡è¿‡æ»¤çš„æ“ä½œ
    usersToShow = users.data.filter((user) =>
      user.first_name.includes(searchKey),
    );
  }

  return (
    <div>
      <input
        type="text"
        value={searchKey}
        onChange={(evt) => setSearchKey(evt.target.value)}
      />
      <ul>
        {usersToShow &&
          usersToShow.length > 0 &&
          usersToShow.map((user) => {
            return <li key={user.id}>{user.first_name}</li>;
          })}
      </ul>
    </div>
  );
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ— è®ºç»„ä»¶ä¸ºä½•è¦è¿›è¡Œä¸€æ¬¡é‡æ–°æ¸²æŸ“ï¼Œå®é™…ä¸Šéƒ½éœ€è¦è¿›è¡Œä¸€æ¬¡è¿‡æ»¤çš„æ“ä½œã€‚ä½†å…¶å®ä½ åªéœ€è¦åœ¨ users æˆ–è€… searchKey è¿™ä¸¤ä¸ªçŠ¶æ€ä¸­çš„æŸä¸€ä¸ªå‘ç”Ÿå˜åŒ–æ—¶ï¼Œé‡æ–°è®¡ç®—è·å¾—éœ€è¦å±•ç¤ºçš„æ•°æ®å°±è¡Œäº†ã€‚é‚£ä¹ˆï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ useMemo è¿™ä¸ª Hook æ¥å®ç°è¿™ä¸ªé€»è¾‘ï¼Œç¼“å­˜è®¡ç®—çš„ç»“æœï¼š

```
//...
// ä½¿ç”¨ userMemo ç¼“å­˜è®¡ç®—çš„ç»“æœ
const usersToShow = useMemo(() => {
    if (!users) return null;
    return users.data.filter((user) => {
      return user.first_name.includes(searchKey));
    }
  }, [users, searchKey]);
//...
```

å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡ useMemo è¿™ä¸ª Hookï¼Œå¯ä»¥é¿å…åœ¨ç”¨åˆ°çš„æ•°æ®æ²¡å‘ç”Ÿå˜åŒ–æ—¶è¿›è¡Œçš„é‡å¤è®¡ç®—ã€‚è™½ç„¶ä¾‹å­å±•ç¤ºçš„æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„åœºæ™¯ï¼Œä½†å¦‚æœæ˜¯ä¸€ä¸ªå¤æ‚çš„è®¡ç®—ï¼Œé‚£ä¹ˆå¯¹äºæå‡æ€§èƒ½ä¼šæœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚è¿™ä¹Ÿæ˜¯userMemoçš„ä¸€å¤§å¥½å¤„ï¼šé¿å…é‡å¤è®¡ç®—ã€‚

é™¤äº†é¿å…é‡å¤è®¡ç®—ä¹‹å¤–ï¼ŒuseMemo è¿˜æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„å¥½å¤„ï¼š**é¿å…å­ç»„ä»¶çš„é‡å¤æ¸²æŸ“**ã€‚æ¯”å¦‚åœ¨ä¾‹å­ä¸­çš„ usersToShow è¿™ä¸ªå˜é‡ï¼Œå¦‚æœæ¯æ¬¡éƒ½éœ€è¦é‡æ–°è®¡ç®—æ¥å¾—åˆ°ï¼Œé‚£ä¹ˆå¯¹äº UserList è¿™ä¸ªç»„ä»¶è€Œè¨€ï¼Œå°±ä¼šæ¯æ¬¡éƒ½éœ€è¦åˆ·æ–°ï¼Œå› ä¸ºå®ƒå°† usersToShow ä½œä¸ºäº†ä¸€ä¸ªå±æ€§ã€‚è€Œä¸€æ—¦èƒ½å¤Ÿç¼“å­˜ä¸Šæ¬¡çš„ç»“æœï¼Œå°±å’Œ useCallback çš„åœºæ™¯ä¸€æ ·ï¼Œå¯ä»¥é¿å…å¾ˆå¤šä¸å¿…è¦çš„ç»„ä»¶åˆ·æ–°ã€‚

è¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬ç»“åˆ useMemo å’Œ useCallback è¿™ä¸¤ä¸ª Hooks ä¸€èµ·çœ‹ï¼Œä¼šå‘ç°ä¸€ä¸ªæœ‰è¶£çš„ç‰¹æ€§ï¼Œé‚£å°±æ˜¯ **useCallback çš„åŠŸèƒ½å…¶å®æ˜¯å¯ä»¥ç”¨ useMemo æ¥å®ç°çš„ã€‚**æ¯”å¦‚ä¸‹é¢çš„ä»£ç å°±æ˜¯åˆ©ç”¨ useMemo å®ç°äº† useCallback çš„åŠŸèƒ½ï¼š

```
 const myEventHandler = useMemo(() => {
   // è¿”å›ä¸€ä¸ªå‡½æ•°ä½œä¸ºç¼“å­˜ç»“æœ
   return () => {
     // åœ¨è¿™é‡Œè¿›è¡Œäº‹ä»¶å¤„ç†
   }
 }, [dep1, dep2]);
```

ç†è§£äº†è¿™ä¸€ç‚¹ï¼Œç›¸ä¿¡ä½ ä¸€ä¸‹å­ä¼šå¯¹è¿™ä¸¤ä¸ª Hooks çš„æœºåˆ¶æœ‰æ›´è¿›ä¸€æ­¥çš„è®¤è¯†ï¼Œä¹Ÿå°±ä¸ç”¨æ­»è®°ç¡¬èƒŒä¸¤ä¸ª API éƒ½æ˜¯å¹²å˜›çš„äº†ï¼Œå› ä¸ºä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œå®ƒä»¬åªæ˜¯åšäº†åŒä¸€ä»¶äº‹æƒ…ï¼š**å»ºç«‹äº†ä¸€ä¸ªç»‘å®šæŸä¸ªç»“æœåˆ°ä¾èµ–æ•°æ®çš„å…³ç³»ã€‚åªæœ‰å½“ä¾èµ–å˜äº†ï¼Œè¿™ä¸ªç»“æœæ‰éœ€è¦è¢«é‡æ–°å¾—åˆ°**ã€‚

# useRefï¼šåœ¨å¤šæ¬¡æ¸²æŸ“ä¹‹é—´å…±äº«æ•°æ®

å‡½æ•°ç»„ä»¶è™½ç„¶éå¸¸ç›´è§‚ï¼Œç®€åŒ–äº†æ€è€ƒ UI å®ç°çš„é€»è¾‘ï¼Œä½†æ˜¯æ¯”èµ· Class ç»„ä»¶ï¼Œè¿˜ç¼ºå°‘äº†ä¸€ä¸ªå¾ˆé‡è¦çš„èƒ½åŠ›ï¼š**åœ¨å¤šæ¬¡æ¸²æŸ“ä¹‹é—´å…±äº«æ•°æ®ã€‚**

åœ¨ç±»ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ç±»çš„æˆå‘˜å˜é‡ï¼Œä»¥ä¾¿èƒ½åœ¨å¯¹è±¡ä¸Šé€šè¿‡æˆå‘˜å±æ€§å»ä¿å­˜ä¸€äº›æ•°æ®ã€‚ä½†æ˜¯åœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œæ˜¯æ²¡æœ‰è¿™æ ·ä¸€ä¸ªç©ºé—´å»ä¿å­˜æ•°æ®çš„ã€‚å› æ­¤ï¼ŒReact è®©useRef è¿™æ ·ä¸€ä¸ª Hook æ¥æä¾›è¿™æ ·çš„åŠŸèƒ½ã€‚

useRef çš„APIç­¾åå¦‚ä¸‹ï¼š

```
const myRefContainer = useRef(initialValue);
```

æˆ‘ä»¬å¯ä»¥æŠŠuseRefçœ‹ä½œæ˜¯åœ¨å‡½æ•°ç»„ä»¶ä¹‹å¤–åˆ›å»ºçš„ä¸€ä¸ªå®¹å™¨ç©ºé—´ã€‚åœ¨è¿™ä¸ªå®¹å™¨ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å”¯ä¸€çš„ current å±è®¾ç½®ä¸€ä¸ªå€¼ï¼Œä»è€Œåœ¨å‡½æ•°ç»„ä»¶çš„å¤šæ¬¡æ¸²æŸ“ä¹‹é—´å…±äº«è¿™ä¸ªå€¼ã€‚

ä½ å¯èƒ½ä¼šæœ‰ç–‘é—®ï¼ŒuseRef çš„è¿™ä¸ªåŠŸèƒ½å…·ä½“æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚

å‡è®¾ä½ è¦å»åšä¸€ä¸ªè®¡æ—¶å™¨ç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶æœ‰å¼€å§‹å’Œæš‚åœä¸¤ä¸ªåŠŸèƒ½ã€‚å¾ˆæ˜¾ç„¶ï¼Œä½ éœ€è¦ç”¨ window.setInterval æ¥æä¾›è®¡æ—¶åŠŸèƒ½ï¼›è€Œä¸ºäº†èƒ½å¤Ÿæš‚åœï¼Œä½ å°±éœ€è¦åœ¨æŸä¸ªåœ°æ–¹ä¿å­˜è¿™ä¸ª window.setInterval è¿”å›çš„è®¡æ•°å™¨çš„å¼•ç”¨ï¼Œç¡®ä¿åœ¨ç‚¹å‡»æš‚åœæŒ‰é’®çš„åŒæ—¶ï¼Œä¹Ÿèƒ½ç”¨ window.clearInterval åœæ­¢è®¡æ—¶å™¨ã€‚é‚£ä¹ˆï¼Œè¿™ä¸ªä¿å­˜è®¡æ•°å™¨å¼•ç”¨çš„æœ€åˆé€‚çš„åœ°æ–¹ï¼Œå°±æ˜¯ useRefï¼Œå› ä¸ºå®ƒå¯ä»¥å­˜å‚¨è·¨æ¸²æŸ“çš„æ•°æ®ã€‚ä»£ç å¦‚ä¸‹ï¼š

```
import React, { useState, useCallback, useRef } from "react";

export default function Timer() {
  // å®šä¹‰ time state ç”¨äºä¿å­˜è®¡æ—¶çš„ç´¯ç§¯æ—¶é—´
  const [time, setTime] = useState(0);

  // å®šä¹‰ timer è¿™æ ·ä¸€ä¸ªå®¹å™¨ç”¨äºåœ¨è·¨ç»„ä»¶æ¸²æŸ“ä¹‹é—´ä¿å­˜ä¸€ä¸ªå˜é‡
  const timer = useRef(null);

  // å¼€å§‹è®¡æ—¶çš„äº‹ä»¶å¤„ç†å‡½æ•°
  const handleStart = useCallback(() => {
    // ä½¿ç”¨ current å±æ€§è®¾ç½® ref çš„å€¼
    timer.current = window.setInterval(() => {
      setTime((time) => time + 1);
    }, 100);
  }, []);

  // æš‚åœè®¡æ—¶çš„äº‹ä»¶å¤„ç†å‡½æ•°
  const handlePause = useCallback(() => {
    // ä½¿ç”¨ clearInterval æ¥åœæ­¢è®¡æ—¶
    window.clearInterval(timer.current);
    timer.current = null;
  }, []);

  return (
    <div>
      {time / 10} seconds.
      <br />
      <button onClick={handleStart}>Start</button>
      <button onClick={handlePause}>Pause</button>
    </div>
  );
}
```

è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† useRef æ¥åˆ›å»ºäº†ä¸€ä¸ªä¿å­˜ window.setInterval è¿”å›å¥æŸ„çš„ç©ºé—´ï¼Œä»è€Œèƒ½å¤Ÿåœ¨ç”¨æˆ·ç‚¹å‡»æš‚åœæŒ‰é’®æ—¶æ¸…é™¤å®šæ—¶å™¨ï¼Œè¾¾åˆ°æš‚åœè®¡æ—¶çš„ç›®çš„ã€‚

åŒæ—¶ä½ ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨ useRef ä¿å­˜çš„æ•°æ®ä¸€èˆ¬æ˜¯å’Œ UI çš„æ¸²æŸ“æ— å…³çš„ï¼Œå› æ­¤å½“ ref çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ˜¯ä¸ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“çš„ï¼Œè¿™ä¹Ÿæ˜¯ useRef åŒºåˆ«äº useState çš„åœ°æ–¹ã€‚

é™¤äº†å­˜å‚¨è·¨æ¸²æŸ“çš„æ•°æ®ä¹‹å¤–ï¼ŒuseRefè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„åŠŸèƒ½ï¼Œå°±æ˜¯**ä¿å­˜æŸä¸ª DOM èŠ‚ç‚¹çš„å¼•ç”¨**ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨React ä¸­ï¼Œå‡ ä¹ä¸éœ€è¦å…³å¿ƒçœŸå®çš„ DOM èŠ‚ç‚¹æ˜¯å¦‚ä½•æ¸²æŸ“å’Œä¿®æ”¹çš„ã€‚ä½†æ˜¯åœ¨æŸäº›åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»è¦è·å¾—çœŸå® DOM èŠ‚ç‚¹çš„å¼•ç”¨ï¼Œæ‰€ä»¥ç»“åˆ React çš„ refå±æ€§å’Œ useRef è¿™ä¸ª Hookï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å¾—çœŸå®çš„ DOM èŠ‚ç‚¹ï¼Œå¹¶å¯¹è¿™ä¸ªèŠ‚ç‚¹è¿›è¡Œæ“ä½œã€‚

æ¯”å¦‚è¯´ï¼Œä½ éœ€è¦åœ¨ç‚¹å‡»æŸä¸ªæŒ‰é’®æ—¶è®©æŸä¸ªè¾“å…¥æ¡†è·å¾—ç„¦ç‚¹ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„ä»£ç æ¥å®ç°ï¼š

```
function TextInputWithFocusButton() {
  const inputEl = useRef(null);
  const onButtonClick = () => {
    // current å±æ€§æŒ‡å‘äº†çœŸå®çš„ input è¿™ä¸ª DOM èŠ‚ç‚¹ï¼Œä»è€Œå¯ä»¥è°ƒç”¨ focus æ–¹æ³•
    inputEl.current.focus();
  };
  return (
    <>
      <input ref={inputEl} type="text" />
      <button onClick={onButtonClick}>Focus the input</button>
    </>
  );
}
```

è¿™æ®µä»£ç æ˜¯ React å®˜æ–¹æ–‡æ¡£æä¾›çš„ä¸€ä¸ªä¾‹å­ï¼Œå¯ä»¥çœ‹åˆ°ref è¿™ä¸ªå±æ€§æä¾›äº†è·å¾— DOM èŠ‚ç‚¹çš„èƒ½åŠ›ï¼Œå¹¶åˆ©ç”¨ useRef ä¿å­˜äº†è¿™ä¸ªèŠ‚ç‚¹çš„åº”ç”¨ã€‚è¿™æ ·çš„è¯ï¼Œä¸€æ—¦ input èŠ‚ç‚¹è¢«æ¸²æŸ“åˆ°ç•Œé¢ä¸Šï¼Œé‚£æˆ‘ä»¬é€šè¿‡ inputEl.current å°±èƒ½è®¿é—®åˆ°çœŸå®çš„ DOM èŠ‚ç‚¹çš„å®ä¾‹äº†ã€‚

# useContextï¼šå®šä¹‰å…¨å±€çŠ¶æ€

åœ¨ç¬¬2èŠ‚è¯¾ä¸­ä½ å·²ç»çŸ¥é“äº†ï¼ŒReact ç»„ä»¶ä¹‹é—´çš„çŠ¶æ€ä¼ é€’åªæœ‰ä¸€ç§æ–¹å¼ï¼Œé‚£å°±æ˜¯é€šè¿‡ propsã€‚è¿™å°±æ„å‘³ç€è¿™ç§ä¼ é€’å…³ç³»åªèƒ½åœ¨çˆ¶å­ç»„ä»¶ä¹‹é—´è¿›è¡Œã€‚

çœ‹åˆ°è¿™é‡Œä½ è‚¯å®šä¼šé—®ï¼Œå¦‚æœè¦è·¨å±‚æ¬¡ï¼Œæˆ–è€…åŒå±‚çš„ç»„ä»¶ä¹‹é—´è¦è¿›è¡Œæ•°æ®çš„å…±äº«ï¼Œé‚£åº”è¯¥å¦‚ä½•å»å®ç°å‘¢ï¼Ÿè¿™å…¶å®å°±æ¶‰åŠåˆ°ä¸€ä¸ªæ–°çš„å‘½é¢˜ï¼š**å…¨å±€çŠ¶æ€ç®¡ç†**ã€‚

ä¸ºæ­¤ï¼ŒReact æä¾›äº† Context è¿™æ ·ä¸€ä¸ªæœºåˆ¶ï¼Œèƒ½å¤Ÿè®©æ‰€æœ‰åœ¨æŸä¸ªç»„ä»¶å¼€å§‹çš„ç»„ä»¶æ ‘ä¸Šåˆ›å»ºä¸€ä¸ª Contextã€‚è¿™æ ·è¿™ä¸ªç»„ä»¶æ ‘ä¸Šçš„æ‰€æœ‰ç»„ä»¶ï¼Œå°±éƒ½èƒ½è®¿é—®å’Œä¿®æ”¹è¿™ä¸ª Contextäº†ã€‚é‚£ä¹ˆåœ¨å‡½æ•°ç»„ä»¶é‡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ useContext è¿™æ ·ä¸€ä¸ª Hook æ¥ç®¡ç† Contextã€‚

useContext çš„API ç­¾åå¦‚ä¸‹ï¼š

```
const value = useContext(MyContext);
```

æ­£å¦‚åˆšæ‰æåˆ°çš„ï¼Œä¸€ä¸ª Context æ˜¯ä»æŸä¸ªç»„ä»¶ä¸ºæ ¹ç»„ä»¶çš„ç»„ä»¶æ ‘ä¸Šå¯ç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æœ‰ API èƒ½å¤Ÿåˆ›å»ºä¸€ä¸ª Contextï¼Œè¿™å°±æ˜¯ **React.createContext APIï¼Œ**å¦‚ä¸‹ï¼š

```
const MyContext = React.createContext(initialValue);
```

è¿™é‡Œçš„ MyContext å…·æœ‰ä¸€ä¸ª Provider çš„å±æ€§ï¼Œä¸€èˆ¬æ˜¯ä½œä¸ºç»„ä»¶æ ‘çš„æ ¹ç»„ä»¶ã€‚è¿™é‡Œæˆ‘ä»ç„¶ä»¥ React å®˜æ–¹æ–‡æ¡£çš„ä¾‹å­æ¥è®²è§£ï¼Œå³ï¼šä¸€ä¸ªä¸»é¢˜çš„åˆ‡æ¢æœºåˆ¶ã€‚ä»£ç å¦‚ä¸‹ï¼š

```
const themes = {
  light: {
    foreground: "#000000",
    background: "#eeeeee"
  },
  dark: {
    foreground: "#ffffff",
    background: "#222222"
  }
};
// åˆ›å»ºä¸€ä¸ª Theme çš„ Context

const ThemeContext = React.createContext(themes.light);
function App() {
  // æ•´ä¸ªåº”ç”¨ä½¿ç”¨ ThemeContext.Provider ä½œä¸ºæ ¹ç»„ä»¶
  return (
    // ä½¿ç”¨ themes.dark ä½œä¸ºå½“å‰ Context 
    <ThemeContext.Provider value={themes.dark}>
      <Toolbar />
    </ThemeContext.Provider>
  );
}

// åœ¨ Toolbar ç»„ä»¶ä¸­ä½¿ç”¨ä¸€ä¸ªä¼šä½¿ç”¨ Theme çš„ Button
function Toolbar(props) {
  return (
    <div>
      <ThemedButton />
    </div>
  );
}

// åœ¨ Theme Button ä¸­ä½¿ç”¨ useContext æ¥è·å–å½“å‰çš„ä¸»é¢˜
function ThemedButton() {
  const theme = useContext(ThemeContext);
  return (
    <button style={{
      background: theme.background,
      color: theme.foreground
    }}>
      I am styled by theme context!
    </button>
  );
}
```

çœ‹åˆ°è¿™é‡Œä½ ä¹Ÿè®¸ä¼šæœ‰ç‚¹å¥½å¥‡ï¼ŒContext çœ‹ä¸Šå»å°±æ˜¯ä¸€ä¸ªå…¨å±€çš„æ•°æ®ï¼Œä¸ºä»€ä¹ˆè¦è®¾è®¡è¿™æ ·ä¸€ä¸ªå¤æ‚çš„æœºåˆ¶ï¼Œè€Œä¸æ˜¯ç›´æ¥ç”¨ä¸€ä¸ªå…¨å±€çš„å˜é‡å»ä¿å­˜æ•°æ®å‘¢ï¼Ÿ

ç­”æ¡ˆå…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯**ä¸ºäº†èƒ½å¤Ÿè¿›è¡Œæ•°æ®çš„ç»‘å®š**ã€‚å½“è¿™ä¸ª Context çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä½¿ç”¨è¿™ä¸ªæ•°æ®çš„ç»„ä»¶å°±èƒ½å¤Ÿè‡ªåŠ¨åˆ·æ–°ã€‚ä½†å¦‚æœæ²¡æœ‰ Contextï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ä¸ªç®€å•çš„å…¨å±€å˜é‡ï¼Œå°±å¾ˆéš¾å»å®ç°äº†ã€‚

ä¸è¿‡åˆšæ‰æˆ‘ä»¬çœ‹åˆ°çš„å…¶å®æ˜¯ä¸€ä¸ªé™æ€çš„ä½¿ç”¨ Context çš„ä¾‹å­ï¼Œç›´æ¥ç”¨äº† thems.dark ä½œä¸º Context çš„å€¼ã€‚é‚£ä¹ˆå¦‚ä½•è®©å®ƒå˜å¾—åŠ¨æ€å‘¢ï¼Ÿ

æ¯”å¦‚è¯´å¸¸è§çš„åˆ‡æ¢é»‘æš—æˆ–è€…æ˜äº®æ¨¡å¼çš„æŒ‰é’®ï¼Œç”¨æ¥åˆ‡æ¢æ•´ä¸ªé¡µé¢çš„ä¸»é¢˜ã€‚äº‹å®ä¸Šï¼ŒåŠ¨æ€ Context å¹¶ä¸éœ€è¦æˆ‘ä»¬å­¦ä¹ ä»»ä½•æ–°çš„ APIï¼Œè€Œæ˜¯åˆ©ç”¨ React æœ¬èº«çš„æœºåˆ¶ï¼Œé€šè¿‡è¿™ä¹ˆä¸€è¡Œä»£ç å°±å¯ä»¥å®ç°ï¼š

```
<ThemeContext.Provider value={themes.dark}>
```

å¯ä»¥çœ‹åˆ°ï¼Œthemes.dark æ˜¯ä½œä¸ºä¸€ä¸ªå±æ€§å€¼ä¼ ç»™ Provider è¿™ä¸ªç»„ä»¶çš„ï¼Œå¦‚æœè¦è®©å®ƒå˜å¾—åŠ¨æ€ï¼Œå…¶å®åªè¦ç”¨ä¸€ä¸ª state æ¥ä¿å­˜ï¼Œé€šè¿‡ä¿®æ”¹ stateï¼Œå°±èƒ½å®ç°åŠ¨æ€çš„åˆ‡æ¢Context çš„å€¼äº†ã€‚è€Œä¸”è¿™ä¹ˆåšï¼Œæ‰€æœ‰ç”¨åˆ°è¿™ä¸ªContext çš„åœ°æ–¹éƒ½ä¼šè‡ªåŠ¨åˆ·æ–°ã€‚æ¯”å¦‚è¿™æ ·çš„ä»£ç ï¼š

```
// ...

function App() {
  // ä½¿ç”¨ state æ¥ä¿å­˜ theme ä»è€Œå¯ä»¥åŠ¨æ€ä¿®æ”¹
  const [theme, setTheme] = useState("light");

  // åˆ‡æ¢ theme çš„å›è°ƒå‡½æ•°
  const toggleTheme = useCallback(() => {
    setTheme((theme) => (theme === "light" ? "dark" : "light"));
  }, []);

  return (
    // ä½¿ç”¨ theme state ä½œä¸ºå½“å‰ Context
    <ThemeContext.Provider value={themes[theme]}>
      <button onClick={toggleTheme}>Toggle Theme</button>
      <Toolbar />
    </ThemeContext.Provider>
  );
}
```

åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ state æ¥ä¿å­˜ themeï¼Œä»è€Œè¾¾åˆ°å¯ä»¥åŠ¨æ€è°ƒæ•´çš„ç›®çš„ã€‚

å¯ä»¥çœ‹åˆ°ï¼ŒContext æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿åœ¨å¤šä¸ªç»„ä»¶ä¹‹é—´å…±äº«æ•°æ®çš„æœºåˆ¶ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®ƒçš„çµæ´»æ€§ä¹Ÿæ˜¯ä¸€æŸ„åŒåˆƒå‰‘ã€‚ä½ æˆ–è®¸å·²ç»å‘ç°ï¼ŒContext ç›¸å½“äºæä¾›äº†ä¸€ä¸ªå®šä¹‰ React ä¸–ç•Œä¸­å…¨å±€å˜é‡çš„æœºåˆ¶ï¼Œè€Œå…¨å±€å˜é‡åˆ™æ„å‘³ç€ä¸¤ç‚¹ï¼š

1. ä¼šè®©è°ƒè¯•å˜å¾—å›°éš¾ï¼Œå› ä¸ºä½ å¾ˆéš¾è·Ÿè¸ªæŸä¸ª Context çš„å˜åŒ–ç©¶ç«Ÿæ˜¯å¦‚ä½•äº§ç”Ÿçš„ã€‚
2. è®©ç»„ä»¶çš„å¤ç”¨å˜å¾—å›°éš¾ï¼Œå› ä¸ºä¸€ä¸ªç»„ä»¶å¦‚æœä½¿ç”¨äº†æŸä¸ª Contextï¼Œå®ƒå°±å¿…é¡»ç¡®ä¿è¢«ç”¨åˆ°çš„åœ°æ–¹ä¸€å®šæœ‰è¿™ä¸ª Context çš„ Provider åœ¨å…¶çˆ¶ç»„ä»¶çš„è·¯å¾„ä¸Šã€‚

æ‰€ä»¥åœ¨ React çš„å¼€å‘ä¸­ï¼Œé™¤äº†åƒ Themeã€Language ç­‰ä¸€ç›®äº†ç„¶çš„éœ€è¦å…¨å±€è®¾ç½®çš„å˜é‡å¤–ï¼Œæˆ‘ä»¬å¾ˆå°‘ä¼šä½¿ç”¨ Context æ¥åšå¤ªå¤šæ•°æ®çš„å…±äº«ã€‚éœ€è¦å†ä¸‰å¼ºè°ƒçš„æ˜¯ï¼ŒContext æ›´å¤šçš„æ˜¯**æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„æœºåˆ¶ï¼Œè®© React åº”ç”¨å…·å¤‡å®šä¹‰å…¨å±€çš„å“åº”å¼æ•°æ®çš„èƒ½åŠ›**ã€‚

æ­¤å¤–ï¼Œå¾ˆå¤šçŠ¶æ€ç®¡ç†æ¡†æ¶ï¼Œæ¯”å¦‚ Reduxï¼Œæ­£æ˜¯åˆ©ç”¨äº† Context çš„æœºåˆ¶æ¥æä¾›ä¸€ç§æ›´åŠ å¯æ§çš„ç»„ä»¶ä¹‹é—´çš„çŠ¶æ€ç®¡ç†æœºåˆ¶ã€‚å› æ­¤ï¼Œç†è§£ Context çš„æœºåˆ¶ï¼Œä¹Ÿå¯ä»¥è®©æˆ‘ä»¬æ›´å¥½åœ°å»ç†è§£ Redux è¿™æ ·çš„æ¡†æ¶å®ç°çš„åŸç†ã€‚

# å°ç»“

æœ€åæ¥æ€»ç»“ä¸€ä¸‹ä»Šå¤©çš„æ‰€å­¦ã€‚åœ¨è¿™èŠ‚è¯¾ï¼Œä½ çœ‹åˆ°äº†4ä¸ªå¸¸ç”¨çš„ Reactå†…ç½® Hooks çš„ç”¨æ³•ï¼ŒåŒ…æ‹¬ï¼šuseCallbackã€useMemoã€useRef å’Œ useContextã€‚äº‹å®ä¸Šï¼Œæ¯ä¸€ä¸ª Hook éƒ½æ˜¯**ä¸ºäº†è§£å†³å‡½æ•°ç»„ä»¶ä¸­é‡åˆ°çš„ç‰¹å®šé—®é¢˜**ã€‚

å› ä¸ºå‡½æ•°ç»„ä»¶é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªç®€å•çš„æ¨¡å¼æ¥åˆ›å»ºç»„ä»¶ï¼Œä½†ä¸æ­¤åŒæ—¶ä¹Ÿæš´éœ²å‡ºäº†ä¸€å®šçš„é—®é¢˜ã€‚æ‰€ä»¥è¿™äº›é—®é¢˜å°±è¦é€šè¿‡ Hooks è¿™æ ·ä¸€ä¸ªç»Ÿä¸€çš„æœºåˆ¶å»è§£å†³ï¼Œå¯ä»¥ç§°å¾—ä¸Šæ˜¯ä¸€ä¸ªéå¸¸å®Œç¾çš„è®¾è®¡äº†ã€‚

æœ‰äº†è¿™èŠ‚è¯¾ä»‹ç»çš„ 4 ä¸ª Hooksï¼ŒåŠ ä¸Šä¸ŠèŠ‚è¯¾æˆ‘ä»¬å­¦ä¹ çš„ useState å’Œ useEffect è¿™ä¸¤ä¸ª æ ¸å¿ƒHooksï¼Œä½ å‡ ä¹å°±èƒ½å®Œæˆæ‰€æœ‰ React åŠŸèƒ½çš„å¼€å‘äº†ã€‚

å½“ç„¶ï¼Œå¯èƒ½ä»ç„¶ä¼šæœ‰ä¸€äº›è¾¹ç¼˜ä¸”å¤æ‚çš„ç‰¹åˆ«åœºæ™¯ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸¤èŠ‚è¯¾ä¸­å­¦ä¹ çš„ Hooks å¹¶ä¸èƒ½å®Œå…¨è¦†ç›–ï¼Œé‚£ä¹ˆæˆ‘å»ºè®®ä½ å¯ä»¥å»å‚è€ƒå®˜æ–¹çš„ [API æ–‡æ¡£](https://reactjs.org/docs/hooks-reference.html)ï¼Œå…ˆçŸ¥é“ React Hooks è¿˜æœ‰å“ªäº›èƒ½åŠ›ï¼Œä»¥ä¾¿åœ¨éœ€è¦çš„æ—¶å€™èƒ½å¤ŸæŸ¥é˜…æ–‡æ¡£å¹¶ä½¿ç”¨ã€‚

# æ€è€ƒé¢˜

useState å…¶å®ä¹Ÿæ˜¯èƒ½å¤Ÿåœ¨ç»„ä»¶çš„å¤šæ¬¡æ¸²æŸ“ä¹‹é—´å…±äº«æ•°æ®çš„ï¼Œé‚£ä¹ˆåœ¨ useRef çš„è®¡æ—¶å™¨ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬èƒ½å¦ç”¨ state å»ä¿å­˜ window.setInterval() è¿”å›çš„ timer å‘¢ï¼Ÿ

æ¬¢è¿æŠŠä½ çš„æƒ³æ³•å’Œæ€è€ƒåˆ†äº«åœ¨ç•™è¨€åŒºï¼Œæˆ‘ä»¬ä¸€èµ·äº¤æµè®¨è®ºã€‚ä¸‹èŠ‚è¯¾å†è§ï¼
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ15ï¼‰</strong></div><ul>
<li><span>ä½•ä»¥è§£å¿§</span> ğŸ‘ï¼ˆ19ï¼‰ ğŸ’¬ï¼ˆ9ï¼‰<p>å…³äºå­ç»„ä»¶props ä¸å˜ï¼Œå¯ä»¥å‡å°‘ä¸å¿…è¦çš„æ¸²æŸ“é—®é¢˜ï¼Œä¸æ˜¯ç‰¹åˆ«ç†è§£ã€‚ä¼¼ä¹åªè¦çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“å­ç»„ä»¶å¿…ç„¶é‡æ–°æ¸²æŸ“ï¼Œæ˜¯å†…éƒ¨æœ‰ä»€ä¹ˆåˆ«çš„åœ°æ–¹ä¼˜åŒ–ä¹ˆï¼Ÿ</p>2021-06-10</li><br/><li><span>æ»¡æœˆ</span> ğŸ‘ï¼ˆ69ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<p>æˆ‘ä»¬èƒ½å¦ç”¨ state å»ä¿å­˜ window.setInterval() è¿”å›çš„ timer å‘¢ï¼Ÿ
æˆ‘ç†è§£çš„æ˜¯å¯ä»¥ï¼Œåªæ˜¯æ²¡æœ‰ useRef æ›´ä¼˜ï¼Œå› ä¸ºåœ¨æ›´æ–° state å€¼åä¼šå¯¼è‡´é‡æ–°æ¸²æŸ“ï¼Œè€Œ ref å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ˜¯ä¸ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“çš„ï¼Œè¿™ä¹Ÿæ˜¯ useRef åŒºåˆ«äº useState çš„åœ°æ–¹ã€‚</p>2021-06-01</li><br/><li><span>æ¡ƒç¿</span> ğŸ‘ï¼ˆ29ï¼‰ ğŸ’¬ï¼ˆ6ï¼‰<p>useRef å¦‚æœåªæ˜¯ç”¨æ¥ åœ¨å¤šæ¬¡æ¸²æŸ“ä¹‹é—´å…±äº«æ•°æ®ï¼Œæ˜¯ä¸æ˜¯ç›´æ¥å¯ä»¥æŠŠå˜é‡å®šä¹‰åˆ°ç»„ä»¶å¤–é¢ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥è¾¾åˆ°ç›®çš„ï¼Œæ„Ÿè§‰è¿˜æ›´æ–¹ä¾¿ä¸€ç‚¹å‘¢ã€‚</p>2021-06-01</li><br/><li><span>cyh41</span> ğŸ‘ï¼ˆ15ï¼‰ ğŸ’¬ï¼ˆ6ï¼‰<p>æ˜¯ä»»ä½•åœºæ™¯ å‡½æ•°éƒ½ç”¨useCallback åŒ…è£¹å—ï¼Ÿé‚£ç§è½»é‡çš„å‡½æ•°æ˜¯ä¸æ˜¯ä¸éœ€è¦ï¼Ÿ</p>2021-06-01</li><br/><li><span>ä¸ƒæœˆæœ‰é£</span> ğŸ‘ï¼ˆ7ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>é—®ä¸‹è€å¸ˆï¼ŒuseCallbackã€useMemo å’Œ useEffectçš„ä¾èµ–æœºåˆ¶ä¸€æ ·å—ï¼Ÿéƒ½æ˜¯æµ…æ¯”è¾ƒå—ï¼Ÿ</p>2021-06-03</li><br/><li><span>Geek_71adef</span> ğŸ‘ï¼ˆ6ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>1 useState å®ç°ç»„ä»¶å…±äº«ï¼Œè€ƒè™‘åˆ°ç»„ä»¶ä¹‹é—´çš„é€šä¿¡
2 state å»ä¿å­˜çš„è¯ ä¼šé€ æˆå¼‚æ­¥æ¸²æŸ“ é€ æˆæ— é™å¾ªç¯</p>2021-06-01</li><br/><li><span>é—²é—²</span> ğŸ‘ï¼ˆ5ï¼‰ ğŸ’¬ï¼ˆ7ï¼‰<p>useCallBackä¾èµ–æ˜¯ç©ºæ•°ç»„è¡¨ç¤ºä»€ä¹ˆï¼Ÿ</p>2021-06-01</li><br/><li><span>é™¢é•¿ã€‚</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>æœ‰ä¸ªé—®é¢˜æƒ³é—®ä¸‹ï¼Œå…³äºuseMemoï¼Œæ–‡æ¡£è¯´çš„æ˜¯æ€§èƒ½ä¼˜åŒ–çš„ä¿è¯ï¼Œä¹Ÿå°±æ˜¯æ¶‰åŠåˆ°å¤§é‡è®¡ç®—çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ï¼Œå› ä¸ºä¾èµ–é¡¹çš„æ¯”è¾ƒæœ¬èº«ä¹Ÿæ˜¯æœ‰å¼€é”€çš„ã€‚

é‚£å¦‚æœæˆ‘å°±åªæ˜¯å¾ˆç®€å•çš„è®¡ç®—ï¼Œæˆ–è€…å°±åªæ˜¯è¿”å›ä¸€ä¸ªå›ºå®šçš„å¯¹è±¡ï¼Œæœ‰å¿…è¦ä½¿ç”¨å—</p>2021-06-11</li><br/><li><span>å¼€å¼€ä¹‹ä¹‹</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ5ï¼‰<p>è€å¸ˆï¼Œæˆ‘ä¹Ÿæœ‰åŒæ ·çš„ç–‘é—®ï¼Œå®šæ—¶å™¨çš„ä¾‹å­ï¼Œä¸èƒ½ç”¨ä¸€ä¸ªå¸¸é‡å»ä¿å­˜å—ï¼Ÿ
import React, { useState, useCallback, useRef } from &#39;react&#39;

export default function Timer() {
  const [time, setTime] = useState(0)
  const timer = useRef(null)

  let timer2 = null

  const handleStart = useCallback(() =&gt; {
    timer2 = window.setInterval(() =&gt; {
      &#47;&#47; è¿™é‡Œæ˜¯ä¸ªé—­åŒ…ï¼Œæ¯æ¬¡æ‹¿åˆ°çš„timeå€¼æ˜¯0ï¼Œæ‰€ä»¥è¦è¿™æ ·å†™æ‰‹åŠ¨å»æ›´æ–°timeçš„å€¼
      setTime((time) =&gt; time + 1)
    }, 1000)
  }, [time])

  const handleStop = useCallback(() =&gt; {
    window.clearInterval(timer2)
    timer2 = null
  }, [])

  return (
    &lt;div&gt;
      {time &#47; 10} seconds.
      &lt;br&#47;&gt;
      &lt;button onClick={handleStart}&gt;start&lt;&#47;button&gt;
      &lt;button onClick={handleStop}&gt;stop&lt;&#47;button&gt;
    &lt;&#47;div&gt;
  )
}</p>2021-06-06</li><br/><li><span>ç¼æ–¯åŸºäºš</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ4ï¼‰<p>è€å¸ˆï¼Œè¯·é—®ï¼š
const handleIncrement = useCallback(() =&gt; setCount(count + 1), [count]);
const handleIncrement = useCallback(() =&gt; setCount(q =&gt; q + 1), []);
åœ¨æ€§èƒ½æ–¹é¢æ˜¯å¦åè€…ä¼˜äºå‰è€…ï¼Ÿæˆ‘çš„ç†è§£ï¼š
åè€…åªåˆ›å»ºäº†ä¸€æ¬¡å‡½æ•°ï¼Œä½†æ˜¯åˆè°ƒç”¨äº†å¤šæ¬¡åœ¨setCountçš„å›è°ƒå‡½æ•°
å‰è€…åªä¼šåœ¨countå˜åŒ–çš„æ—¶å€™åˆ›å»ºæ–°çš„å›è°ƒå‡½æ•°
è¿™æ ·åˆ†æä¸‹æ¥æˆ‘åˆè§‰å¾—ä¸¤è€…æ²¡ä»€ä¹ˆå·®å¼‚
æˆ‘ä¸æ˜¯å¤ªæ¸…æ¥šè¿™ä¸¤è€…çš„ä¼˜ç¼ºç‚¹ï¼Œå¸Œæœ›å¾—åˆ°è€å¸ˆçš„è§£ç­”ã€‚</p>2021-06-03</li><br/><li><span>Isaac</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ4ï¼‰<p>&lt;button onClick={() =&gt; handleClick(&#39;hi&#39;)}&gt;&lt;&#47;button&gt;

è€å¸ˆï¼Œä¸Šé¢è¿™ç§å†™æ³•ï¼Œç›´æ¥å°†ç®­å¤´å‡½æ•°ä½œä¸º props ä¼ é€’ç»™ buttonï¼Œæ˜¯ä¸æ˜¯æ¯æ¬¡ render çš„æ—¶å€™ï¼Œä¹Ÿä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ç®­å¤´å‡½æ•°ï¼Ÿ

å¦‚æœæ˜¯çš„è¯ï¼Œæ€ä¹ˆé¿å…å‘¢ï¼Ÿ</p>2021-06-03</li><br/><li><span>Sunny</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ4ï¼‰<p>import React, {
  useCallback,
  useRef,
  useReducer,
} from &#39;react&#39;;

const initialState = {time: 0};
function reducer(state, action) {
  switch (action.type) {
    case &#39;increment&#39;:
      return {time: state.time + 1};
    default:
      throw new Error();
  }
}

export default function Timer() {
  console.log(&#39;--render--&#39;)

  const [state, dispatch] = useReducer(reducer, initialState);
  
  const timer = useRef(null);

  const setIntervalCallback = useCallback( () =&gt; {
    dispatch({type: &#39;increment&#39;});
    console.log(&#39;setinterval time:&#39;, state.time)  &#47;&#47;ä¸ºä»€ä¹ˆè¿™é‡Œçš„state.timeä¸å˜ï¼Ÿ
  }, [state.time]);&#47;&#47;è¿™é‡Œçš„state.timeå˜åŒ–è¢«ç›‘å¬åˆ°äº†

  const handleStart = useCallback(() =&gt; {
    console.log(&#39;handlestart&#39;)
    timer.current = window.setInterval(setIntervalCallback, 1000);
  }, [timer, setIntervalCallback]);
  
  const handlePause = useCallback(() =&gt; {
    console.log(&#39;handlePause&#39;)
    window.clearInterval(timer.current);
    timer.current = null;    
  }, [timer]);
  
  return(
    &lt;div&gt;
      {state.time} seconds.
      &lt;MyStartBtn handleStart={handleStart}&#47;&gt;
      &lt;MyPauseBtn handlePause={handlePause}&#47;&gt;
    &lt;&#47;div&gt;
  );
}

function StartButton({handleStart}){
  console.log(&#39;startButton render --&#39;)
  return &lt;button onClick={handleStart}&gt;Start&lt;&#47;button&gt;;
}
const MyStartBtn = React.memo(StartButton, (prevProps, nextProps) =&gt; {
  return prevProps.handleStart === nextProps.handleStart;
});

function PauseButton({handlePause}){
  console.log(&#39;pauseButton render --&#39;)
  return &lt;button onClick={handlePause}&gt;Pause&lt;&#47;button&gt;;
}
const MyPauseBtn = React.memo( PauseButton, (prev, next) =&gt; {
  return prev.handlePause === next.handlePause;
})

&#47;*
console.logæ‰“å°ç»“æœï¼š
--render--
startButton render --
setinterval time: 0
æ¯ç§’å¾ªç¯æ‰“å°ä¸Šé¢3è¡Œ...


ç–‘é—®ï¼š
const setIntervalCallback = useCallback( () =&gt; {
    dispatch({type: &#39;increment&#39;});
    console.log(&#39;setinterval time:&#39;, state.time)  &#47;&#47;ä¸ºä»€ä¹ˆè¿™é‡Œçš„state.timeä¸å˜ï¼Ÿ
  }, [state.time]);&#47;&#47;è¿™é‡Œçš„state.timeå˜åŒ–è¢«ç›‘å¬åˆ°äº†
*&#47;</p>2021-06-01</li><br/><li><span>å¿«æ‰¶æˆ‘èµ·æ¥å­¦ä¹ </span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>const ThemeContext = React.createContext(themes.light);  è¿™é‡Œçš„themes. Lightå‚æ•°æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿæˆ‘ä¼ nullä¹Ÿæ­£å¸¸workäº†
</p>2021-08-05</li><br/><li><span>èŠ±å„¿ä¸å°‘å¹´</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>useContextçš„å®˜æ–¹ä¾‹å­ä¸­ï¼Œå­ç»„ä»¶ä¸­ const theme = useContext(ThemeContext);  é‚£æ˜¯éœ€è¦å­ç»„ä»¶ å¼•ç”¨ThemeContext è¿™ä¸ªå˜é‡å—ï¼Œ å®é™…å¼€å‘ä¸­è¿™ä¸ªå­ç»„ä»¶å¯èƒ½æ˜¯å•ç‹¬çš„ä¸€ä¸ªjsxæ–‡ä»¶ï¼Œéœ€è¦æ¯ä¸ªç”¨åˆ°çš„å­ç»„ä»¶ import è¿™ä¸ªå˜é‡ï¼Ÿ</p>2021-08-01</li><br/><li><span>rookielink</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>useRefç¤ºä¾‹ä¸­æ›¿æ¢è¿™ä¸ªæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ 
const timer = useRef(null);  =&gt;  const timer = {}; </p>2021-07-30</li><br/>
</ul>