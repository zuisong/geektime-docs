<!--geek time docs 🚀, MIT license-->


<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="极客时间文档">
      
      
        <meta name="author" content="zkep">
      
      
        <link rel="canonical" href="https://github.com/uaxe/geektime-docs/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E6%88%9845%E8%AE%B2/11%20-%20%E8%AE%BE%E7%BD%AE%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F%E4%B8%8E%E7%8E%AF%E5%A2%83%EF%BC%88%E4%B8%AD%EF%BC%89%EF%BC%9A%E5%BB%BA%E9%80%A0%E4%BA%8C%E7%BA%A7%E5%BC%95%E5%AF%BC%E5%99%A8/">
      
      
        <link rel="prev" href="../10%20-%20%E8%AE%BE%E7%BD%AE%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F%E4%B8%8E%E7%8E%AF%E5%A2%83%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9A%E5%BB%BA%E7%AB%8B%E8%AE%A1%E7%AE%97%E6%9C%BA/">
      
      
        <link rel="next" href="../12%20-%20%E8%AE%BE%E7%BD%AE%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F%E4%B8%8E%E7%8E%AF%E5%A2%83%EF%BC%88%E4%B8%8B%EF%BC%89%EF%BC%9A%E6%8E%A2%E6%9F%A5%E5%92%8C%E6%94%B6%E9%9B%86%E4%BF%A1%E6%81%AF/">
      
      
      <link rel="icon" href="../../../None">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.5">
    
    
      
        <title>11 设置工作模式与环境（中）：建造二级引导器 - 极客时间文档</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../stylesheets/style.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            


          </div>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="极客时间文档" class="md-header__button md-logo" aria-label="极客时间文档" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            极客时间文档
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              11   设置工作模式与环境（中）：建造二级引导器
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/zkep/my-geektime" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    zkep/my-geektime
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../AI-%E5%A4%A7%E6%95%B0%E6%8D%AE/" class="md-tabs__link">
          
  
    
  
  AI-大数据

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E4%BA%A7%E5%93%81-%E8%BF%90%E8%90%A5/" class="md-tabs__link">
          
  
    
  
  产品-运营

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E5%89%8D%E7%AB%AF-%E7%A7%BB%E5%8A%A8/" class="md-tabs__link">
          
  
    
  
  前端-移动

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E5%90%8E%E7%AB%AF-%E6%9E%B6%E6%9E%84/" class="md-tabs__link">
          
  
    
  
  后端-架构

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E7%AE%A1%E7%90%86-%E6%88%90%E9%95%BF/" class="md-tabs__link">
          
  
    
  
  管理-成长

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
    
  
  计算机基础

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E8%BF%90%E7%BB%B4-%E6%B5%8B%E8%AF%95/" class="md-tabs__link">
          
  
    
  
  运维-测试

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="极客时间文档" class="md-nav__button md-logo" aria-label="极客时间文档" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    极客时间文档
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/zkep/my-geektime" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    zkep/my-geektime
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../AI-%E5%A4%A7%E6%95%B0%E6%8D%AE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    AI-大数据
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E4%BA%A7%E5%93%81-%E8%BF%90%E8%90%A5/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    产品-运营
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E5%89%8D%E7%AB%AF-%E7%A7%BB%E5%8A%A8/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    前端-移动
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E5%90%8E%E7%AB%AF-%E6%9E%B6%E6%9E%84/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    后端-架构
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E7%AE%A1%E7%90%86-%E6%88%90%E9%95%BF/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    管理-成长
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    计算机基础
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            计算机基础
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../MySQL%20%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/MySQL%20%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    MySQL 必知必会
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Python%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8A%9E%E5%85%AC%E5%AE%9E%E6%88%98%E8%AF%BE/Python%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8A%9E%E5%85%AC%E5%AE%9E%E6%88%98%E8%AF%BE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Python自动化办公实战课
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Vim%20%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/Vim%20%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Vim 实用技巧必知必会
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91%E7%AE%97%E6%B3%9550%E8%AE%B2/%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91%E7%AE%97%E6%B3%9550%E8%AE%B2/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    业务开发算法50讲
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E4%BB%A3%E7%A0%81%E4%B9%8B%E4%B8%91/%E4%BB%A3%E7%A0%81%E4%B9%8B%E4%B8%91/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    代码之丑
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E4%BB%A3%E7%A0%81%E7%B2%BE%E8%BF%9B%E4%B9%8B%E8%B7%AF/%E4%BB%A3%E7%A0%81%E7%B2%BE%E8%BF%9B%E4%B9%8B%E8%B7%AF/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    代码精进之路
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8BC%2B%2B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8BC%2B%2B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    快速上手C++数据结构与算法
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E5%86%99%E4%B8%80%E9%97%A8%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E5%86%99%E4%B8%80%E9%97%A8%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    手把手带你写一门编程语言
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_10" checked>
        
          
          <label class="md-nav__link" for="__nav_6_10" id="__nav_6_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    操作系统实战45讲
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_10_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_10">
            <span class="md-nav__icon md-icon"></span>
            操作系统实战45讲
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E6%88%9845%E8%AE%B2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    操作系统实战45讲
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%BC%80%E7%AF%87%E8%AF%8D%20-%20%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%AD%A6%E5%86%99%E4%B8%80%E4%B8%AA%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    开篇词   为什么要学写一个操作系统？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03%20-%20%E9%BB%91%E7%9B%92%E4%B9%8B%E4%B8%AD%E6%9C%89%E4%BB%80%E4%B9%88%EF%BC%9A%E5%86%85%E6%A0%B8%E7%BB%93%E6%9E%84%E4%B8%8E%E8%AE%BE%E8%AE%A1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    03   黑盒之中有什么：内核结构与设计
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04%20-%20%E9%9C%87%E6%92%BC%E7%9A%84Linux%E5%85%A8%E6%99%AF%E5%9B%BE%EF%BC%9A%E4%B8%9A%E7%95%8C%E6%88%90%E7%86%9F%E7%9A%84%E5%86%85%E6%A0%B8%E6%9E%B6%E6%9E%84%E9%95%BF%E4%BB%80%E4%B9%88%E6%A0%B7%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    04   震撼的Linux全景图：业界成熟的内核架构长什么样？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../08%20-%20%E9%94%81%EF%BC%9A%E5%B9%B6%E5%8F%91%E6%93%8D%E4%BD%9C%E4%B8%AD%EF%BC%8C%E8%A7%A3%E5%86%B3%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E7%9A%84%E5%9B%9B%E7%A7%8D%E6%96%B9%E6%B3%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    08   锁：并发操作中，解决数据同步的四种方法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../09%20-%20%E7%9E%A7%E4%B8%80%E7%9E%A7Linux%EF%BC%9ALinux%E7%9A%84%E8%87%AA%E6%97%8B%E9%94%81%E5%92%8C%E4%BF%A1%E5%8F%B7%E9%87%8F%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    09   瞧一瞧Linux：Linux的自旋锁和信号量如何实现？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10%20-%20%E8%AE%BE%E7%BD%AE%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F%E4%B8%8E%E7%8E%AF%E5%A2%83%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9A%E5%BB%BA%E7%AB%8B%E8%AE%A1%E7%AE%97%E6%9C%BA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10   设置工作模式与环境（上）：建立计算机
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    11   设置工作模式与环境（中）：建造二级引导器
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    11   设置工作模式与环境（中）：建造二级引导器
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      设计机器信息结构
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      规划二级引导器
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grub" class="md-nav__link">
    <span class="md-ellipsis">
      实现GRUB头
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      进入二级引导器
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bios" class="md-nav__link">
    <span class="md-ellipsis">
      巧妙调用BIOS中断
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      二级引导器主函数
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      重点回顾
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      思考题
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../12%20-%20%E8%AE%BE%E7%BD%AE%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F%E4%B8%8E%E7%8E%AF%E5%A2%83%EF%BC%88%E4%B8%8B%EF%BC%89%EF%BC%9A%E6%8E%A2%E6%9F%A5%E5%92%8C%E6%94%B6%E9%9B%86%E4%BF%A1%E6%81%AF/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    12   设置工作模式与环境（下）：探查和收集信息
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../13%20-%20%E7%AC%AC%E4%B8%80%E4%B8%AAC%E5%87%BD%E6%95%B0%EF%BC%9A%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E6%9D%BF%E7%BA%A7%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    13   第一个C函数：如何实现板级初始化？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../14%20-%20Linux%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9AGRUB%E4%B8%8Evmlinuz%E7%9A%84%E7%BB%93%E6%9E%84/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    14   Linux初始化（上）：GRUB与vmlinuz的结构
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../15%20-%20Linux%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%88%E4%B8%8B%EF%BC%89%EF%BC%9A%E4%BB%8E_start%E5%88%B0%E7%AC%AC%E4%B8%80%E4%B8%AA%E8%BF%9B%E7%A8%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    15   Linux初始化（下）：从 start到第一个进程
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../24%20-%20%E6%B4%BB%E5%8A%A8%E7%9A%84%E6%8F%8F%E8%BF%B0%EF%BC%9A%E5%88%B0%E5%BA%95%E4%BB%80%E4%B9%88%E6%98%AF%E8%BF%9B%E7%A8%8B%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    24   活动的描述：到底什么是进程？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../25%20-%20%E5%A4%9A%E4%B8%AA%E6%B4%BB%E5%8A%A8%E8%A6%81%E5%AE%89%E6%8E%92%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9A%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%A6%82%E4%BD%95%E8%B0%83%E5%BA%A6%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    25   多个活动要安排（上）：多进程如何调度？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../26%20-%20%E5%A4%9A%E4%B8%AA%E6%B4%BB%E5%8A%A8%E8%A6%81%E5%AE%89%E6%8E%92%EF%BC%88%E4%B8%8B%EF%BC%89%EF%BC%9A%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E8%BF%9B%E7%A8%8B%E7%9A%84%E7%AD%89%E5%BE%85%E4%B8%8E%E5%94%A4%E9%86%92%E6%9C%BA%E5%88%B6%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    26   多个活动要安排（下）：如何实现进程的等待与唤醒机制？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../27%20-%20%E7%9E%A7%E4%B8%80%E7%9E%A7Linux%EF%BC%9ALinux%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E8%BF%9B%E7%A8%8B%E4%B8%8E%E8%BF%9B%E7%A8%8B%E8%B0%83%E5%BA%A6%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    27   瞧一瞧Linux：Linux如何实现进程与进程调度？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../28%20-%20%E9%83%A8%E9%97%A8%E5%88%86%E7%B1%BB%EF%BC%9A%E5%A6%82%E4%BD%95%E8%A1%A8%E7%A4%BA%E8%AE%BE%E5%A4%87%E7%B1%BB%E5%9E%8B%E4%B8%8E%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    28   部门分类：如何表示设备类型与设备驱动？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../29%20-%20%E9%83%A8%E9%97%A8%E5%BB%BA%E7%AB%8B%EF%BC%9A%E5%A6%82%E4%BD%95%E5%9C%A8%E5%86%85%E6%A0%B8%E4%B8%AD%E6%B3%A8%E5%86%8C%E8%AE%BE%E5%A4%87%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    29   部门建立：如何在内核中注册设备？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../30%20-%20%E9%83%A8%E9%97%A8%E5%93%8D%E5%BA%94%EF%BC%9A%E8%AE%BE%E5%A4%87%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E5%86%85%E6%A0%B8I-O%E5%8C%85%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    30   部门响应：设备如何处理内核I O包？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../31%20-%20%E7%9E%A7%E4%B8%80%E7%9E%A7Linux%EF%BC%9A%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E8%AE%BE%E5%A4%87%E4%BF%A1%E6%81%AF%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    31   瞧一瞧Linux：如何获取所有设备信息？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../32%20-%20%E4%BB%93%E5%BA%93%E7%BB%93%E6%9E%84%EF%BC%9A%E5%A6%82%E4%BD%95%E7%BB%84%E7%BB%87%E6%96%87%E4%BB%B6%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    32   仓库结构：如何组织文件？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../33%20-%20%E4%BB%93%E5%BA%93%E5%88%92%E5%88%86%EF%BC%9A%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%93%8D%E4%BD%9C/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    33   仓库划分：文件系统的格式化操作
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../34%20-%20%E4%BB%93%E5%BA%93%E7%AE%A1%E7%90%86%EF%BC%9A%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E7%9A%84%E5%85%AD%E5%A4%A7%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    34   仓库管理：如何实现文件的六大基本操作？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../35%20-%20%E7%9E%A7%E4%B8%80%E7%9E%A7Linux%EF%BC%9A%E8%99%9A%E6%8B%9F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%A6%82%E4%BD%95%E7%AE%A1%E7%90%86%E6%96%87%E4%BB%B6%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    35   瞧一瞧Linux：虚拟文件系统如何管理文件？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../36%20-%20%E4%BB%8EURL%E5%88%B0%E7%BD%91%E5%8D%A1%EF%BC%9A%E5%A6%82%E4%BD%95%E5%85%A8%E5%B1%80%E8%A7%82%E5%AF%9F%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE%E6%B5%81%E5%8A%A8%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    36   从URL到网卡：如何全局观察网络数据流动？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../37%20-%20%E4%BB%8E%E5%86%85%E6%A0%B8%E5%88%B0%E5%BA%94%E7%94%A8%EF%BC%9A%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE%E5%9C%A8%E5%86%85%E6%A0%B8%E4%B8%AD%E5%A6%82%E4%BD%95%E6%B5%81%E8%BD%AC/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    37   从内核到应用：网络数据在内核中如何流转
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../38%20-%20%E4%BB%8E%E5%8D%95%E6%8E%92%E5%88%B0%E5%9B%A2%E6%88%98%EF%BC%9A%E8%AF%A6%E8%A7%A3%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%8F%E8%A7%82%E7%BD%91%E7%BB%9C%E6%9E%B6%E6%9E%84/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    38   从单排到团战：详解操作系统的宏观网络架构
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../41%20-%20%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%EF%BC%9A%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E6%B2%9F%E9%80%9A%E6%A1%A5%E6%A2%81%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    41   服务接口：如何搭建沟通桥梁？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../42%20-%20%E7%9E%A7%E4%B8%80%E7%9E%A7Linux%EF%BC%9A%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%B3%BB%E7%BB%9FAPI%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    42   瞧一瞧Linux：如何实现系统API？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../43%20-%20%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%86%85%E6%A0%B8%EF%BC%9AKVM%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    43   虚拟机内核：KVM是什么？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../44%20-%20%E5%AE%B9%E5%99%A8%EF%BC%9A%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    44   容器：如何理解容器的实现机制？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../45%20-%20ARM%E6%96%B0%E5%AE%A0%EF%BC%9A%E8%8B%B9%E6%9E%9C%E7%9A%84M1%E8%8A%AF%E7%89%87%E5%9B%A0%E4%BD%95%E8%80%8C%E5%BF%AB%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    45   ARM新宠：苹果的M1芯片因何而快？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../46%20-%20AArch64%E4%BD%93%E7%B3%BB%EF%BC%9AARM%E6%9C%80%E6%96%B0%E7%BC%96%E7%A8%8B%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%9E%8B%E5%89%96%E6%9E%90/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    46   AArch64体系：ARM最新编程架构模型剖析
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%BB%93%E6%9D%9F%E8%AF%AD%20-%20%E7%94%9F%E6%B4%BB%E5%8F%AF%E4%BB%A5%E4%B8%80%E5%9C%B0%E9%B8%A1%E6%AF%9B%EF%BC%8C%E4%BD%86%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%8D%B4%E6%98%AF%E5%BF%83%E4%B8%AD%E7%9A%84%E5%85%89/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    结束语   生活可以一地鸡毛，但操作系统却是心中的光
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%BB%93%E8%AF%BE%E6%B5%8B%E8%AF%95%20-%E8%BF%99%E4%BA%9B%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%8C%E4%BD%A0%E9%83%BD%E6%8E%8C%E6%8F%A1%E4%BA%86%E4%B9%88%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    结课测试  这些操作系统的问题，你都掌握了么？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%A4%A7%E5%92%96%E5%8A%A9%E5%9C%BA-%E4%BB%A5%E6%97%A0%E6%B3%95%E4%B8%BA%E6%9C%89%E6%B3%95%EF%BC%8C%E4%BB%A5%E6%97%A0%E9%99%90%E4%B8%BA%E6%9C%89%E9%99%90/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    大咖助场 以无法为有法，以无限为有限
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../LMOS%E6%9D%A5%E4%BF%A1%EF%BC%9A%E7%AC%AC%E4%BA%8C%E5%AD%A3%E8%AF%BE%E7%A8%8B%E5%B8%A6%E4%BD%A0%E2%80%9C%E6%89%8B%E6%92%95%E2%80%9D%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LMOS来信：第二季课程带你“手撕”计算机基础
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%BC%96%E8%BE%91%E6%89%8B%E8%AE%B0%20-%20%E5%8D%87%E7%BA%A7%E8%AE%A4%E7%9F%A5%EF%BC%8C%E8%BF%AD%E4%BB%A3%E8%87%AA%E5%B7%B1%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    编辑手记   升级认知，迭代自己的操作系统
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01%20-%20%E7%A8%8B%E5%BA%8F%E7%9A%84%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B%EF%BC%9A%E4%BB%8E%E4%BB%A3%E7%A0%81%E5%88%B0%E6%9C%BA%E5%99%A8%E8%BF%90%E8%A1%8C/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    01   程序的运行过程：从代码到机器运行
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02%20-%20%E5%87%A0%E8%A1%8C%E6%B1%87%E7%BC%96%E5%87%A0%E8%A1%8CC%EF%BC%9A%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E5%86%85%E6%A0%B8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    02   几行汇编几行C：实现一个最简单的内核
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05%20-%20CPU%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F%EF%BC%9A%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F%E7%9A%84%E4%B8%89%E7%A7%8D%E6%A8%A1%E5%BC%8F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    05   CPU工作模式：执行程序的三种模式
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06%20-%20%E8%99%9A%E5%B9%BB%E4%B8%8E%E7%9C%9F%E5%AE%9E%EF%BC%9A%E7%A8%8B%E5%BA%8F%E4%B8%AD%E7%9A%84%E5%9C%B0%E5%9D%80%E5%A6%82%E4%BD%95%E8%BD%AC%E6%8D%A2%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    06   虚幻与真实：程序中的地址如何转换？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07%20-%20Cache%E4%B8%8E%E5%86%85%E5%AD%98%EF%BC%9A%E7%A8%8B%E5%BA%8F%E6%94%BE%E5%9C%A8%E5%93%AA%E5%84%BF%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    07   Cache与内存：程序放在哪儿？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../16%20-%20%E5%88%92%E5%88%86%E5%9C%9F%E5%9C%B0%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9A%E5%A6%82%E4%BD%95%E5%88%92%E5%88%86%E4%B8%8E%E7%BB%84%E7%BB%87%E5%86%85%E5%AD%98%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    16   划分土地（上）：如何划分与组织内存？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../17%20-%20%E5%88%92%E5%88%86%E5%9C%9F%E5%9C%B0%EF%BC%88%E4%B8%AD%EF%BC%89%EF%BC%9A%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%86%85%E5%AD%98%E9%A1%B5%E9%9D%A2%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    17   划分土地（中）：如何实现内存页面初始化？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../18%20-%20%E5%88%92%E5%88%86%E5%9C%9F%E5%9C%B0%EF%BC%88%E4%B8%8B%EF%BC%89%EF%BC%9A%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%86%85%E5%AD%98%E9%A1%B5%E7%9A%84%E5%88%86%E9%85%8D%E4%B8%8E%E9%87%8A%E6%94%BE%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    18   划分土地（下）：如何实现内存页的分配与释放？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../19%20-%20%E5%9C%9F%E5%9C%B0%E4%B8%8D%E8%83%BD%E6%B5%AA%E8%B4%B9%EF%BC%9A%E5%A6%82%E4%BD%95%E7%AE%A1%E7%90%86%E5%86%85%E5%AD%98%E5%AF%B9%E8%B1%A1%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    19   土地不能浪费：如何管理内存对象？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../20%20-%20%E5%9C%9F%E5%9C%B0%E9%9C%80%E6%B1%82%E6%89%A9%E5%A4%A7%E4%B8%8E%E4%BF%9D%E9%9A%9C%EF%BC%9A%E5%A6%82%E4%BD%95%E8%A1%A8%E7%A4%BA%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    20   土地需求扩大与保障：如何表示虚拟内存？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../21%20-%20%E5%9C%9F%E5%9C%B0%E9%9C%80%E6%B1%82%E6%89%A9%E5%A4%A7%E4%B8%8E%E4%BF%9D%E9%9A%9C%EF%BC%9A%E5%A6%82%E4%BD%95%E5%88%86%E9%85%8D%E5%92%8C%E9%87%8A%E6%94%BE%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    21   土地需求扩大与保障：如何分配和释放虚拟内存？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../22%20-%20%E7%9E%A7%E4%B8%80%E7%9E%A7Linux%EF%BC%9A%E4%BC%99%E4%BC%B4%E7%B3%BB%E7%BB%9F%E5%A6%82%E4%BD%95%E5%88%86%E9%85%8D%E5%86%85%E5%AD%98%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    22   瞧一瞧Linux：伙伴系统如何分配内存？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../23%20-%20%E7%9E%A7%E4%B8%80%E7%9E%A7Linux%EF%BC%9ASLAB%E5%A6%82%E4%BD%95%E5%88%86%E9%85%8D%E5%86%85%E5%AD%98%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    23   瞧一瞧Linux：SLAB如何分配内存？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../39%20-%20%E7%9E%A7%E4%B8%80%E7%9E%A7Linux%EF%BC%9A%E8%AF%A6%E8%A7%A3socket%E5%AE%9E%E7%8E%B0%E4%B8%8E%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E6%8E%A5%E5%8F%A3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    39   瞧一瞧Linux：详解socket实现与网络编程接口
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../40%20-%20%E7%9E%A7%E4%B8%80%E7%9E%A7Linux%EF%BC%9A%E8%AF%A6%E8%A7%A3socket%E7%9A%84%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    40   瞧一瞧Linux：详解socket的接口实现
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%94%A8%E6%88%B7%E6%95%85%E4%BA%8B%20-%20%E6%88%90%E4%B8%BA%E9%9D%A2%E5%90%91%E2%80%9C%E7%9F%A5%E8%AF%86%E5%BA%93%E2%80%9D%E7%9A%84%E5%B7%A5%E7%A8%8B%E5%B8%88/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    用户故事   成为面向“知识库”的工程师
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%94%A8%E6%88%B7%E6%95%85%E4%BA%8B%20-%20%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%8F%91%E7%83%A7%E5%8F%8B%EF%BC%9A%E7%9C%8B%E4%B8%8D%E6%87%82%EF%BC%9F%E5%9B%A0%E4%B8%BA%E4%BD%A0%E6%B2%A1%E5%8A%A8%E6%89%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    用户故事   操作系统发烧友：看不懂？因为你没动手
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%94%A8%E6%88%B7%E6%95%85%E4%BA%8B%20-%20%E6%8A%80%E6%9C%AF%E4%BA%BA%E5%A6%82%E4%BD%95%E5%81%9A%E9%80%89%E6%8B%A9%EF%BC%8C%E8%B7%AF%E6%89%8D%E8%B6%8A%E8%B5%B0%E8%B6%8A%E5%AE%BD%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    用户故事   技术人如何做选择，路才越走越宽？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%94%A8%E6%88%B7%E6%95%85%E4%BA%8B%20-%20%E7%94%A8%E5%A5%BD%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95%EF%BC%8C%E5%8A%A9%E5%8A%9B%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    用户故事   用好动态调试，助力课程学习
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%94%A8%E6%88%B7%E6%95%85%E4%BA%8B%20-%20yiyang%EF%BC%9A%E6%88%91%E7%9A%84%E4%B8%8A%E6%9C%BA%E5%AE%9E%E9%AA%8C%E2%80%9C%E7%88%AC%E5%9D%91%E6%8C%87%E5%8D%97%E2%80%9D/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    用户故事   yiyang：我的上机实验“爬坑指南”
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%94%A8%E6%88%B7%E6%95%85%E4%BA%8B-%E8%89%BE%E5%90%8C%E5%AD%A6%EF%BC%9A%E8%B7%AF%E8%99%BD%E8%BF%9C%EF%BC%8C%E8%A1%8C%E5%88%99%E5%B0%86%E8%87%B3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    用户故事 艾同学：路虽远，行则将至
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%94%A8%E6%88%B7%E6%95%85%E4%BA%8B-%E9%A9%B0%E5%BE%80%EF%BC%9A%E5%80%9F%E9%95%9C%E8%A7%82%E5%BD%A2%EF%BC%8C%E5%AD%A6%E4%BB%A5%E8%87%B4%E7%94%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    用户故事 驰往：借镜观形，学以致用
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%8F%82%E8%80%83%E7%AD%94%E6%A1%88%20-%20%E5%AF%B9%E7%AD%94%E6%A1%88%EF%BC%8C%E6%98%AF%E5%86%8D%E6%AC%A1%E5%AD%A6%E4%B9%A0%E7%9A%84%E4%B8%80%E4%B8%AA%E6%9C%BA%E4%BC%9A/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    参考答案   对答案，是再次学习的一个机会
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E4%B9%8B%E7%BE%8E/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E4%B9%8B%E7%BE%8E/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    数据结构与算法之美
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8%E8%AF%BE/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8%E8%AF%BE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    正则表达式入门课
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    深入浅出计算机组成原理
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80%E8%AF%BE/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80%E8%AF%BE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    程序员的数学基础课
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E4%B9%8B%E7%BE%8E/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E4%B9%8B%E7%BE%8E/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    编译原理之美
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AE%9E%E6%88%98%E8%AF%BE/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AE%9E%E6%88%98%E8%AF%BE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    编译原理实战课
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    计算机基础实战课
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E8%B6%A3%E8%B0%88Linux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E8%B6%A3%E8%B0%88Linux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    趣谈Linux操作系统
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    趣谈网络协议
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B%E4%B9%8B%E7%BE%8E/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B%E4%B9%8B%E7%BE%8E/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    软件工程之美
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E4%B9%8B%E7%BE%8E/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E4%B9%8B%E7%BE%8E/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    软件设计之美
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E9%80%8F%E8%A7%86HTTP%E5%8D%8F%E8%AE%AE/%E9%80%8F%E8%A7%86HTTP%E5%8D%8F%E8%AE%AE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    透视HTTP协议
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E9%87%8D%E5%AD%A6%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/%E9%87%8D%E5%AD%A6%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    重学线性代数
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E8%BF%90%E7%BB%B4-%E6%B5%8B%E8%AF%95/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    运维-测试
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      设计机器信息结构
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      规划二级引导器
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grub" class="md-nav__link">
    <span class="md-ellipsis">
      实现GRUB头
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      进入二级引导器
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bios" class="md-nav__link">
    <span class="md-ellipsis">
      巧妙调用BIOS中断
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      二级引导器主函数
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      重点回顾
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      思考题
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>11   设置工作模式与环境（中）：建造二级引导器</h1>

<p>你好，我是LMOS。</p>
<p>上节课，我们建造了属于我们的“计算机”，并且在上面安装好了GRUB。这节课我会带你一起实现二级引导器这个关键组件。</p>
<p>看到这儿你可能会问，GRUB不是已经把我们的操作系统加载到内存中了吗？我们有了GRUB，我们为什么还要实现二级引导器呢？</p>
<p>这里我要给你说说我的观点，二级引导器作为操作系统的先驱，它需要<strong>收集机器信息</strong>，确定这个计算机能不能运行我们的操作系统，对CPU、内存、显卡进行一些初级的配置，放置好内核相关的文件。</p>
<p>因为我们二级引导器不是执行具体的加载任务的，而是解析内核文件、收集机器环境信息，它具体收集哪些信息，我会在下节课详细展开。</p>
<h2 id="_1">设计机器信息结构</h2>
<p>二级引导器收集的信息，需要地点存放，我们需要设计一个数据结构。信息放在这个数据结构中，这个结构放在内存1MB的地方，方便以后传给我们的操作系统。</p>
<p>为了让你抓住重点，我选取了这个数据结构的<strong>关键代码</strong>，这里并没有列出该结构的所有字段（Cosmos/initldr/include/ldrtype.h），这个结构如下所示。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>typedef struct s_MACHBSTART
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>{
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    u64_t   mb_krlinitstack;//内核栈地址
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    u64_t   mb_krlitstacksz;//内核栈大小
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    u64_t   mb_imgpadr;//操作系统映像
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    u64_t   mb_imgsz;//操作系统映像大小
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    u64_t   mb_bfontpadr;//操作系统字体地址
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    u64_t   mb_bfontsz;//操作系统字体大小
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    u64_t   mb_fvrmphyadr;//机器显存地址
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    u64_t   mb_fvrmsz;//机器显存大小
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    u64_t   mb_cpumode;//机器CPU工作模式
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    u64_t   mb_memsz;//机器内存大小
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    u64_t   mb_e820padr;//机器e820数组地址
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    u64_t   mb_e820nr;//机器e820数组元素个数
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    u64_t   mb_e820sz;//机器e820数组大小
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    //……
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>    u64_t   mb_pml4padr;//机器页表数据地址
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>    u64_t   mb_subpageslen;//机器页表个数
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>    u64_t   mb_kpmapphymemsz;//操作系统映射空间大小
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>    //……
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>    graph_t mb_ghparm;//图形信息
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>}__attribute__((packed)) machbstart_t;
</code></pre></div>
<h2 id="_2">规划二级引导器</h2>
<p>在开始写代码之前，我们先来从整体划分一下二级引导器的功能模块，从全局了解下功能应该怎么划分，这里我特意为你梳理了一个表格。</p>
<p><img alt="" src="https://static001.geekbang.org/resource/image/31/1e/3169e9db4549ab036c2de269788a281e.jpg?wh=1636%2A846" title="二级引导器功能划分表" /></p>
<p>前面表格里的这些文件，我都放在了课程配套源码中了，你可以从<a href="https://gitee.com/lmos/cosmos/tree/master/lesson10~11">这里</a>下载。</p>
<p>上述这些文件都在lesson10～11/Cosmos/initldr/ldrkrl目录中，它们在编译之后会形成三个文件，编译脚本我已经写好了，下面我们用一幅图来展示这个编译过程。</p>
<p><img alt="" src="https://static001.geekbang.org/resource/image/bd/40/bd55f67d02edff4415f06c914403bc40.jpg?wh=5005%2A3110" title="二级引导器编译过程示意图" /></p>
<p>这最后三个文件用我们前面说的映像工具打包成映像文件，其指令如下。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>lmoskrlimg -m k -lhf initldrimh.bin -o Cosmos.eki -f initldrkrl.bin initldrsve.bin
</code></pre></div>
<h2 id="grub">实现GRUB头</h2>
<p>我们的GRUB头有两个文件组成，<strong>一个imginithead.asm汇编文件</strong>，它有两个功能，既能让GRUB识别，又能设置C语言运行环境，用于调用C函数；<strong>第二就是inithead.c文件</strong>，它的主要功能是查找二级引导器的核心文件——initldrkrl.bin，然后把它放置到特定的内存地址上。</p>
<p>我们先来实现imginithead.asm，它主要工作是初始化CPU的寄存器，加载GDT，切换到CPU的保护模式，我们一步一步来实现。</p>
<p>首先是GRUB1和GRUB2需要的两个头结构，代码如下。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>MBT_HDR_FLAGS   EQU 0x00010003
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>MBT_HDR_MAGIC   EQU 0x1BADB002
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>MBT2_MAGIC  EQU 0xe85250d6
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>global _start
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>extern inithead_entry
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>[section .text]
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>[bits 32]
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>_start:
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>    jmp _entry
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>align 4
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>mbt_hdr:
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>    dd MBT_HDR_MAGIC
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>    dd MBT_HDR_FLAGS
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>    dd -(MBT_HDR_MAGIC+MBT_HDR_FLAGS)
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>    dd mbt_hdr
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>    dd _start
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>    dd 0
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>    dd 0
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>    dd _entry
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>ALIGN 8
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>mbhdr:
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>    DD  0xE85250D6
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>    DD  0
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>    DD  mhdrend - mbhdr
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>    DD  -(0xE85250D6 + 0 + (mhdrend - mbhdr))
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>    DW  2, 0
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>    DD  24
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>    DD  mbhdr
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>    DD  _start
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>    DD  0
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a>    DD  0
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a>    DW  3, 0
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>    DD  12
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a>    DD  _entry 
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a>    DD  0  
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a>    DW  0, 0
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a>    DD  8
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a>mhdrend:
</code></pre></div>
<p>然后是关中断并加载GDT，代码如下所示。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>_entry:
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    cli           ；关中断
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    in al, 0x70 
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>    or al, 0x80 
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>    out 0x70,al  ；关掉不可屏蔽中断   
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>    lgdt [GDT_PTR] ；加载GDT地址到GDTR寄存器
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>    jmp dword 0x8 :_32bits_mode ；长跳转刷新CS影子寄存器
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>  ;………………
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>;GDT全局段描述符表
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>GDT_START:
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>knull_dsc: dq 0
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>kcode_dsc: dq 0x00cf9e000000ffff
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>kdata_dsc: dq 0x00cf92000000ffff
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>k16cd_dsc: dq 0x00009e000000ffff ；16位代码段描述符
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>k16da_dsc: dq 0x000092000000ffff ；16位数据段描述符
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>GDT_END:
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>GDT_PTR:
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>GDTLEN  dw GDT_END-GDT_START-1  ;GDT界限
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>GDTBASE dd GDT_START
</code></pre></div>
<p>最后是初始化段寄存器和通用寄存器、栈寄存器，这是为了给调用inithead_entry这个C函数做准备，代码如下所示。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>_32bits_mode：
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    mov ax, 0x10
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>    mov ds, ax
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>    mov ss, ax
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>    mov es, ax
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>    mov fs, ax
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>    mov gs, ax
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>    xor eax,eax
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>    xor ebx,ebx
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>    xor ecx,ecx
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>    xor edx,edx
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>    xor edi,edi
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>    xor esi,esi
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>    xor ebp,ebp
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>    xor esp,esp
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>    mov esp,0x7c00 ；设置栈顶为0x7c00
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>    call inithead_entry ；调用inithead_entry函数在inithead.c中实现
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>    jmp 0x200000  ；跳转到0x200000地址
</code></pre></div>
<p>上述代码的最后调用了inithead_entry函数，这个函数我们需要另外在inithead.c中实现，我们这就来实现它，如下所示。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>#define MDC_ENDGIC 0xaaffaaffaaffaaff
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>#define MDC_RVGIC 0xffaaffaaffaaffaa
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>#define REALDRV_PHYADR 0x1000
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>#define IMGFILE_PHYADR 0x4000000
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>#define IMGKRNL_PHYADR 0x2000000
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>#define LDRFILEADR IMGFILE_PHYADR
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>#define MLOSDSC_OFF (0x1000)
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>#define MRDDSC_ADR (mlosrddsc_t*)(LDRFILEADR+0x1000)
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>void inithead_entry()
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>{
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>    write_realintsvefile();
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>    write_ldrkrlfile();
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>    return;
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>}
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>//写initldrsve.bin文件到特定的内存中
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>void write_realintsvefile()
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>{
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>    fhdsc_t *fhdscstart = find_file(&quot;initldrsve.bin&quot;);
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>    if (fhdscstart == NULL)
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>    {
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>        error(&quot;not file initldrsve.bin&quot;);
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>    }
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a>    m2mcopy((void *)((u32_t)(fhdscstart-&gt;fhd_intsfsoff) + LDRFILEADR),
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>            (void *)REALDRV_PHYADR, (sint_t)fhdscstart-&gt;fhd_frealsz);
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a>    return;
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a>}
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a>//写initldrkrl.bin文件到特定的内存中
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a>void write_ldrkrlfile()
<a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a>{
<a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a>    fhdsc_t *fhdscstart = find_file(&quot;initldrkrl.bin&quot;);
<a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a>    if (fhdscstart == NULL)
<a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a>    {
<a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a>        error(&quot;not file initldrkrl.bin&quot;);
<a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a>    }
<a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a>    m2mcopy((void *)((u32_t)(fhdscstart-&gt;fhd_intsfsoff) + LDRFILEADR),
<a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a>            (void *)ILDRKRL_PHYADR, (sint_t)fhdscstart-&gt;fhd_frealsz);
<a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a>    return;
<a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a>}
<a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a>//在映像文件中查找对应的文件
<a id="__codelineno-5-41" name="__codelineno-5-41" href="#__codelineno-5-41"></a>fhdsc_t *find_file(char_t *fname)
<a id="__codelineno-5-42" name="__codelineno-5-42" href="#__codelineno-5-42"></a>{
<a id="__codelineno-5-43" name="__codelineno-5-43" href="#__codelineno-5-43"></a>    mlosrddsc_t *mrddadrs = MRDDSC_ADR;
<a id="__codelineno-5-44" name="__codelineno-5-44" href="#__codelineno-5-44"></a>    if (mrddadrs-&gt;mdc_endgic != MDC_ENDGIC ||
<a id="__codelineno-5-45" name="__codelineno-5-45" href="#__codelineno-5-45"></a>        mrddadrs-&gt;mdc_rv != MDC_RVGIC ||
<a id="__codelineno-5-46" name="__codelineno-5-46" href="#__codelineno-5-46"></a>        mrddadrs-&gt;mdc_fhdnr &lt; 2 ||
<a id="__codelineno-5-47" name="__codelineno-5-47" href="#__codelineno-5-47"></a>        mrddadrs-&gt;mdc_filnr &lt; 2)
<a id="__codelineno-5-48" name="__codelineno-5-48" href="#__codelineno-5-48"></a>    {
<a id="__codelineno-5-49" name="__codelineno-5-49" href="#__codelineno-5-49"></a>        error(&quot;no mrddsc&quot;);
<a id="__codelineno-5-50" name="__codelineno-5-50" href="#__codelineno-5-50"></a>    }
<a id="__codelineno-5-51" name="__codelineno-5-51" href="#__codelineno-5-51"></a>    s64_t rethn = -1;
<a id="__codelineno-5-52" name="__codelineno-5-52" href="#__codelineno-5-52"></a>    fhdsc_t *fhdscstart = (fhdsc_t *)((u32_t)(mrddadrs-&gt;mdc_fhdbk_s) + LDRFILEADR);
<a id="__codelineno-5-53" name="__codelineno-5-53" href="#__codelineno-5-53"></a>    for (u64_t i = 0; i &lt; mrddadrs-&gt;mdc_fhdnr; i++)
<a id="__codelineno-5-54" name="__codelineno-5-54" href="#__codelineno-5-54"></a>    {
<a id="__codelineno-5-55" name="__codelineno-5-55" href="#__codelineno-5-55"></a>        if (strcmpl(fname, fhdscstart[i].fhd_name) == 0)
<a id="__codelineno-5-56" name="__codelineno-5-56" href="#__codelineno-5-56"></a>        {
<a id="__codelineno-5-57" name="__codelineno-5-57" href="#__codelineno-5-57"></a>            rethn = (s64_t)i;
<a id="__codelineno-5-58" name="__codelineno-5-58" href="#__codelineno-5-58"></a>            goto ok_l;
<a id="__codelineno-5-59" name="__codelineno-5-59" href="#__codelineno-5-59"></a>        }
<a id="__codelineno-5-60" name="__codelineno-5-60" href="#__codelineno-5-60"></a>    }
<a id="__codelineno-5-61" name="__codelineno-5-61" href="#__codelineno-5-61"></a>    rethn = -1;
<a id="__codelineno-5-62" name="__codelineno-5-62" href="#__codelineno-5-62"></a>ok_l:
<a id="__codelineno-5-63" name="__codelineno-5-63" href="#__codelineno-5-63"></a>    if (rethn &lt; 0)
<a id="__codelineno-5-64" name="__codelineno-5-64" href="#__codelineno-5-64"></a>    {
<a id="__codelineno-5-65" name="__codelineno-5-65" href="#__codelineno-5-65"></a>        error(&quot;not find file&quot;);
<a id="__codelineno-5-66" name="__codelineno-5-66" href="#__codelineno-5-66"></a>    }
<a id="__codelineno-5-67" name="__codelineno-5-67" href="#__codelineno-5-67"></a>    return &amp;fhdscstart[rethn];
<a id="__codelineno-5-68" name="__codelineno-5-68" href="#__codelineno-5-68"></a>}
</code></pre></div>
<p>我们实现了inithead_entry函数，它主要干了两件事，即分别调用write_realintsvefile();、write_ldrkrlfile()函数，把映像文件中的initldrsve.bin文件和initldrkrl.bin文件写入到特定的内存地址空间中，具体地址在上面代码中的宏有详细定义。</p>
<p>这两个函数分别依赖于find_file和m2mcopy函数。</p>
<p>正如其名，find_file函数负责扫描映像文件中的文件头描述符，对比其中的文件名，然后返回对应的文件头描述符的地址，这样就可以得到文件在映像文件中的位置和大小了。</p>
<p>find_file函数的接力队友就是m2mcopy函数，因为查找对比之后，最后就是m2mcopy函数负责把映像文件复制到具体的内存空间里。</p>
<p>代码中的其它函数我就不展开了，感兴趣的同学请自行研究，或者自己改写。</p>
<h2 id="_3">进入二级引导器</h2>
<p>你应该还有印象，刚才说的实现GRUB头这个部分，在imghead.asm汇编文件代码中，我们的最后一条指令是“<strong>jmp 0x200000</strong>”，即跳转到物理内存的0x200000地址处。</p>
<p>请你注意，这时地址还是物理地址，这个地址正是在inithead.c中由write_ldrkrlfile()函数放置的initldrkrl.bin文件，这一跳就进入了二级引导器的主模块了。</p>
<p>由于模块的改变，我们还需要写一小段汇编代码，建立下面这个initldr32.asm（配套代码库中对应ldrkrl32.asm）文件，并写上如下代码。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>_entry:
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    cli
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    lgdt [GDT_PTR]；加载GDT地址到GDTR寄存器
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>    lidt [IDT_PTR]；加载IDT地址到IDTR寄存器
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    jmp dword 0x8 :_32bits_mode；长跳转刷新CS影子寄存器
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>_32bits_mode:
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>    mov ax, 0x10    ; 数据段选择子(目的)
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>    mov ds, ax
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>    mov ss, ax
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>    mov es, ax
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>    mov fs, ax
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>    mov gs, ax
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>    xor eax,eax
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>    xor ebx,ebx
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>    xor ecx,ecx
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>    xor edx,edx
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>    xor edi,edi
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>    xor esi,esi
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>    xor ebp,ebp
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>    xor esp,esp
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>    mov esp,0x90000 ；使得栈底指向了0x90000
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>    call ldrkrl_entry ；调用ldrkrl_entry函数
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>    xor ebx,ebx
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>    jmp 0x2000000 ；跳转到0x2000000的内存地址
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>    jmp $
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>GDT_START:
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>knull_dsc: dq 0
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>kcode_dsc: dq 0x00cf9a000000ffff ;a-e
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a>kdata_dsc: dq 0x00cf92000000ffff
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>k16cd_dsc: dq 0x00009a000000ffff ；16位代码段描述符
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a>k16da_dsc: dq 0x000092000000ffff ；16位数据段描述符
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>GDT_END:
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a>GDT_PTR:
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a>GDTLEN  dw GDT_END-GDT_START-1  ;GDT界限
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a>GDTBASE dd GDT_START
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a>
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a>IDT_PTR:
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a>IDTLEN  dw 0x3ff
<a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a>IDTBAS  dd 0  ；这是BIOS中断表的地址和长度
</code></pre></div>
<p>我来给你做个解读，代码的1～4行是在加载GDTR和IDTR寄存器，然后初始化CPU相关的寄存器。</p>
<p>和先前一样，因为代码模块的改变，所以我们要把GDT、IDT，寄存器这些东西重新初始化，最后再去调用二级引导器的主函数ldrkrl_entry。</p>
<h2 id="bios">巧妙调用BIOS中断</h2>
<p>我们不要急着去写ldrkrl_entry函数，因为在后面我们要获得内存布局信息，要设置显卡图形模式，而这些功能依赖于BIOS提供中断服务。</p>
<p>可是，要在C函数中调用BIOS中断是不可能的，因为C语言代码工作在32位保护模式下，BIOS中断工作在16位的实模式。</p>
<p>所以，C语言环境下调用BIOS中断，需要处理的问题如下：</p>
<p>1.保存C语言环境下的CPU上下文 ，即保护模式下的所有通用寄存器、段寄存器、程序指针寄存器，栈寄存器，把它们都保存在内存中。<br />
2.切换回实模式，调用BIOS中断，把BIOS中断返回的相关结果，保存在内存中。<br />
3.切换回保护模式，重新加载第1步中保存的寄存器。这样C语言代码才能重新恢复执行。</p>
<p>要完成上面的功能，必须要写一个汇编函数才能完成，我们就把它写在ldrkrl32.asm文件中，如下所示 。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>realadr_call_entry:
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    pushad     ;保存通用寄存器
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    push    ds
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    push    es
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    push    fs ;保存4个段寄存器
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    push    gs
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>    call save_eip_jmp ；调用save_eip_jmp 
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>    pop gs
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>    pop fs
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>    pop es      ;恢复4个段寄存器
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>    pop ds
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>    popad       ;恢复通用寄存器
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>    ret
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>save_eip_jmp:
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>    pop esi  ；弹出call save_eip_jmp时保存的eip到esi寄存器中， 
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>    mov [PM32_EIP_OFF],esi ；把eip保存到特定的内存空间中
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>    mov [PM32_ESP_OFF],esp ；把esp保存到特定的内存空间中
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>    jmp dword far [cpmty_mode]；长跳转这里表示把cpmty_mode处的第一个4字节装入eip，把其后的2字节装入cs
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>cpmty_mode:
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>    dd 0x1000
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>    dw 0x18
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>    jmp $
</code></pre></div>
<p>上面的代码我列了详细注释，你一看就能明白。不过这里唯一不好懂的是<strong>jmp dword far [cpmty_mode]指令</strong>，别担心，听我给你解读一下。</p>
<p>其实这个指令是一个<strong>长跳转</strong>，表示把[cpmty_mode]处的数据装入CS：EIP，也就是把0x18：0x1000装入到CS：EIP中。</p>
<p>这个0x18就是段描述索引（这个知识点不熟悉的话，你可以回看我们<a href="https://time.geekbang.org/column/article/375278">第五节课</a>），它正是指向GDT中的16位代码段描述符；0x1000代表段内的偏移地址，所以在这个地址上，我们必须放一段代码指令，不然CPU跳转到这里将没指令可以执行，那样就会发生错误。</p>
<p>因为这是一个16位代码，所以我们需要新建立一个文件realintsve.asm，如下所示。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>[bits 16]
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>_start:
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>_16_mode:
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>    mov bp,0x20 ;0x20是指向GDT中的16位数据段描述符 
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>    mov ds, bp
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    mov es, bp
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>    mov ss, bp
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>    mov ebp, cr0
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>    and ebp, 0xfffffffe
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>    mov cr0, ebp ；CR0.P=0 关闭保护模式
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>    jmp 0:real_entry ；刷新CS影子寄存器，真正进入实模式
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>real_entry:
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>    mov bp, cs
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>    mov ds, bp
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>    mov es, bp
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>    mov ss, bp ；重新设置实模式下的段寄存器 都是CS中值，即为0 
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>    mov sp, 08000h ；设置栈
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>    mov bp,func_table
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>    add bp,ax
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>    call [bp] ；调用函数表中的汇编函数，ax是C函数中传递进来的
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>    cli
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>    call disable_nmi
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>    mov ebp, cr0
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>    or  ebp, 1
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>    mov cr0, ebp ；CR0.P=1 开启保护模式
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>    jmp dword 0x8 :_32bits_mode
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>[BITS 32]
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>_32bits_mode:
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a>    mov bp, 0x10
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>    mov ds, bp
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a>    mov ss, bp；重新设置保护模式下的段寄存器0x10是32位数据段描述符的索引
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a>    mov esi,[PM32_EIP_OFF]；加载先前保存的EIP
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>    mov esp,[PM32_ESP_OFF]；加载先前保存的ESP
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a>    jmp esi ；eip=esi 回到了realadr_call_entry函数中
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a>
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a>func_table:  ;函数表
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a>    dw _getmmap ；获取内存布局视图的函数
<a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a>    dw _read ；读取硬盘的函数
<a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a>    dw _getvbemode ；获取显卡VBE模式 
<a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a>    dw _getvbeonemodeinfo ；获取显卡VBE模式的数据
<a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a>    dw _setvbemode ；设置显卡VBE模式
</code></pre></div>
<p>上面的代码我们只要将它编译成16位的二进制的文件，并把它放在0x1000开始的内存空间中就可以了。这样在realadr_call_entry函数的最后，就运行到这段代码中来了。</p>
<p>上述的代码的流程是这样的：首先从 _16_mode:标号处进入实模式，然后根据传递进来（由ax寄存器传入）的函数号，到函数表中调用对应的函数，里面的函数执行完成后，再次进入保护模式，加载EIP和ESP寄存器从而回到realadr_call_entry函数中。GDT还是imghead.asm汇编代码文件中的GDT，这没有变，因为它是由GDTR寄存器指向的。</p>
<p>说到这里，相信你会立刻明白，之前write_realintsvefile()函数的功能与意义了。它会把<strong>映像文件中的initldrsve.bin文件写入到特定的内存地址空间中</strong>，而initldrsve.bin正是由上面的realintsve.asm文件编译而成的。</p>
<h2 id="_4">二级引导器主函数</h2>
<p>好，现在我们准备得差不多了，从二级引导器的主函数开始，这个函数我们要用C来写，估计你也感受到了写汇编语言的压力，所以不能老是写汇编。</p>
<p>我们先建立一个C文件ldrkrlentry.c，在其中写上一个主函数，代码如下。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>void ldrkrl_entry()
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>{
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    init_bstartparm();
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>    return;
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>}
</code></pre></div>
<p>上述代码中的 ldrkrl_entry()函数在initldr32.asm文件（配套代码库中对应ldrkrl32.asm）中被调用，从那条call ldrkrl_entry 指令开始进入了ldrkrl_entry()函数，在其中调用了<strong>init_bstartparm()函数</strong>，这个函数我们还没有实现，但通过名字我们不难推测，它是负责处理开始参数的。</p>
<p>你还记不记得，我们建造二级引导器的目的，就是要收集机器环境信息。我们要把这些信息形成一个有结构的参数，传递给我们的操作系统内核以备后续使用。</p>
<p>由此，我们能够确定，<strong>init_bstartparm()函数成了收集机器环境信息的主函数</strong>，下节课我们就会去实现它。</p>
<h2 id="_5">重点回顾</h2>
<p>今天我们开始实现二级引导器了，但是我们还没有完全实现，我们下一节课再接着继续这项工作。</p>
<p>现在，我们来梳理一下这节课的内容，回顾一下我们今天的成果。</p>
<p>1.我们设计了机器信息结构，用于存放后面二级引导器收集到的机器信息。<br />
2.对二级引导器代码模块进行了规划，确定各模块的主要功能。<br />
3.实现了GRUB规定的GRUB头，以便被GRUB识别，在GRUB头中初始化了CPU寄存器，并且跳转到物理内存的0x200000地址处，真正进入到二级引导器中开始运行。<br />
4.为了二级引导器能够调用BIOS中断服务程序，我们实现了专门用来完成调用BIOS中断服务程序的realintsve.asm模块。<br />
5.最后，我们实现了二级引导器的主函数，由它调用完成其它功能的函数。</p>
<p>这里我还想聊聊，为什么我们要花这么多功夫，去设计二级引导器这个组件呢？</p>
<p>我们把这些处理操作系统运行环境的工作独立出来，交给二级引导器来做，这会<strong>大大降低后面开发操作系统的难度，也能增加操作系统的通用性。</strong>而且，针对不同的硬件平台，我们只要开发不同的二级引导器就好了。</p>
<h2 id="_6">思考题</h2>
<p>请问GRUB头中为什么需要_entry标号和_start标号的地址？</p>
<p>欢迎你在留言区跟我交流活动。如果你身边的同事、朋友，对二级引导器的建立有兴趣，也欢迎你把这节课分享给他。</p>
<p>好，我是LMOS，我们下节课见！</p>
<div><strong>精选留言（15）</strong></div>
<ul>
<li><span>嗣树</span> 👍（6） 💬（3）<p>回答一下问题，GRUB 头中为什么需要 _entry 标号和 _start 标号的地址？

我们定义的 flags 值为：
MBT_HDR_FLAGS EQU 0x00010003

根据 Multiboot Specification 定义的头结构
Offset  Type    Field Name      Note
0       u32     magic           required
4       u32     flags           required
8       u32     checksum        required
12      u32     header_addr     if flags[16] is set
16      u32     load_addr               if flags[16] is set
20      u32     load_end_addr           if flags[16] is set
24      u32     bss_end_addr            if flags[16] is set
28      u32     entry_addr      if flags[16] is set
32      u32     mode_type       if flags[2] is set
36      u32     width           if flags[2] is set
40      u32     height          if flags[2] is set
44      u32     depth           if flags[2] is set

flags[16] 解释如下：
If bit 16 in the ‘flags’ word is set, then the fields at offsets 12-28 in the Multiboot header are valid, and the boot loader should use them instead of the fields in the actual executable header to calculate where to load the OS image. This information does not need to be provided if the kernel image is in ELF format, but it must be provided if the images is in a.out format or in some other format. Compliant boot loaders must be able to load images that either are in ELF format or contain the load address information embedded in the Multiboot header; they may also directly support other executable formats, such as particular a.out variants, but are not required to.

也就是如果我们用的是标准的 ELF 文件就不需要提供额外的地址信息，而我们用的是自己定义的格式就需要人家从哪里加载哪里运行，所以需要将 bit 16 使能，填充相应的字段。

再解释下两个字段的含义：
load_addr
Contains the physical address of the beginning of the text segment. The offset in the OS image file at which to start loading is defined by the offset at which the header was found, minus (header_addr - load_addr). load_addr must be less than or equal to header_addr.

entry_addr
The physical address to which the boot loader should jump in order to start running the operating system.</p>2021-06-03</li><br/><li><span>neohope</span> 👍（91） 💬（16）<p>大体上整理了一下：

1、grub启动后，选择对应的启动菜单项，grub会通过自带文件系统驱动，定位到对应的eki文件

2、grub会尝试加载eki文件【eki文件需要满足grub多协议引导头的格式要求】
这些是在imginithead.asm中实现的，所以要包括：
A、grub文件头，包括魔数、grub1和grub2支持等
B、定位的_start符号等

3、grub校验成功后，会调用_start，然跳转到_entry
A、_entry中:关闭中断
B、加载GDT
C、然后进入_32bits_mode，清理寄存器，设置栈顶
D、调用inithead_entry【C】

4、inithead_entry.c
A、从imginithead.asm进入后，首先进入函数调用inithead_entry
B、初始化光标，清屏
C、从eki文件内部，找到initldrsve.bin文件，并分别拷贝到内存的指定物理地址
D、从eki文件内部，找到initldrkrl.bin文件，并分别拷贝到内存的指定物理地址
E、返回imginithead.asm

5、imginithead.asm中继续执行
jmp 0x200000
而这个位置，就是initldrkrl.bin在内存的位置ILDRKRL_PHYADR
所以后面要执行initldrkrl.bin的内容

6、这样就到了ldrkrl32.asm的_entry
A、将GDT加载到GDTR寄存器【内存】
B、将IDT加载到IDTR寄存器【中断】
C、跳转到_32bits_mode
初始寄存器
初始化栈
调用ldrkrl_entry【C】

7、ldrkrlentry.c
A、初始化光标，清屏
B、收集机器参数init_bstartparm【C】

8、bstartparm.c
A、初始化machbstart_t
B、各类初始化函数，填充machbstart_t的内容
C、返回

9、ldrkrlentry.c
A、返回

10、ldrkrl32.asm
A、跳转到0x2000000地址继续执行</p>2021-06-02</li><br/><li><span>springXu</span> 👍（20） 💬（3）<p>真实进入实际写代码的课程了。
对于grub的头格式在的第二节写个HelloOS.bin就已经有了，这次头格式还是会有。理由是grub是一级引导器。
这节课的内容就是围绕着由一级转到二级引导器的过程展开了。
关于二级引导器的加载过程，简单点说就是把我们内核加载到指定内存的位置并执行，这个加载函数核心是m2mcopy函数，东哥留给我们自己分析了，但东哥强调分析了下为什么会有32位下的代码和16位汇编代码共存的现象。 其实是为了让BIOS提供的获取硬件信息的操作函数（也就是实模式下的BIOS中断号来获取的）做成了c语言环境下也可以调用的功能。这就像跨语言互相调用的技术。汇编调用c语言的方法，反过来c语言调用汇编方法。但更为复杂些，原因是保护模式到实模式再回到保护模式的切换过程。内核可以获取硬件信息就可以根据硬件环境参数，配置自身参数开始工作了。如何配置参数，那又是下节继续播讲。周五见。
关于思考题，这个是grub也是要把控制权交给我们二级引导器的入口地址。 至于为什么不光有一个_start就可以了，我猜测是为了做验证吧。_start的操作是jmp 地址。这个地址正好是_entry。有错误还请东哥指正。哈哈</p>2021-06-02</li><br/><li><span>pedro</span> 👍（17） 💬（5）<p>早起看专栏！
先回答思考题，grub是multiboot规范，因此引导器头部数据必须得满足一定的规则才能被grub所加载，本文中的MBT_HDR_FLAGS为0x001003，第16位被置为1，因此load_addr和entry_addr都是有效的，而它们正好分别对应_start和_entry。
其中load_addr是引导器二进制文件text段的起始地址，即_start，grub解析头部数据后，拿到_start地址，并从该地址处开始执行二级引导器代码。
而entry_addr对应的是操作系统的入口点，也就是_entry。引导程序最后将跳转到这里，不过本文的实现并没有完全按照这种思路来，_start直接跳到_entry，然后由_entry负责二级引导工作。</p>2021-06-02</li><br/><li><span>Amerny</span> 👍（13） 💬（1）<p>感觉代码也看不懂，稀里糊涂的，是不是得需要把代码看懂了才能进行下一步呀，脑子不够用了</p>2021-09-18</li><br/><li><span>晶</span> 👍（6） 💬（1）<p>对应grub2的代码定义结构：
struct multiboot_header
{
  multiboot_uint32_t magic; &#47;&#47; 魔数 0xE85250D6      
  multiboot_uint32_t architecture; &#47;&#47; 架构 0表示x86
  multiboot_uint32_t header_length; &#47;&#47; 表示mb header 长度
  multiboot_uint32_t checksum; &#47;&#47; 校验和
};

在 之后是multiboot_header_tag，
struct multiboot_header_tag_address
{
    multiboot_uint16_t type;    &#47;&#47; 2 表示  multiboot_header_tag_address
    multiboot_uint16_t flags;   &#47;&#47; 0 
    multiboot_uint32_t size;    &#47;&#47; 24
    multiboot_uint32_t header_addr;  &#47;&#47; mbhdr
    multiboot_uint32_t load_addr;    &#47;&#47; _start
    multiboot_uint32_t load_end_addr; &#47;&#47; 0 表示数据段 和 代码段一样 占用整个空间
    multiboot_uint32_t bss_end_addr;  &#47;&#47; 0 
};

再之后是 multiboot_header_tag_entry_address
struct multiboot_header_tag_entry_address
{
  multiboot_uint16_t type;  &#47;&#47; type = 3 表示 multiboot_header_tag_entry_address
  multiboot_uint16_t flags; 
  multiboot_uint32_t size;
  multiboot_uint32_t entry_addr;
};

mbhdr:
    DD  0xE85250D6    magic
    DD  0  architecture
    DD  mhdrend - mbhdr    header_length
    DD  -(0xE85250D6 + 0 + (mhdrend - mbhdr))     checksum

  ；multiboot_header_tag
    DW  2, 0    ; type = 2 ;flag  = 0;
    DD  24      ; size =24
    DD  mbhdr
    DD  _start
    DD  0
    DD  0

  ;multiboot_header_tag_entry_address
    DW  3, 0    ;;type = 3 flag = 0
    DD  12
    DD  _entry  ; entry_addr = _entry  

  ;
    DD      0  
    DW  0, 0
    DD  8</p>2021-08-24</li><br/><li><span>沈畅</span> 👍（5） 💬（1）<p>如果我们不用grub作为引导程序，自己写一个引导程序，在实模式下，是不是就可以直接调用bois中断收集硬件信息，而不需要后面在保护模式下切换回实模式，再收集？</p>2021-08-15</li><br/><li><span>熊光红</span> 👍（5） 💬（4）<p>请问老师，如何调试内核？怎么搭建调试环境</p>2021-06-03</li><br/><li><span>Qfeng</span> 👍（4） 💬（1）<p>这篇文章开始烧脑了，全文汇编，第一次看这篇云里雾里不知所云，汇编基础差决心回头花了3个礼拜啃完了《汇编原理》，这周再次看这篇又理解了些。
和《汇编原理》书上介绍的8086不同，这篇里面是32位的x86，不过底层原理差不多。

对着这篇文章结合源码，画了一份visio流程图，流程上清晰了些，总结如下：
1. 实现了被GRUB识别的GRUB Head，GRUB Head里面做了2件事：
1）inithead.c，从内存中查找和拷贝2个bin文件（二级引导器和BIOS中断服务程序的bin文件）到指定位置；
2）跳转到物理地址0x200000执行二级引导器代码（第一步已经将机器码拷贝到这里）。

2. 二级引导器 ldrkrl32.asm (0x200000)
1）引导主函数ldrkrl_entry()   （暂未实现）；
2）准备BIOS中断服务程序调用框架，核心是通过 jmp 0x18:0x1000 跳转到 BIOS中断服务程序（readintsve.asm）所在位置执行。

3. BIOS终端服务程序 readintsve.asm (0x18:0x1000)
1）首先进入16位实模式；
2）实模式下，有一个func_table，通过这些函数可以获取内存、硬盘和显卡等硬件信息；
3）最后返回32位保护模式，恢复进入前保存的EIS+EIP返回调用前的32位保护模式状态。

思考题：_start和_entry的用途是GRUB用来识别硬件厂商客制化的GRUB头的，作为厂商二级引导器的入口，详细信息上面已经有很多大佬解释的很详细就不写了。</p>2022-05-08</li><br/><li><span>Geek_e42826</span> 👍（2） 💬（2）<p>make 报错指南
1, 需要先安装nasm。sudo apt install nasm 
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">hello</span><span class="err">@</span><span class="n">hello</span><span class="o">-</span><span class="n">VirtualBox</span><span class="o">:~&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="mo">01</span><span class="n">OS</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="mo">01</span><span class="n">HelloOS</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">cosmos</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">lesson10</span><span class="o">~</span><span class="mi">11</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">Cosmos$</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">all</span><span class="w"> </span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="n">清理全部已构建文件</span><span class="p">...</span><span class="w"> </span><span class="o">^</span><span class="n">_</span><span class="o">^</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="o">*********</span><span class="n">正在开始编译构建系统</span><span class="o">*************</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="n">make</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="n">nasm</span><span class="o">:</span><span class="w"> </span><span class="n">没有那个文件或目录</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="n">make</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="o">***</span><span class="w"> </span><span class="p">[</span><span class="n">krnlbuidrule</span><span class="p">.</span><span class="n">mh</span><span class="o">:</span><span class="mi">10</span><span class="err">：</span><span class="n">imginithead</span><span class="p">.</span><span class="n">o</span><span class="p">]</span><span class="w"> </span><span class="n">错误</span><span class="w"> </span><span class="mi">127</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="n">make</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="o">***</span><span class="w"> </span><span class="p">[</span><span class="n">Makefile</span><span class="o">:</span><span class="mi">27</span><span class="err">：</span><span class="n">all</span><span class="p">]</span><span class="w"> </span><span class="n">错误</span><span class="w"> </span><span class="mi">2</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="n">make</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="o">***</span><span class="w"> </span><span class="p">[</span><span class="n">Makefile</span><span class="p">.</span><span class="n">x86</span><span class="o">:</span><span class="mi">22</span><span class="err">：</span><span class="n">all</span><span class="p">]</span><span class="w"> </span><span class="n">错误</span><span class="w"> </span><span class="mi">2</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="nl">make</span><span class="p">:</span><span class="w"> </span><span class="o">***</span><span class="w"> </span><span class="p">[</span><span class="n">Makefile</span><span class="o">:</span><span class="mi">58</span><span class="err">：</span><span class="n">all</span><span class="p">]</span><span class="w"> </span><span class="n">错误</span><span class="w"> </span><span class="mi">2</span>
</code></pre></div>
2，需要安装gcc。sudo apt install gcc
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">hello</span><span class="err">@</span><span class="n">hello</span><span class="o">-</span><span class="n">VirtualBox</span><span class="o">:~&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="mo">01</span><span class="n">OS</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="mo">01</span><span class="n">HelloOS</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">cosmos</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">lesson10</span><span class="o">~</span><span class="mi">11</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">Cosmos$</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">all</span><span class="w"> </span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="n">清理全部已构建文件</span><span class="p">...</span><span class="w"> </span><span class="o">^</span><span class="n">_</span><span class="o">^</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="o">*********</span><span class="n">正在开始编译构建系统</span><span class="o">*************</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="n">AS</span><span class="w"> </span><span class="o">-</span><span class="p">[</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="n">正在构建</span><span class="p">...</span><span class="w"> </span><span class="p">..</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">ldrkrl</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">imginithead</span><span class="p">.</span><span class="k">asm</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="n">make</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="n">gcc</span><span class="o">:</span><span class="w"> </span><span class="n">没有那个文件或目录</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="n">make</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="o">***</span><span class="w"> </span><span class="p">[</span><span class="n">krnlbuidrule</span><span class="p">.</span><span class="n">mh</span><span class="o">:</span><span class="mi">13</span><span class="err">：</span><span class="n">inithead</span><span class="p">.</span><span class="n">o</span><span class="p">]</span><span class="w"> </span><span class="n">错误</span><span class="w"> </span><span class="mi">127</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="n">make</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="o">***</span><span class="w"> </span><span class="p">[</span><span class="n">Makefile</span><span class="o">:</span><span class="mi">27</span><span class="err">：</span><span class="n">all</span><span class="p">]</span><span class="w"> </span><span class="n">错误</span><span class="w"> </span><span class="mi">2</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="n">make</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="o">***</span><span class="w"> </span><span class="p">[</span><span class="n">Makefile</span><span class="p">.</span><span class="n">x86</span><span class="o">:</span><span class="mi">22</span><span class="err">：</span><span class="n">all</span><span class="p">]</span><span class="w"> </span><span class="n">错误</span><span class="w"> </span><span class="mi">2</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="nl">make</span><span class="p">:</span><span class="w"> </span><span class="o">***</span><span class="w"> </span><span class="p">[</span><span class="n">Makefile</span><span class="o">:</span><span class="mi">58</span><span class="err">：</span><span class="n">all</span><span class="p">]</span><span class="w"> </span><span class="n">错误</span><span class="w"> </span><span class="mi">2</span>
</code></pre></div>

3、make成功显示如下
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">hello</span><span class="err">@</span><span class="n">hello</span><span class="o">-</span><span class="n">VirtualBox</span><span class="o">:~&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="mo">01</span><span class="n">OS</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="mo">01</span><span class="n">HelloOS</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">cosmos</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">lesson10</span><span class="o">~</span><span class="mi">11</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">Cosmos$</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">all</span><span class="w"> </span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="n">清理全部已构建文件</span><span class="p">...</span><span class="w"> </span><span class="o">^</span><span class="n">_</span><span class="o">^</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="o">*********</span><span class="n">正在开始编译构建系统</span><span class="o">*************</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="n">AS</span><span class="w"> </span><span class="o">-</span><span class="p">[</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="n">正在构建</span><span class="p">...</span><span class="w"> </span><span class="p">..</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">ldrkrl</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">imginithead</span><span class="p">.</span><span class="k">asm</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="n">CC</span><span class="w"> </span><span class="o">-</span><span class="p">[</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="n">正在构建</span><span class="p">...</span><span class="w"> </span><span class="p">..</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">ldrkrl</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">inithead</span><span class="p">.</span><span class="n">c</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="n">CC</span><span class="w"> </span><span class="o">-</span><span class="p">[</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="n">正在构建</span><span class="p">...</span><span class="w"> </span><span class="p">..</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">ldrkrl</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">vgastr</span><span class="p">.</span><span class="n">c</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="n">AS</span><span class="w"> </span><span class="o">-</span><span class="p">[</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="n">正在构建</span><span class="p">...</span><span class="w"> </span><span class="p">..</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">ldrkrl</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">ldrkrl32</span><span class="p">.</span><span class="k">asm</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="n">CC</span><span class="w"> </span><span class="o">-</span><span class="p">[</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="n">正在构建</span><span class="p">...</span><span class="w"> </span><span class="p">..</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">ldrkrl</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">ldrkrlentry</span><span class="p">.</span><span class="n">c</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="n">CC</span><span class="w"> </span><span class="o">-</span><span class="p">[</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="n">正在构建</span><span class="p">...</span><span class="w"> </span><span class="p">..</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">ldrkrl</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">fs</span><span class="p">.</span><span class="n">c</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="n">CC</span><span class="w"> </span><span class="o">-</span><span class="p">[</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="n">正在构建</span><span class="p">...</span><span class="w"> </span><span class="p">..</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">ldrkrl</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">chkcpmm</span><span class="p">.</span><span class="n">c</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="n">CC</span><span class="w"> </span><span class="o">-</span><span class="p">[</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="n">正在构建</span><span class="p">...</span><span class="w"> </span><span class="p">..</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">ldrkrl</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">graph</span><span class="p">.</span><span class="n">c</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="n">CC</span><span class="w"> </span><span class="o">-</span><span class="p">[</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="n">正在构建</span><span class="p">...</span><span class="w"> </span><span class="p">..</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">ldrkrl</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">bstartparm</span><span class="p">.</span><span class="n">c</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="n">AS</span><span class="w"> </span><span class="o">-</span><span class="p">[</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="n">正在构建</span><span class="p">...</span><span class="w"> </span><span class="p">..</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">ldrkrl</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">realintsve</span><span class="p">.</span><span class="k">asm</span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="n">OBJCOPY</span><span class="w"> </span><span class="o">-</span><span class="p">[</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="n">正在构建</span><span class="p">...</span><span class="w"> </span><span class="n">initldrimh</span><span class="p">.</span><span class="n">bin</span>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="n">OBJCOPY</span><span class="w"> </span><span class="o">-</span><span class="p">[</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="n">正在构建</span><span class="p">...</span><span class="w"> </span><span class="n">initldrkrl</span><span class="p">.</span><span class="n">bin</span>
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="n">OBJCOPY</span><span class="w"> </span><span class="o">-</span><span class="p">[</span><span class="n">M</span><span class="p">]</span><span class="w"> </span><span class="n">正在构建</span><span class="p">...</span><span class="w"> </span><span class="n">initldrsve</span><span class="p">.</span><span class="n">bin</span>
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="n">文件数</span><span class="err">：</span><span class="mi">2</span>
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="n">映像文件大小</span><span class="err">：</span><span class="mi">20480</span>
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a><span class="n">恭喜我</span><span class="err">，</span><span class="n">系统编译构建完成</span><span class="err">！</span><span class="w"> </span><span class="o">^</span><span class="n">_</span><span class="o">^</span>
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a><span class="n">恭喜我</span><span class="err">，</span><span class="n">系统编译构建完成</span><span class="err">！</span><span class="w"> </span><span class="o">^</span><span class="n">_</span><span class="o">^</span>
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a><span class="n">恭喜我</span><span class="err">，</span><span class="n">系统编译构建完成</span><span class="err">！</span><span class="w"> </span><span class="o">^</span><span class="n">_</span><span class="o">^</span>
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a><span class="n">hello</span><span class="err">@</span><span class="n">hello</span><span class="o">-</span><span class="n">VirtualBox</span><span class="o">:~&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="mo">01</span><span class="n">OS</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="mo">01</span><span class="n">HelloOS</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">cosmos</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">47</span><span class="p">;</span><span class="n">less</span>
</code></pre></div>
</p>2021-12-07</li><br/><li><span>Jayying</span> 👍（2） 💬（1）<p>不大会汇编语言，感觉看汇编还有些难度</p>2021-07-31</li><br/><li><span>🎋 🎋 🎋</span> 👍（2） 💬（1）<p>老师 lmoskrlimg：未找到命令   是为什么呀</p>2021-07-27</li><br/><li><span>Geek_032c4a</span> 👍（2） 💬（1）<p>请问下lmoskrlimg源代码是哪个，我搜了一圈没看到工具的源代码，是只给了个二进制吗？</p>2021-06-17</li><br/><li><span>blentle</span> 👍（2） 💬（1）<p>越来越有意思了</p>2021-06-02</li><br/><li><span>X</span> 👍（1） 💬（2）<p>make 老师给的工具的时候各种问题啊。

第一个问题：
&#47;usr&#47;include&#47;features.h:367:25: fatal error: sys&#47;cdefs.h: No such file or directory
解决方法：
第一步：sudo apt-get –fix-broken install；
第二步：sudo apt-get install libc6-dev-i386；

问题出现原因是老师这个工具依赖的库文件是32位库，自己的虚拟机是64位库。

第二个问题：
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `lmoskrlimg.o&#39; is incompatible with i386 output
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `imgcore.o&#39; is incompatible with i386 output
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `imgmgrhead.o&#39; is incompatible with i386 output
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `param.o&#39; is incompatible with i386 output
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `file.o&#39; is incompatible with i386 output
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `imgundo.o&#39; is incompatible with i386 output
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `memdisk.o&#39; is incompatible with i386 output
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `mem.o&#39; is incompatible with i386 output
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `limgerror.o&#39; is incompatible with i386 output
老师工具编译之后输出的编译文件 *.o 是32位的，可是我自己虚拟机是64位的架构，ld连接器连接不上。
有点无语，一通百度是gcc的时候要加上 -m32，可是找不到老师是在哪里gcc的……


</p>2022-07-28</li><br/>
</ul>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../10%20-%20%E8%AE%BE%E7%BD%AE%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F%E4%B8%8E%E7%8E%AF%E5%A2%83%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9A%E5%BB%BA%E7%AB%8B%E8%AE%A1%E7%AE%97%E6%9C%BA/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 10   设置工作模式与环境（上）：建立计算机">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                10   设置工作模式与环境（上）：建立计算机
              </div>
            </div>
          </a>
        
        
          
          <a href="../12%20-%20%E8%AE%BE%E7%BD%AE%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F%E4%B8%8E%E7%8E%AF%E5%A2%83%EF%BC%88%E4%B8%8B%EF%BC%89%EF%BC%9A%E6%8E%A2%E6%9F%A5%E5%92%8C%E6%94%B6%E9%9B%86%E4%BF%A1%E6%81%AF/" class="md-footer__link md-footer__link--next" aria-label="下一页: 12   设置工作模式与环境（下）：探查和收集信息">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                12   设置工作模式与环境（下）：探查和收集信息
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © 2025-Present zkep
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.annotate", "content.code.copy", "content.tooltips", "toc.follow", "navigation.top", "navigation.tabs", "navigation.tabs.sticky", "navigation.prune", "navigation.footer", "navigation.tracking", "navigation.instant", "navigation.instant.progress", "navigation.indexes", "content.tabs.link"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
        <script src="../../../javascript/extra.js"></script>
      
        <script src="../../../javascript/giscus.js"></script>
      
    
  </body>
</html>