ä½ å¥½ï¼Œæˆ‘æ˜¯LMOSã€‚

ä¸ŠèŠ‚è¯¾ï¼Œæˆ‘ä»¬å»ºé€ äº†å±äºæˆ‘ä»¬çš„â€œè®¡ç®—æœºâ€ï¼Œå¹¶ä¸”åœ¨ä¸Šé¢å®‰è£…å¥½äº†GRUBã€‚è¿™èŠ‚è¯¾æˆ‘ä¼šå¸¦ä½ ä¸€èµ·å®ç°äºŒçº§å¼•å¯¼å™¨è¿™ä¸ªå…³é”®ç»„ä»¶ã€‚

çœ‹åˆ°è¿™å„¿ä½ å¯èƒ½ä¼šé—®ï¼ŒGRUBä¸æ˜¯å·²ç»æŠŠæˆ‘ä»¬çš„æ“ä½œç³»ç»ŸåŠ è½½åˆ°å†…å­˜ä¸­äº†å—ï¼Ÿæˆ‘ä»¬æœ‰äº†GRUBï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¿˜è¦å®ç°äºŒçº§å¼•å¯¼å™¨å‘¢ï¼Ÿ

è¿™é‡Œæˆ‘è¦ç»™ä½ è¯´è¯´æˆ‘çš„è§‚ç‚¹ï¼ŒäºŒçº§å¼•å¯¼å™¨ä½œä¸ºæ“ä½œç³»ç»Ÿçš„å…ˆé©±ï¼Œå®ƒéœ€è¦**æ”¶é›†æœºå™¨ä¿¡æ¯**ï¼Œç¡®å®šè¿™ä¸ªè®¡ç®—æœºèƒ½ä¸èƒ½è¿è¡Œæˆ‘ä»¬çš„æ“ä½œç³»ç»Ÿï¼Œå¯¹CPUã€å†…å­˜ã€æ˜¾å¡è¿›è¡Œä¸€äº›åˆçº§çš„é…ç½®ï¼Œæ”¾ç½®å¥½å†…æ ¸ç›¸å…³çš„æ–‡ä»¶ã€‚

å› ä¸ºæˆ‘ä»¬äºŒçº§å¼•å¯¼å™¨ä¸æ˜¯æ‰§è¡Œå…·ä½“çš„åŠ è½½ä»»åŠ¡çš„ï¼Œè€Œæ˜¯è§£æå†…æ ¸æ–‡ä»¶ã€æ”¶é›†æœºå™¨ç¯å¢ƒä¿¡æ¯ï¼Œå®ƒå…·ä½“æ”¶é›†å“ªäº›ä¿¡æ¯ï¼Œæˆ‘ä¼šåœ¨ä¸‹èŠ‚è¯¾è¯¦ç»†å±•å¼€ã€‚

## è®¾è®¡æœºå™¨ä¿¡æ¯ç»“æ„

äºŒçº§å¼•å¯¼å™¨æ”¶é›†çš„ä¿¡æ¯ï¼Œéœ€è¦åœ°ç‚¹å­˜æ”¾ï¼Œæˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€ä¸ªæ•°æ®ç»“æ„ã€‚ä¿¡æ¯æ”¾åœ¨è¿™ä¸ªæ•°æ®ç»“æ„ä¸­ï¼Œè¿™ä¸ªç»“æ„æ”¾åœ¨å†…å­˜1MBçš„åœ°æ–¹ï¼Œæ–¹ä¾¿ä»¥åä¼ ç»™æˆ‘ä»¬çš„æ“ä½œç³»ç»Ÿã€‚

ä¸ºäº†è®©ä½ æŠ“ä½é‡ç‚¹ï¼Œæˆ‘é€‰å–äº†è¿™ä¸ªæ•°æ®ç»“æ„çš„**å…³é”®ä»£ç **ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰åˆ—å‡ºè¯¥ç»“æ„çš„æ‰€æœ‰å­—æ®µï¼ˆCosmos/initldr/include/ldrtype.hï¼‰ï¼Œè¿™ä¸ªç»“æ„å¦‚ä¸‹æ‰€ç¤ºã€‚

```
typedef struct s_MACHBSTART
{
    u64_t   mb_krlinitstack;//å†…æ ¸æ ˆåœ°å€
    u64_t   mb_krlitstacksz;//å†…æ ¸æ ˆå¤§å°
    u64_t   mb_imgpadr;//æ“ä½œç³»ç»Ÿæ˜ åƒ
    u64_t   mb_imgsz;//æ“ä½œç³»ç»Ÿæ˜ åƒå¤§å°
    u64_t   mb_bfontpadr;//æ“ä½œç³»ç»Ÿå­—ä½“åœ°å€
    u64_t   mb_bfontsz;//æ“ä½œç³»ç»Ÿå­—ä½“å¤§å°
    u64_t   mb_fvrmphyadr;//æœºå™¨æ˜¾å­˜åœ°å€
    u64_t   mb_fvrmsz;//æœºå™¨æ˜¾å­˜å¤§å°
    u64_t   mb_cpumode;//æœºå™¨CPUå·¥ä½œæ¨¡å¼
    u64_t   mb_memsz;//æœºå™¨å†…å­˜å¤§å°
    u64_t   mb_e820padr;//æœºå™¨e820æ•°ç»„åœ°å€
    u64_t   mb_e820nr;//æœºå™¨e820æ•°ç»„å…ƒç´ ä¸ªæ•°
    u64_t   mb_e820sz;//æœºå™¨e820æ•°ç»„å¤§å°
    //â€¦â€¦
    u64_t   mb_pml4padr;//æœºå™¨é¡µè¡¨æ•°æ®åœ°å€
    u64_t   mb_subpageslen;//æœºå™¨é¡µè¡¨ä¸ªæ•°
    u64_t   mb_kpmapphymemsz;//æ“ä½œç³»ç»Ÿæ˜ å°„ç©ºé—´å¤§å°
    //â€¦â€¦
    graph_t mb_ghparm;//å›¾å½¢ä¿¡æ¯
}__attribute__((packed)) machbstart_t;
```

## è§„åˆ’äºŒçº§å¼•å¯¼å™¨

åœ¨å¼€å§‹å†™ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥ä»æ•´ä½“åˆ’åˆ†ä¸€ä¸‹äºŒçº§å¼•å¯¼å™¨çš„åŠŸèƒ½æ¨¡å—ï¼Œä»å…¨å±€äº†è§£ä¸‹åŠŸèƒ½åº”è¯¥æ€ä¹ˆåˆ’åˆ†ï¼Œè¿™é‡Œæˆ‘ç‰¹æ„ä¸ºä½ æ¢³ç†äº†ä¸€ä¸ªè¡¨æ ¼ã€‚

![](https://static001.geekbang.org/resource/image/31/1e/3169e9db4549ab036c2de269788a281e.jpg?wh=1636%2A846 "äºŒçº§å¼•å¯¼å™¨åŠŸèƒ½åˆ’åˆ†è¡¨")

å‰é¢è¡¨æ ¼é‡Œçš„è¿™äº›æ–‡ä»¶ï¼Œæˆ‘éƒ½æ”¾åœ¨äº†è¯¾ç¨‹é…å¥—æºç ä¸­äº†ï¼Œä½ å¯ä»¥ä»[è¿™é‡Œ](https://gitee.com/lmos/cosmos/tree/master/lesson10~11)ä¸‹è½½ã€‚

ä¸Šè¿°è¿™äº›æ–‡ä»¶éƒ½åœ¨lesson10ï½11/Cosmos/initldr/ldrkrlç›®å½•ä¸­ï¼Œå®ƒä»¬åœ¨ç¼–è¯‘ä¹‹åä¼šå½¢æˆä¸‰ä¸ªæ–‡ä»¶ï¼Œç¼–è¯‘è„šæœ¬æˆ‘å·²ç»å†™å¥½äº†ï¼Œä¸‹é¢æˆ‘ä»¬ç”¨ä¸€å¹…å›¾æ¥å±•ç¤ºè¿™ä¸ªç¼–è¯‘è¿‡ç¨‹ã€‚

![](https://static001.geekbang.org/resource/image/bd/40/bd55f67d02edff4415f06c914403bc40.jpg?wh=5005%2A3110 "äºŒçº§å¼•å¯¼å™¨ç¼–è¯‘è¿‡ç¨‹ç¤ºæ„å›¾")

è¿™æœ€åä¸‰ä¸ªæ–‡ä»¶ç”¨æˆ‘ä»¬å‰é¢è¯´çš„æ˜ åƒå·¥å…·æ‰“åŒ…æˆæ˜ åƒæ–‡ä»¶ï¼Œå…¶æŒ‡ä»¤å¦‚ä¸‹ã€‚

```
lmoskrlimg -m k -lhf initldrimh.bin -o Cosmos.eki -f initldrkrl.bin initldrsve.bin
```

## å®ç°GRUBå¤´

æˆ‘ä»¬çš„GRUBå¤´æœ‰ä¸¤ä¸ªæ–‡ä»¶ç»„æˆï¼Œ**ä¸€ä¸ªimginithead.asmæ±‡ç¼–æ–‡ä»¶**ï¼Œå®ƒæœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼Œæ—¢èƒ½è®©GRUBè¯†åˆ«ï¼Œåˆèƒ½è®¾ç½®Cè¯­è¨€è¿è¡Œç¯å¢ƒï¼Œç”¨äºè°ƒç”¨Cå‡½æ•°ï¼›**ç¬¬äºŒå°±æ˜¯inithead.cæ–‡ä»¶**ï¼Œå®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯æŸ¥æ‰¾äºŒçº§å¼•å¯¼å™¨çš„æ ¸å¿ƒæ–‡ä»¶â€”â€”initldrkrl.binï¼Œç„¶åæŠŠå®ƒæ”¾ç½®åˆ°ç‰¹å®šçš„å†…å­˜åœ°å€ä¸Šã€‚

æˆ‘ä»¬å…ˆæ¥å®ç°imginithead.asmï¼Œå®ƒä¸»è¦å·¥ä½œæ˜¯åˆå§‹åŒ–CPUçš„å¯„å­˜å™¨ï¼ŒåŠ è½½GDTï¼Œåˆ‡æ¢åˆ°CPUçš„ä¿æŠ¤æ¨¡å¼ï¼Œæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥å®ç°ã€‚

é¦–å…ˆæ˜¯GRUB1å’ŒGRUB2éœ€è¦çš„ä¸¤ä¸ªå¤´ç»“æ„ï¼Œä»£ç å¦‚ä¸‹ã€‚

```
MBT_HDR_FLAGS	EQU 0x00010003
MBT_HDR_MAGIC	EQU 0x1BADB002
MBT2_MAGIC	EQU 0xe85250d6
global _start
extern inithead_entry
[section .text]
[bits 32]
_start:
	jmp _entry
align 4
mbt_hdr:
	dd MBT_HDR_MAGIC
	dd MBT_HDR_FLAGS
	dd -(MBT_HDR_MAGIC+MBT_HDR_FLAGS)
	dd mbt_hdr
	dd _start
	dd 0
	dd 0
	dd _entry
ALIGN 8
mbhdr:
	DD	0xE85250D6
	DD	0
	DD	mhdrend - mbhdr
	DD	-(0xE85250D6 + 0 + (mhdrend - mbhdr))
	DW	2, 0
	DD	24
	DD	mbhdr
	DD	_start
	DD	0
	DD	0
	DW	3, 0
	DD	12
	DD	_entry 
	DD  0  
	DW	0, 0
	DD	8
mhdrend:
```

ç„¶åæ˜¯å…³ä¸­æ–­å¹¶åŠ è½½GDTï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚

```
_entry:
	cli           ï¼›å…³ä¸­æ–­
	in al, 0x70 
	or al, 0x80	
	out 0x70,al  ï¼›å…³æ‰ä¸å¯å±è”½ä¸­æ–­   
	lgdt [GDT_PTR] ï¼›åŠ è½½GDTåœ°å€åˆ°GDTRå¯„å­˜å™¨
	jmp dword 0x8 :_32bits_mode ï¼›é•¿è·³è½¬åˆ·æ–°CSå½±å­å¯„å­˜å™¨
  ;â€¦â€¦â€¦â€¦â€¦â€¦
;GDTå…¨å±€æ®µæè¿°ç¬¦è¡¨
GDT_START:
knull_dsc: dq 0
kcode_dsc: dq 0x00cf9e000000ffff
kdata_dsc: dq 0x00cf92000000ffff
k16cd_dsc: dq 0x00009e000000ffff ï¼›16ä½ä»£ç æ®µæè¿°ç¬¦
k16da_dsc: dq 0x000092000000ffff ï¼›16ä½æ•°æ®æ®µæè¿°ç¬¦
GDT_END:
GDT_PTR:
GDTLEN	dw GDT_END-GDT_START-1	;GDTç•Œé™
GDTBASE	dd GDT_START
```

æœ€åæ˜¯åˆå§‹åŒ–æ®µå¯„å­˜å™¨å’Œé€šç”¨å¯„å­˜å™¨ã€æ ˆå¯„å­˜å™¨ï¼Œè¿™æ˜¯ä¸ºäº†ç»™è°ƒç”¨inithead\_entryè¿™ä¸ªCå‡½æ•°åšå‡†å¤‡ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚

```
_32bits_modeï¼š
	mov ax, 0x10
	mov ds, ax
	mov ss, ax
	mov es, ax
	mov fs, ax
	mov gs, ax
	xor eax,eax
	xor ebx,ebx
	xor ecx,ecx
	xor edx,edx
	xor edi,edi
	xor esi,esi
	xor ebp,ebp
	xor esp,esp
	mov esp,0x7c00 ï¼›è®¾ç½®æ ˆé¡¶ä¸º0x7c00
	call inithead_entry ï¼›è°ƒç”¨inithead_entryå‡½æ•°åœ¨inithead.cä¸­å®ç°
	jmp 0x200000  ï¼›è·³è½¬åˆ°0x200000åœ°å€
```

ä¸Šè¿°ä»£ç çš„æœ€åè°ƒç”¨äº†inithead\_entryå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æˆ‘ä»¬éœ€è¦å¦å¤–åœ¨inithead.cä¸­å®ç°ï¼Œæˆ‘ä»¬è¿™å°±æ¥å®ç°å®ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚

```
#define MDC_ENDGIC 0xaaffaaffaaffaaff
#define MDC_RVGIC 0xffaaffaaffaaffaa
#define REALDRV_PHYADR 0x1000
#define IMGFILE_PHYADR 0x4000000
#define IMGKRNL_PHYADR 0x2000000
#define LDRFILEADR IMGFILE_PHYADR
#define MLOSDSC_OFF (0x1000)
#define MRDDSC_ADR (mlosrddsc_t*)(LDRFILEADR+0x1000)

void inithead_entry()
{
    write_realintsvefile();
    write_ldrkrlfile();
    return;
}
//å†™initldrsve.binæ–‡ä»¶åˆ°ç‰¹å®šçš„å†…å­˜ä¸­
void write_realintsvefile()
{
    fhdsc_t *fhdscstart = find_file("initldrsve.bin");
    if (fhdscstart == NULL)
    {
        error("not file initldrsve.bin");
    }
    m2mcopy((void *)((u32_t)(fhdscstart->fhd_intsfsoff) + LDRFILEADR),
            (void *)REALDRV_PHYADR, (sint_t)fhdscstart->fhd_frealsz);
    return;
}
//å†™initldrkrl.binæ–‡ä»¶åˆ°ç‰¹å®šçš„å†…å­˜ä¸­
void write_ldrkrlfile()
{
    fhdsc_t *fhdscstart = find_file("initldrkrl.bin");
    if (fhdscstart == NULL)
    {
        error("not file initldrkrl.bin");
    }
    m2mcopy((void *)((u32_t)(fhdscstart->fhd_intsfsoff) + LDRFILEADR),
            (void *)ILDRKRL_PHYADR, (sint_t)fhdscstart->fhd_frealsz);
    return;
}
//åœ¨æ˜ åƒæ–‡ä»¶ä¸­æŸ¥æ‰¾å¯¹åº”çš„æ–‡ä»¶
fhdsc_t *find_file(char_t *fname)
{
    mlosrddsc_t *mrddadrs = MRDDSC_ADR;
    if (mrddadrs->mdc_endgic != MDC_ENDGIC ||
        mrddadrs->mdc_rv != MDC_RVGIC ||
        mrddadrs->mdc_fhdnr < 2 ||
        mrddadrs->mdc_filnr < 2)
    {
        error("no mrddsc");
    }
    s64_t rethn = -1;
    fhdsc_t *fhdscstart = (fhdsc_t *)((u32_t)(mrddadrs->mdc_fhdbk_s) + LDRFILEADR);
    for (u64_t i = 0; i < mrddadrs->mdc_fhdnr; i++)
    {
        if (strcmpl(fname, fhdscstart[i].fhd_name) == 0)
        {
            rethn = (s64_t)i;
            goto ok_l;
        }
    }
    rethn = -1;
ok_l:
    if (rethn < 0)
    {
        error("not find file");
    }
    return &fhdscstart[rethn];
}
```

æˆ‘ä»¬å®ç°äº†inithead\_entryå‡½æ•°ï¼Œå®ƒä¸»è¦å¹²äº†ä¸¤ä»¶äº‹ï¼Œå³åˆ†åˆ«è°ƒç”¨write\_realintsvefile();ã€write\_ldrkrlfile()å‡½æ•°ï¼ŒæŠŠæ˜ åƒæ–‡ä»¶ä¸­çš„initldrsve.binæ–‡ä»¶å’Œinitldrkrl.binæ–‡ä»¶å†™å…¥åˆ°ç‰¹å®šçš„å†…å­˜åœ°å€ç©ºé—´ä¸­ï¼Œå…·ä½“åœ°å€åœ¨ä¸Šé¢ä»£ç ä¸­çš„å®æœ‰è¯¦ç»†å®šä¹‰ã€‚

è¿™ä¸¤ä¸ªå‡½æ•°åˆ†åˆ«ä¾èµ–äºfind\_fileå’Œm2mcopyå‡½æ•°ã€‚

æ­£å¦‚å…¶åï¼Œfind\_fileå‡½æ•°è´Ÿè´£æ‰«ææ˜ åƒæ–‡ä»¶ä¸­çš„æ–‡ä»¶å¤´æè¿°ç¬¦ï¼Œå¯¹æ¯”å…¶ä¸­çš„æ–‡ä»¶åï¼Œç„¶åè¿”å›å¯¹åº”çš„æ–‡ä»¶å¤´æè¿°ç¬¦çš„åœ°å€ï¼Œè¿™æ ·å°±å¯ä»¥å¾—åˆ°æ–‡ä»¶åœ¨æ˜ åƒæ–‡ä»¶ä¸­çš„ä½ç½®å’Œå¤§å°äº†ã€‚

find\_fileå‡½æ•°çš„æ¥åŠ›é˜Ÿå‹å°±æ˜¯m2mcopyå‡½æ•°ï¼Œå› ä¸ºæŸ¥æ‰¾å¯¹æ¯”ä¹‹åï¼Œæœ€åå°±æ˜¯m2mcopyå‡½æ•°è´Ÿè´£æŠŠæ˜ åƒæ–‡ä»¶å¤åˆ¶åˆ°å…·ä½“çš„å†…å­˜ç©ºé—´é‡Œã€‚

ä»£ç ä¸­çš„å…¶å®ƒå‡½æ•°æˆ‘å°±ä¸å±•å¼€äº†ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦è¯·è‡ªè¡Œç ”ç©¶ï¼Œæˆ–è€…è‡ªå·±æ”¹å†™ã€‚

## è¿›å…¥äºŒçº§å¼•å¯¼å™¨

ä½ åº”è¯¥è¿˜æœ‰å°è±¡ï¼Œåˆšæ‰è¯´çš„å®ç°GRUBå¤´è¿™ä¸ªéƒ¨åˆ†ï¼Œåœ¨imghead.asmæ±‡ç¼–æ–‡ä»¶ä»£ç ä¸­ï¼Œæˆ‘ä»¬çš„æœ€åä¸€æ¡æŒ‡ä»¤æ˜¯â€œ**jmp 0x200000**â€ï¼Œå³è·³è½¬åˆ°ç‰©ç†å†…å­˜çš„0x200000åœ°å€å¤„ã€‚

è¯·ä½ æ³¨æ„ï¼Œè¿™æ—¶åœ°å€è¿˜æ˜¯ç‰©ç†åœ°å€ï¼Œè¿™ä¸ªåœ°å€æ­£æ˜¯åœ¨inithead.cä¸­ç”±write\_ldrkrlfile()å‡½æ•°æ”¾ç½®çš„initldrkrl.binæ–‡ä»¶ï¼Œè¿™ä¸€è·³å°±è¿›å…¥äº†äºŒçº§å¼•å¯¼å™¨çš„ä¸»æ¨¡å—äº†ã€‚

ç”±äºæ¨¡å—çš„æ”¹å˜ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å†™ä¸€å°æ®µæ±‡ç¼–ä»£ç ï¼Œå»ºç«‹ä¸‹é¢è¿™ä¸ªinitldr32.asmï¼ˆé…å¥—ä»£ç åº“ä¸­å¯¹åº”ldrkrl32.asmï¼‰æ–‡ä»¶ï¼Œå¹¶å†™ä¸Šå¦‚ä¸‹ä»£ç ã€‚

```
_entry:
	cli
	lgdt [GDT_PTR]ï¼›åŠ è½½GDTåœ°å€åˆ°GDTRå¯„å­˜å™¨
	lidt [IDT_PTR]ï¼›åŠ è½½IDTåœ°å€åˆ°IDTRå¯„å­˜å™¨
	jmp dword 0x8 :_32bits_modeï¼›é•¿è·³è½¬åˆ·æ–°CSå½±å­å¯„å­˜å™¨
_32bits_mode:
	mov ax, 0x10	; æ•°æ®æ®µé€‰æ‹©å­(ç›®çš„)
	mov ds, ax
	mov ss, ax
	mov es, ax
	mov fs, ax
	mov gs, ax
	xor eax,eax
	xor ebx,ebx
	xor ecx,ecx
	xor edx,edx
	xor edi,edi
	xor esi,esi
	xor ebp,ebp
	xor esp,esp
	mov esp,0x90000 ï¼›ä½¿å¾—æ ˆåº•æŒ‡å‘äº†0x90000
	call ldrkrl_entry ï¼›è°ƒç”¨ldrkrl_entryå‡½æ•°
	xor ebx,ebx
	jmp 0x2000000 ï¼›è·³è½¬åˆ°0x2000000çš„å†…å­˜åœ°å€
	jmp $
GDT_START:
knull_dsc: dq 0
kcode_dsc: dq 0x00cf9a000000ffff ;a-e
kdata_dsc: dq 0x00cf92000000ffff
k16cd_dsc: dq 0x00009a000000ffff ï¼›16ä½ä»£ç æ®µæè¿°ç¬¦
k16da_dsc: dq 0x000092000000ffff ï¼›16ä½æ•°æ®æ®µæè¿°ç¬¦
GDT_END:
GDT_PTR:
GDTLEN	dw GDT_END-GDT_START-1	;GDTç•Œé™
GDTBASE	dd GDT_START

IDT_PTR:
IDTLEN	dw 0x3ff
IDTBAS	dd 0  ï¼›è¿™æ˜¯BIOSä¸­æ–­è¡¨çš„åœ°å€å’Œé•¿åº¦
```

æˆ‘æ¥ç»™ä½ åšä¸ªè§£è¯»ï¼Œä»£ç çš„1ï½4è¡Œæ˜¯åœ¨åŠ è½½GDTRå’ŒIDTRå¯„å­˜å™¨ï¼Œç„¶ååˆå§‹åŒ–CPUç›¸å…³çš„å¯„å­˜å™¨ã€‚

å’Œå…ˆå‰ä¸€æ ·ï¼Œå› ä¸ºä»£ç æ¨¡å—çš„æ”¹å˜ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŠŠGDTã€IDTï¼Œå¯„å­˜å™¨è¿™äº›ä¸œè¥¿é‡æ–°åˆå§‹åŒ–ï¼Œæœ€åå†å»è°ƒç”¨äºŒçº§å¼•å¯¼å™¨çš„ä¸»å‡½æ•°ldrkrl\_entryã€‚

## å·§å¦™è°ƒç”¨BIOSä¸­æ–­

æˆ‘ä»¬ä¸è¦æ€¥ç€å»å†™ldrkrl\_entryå‡½æ•°ï¼Œå› ä¸ºåœ¨åé¢æˆ‘ä»¬è¦è·å¾—å†…å­˜å¸ƒå±€ä¿¡æ¯ï¼Œè¦è®¾ç½®æ˜¾å¡å›¾å½¢æ¨¡å¼ï¼Œè€Œè¿™äº›åŠŸèƒ½ä¾èµ–äºBIOSæä¾›ä¸­æ–­æœåŠ¡ã€‚

å¯æ˜¯ï¼Œè¦åœ¨Cå‡½æ•°ä¸­è°ƒç”¨BIOSä¸­æ–­æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºCè¯­è¨€ä»£ç å·¥ä½œåœ¨32ä½ä¿æŠ¤æ¨¡å¼ä¸‹ï¼ŒBIOSä¸­æ–­å·¥ä½œåœ¨16ä½çš„å®æ¨¡å¼ã€‚

æ‰€ä»¥ï¼ŒCè¯­è¨€ç¯å¢ƒä¸‹è°ƒç”¨BIOSä¸­æ–­ï¼Œéœ€è¦å¤„ç†çš„é—®é¢˜å¦‚ä¸‹ï¼š

1.ä¿å­˜Cè¯­è¨€ç¯å¢ƒä¸‹çš„CPUä¸Šä¸‹æ–‡ ï¼Œå³ä¿æŠ¤æ¨¡å¼ä¸‹çš„æ‰€æœ‰é€šç”¨å¯„å­˜å™¨ã€æ®µå¯„å­˜å™¨ã€ç¨‹åºæŒ‡é’ˆå¯„å­˜å™¨ï¼Œæ ˆå¯„å­˜å™¨ï¼ŒæŠŠå®ƒä»¬éƒ½ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚  
2.åˆ‡æ¢å›å®æ¨¡å¼ï¼Œè°ƒç”¨BIOSä¸­æ–­ï¼ŒæŠŠBIOSä¸­æ–­è¿”å›çš„ç›¸å…³ç»“æœï¼Œä¿å­˜åœ¨å†…å­˜ä¸­ã€‚  
3.åˆ‡æ¢å›ä¿æŠ¤æ¨¡å¼ï¼Œé‡æ–°åŠ è½½ç¬¬1æ­¥ä¸­ä¿å­˜çš„å¯„å­˜å™¨ã€‚è¿™æ ·Cè¯­è¨€ä»£ç æ‰èƒ½é‡æ–°æ¢å¤æ‰§è¡Œã€‚

è¦å®Œæˆä¸Šé¢çš„åŠŸèƒ½ï¼Œå¿…é¡»è¦å†™ä¸€ä¸ªæ±‡ç¼–å‡½æ•°æ‰èƒ½å®Œæˆï¼Œæˆ‘ä»¬å°±æŠŠå®ƒå†™åœ¨ldrkrl32.asmæ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤º ã€‚

```
realadr_call_entry:
	pushad     ;ä¿å­˜é€šç”¨å¯„å­˜å™¨
	push    ds
	push    es
	push    fs ;ä¿å­˜4ä¸ªæ®µå¯„å­˜å™¨
	push    gs
	call save_eip_jmp ï¼›è°ƒç”¨save_eip_jmp 
	pop	gs
	pop	fs
	pop	es      ;æ¢å¤4ä¸ªæ®µå¯„å­˜å™¨
	pop	ds
	popad       ;æ¢å¤é€šç”¨å¯„å­˜å™¨
	ret
save_eip_jmp:
	pop esi  ï¼›å¼¹å‡ºcall save_eip_jmpæ—¶ä¿å­˜çš„eipåˆ°esiå¯„å­˜å™¨ä¸­ï¼Œ 
	mov [PM32_EIP_OFF],esi ï¼›æŠŠeipä¿å­˜åˆ°ç‰¹å®šçš„å†…å­˜ç©ºé—´ä¸­
	mov [PM32_ESP_OFF],esp ï¼›æŠŠespä¿å­˜åˆ°ç‰¹å®šçš„å†…å­˜ç©ºé—´ä¸­
	jmp dword far [cpmty_mode]ï¼›é•¿è·³è½¬è¿™é‡Œè¡¨ç¤ºæŠŠcpmty_modeå¤„çš„ç¬¬ä¸€ä¸ª4å­—èŠ‚è£…å…¥eipï¼ŒæŠŠå…¶åçš„2å­—èŠ‚è£…å…¥cs
cpmty_mode:
	dd 0x1000
	dw 0x18
	jmp $
```

ä¸Šé¢çš„ä»£ç æˆ‘åˆ—äº†è¯¦ç»†æ³¨é‡Šï¼Œä½ ä¸€çœ‹å°±èƒ½æ˜ç™½ã€‚ä¸è¿‡è¿™é‡Œå”¯ä¸€ä¸å¥½æ‡‚çš„æ˜¯**jmp dword far \[cpmty\_mode]æŒ‡ä»¤**ï¼Œåˆ«æ‹…å¿ƒï¼Œå¬æˆ‘ç»™ä½ è§£è¯»ä¸€ä¸‹ã€‚

å…¶å®è¿™ä¸ªæŒ‡ä»¤æ˜¯ä¸€ä¸ª**é•¿è·³è½¬**ï¼Œè¡¨ç¤ºæŠŠ\[cpmty\_mode]å¤„çš„æ•°æ®è£…å…¥CSï¼šEIPï¼Œä¹Ÿå°±æ˜¯æŠŠ0x18ï¼š0x1000è£…å…¥åˆ°CSï¼šEIPä¸­ã€‚

è¿™ä¸ª0x18å°±æ˜¯æ®µæè¿°ç´¢å¼•ï¼ˆè¿™ä¸ªçŸ¥è¯†ç‚¹ä¸ç†Ÿæ‚‰çš„è¯ï¼Œä½ å¯ä»¥å›çœ‹æˆ‘ä»¬[ç¬¬äº”èŠ‚è¯¾](https://time.geekbang.org/column/article/375278)ï¼‰ï¼Œå®ƒæ­£æ˜¯æŒ‡å‘GDTä¸­çš„16ä½ä»£ç æ®µæè¿°ç¬¦ï¼›0x1000ä»£è¡¨æ®µå†…çš„åç§»åœ°å€ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªåœ°å€ä¸Šï¼Œæˆ‘ä»¬å¿…é¡»æ”¾ä¸€æ®µä»£ç æŒ‡ä»¤ï¼Œä¸ç„¶CPUè·³è½¬åˆ°è¿™é‡Œå°†æ²¡æŒ‡ä»¤å¯ä»¥æ‰§è¡Œï¼Œé‚£æ ·å°±ä¼šå‘ç”Ÿé”™è¯¯ã€‚

å› ä¸ºè¿™æ˜¯ä¸€ä¸ª16ä½ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ–°å»ºç«‹ä¸€ä¸ªæ–‡ä»¶realintsve.asmï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚

```
[bits 16]
_start:
_16_mode:
	mov	bp,0x20 ;0x20æ˜¯æŒ‡å‘GDTä¸­çš„16ä½æ•°æ®æ®µæè¿°ç¬¦ 
	mov	ds, bp
	mov	es, bp
	mov	ss, bp
	mov	ebp, cr0
	and	ebp, 0xfffffffe
	mov	cr0, ebp ï¼›CR0.P=0 å…³é—­ä¿æŠ¤æ¨¡å¼
	jmp	0:real_entry ï¼›åˆ·æ–°CSå½±å­å¯„å­˜å™¨ï¼ŒçœŸæ­£è¿›å…¥å®æ¨¡å¼
real_entry:
	mov bp, cs
	mov ds, bp
	mov es, bp
	mov ss, bp ï¼›é‡æ–°è®¾ç½®å®æ¨¡å¼ä¸‹çš„æ®µå¯„å­˜å™¨ éƒ½æ˜¯CSä¸­å€¼ï¼Œå³ä¸º0 
	mov sp, 08000h ï¼›è®¾ç½®æ ˆ
	mov bp,func_table
	add bp,ax
	call [bp] ï¼›è°ƒç”¨å‡½æ•°è¡¨ä¸­çš„æ±‡ç¼–å‡½æ•°ï¼Œaxæ˜¯Cå‡½æ•°ä¸­ä¼ é€’è¿›æ¥çš„
	cli
	call disable_nmi
	mov	ebp, cr0
	or	ebp, 1
	mov	cr0, ebp ï¼›CR0.P=1 å¼€å¯ä¿æŠ¤æ¨¡å¼
	jmp dword 0x8 :_32bits_mode
[BITS 32]
_32bits_mode:
	mov bp, 0x10
	mov ds, bp
	mov ss, bpï¼›é‡æ–°è®¾ç½®ä¿æŠ¤æ¨¡å¼ä¸‹çš„æ®µå¯„å­˜å™¨0x10æ˜¯32ä½æ•°æ®æ®µæè¿°ç¬¦çš„ç´¢å¼•
	mov esi,[PM32_EIP_OFF]ï¼›åŠ è½½å…ˆå‰ä¿å­˜çš„EIP
	mov esp,[PM32_ESP_OFF]ï¼›åŠ è½½å…ˆå‰ä¿å­˜çš„ESP
	jmp esi ï¼›eip=esi å›åˆ°äº†realadr_call_entryå‡½æ•°ä¸­

func_table:  ;å‡½æ•°è¡¨
	dw _getmmap ï¼›è·å–å†…å­˜å¸ƒå±€è§†å›¾çš„å‡½æ•°
	dw _read ï¼›è¯»å–ç¡¬ç›˜çš„å‡½æ•°
    dw _getvbemode ï¼›è·å–æ˜¾å¡VBEæ¨¡å¼ 
    dw _getvbeonemodeinfo ï¼›è·å–æ˜¾å¡VBEæ¨¡å¼çš„æ•°æ®
    dw _setvbemode ï¼›è®¾ç½®æ˜¾å¡VBEæ¨¡å¼
```

ä¸Šé¢çš„ä»£ç æˆ‘ä»¬åªè¦å°†å®ƒç¼–è¯‘æˆ16ä½çš„äºŒè¿›åˆ¶çš„æ–‡ä»¶ï¼Œå¹¶æŠŠå®ƒæ”¾åœ¨0x1000å¼€å§‹çš„å†…å­˜ç©ºé—´ä¸­å°±å¯ä»¥äº†ã€‚è¿™æ ·åœ¨realadr\_call\_entryå‡½æ•°çš„æœ€åï¼Œå°±è¿è¡Œåˆ°è¿™æ®µä»£ç ä¸­æ¥äº†ã€‚

ä¸Šè¿°çš„ä»£ç çš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼šé¦–å…ˆä» \_16\_mode:æ ‡å·å¤„è¿›å…¥å®æ¨¡å¼ï¼Œç„¶åæ ¹æ®ä¼ é€’è¿›æ¥ï¼ˆç”±axå¯„å­˜å™¨ä¼ å…¥ï¼‰çš„å‡½æ•°å·ï¼Œåˆ°å‡½æ•°è¡¨ä¸­è°ƒç”¨å¯¹åº”çš„å‡½æ•°ï¼Œé‡Œé¢çš„å‡½æ•°æ‰§è¡Œå®Œæˆåï¼Œå†æ¬¡è¿›å…¥ä¿æŠ¤æ¨¡å¼ï¼ŒåŠ è½½EIPå’ŒESPå¯„å­˜å™¨ä»è€Œå›åˆ°realadr\_call\_entryå‡½æ•°ä¸­ã€‚GDTè¿˜æ˜¯imghead.asmæ±‡ç¼–ä»£ç æ–‡ä»¶ä¸­çš„GDTï¼Œè¿™æ²¡æœ‰å˜ï¼Œå› ä¸ºå®ƒæ˜¯ç”±GDTRå¯„å­˜å™¨æŒ‡å‘çš„ã€‚

è¯´åˆ°è¿™é‡Œï¼Œç›¸ä¿¡ä½ ä¼šç«‹åˆ»æ˜ç™½ï¼Œä¹‹å‰write\_realintsvefile()å‡½æ•°çš„åŠŸèƒ½ä¸æ„ä¹‰äº†ã€‚å®ƒä¼šæŠŠ**æ˜ åƒæ–‡ä»¶ä¸­çš„initldrsve.binæ–‡ä»¶å†™å…¥åˆ°ç‰¹å®šçš„å†…å­˜åœ°å€ç©ºé—´ä¸­**ï¼Œè€Œinitldrsve.binæ­£æ˜¯ç”±ä¸Šé¢çš„realintsve.asmæ–‡ä»¶ç¼–è¯‘è€Œæˆçš„ã€‚

## äºŒçº§å¼•å¯¼å™¨ä¸»å‡½æ•°

å¥½ï¼Œç°åœ¨æˆ‘ä»¬å‡†å¤‡å¾—å·®ä¸å¤šäº†ï¼Œä»äºŒçº§å¼•å¯¼å™¨çš„ä¸»å‡½æ•°å¼€å§‹ï¼Œè¿™ä¸ªå‡½æ•°æˆ‘ä»¬è¦ç”¨Cæ¥å†™ï¼Œä¼°è®¡ä½ ä¹Ÿæ„Ÿå—åˆ°äº†å†™æ±‡ç¼–è¯­è¨€çš„å‹åŠ›ï¼Œæ‰€ä»¥ä¸èƒ½è€æ˜¯å†™æ±‡ç¼–ã€‚

æˆ‘ä»¬å…ˆå»ºç«‹ä¸€ä¸ªCæ–‡ä»¶ldrkrlentry.cï¼Œåœ¨å…¶ä¸­å†™ä¸Šä¸€ä¸ªä¸»å‡½æ•°ï¼Œä»£ç å¦‚ä¸‹ã€‚

```
void ldrkrl_entry()
{
    init_bstartparm();
    return;
}
```

ä¸Šè¿°ä»£ç ä¸­çš„ ldrkrl\_entry()å‡½æ•°åœ¨initldr32.asmæ–‡ä»¶ï¼ˆé…å¥—ä»£ç åº“ä¸­å¯¹åº”ldrkrl32.asmï¼‰ä¸­è¢«è°ƒç”¨ï¼Œä»é‚£æ¡call ldrkrl\_entry æŒ‡ä»¤å¼€å§‹è¿›å…¥äº†ldrkrl\_entry()å‡½æ•°ï¼Œåœ¨å…¶ä¸­è°ƒç”¨äº†**init\_bstartparm()å‡½æ•°**ï¼Œè¿™ä¸ªå‡½æ•°æˆ‘ä»¬è¿˜æ²¡æœ‰å®ç°ï¼Œä½†é€šè¿‡åå­—æˆ‘ä»¬ä¸éš¾æ¨æµ‹ï¼Œå®ƒæ˜¯è´Ÿè´£å¤„ç†å¼€å§‹å‚æ•°çš„ã€‚

ä½ è¿˜è®°ä¸è®°å¾—ï¼Œæˆ‘ä»¬å»ºé€ äºŒçº§å¼•å¯¼å™¨çš„ç›®çš„ï¼Œå°±æ˜¯è¦æ”¶é›†æœºå™¨ç¯å¢ƒä¿¡æ¯ã€‚æˆ‘ä»¬è¦æŠŠè¿™äº›ä¿¡æ¯å½¢æˆä¸€ä¸ªæœ‰ç»“æ„çš„å‚æ•°ï¼Œä¼ é€’ç»™æˆ‘ä»¬çš„æ“ä½œç³»ç»Ÿå†…æ ¸ä»¥å¤‡åç»­ä½¿ç”¨ã€‚

ç”±æ­¤ï¼Œæˆ‘ä»¬èƒ½å¤Ÿç¡®å®šï¼Œ**init\_bstartparm()å‡½æ•°æˆäº†æ”¶é›†æœºå™¨ç¯å¢ƒä¿¡æ¯çš„ä¸»å‡½æ•°**ï¼Œä¸‹èŠ‚è¯¾æˆ‘ä»¬å°±ä¼šå»å®ç°å®ƒã€‚

## é‡ç‚¹å›é¡¾

ä»Šå¤©æˆ‘ä»¬å¼€å§‹å®ç°äºŒçº§å¼•å¯¼å™¨äº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰å®Œå…¨å®ç°ï¼Œæˆ‘ä»¬ä¸‹ä¸€èŠ‚è¯¾å†æ¥ç€ç»§ç»­è¿™é¡¹å·¥ä½œã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬æ¥æ¢³ç†ä¸€ä¸‹è¿™èŠ‚è¯¾çš„å†…å®¹ï¼Œå›é¡¾ä¸€ä¸‹æˆ‘ä»¬ä»Šå¤©çš„æˆæœã€‚

1.æˆ‘ä»¬è®¾è®¡äº†æœºå™¨ä¿¡æ¯ç»“æ„ï¼Œç”¨äºå­˜æ”¾åé¢äºŒçº§å¼•å¯¼å™¨æ”¶é›†åˆ°çš„æœºå™¨ä¿¡æ¯ã€‚  
2.å¯¹äºŒçº§å¼•å¯¼å™¨ä»£ç æ¨¡å—è¿›è¡Œäº†è§„åˆ’ï¼Œç¡®å®šå„æ¨¡å—çš„ä¸»è¦åŠŸèƒ½ã€‚  
3.å®ç°äº†GRUBè§„å®šçš„GRUBå¤´ï¼Œä»¥ä¾¿è¢«GRUBè¯†åˆ«ï¼Œåœ¨GRUBå¤´ä¸­åˆå§‹åŒ–äº†CPUå¯„å­˜å™¨ï¼Œå¹¶ä¸”è·³è½¬åˆ°ç‰©ç†å†…å­˜çš„0x200000åœ°å€å¤„ï¼ŒçœŸæ­£è¿›å…¥åˆ°äºŒçº§å¼•å¯¼å™¨ä¸­å¼€å§‹è¿è¡Œã€‚  
4.ä¸ºäº†äºŒçº§å¼•å¯¼å™¨èƒ½å¤Ÿè°ƒç”¨BIOSä¸­æ–­æœåŠ¡ç¨‹åºï¼Œæˆ‘ä»¬å®ç°äº†ä¸“é—¨ç”¨æ¥å®Œæˆè°ƒç”¨BIOSä¸­æ–­æœåŠ¡ç¨‹åºçš„realintsve.asmæ¨¡å—ã€‚  
5.æœ€åï¼Œæˆ‘ä»¬å®ç°äº†äºŒçº§å¼•å¯¼å™¨çš„ä¸»å‡½æ•°ï¼Œç”±å®ƒè°ƒç”¨å®Œæˆå…¶å®ƒåŠŸèƒ½çš„å‡½æ•°ã€‚

è¿™é‡Œæˆ‘è¿˜æƒ³èŠèŠï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è¦èŠ±è¿™ä¹ˆå¤šåŠŸå¤«ï¼Œå»è®¾è®¡äºŒçº§å¼•å¯¼å™¨è¿™ä¸ªç»„ä»¶å‘¢ï¼Ÿ

æˆ‘ä»¬æŠŠè¿™äº›å¤„ç†æ“ä½œç³»ç»Ÿè¿è¡Œç¯å¢ƒçš„å·¥ä½œç‹¬ç«‹å‡ºæ¥ï¼Œäº¤ç»™äºŒçº§å¼•å¯¼å™¨æ¥åšï¼Œè¿™ä¼š**å¤§å¤§é™ä½åé¢å¼€å‘æ“ä½œç³»ç»Ÿçš„éš¾åº¦ï¼Œä¹Ÿèƒ½å¢åŠ æ“ä½œç³»ç»Ÿçš„é€šç”¨æ€§ã€‚**è€Œä¸”ï¼Œé’ˆå¯¹ä¸åŒçš„ç¡¬ä»¶å¹³å°ï¼Œæˆ‘ä»¬åªè¦å¼€å‘ä¸åŒçš„äºŒçº§å¼•å¯¼å™¨å°±å¥½äº†ã€‚

## æ€è€ƒé¢˜

è¯·é—®GRUBå¤´ä¸­ä¸ºä»€ä¹ˆéœ€è¦\_entryæ ‡å·å’Œ\_startæ ‡å·çš„åœ°å€ï¼Ÿ

æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºè·Ÿæˆ‘äº¤æµæ´»åŠ¨ã€‚å¦‚æœä½ èº«è¾¹çš„åŒäº‹ã€æœ‹å‹ï¼Œå¯¹äºŒçº§å¼•å¯¼å™¨çš„å»ºç«‹æœ‰å…´è¶£ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™ä»–ã€‚

å¥½ï¼Œæˆ‘æ˜¯LMOSï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ï¼
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ15ï¼‰</strong></div><ul>
<li><span>å—£æ ‘</span> ğŸ‘ï¼ˆ6ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<p>å›ç­”ä¸€ä¸‹é—®é¢˜ï¼ŒGRUB å¤´ä¸­ä¸ºä»€ä¹ˆéœ€è¦ _entry æ ‡å·å’Œ _start æ ‡å·çš„åœ°å€ï¼Ÿ

æˆ‘ä»¬å®šä¹‰çš„ flags å€¼ä¸ºï¼š
MBT_HDR_FLAGS EQU 0x00010003

æ ¹æ® Multiboot Specification å®šä¹‰çš„å¤´ç»“æ„
Offset	Type	Field Name		Note
0		u32		magic			required
4		u32		flags			required
8		u32		checksum		required
12		u32		header_addr		if flags[16] is set
16		u32		load_addr		        if flags[16] is set
20		u32		load_end_addr	        if flags[16] is set
24		u32		bss_end_addr	        if flags[16] is set
28		u32		entry_addr		if flags[16] is set
32		u32		mode_type		if flags[2] is set
36		u32		width			if flags[2] is set
40		u32		height			if flags[2] is set
44		u32		depth			if flags[2] is set

flags[16] è§£é‡Šå¦‚ä¸‹ï¼š
If bit 16 in the â€˜flagsâ€™ word is set, then the fields at offsets 12-28 in the Multiboot header are valid, and the boot loader should use them instead of the fields in the actual executable header to calculate where to load the OS image. This information does not need to be provided if the kernel image is in ELF format, but it must be provided if the images is in a.out format or in some other format. Compliant boot loaders must be able to load images that either are in ELF format or contain the load address information embedded in the Multiboot header; they may also directly support other executable formats, such as particular a.out variants, but are not required to.

ä¹Ÿå°±æ˜¯å¦‚æœæˆ‘ä»¬ç”¨çš„æ˜¯æ ‡å‡†çš„ ELF æ–‡ä»¶å°±ä¸éœ€è¦æä¾›é¢å¤–çš„åœ°å€ä¿¡æ¯ï¼Œè€Œæˆ‘ä»¬ç”¨çš„æ˜¯è‡ªå·±å®šä¹‰çš„æ ¼å¼å°±éœ€è¦äººå®¶ä»å“ªé‡ŒåŠ è½½å“ªé‡Œè¿è¡Œï¼Œæ‰€ä»¥éœ€è¦å°† bit 16 ä½¿èƒ½ï¼Œå¡«å……ç›¸åº”çš„å­—æ®µã€‚

å†è§£é‡Šä¸‹ä¸¤ä¸ªå­—æ®µçš„å«ä¹‰ï¼š
load_addr
Contains the physical address of the beginning of the text segment. The offset in the OS image file at which to start loading is defined by the offset at which the header was found, minus (header_addr - load_addr). load_addr must be less than or equal to header_addr.

entry_addr
The physical address to which the boot loader should jump in order to start running the operating system.</p>2021-06-03</li><br/><li><span>neohope</span> ğŸ‘ï¼ˆ91ï¼‰ ğŸ’¬ï¼ˆ16ï¼‰<p>å¤§ä½“ä¸Šæ•´ç†äº†ä¸€ä¸‹ï¼š

1ã€grubå¯åŠ¨åï¼Œé€‰æ‹©å¯¹åº”çš„å¯åŠ¨èœå•é¡¹ï¼Œgrubä¼šé€šè¿‡è‡ªå¸¦æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨ï¼Œå®šä½åˆ°å¯¹åº”çš„ekiæ–‡ä»¶

2ã€grubä¼šå°è¯•åŠ è½½ekiæ–‡ä»¶ã€ekiæ–‡ä»¶éœ€è¦æ»¡è¶³grubå¤šåè®®å¼•å¯¼å¤´çš„æ ¼å¼è¦æ±‚ã€‘
è¿™äº›æ˜¯åœ¨imginithead.asmä¸­å®ç°çš„ï¼Œæ‰€ä»¥è¦åŒ…æ‹¬ï¼š
Aã€grubæ–‡ä»¶å¤´ï¼ŒåŒ…æ‹¬é­”æ•°ã€grub1å’Œgrub2æ”¯æŒç­‰
Bã€å®šä½çš„_startç¬¦å·ç­‰

3ã€grubæ ¡éªŒæˆåŠŸåï¼Œä¼šè°ƒç”¨_startï¼Œç„¶è·³è½¬åˆ°_entry
Aã€_entryä¸­:å…³é—­ä¸­æ–­
Bã€åŠ è½½GDT
Cã€ç„¶åè¿›å…¥_32bits_modeï¼Œæ¸…ç†å¯„å­˜å™¨ï¼Œè®¾ç½®æ ˆé¡¶
Dã€è°ƒç”¨inithead_entryã€Cã€‘

4ã€inithead_entry.c
Aã€ä»imginithead.asmè¿›å…¥åï¼Œé¦–å…ˆè¿›å…¥å‡½æ•°è°ƒç”¨inithead_entry
Bã€åˆå§‹åŒ–å…‰æ ‡ï¼Œæ¸…å±
Cã€ä»ekiæ–‡ä»¶å†…éƒ¨ï¼Œæ‰¾åˆ°initldrsve.binæ–‡ä»¶ï¼Œå¹¶åˆ†åˆ«æ‹·è´åˆ°å†…å­˜çš„æŒ‡å®šç‰©ç†åœ°å€
Dã€ä»ekiæ–‡ä»¶å†…éƒ¨ï¼Œæ‰¾åˆ°initldrkrl.binæ–‡ä»¶ï¼Œå¹¶åˆ†åˆ«æ‹·è´åˆ°å†…å­˜çš„æŒ‡å®šç‰©ç†åœ°å€
Eã€è¿”å›imginithead.asm

5ã€imginithead.asmä¸­ç»§ç»­æ‰§è¡Œ
jmp 0x200000
è€Œè¿™ä¸ªä½ç½®ï¼Œå°±æ˜¯initldrkrl.binåœ¨å†…å­˜çš„ä½ç½®ILDRKRL_PHYADR
æ‰€ä»¥åé¢è¦æ‰§è¡Œinitldrkrl.binçš„å†…å®¹

6ã€è¿™æ ·å°±åˆ°äº†ldrkrl32.asmçš„_entry
Aã€å°†GDTåŠ è½½åˆ°GDTRå¯„å­˜å™¨ã€å†…å­˜ã€‘
Bã€å°†IDTåŠ è½½åˆ°IDTRå¯„å­˜å™¨ã€ä¸­æ–­ã€‘
Cã€è·³è½¬åˆ°_32bits_mode
åˆå§‹å¯„å­˜å™¨
åˆå§‹åŒ–æ ˆ
è°ƒç”¨ldrkrl_entryã€Cã€‘

7ã€ldrkrlentry.c
Aã€åˆå§‹åŒ–å…‰æ ‡ï¼Œæ¸…å±
Bã€æ”¶é›†æœºå™¨å‚æ•°init_bstartparmã€Cã€‘

8ã€bstartparm.c
Aã€åˆå§‹åŒ–machbstart_t
Bã€å„ç±»åˆå§‹åŒ–å‡½æ•°ï¼Œå¡«å……machbstart_tçš„å†…å®¹
Cã€è¿”å›

9ã€ldrkrlentry.c
Aã€è¿”å›

10ã€ldrkrl32.asm
Aã€è·³è½¬åˆ°0x2000000åœ°å€ç»§ç»­æ‰§è¡Œ</p>2021-06-02</li><br/><li><span>springXu</span> ğŸ‘ï¼ˆ20ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<p>çœŸå®è¿›å…¥å®é™…å†™ä»£ç çš„è¯¾ç¨‹äº†ã€‚
å¯¹äºgrubçš„å¤´æ ¼å¼åœ¨çš„ç¬¬äºŒèŠ‚å†™ä¸ªHelloOS.binå°±å·²ç»æœ‰äº†ï¼Œè¿™æ¬¡å¤´æ ¼å¼è¿˜æ˜¯ä¼šæœ‰ã€‚ç†ç”±æ˜¯grubæ˜¯ä¸€çº§å¼•å¯¼å™¨ã€‚
è¿™èŠ‚è¯¾çš„å†…å®¹å°±æ˜¯å›´ç»•ç€ç”±ä¸€çº§è½¬åˆ°äºŒçº§å¼•å¯¼å™¨çš„è¿‡ç¨‹å±•å¼€äº†ã€‚
å…³äºäºŒçº§å¼•å¯¼å™¨çš„åŠ è½½è¿‡ç¨‹ï¼Œç®€å•ç‚¹è¯´å°±æ˜¯æŠŠæˆ‘ä»¬å†…æ ¸åŠ è½½åˆ°æŒ‡å®šå†…å­˜çš„ä½ç½®å¹¶æ‰§è¡Œï¼Œè¿™ä¸ªåŠ è½½å‡½æ•°æ ¸å¿ƒæ˜¯m2mcopyå‡½æ•°ï¼Œä¸œå“¥ç•™ç»™æˆ‘ä»¬è‡ªå·±åˆ†æäº†ï¼Œä½†ä¸œå“¥å¼ºè°ƒåˆ†æäº†ä¸‹ä¸ºä»€ä¹ˆä¼šæœ‰32ä½ä¸‹çš„ä»£ç å’Œ16ä½æ±‡ç¼–ä»£ç å…±å­˜çš„ç°è±¡ã€‚ å…¶å®æ˜¯ä¸ºäº†è®©BIOSæä¾›çš„è·å–ç¡¬ä»¶ä¿¡æ¯çš„æ“ä½œå‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯å®æ¨¡å¼ä¸‹çš„BIOSä¸­æ–­å·æ¥è·å–çš„ï¼‰åšæˆäº†cè¯­è¨€ç¯å¢ƒä¸‹ä¹Ÿå¯ä»¥è°ƒç”¨çš„åŠŸèƒ½ã€‚è¿™å°±åƒè·¨è¯­è¨€äº’ç›¸è°ƒç”¨çš„æŠ€æœ¯ã€‚æ±‡ç¼–è°ƒç”¨cè¯­è¨€çš„æ–¹æ³•ï¼Œåè¿‡æ¥cè¯­è¨€è°ƒç”¨æ±‡ç¼–æ–¹æ³•ã€‚ä½†æ›´ä¸ºå¤æ‚äº›ï¼ŒåŸå› æ˜¯ä¿æŠ¤æ¨¡å¼åˆ°å®æ¨¡å¼å†å›åˆ°ä¿æŠ¤æ¨¡å¼çš„åˆ‡æ¢è¿‡ç¨‹ã€‚å†…æ ¸å¯ä»¥è·å–ç¡¬ä»¶ä¿¡æ¯å°±å¯ä»¥æ ¹æ®ç¡¬ä»¶ç¯å¢ƒå‚æ•°ï¼Œé…ç½®è‡ªèº«å‚æ•°å¼€å§‹å·¥ä½œäº†ã€‚å¦‚ä½•é…ç½®å‚æ•°ï¼Œé‚£åˆæ˜¯ä¸‹èŠ‚ç»§ç»­æ’­è®²ã€‚å‘¨äº”è§ã€‚
å…³äºæ€è€ƒé¢˜ï¼Œè¿™ä¸ªæ˜¯grubä¹Ÿæ˜¯è¦æŠŠæ§åˆ¶æƒäº¤ç»™æˆ‘ä»¬äºŒçº§å¼•å¯¼å™¨çš„å…¥å£åœ°å€ã€‚ è‡³äºä¸ºä»€ä¹ˆä¸å…‰æœ‰ä¸€ä¸ª_startå°±å¯ä»¥äº†ï¼Œæˆ‘çŒœæµ‹æ˜¯ä¸ºäº†åšéªŒè¯å§ã€‚_startçš„æ“ä½œæ˜¯jmp åœ°å€ã€‚è¿™ä¸ªåœ°å€æ­£å¥½æ˜¯_entryã€‚æœ‰é”™è¯¯è¿˜è¯·ä¸œå“¥æŒ‡æ­£ã€‚å“ˆå“ˆ</p>2021-06-02</li><br/><li><span>pedro</span> ğŸ‘ï¼ˆ17ï¼‰ ğŸ’¬ï¼ˆ5ï¼‰<p>æ—©èµ·çœ‹ä¸“æ ï¼
å…ˆå›ç­”æ€è€ƒé¢˜ï¼Œgrubæ˜¯multibootè§„èŒƒï¼Œå› æ­¤å¼•å¯¼å™¨å¤´éƒ¨æ•°æ®å¿…é¡»å¾—æ»¡è¶³ä¸€å®šçš„è§„åˆ™æ‰èƒ½è¢«grubæ‰€åŠ è½½ï¼Œæœ¬æ–‡ä¸­çš„MBT_HDR_FLAGSä¸º0x001003ï¼Œç¬¬16ä½è¢«ç½®ä¸º1ï¼Œå› æ­¤load_addrå’Œentry_addréƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œè€Œå®ƒä»¬æ­£å¥½åˆ†åˆ«å¯¹åº”_startå’Œ_entryã€‚
å…¶ä¸­load_addræ˜¯å¼•å¯¼å™¨äºŒè¿›åˆ¶æ–‡ä»¶textæ®µçš„èµ·å§‹åœ°å€ï¼Œå³_startï¼Œgrubè§£æå¤´éƒ¨æ•°æ®åï¼Œæ‹¿åˆ°_startåœ°å€ï¼Œå¹¶ä»è¯¥åœ°å€å¤„å¼€å§‹æ‰§è¡ŒäºŒçº§å¼•å¯¼å™¨ä»£ç ã€‚
è€Œentry_addrå¯¹åº”çš„æ˜¯æ“ä½œç³»ç»Ÿçš„å…¥å£ç‚¹ï¼Œä¹Ÿå°±æ˜¯_entryã€‚å¼•å¯¼ç¨‹åºæœ€åå°†è·³è½¬åˆ°è¿™é‡Œï¼Œä¸è¿‡æœ¬æ–‡çš„å®ç°å¹¶æ²¡æœ‰å®Œå…¨æŒ‰ç…§è¿™ç§æ€è·¯æ¥ï¼Œ_startç›´æ¥è·³åˆ°_entryï¼Œç„¶åç”±_entryè´Ÿè´£äºŒçº§å¼•å¯¼å·¥ä½œã€‚</p>2021-06-02</li><br/><li><span>Amerny</span> ğŸ‘ï¼ˆ13ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>æ„Ÿè§‰ä»£ç ä¹Ÿçœ‹ä¸æ‡‚ï¼Œç¨€é‡Œç³Šæ¶‚çš„ï¼Œæ˜¯ä¸æ˜¯å¾—éœ€è¦æŠŠä»£ç çœ‹æ‡‚äº†æ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥å‘€ï¼Œè„‘å­ä¸å¤Ÿç”¨äº†</p>2021-09-18</li><br/><li><span>æ™¶</span> ğŸ‘ï¼ˆ6ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>å¯¹åº”grub2çš„ä»£ç å®šä¹‰ç»“æ„ï¼š
struct multiboot_header
{
  multiboot_uint32_t magic; &#47;&#47; é­”æ•° 0xE85250D6	  
  multiboot_uint32_t architecture; &#47;&#47; æ¶æ„ 0è¡¨ç¤ºx86
  multiboot_uint32_t header_length; &#47;&#47; è¡¨ç¤ºmb header é•¿åº¦
  multiboot_uint32_t checksum; &#47;&#47; æ ¡éªŒå’Œ
};

åœ¨ ä¹‹åæ˜¯multiboot_header_tagï¼Œ
struct multiboot_header_tag_address
{
    multiboot_uint16_t type;    &#47;&#47; 2 è¡¨ç¤º  multiboot_header_tag_address
    multiboot_uint16_t flags;   &#47;&#47; 0 
    multiboot_uint32_t size;    &#47;&#47; 24
    multiboot_uint32_t header_addr;  &#47;&#47; mbhdr
    multiboot_uint32_t load_addr;    &#47;&#47; _start
    multiboot_uint32_t load_end_addr; &#47;&#47; 0 è¡¨ç¤ºæ•°æ®æ®µ å’Œ ä»£ç æ®µä¸€æ · å ç”¨æ•´ä¸ªç©ºé—´
    multiboot_uint32_t bss_end_addr;  &#47;&#47; 0 
};

å†ä¹‹åæ˜¯ multiboot_header_tag_entry_address
struct multiboot_header_tag_entry_address
{
  multiboot_uint16_t type;  &#47;&#47; type = 3 è¡¨ç¤º multiboot_header_tag_entry_address
  multiboot_uint16_t flags; 
  multiboot_uint32_t size;
  multiboot_uint32_t entry_addr;
};

mbhdr:
    DD  0xE85250D6	  magic
    DD  0  architecture
    DD  mhdrend - mbhdr    header_length
    DD  -(0xE85250D6 + 0 + (mhdrend - mbhdr))     checksum
   
  ï¼›multiboot_header_tag
    DW  2, 0    ; type = 2 ;flag  = 0;
    DD  24      ; size =24
    DD  mbhdr
    DD  _start
    DD  0
    DD  0

  ;multiboot_header_tag_entry_address
    DW  3, 0    ;;type = 3 flag = 0
    DD  12
    DD  _entry  ; entry_addr = _entry  
    
  ;
    DD      0  
    DW  0, 0
    DD  8</p>2021-08-24</li><br/><li><span>æ²ˆç•…</span> ğŸ‘ï¼ˆ5ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>å¦‚æœæˆ‘ä»¬ä¸ç”¨grubä½œä¸ºå¼•å¯¼ç¨‹åºï¼Œè‡ªå·±å†™ä¸€ä¸ªå¼•å¯¼ç¨‹åºï¼Œåœ¨å®æ¨¡å¼ä¸‹ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥ç›´æ¥è°ƒç”¨boisä¸­æ–­æ”¶é›†ç¡¬ä»¶ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦åé¢åœ¨ä¿æŠ¤æ¨¡å¼ä¸‹åˆ‡æ¢å›å®æ¨¡å¼ï¼Œå†æ”¶é›†ï¼Ÿ</p>2021-08-15</li><br/><li><span>ç†Šå…‰çº¢</span> ğŸ‘ï¼ˆ5ï¼‰ ğŸ’¬ï¼ˆ4ï¼‰<p>è¯·é—®è€å¸ˆï¼Œå¦‚ä½•è°ƒè¯•å†…æ ¸ï¼Ÿæ€ä¹ˆæ­å»ºè°ƒè¯•ç¯å¢ƒ</p>2021-06-03</li><br/><li><span>Qfeng</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è¿™ç¯‡æ–‡ç« å¼€å§‹çƒ§è„‘äº†ï¼Œå…¨æ–‡æ±‡ç¼–ï¼Œç¬¬ä¸€æ¬¡çœ‹è¿™ç¯‡äº‘é‡Œé›¾é‡Œä¸çŸ¥æ‰€äº‘ï¼Œæ±‡ç¼–åŸºç¡€å·®å†³å¿ƒå›å¤´èŠ±äº†3ä¸ªç¤¼æ‹œå•ƒå®Œäº†ã€Šæ±‡ç¼–åŸç†ã€‹ï¼Œè¿™å‘¨å†æ¬¡çœ‹è¿™ç¯‡åˆç†è§£äº†äº›ã€‚
å’Œã€Šæ±‡ç¼–åŸç†ã€‹ä¹¦ä¸Šä»‹ç»çš„8086ä¸åŒï¼Œè¿™ç¯‡é‡Œé¢æ˜¯32ä½çš„x86ï¼Œä¸è¿‡åº•å±‚åŸç†å·®ä¸å¤šã€‚

å¯¹ç€è¿™ç¯‡æ–‡ç« ç»“åˆæºç ï¼Œç”»äº†ä¸€ä»½visioæµç¨‹å›¾ï¼Œæµç¨‹ä¸Šæ¸…æ™°äº†äº›ï¼Œæ€»ç»“å¦‚ä¸‹ï¼š
1. å®ç°äº†è¢«GRUBè¯†åˆ«çš„GRUB Headï¼ŒGRUB Headé‡Œé¢åšäº†2ä»¶äº‹ï¼š
1ï¼‰inithead.cï¼Œä»å†…å­˜ä¸­æŸ¥æ‰¾å’Œæ‹·è´2ä¸ªbinæ–‡ä»¶ï¼ˆäºŒçº§å¼•å¯¼å™¨å’ŒBIOSä¸­æ–­æœåŠ¡ç¨‹åºçš„binæ–‡ä»¶ï¼‰åˆ°æŒ‡å®šä½ç½®ï¼›
2ï¼‰è·³è½¬åˆ°ç‰©ç†åœ°å€0x200000æ‰§è¡ŒäºŒçº§å¼•å¯¼å™¨ä»£ç ï¼ˆç¬¬ä¸€æ­¥å·²ç»å°†æœºå™¨ç æ‹·è´åˆ°è¿™é‡Œï¼‰ã€‚

2. äºŒçº§å¼•å¯¼å™¨ ldrkrl32.asm (0x200000)
1ï¼‰å¼•å¯¼ä¸»å‡½æ•°ldrkrl_entry()   ï¼ˆæš‚æœªå®ç°ï¼‰ï¼›
2ï¼‰å‡†å¤‡BIOSä¸­æ–­æœåŠ¡ç¨‹åºè°ƒç”¨æ¡†æ¶ï¼Œæ ¸å¿ƒæ˜¯é€šè¿‡ jmp 0x18:0x1000 è·³è½¬åˆ° BIOSä¸­æ–­æœåŠ¡ç¨‹åºï¼ˆreadintsve.asmï¼‰æ‰€åœ¨ä½ç½®æ‰§è¡Œã€‚

3. BIOSç»ˆç«¯æœåŠ¡ç¨‹åº readintsve.asm (0x18:0x1000)
1ï¼‰é¦–å…ˆè¿›å…¥16ä½å®æ¨¡å¼ï¼›
2ï¼‰å®æ¨¡å¼ä¸‹ï¼Œæœ‰ä¸€ä¸ªfunc_tableï¼Œé€šè¿‡è¿™äº›å‡½æ•°å¯ä»¥è·å–å†…å­˜ã€ç¡¬ç›˜å’Œæ˜¾å¡ç­‰ç¡¬ä»¶ä¿¡æ¯ï¼›
3ï¼‰æœ€åè¿”å›32ä½ä¿æŠ¤æ¨¡å¼ï¼Œæ¢å¤è¿›å…¥å‰ä¿å­˜çš„EIS+EIPè¿”å›è°ƒç”¨å‰çš„32ä½ä¿æŠ¤æ¨¡å¼çŠ¶æ€ã€‚

æ€è€ƒé¢˜ï¼š_startå’Œ_entryçš„ç”¨é€”æ˜¯GRUBç”¨æ¥è¯†åˆ«ç¡¬ä»¶å‚å•†å®¢åˆ¶åŒ–çš„GRUBå¤´çš„ï¼Œä½œä¸ºå‚å•†äºŒçº§å¼•å¯¼å™¨çš„å…¥å£ï¼Œè¯¦ç»†ä¿¡æ¯ä¸Šé¢å·²ç»æœ‰å¾ˆå¤šå¤§ä½¬è§£é‡Šçš„å¾ˆè¯¦ç»†å°±ä¸å†™äº†ã€‚</p>2022-05-08</li><br/><li><span>Geek_e42826</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>make æŠ¥é”™æŒ‡å—
1, éœ€è¦å…ˆå®‰è£…nasmã€‚sudo apt install nasm 
```c
hello@hello-VirtualBox:~&#47;01OS&#47;01HelloOS&#47;cosmos&#47;lesson10~11&#47;Cosmos$ make all 
æ¸…ç†å…¨éƒ¨å·²æ„å»ºæ–‡ä»¶... ^_^
*********æ­£åœ¨å¼€å§‹ç¼–è¯‘æ„å»ºç³»ç»Ÿ*************
make[3]: nasm: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•
make[3]: *** [krnlbuidrule.mh:10ï¼šimginithead.o] é”™è¯¯ 127
make[2]: *** [Makefile:27ï¼šall] é”™è¯¯ 2
make[1]: *** [Makefile.x86:22ï¼šall] é”™è¯¯ 2
make: *** [Makefile:58ï¼šall] é”™è¯¯ 2
```
2ï¼Œéœ€è¦å®‰è£…gccã€‚sudo apt install gcc
```c
hello@hello-VirtualBox:~&#47;01OS&#47;01HelloOS&#47;cosmos&#47;lesson10~11&#47;Cosmos$ make all 
æ¸…ç†å…¨éƒ¨å·²æ„å»ºæ–‡ä»¶... ^_^
*********æ­£åœ¨å¼€å§‹ç¼–è¯‘æ„å»ºç³»ç»Ÿ*************
AS -[M] æ­£åœ¨æ„å»º... ..&#47;ldrkrl&#47;imginithead.asm
make[3]: gcc: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•
make[3]: *** [krnlbuidrule.mh:13ï¼šinithead.o] é”™è¯¯ 127
make[2]: *** [Makefile:27ï¼šall] é”™è¯¯ 2
make[1]: *** [Makefile.x86:22ï¼šall] é”™è¯¯ 2
make: *** [Makefile:58ï¼šall] é”™è¯¯ 2
```

3ã€makeæˆåŠŸæ˜¾ç¤ºå¦‚ä¸‹
```c
hello@hello-VirtualBox:~&#47;01OS&#47;01HelloOS&#47;cosmos&#47;lesson10~11&#47;Cosmos$ make all 
æ¸…ç†å…¨éƒ¨å·²æ„å»ºæ–‡ä»¶... ^_^
*********æ­£åœ¨å¼€å§‹ç¼–è¯‘æ„å»ºç³»ç»Ÿ*************
AS -[M] æ­£åœ¨æ„å»º... ..&#47;ldrkrl&#47;imginithead.asm
CC -[M] æ­£åœ¨æ„å»º... ..&#47;ldrkrl&#47;inithead.c
CC -[M] æ­£åœ¨æ„å»º... ..&#47;ldrkrl&#47;vgastr.c
AS -[M] æ­£åœ¨æ„å»º... ..&#47;ldrkrl&#47;ldrkrl32.asm
CC -[M] æ­£åœ¨æ„å»º... ..&#47;ldrkrl&#47;ldrkrlentry.c
CC -[M] æ­£åœ¨æ„å»º... ..&#47;ldrkrl&#47;fs.c
CC -[M] æ­£åœ¨æ„å»º... ..&#47;ldrkrl&#47;chkcpmm.c
CC -[M] æ­£åœ¨æ„å»º... ..&#47;ldrkrl&#47;graph.c
CC -[M] æ­£åœ¨æ„å»º... ..&#47;ldrkrl&#47;bstartparm.c
AS -[M] æ­£åœ¨æ„å»º... ..&#47;ldrkrl&#47;realintsve.asm
OBJCOPY -[M] æ­£åœ¨æ„å»º... initldrimh.bin
OBJCOPY -[M] æ­£åœ¨æ„å»º... initldrkrl.bin
OBJCOPY -[M] æ­£åœ¨æ„å»º... initldrsve.bin
æ–‡ä»¶æ•°ï¼š2
æ˜ åƒæ–‡ä»¶å¤§å°ï¼š20480
æ­å–œæˆ‘ï¼Œç³»ç»Ÿç¼–è¯‘æ„å»ºå®Œæˆï¼ ^_^
æ­å–œæˆ‘ï¼Œç³»ç»Ÿç¼–è¯‘æ„å»ºå®Œæˆï¼ ^_^
æ­å–œæˆ‘ï¼Œç³»ç»Ÿç¼–è¯‘æ„å»ºå®Œæˆï¼ ^_^
hello@hello-VirtualBox:~&#47;01OS&#47;01HelloOS&#47;cosmos&#47;less
```
</p>2021-12-07</li><br/><li><span>Jayying</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>ä¸å¤§ä¼šæ±‡ç¼–è¯­è¨€ï¼Œæ„Ÿè§‰çœ‹æ±‡ç¼–è¿˜æœ‰äº›éš¾åº¦</p>2021-07-31</li><br/><li><span>ğŸ‹ ğŸ‹ ğŸ‹</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆ lmoskrlimgï¼šæœªæ‰¾åˆ°å‘½ä»¤   æ˜¯ä¸ºä»€ä¹ˆå‘€</p>2021-07-27</li><br/><li><span>Geek_032c4a</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è¯·é—®ä¸‹lmoskrlimgæºä»£ç æ˜¯å“ªä¸ªï¼Œæˆ‘æœäº†ä¸€åœˆæ²¡çœ‹åˆ°å·¥å…·çš„æºä»£ç ï¼Œæ˜¯åªç»™äº†ä¸ªäºŒè¿›åˆ¶å—ï¼Ÿ</p>2021-06-17</li><br/><li><span>blentle</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è¶Šæ¥è¶Šæœ‰æ„æ€äº†</p>2021-06-02</li><br/><li><span>X</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>make è€å¸ˆç»™çš„å·¥å…·çš„æ—¶å€™å„ç§é—®é¢˜å•Šã€‚

ç¬¬ä¸€ä¸ªé—®é¢˜ï¼š
&#47;usr&#47;include&#47;features.h:367:25: fatal error: sys&#47;cdefs.h: No such file or directory
è§£å†³æ–¹æ³•ï¼š
ç¬¬ä¸€æ­¥ï¼šsudo apt-get â€“fix-broken installï¼›
ç¬¬äºŒæ­¥ï¼šsudo apt-get install libc6-dev-i386ï¼›

é—®é¢˜å‡ºç°åŸå› æ˜¯è€å¸ˆè¿™ä¸ªå·¥å…·ä¾èµ–çš„åº“æ–‡ä»¶æ˜¯32ä½åº“ï¼Œè‡ªå·±çš„è™šæ‹Ÿæœºæ˜¯64ä½åº“ã€‚

ç¬¬äºŒä¸ªé—®é¢˜ï¼š
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `lmoskrlimg.o&#39; is incompatible with i386 output
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `imgcore.o&#39; is incompatible with i386 output
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `imgmgrhead.o&#39; is incompatible with i386 output
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `param.o&#39; is incompatible with i386 output
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `file.o&#39; is incompatible with i386 output
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `imgundo.o&#39; is incompatible with i386 output
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `memdisk.o&#39; is incompatible with i386 output
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `mem.o&#39; is incompatible with i386 output
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `limgerror.o&#39; is incompatible with i386 output
è€å¸ˆå·¥å…·ç¼–è¯‘ä¹‹åè¾“å‡ºçš„ç¼–è¯‘æ–‡ä»¶ *.o æ˜¯32ä½çš„ï¼Œå¯æ˜¯æˆ‘è‡ªå·±è™šæ‹Ÿæœºæ˜¯64ä½çš„æ¶æ„ï¼Œldè¿æ¥å™¨è¿æ¥ä¸ä¸Šã€‚
æœ‰ç‚¹æ— è¯­ï¼Œä¸€é€šç™¾åº¦æ˜¯gccçš„æ—¶å€™è¦åŠ ä¸Š -m32ï¼Œå¯æ˜¯æ‰¾ä¸åˆ°è€å¸ˆæ˜¯åœ¨å“ªé‡Œgccçš„â€¦â€¦


</p>2022-07-28</li><br/>
</ul>