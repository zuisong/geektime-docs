ä½ å¥½ï¼Œæˆ‘æ˜¯LMOSã€‚

ä¸ŠèŠ‚è¯¾ï¼Œæˆ‘ä»¬å»ºé€ äº†å±äºæˆ‘ä»¬çš„â€œè®¡ç®—æœºâ€ï¼Œå¹¶ä¸”åœ¨ä¸Šé¢å®‰è£…å¥½äº†GRUBã€‚è¿™èŠ‚è¯¾æˆ‘ä¼šå¸¦ä½ ä¸€èµ·å®ç°äºŒçº§å¼•å¯¼å™¨è¿™ä¸ªå…³é”®ç»„ä»¶ã€‚

çœ‹åˆ°è¿™å„¿ä½ å¯èƒ½ä¼šé—®ï¼ŒGRUBä¸æ˜¯å·²ç»æŠŠæˆ‘ä»¬çš„æ“ä½œç³»ç»ŸåŠ è½½åˆ°å†…å­˜ä¸­äº†å—ï¼Ÿæˆ‘ä»¬æœ‰äº†GRUBï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¿˜è¦å®ç°äºŒçº§å¼•å¯¼å™¨å‘¢ï¼Ÿ

è¿™é‡Œæˆ‘è¦ç»™ä½ è¯´è¯´æˆ‘çš„è§‚ç‚¹ï¼ŒäºŒçº§å¼•å¯¼å™¨ä½œä¸ºæ“ä½œç³»ç»Ÿçš„å…ˆé©±ï¼Œå®ƒéœ€è¦**æ”¶é›†æœºå™¨ä¿¡æ¯**ï¼Œç¡®å®šè¿™ä¸ªè®¡ç®—æœºèƒ½ä¸èƒ½è¿è¡Œæˆ‘ä»¬çš„æ“ä½œç³»ç»Ÿï¼Œå¯¹CPUã€å†…å­˜ã€æ˜¾å¡è¿›è¡Œä¸€äº›åˆçº§çš„é…ç½®ï¼Œæ”¾ç½®å¥½å†…æ ¸ç›¸å…³çš„æ–‡ä»¶ã€‚

å› ä¸ºæˆ‘ä»¬äºŒçº§å¼•å¯¼å™¨ä¸æ˜¯æ‰§è¡Œå…·ä½“çš„åŠ è½½ä»»åŠ¡çš„ï¼Œè€Œæ˜¯è§£æå†…æ ¸æ–‡ä»¶ã€æ”¶é›†æœºå™¨ç¯å¢ƒä¿¡æ¯ï¼Œå®ƒå…·ä½“æ”¶é›†å“ªäº›ä¿¡æ¯ï¼Œæˆ‘ä¼šåœ¨ä¸‹èŠ‚è¯¾è¯¦ç»†å±•å¼€ã€‚

## è®¾è®¡æœºå™¨ä¿¡æ¯ç»“æ„

äºŒçº§å¼•å¯¼å™¨æ”¶é›†çš„ä¿¡æ¯ï¼Œéœ€è¦åœ°ç‚¹å­˜æ”¾ï¼Œæˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€ä¸ªæ•°æ®ç»“æ„ã€‚ä¿¡æ¯æ”¾åœ¨è¿™ä¸ªæ•°æ®ç»“æ„ä¸­ï¼Œè¿™ä¸ªç»“æ„æ”¾åœ¨å†…å­˜1MBçš„åœ°æ–¹ï¼Œæ–¹ä¾¿ä»¥åä¼ ç»™æˆ‘ä»¬çš„æ“ä½œç³»ç»Ÿã€‚

ä¸ºäº†è®©ä½ æŠ“ä½é‡ç‚¹ï¼Œæˆ‘é€‰å–äº†è¿™ä¸ªæ•°æ®ç»“æ„çš„**å…³é”®ä»£ç **ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰åˆ—å‡ºè¯¥ç»“æ„çš„æ‰€æœ‰å­—æ®µï¼ˆCosmos/initldr/include/ldrtype.hï¼‰ï¼Œè¿™ä¸ªç»“æ„å¦‚ä¸‹æ‰€ç¤ºã€‚

```
typedef struct s_MACHBSTART
{
    u64_t   mb_krlinitstack;//å†…æ ¸æ ˆåœ°å€
    u64_t   mb_krlitstacksz;//å†…æ ¸æ ˆå¤§å°
    u64_t   mb_imgpadr;//æ“ä½œç³»ç»Ÿæ˜ åƒ
    u64_t   mb_imgsz;//æ“ä½œç³»ç»Ÿæ˜ åƒå¤§å°
    u64_t   mb_bfontpadr;//æ“ä½œç³»ç»Ÿå­—ä½“åœ°å€
    u64_t   mb_bfontsz;//æ“ä½œç³»ç»Ÿå­—ä½“å¤§å°
    u64_t   mb_fvrmphyadr;//æœºå™¨æ˜¾å­˜åœ°å€
    u64_t   mb_fvrmsz;//æœºå™¨æ˜¾å­˜å¤§å°
    u64_t   mb_cpumode;//æœºå™¨CPUå·¥ä½œæ¨¡å¼
    u64_t   mb_memsz;//æœºå™¨å†…å­˜å¤§å°
    u64_t   mb_e820padr;//æœºå™¨e820æ•°ç»„åœ°å€
    u64_t   mb_e820nr;//æœºå™¨e820æ•°ç»„å…ƒç´ ä¸ªæ•°
    u64_t   mb_e820sz;//æœºå™¨e820æ•°ç»„å¤§å°
    //â€¦â€¦
    u64_t   mb_pml4padr;//æœºå™¨é¡µè¡¨æ•°æ®åœ°å€
    u64_t   mb_subpageslen;//æœºå™¨é¡µè¡¨ä¸ªæ•°
    u64_t   mb_kpmapphymemsz;//æ“ä½œç³»ç»Ÿæ˜ å°„ç©ºé—´å¤§å°
    //â€¦â€¦
    graph_t mb_ghparm;//å›¾å½¢ä¿¡æ¯
}__attribute__((packed)) machbstart_t;
```

## è§„åˆ’äºŒçº§å¼•å¯¼å™¨

åœ¨å¼€å§‹å†™ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥ä»æ•´ä½“åˆ’åˆ†ä¸€ä¸‹äºŒçº§å¼•å¯¼å™¨çš„åŠŸèƒ½æ¨¡å—ï¼Œä»å…¨å±€äº†è§£ä¸‹åŠŸèƒ½åº”è¯¥æ€ä¹ˆåˆ’åˆ†ï¼Œè¿™é‡Œæˆ‘ç‰¹æ„ä¸ºä½ æ¢³ç†äº†ä¸€ä¸ªè¡¨æ ¼ã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ30ï¼‰</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/8d/c6/e648d118.jpg" width="30px"><span>å—£æ ‘</span> ğŸ‘ï¼ˆ6ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<div>å›ç­”ä¸€ä¸‹é—®é¢˜ï¼ŒGRUB å¤´ä¸­ä¸ºä»€ä¹ˆéœ€è¦ _entry æ ‡å·å’Œ _start æ ‡å·çš„åœ°å€ï¼Ÿ

æˆ‘ä»¬å®šä¹‰çš„ flags å€¼ä¸ºï¼š
MBT_HDR_FLAGS EQU 0x00010003

æ ¹æ® Multiboot Specification å®šä¹‰çš„å¤´ç»“æ„
Offset	Type	Field Name		Note
0		u32		magic			required
4		u32		flags			required
8		u32		checksum		required
12		u32		header_addr		if flags[16] is set
16		u32		load_addr		        if flags[16] is set
20		u32		load_end_addr	        if flags[16] is set
24		u32		bss_end_addr	        if flags[16] is set
28		u32		entry_addr		if flags[16] is set
32		u32		mode_type		if flags[2] is set
36		u32		width			if flags[2] is set
40		u32		height			if flags[2] is set
44		u32		depth			if flags[2] is set

flags[16] è§£é‡Šå¦‚ä¸‹ï¼š
If bit 16 in the â€˜flagsâ€™ word is set, then the fields at offsets 12-28 in the Multiboot header are valid, and the boot loader should use them instead of the fields in the actual executable header to calculate where to load the OS image. This information does not need to be provided if the kernel image is in ELF format, but it must be provided if the images is in a.out format or in some other format. Compliant boot loaders must be able to load images that either are in ELF format or contain the load address information embedded in the Multiboot header; they may also directly support other executable formats, such as particular a.out variants, but are not required to.

ä¹Ÿå°±æ˜¯å¦‚æœæˆ‘ä»¬ç”¨çš„æ˜¯æ ‡å‡†çš„ ELF æ–‡ä»¶å°±ä¸éœ€è¦æä¾›é¢å¤–çš„åœ°å€ä¿¡æ¯ï¼Œè€Œæˆ‘ä»¬ç”¨çš„æ˜¯è‡ªå·±å®šä¹‰çš„æ ¼å¼å°±éœ€è¦äººå®¶ä»å“ªé‡ŒåŠ è½½å“ªé‡Œè¿è¡Œï¼Œæ‰€ä»¥éœ€è¦å°† bit 16 ä½¿èƒ½ï¼Œå¡«å……ç›¸åº”çš„å­—æ®µã€‚

å†è§£é‡Šä¸‹ä¸¤ä¸ªå­—æ®µçš„å«ä¹‰ï¼š
load_addr
Contains the physical address of the beginning of the text segment. The offset in the OS image file at which to start loading is defined by the offset at which the header was found, minus (header_addr - load_addr). load_addr must be less than or equal to header_addr.

entry_addr
The physical address to which the boot loader should jump in order to start running the operating system.</div>2021-06-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ec/13/49e98289.jpg" width="30px"><span>neohope</span> ğŸ‘ï¼ˆ91ï¼‰ ğŸ’¬ï¼ˆ16ï¼‰<div>å¤§ä½“ä¸Šæ•´ç†äº†ä¸€ä¸‹ï¼š

1ã€grubå¯åŠ¨åï¼Œé€‰æ‹©å¯¹åº”çš„å¯åŠ¨èœå•é¡¹ï¼Œgrubä¼šé€šè¿‡è‡ªå¸¦æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨ï¼Œå®šä½åˆ°å¯¹åº”çš„ekiæ–‡ä»¶

2ã€grubä¼šå°è¯•åŠ è½½ekiæ–‡ä»¶ã€ekiæ–‡ä»¶éœ€è¦æ»¡è¶³grubå¤šåè®®å¼•å¯¼å¤´çš„æ ¼å¼è¦æ±‚ã€‘
è¿™äº›æ˜¯åœ¨imginithead.asmä¸­å®ç°çš„ï¼Œæ‰€ä»¥è¦åŒ…æ‹¬ï¼š
Aã€grubæ–‡ä»¶å¤´ï¼ŒåŒ…æ‹¬é­”æ•°ã€grub1å’Œgrub2æ”¯æŒç­‰
Bã€å®šä½çš„_startç¬¦å·ç­‰

3ã€grubæ ¡éªŒæˆåŠŸåï¼Œä¼šè°ƒç”¨_startï¼Œç„¶è·³è½¬åˆ°_entry
Aã€_entryä¸­:å…³é—­ä¸­æ–­
Bã€åŠ è½½GDT
Cã€ç„¶åè¿›å…¥_32bits_modeï¼Œæ¸…ç†å¯„å­˜å™¨ï¼Œè®¾ç½®æ ˆé¡¶
Dã€è°ƒç”¨inithead_entryã€Cã€‘

4ã€inithead_entry.c
Aã€ä»imginithead.asmè¿›å…¥åï¼Œé¦–å…ˆè¿›å…¥å‡½æ•°è°ƒç”¨inithead_entry
Bã€åˆå§‹åŒ–å…‰æ ‡ï¼Œæ¸…å±
Cã€ä»ekiæ–‡ä»¶å†…éƒ¨ï¼Œæ‰¾åˆ°initldrsve.binæ–‡ä»¶ï¼Œå¹¶åˆ†åˆ«æ‹·è´åˆ°å†…å­˜çš„æŒ‡å®šç‰©ç†åœ°å€
Dã€ä»ekiæ–‡ä»¶å†…éƒ¨ï¼Œæ‰¾åˆ°initldrkrl.binæ–‡ä»¶ï¼Œå¹¶åˆ†åˆ«æ‹·è´åˆ°å†…å­˜çš„æŒ‡å®šç‰©ç†åœ°å€
Eã€è¿”å›imginithead.asm

5ã€imginithead.asmä¸­ç»§ç»­æ‰§è¡Œ
jmp 0x200000
è€Œè¿™ä¸ªä½ç½®ï¼Œå°±æ˜¯initldrkrl.binåœ¨å†…å­˜çš„ä½ç½®ILDRKRL_PHYADR
æ‰€ä»¥åé¢è¦æ‰§è¡Œinitldrkrl.binçš„å†…å®¹

6ã€è¿™æ ·å°±åˆ°äº†ldrkrl32.asmçš„_entry
Aã€å°†GDTåŠ è½½åˆ°GDTRå¯„å­˜å™¨ã€å†…å­˜ã€‘
Bã€å°†IDTåŠ è½½åˆ°IDTRå¯„å­˜å™¨ã€ä¸­æ–­ã€‘
Cã€è·³è½¬åˆ°_32bits_mode
åˆå§‹å¯„å­˜å™¨
åˆå§‹åŒ–æ ˆ
è°ƒç”¨ldrkrl_entryã€Cã€‘

7ã€ldrkrlentry.c
Aã€åˆå§‹åŒ–å…‰æ ‡ï¼Œæ¸…å±
Bã€æ”¶é›†æœºå™¨å‚æ•°init_bstartparmã€Cã€‘

8ã€bstartparm.c
Aã€åˆå§‹åŒ–machbstart_t
Bã€å„ç±»åˆå§‹åŒ–å‡½æ•°ï¼Œå¡«å……machbstart_tçš„å†…å®¹
Cã€è¿”å›

9ã€ldrkrlentry.c
Aã€è¿”å›

10ã€ldrkrl32.asm
Aã€è·³è½¬åˆ°0x2000000åœ°å€ç»§ç»­æ‰§è¡Œ</div>2021-06-02</li><br/><li><img src="" width="30px"><span>springXu</span> ğŸ‘ï¼ˆ20ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<div>çœŸå®è¿›å…¥å®é™…å†™ä»£ç çš„è¯¾ç¨‹äº†ã€‚
å¯¹äºgrubçš„å¤´æ ¼å¼åœ¨çš„ç¬¬äºŒèŠ‚å†™ä¸ªHelloOS.binå°±å·²ç»æœ‰äº†ï¼Œè¿™æ¬¡å¤´æ ¼å¼è¿˜æ˜¯ä¼šæœ‰ã€‚ç†ç”±æ˜¯grubæ˜¯ä¸€çº§å¼•å¯¼å™¨ã€‚
è¿™èŠ‚è¯¾çš„å†…å®¹å°±æ˜¯å›´ç»•ç€ç”±ä¸€çº§è½¬åˆ°äºŒçº§å¼•å¯¼å™¨çš„è¿‡ç¨‹å±•å¼€äº†ã€‚
å…³äºäºŒçº§å¼•å¯¼å™¨çš„åŠ è½½è¿‡ç¨‹ï¼Œç®€å•ç‚¹è¯´å°±æ˜¯æŠŠæˆ‘ä»¬å†…æ ¸åŠ è½½åˆ°æŒ‡å®šå†…å­˜çš„ä½ç½®å¹¶æ‰§è¡Œï¼Œè¿™ä¸ªåŠ è½½å‡½æ•°æ ¸å¿ƒæ˜¯m2mcopyå‡½æ•°ï¼Œä¸œå“¥ç•™ç»™æˆ‘ä»¬è‡ªå·±åˆ†æäº†ï¼Œä½†ä¸œå“¥å¼ºè°ƒåˆ†æäº†ä¸‹ä¸ºä»€ä¹ˆä¼šæœ‰32ä½ä¸‹çš„ä»£ç å’Œ16ä½æ±‡ç¼–ä»£ç å…±å­˜çš„ç°è±¡ã€‚ å…¶å®æ˜¯ä¸ºäº†è®©BIOSæä¾›çš„è·å–ç¡¬ä»¶ä¿¡æ¯çš„æ“ä½œå‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯å®æ¨¡å¼ä¸‹çš„BIOSä¸­æ–­å·æ¥è·å–çš„ï¼‰åšæˆäº†cè¯­è¨€ç¯å¢ƒä¸‹ä¹Ÿå¯ä»¥è°ƒç”¨çš„åŠŸèƒ½ã€‚è¿™å°±åƒè·¨è¯­è¨€äº’ç›¸è°ƒç”¨çš„æŠ€æœ¯ã€‚æ±‡ç¼–è°ƒç”¨cè¯­è¨€çš„æ–¹æ³•ï¼Œåè¿‡æ¥cè¯­è¨€è°ƒç”¨æ±‡ç¼–æ–¹æ³•ã€‚ä½†æ›´ä¸ºå¤æ‚äº›ï¼ŒåŸå› æ˜¯ä¿æŠ¤æ¨¡å¼åˆ°å®æ¨¡å¼å†å›åˆ°ä¿æŠ¤æ¨¡å¼çš„åˆ‡æ¢è¿‡ç¨‹ã€‚å†…æ ¸å¯ä»¥è·å–ç¡¬ä»¶ä¿¡æ¯å°±å¯ä»¥æ ¹æ®ç¡¬ä»¶ç¯å¢ƒå‚æ•°ï¼Œé…ç½®è‡ªèº«å‚æ•°å¼€å§‹å·¥ä½œäº†ã€‚å¦‚ä½•é…ç½®å‚æ•°ï¼Œé‚£åˆæ˜¯ä¸‹èŠ‚ç»§ç»­æ’­è®²ã€‚å‘¨äº”è§ã€‚
å…³äºæ€è€ƒé¢˜ï¼Œè¿™ä¸ªæ˜¯grubä¹Ÿæ˜¯è¦æŠŠæ§åˆ¶æƒäº¤ç»™æˆ‘ä»¬äºŒçº§å¼•å¯¼å™¨çš„å…¥å£åœ°å€ã€‚ è‡³äºä¸ºä»€ä¹ˆä¸å…‰æœ‰ä¸€ä¸ª_startå°±å¯ä»¥äº†ï¼Œæˆ‘çŒœæµ‹æ˜¯ä¸ºäº†åšéªŒè¯å§ã€‚_startçš„æ“ä½œæ˜¯jmp åœ°å€ã€‚è¿™ä¸ªåœ°å€æ­£å¥½æ˜¯_entryã€‚æœ‰é”™è¯¯è¿˜è¯·ä¸œå“¥æŒ‡æ­£ã€‚å“ˆå“ˆ</div>2021-06-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg" width="30px"><span>pedro</span> ğŸ‘ï¼ˆ17ï¼‰ ğŸ’¬ï¼ˆ5ï¼‰<div>æ—©èµ·çœ‹ä¸“æ ï¼
å…ˆå›ç­”æ€è€ƒé¢˜ï¼Œgrubæ˜¯multibootè§„èŒƒï¼Œå› æ­¤å¼•å¯¼å™¨å¤´éƒ¨æ•°æ®å¿…é¡»å¾—æ»¡è¶³ä¸€å®šçš„è§„åˆ™æ‰èƒ½è¢«grubæ‰€åŠ è½½ï¼Œæœ¬æ–‡ä¸­çš„MBT_HDR_FLAGSä¸º0x001003ï¼Œç¬¬16ä½è¢«ç½®ä¸º1ï¼Œå› æ­¤load_addrå’Œentry_addréƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œè€Œå®ƒä»¬æ­£å¥½åˆ†åˆ«å¯¹åº”_startå’Œ_entryã€‚
å…¶ä¸­load_addræ˜¯å¼•å¯¼å™¨äºŒè¿›åˆ¶æ–‡ä»¶textæ®µçš„èµ·å§‹åœ°å€ï¼Œå³_startï¼Œgrubè§£æå¤´éƒ¨æ•°æ®åï¼Œæ‹¿åˆ°_startåœ°å€ï¼Œå¹¶ä»è¯¥åœ°å€å¤„å¼€å§‹æ‰§è¡ŒäºŒçº§å¼•å¯¼å™¨ä»£ç ã€‚
è€Œentry_addrå¯¹åº”çš„æ˜¯æ“ä½œç³»ç»Ÿçš„å…¥å£ç‚¹ï¼Œä¹Ÿå°±æ˜¯_entryã€‚å¼•å¯¼ç¨‹åºæœ€åå°†è·³è½¬åˆ°è¿™é‡Œï¼Œä¸è¿‡æœ¬æ–‡çš„å®ç°å¹¶æ²¡æœ‰å®Œå…¨æŒ‰ç…§è¿™ç§æ€è·¯æ¥ï¼Œ_startç›´æ¥è·³åˆ°_entryï¼Œç„¶åç”±_entryè´Ÿè´£äºŒçº§å¼•å¯¼å·¥ä½œã€‚</div>2021-06-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/cf/c5/8691f309.jpg" width="30px"><span>Amerny</span> ğŸ‘ï¼ˆ13ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>æ„Ÿè§‰ä»£ç ä¹Ÿçœ‹ä¸æ‡‚ï¼Œç¨€é‡Œç³Šæ¶‚çš„ï¼Œæ˜¯ä¸æ˜¯å¾—éœ€è¦æŠŠä»£ç çœ‹æ‡‚äº†æ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥å‘€ï¼Œè„‘å­ä¸å¤Ÿç”¨äº†</div>2021-09-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/29/00/eb/5cec6300.jpg" width="30px"><span>æ™¶</span> ğŸ‘ï¼ˆ6ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>å¯¹åº”grub2çš„ä»£ç å®šä¹‰ç»“æ„ï¼š
struct multiboot_header
{
  multiboot_uint32_t magic; &#47;&#47; é­”æ•° 0xE85250D6	  
  multiboot_uint32_t architecture; &#47;&#47; æ¶æ„ 0è¡¨ç¤ºx86
  multiboot_uint32_t header_length; &#47;&#47; è¡¨ç¤ºmb header é•¿åº¦
  multiboot_uint32_t checksum; &#47;&#47; æ ¡éªŒå’Œ
};

åœ¨ ä¹‹åæ˜¯multiboot_header_tagï¼Œ
struct multiboot_header_tag_address
{
    multiboot_uint16_t type;    &#47;&#47; 2 è¡¨ç¤º  multiboot_header_tag_address
    multiboot_uint16_t flags;   &#47;&#47; 0 
    multiboot_uint32_t size;    &#47;&#47; 24
    multiboot_uint32_t header_addr;  &#47;&#47; mbhdr
    multiboot_uint32_t load_addr;    &#47;&#47; _start
    multiboot_uint32_t load_end_addr; &#47;&#47; 0 è¡¨ç¤ºæ•°æ®æ®µ å’Œ ä»£ç æ®µä¸€æ · å ç”¨æ•´ä¸ªç©ºé—´
    multiboot_uint32_t bss_end_addr;  &#47;&#47; 0 
};

å†ä¹‹åæ˜¯ multiboot_header_tag_entry_address
struct multiboot_header_tag_entry_address
{
  multiboot_uint16_t type;  &#47;&#47; type = 3 è¡¨ç¤º multiboot_header_tag_entry_address
  multiboot_uint16_t flags; 
  multiboot_uint32_t size;
  multiboot_uint32_t entry_addr;
};

mbhdr:
    DD  0xE85250D6	  magic
    DD  0  architecture
    DD  mhdrend - mbhdr    header_length
    DD  -(0xE85250D6 + 0 + (mhdrend - mbhdr))     checksum
   
  ï¼›multiboot_header_tag
    DW  2, 0    ; type = 2 ;flag  = 0;
    DD  24      ; size =24
    DD  mbhdr
    DD  _start
    DD  0
    DD  0

  ;multiboot_header_tag_entry_address
    DW  3, 0    ;;type = 3 flag = 0
    DD  12
    DD  _entry  ; entry_addr = _entry  
    
  ;
    DD      0  
    DW  0, 0
    DD  8</div>2021-08-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/72/c1/59509397.jpg" width="30px"><span>æ²ˆç•…</span> ğŸ‘ï¼ˆ5ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>å¦‚æœæˆ‘ä»¬ä¸ç”¨grubä½œä¸ºå¼•å¯¼ç¨‹åºï¼Œè‡ªå·±å†™ä¸€ä¸ªå¼•å¯¼ç¨‹åºï¼Œåœ¨å®æ¨¡å¼ä¸‹ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥ç›´æ¥è°ƒç”¨boisä¸­æ–­æ”¶é›†ç¡¬ä»¶ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦åé¢åœ¨ä¿æŠ¤æ¨¡å¼ä¸‹åˆ‡æ¢å›å®æ¨¡å¼ï¼Œå†æ”¶é›†ï¼Ÿ</div>2021-08-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/27/f1/24/07ce02a0.jpg" width="30px"><span>ç†Šå…‰çº¢</span> ğŸ‘ï¼ˆ5ï¼‰ ğŸ’¬ï¼ˆ4ï¼‰<div>è¯·é—®è€å¸ˆï¼Œå¦‚ä½•è°ƒè¯•å†…æ ¸ï¼Ÿæ€ä¹ˆæ­å»ºè°ƒè¯•ç¯å¢ƒ</div>2021-06-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/5f/09/2ec44412.jpg" width="30px"><span>Qfeng</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è¿™ç¯‡æ–‡ç« å¼€å§‹çƒ§è„‘äº†ï¼Œå…¨æ–‡æ±‡ç¼–ï¼Œç¬¬ä¸€æ¬¡çœ‹è¿™ç¯‡äº‘é‡Œé›¾é‡Œä¸çŸ¥æ‰€äº‘ï¼Œæ±‡ç¼–åŸºç¡€å·®å†³å¿ƒå›å¤´èŠ±äº†3ä¸ªç¤¼æ‹œå•ƒå®Œäº†ã€Šæ±‡ç¼–åŸç†ã€‹ï¼Œè¿™å‘¨å†æ¬¡çœ‹è¿™ç¯‡åˆç†è§£äº†äº›ã€‚
å’Œã€Šæ±‡ç¼–åŸç†ã€‹ä¹¦ä¸Šä»‹ç»çš„8086ä¸åŒï¼Œè¿™ç¯‡é‡Œé¢æ˜¯32ä½çš„x86ï¼Œä¸è¿‡åº•å±‚åŸç†å·®ä¸å¤šã€‚

å¯¹ç€è¿™ç¯‡æ–‡ç« ç»“åˆæºç ï¼Œç”»äº†ä¸€ä»½visioæµç¨‹å›¾ï¼Œæµç¨‹ä¸Šæ¸…æ™°äº†äº›ï¼Œæ€»ç»“å¦‚ä¸‹ï¼š
1. å®ç°äº†è¢«GRUBè¯†åˆ«çš„GRUB Headï¼ŒGRUB Headé‡Œé¢åšäº†2ä»¶äº‹ï¼š
1ï¼‰inithead.cï¼Œä»å†…å­˜ä¸­æŸ¥æ‰¾å’Œæ‹·è´2ä¸ªbinæ–‡ä»¶ï¼ˆäºŒçº§å¼•å¯¼å™¨å’ŒBIOSä¸­æ–­æœåŠ¡ç¨‹åºçš„binæ–‡ä»¶ï¼‰åˆ°æŒ‡å®šä½ç½®ï¼›
2ï¼‰è·³è½¬åˆ°ç‰©ç†åœ°å€0x200000æ‰§è¡ŒäºŒçº§å¼•å¯¼å™¨ä»£ç ï¼ˆç¬¬ä¸€æ­¥å·²ç»å°†æœºå™¨ç æ‹·è´åˆ°è¿™é‡Œï¼‰ã€‚

2. äºŒçº§å¼•å¯¼å™¨ ldrkrl32.asm (0x200000)
1ï¼‰å¼•å¯¼ä¸»å‡½æ•°ldrkrl_entry()   ï¼ˆæš‚æœªå®ç°ï¼‰ï¼›
2ï¼‰å‡†å¤‡BIOSä¸­æ–­æœåŠ¡ç¨‹åºè°ƒç”¨æ¡†æ¶ï¼Œæ ¸å¿ƒæ˜¯é€šè¿‡ jmp 0x18:0x1000 è·³è½¬åˆ° BIOSä¸­æ–­æœåŠ¡ç¨‹åºï¼ˆreadintsve.asmï¼‰æ‰€åœ¨ä½ç½®æ‰§è¡Œã€‚

3. BIOSç»ˆç«¯æœåŠ¡ç¨‹åº readintsve.asm (0x18:0x1000)
1ï¼‰é¦–å…ˆè¿›å…¥16ä½å®æ¨¡å¼ï¼›
2ï¼‰å®æ¨¡å¼ä¸‹ï¼Œæœ‰ä¸€ä¸ªfunc_tableï¼Œé€šè¿‡è¿™äº›å‡½æ•°å¯ä»¥è·å–å†…å­˜ã€ç¡¬ç›˜å’Œæ˜¾å¡ç­‰ç¡¬ä»¶ä¿¡æ¯ï¼›
3ï¼‰æœ€åè¿”å›32ä½ä¿æŠ¤æ¨¡å¼ï¼Œæ¢å¤è¿›å…¥å‰ä¿å­˜çš„EIS+EIPè¿”å›è°ƒç”¨å‰çš„32ä½ä¿æŠ¤æ¨¡å¼çŠ¶æ€ã€‚

æ€è€ƒé¢˜ï¼š_startå’Œ_entryçš„ç”¨é€”æ˜¯GRUBç”¨æ¥è¯†åˆ«ç¡¬ä»¶å‚å•†å®¢åˆ¶åŒ–çš„GRUBå¤´çš„ï¼Œä½œä¸ºå‚å•†äºŒçº§å¼•å¯¼å™¨çš„å…¥å£ï¼Œè¯¦ç»†ä¿¡æ¯ä¸Šé¢å·²ç»æœ‰å¾ˆå¤šå¤§ä½¬è§£é‡Šçš„å¾ˆè¯¦ç»†å°±ä¸å†™äº†ã€‚</div>2022-05-08</li><br/><li><img src="" width="30px"><span>Geek_e42826</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>make æŠ¥é”™æŒ‡å—
1, éœ€è¦å…ˆå®‰è£…nasmã€‚sudo apt install nasm 
```c
hello@hello-VirtualBox:~&#47;01OS&#47;01HelloOS&#47;cosmos&#47;lesson10~11&#47;Cosmos$ make all 
æ¸…ç†å…¨éƒ¨å·²æ„å»ºæ–‡ä»¶... ^_^
*********æ­£åœ¨å¼€å§‹ç¼–è¯‘æ„å»ºç³»ç»Ÿ*************
make[3]: nasm: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•
make[3]: *** [krnlbuidrule.mh:10ï¼šimginithead.o] é”™è¯¯ 127
make[2]: *** [Makefile:27ï¼šall] é”™è¯¯ 2
make[1]: *** [Makefile.x86:22ï¼šall] é”™è¯¯ 2
make: *** [Makefile:58ï¼šall] é”™è¯¯ 2
```
2ï¼Œéœ€è¦å®‰è£…gccã€‚sudo apt install gcc
```c
hello@hello-VirtualBox:~&#47;01OS&#47;01HelloOS&#47;cosmos&#47;lesson10~11&#47;Cosmos$ make all 
æ¸…ç†å…¨éƒ¨å·²æ„å»ºæ–‡ä»¶... ^_^
*********æ­£åœ¨å¼€å§‹ç¼–è¯‘æ„å»ºç³»ç»Ÿ*************
AS -[M] æ­£åœ¨æ„å»º... ..&#47;ldrkrl&#47;imginithead.asm
make[3]: gcc: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•
make[3]: *** [krnlbuidrule.mh:13ï¼šinithead.o] é”™è¯¯ 127
make[2]: *** [Makefile:27ï¼šall] é”™è¯¯ 2
make[1]: *** [Makefile.x86:22ï¼šall] é”™è¯¯ 2
make: *** [Makefile:58ï¼šall] é”™è¯¯ 2
```

3ã€makeæˆåŠŸæ˜¾ç¤ºå¦‚ä¸‹
```c
hello@hello-VirtualBox:~&#47;01OS&#47;01HelloOS&#47;cosmos&#47;lesson10~11&#47;Cosmos$ make all 
æ¸…ç†å…¨éƒ¨å·²æ„å»ºæ–‡ä»¶... ^_^
*********æ­£åœ¨å¼€å§‹ç¼–è¯‘æ„å»ºç³»ç»Ÿ*************
AS -[M] æ­£åœ¨æ„å»º... ..&#47;ldrkrl&#47;imginithead.asm
CC -[M] æ­£åœ¨æ„å»º... ..&#47;ldrkrl&#47;inithead.c
CC -[M] æ­£åœ¨æ„å»º... ..&#47;ldrkrl&#47;vgastr.c
AS -[M] æ­£åœ¨æ„å»º... ..&#47;ldrkrl&#47;ldrkrl32.asm
CC -[M] æ­£åœ¨æ„å»º... ..&#47;ldrkrl&#47;ldrkrlentry.c
CC -[M] æ­£åœ¨æ„å»º... ..&#47;ldrkrl&#47;fs.c
CC -[M] æ­£åœ¨æ„å»º... ..&#47;ldrkrl&#47;chkcpmm.c
CC -[M] æ­£åœ¨æ„å»º... ..&#47;ldrkrl&#47;graph.c
CC -[M] æ­£åœ¨æ„å»º... ..&#47;ldrkrl&#47;bstartparm.c
AS -[M] æ­£åœ¨æ„å»º... ..&#47;ldrkrl&#47;realintsve.asm
OBJCOPY -[M] æ­£åœ¨æ„å»º... initldrimh.bin
OBJCOPY -[M] æ­£åœ¨æ„å»º... initldrkrl.bin
OBJCOPY -[M] æ­£åœ¨æ„å»º... initldrsve.bin
æ–‡ä»¶æ•°ï¼š2
æ˜ åƒæ–‡ä»¶å¤§å°ï¼š20480
æ­å–œæˆ‘ï¼Œç³»ç»Ÿç¼–è¯‘æ„å»ºå®Œæˆï¼ ^_^
æ­å–œæˆ‘ï¼Œç³»ç»Ÿç¼–è¯‘æ„å»ºå®Œæˆï¼ ^_^
æ­å–œæˆ‘ï¼Œç³»ç»Ÿç¼–è¯‘æ„å»ºå®Œæˆï¼ ^_^
hello@hello-VirtualBox:~&#47;01OS&#47;01HelloOS&#47;cosmos&#47;less
```
</div>2021-12-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1f/9e/ba/4b60c587.jpg" width="30px"><span>Jayying</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>ä¸å¤§ä¼šæ±‡ç¼–è¯­è¨€ï¼Œæ„Ÿè§‰çœ‹æ±‡ç¼–è¿˜æœ‰äº›éš¾åº¦</div>2021-07-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/28/3e/8a/204165cc.jpg" width="30px"><span>ğŸ‹ ğŸ‹ ğŸ‹</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆ lmoskrlimgï¼šæœªæ‰¾åˆ°å‘½ä»¤   æ˜¯ä¸ºä»€ä¹ˆå‘€</div>2021-07-27</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/dXf9e0gmVVV1ozqBIiaWiaxz1qgPZrYHT9x3ytnjfZ6quCH7gNtibXhsg66kH1E4FeTVHMB9J3PibNaMN2GthvceqA/132" width="30px"><span>Geek_032c4a</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è¯·é—®ä¸‹lmoskrlimgæºä»£ç æ˜¯å“ªä¸ªï¼Œæˆ‘æœäº†ä¸€åœˆæ²¡çœ‹åˆ°å·¥å…·çš„æºä»£ç ï¼Œæ˜¯åªç»™äº†ä¸ªäºŒè¿›åˆ¶å—ï¼Ÿ</div>2021-06-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/3e/e7/261711a5.jpg" width="30px"><span>blentle</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è¶Šæ¥è¶Šæœ‰æ„æ€äº†</div>2021-06-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/21/c5/024e1ef1.jpg" width="30px"><span>X</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>make è€å¸ˆç»™çš„å·¥å…·çš„æ—¶å€™å„ç§é—®é¢˜å•Šã€‚

ç¬¬ä¸€ä¸ªé—®é¢˜ï¼š
&#47;usr&#47;include&#47;features.h:367:25: fatal error: sys&#47;cdefs.h: No such file or directory
è§£å†³æ–¹æ³•ï¼š
ç¬¬ä¸€æ­¥ï¼šsudo apt-get â€“fix-broken installï¼›
ç¬¬äºŒæ­¥ï¼šsudo apt-get install libc6-dev-i386ï¼›

é—®é¢˜å‡ºç°åŸå› æ˜¯è€å¸ˆè¿™ä¸ªå·¥å…·ä¾èµ–çš„åº“æ–‡ä»¶æ˜¯32ä½åº“ï¼Œè‡ªå·±çš„è™šæ‹Ÿæœºæ˜¯64ä½åº“ã€‚

ç¬¬äºŒä¸ªé—®é¢˜ï¼š
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `lmoskrlimg.o&#39; is incompatible with i386 output
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `imgcore.o&#39; is incompatible with i386 output
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `imgmgrhead.o&#39; is incompatible with i386 output
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `param.o&#39; is incompatible with i386 output
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `file.o&#39; is incompatible with i386 output
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `imgundo.o&#39; is incompatible with i386 output
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `memdisk.o&#39; is incompatible with i386 output
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `mem.o&#39; is incompatible with i386 output
&#47;usr&#47;bin&#47;ld: i386:x86-64 architecture of input file `limgerror.o&#39; is incompatible with i386 output
è€å¸ˆå·¥å…·ç¼–è¯‘ä¹‹åè¾“å‡ºçš„ç¼–è¯‘æ–‡ä»¶ *.o æ˜¯32ä½çš„ï¼Œå¯æ˜¯æˆ‘è‡ªå·±è™šæ‹Ÿæœºæ˜¯64ä½çš„æ¶æ„ï¼Œldè¿æ¥å™¨è¿æ¥ä¸ä¸Šã€‚
æœ‰ç‚¹æ— è¯­ï¼Œä¸€é€šç™¾åº¦æ˜¯gccçš„æ—¶å€™è¦åŠ ä¸Š -m32ï¼Œå¯æ˜¯æ‰¾ä¸åˆ°è€å¸ˆæ˜¯åœ¨å“ªé‡Œgccçš„â€¦â€¦


</div>2022-07-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/70/c3/cc46c55a.jpg" width="30px"><span>MONKEYG</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>sudo .&#47;lmoskrlimg -m k -lhf initldrimh.bin -o Cosmos.eki -f initldrkrl.bin initldrsve.bin
.&#47;lmoskrlimg: 1: .&#47;lmoskrlimg: ELF: not found
.&#47;lmoskrlimg: 1: .&#47;lmoskrlimg: Jï¿½: not found
.&#47;lmoskrlimg: 2: .&#47;lmoskrlimg: ï¿½Jï¿½Q: not found
.&#47;lmoskrlimg: 1: .&#47;lmoskrlimg: Syntax error: word unexpected (expecting &quot;)&quot;)

è€å¸ˆèƒ½å¸®å¿™çœ‹çœ‹ä¹ˆï¼Œä¸æ¸…æ¥šä¸ºä»€ä¹ˆä¼šæŠ¥è¿™ä¸ªæ–‡ä»¶æ‰¾ä¸åˆ°</div>2022-04-11</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/dXf9e0gmVVV1ozqBIiaWiaxz1qgPZrYHT9x3ytnjfZ6quCH7gNtibXhsg66kH1E4FeTVHMB9J3PibNaMN2GthvceqA/132" width="30px"><span>Geek_032c4a</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>imginithead.asmè¿™ä¸ªæ–‡ä»¶çš„ç¨‹åºåº”è¯¥è¿è¡Œåœ¨å®æ¨¡å¼ä¸‹çš„ã€‚
1ï¼Œä¸ºå•¥åœ¨è¿˜æ²¡æœ‰è¿›å…¥ä¿æŠ¤æ¨¡å¼çš„æ—¶å€™å°±å¯ä»¥æ“ä½œespã€eaxã€ebxè¿™ç§å¯„å­˜å™¨ï¼Ÿ
2ï¼Œå®æ¨¡å¼ä¸‹å¯ä»¥ç›´æ¥è°ƒç”¨äº†inithead_entryè¿™ç§Cè¯­è¨€å‡½æ•°ï¼Ÿ</div>2021-06-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/02/5b/ce326cfc.jpg" width="30px"><span>äºŒä¸‰å­ä¹Ÿ</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆæœ‰ä¸ªé—®é¢˜ï¼š0x200000ã€‚åœ¨x86-64å¹³å°ä¸‹ï¼Œè¿™ä¸ªå€¼æ˜¯grubé»˜è®¤å°†multiboot2å®šä¹‰çš„æ–‡ä»¶åŠ è½½åˆ°çš„ä½ç½®å—ï¼Ÿå¦‚æœæ˜¯çš„è¯ï¼Œè¿™ä¸ªå€¼æ˜¯æ‰‹å†Œæä¾›çš„ï¼Ÿè¿˜æ˜¯è°ƒè¯•å‡ºæ¥çš„ï¼Ÿ</div>2021-06-02</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/J3dqALgicfVklewMjVkpyLbTk9YiamnBf5QQZ3NPHGlMeVSdLDB5yHLicEZHKBbUets76KOFwbl9ju0xJw1VeGa1A/132" width="30px"><span>é£ç¿”</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ4ï¼‰<div>lmoskrlimgè¿™ä¸ªå·¥å…·ä»å“ªé‡Œæ‰¾ï¼Œåœ¨centosä¸Šæ²¡æœ‰æ‰¾åˆ°ï¼Ÿ</div>2021-06-02</li><br/><li><img src="" width="30px"><span>Geek_b3ad17</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è¿™ä¸ªèŠ‚è¯¾æ²¡æœ‰æŠŠæ‰€æœ‰çš„ä»£ç è®²ä¸€éå§ï¼Ÿ</div>2023-11-02</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/usOGMGtGD81q7iaZ61zBspZYBYdxcFURYNnyDnVfvUNAnNDqhgUhvuuzwvibiaW8vIeDjlGP3qdQ4K2qw5HT5upicg/132" width="30px"><span>Geek_a6b4ff</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>ä¸ºä»€ä¹ˆgiteeé‡Œé¢è¿™éƒ¨åˆ†ä»£ç é‡Œé¢å’Œä½ ç»™çš„å®ç°ä¸ä¸€æ ·ï¼Œé‡Œé¢å°è£…äº†å¥½å¤šçš„hæ–‡ä»¶ï¼Œæˆ‘çœ‹å‚»äº†å‘€</div>2023-06-25</li><br/><li><img src="" width="30px"><span>Geek_97bc94</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è¯·é—®ä¸€ä¸‹ï¼Œä»£ç é‡Œæœ‰å¾ˆå¤šç¼©å†™ä¸çŸ¥é“è‹±æ–‡å…¨æ‹¼æ˜¯ä»€ä¹ˆæ€ä¹ˆåŠï¼Œæ„Ÿè§‰æœ‰ç‚¹å½±å“ç†è§£</div>2023-01-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/db/fe/90446b61.jpg" width="30px"><span>lhgdy</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>å¤§ä½¬ä»¬ï¼Œæ‰¾ä¸åˆ°æ–‡ä»¶æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ   â€œINITKLDR DIE ERROR:not find fileâ€</div>2022-12-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/ed/a2/905e32fc.jpg" width="30px"><span>å’¸é±¼</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>k16cd_dsc: dq 0x00009a000000ffff è€å¸ˆæ®µæè¿°ç¬¦9aä¸æ˜¯æ ‡å¿—Cå¯æ‰§è¡Œæ ‡å¿—ä½ä¸º0å—ï¼Œä»£ç æ®µæ€ä¹ˆèƒ½å¯æ‰§è¡Œä¸º0å‘¢</div>2022-12-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/28/ee/1b/57ea2b32.jpg" width="30px"><span>ã€€ã€€ã€€ã€€</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>ä¸çŸ¥é“æˆ‘å¯¹è¿™ä¸ªè¿‡ç¨‹ç†è§£çš„æ˜¯å¦æ­£ç¡®ã€‚
1ã€GRUBå…ˆæŠŠäºŒçº§å¼•å¯¼å™¨åŠ è½½åˆ°å†…å­˜0x4000000ä½ç½®ã€‚
2ã€GRUBè·³è½¬åˆ°0x4000000å¼€å§‹æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è·³è½¬åˆ° imginithead.asm ä¸­çš„ _startã€‚
3ã€imginithead.asm è°ƒç”¨ inithead.c ä¸­çš„ inithead_entry() å‡½æ•°ã€‚
4ã€inihead_entry() ä¸­ä¸»è¦æ˜¯åšäº†ä¸¤ä¸ªbinæ–‡ä»¶åœ¨å†…å­˜ä¸­çš„æ‹·è´ã€‚(è¿™ä¸€æ­¥ä¸å¤ªç†è§£ï¼Œå¸Œæœ›è€å¸ˆè§£æƒ‘ä¸€ä¸‹ã€‚æ˜¯ä¸æ˜¯GRUBå·²ç»æŠŠæ‰€æœ‰æˆ‘ä»¬ç¼–è¯‘ã€è¿æ¥çš„binæ–‡ä»¶éƒ½åŠ è½½åˆ°å†…å­˜ä¸­äº†ï¼Œè€å¸ˆç¨‹åºçš„è®¾å®šå°±æ˜¯ä»å†…å­˜åœ°å€0x4000000å¼€å§‹ã€‚æˆ‘ä»¬è¦åšçš„å°±æ˜¯æ ¹æ®è®¾å®šå¥½çš„æ ¼å¼ï¼Œæ‰¾åˆ°éœ€è¦çš„binæ–‡ä»¶è¢«åŠ è½½åˆ°å†…å­˜ä¸­çš„å…·ä½“ä½ç½®ã€‚å†æŠŠå®ƒåŠ è½½åˆ°å¦ä¸€ä¸ªæˆ‘ä»¬è®¾å®šå¥½çš„å†…å­˜åœ°å€ã€‚è¿˜æœ‰å°±æ˜¯æŠŠå®ƒæ‹·è´ä¸€éæ˜¯ä¸ºäº†ä»¥åæ–¹ä¾¿è°ƒç”¨å—ï¼Ÿ)</div>2022-11-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/23/7b/88/7bae8fe0.jpg" width="30px"><span>æ¿æ —</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆï¼Œè¯·é—®ä¸‹ï¼Œä¸ºä»€ä¹ˆï¼šåœ¨grubå¤´çš„imginithead.asmçš„_entryä¸­è°ƒç”¨äº†cliå…³ä¸­æ–­ï¼Œè€Œéšååœ¨äºŒçº§å¼•å¯¼å™¨çš„ldrkrl32.asmçš„_entryä¸­åˆè°ƒç”¨cliå…³ä¸­æ–­å‘¢ï¼Ÿæ˜¯ä¸æ˜¯å› ä¸ºè¿™ä¸¤æ®µä»£ç å¯èƒ½è¿è¡Œåœ¨ä¸åŒcpuï¼ˆæˆ–æ ¸ï¼‰ä¸Šï¼Œæ‰€ä»¥è¦è°ƒç”¨cliå…³æœ¬åœ°ä¸­æ–­ï¼Ÿ</div>2022-10-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/27/ee/f8/6f69be1e.jpg" width="30px"><span>Raina</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>multiboot2 çš„ tag end ä¸æ˜¯ type = 0ï¼Œflag = 0ï¼Œ size = 8 å—ï¼Œé‚£ DD _entry åé¢çš„ DD 0 æ˜¯ä¸æ˜¯å¤šä½™çš„</div>2022-07-28</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/fBOybgVTWXYXxaicaVEysXCjkKT13dX7icAj96KibJ815mia1FvYro9KcbA3xtwnIxmPJ38Vt6rmg6vp0auGKel93A/132" width="30px"><span>Geek_d26e63</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è¿è¡Œï¼šlmoskrlimg -m k -lhf initldrimh.bin -o Cosmos.eki -f initldrkrl.bin initldrsve.bin
æŠ¥é”™ï¼šLKRLIMG ERR:write ldrheadfile C file:..&#47;core&#47;imgcore.c C line:35 C function:limg_krnl_mode_run</div>2022-06-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/25/6f/a7/565214bc.jpg" width="30px"><span>â”‚ï¼Sk</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆå¥½ï¼Œè¯·æ•™ä¸€ä¸‹è€å¸ˆ grub åŠ è½½ eki æ–‡ä»¶åç©¶ç«Ÿæ˜¯ä» _entry å¼€å§‹æ‰§è¡Œçš„ï¼Œè¿˜æ˜¯ä» _start å¼€å§‹æ‰§è¡Œçš„ï¼Ÿ 

ä»æ–‡æ¡£ä¸Šçœ‹æ„Ÿè§‰ load_addr(_start) åªæ˜¯ä¸ºäº†å†³å®šä»å“ªé‡Œå¼€å§‹åŠ è½½ï¼›çœŸæ­£çš„å…¥å£åº”è¯¥æ˜¯ entry_addr(_entry) ï¼Œå¦‚æœæ˜¯è¿™æ ·çš„ _start åé¢çš„ jmp _entry æ˜¯ä¸æ˜¯ä¸è¦ä¹Ÿå¯ä»¥ï¼Ÿ 

è°¢è°¢è€å¸ˆï¼
</div>2022-05-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/25/6f/a7/565214bc.jpg" width="30px"><span>â”‚ï¼Sk</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆå¥½ï¼Œè¯·æ•™è€å¸ˆ grub æ˜¯æ€ä¹ˆçŸ¥é“è¦æŠŠæ˜ åƒæ–‡ä»¶ Cosmos.eki åŠ è½½åˆ°å“ªä¸ªç‰©ç†åœ°å€çš„å‘¢ï¼Ÿ

è²Œä¼¼ç¼–è¯‘çš„æ—¶å€™å·²ç»ç”¨ objcopy æŠŠ binary çš„ elf ä¿¡æ¯éƒ½å»æ‰äº†ï¼Œä½†æ˜¯ Cosmos.eki ä¸­çš„æŒ‡ä»¤éƒ½æ˜¯æ ¹æ® ld é“¾æ¥è„šæœ¬ç¡®å®šçš„åœ°å€ï¼Œè¿™å°±è¦æ±‚ Cosmos.eki åŠ è½½åˆ°æ­£ç¡®çš„ç‰©ç†åœ°å€æ‰èƒ½æ­£ç¡®æ‰§è¡Œï¼Œä½†æ˜¯ä¸å¤ªäº†è§£ grub æ˜¯æ€ä¹ˆçŸ¥é“è¦æŠŠæ˜ åƒæ–‡ä»¶ Cosmos.eki åŠ è½½åˆ°å“ªä¸ªç‰©ç†åœ°å€çš„ã€‚</div>2022-05-13</li><br/>
</ul>