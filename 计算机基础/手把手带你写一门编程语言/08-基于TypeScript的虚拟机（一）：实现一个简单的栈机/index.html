<!--geek time docs 🚀, MIT license-->


<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="极客时间文档">
      
      
        <meta name="author" content="zkep">
      
      
        <link rel="canonical" href="https://github.com/uaxe/geektime-docs/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E5%86%99%E4%B8%80%E9%97%A8%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/08-%E5%9F%BA%E4%BA%8ETypeScript%E7%9A%84%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%A0%88%E6%9C%BA/">
      
      
        <link rel="prev" href="../07-%E6%80%8E%E4%B9%88%E8%AE%BE%E8%AE%A1%E5%B1%9E%E4%BA%8E%E6%88%91%E4%BB%AC%E8%87%AA%E5%B7%B1%E7%9A%84%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%92%8C%E5%AD%97%E8%8A%82%E7%A0%81%EF%BC%9F/">
      
      
        <link rel="next" href="../09-%E5%9F%BA%E4%BA%8ETypeScript%E7%9A%84%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E4%B8%B0%E5%AF%8C%E7%89%B9%E6%80%A7%EF%BC%8C%E6%94%AF%E6%8C%81%E8%B7%B3%E8%BD%AC%E8%AF%AD%E5%8F%A5/">
      
      
      <link rel="icon" href="../../../None">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.5">
    
    
      
        <title>08 基于TypeScript的虚拟机（一）：实现一个简单的栈机 - 极客时间文档</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../stylesheets/style.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            


          </div>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="极客时间文档" class="md-header__button md-logo" aria-label="极客时间文档" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            极客时间文档
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              08 基于TypeScript的虚拟机（一）：实现一个简单的栈机
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/zkep/mygeektime" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    zkep/mygeektime
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../AI-%E5%A4%A7%E6%95%B0%E6%8D%AE/" class="md-tabs__link">
          
  
    
  
  AI-大数据

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E4%BA%A7%E5%93%81-%E8%BF%90%E8%90%A5/" class="md-tabs__link">
          
  
    
  
  产品-运营

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E5%89%8D%E7%AB%AF-%E7%A7%BB%E5%8A%A8/" class="md-tabs__link">
          
  
    
  
  前端-移动

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E5%90%8E%E7%AB%AF-%E6%9E%B6%E6%9E%84/" class="md-tabs__link">
          
  
    
  
  后端-架构

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E7%AE%A1%E7%90%86-%E6%88%90%E9%95%BF/" class="md-tabs__link">
          
  
    
  
  管理-成长

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
    
  
  计算机基础

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E8%BF%90%E7%BB%B4-%E6%B5%8B%E8%AF%95/" class="md-tabs__link">
          
  
    
  
  运维-测试

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="极客时间文档" class="md-nav__button md-logo" aria-label="极客时间文档" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    极客时间文档
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/zkep/mygeektime" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    zkep/mygeektime
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../AI-%E5%A4%A7%E6%95%B0%E6%8D%AE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    AI-大数据
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E4%BA%A7%E5%93%81-%E8%BF%90%E8%90%A5/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    产品-运营
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E5%89%8D%E7%AB%AF-%E7%A7%BB%E5%8A%A8/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    前端-移动
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E5%90%8E%E7%AB%AF-%E6%9E%B6%E6%9E%84/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    后端-架构
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E7%AE%A1%E7%90%86-%E6%88%90%E9%95%BF/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    管理-成长
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    计算机基础
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            计算机基础
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../MySQL%20%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/MySQL%20%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    MySQL 必知必会
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Python%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8A%9E%E5%85%AC%E5%AE%9E%E6%88%98%E8%AF%BE/Python%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8A%9E%E5%85%AC%E5%AE%9E%E6%88%98%E8%AF%BE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Python自动化办公实战课
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../Vim%20%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/Vim%20%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Vim 实用技巧必知必会
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91%E7%AE%97%E6%B3%9550%E8%AE%B2/%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91%E7%AE%97%E6%B3%9550%E8%AE%B2/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    业务开发算法50讲
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E4%BB%A3%E7%A0%81%E4%B9%8B%E4%B8%91/%E4%BB%A3%E7%A0%81%E4%B9%8B%E4%B8%91/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    代码之丑
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E4%BB%A3%E7%A0%81%E7%B2%BE%E8%BF%9B%E4%B9%8B%E8%B7%AF/%E4%BB%A3%E7%A0%81%E7%B2%BE%E8%BF%9B%E4%B9%8B%E8%B7%AF/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    代码精进之路
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8BC%2B%2B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8BC%2B%2B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    快速上手C++数据结构与算法
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_9" checked>
        
          
          <label class="md-nav__link" for="__nav_6_9" id="__nav_6_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    手把手带你写一门编程语言
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_9">
            <span class="md-nav__icon md-icon"></span>
            手把手带你写一门编程语言
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E5%86%99%E4%B8%80%E9%97%A8%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    手把手带你写一门编程语言
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%BC%80%E7%AF%87%E8%AF%8D-%E8%AE%A9%E6%88%91%E4%BB%AC%E6%9D%A5%E5%86%99%E4%B8%80%E9%97%A8%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%AD%E8%A8%80%E5%90%A7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    开篇词 让我们来写一门计算机语言吧
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%AF%BE%E5%89%8D%E7%83%AD%E8%BA%AB-%E5%BC%80%E5%A7%8B%E5%AD%A6%E4%B9%A0%E4%B9%8B%E5%89%8D%E6%88%91%E4%BB%AC%E8%A6%81%E5%87%86%E5%A4%87%E4%BB%80%E4%B9%88%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    课前热身 开始学习之前我们要准备什么？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-%E5%AE%9E%E7%8E%B0%E4%B8%80%E9%97%A8%E8%B6%85%E7%AE%80%E5%8D%95%E7%9A%84%E8%AF%AD%E8%A8%80%E6%9C%80%E5%BF%AB%E9%9C%80%E8%A6%81%E5%A4%9A%E4%B9%85%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    01 实现一门超简单的语言最快需要多久？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90%EF%BC%9A%E8%AF%86%E5%88%ABToken%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%BE%88%E7%AE%80%E5%8D%95%E5%90%97%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    02 词法分析：识别Token也可以很简单吗？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-%E6%94%AF%E6%8C%81%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%9A%E8%A7%A3%E6%9E%90%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%92%8C%E8%A7%A3%E6%9E%90%E8%AF%AD%E5%8F%A5%E6%9C%89%E4%BB%80%E4%B9%88%E4%B8%8D%E5%90%8C%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    03 支持表达式：解析表达式和解析语句有什么不同？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-%E5%A6%82%E4%BD%95%E8%AE%A9%E6%88%91%E4%BB%AC%E7%9A%84%E8%AF%AD%E8%A8%80%E6%94%AF%E6%8C%81%E5%8F%98%E9%87%8F%E5%92%8C%E7%B1%BB%E5%9E%8B%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    04 如何让我们的语言支持变量和类型？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0%EF%BC%9A%E6%98%AF%E6%97%B6%E5%80%99%E8%AE%A9%E6%88%91%E4%BB%AC%E7%9A%84%E8%AF%AD%E8%A8%80%E6%94%AF%E6%8C%81%E5%87%BD%E6%95%B0%E5%92%8C%E8%BF%94%E5%9B%9E%E5%80%BC%E4%BA%86/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    05 函数实现：是时候让我们的语言支持函数和返回值了
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-%E6%80%8E%E4%B9%88%E6%94%AF%E6%8C%81%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5%E5%92%8C%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    06 怎么支持条件语句和循环语句？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07-%E6%80%8E%E4%B9%88%E8%AE%BE%E8%AE%A1%E5%B1%9E%E4%BA%8E%E6%88%91%E4%BB%AC%E8%87%AA%E5%B7%B1%E7%9A%84%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%92%8C%E5%AD%97%E8%8A%82%E7%A0%81%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    07 怎么设计属于我们自己的虚拟机和字节码？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    08 基于TypeScript的虚拟机（一）：实现一个简单的栈机
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    08 基于TypeScript的虚拟机（一）：实现一个简单的栈机
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      “设计”字节码
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      生成字节码
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#typescript" class="md-nav__link">
    <span class="md-ellipsis">
      实现一个TypeScript版本的虚拟机
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      课程小结
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      思考题
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      课程资源
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../09-%E5%9F%BA%E4%BA%8ETypeScript%E7%9A%84%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E4%B8%B0%E5%AF%8C%E7%89%B9%E6%80%A7%EF%BC%8C%E6%94%AF%E6%8C%81%E8%B7%B3%E8%BD%AC%E8%AF%AD%E5%8F%A5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    09 基于TypeScript的虚拟机（二）：丰富特性，支持跳转语句
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-%E5%9F%BA%E4%BA%8EC%E8%AF%AD%E8%A8%80%E7%9A%84%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%A0%88%E6%9C%BA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10 基于C语言的虚拟机（一）：实现一个简单的栈机
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../11-%E5%9F%BA%E4%BA%8EC%E8%AF%AD%E8%A8%80%E7%9A%84%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E6%80%A7%E8%83%BD%E5%A2%9E%E9%95%BF10%E5%80%8D%E7%9A%84%E7%A7%98%E5%AF%86/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    11 基于C语言的虚拟机（二）：性能增长10倍的秘密
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../12-%E7%89%A9%E7%90%86%E6%9C%BA%E4%B8%8A%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E7%9A%84%E7%A1%AC%E4%BB%B6%E7%8E%AF%E5%A2%83%E6%98%AF%E6%80%8E%E4%B9%88%E6%A0%B7%E7%9A%84%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    12 物理机上程序运行的硬件环境是怎么样的？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../13-%E7%89%A9%E7%90%86%E6%9C%BA%E4%B8%8A%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E7%9A%84%E8%BD%AF%E4%BB%B6%E7%8E%AF%E5%A2%83%E6%98%AF%E6%80%8E%E4%B9%88%E6%A0%B7%E7%9A%84%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    13 物理机上程序运行的软件环境是怎么样的？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../14-%E6%B1%87%E7%BC%96%E4%BB%A3%E7%A0%81%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E7%86%9F%E6%82%89CPU%E6%9E%B6%E6%9E%84%E5%92%8C%E6%8C%87%E4%BB%A4%E9%9B%86/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    14 汇编代码学习（一）：熟悉CPU架构和指令集
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../15-%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E7%86%9F%E6%82%89X86%E6%B1%87%E7%BC%96%E4%BB%A3%E7%A0%81/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    15 汇编语言学习（二）：熟悉X86汇编代码
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../16-%E7%94%9F%E6%88%90%E6%9C%AC%E5%9C%B0%E4%BB%A3%E7%A0%81%E7%AC%AC1%E5%85%B3%EF%BC%9A%E5%85%88%E6%8A%8A%E5%9F%BA%E7%A1%80%E6%90%AD%E5%A5%BD/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    16 生成本地代码第1关：先把基础搭好
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../17-%E7%94%9F%E6%88%90%E6%9C%AC%E5%9C%B0%E4%BB%A3%E7%A0%81%E7%AC%AC2%E5%85%B3%EF%BC%9A%E5%8F%98%E9%87%8F%E5%AD%98%E5%82%A8%E3%80%81%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E5%92%8C%E6%A0%88%E5%B8%A7%E7%BB%B4%E6%8A%A4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    17 生成本地代码第2关：变量存储、函数调用和栈帧维护
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../18-%E7%94%9F%E6%88%90%E6%9C%AC%E5%9C%B0%E4%BB%A3%E7%A0%81%E7%AC%AC3%E5%85%B3%EF%BC%9A%E5%AE%9E%E7%8E%B0%E5%AE%8C%E6%95%B4%E7%9A%84%E5%8A%9F%E8%83%BD/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    18 生成本地代码第3关：实现完整的功能
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../19-%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E6%9B%B4%E5%A5%BD%E7%9A%84%E5%AF%84%E5%AD%98%E5%99%A8%E5%88%86%E9%85%8D%E7%AE%97%E6%B3%95%EF%BC%9A%E5%8E%9F%E7%90%86%E7%AF%87/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    19 怎么实现一个更好的寄存器分配算法：原理篇
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../20-%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E6%9B%B4%E5%A5%BD%E7%9A%84%E5%AF%84%E5%AD%98%E5%99%A8%E5%88%86%E9%85%8D%E7%AE%97%E6%B3%95%EF%BC%9A%E5%AE%9E%E7%8E%B0%E7%AF%87/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    20 怎么实现一个更好的寄存器分配算法：实现篇
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../21-%E5%8A%A0%E6%B7%B1%E5%AF%B9%E6%A0%88%E7%9A%84%E7%90%86%E8%A7%A3%EF%BC%9A%E5%AE%9E%E7%8E%B0%E5%B0%BE%E9%80%92%E5%BD%92%E5%92%8C%E5%B0%BE%E8%B0%83%E7%94%A8%E4%BC%98%E5%8C%96/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    21 加深对栈的理解：实现尾递归和尾调用优化
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%9C%9F%E4%B8%AD%E6%B5%8B%E8%AF%95-%E5%BF%AB%E6%9D%A5%E6%A3%80%E9%AA%8C%E4%BD%A0%E5%9C%A8%E8%B5%B7%E6%AD%A5%E7%AF%87%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E5%90%A7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    期中测试 快来检验你在起步篇的学习成果吧
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E2%80%9C%E4%BB%96%E5%B1%B1%E4%B9%8B%E7%9F%B3%E2%80%9D-Sugar%EF%BC%9A%E8%BF%99%E9%97%A8%E8%AF%BE%E4%BD%A0%E5%8F%AF%E4%BB%A5%E8%AF%95%E8%AF%95%E8%BF%99%E4%B9%88%E5%AD%A6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    “他山之石” Sugar：这门课你可以试试这么学
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E2%80%9C%E5%B1%A0%E9%BE%99%E4%B9%8B%E7%A7%98%E2%80%9D-%E5%AE%9E%E7%8E%B0%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%AD%E8%A8%80%E8%BF%99%E6%A0%B7%E7%9A%84%E6%8A%80%E6%9C%AF%E8%83%BD%E7%94%A8%E5%9C%A8%E5%93%AA%E9%87%8C%EF%BC%9F%EF%BC%88%E4%B8%80%EF%BC%89/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    “屠龙之秘” 实现计算机语言这样的技术能用在哪里？（一）
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../22-%E5%A2%9E%E5%BC%BA%E7%BC%96%E8%AF%91%E5%99%A8%E5%89%8D%E7%AB%AF%E5%8A%9F%E8%83%BD%E7%AC%AC1%E6%AD%A5%EF%BC%9A%E5%86%8D%E8%AF%86%E6%95%B0%E6%8D%AE%E6%B5%81%E5%88%86%E6%9E%90%E6%8A%80%E6%9C%AF/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    22 增强编译器前端功能第1步：再识数据流分析技术
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../23-%E5%A2%9E%E5%BC%BA%E7%BC%96%E8%AF%91%E5%99%A8%E5%89%8D%E7%AB%AF%E5%8A%9F%E8%83%BD%E7%AC%AC2%E6%AD%A5%EF%BC%9A%E5%A2%9E%E5%BC%BA%E7%B1%BB%E5%9E%8B%E4%BD%93%E7%B3%BB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    23 增强编译器前端功能第2步：增强类型体系
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../24-%E5%A2%9E%E5%BC%BA%E7%BC%96%E8%AF%91%E5%99%A8%E5%89%8D%E7%AB%AF%E5%8A%9F%E8%83%BD%E7%AC%AC3%E6%AD%A5%EF%BC%9A%E5%85%A8%E9%9D%A2%E7%9A%84%E9%9B%86%E5%90%88%E8%BF%90%E7%AE%97/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    24 增强编译器前端功能第3步：全面的集合运算
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../25-%E5%A2%9E%E5%BC%BA%E7%BC%96%E8%AF%91%E5%99%A8%E5%89%8D%E7%AB%AF%E5%8A%9F%E8%83%BD%E7%AC%AC4%E6%AD%A5%EF%BC%9A%E7%BB%BC%E5%90%88%E8%BF%90%E7%94%A8%E5%A4%9A%E7%A7%8D%E8%AF%AD%E4%B9%89%E5%88%86%E6%9E%90%E6%8A%80%E6%9C%AF/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    25 增强编译器前端功能第4步：综合运用多种语义分析技术
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../26-%E5%A2%9E%E5%BC%BA%E6%9B%B4%E4%B8%B0%E5%AF%8C%E7%9A%84%E7%B1%BB%E5%9E%8B%E7%AC%AC1%E6%AD%A5%EF%BC%9A%E5%A6%82%E4%BD%95%E6%94%AF%E6%8C%81%E6%B5%AE%E7%82%B9%E6%95%B0%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    26 增强更丰富的类型第1步：如何支持浮点数？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../27-%E5%A2%9E%E5%8A%A0%E6%9B%B4%E4%B8%B0%E5%AF%8C%E7%9A%84%E7%B1%BB%E5%9E%8B%E7%AC%AC2%E6%AD%A5%EF%BC%9A%E5%A6%82%E4%BD%95%E6%94%AF%E6%8C%81%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    27 增加更丰富的类型第2步：如何支持字符串？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../28-%E5%A2%9E%E5%8A%A0%E6%9B%B4%E4%B8%B0%E5%AF%8C%E7%9A%84%E7%B1%BB%E5%9E%8B%E7%AC%AC3%E6%AD%A5%EF%BC%9A%E6%94%AF%E6%8C%81%E6%95%B0%E7%BB%84/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    28 增加更丰富的类型第3步：支持数组
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../29-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B%E7%AC%AC1%E6%AD%A5%EF%BC%9A%E5%85%88%E6%8A%8A%E5%9F%BA%E7%A1%80%E6%90%AD%E5%A5%BD/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    29 面向对象编程第1步：先把基础搭好
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../30-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B%E7%AC%AC2%E6%AD%A5%EF%BC%9A%E5%89%96%E6%9E%90%E4%B8%80%E4%BA%9B%E6%8A%80%E6%9C%AF%E7%BB%86%E8%8A%82/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    30 面向对象编程第2步：剖析一些技术细节
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../31-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B%E7%AC%AC3%E6%AD%A5%EF%BC%9A%E6%94%AF%E6%8C%81%E7%BB%A7%E6%89%BF%E5%92%8C%E5%A4%9A%E6%80%81/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    31 面向对象编程第3步：支持继承和多态
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../32-%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E7%AC%AC1%E5%85%B3%EF%BC%9A%E5%AE%9E%E7%8E%B0%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    32 函数式编程第1关：实现高阶函数
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../33-%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E7%AC%AC2%E5%85%B3%EF%BC%9A%E5%AE%9E%E7%8E%B0%E9%97%AD%E5%8C%85%E7%89%B9%E6%80%A7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    33 函数式编程第2关：实现闭包特性
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../34-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E7%AC%AC1%E5%85%B3%EF%BC%9AArena%E6%8A%80%E6%9C%AF%E5%92%8C%E5%85%83%E6%95%B0%E6%8D%AE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    34 内存管理第1关：Arena技术和元数据
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../35-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E7%AC%AC2%E5%85%B3%EF%BC%9A%E5%AE%9E%E7%8E%B0%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    35 内存管理第2关：实现垃圾回收
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../36-%E8%8A%82%E7%82%B9%E4%B9%8B%E6%B5%B7%EF%BC%9A%E6%80%8E%E4%B9%88%E7%94%9F%E6%88%90%E5%9F%BA%E4%BA%8E%E5%9B%BE%E7%9A%84IR%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    36 节点之海：怎么生成基于图的IR？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../37%20-%20%E4%BB%8EAST%E5%88%B0IR%EF%BC%9A%E4%BD%93%E4%BC%9A%E6%95%B0%E6%8D%AE%E6%B5%81%E5%92%8C%E6%8E%A7%E5%88%B6%E6%B5%81%E6%80%9D%E7%BB%B4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    37   从AST到IR：体会数据流和控制流思维
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../38-%E4%B8%AD%E7%AB%AF%E4%BC%98%E5%8C%96%E7%AC%AC1%E5%85%B3%EF%BC%9A%E5%AE%9E%E7%8E%B0%E5%A4%9A%E7%A7%8D%E6%9C%AC%E5%9C%B0%E4%BC%98%E5%8C%96/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    38 中端优化第1关：实现多种本地优化
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../39-%E4%B8%AD%E7%AB%AF%E4%BC%98%E5%8C%96%E7%AC%AC2%E5%85%B3%EF%BC%9A%E5%85%A8%E5%B1%80%E4%BC%98%E5%8C%96%E8%A6%81%E6%80%8E%E4%B9%88%E6%90%9E%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    39 中端优化第2关：全局优化要怎么搞？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../40-%E4%B8%AD%E7%AB%AF%E4%BC%98%E5%8C%96%E7%AC%AC3%E5%85%B3%EF%BC%9A%E4%B8%80%E8%B5%B7%E6%9D%A5%E6%8C%91%E6%88%98%E8%BF%87%E7%A8%8B%E9%97%B4%E4%BC%98%E5%8C%96/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    40 中端优化第3关：一起来挑战过程间优化
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../41-%E5%90%8E%E7%AB%AF%E4%BC%98%E5%8C%96%EF%BC%9A%E7%94%9F%E6%88%90LIR%E5%92%8C%E6%8C%87%E4%BB%A4%E9%80%89%E6%8B%A9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    41 后端优化：生成LIR和指令选择
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../42-%E5%88%B0%E8%BF%99%E9%87%8C%EF%BC%8C%E6%88%91%E4%BB%AC%E7%9A%84%E6%94%B6%E8%8E%B7%E5%92%8C%E6%9C%AA%E5%B0%BD%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    42 到这里，我们的收获和未尽的工作有哪些？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%9C%9F%E6%9C%AB%E8%80%83%E8%AF%95-%E5%AE%9E%E7%8E%B0%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E8%BF%99%E4%BA%9B%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%8C%E4%BD%A0%E6%8E%8C%E6%8F%A1%E5%BE%97%E5%92%8B%E6%A0%B7%E4%BA%86%EF%BC%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    期末考试 实现编程语言这些核心知识点，你掌握得咋样了？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%BB%93%E6%9D%9F%E8%AF%AD-%E7%AD%89%E5%BE%85%E4%BD%A0%E5%A4%A7%E5%B1%95%E8%BA%AB%E6%89%8B%E7%9A%84%E9%82%A3%E4%BA%9B%E9%A2%86%E5%9F%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    结束语 等待你大展身手的那些领域
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E6%88%9845%E8%AE%B2/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E6%88%9845%E8%AE%B2/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    操作系统实战45讲
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E4%B9%8B%E7%BE%8E/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E4%B9%8B%E7%BE%8E/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    数据结构与算法之美
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8%E8%AF%BE/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8%E8%AF%BE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    正则表达式入门课
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    深入浅出计算机组成原理
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80%E8%AF%BE/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80%E8%AF%BE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    程序员的数学基础课
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E4%B9%8B%E7%BE%8E/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E4%B9%8B%E7%BE%8E/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    编译原理之美
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AE%9E%E6%88%98%E8%AF%BE/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AE%9E%E6%88%98%E8%AF%BE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    编译原理实战课
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E5%AE%9E%E6%88%98%E8%AF%BE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    计算机基础实战课
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E8%B6%A3%E8%B0%88Linux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E8%B6%A3%E8%B0%88Linux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    趣谈Linux操作系统
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/%E8%B6%A3%E8%B0%88%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    趣谈网络协议
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B%E4%B9%8B%E7%BE%8E/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B%E4%B9%8B%E7%BE%8E/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    软件工程之美
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E4%B9%8B%E7%BE%8E/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E4%B9%8B%E7%BE%8E/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    软件设计之美
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E9%80%8F%E8%A7%86HTTP%E5%8D%8F%E8%AE%AE/%E9%80%8F%E8%A7%86HTTP%E5%8D%8F%E8%AE%AE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    透视HTTP协议
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E9%87%8D%E5%AD%A6%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/%E9%87%8D%E5%AD%A6%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    重学线性代数
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E8%BF%90%E7%BB%B4-%E6%B5%8B%E8%AF%95/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    运维-测试
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      “设计”字节码
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      生成字节码
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#typescript" class="md-nav__link">
    <span class="md-ellipsis">
      实现一个TypeScript版本的虚拟机
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      课程小结
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      思考题
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      课程资源
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>08 基于TypeScript的虚拟机（一）：实现一个简单的栈机</h1>

<p>你好，我是宫文学。</p>
<p>上一节课，我们已经探讨了设计一个虚拟机所要考虑的那些因素，并做出了一些设计决策。那么今天这一节课，我们就来实现一个初级的虚拟机。</p>
<p>要实现这个初级虚拟机，具体来说，我们要完成下面三方面的工作：</p>
<p>首先，我们要设计一些字节码，来支持第一批语言特性，包括支持函数、变量和整型数据的运算。也就是说，我们的虚拟机要能够支持下面程序的正确运行：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>//一个简单的函数，把输入的参数加10，然后返回
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>function foo(x:number):number{
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    return x + 10;
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>}
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>//调用foo，并输出结果
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>println(foo(18));
</code></pre></div>
<p>第二，我们要做一个字节码生成程序，基于当前的AST生成正确的字节码。</p>
<p>第三，使用TypeScript，实现一个虚拟机的原型系统，验证相关设计概念。</p>
<p>话不多说，开搞，让我们先设计一下字节码吧！</p>
<h2 id="_1">“设计”字节码</h2>
<p>说是设计，其实我比较懒，更愿意抄袭现成的设计，比如Java的字节码设计。因为Java字节码的资料最充分，比较容易研究，不像V8等的字节码，只有很少的文档资料，探讨的人也很少。另外，学会手工生成Java字节码还有潜在的实用价值，比如你可以把自己的语言编译后直接在JVM上运行。那么我们就先来研究一下Java字节码的特点。</p>
<p>上面的用TypeScript编写的示例代码，如果用Java改写，会变成下面的程序：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>//实现同样功能的Java程序。
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>public class A{
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    public static int foo(int a){
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>        return a + 10;
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    }
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    public static void main(String args[]){
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>        System.out.println(foo(8));
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>    }
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>}
</code></pre></div>
<p>我们首先把这个Java程序编译成字节码。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>javac A.java
</code></pre></div>
<p>这个文件是一个二进制文件。我们可以用hexdump命令查看它的内容。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>hexdump -C A.class
</code></pre></div>
<p><img alt="图片" src="https://static001.geekbang.org/resource/image/19/2e/19380b1b13c608e9db8c842a3a7de92e.jpg?wh=1492x1199" /></p>
<p>从hexdump显示的信息中，你能看到一些可以阅读的字符，比如“java/lang/Object”、"java/lang/System"等等，这些是常量表中的内容。还有一些内容显然不是字符，没法在屏幕上显示，所以hexdump就用一个.号来表示。其中某些字节，代表的是指令，我在图中把代表foo函数、main函数和构造函数的指令标注了出来，这些都是。用于运行的字节码指令，其他都是一些符号表等描述性的信息。</p>
<p>通过上图，你还能得到一个直观的印象：<strong>字节码文件并不都是由指令构成的</strong>。</p>
<p>没错，指令只是一个程序文件的一部分。除了指令以外，在字节码文件中还要存储不少其他内容，才能保证程序的正常运行，比如类和方法的符号信息、字符串和数字常量，等等。至于字节码文件的格式，是由字节码的规范来规定的，你有兴趣的话，可以按照规范生成这样的字节码文件。这样的话，我们的程序就可以在JVM上运行了。</p>
<p>不过，我现在不想陷入字节码文件格式的细节里，而是想用自己的方式生成字节码文件，够支持现在的语言特性，能够在我们自己的虚拟机上运行就行了。</p>
<p>上面这张图显示的字节码文件不是很容易阅读和理解。所以，我们用javap命令把它转化成文本格式来看看。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>javap -v A.class &gt; A.bc
</code></pre></div>
<p>在这个新生成的文件里，我们可以清晰地看到每个函数的定义以及指令，我也在图里标注了主要的指令的含义。</p>
<p><img alt="图片" src="https://static001.geekbang.org/resource/image/c9/a1/c90344b05e25ffae95a2c3e9e1a804a1.jpg?wh=1328x1265" title="文本格式的字节码文件" /></p>
<p>看到这个字节码文件的内容，你可能会直观地觉得：这看上去跟我们的高级语言也没有那么大的区别嘛。程序照样划分成几个函数，只不过每个函数里的语句变成了栈机的指令而已，函数之间照样需要互相调用。</p>
<p>实际上也确实没错。字节码文件里本来就存储了各个类和方法的符号信息，相当于保存了高级语言里的主体框架。当然，每个方法体里的代码就看不出if语句、循环语句这样的结构了，而是变成了字节码的指令。</p>
<p>通过研究这些指令，加上查阅<a href="https://docs.oracle.com/javase/specs/jvms/se12/html/jvms-6.html">JVM规则</a>中对于字节码的规定，你会发现为了实现上面示例代码中的功能，我们目前只需要这几个指令就够了：</p>
<p><img alt="图片" src="https://static001.geekbang.org/resource/image/60/20/608cdfd47efe1e162e8bd7ca88f1d420.jpg?wh=1919x1265" /></p>
<p><img alt="图片" src="https://static001.geekbang.org/resource/image/55/f6/55334d4a30a41ed87bf7bc82c64c9ef6.jpg?wh=1920x1220" title="常数入栈指令" /></p>
<p><img alt="图片" src="https://static001.geekbang.org/resource/image/e5/8b/e52ef425d612381fe33628818c75c68b.jpg?wh=1920x1166" title="二元运算指令，以及函数调用和返回指令" /></p>
<p>你先花一两分钟看一下这些指令，看上去挺多，其实可以分为几组。</p>
<p>首先是iload系列，这是把指定下标的本地变量入栈。注意，变量的下标是由声明的顺序决定的，参数也算本地变量，并且排在最前面。所以，iload 0的意思，就是把第一个参数入栈。如果没有参数，就是把第一个本地变量入栈。</p>
<p>iload后面的那几个指令，是压缩格式的指令，也就是利用指令末尾富余的位，把操作数和指令压缩在了一起，这样可以少一个字节码，能够缩小最后生成的字节码文件的大小。从这里面，你能借鉴到字节码设计的一些好的实践。所以你看，学习成熟的设计是有好处的吧？</p>
<p>第二组是istore系列，它做的工作刚好跟iload相反，是把栈顶的值存到指定下标的变量里去。</p>
<p>第三组，是对常数做入栈的操作。对于0<sub>5这几个数字，Java字节码也是提供了压缩格式的指令。对于8位整数（-128</sub>127），使用bipush指令。对于16位整数（-32768~32767），使用sipush指令。而对于更大的常数，则要使用ldc指令，从常量池里去取。</p>
<p>第四组，是几个二元运算的指令。它们都是从栈里取两个操作数，计算完毕之后，再压回栈里。</p>
<p>最后一组指令，是函数调用和返回的指令。函数调用的时候，也是从栈里取参数。返回值呢，则压回栈里。</p>
<p>通过这些指令，我们就完全能够实现一些基本的功能了，之后我们再根据需要添加更多的指令就好。</p>
<p>现在，我们把这些指令做成枚举值，方便程序使用：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>/**
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a> * 指令的编码
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a> */
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>enum OpCode{
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>    iconst_0= 0x03,
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>    iconst_1= 0x04,
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>    iconst_2= 0x05,
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>    iconst_3= 0x06,
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>    iconst_4= 0x07,
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>    iconst_5= 0x08,
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>    bipush  = 0x10,  //8位整数入栈
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>    sipush  = 0x11,  //16位整数入栈
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>    iload   = 0x15,  //本地变量入栈
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>    iload_0 = 0x1a,
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>    iload_1 = 0x1b,
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>    iload_2 = 0x1c,
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>    iload_3 = 0x1d,
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>    istore  = 0x36,
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>    istore_0= 0x3b,
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>    istore_1= 0x3c,
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>    istore_2= 0x3d,
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>    istore_3= 0x3e,
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>    iadd    = 0x60,
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a>    isub    = 0x64,
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>    imul    = 0x68,
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a>    idiv    = 0x6c,
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a>    ireturn = 0xac,
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a>    return  = 0xb1,
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a>    invokestatic= 0xb8, //调用函数
<a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a>}
</code></pre></div>
<p>好了，我们通过全盘照抄的方式，“设计”出了自己所需要的字节码。不过这些都只是指令的部分。还要有常量池的部分，我们在下面使用到的时候再去设计。</p>
<p>接下来，我们来生成自己的字节码。</p>
<h2 id="_2">生成字节码</h2>
<p>生成栈机的字节码是比较简单的。为什么呢？因为栈机的字节码基本上跟AST是同构的，通过深度优先的顺序遍历AST就可以实现。相对来说，生成寄存器机的指令的算法就要稍微绕一点，我们也会在后面的课程中体会到。</p>
<p>怎么来深度优先地遍历AST、生成栈机的字节码呢？以“3+a”这样一个简单的表达式为例，我们处理的顺序依次是字面量3、变量a和+号。</p>
<p>首先来处理字面量。处理整型字面量的时候，我们需要根据整数的不同长度，分别使用不同的常量指令。其中的一个细节是，当整数是16位时，操作数要拆成两个字节。而当大于16位时，我们干脆就把字面量放在常量池里，操作数只是该常数在常量池的索引值。</p>
<p>这里的处理你可以参照下面这个代码：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>visitIntegerLiteral(integerLiteral: IntegerLiteral):any{
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    let ret:number[] = [];
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    let value = integerLiteral.value;
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>    //0-5之间的数字，直接用快捷指令
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    if (value &gt;= 0 &amp;&amp; value &lt;= 5) {
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>        switch (value) {
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>            case 0:
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>                ret.push(OpCode.iconst_0);
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>                break;
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>            ...省略1、2、3、4的情况
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>            case 5:
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>                ret.push(OpCode.iconst_5);
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>                break;
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>        }
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>    }
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>    //如果是8位整数，用bipush指令，直接放在后面的一个字节的操作数里就行了
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>    else if (value &gt;= -128 &amp;&amp; value &lt;128){
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>        ret.push(OpCode.bipush);
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>        ret.push(value);
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>    }
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>    //如果是16位整数，用sipush指令
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>    else if (value &gt;= -32768 &amp;&amp; value &lt;32768){
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>        ret.push(OpCode.sipush);
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>        //要拆成两个字节
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>        ret.push(value &gt;&gt; 8);
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>        ret.push(value &amp; 0x00ff);
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a>    }
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a>    //大于16位的，采用ldc指令，从常量池中去取
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>    else{
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a>        //把value值放入常量池。
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a>        this.module.consts.push(value); 
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a>        ret.push(this.module.consts.length -1);
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a>    }
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a>    return ret;
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a>}
</code></pre></div>
<p>接着来处理变量a。在处理变量的时候，我们要区分左值和右值的情况。在“3+a”这个表达式中，a是个右值，我们需要取出a的值，也就是要生成iload指令。但对于“a=3”这样的表达式，a是个左值，这个时候返回a的符号即可，在处理赋值运算的时候再生成istore指令。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>/**
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a> * 左值的情况，返回符号。否则，生成iload指令。
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a> * @param v 
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a> */
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>visitVariable(v:Variable):any{
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    if (v.isLeftValue){
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>        return v.sym;
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>    }
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>    else{
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>        return this.getVariableValue(v.sym);
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>    }
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>}
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>/**
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a> * 生成获取本地变量值的指令
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a> * @param varName 
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a> */
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>private getVariableValue(sym:VarSymbol|null):any{
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>    if (sym != null){
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>        let code:number[] = [];  //生成的字节码
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>        //本地变量的下标
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>        let index = this.functionSym?.vars.indexOf(sym);
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>        assert(index != -1, &quot;生成字节码时（获取变量的值），在函数符号中获取本地变量下标失败！&quot;);
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>        //根据不同的下标生成指令，尽量生成压缩指令
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a>        switch (index){
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a>            case 0:
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a>                code.push(OpCode.iload_0);
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a>                break;
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a>            case 1:
<a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a>                code.push(OpCode.iload_1);
<a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a>                break;
<a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a>            case 2:
<a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a>                code.push(OpCode.iload_2);
<a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a>                break;
<a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a>            case 3:
<a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a>                code.push(OpCode.iload_3);
<a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a>                break;
<a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a>            default:
<a id="__codelineno-7-39" name="__codelineno-7-39" href="#__codelineno-7-39"></a>                code.push(OpCode.iload);    
<a id="__codelineno-7-40" name="__codelineno-7-40" href="#__codelineno-7-40"></a>                code.push(index as number);               
<a id="__codelineno-7-41" name="__codelineno-7-41" href="#__codelineno-7-41"></a>        }            
<a id="__codelineno-7-42" name="__codelineno-7-42" href="#__codelineno-7-42"></a>        return code;
<a id="__codelineno-7-43" name="__codelineno-7-43" href="#__codelineno-7-43"></a>    }
<a id="__codelineno-7-44" name="__codelineno-7-44" href="#__codelineno-7-44"></a>}
</code></pre></div>
<p>然后，我们要对加减乘除这些二元运算来生成代码，我们可以先为左右子树分别生成代码，再把加减乘除的运算指令放在最后。注意，赋值运算的处理逻辑是不同的，它要生成istore指令。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>visitBinary(bi:Binary):any{
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>    let code:number[];
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>    let code1 = this.visit(bi.exp1);
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>    let code2 = this.visit(bi.exp2);
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    ////1.处理赋值
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>    if (bi.op == Op.Assign){
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>        let varSymbol = code1 as VarSymbol; 
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>        //加入右子树的代码
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>        code = code2;
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>        //加入istore代码
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>        code = code.concat(this.setVariableValue(varSymbol));
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>    }
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>    ////2.处理其他二元运算
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>    else{
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>        //加入左子树的代码
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>        code = code1;
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>        //加入右子树的代码
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>        code = code.concat(code2);
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>        //加入运算符的代码
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>        switch(bi.op){
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>            case Op.Plus: //&#39;+&#39;
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>                code.push(OpCode.iadd);
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>                break;
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>            case Op.Minus: //&#39;-&#39;
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>                code.push(OpCode.isub);
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>                break;
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>            case Op.Multiply: //&#39;*&#39;
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a>                code.push(OpCode.imul);
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>                break;
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a>            case Op.Divide: //&#39;/&#39;
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a>                code.push(OpCode.idiv);
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>                break;
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a>            default:
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a>                console.log(&quot;Unsupported binary operation: &quot; + bi.op);
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a>                return [];
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a>        }
<a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a>    }
<a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a>    return code;
<a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a>}
</code></pre></div>
<p>好了，到此这里，我们对处理基本的表达式就没有问题了。接下来，我们再增加与函数调用和返回有关的指令。</p>
<p>在进行函数调用的时候，我们要依次生成与参数计算有关的指令，最后生成invokestatic指令。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>let code:number[] = [];
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>//1.依次生成与参数计算有关的指令
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>for(let param of functionCall.paramValues){
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>    let code = this.visit(param);
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>    if (typeof code == &#39;object&#39;){
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>        code = code.concat(code as number[]);
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>    }
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>}
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>//2.生成invoke指令
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>let index = this.module.consts.indexOf(functionCall.sym);
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>code.push(OpCode.invokestatic);
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>code.push(index&gt;&gt;8);
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>code.push(index);
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>return code;
</code></pre></div>
<p>然后，在处理return语句的时候，也要注意，我们要根据是否有返回值，分别生成ireturn和return指令。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>let code:number[] = [];
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>//1.为return后面的表达式生成代码
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>if(returnStatement.exp != null){
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>    let code1 = this.visit(returnStatement.exp);
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>    if (typeof code1 == &#39;object&#39;){
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>        code = code.concat(code1 as number[]);
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>        //生成ireturn代码
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>        code.push(OpCode.ireturn);
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>        return code;
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>    }
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>}
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>else{
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>    //2.生成return代码，返回值是void
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>    code.push(OpCode.return);
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>    return code;
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>}
</code></pre></div>
<p>到这里，我们已经能够顺利的生成字节码了。生成字节码以后，接下来就只剩最后一步了：实现一个虚拟机，让这些字节码真正运行起来！</p>
<h2 id="typescript">实现一个TypeScript版本的虚拟机</h2>
<p>如果你是学习Java的同学，那你在面试的时候肯定经常会被问到与虚拟机有关的知识点。你也会根据自己了解的知识，对操作数栈、常量池等发表一通见解。但是，你心里多多少少对这些概念还会隔着一层面纱。</p>
<p>直到你自己亲自动手实现一遍，哪怕只是实现一个原型系统，你对这些概念，以及对虚拟机到底是如何运行的，才会有真真切切的理解。所以，我鼓励你动手实现一遍。而且，我可以告诉你，真的花不了多少时间。如果你看看我给出的示例代码，其实就是一个大函数，针对不同的字节码指令做处理而已。</p>
<p>不过，为了便于你理解代码，我还是先画一个虚拟机的示意图。我们这个简单的虚拟机主要涉及几个对象：</p>
<p><img alt="图片" src="https://static001.geekbang.org/resource/image/76/a0/76a4640bbe5c0d394c1ed8e330c214a0.jpg?wh=1584x1265" /></p>
<p><strong>首先是模块。</strong>模块代表了我们的程序，模块里最重要的就是一个常量表。常量表中的常量包含字符串常量、数字常量和函数符号。而函数符号里有一个bytecode属性，保存了这个函数的字节码。这样，我们就可以找到函数的代码并运行它们了。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>export class BCModule{
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>  //常量
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>  consts:any[] = [];
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>  //入口函数
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>  _main:FunctionSymbol|null = null;
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>}
</code></pre></div>
<p><strong>然后是运行程序的栈机。</strong>栈机里最重要的数据结构是一个调用栈，在AST解释器里也有类似的数据结构。调用栈是由栈桢构成的，在执行每个函数的时候，都需要在栈顶新加一个栈桢，而在退出函数的时候，就会弹出这个函数的栈桢。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>//栈机
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>export class VM{
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>    //调用栈
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>    callStack:StackFrame[]=[];
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>    //执行一个模块
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>    execute(bcModule:BCModule):number{
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>    ...
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>    }
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>}
</code></pre></div>
<p>你要注意，栈桢是一个关键的数据结构，它用来保存每个函数运行时所需要保存的状态信息。每个栈桢里又有几个关键的组成部分。</p>
<ul>
<li>操作数栈：用来保存函数执行过程中各个指令所需要用到的操作数；</li>
<li>存放本地变量的数组：可以在这里存取变量值；</li>
<li>返回地址：也是在调用子函数的时候，告诉子函数返回以后，从哪条代码接着运行。</li>
</ul>
<p>栈机里的execute方法，就是虚拟机的核心执行引擎。下面我摘一些有代表性的代码给你讲一下，你先看一下示例代码的结构。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>//一直执行代码，直到遇到return语句
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>let opCode = code[codeIndex];
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>while(true){
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>    switch (opCode){
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>        case OpCode.iconst_0: //加载常量
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>            frame.oprandStack.push(0);
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>            opCode = code[++codeIndex];
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>            continue;
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>        ...
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>        case OpCode.sipush:  //加载32位常量，需要取出2个字节
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>            let byte1 = code[++codeIndex];
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>            let byte2 = code[++codeIndex];
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>            frame.oprandStack.push(byte1&lt;&lt;8|byte2); 
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>            opCode = code[++codeIndex];
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>            continue;
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>        ...
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>        case OpCode.iload_0: //从变量里取值
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>            frame.oprandStack.push(frame.localVars[0]);
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>            opCode = code[++codeIndex];
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>            continue;
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>        ...
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a>        case OpCode.istore_0: //给变量赋值
<a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>            frame.localVars[0] = frame.oprandStack.pop();
<a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a>            opCode = code[++codeIndex];
<a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a>            continue;
<a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a>        ...
<a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a>        case OpCode.iadd:     //加减乘除
<a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a>            frame.oprandStack.push(frame.oprandStack.pop() + frame.oprandStack.pop());
<a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a>            opCode = code[++codeIndex];
<a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a>            continue;
<a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a>        ...
<a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a>    }
<a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a>}
</code></pre></div>
<p>你可能马上会注意到，<strong>整个程序执行的过程就是一个大的while循环</strong>。</p>
<p>几乎所有的虚拟机的核心执行引擎都是这么写的，因为程序的执行过程就是不停地读取指令，然后根据指令做相应的动作。其中的代码计数器，一直指向下一个要执行的指令的位置。由于指令的种类比较多，所以switch后面会罗列很多个case，代码也会很长。你用电脑看这些代码的话，可能要翻很多屏。</p>
<p>虽然这个函数的代码很长，我们一般也不会把它拆成多个函数。为什么呢？这似乎违背了通常的编程理念呀。通常我们都不会编写太长的函数，这不容易阅读，也不容易维护。</p>
<p>但事情总有例外。对于虚拟机的执行引擎来说，性能上的考虑是第一位的。执行一个指令，可能开销并不大。但如果执行这条指令要调用一个专门的函数，那函数调用的额外开销会比执行指令本身的开销都大，那显然就不合理了，这也是我们为什么弃用AST解释器的原因。</p>
<p>我们这个示例代码中体现了加载常量、加载变量、保存变量和执行加减乘除的运算的实现方式。你能通过这些代码，再一次验证栈机的工作原理，这里所有操作都是围绕着操作数栈来进行的。</p>
<p>而函数的调用和返回，则显得复杂一点。这两部分代码，也有助于你更加细致的了解栈桢的使用方式。</p>
<p>首先我们来看看函数调用：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>case OpCode.invokestatic:
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>    //从常量池找到被调用的函数
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>    byte1 = code[++codeIndex];
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>    byte2 = code[++codeIndex];
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>    let functionSym = bcModule.consts[byte1&lt;&lt;8|byte2] as FunctionSymbol;
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>    //设置返回值地址，为函数调用的下一条指令
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>    frame.returnIndex = codeIndex;
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>    //创建新的栈桢
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>    let lastFrame = frame;
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>    frame = new StackFrame(functionSym);
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>    this.callStack.push(frame);
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>    //传递参数
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>    let paramCount = (functionSym.decl as FunctionDecl).callSignature.params.length;
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>    for(let i = paramCount -1; i&gt;= 0; i--){
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>        frame.localVars[i] = lastFrame.oprandStack.pop();
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>    }
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>    //设置新的code、codeIndex和oPCode
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>    if (frame.funtionSym.bytecode !=null){
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>        //切换到被调用函数的代码
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>        code = frame.funtionSym.bytecode;
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>        //代码指针归零
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>        codeIndex = 0;
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a>        opCode = code[codeIndex];
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a>        continue;
<a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a>    }
</code></pre></div>
<p>在函数调用的时候，我们要完成这几项工作：</p>
<ul>
<li>设置返回地址，被调用的函数在执行return指令的时候，会回到这个位置；</li>
<li>为被调用的函数生成新的栈桢，并加到调用栈中；</li>
<li>从操作数栈中取出参数的值，并赋给新的栈桢，因为参数也算作本地变量，因此只需要对新栈桢的前几个本地变量赋值就可以了；</li>
<li>把代码切换到被调用函数的代码，并且把代码计数器设置为0，也就是从第一个字节码指令开始执行。</li>
</ul>
<p>而函数返回是函数调用的逆向操作：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>case OpCode.ireturn:
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>case OpCode.return:
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>    //确定返回值
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>    let retValue = undefined;
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>    if(opCode == OpCode.ireturn){
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>        retValue = frame.oprandStack.pop();
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>    }
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>    //弹出栈桢，返回到上一级函数，继续执行
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>    this.callStack.pop();
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>    if (this.callStack.length == 0){ //主程序返回，结束运行
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>        return 0;
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>    }
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>    else { //返回到上一级调用者
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>        frame = this.callStack[this.callStack.length-1];
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>        //设置返回值到上一级栈桢
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>        // frame.retValue = retValue;
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>        if(opCode == OpCode.ireturn){
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>            frame.oprandStack.push(retValue);
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>        }    
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>        //设置新的code、codeIndex和oPCode
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>        if (frame.funtionSym.byteCode !=null){
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a>            //切换到调用者的代码
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a>            code = frame.funtionSym.byteCode;
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a>            //设置指令指针为返回地址，也就是调用该函数的下一条指令
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a>            codeIndex = frame.returnIndex;
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a>            opCode = code[codeIndex];
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a>            continue;
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a>        }
<a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a>        else{
<a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a>            console.log(&quot;Can not find code for &quot;+ frame.funtionSym.name);
<a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a>            return -1;
<a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a>        }
<a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a>    }
<a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a>    continue;
</code></pre></div>
<p>函数返回时，我们需要完成下面这几项工作：</p>
<ul>
<li>设置返回值，如果确实有一个返回值，那么就从当前操作数栈中取出来，返回值加载到上一级栈桢里的操作数栈；</li>
<li>从调用栈中弹出当前栈桢；</li>
<li>把代码切换成调用者的代码，并且把代码指针设置成函数调用指令的下一条指令，继续函数调用之后的工作；</li>
<li>这里还有一个特殊情况，执行到return指令的时候，你会发现当前栈桢之上，再也没有上一级栈桢了。这说明当前所在的函数已经是最顶层了，也就是我们的编译器内部的_main()函数。这个时候，return指令就会结束整个while循环，也意味着整个程序运行结束。</li>
</ul>
<p>好了，这就是函数调用和返回的过程。通过这个过程，你会发现这两类指令其实是遵循了一些共同的约定。</p>
<p>这些约定包括：我们传参数的时候，把参数放在哪里？函数返回的时候，又把返回值放在哪里？还有，调用函数的时候，我们应该在一个双方都知道的位置设置返回地址，以便函数返回后调到这个地址继续执行。</p>
<p>这里，你又学到一个概念，叫做<strong>调用约定（Calling Convention）</strong>。计算机语言的设计者，可以设计自己的调用约定，这样用自己的编译器编译出来的模块，都能互相调用。但如果一种语言想调用另一种语言编写的模块，那么它们必须遵循相同的调用约定，或者要在不同的调用约定之间做转换。比如，Java调用C语言写的模块，要使用JNI接口，就是要完成这种调用约定的转换。</p>
<p>跟调用约定差不多的一个概念叫做<strong>ABI（Application Binary Interface）</strong>。ABI这个名字更强调如何在二进制的层面上实现互相调用，以及二进制程序文件的格式，等等，所以更适合描述像C、C++这些编译成二进制目标代码的情形。</p>
<p>好了，现在我们已经拥有了一个简化版的虚拟机了，你可以用它跑几个程序试一下。因为现在我们这个虚拟机还不支持if语句和循环语句，所以还不方便做性能测试。这个工作，我们放在下一节课再去做。</p>
<h2 id="_3">课程小结</h2>
<p>好了，今天这节课到这里就结束了，让我们来简单回顾一下。</p>
<p>今天，我们设计并实现了一个简单的基于栈机的虚拟机，实现了我们在虚拟机领域0的突破。如果你认真跟着学完了这一节，我相信你一定会有很多收获。</p>
<p>首先，我们学了栈机的指令，通常包括加载常数、加载变量、保存变量、加减乘除、函数调用和返回这些，用这些指令就能让程序运行起来了。下一节课我们还会多学习一些指令，特别是分支指令。</p>
<p>第二，我们已经可以通过遍历AST的方式生成字节码。其中稍微有点难度的地方，是在访问变量节点的时候，要区分左值和右值，分别生成给变量赋值的代码和读取变量值的代码。</p>
<p>第三，在虚拟机里，我们用了BCModule这个数据结构来表示可被执行的程序。其实你把这个数据结构保存到文件里就是字节码文件了，它里面主要的内容就是一个常量表。常量表里除了字符串、数字这样的常规意义上的常数以外，最重要的还有函数符号，函数符号中包含了要运行的字节码。</p>
<p>第四，栈机的执行引擎是一个很大的循环，要依次执行每条指令，在这个过程中操作数栈会不停的压入数据、弹出数据。在调用函数和返回函数的时候，要建立栈桢和弹出栈桢。函数参数被设置到新栈桢的本地变量里，而返回值则被设置到上一级栈桢的操作数栈里，这就构成了函数之间的调用约定。</p>
<p>虽然我们目前是在虚拟机层面上了解这些概念，但是，即使是到了我们把程序编译成机器码的时候，这些基本概念仍然是差不多的。你现在学习的成果，会为后面的学习内容打下很好的基础。</p>
<p>在下一节课，我们将继续深化我们虚拟机。到时候它会在哪些方面取得突破呢？敬请期待吧！</p>
<h2 id="_4">思考题</h2>
<p>在这节课的BCModule中有一个常量表，为什么把函数符号也看做是常量呢？刨去其中的字节码，这些符号信息可能有什么潜在的用途呢？欢迎在留言区发表你的看法！</p>
<p>感谢你和我一起学习，欢迎你把我这节课分享给更多对字节码虚拟机感兴趣的朋友。我是宫文学，我们下节课见！</p>
<h2 id="_5">课程资源</h2>
<p><a href="https://gitee.com/richard-gong/craft-a-language/tree/master/16-18">这节课的示例代码在这里！</a></p>
<div><strong>精选留言（5）</strong></div>
<ul>
<li><span>ifelse</span> 👍（0） 💬（0）<p>学习打卡</p>2022-09-13</li><br/><li><span>罗 乾 林</span> 👍（0） 💬（0）<p>看了老师后面的课程来回答一下:

可以在运行期来显示错误信息
把函数名称和函数签名的信息加进去，会有利于我们实现多模块的运行机制。也就是说，如果一个模块中的函数要调用另一个模块中的函数，那么我们可以创造一种机制，实现模块之间的代码查找。</p>2021-09-02</li><br/><li><span>有学识的兔子</span> 👍（0） 💬（0）<p>函数符号被看作常量，是不是因为函数符号类似于函数地址，跟字符串常量和数字常量一样都不可以被更改？
这些符号信息是不是在需要调试或追踪程序运行信息时,方便了解程序运行的上下文信息？</p>2021-08-29</li><br/><li><span>奋斗的蜗牛</span> 👍（0） 💬（0）<p>回答一下思考题，符号表信息可以实现函数式编程的支持</p>2021-08-26</li><br/><li><span>bjuthang</span> 👍（0） 💬（0）<p>赞👍</p>2021-08-25</li><br/>
</ul>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../07-%E6%80%8E%E4%B9%88%E8%AE%BE%E8%AE%A1%E5%B1%9E%E4%BA%8E%E6%88%91%E4%BB%AC%E8%87%AA%E5%B7%B1%E7%9A%84%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%92%8C%E5%AD%97%E8%8A%82%E7%A0%81%EF%BC%9F/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 07 怎么设计属于我们自己的虚拟机和字节码？">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                07 怎么设计属于我们自己的虚拟机和字节码？
              </div>
            </div>
          </a>
        
        
          
          <a href="../09-%E5%9F%BA%E4%BA%8ETypeScript%E7%9A%84%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E4%B8%B0%E5%AF%8C%E7%89%B9%E6%80%A7%EF%BC%8C%E6%94%AF%E6%8C%81%E8%B7%B3%E8%BD%AC%E8%AF%AD%E5%8F%A5/" class="md-footer__link md-footer__link--next" aria-label="下一页: 09 基于TypeScript的虚拟机（二）：丰富特性，支持跳转语句">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                09 基于TypeScript的虚拟机（二）：丰富特性，支持跳转语句
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © 2025-Present zkep
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.annotate", "content.code.copy", "content.tooltips", "toc.follow", "navigation.top", "navigation.tabs", "navigation.tabs.sticky", "navigation.prune", "navigation.footer", "navigation.tracking", "navigation.instant", "navigation.instant.progress", "navigation.indexes", "content.tabs.link"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
        <script src="../../../javascript/extra.js"></script>
      
        <script src="../../../javascript/giscus.js"></script>
      
    
  </body>
</html>