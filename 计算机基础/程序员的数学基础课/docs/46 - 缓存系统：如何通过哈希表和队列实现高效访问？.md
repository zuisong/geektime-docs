ä½ å¥½ï¼Œæˆ‘æ˜¯é»„ç”³ã€‚

ç»è¿‡å‰ä¸‰å¤§æ¨¡å—çš„å­¦ä¹ ï¼Œæˆ‘å¸¦ä½ çºµè§ˆäº†æ•°å­¦åœ¨å„ä¸ªè®¡ç®—æœºç¼–ç¨‹é¢†åŸŸçš„é‡è¦åº”ç”¨ã€‚ç¦»æ•£æ•°å­¦æ˜¯åŸºç¡€æ•°æ®ç»“æ„å’Œç¼–ç¨‹ç®—æ³•çš„åŸºçŸ³ï¼Œè€Œæ¦‚ç‡ç»Ÿè®¡è®ºå’Œçº¿æ€§ä»£æ•°ï¼Œæ˜¯å¾ˆå¤šä¿¡æ¯æ£€ç´¢å’Œæœºå™¨å­¦ä¹ ç®—æ³•çš„æ ¸å¿ƒã€‚

å› æ­¤ï¼Œä»Šå¤©å¼€å§‹ï¼Œæˆ‘ä¼šç»¼åˆæ€§åœ°è¿ç”¨ä¹‹å‰æ‰€è®²è§£çš„ä¸€äº›çŸ¥è¯†ï¼Œè®¾è®¡å¹¶å®ç°ä¸€äº›æ›´æœ‰å®ç”¨æ€§çš„æ ¸å¿ƒæ¨¡å—æˆ–è€…åŸå‹ç³»ç»Ÿã€‚é€šè¿‡è¿™ç§åŸºäºæ¡ˆä¾‹çš„è®²è§£ï¼Œæˆ‘ä»¬å¯ä»¥èä¼šè´¯é€šä¸åŒçš„æ•°å­¦çŸ¥è¯†ï¼Œå¹¶æ‰“é€ æ›´åŠ é«˜æ•ˆã€æ›´åŠ æ™ºèƒ½çš„è®¡ç®—æœºç³»ç»Ÿã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä»ä¸€ä¸ªç¼“å­˜ç³»ç»Ÿå…¥æ‰‹ï¼Œå¼€å§‹ç»¼åˆåº”ç”¨ç¯‡çš„å­¦ä¹ ã€‚

## ä»€ä¹ˆæ˜¯ç¼“å­˜ç³»ç»Ÿï¼Ÿ

ç¼“å­˜ï¼ˆCacheï¼‰æ˜¯è®¡ç®—æœºç³»ç»Ÿé‡Œéå¸¸é‡è¦çš„å‘æ˜ä¹‹ä¸€ï¼Œå®ƒåœ¨ç¼–ç¨‹é¢†åŸŸä¸­æœ‰éå¸¸éå¸¸å¤šçš„åº”ç”¨ã€‚å°åˆ°ç”µè„‘çš„ä¸­å¤®å¤„ç†å™¨ï¼ˆCPUï¼‰ã€ä¸»æ¿ã€æ˜¾å¡ç­‰ç¡¬ä»¶ï¼Œå¤§åˆ°å¤§è§„æ¨¡çš„äº’è”ç½‘ç«™ç‚¹ï¼Œéƒ½åœ¨å¹¿æ³›ä½¿ç”¨ç¼“å­˜æ¥æå‡é€Ÿåº¦ã€‚è€Œåœ¨ç½‘ç«™çš„æ¶æ„è®¾è®¡ä¸­ï¼Œä¸€èˆ¬ä¸ä¼šåƒPCç”µè„‘é‚£æ ·é‡‡ç”¨é«˜é€Ÿçš„ç¼“å­˜ä»‹è´¨ï¼Œè€Œæ˜¯é‡‡ç”¨æ™®é€šçš„æœåŠ¡å™¨å†…å­˜ã€‚ä½†æ˜¯ç½‘ç«™æ¶æ„æ‰€ä½¿ç”¨çš„å†…å­˜å®¹é‡å¤§å¾—å¤šï¼Œè‡³å°‘æ˜¯æ•°ä¸ªå‰å­—èŠ‚ ï¼ˆGBï¼‰ã€‚

æˆ‘ä»¬å¯ä»¥æŠŠç¼“å­˜å®šä¹‰ä¸ºæ•°æ®äº¤æ¢çš„ç¼“å†²åŒºã€‚å®ƒçš„è¯»å–é€Ÿåº¦è¿œè¿œé«˜äºæ™®é€šå­˜å‚¨ä»‹è´¨ï¼Œå¯ä»¥å¸®åŠ©ç³»ç»Ÿæ›´å¿«åœ°è¿è¡Œã€‚å½“æŸä¸ªåº”ç”¨éœ€è¦è¯»å–æ•°æ®æ—¶ï¼Œä¼šä¼˜å…ˆä»ç¼“å­˜ä¸­æŸ¥æ‰¾éœ€è¦çš„å†…å®¹ï¼Œå¦‚æœæ‰¾åˆ°äº†åˆ™ç›´æ¥è·å–ï¼Œè¿™ä¸ªæ•ˆç‡è¦æ¯”è¯»å–æ™®é€šå­˜å‚¨æ›´é«˜ã€‚å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰å‘ç°éœ€è¦çš„å†…å®¹ï¼Œå†åˆ°æ™®é€šå­˜å‚¨ä¸­å¯»æ‰¾ã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ11ï¼‰</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/95/2c/f254f684.jpg" width="30px"><span>é“ä¸‘-ç‹ç«‹ä¸°</span> ğŸ‘ï¼ˆ7ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>æŸ¥æ‰¾æ•°æ®æ˜¯å¦åœ¨é˜Ÿåˆ—è¿™ä¸ªæˆæœ¬ä¹Ÿä¸å°å•Š</div>2019-04-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/95/2c/f254f684.jpg" width="30px"><span>é“ä¸‘-ç‹ç«‹ä¸°</span> ğŸ‘ï¼ˆ5ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>å—¯å—¯ï¼Œæˆ‘ä¸‹åˆä¹Ÿåœ¨æƒ³ï¼Œè¿™ä¸ªé˜Ÿåˆ—åº”è¯¥æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œè€Œä¸”æ–°åŠ çš„å“ˆå¸Œè¡¨å¯èƒ½è¿˜è¦è§£å†³é˜Ÿåˆ—èŠ‚ç‚¹çš„å†²çªé—®é¢˜ã€‚è®¾è®¡çš„å†å¤æ‚ä¸€ç‚¹è¿™ä¸ªç»“æ„åº”è¯¥èƒ½å¤Ÿå’ŒåŸæœ‰çš„é‚£å¼ ç¼“å­˜å“ˆå¸Œè¡¨èåˆã€‚è¿™æ ·è¿˜èƒ½èŠ‚çœå†…å­˜ã€‚</div>2019-04-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/40/e9/29dfa621.jpg" width="30px"><span>å°ç°</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆè¯·æ•™ä¸€ä¸‹ï¼Œ(1+7+5)&#47;10^6=13 è¿™ä¸ªæ˜¯æ€ä¹ˆè®¡ç®—çš„</div>2021-10-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/18/d0/49b06424.jpg" width="30px"><span>qinggeouye</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div># collections çš„ OrderedDict()

class LRUCache:

    def __init__(self, capacity):
        self.capacity = capacity
        self.queue = collections.OrderedDict()

    def get(self, key):
        if key not in self.queue:
            return -1  # è¦æ‰¾çš„æ•°æ®ä¸åœ¨ç¼“å­˜ä¸­åˆ™è¿”å› -1
        value = self.queue.pop(key)  # å°†å‘½ä¸­ç¼“å­˜çš„æ•°æ®ç§»é™¤
        self.queue[key] = value  # å°†å‘½ä¸­ç¼“å­˜çš„æ•°æ®é‡æ–°æ·»åŠ åˆ°å¤´éƒ¨
        return self.queue[key]

    def put(self, key, value):
        if key in self.queue:  # å¦‚æœå·²ç»å­˜åœ¨ç¼“å­˜ä¸­ï¼Œåˆ™å…ˆç§»é™¤è€çš„æ•°æ®
            self.queue.pop(key)
        elif len(self.queue.items()) == self.capacity:
            self.queue.popitem(last=False)  # å¦‚æœä¸å­˜åœ¨ç¼“å­˜å¹¶ä¸”è¾¾åˆ°æœ€å¤§å®¹é‡ åˆ™æŠŠæœ€åçš„æ•°æ®æ·˜æ±°
        self.queue[key] = value  # å°†æ–°æ•°æ®æ·»åŠ åˆ°å¤´éƒ¨</div>2019-04-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/f2/aa/32fc0d54.jpg" width="30px"><span>å¤±ç«çš„å¤å¤©</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>class LRUCache {

    private Node head;&#47;&#47; æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼Œç±»ä¼¼åˆ—é˜Ÿçš„å¤´ï¼Œå‡ºé˜Ÿ
    private Node tail;&#47;&#47; æœ€è¿‘æœ€å¤šä½¿ç”¨ï¼Œç±»ä¼¼é˜Ÿåˆ—çš„å°¾ï¼Œå…¥é˜Ÿ
    private Map&lt;Integer,Node&gt; cache;
    private int capacity;

    public LRUCache(int capacity) {
        this.cache = new HashMap&lt;&gt;();
        this.capacity = capacity;
    }

    public int get(int key) {
        Node node = cache.get(key);
        if(node == null){
            return -1;
        }else{
            moveNode(node);
            return node.value;
        }
    }

    public void put(int key, int value) {
        Node node = cache.get(key);
        if (node != null){
            node.value = value;
            moveNode(node);
        }else {
            removeHead();
            node = new Node(key,value);
            addNode(node);
        }
        cache.put(key,node);
    }

    private void removeHead(){
        if (cache.size() == capacity){
            Node tempNode = head;
            cache.remove(head.key);
            head = head.next;
            tempNode.next = null;
            if (head != null){
                head.prev = null;
            }
        }
    }

    &#47;**
     * é“¾è¡¨åŠ å…¥èŠ‚ç‚¹
     * @param node
     *&#47;
    private void addNode(Node node){
        if (head == null){
            head = node;
            tail = node;
        }else {
            addNodeToTail(node);
        }
    }

    private void addNodeToTail(Node node){
        node.prev = tail;
        tail.next = node;
        tail = node;
    }

    private void moveNode(Node node){
        if(head == node &amp;&amp; node != tail){
            head = node.next;
            head.prev = null;
            node.next = null;
            addNodeToTail(node);
        }else if (tail == node){
            &#47;&#47; ä¸åšä»»ä½•æ“ä½œ
        }else {
            &#47;&#47; æ™®éæƒ…å†µï¼ŒnodeèŠ‚ç‚¹ç§»é™¤é“¾è¡¨ï¼ŒåŠ å…¥åˆ°å°¾èŠ‚ç‚¹åé¢ï¼ŒtailæŒ‡é’ˆæŒ‡å‘node
            node.prev.next = node.next;
            node.next.prev = node.prev;
            node.next = null;
            addNodeToTail(node);
        }
    }
}</div>2019-04-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/f2/aa/32fc0d54.jpg" width="30px"><span>å¤±ç«çš„å¤å¤©</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>
å› ä¸ºç¯‡å¹…ä¸å¤Ÿï¼Œåˆ†æ®µæˆªå‡ºæ¥äº†ï¼Œè¿™é‡Œå…ˆå£°æ˜ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œè¡¨ç¤ºä¸ºé˜Ÿåˆ—ï¼ˆé“¾è¡¨ï¼‰çš„èŠ‚ç‚¹ï¼Œæ¥ä¸‹æ¥çš„NodeèŠ‚ç‚¹æ˜¯è¿™ä¸ªå†…éƒ¨ç±»
private class Node{
        private Node prev;
        private Node next;
        private int key;
        private int value;

        Node(int key,int value){
            this.key = key;
            this.value = value;
        }
    }</div>2019-04-01</li><br/><li><img src="" width="30px"><span>Paul Shan</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>ç¼“å­˜æ„å‘³ç€æ•°æ®æºæœ‰ä¸¤ä¸ªï¼Œè€Œä¸”è¿™ä¸¤ä¸ªæ•°æ®æºè®¿é—®æˆæœ¬å’Œæ•°æ®å®Œå¤‡åº¦ä¸åŒã€‚è®¿é—®æˆæœ¬ä½çš„æ•°æ®ä¸å®Œå¤‡ï¼Œæ•°æ®å®Œå¤‡çš„è®¿é—®æˆæœ¬é«˜ã€‚è¦ç»“åˆè¿™ä¸¤ä¸ªæ•°æ®æºæ¥è®¾è®¡è®¿é—®æˆæœ¬å°½å¯èƒ½ä½ï¼ŒåŒæ—¶æ•°æ®åˆæ˜¯å®Œå¤‡çš„ç³»ç»Ÿã€‚åŸºäºé˜Ÿåˆ—å’Œå“ˆå¸Œè¡¨å®ç°çš„LRUç®—æ³•æ˜¯ç»å…¸ç®—æ³•ä¹‹ä¸€ã€‚é˜Ÿåˆ—ç»´æŠ¤ç¼“å­˜å¤§å°ï¼Œæ»¡çš„æ—¶å€™æ·˜æ±°æœ€è¿‘æ²¡ç”¨åˆ°çš„æ•°æ®ã€‚å“ˆå¸Œè¡¨æå‡æŸ¥è¯¢æ•ˆç‡ã€‚æ¯æ¬¡è®¿é—®ï¼Œå…ˆæŸ¥å“ˆå¸Œè¡¨ï¼Œå¦‚æœæ•°æ®å­˜åœ¨ï¼Œå°†è¯¥æ•°æ®æ”¾åˆ°é˜Ÿåˆ—å°¾éƒ¨ï¼Œè®©å…¶è¿œç¦»è¢«æ·˜æ±°çš„ä½ç½®ï¼Œç„¶åè¿”å›æ•°æ®ã€‚å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œå°±ä»å®Œå¤‡çš„æ•°æ®æºä¸­å–å¾—æ•°æ®ï¼Œå°†æ•°æ®æ”¾å…¥é˜Ÿåˆ—ï¼Œå¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™æ·˜æ±°æ‰æœ€è¿‘æœ€å°‘ç”¨çš„æ•°æ®ï¼Œç„¶åå¾—åˆ°æœ€æ–°è¿”å›çš„æ•°æ®ã€‚é˜Ÿåˆ—è¦é¢ä¸´é¢‘ç¹çš„æ’å…¥å’Œæ”¹ä½ç½®æ“ä½œï¼Œé€‰ç”¨åŸºäºåŒå‘é“¾è¡¨çš„é˜Ÿåˆ—è¾ƒä¸ºé«˜æ•ˆã€‚</div>2019-10-14</li><br/><li><img src="" width="30px"><span>013923</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>ä½¿ç”¨å“ˆå¸Œè¡¨å’Œé˜Ÿåˆ—å¯ä»¥å®ç°é«˜æ•ˆè®¿é—®ï¼›</div>2022-09-23</li><br/><li><img src="" width="30px"><span>013923</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>Cache æ˜¯è®¡ç®—æœºOSçš„åŸºæœ¬å…ƒä»¶</div>2022-09-15</li><br/><li><img src="" width="30px"><span>013923</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>å­¦ä¹ äº†Cacheç¼“å­˜ç³»ç»Ÿï¼›è®¡ç®—æœºåŸºç¡€è¯¾ç¨‹</div>2022-09-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/51/86/b5fd8dd8.jpg" width="30px"><span>å»ºå¼º</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>å—ç¯‡å¹…é™åˆ¶ï¼Œæœ‰éƒ¨åˆ†å‡½æ•°æ²¡æœ‰åˆ—å‡º
# å®šä¹‰å“ˆå¸Œé“¾è¡¨çš„èŠ‚ç‚¹
class HashLinkNode:
    def __init__(self, data, next=None):
        self.data = data
        self.next = next

class LRUCache:
    
    # ç¼“å­˜åˆå§‹åŒ–
    def __init__(self, maxsize):
        self.maxsize = maxsize 
        self.currsize = 0 
        self.queue = [] 
        self.hashtable = {} 
    
    # æ·˜æ±°ç­–ç•¥
    def _takeout(self):
        data = self.queue.pop(0) # å–å‡ºé˜Ÿå¤´å…ƒç´ 
        hashvalue = self._hashvalue(data)
        head = self.hashtable.get(hashvalue, None)
        node = head

        # åœ¨å“ˆå¸Œé“¾è¡¨ä¸­æŸ¥æ‰¾å¹¶åˆ é™¤è¢«æ·˜æ±°çš„ç»“ç‚¹
        if node is not None:

            while node.data != data and node.next is not None:
                node = node.next
            if node.data == data:
                if node.next is None:
                    node.data = None
                else:
                    node.data = node.next.data
                    node.next = node.next.next
        
        if head is None or head.data is None:
            del self.hashtable[hashvalue]
        
        # å½“å‰å®¹é‡å‡1
        self.currsize -= 1
    
    # æ•°æ®åŠ å…¥ç¼“å­˜
    def add(self, data):
        
        # ç¼“å­˜å·²æ»¡ï¼Œæ‰§è¡Œæ·˜æ±°ç­–ç•¥
        if self._isfull():
            self._takeout()
        
        hashvalue = self._hashvalue(data)
        node = HashLinkNode(data)
        head = self.hashtable.setdefault(hashvalue, None)
        node.next = head
        head = node
        self.hashtable[hashvalue] = head
        
        # æ–°åŠ å…¥çš„æ•°æ®ï¼Œç½®äºé˜Ÿåˆ—å°¾
        self.queue.append(data)
        
        # å½“å‰ç¼“å­˜å®¹é‡åŠ 1
        self.currsize += 1
    
    # è·å–æ•°æ®
    def visit(self, data):
        hashvalue = self._hashvalue(data)
        head = self.hashtable.get(hashvalue, None)
        node = head
        
        while node is not None:
            
            # è®¿é—®å‘½ä¸­ï¼Œå‘½ä¸­çš„æ•°æ®ç½®äºé˜Ÿå°¾ï¼Œè¿”å›True
            if node.data == data:
                del self.queue[self.queue.index(data)]
                self.queue.append(data)
                return True
            
            node = node.next
            
        return False</div>2020-12-13</li><br/>
</ul>