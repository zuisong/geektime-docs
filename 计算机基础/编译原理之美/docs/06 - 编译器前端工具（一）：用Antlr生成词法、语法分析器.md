å‰é¢çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘é‡ç‚¹è®²è§£äº†è¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æï¼Œåœ¨ä¾‹å­ä¸­æåˆ°çš„è¯æ³•å’Œè¯­æ³•è§„åˆ™ä¹Ÿæ˜¯é«˜åº¦ç®€åŒ–çš„ã€‚è™½ç„¶è¿™äº›å†…å®¹ä¾¿äºç†è§£åŸç†ï¼Œä¹Ÿèƒ½å®ç°ä¸€ä¸ªç®€å•çš„åŸå‹ï¼Œåœ¨å®é™…åº”ç”¨ä¸­å´è¿œè¿œä¸å¤Ÿã€‚å®é™…åº”ç”¨ä¸­ï¼Œä¸€ä¸ªå®Œå–„çš„ç¼–è¯‘ç¨‹åºè¿˜è¦åœ¨è¯æ³•æ–¹é¢ä»¥åŠè¯­æ³•æ–¹é¢å®ç°å¾ˆå¤šå·¥ä½œï¼Œæˆ‘è¿™é‡Œç‰¹æ„ç”»äº†ä¸€å¼ å›¾ï¼Œä½ å¯ä»¥ç›´è§‚åœ°çœ‹ä¸€ä¸‹ã€‚

![](https://static001.geekbang.org/resource/image/49/c1/49098ee32e1344550c41312862ec8ec1.jpg?wh=1142%2A429)

å¦‚æœè®©ç¼–è¯‘ç¨‹åºå®ç°ä¸Šé¢è¿™ä¹ˆå¤šå·¥ä½œï¼Œå®Œå…¨æ‰‹å†™æ•ˆç‡ä¼šæœ‰ç‚¹å„¿ä½ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥æå‡æ•ˆç‡å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å€ŸåŠ©å·¥å…·ã€‚

ç¼–è¯‘å™¨å‰ç«¯å·¥å…·æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚Lexï¼ˆä»¥åŠGNUçš„ç‰ˆæœ¬Flexï¼‰ã€Yaccï¼ˆä»¥åŠGNUçš„ç‰ˆæœ¬Bisonï¼‰ã€JavaCCç­‰ç­‰ã€‚ä½ å¯èƒ½ä¼šé—®äº†ï¼šâ€œé‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬è¿™èŠ‚è¯¾åªè®²Antlrï¼Œä¸é€‰åˆ«çš„å·¥å…·å‘¢ï¼Ÿâ€ä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ã€‚

ç¬¬ä¸€ä¸ªåŸå› æ˜¯Antlrèƒ½æ”¯æŒæ›´å¹¿æ³›çš„ç›®æ ‡è¯­è¨€ï¼ŒåŒ…æ‹¬Javaã€C#ã€JavaScriptã€Pythonã€Goã€C++ã€Swiftã€‚æ— è®ºä½ ç”¨ä¸Šé¢å“ªç§è¯­è¨€ï¼Œéƒ½å¯ä»¥ç”¨å®ƒç”Ÿæˆè¯æ³•å’Œè¯­æ³•åˆ†æçš„åŠŸèƒ½ã€‚è€Œæˆ‘ä»¬å°±ä½¿ç”¨å®ƒç”Ÿæˆäº†Javaè¯­è¨€å’ŒC++è¯­è¨€ä¸¤ä¸ªç‰ˆæœ¬çš„ä»£ç ã€‚

ç¬¬äºŒä¸ªåŸå› æ˜¯Antlrçš„è¯­æ³•æ›´åŠ ç®€å•ã€‚å®ƒèƒ½æŠŠç±»ä¼¼å·¦é€’å½’çš„ä¸€äº›å¸¸è§éš¾ç‚¹åœ¨å·¥å…·ä¸­è§£å†³ï¼Œå¯¹æå‡å·¥ä½œæ•ˆç‡æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚è¿™ä¸€ç‚¹ï¼Œä½ ä¼šåœ¨åé¢çš„è¯¾ç¨‹ä¸­ç›´è§‚åœ°æ„Ÿå—åˆ°ã€‚

è€Œæˆ‘ä»¬ä»Šå¤©çš„ç›®æ ‡å°±æ˜¯äº†è§£Antlrï¼Œç„¶åèƒ½å¤Ÿä½¿ç”¨Antlrç”Ÿæˆè¯æ³•åˆ†æå™¨ä¸è¯­æ³•åˆ†æå™¨ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘è¿˜ä¼šå¸¦ä½ å€Ÿé‰´æˆç†Ÿçš„è¯æ³•å’Œè¯­æ³•è§„åˆ™ï¼Œè®©ä½ å¿«é€Ÿæˆé•¿ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹Antlrè¿™ä¸ªå·¥å…·ã€‚

## åˆè¯†Antlr

Antlræ˜¯ä¸€ä¸ªå¼€æºçš„å·¥å…·ï¼Œæ”¯æŒæ ¹æ®è§„åˆ™æ–‡ä»¶ç”Ÿæˆè¯æ³•åˆ†æå™¨å’Œè¯­æ³•åˆ†æå™¨ï¼Œå®ƒè‡ªèº«æ˜¯ç”¨Javaå®ç°çš„ã€‚

ä½ å¯ä»¥[ä¸‹è½½Antlrå·¥å…·](https://www.antlr.org/)ï¼Œå¹¶æ ¹æ®è¯´æ˜åšå¥½é…ç½®ã€‚åŒæ—¶ï¼Œä½ è¿˜éœ€è¦é…ç½®å¥½æœºå™¨ä¸Šçš„Javaç¯å¢ƒï¼ˆå¯ä»¥åœ¨[Oracleå®˜ç½‘](https://www.oracle.com/index.html)æ‰¾åˆ°æœ€æ–°ç‰ˆæœ¬çš„JDKï¼‰ã€‚

å› ä¸ºæˆ‘ç”¨çš„æ˜¯Macï¼Œæ‰€ä»¥æˆ‘ç”¨macOSå¹³å°ä¸‹çš„è½¯ä»¶åŒ…ç®¡ç†å·¥å…·Homebrewå®‰è£…äº†Antlrï¼Œå®ƒå¯ä»¥è‡ªåŠ¨è®¾ç½®å¥½antlrå’Œgrunä¸¤ä¸ªå‘½ä»¤ï¼ˆantlrå’Œgrunåˆ†åˆ«æ˜¯java org.antlr.v4.Toolå’Œjava org.antlr.v4.gui.TestRigè¿™ä¸¤ä¸ªå‘½ä»¤çš„åˆ«åï¼‰ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½ è¦æŠŠAntlrçš„JARæ–‡ä»¶è®¾ç½®åˆ°CLASSPATHç¯å¢ƒå˜é‡ä¸­ï¼Œä»¥ä¾¿é¡ºåˆ©ç¼–è¯‘æ‰€ç”Ÿæˆçš„Javaæºä»£ç ã€‚

[GitHub](https://github.com/antlr/grammars-v4)ä¸Šè¿˜æœ‰å¾ˆå¤šä¾›å‚è€ƒçš„è¯­æ³•è§„åˆ™ï¼Œä½ å¯ä»¥ä¸‹è½½åˆ°æœ¬åœ°ç¡¬ç›˜éšæ—¶æŸ¥é˜…ã€‚

ç°åœ¨ä½ å·²ç»å¯¹Antlræœ‰äº†åˆæ­¥çš„äº†è§£ï¼Œä¹ŸçŸ¥é“å¦‚ä½•å®‰è£…å®ƒäº†ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å¸¦ä½ å®é™…ç”¨ä¸€ç”¨Antlrï¼Œè®©ä½ ç”¨æ›´è½»æ¾çš„æ–¹å¼ç”Ÿæˆè¯æ³•åˆ†æå™¨å’Œè¯­æ³•åˆ†æå™¨ã€‚

## ç”¨Antlrç”Ÿæˆè¯æ³•åˆ†æå™¨

ä½ å¯èƒ½å¯¹Antlrè¿˜ä¸æ€ä¹ˆç†Ÿæ‚‰ï¼Œæ‰€ä»¥æˆ‘ä¼šå…ˆå¸¦ä½ ä½¿ç”¨å‰é¢è¯¾ç¨‹ä¸­ï¼Œä½ å·²ç»æ¯”è¾ƒç†Ÿæ‚‰çš„é‚£äº›è¯æ³•è§„åˆ™ï¼Œè®©Antlrç”Ÿæˆä¸€ä¸ªæ–°çš„è¯æ³•åˆ†æå™¨ï¼Œç„¶åå†å€Ÿé‰´ä¸€äº›æˆç†Ÿçš„è§„åˆ™æ–‡ä»¶ï¼ŒæŠŠè¯æ³•åˆ†æå™¨æå‡åˆ°æ›´åŠ ä¸“ä¸šã€å®ç”¨çš„çº§åˆ«ã€‚

Antlré€šè¿‡è§£æè§„åˆ™æ–‡ä»¶æ¥ç”Ÿæˆç¼–è¯‘å™¨ã€‚è§„åˆ™æ–‡ä»¶ä»¥.g4ç»“å°¾ï¼Œè¯æ³•è§„åˆ™å’Œè¯­æ³•è§„åˆ™å¯ä»¥æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶é‡Œã€‚ä¸è¿‡ä¸ºäº†æ¸…æ™°èµ·è§ï¼Œæˆ‘ä»¬è¿˜æ˜¯æŠŠå®ƒä»¬åˆ†æˆä¸¤ä¸ªæ–‡ä»¶ï¼Œå…ˆç”¨ä¸€ä¸ªæ–‡ä»¶ç¼–å†™è¯æ³•è§„åˆ™ã€‚

**ä¸ºäº†è®©ä½ å¿«é€Ÿè¿›å…¥çŠ¶æ€ï¼Œæˆ‘ä»¬å…ˆåšä¸€ä¸ªç®€å•çš„ç»ƒä¹ é¢„çƒ­ä¸€ä¸‹ã€‚**æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªHello.g4æ–‡ä»¶ï¼Œç”¨äºä¿å­˜è¯æ³•è§„åˆ™ï¼Œç„¶åæŠŠä¹‹å‰ç”¨è¿‡çš„ä¸€äº›è¯æ³•è§„åˆ™å†™è¿›å»ã€‚

```
lexer grammar Hello;  //lexerå…³é”®å­—æ„å‘³ç€è¿™æ˜¯ä¸€ä¸ªè¯æ³•è§„åˆ™æ–‡ä»¶ï¼Œåç§°æ˜¯Helloï¼Œè¦ä¸æ–‡ä»¶åç›¸åŒ

//å…³é”®å­—
If :               'if';
Int :              'int';

//å­—é¢é‡
IntLiteral:        [0-9]+;
StringLiteral:      '"' .*? '"' ;  //å­—ç¬¦ä¸²å­—é¢é‡

//æ“ä½œç¬¦
AssignmentOP:       '=' ;    
RelationalOP:       '>'|'>='|'<' |'<=' ;    
Star:               '*';
Plus:               '+';
Sharp:              '#';
SemiColon:          ';';
Dot:                '.';
Comm:               ',';
LeftBracket :       '[';
RightBracket:       ']';
LeftBrace:          '{';
RightBrace:         '}';
LeftParen:          '(';
RightParen:         ')';

//æ ‡è¯†ç¬¦
Id :                [a-zA-Z_] ([a-zA-Z_] | [0-9])*;

//ç©ºç™½å­—ç¬¦ï¼ŒæŠ›å¼ƒ
Whitespace:         [ \t]+ -> skip;
Newline:            ( '\r' '\n'?|'\n')-> skip;
```

ä½ èƒ½å¾ˆç›´è§‚åœ°çœ‹åˆ°ï¼Œæ¯ä¸ªè¯æ³•è§„åˆ™éƒ½æ˜¯å¤§å†™å­—æ¯å¼€å¤´ï¼Œè¿™æ˜¯Antlrå¯¹è¯æ³•è§„åˆ™çš„çº¦å®šã€‚è€Œè¯­æ³•è§„åˆ™æ˜¯ä»¥å°å†™å­—æ¯å¼€å¤´çš„ã€‚å…¶ä¸­ï¼Œæ¯ä¸ªè§„åˆ™éƒ½æ˜¯ç”¨æˆ‘ä»¬å·²ç»äº†è§£çš„æ­£åˆ™è¡¨è¾¾å¼ç¼–å†™çš„ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥ç¼–è¯‘è¯æ³•è§„åˆ™ï¼Œåœ¨ç»ˆç«¯ä¸­è¾“å…¥å‘½ä»¤ï¼š

```
antlr Hello.g4
```

è¿™ä¸ªå‘½ä»¤æ˜¯è®©Antlrç¼–è¯‘è§„åˆ™æ–‡ä»¶ï¼Œå¹¶ç”ŸæˆHello.javaæ–‡ä»¶å’Œå…¶ä»–ä¸¤ä¸ªè¾…åŠ©æ–‡ä»¶ã€‚ä½ å¯ä»¥æ‰“å¼€çœ‹ä¸€çœ‹æ–‡ä»¶é‡Œé¢çš„å†…å®¹ã€‚æ¥ç€ï¼Œæˆ‘ç”¨ä¸‹é¢çš„å‘½ä»¤ç¼–è¯‘Hello.javaï¼š

```
javac *.java
```

ç»“æœä¼šç”ŸæˆHello.classæ–‡ä»¶ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ç”Ÿæˆçš„è¯æ³•åˆ†æå™¨ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å†™ä¸ªè„šæœ¬æ–‡ä»¶ï¼Œè®©ç”Ÿæˆçš„è¯æ³•åˆ†æå™¨è§£æä¸€ä¸‹ï¼š

```
int age = 45;
if (age >= 17+8+20){
  printf("Hello old man!");
}
```

æˆ‘ä»¬å°†ä¸Šé¢çš„è„šæœ¬å­˜æˆhello.playæ–‡ä»¶ï¼Œç„¶ååœ¨ç»ˆç«¯è¾“å…¥ä¸‹é¢çš„å‘½ä»¤ï¼š

```
grun Hello tokens -tokens hello.play
```

grunå‘½ä»¤å®é™…ä¸Šæ˜¯è°ƒç”¨äº†æˆ‘ä»¬åˆšæ‰ç”Ÿæˆçš„è¯æ³•åˆ†æå™¨ï¼Œå³Helloç±»ï¼Œæ‰“å°å‡ºå¯¹hello.playè¯æ³•åˆ†æçš„ç»“æœï¼š

![](https://static001.geekbang.org/resource/image/dc/e9/dc9f9dcebd4c73eecd05fece12ba38e9.jpg?wh=1142%2A972)

ä»ç»“æœä¸­çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„è¯æ³•åˆ†æå™¨æŠŠæ¯ä¸ªTokenéƒ½è¯†åˆ«äº†ï¼Œè¿˜è®°å½•äº†å®ƒä»¬åœ¨ä»£ç ä¸­çš„ä½ç½®ã€æ–‡æœ¬å€¼ã€ç±»åˆ«ã€‚ä¸Šé¢è¿™äº›éƒ½æ˜¯Tokençš„å±æ€§ã€‚

ä»¥ç¬¬äºŒè¡Œ\[@1, 4:6=â€˜ageâ€™,&lt; Id &gt;,1:4]ä¸ºä¾‹ï¼Œå…¶ä¸­@1æ˜¯Tokençš„æµæ°´ç¼–å·ï¼Œè¡¨æ˜è¿™æ˜¯1å·Tokenï¼›4:6æ˜¯Tokenåœ¨å­—ç¬¦æµä¸­çš„å¼€å§‹å’Œç»“æŸä½ç½®ï¼›ageæ˜¯æ–‡æœ¬å€¼ï¼ŒIdæ˜¯å…¶Tokenç±»åˆ«ï¼›æœ€åçš„1:4è¡¨ç¤ºè¿™ä¸ªTokenåœ¨æºä»£ç ä¸­ä½äºç¬¬1è¡Œã€ç¬¬4åˆ—ã€‚

éå¸¸å¥½ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»è®©Antlré¡ºåˆ©è·‘èµ·æ¥äº†ï¼æ¥ä¸‹æ¥ï¼Œè®©è¯æ³•è§„åˆ™æ›´å®Œå–„ã€æ›´ä¸¥å¯†ä¸€äº›å§ï¼**æ€ä¹ˆåšå‘¢ï¼Ÿå½“ç„¶æ˜¯å‚è€ƒæˆç†Ÿçš„è§„åˆ™æ–‡ä»¶ã€‚**

ä»Antlrçš„ä¸€äº›ç¤ºèŒƒæ€§çš„è§„åˆ™æ–‡ä»¶ä¸­ï¼Œæˆ‘é€‰äº†Javaçš„ä½œä¸ºå‚è€ƒã€‚å…ˆçœ‹çœ‹æˆ‘ä»¬ä¹‹å‰å†™çš„å­—ç¬¦ä¸²å­—é¢é‡çš„è§„åˆ™ï¼š

```
StringLiteral:      '"' .*? '"' ;  //å­—ç¬¦ä¸²å­—é¢é‡
```

æˆ‘ä»¬çš„ç‰ˆæœ¬ç›¸å½“ç®€åŒ–ï¼Œå°±æ˜¯åœ¨åŒå¼•å·å¯ä»¥åŒ…å«ä»»ä½•å­—ç¬¦ã€‚å¯è¿™åœ¨å®é™…ä¸­ä¸å¤§å¥½ç”¨ï¼Œå› ä¸ºè¿è½¬ä¹‰åŠŸèƒ½éƒ½æ²¡æœ‰æä¾›ã€‚æˆ‘ä»¬å¯¹äºä¸€äº›ä¸å¯è§çš„å­—ç¬¦ï¼Œæ¯”å¦‚å›è½¦ï¼Œè¦æä¾›è½¬ä¹‰åŠŸèƒ½ï¼Œå¦‚â€œ\\nâ€ã€‚åŒæ—¶ï¼Œå¦‚æœå­—ç¬¦ä¸²é‡Œæœ¬èº«æœ‰åŒå¼•å·çš„è¯ï¼Œä¹Ÿè¦å°†å®ƒè½¬ä¹‰ï¼Œå¦‚â€œ\\â€ã€‚Unicodeä¹Ÿè¦è½¬ä¹‰ã€‚æœ€åï¼Œè½¬ä¹‰å­—ç¬¦æœ¬èº«ä¹Ÿéœ€è¦è½¬ä¹‰ï¼Œå¦‚â€œ\\\\â€ã€‚

ä¸‹é¢è¿™ä¸€æ®µå†…å®¹æ˜¯Javaè¯­è¨€ä¸­çš„å­—ç¬¦ä¸²å­—é¢é‡çš„å®Œæ•´è§„åˆ™ã€‚ä½ å¯ä»¥çœ‹ä¸€ä¸‹æ–‡ç¨¿ï¼Œè¿™ä¸ªè§„åˆ™å°±å¾ˆç»†è‡´äº†ï¼ŒæŠŠå„ç§è½¬ä¹‰çš„æƒ…å†µéƒ½è€ƒè™‘è¿›å»äº†ï¼š

```
STRING_LITERAL:     '"' (~["\\\r\n] | EscapeSequence)* '"';

fragment EscapeSequence
    : '\\' [btnfr"'\\]
    | '\\' ([0-3]? [0-7])? [0-7]
    | '\\' 'u'+ HexDigit HexDigit HexDigit HexDigit
    ;

fragment HexDigit
    : [0-9a-fA-F]
    ;  
```

åœ¨è¿™ä¸ªè§„åˆ™æ–‡ä»¶ä¸­ï¼ŒfragmentæŒ‡çš„æ˜¯ä¸€ä¸ªè¯­æ³•ç‰‡æ®µï¼Œæ˜¯ä¸ºäº†è®©è§„åˆ™å®šä¹‰æ›´æ¸…æ™°ã€‚å®ƒæœ¬èº«å¹¶ä¸ç”ŸæˆTokenï¼Œåªæœ‰StringLiteralè§„åˆ™æ‰ä¼šç”ŸæˆTokenã€‚

å½“ç„¶äº†ï¼Œé™¤äº†å­—ç¬¦ä¸²å­—é¢é‡ï¼Œæ•°å­—å­—é¢é‡ã€æ ‡è¯†ç¬¦çš„è§„åˆ™ä¹Ÿå¯ä»¥å®šä¹‰å¾—æ›´ä¸¥å¯†ã€‚ä¸è¿‡ï¼Œå› ä¸ºè¿™äº›è§„åˆ™æ–‡ä»¶éƒ½å¾ˆä¸¥å¯†ï¼Œå†™å‡ºæ¥éƒ½å¾ˆé•¿ï¼Œåœ¨è¿™é‡Œæˆ‘å°±ä¸ä¸€ä¸€å±•å¼€äº†ã€‚å¦‚æœæ„Ÿå…´è¶£ï¼Œæˆ‘æ¨èä½ åœ¨ä¸‹è½½çš„è§„åˆ™æ–‡ä»¶ä¸­æ‰¾åˆ°è¿™äº›éƒ¨åˆ†çœ‹ä¸€çœ‹ã€‚ä½ è¿˜å¯ä»¥å‚è€ƒä¸åŒä½œè€…å†™çš„è¯æ³•è§„åˆ™ï¼Œä½“ä¼šä¸€ä¸‹ä»–ä»¬çš„è®¾è®¡æ€è·¯ã€‚å’Œé«˜æ‰‹è¿‡æ‹›ï¼Œä¼šæ›´å¿«åœ°æé«˜ä½ çš„æ°´å¹³ã€‚

æˆ‘ä¹Ÿæ‹·è´äº†ä¸€äº›æˆç†Ÿçš„è¯æ³•è§„åˆ™ï¼Œç¼–å†™äº†ä¸€ä¸ªCommonLexer.g4çš„è§„åˆ™æ–‡ä»¶ï¼Œè¿™ä¸ªè¯æ³•è§„åˆ™æ˜¯æˆ‘ä»¬åé¢å·¥ä½œçš„åŸºç¡€ï¼Œå®ƒåŸºæœ¬ä¸Šå·²ç»è¾¾åˆ°äº†ä¸“ä¸šã€å®ç”¨çš„ç¨‹åº¦ã€‚

åœ¨å¸¦ä½ å€Ÿé‰´äº†æˆç†Ÿçš„è§„åˆ™æ–‡ä»¶ä¹‹åï¼Œæˆ‘æƒ³ç©¿æ’æ€§åœ°è®²è§£ä¸€ä¸‹åœ¨è¯æ³•è§„åˆ™ä¸­å¯¹Tokenå½’ç±»çš„é—®é¢˜ã€‚åœ¨è®¾è®¡è¯æ³•è§„åˆ™æ—¶ï¼Œä½ ç»å¸¸ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¯æ³•è§„åˆ™ä¼šæ›´åŠ å®Œå–„ã€‚

åœ¨å‰é¢ç»ƒä¹ çš„è§„åˆ™æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æŠŠ&gt;=ã€&gt;ã€&lt;éƒ½å½’ç±»ä¸ºå…³ç³»è¿ç®—ç¬¦ï¼Œç®—ä½œåŒä¸€ç±»Tokenï¼Œè€Œ+ã€\*ç­‰éƒ½å•ç‹¬ä½œä¸ºå¦ä¸€ç±»Tokenã€‚é‚£ä¹ˆï¼Œå“ªäº›å¯ä»¥å½’å¹¶æˆä¸€ç±»ï¼Œå“ªäº›åˆæ˜¯éœ€è¦å•ç‹¬åˆ—å‡ºçš„å‘¢ï¼Ÿ

å…¶å®ï¼Œè¿™ä¸»è¦å–å†³äºè¯­æ³•çš„éœ€è¦ã€‚ä¹Ÿå°±æ˜¯åœ¨è¯­æ³•è§„åˆ™æ–‡ä»¶é‡Œï¼Œæ˜¯å¦å¯ä»¥å‡ºç°åœ¨åŒä¸€æ¡è§„åˆ™é‡Œã€‚å®ƒä»¬åœ¨è¯­æ³•å±‚é¢ä¸Šæ²¡æœ‰åŒºåˆ«ï¼Œåªæ˜¯åœ¨è¯­ä¹‰å±‚é¢ä¸Šæœ‰åŒºåˆ«ã€‚æ¯”å¦‚ï¼ŒåŠ æ³•å’Œå‡æ³•è™½ç„¶æ˜¯ä¸åŒçš„è¿ç®—ï¼Œä½†å®ƒä»¬å¯ä»¥åŒæ—¶å‡ºç°åœ¨åŒä¸€æ¡è¯­æ³•è§„åˆ™ä¸­ï¼Œå®ƒä»¬åœ¨è¿ç®—æ—¶çš„ç‰¹æ€§å®Œå…¨ä¸€è‡´ï¼ŒåŒ…æ‹¬ä¼˜å…ˆçº§å’Œç»“åˆæ€§ï¼Œä¹˜æ³•å’Œé™¤æ³•å¯ä»¥åŒæ—¶å‡ºç°åœ¨ä¹˜æ³•è§„åˆ™ä¸­ã€‚ä½ æŠŠåŠ å·å’Œå‡å·åˆå¹¶æˆä¸€ç±»ï¼ŒæŠŠä¹˜å·å’Œé™¤å·åˆå¹¶æˆä¸€ç±»æ˜¯å¯ä»¥çš„ã€‚æŠŠè¿™4ä¸ªè¿ç®—ç¬¦æ¯ä¸ªéƒ½å•ç‹¬ä½œä¸ºä¸€ç±»ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ä½†æ˜¯ï¼Œä¸èƒ½æŠŠåŠ å·å’Œä¹˜å·ä½œä¸ºåŒä¸€ç±»ï¼Œå› ä¸ºå®ƒä»¬åœ¨ç®—æœ¯è¿ç®—ä¸­çš„ä¼˜å…ˆçº§ä¸åŒï¼Œè‚¯å®šå‡ºç°åœ¨ä¸åŒçš„è¯­æ³•è§„åˆ™ä¸­ã€‚

æˆ‘ä»¬å†æ¥å›é¡¾ä¸€ä¸‹åœ¨â€œ[02 | æ­£åˆ™æ–‡æ³•å’Œæœ‰é™è‡ªåŠ¨æœºï¼šçº¯æ‰‹å·¥æ‰“é€ è¯æ³•åˆ†æå™¨](https://time.geekbang.org/column/article/118378)â€é‡Œåšè¯æ³•åˆ†ææ—¶é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ã€‚å½“æ—¶ï¼Œæˆ‘ä»¬åˆ†æäº†è¯æ³•å†²çªçš„é—®é¢˜ï¼Œå³æ ‡è¯†ç¬¦å’Œå…³é”®å­—çš„è§„åˆ™æ˜¯æœ‰é‡å çš„ã€‚Antlræ˜¯æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜çš„å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œå®ƒå¼•å…¥äº†ä¼˜å…ˆçº§çš„æ¦‚å¿µã€‚åœ¨Antlrçš„è§„åˆ™æ–‡ä»¶ä¸­ï¼Œè¶Šæ˜¯å‰é¢å£°æ˜çš„è§„åˆ™ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬æŠŠå…³é”®å­—çš„è§„åˆ™æ”¾åœ¨IDçš„è§„åˆ™å‰é¢ã€‚ç®—æ³•åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šé¦–å…ˆæ£€æŸ¥æ˜¯å¦ä¸ºå…³é”®å­—ï¼Œç„¶åæ‰ä¼šæ£€æŸ¥æ˜¯å¦ä¸ºIDï¼Œä¹Ÿå°±æ˜¯æ ‡è¯†ç¬¦ã€‚

è¿™è·Ÿæˆ‘ä»¬å½“æ—¶æ„é€ æœ‰é™è‡ªåŠ¨æœºåšè¯æ³•åˆ†ææ˜¯ä¸€æ ·çš„ã€‚é‚£æ—¶ï¼Œæˆ‘ä»¬å…ˆåˆ¤æ–­æ˜¯ä¸æ˜¯å…³é”®å­—ï¼Œå¦‚æœä¸æ˜¯å…³é”®å­—ï¼Œæ‰è¯†åˆ«ä¸ºæ ‡è¯†ç¬¦ã€‚è€Œåœ¨Antlré‡Œï¼Œä»…ä»…é€šè¿‡å£°æ˜çš„é¡ºåºå°±è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œçœäº†å¾ˆå¤šäº‹å„¿å•Šï¼

å†è¯´ä¸ªæœ‰è¶£çš„é¢˜å¤–è¯ã€‚ä¹‹å‰å›½å†…æœ‰äººæâ€œä¸­æ–‡ç¼–ç¨‹è¯­è¨€â€çš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯è¯­æ³•ä¸­çš„å…³é”®å­—é‡‡ç”¨ä¸­æ–‡ï¼Œæ¯”å¦‚â€œå¦‚æœâ€â€œé‚£ä¹ˆâ€ç­‰ã€‚ä»–ä»¬ä¼¼ä¹è§‰å¾—è¿™æ ·æ›´å®¹æ˜“ç†è§£å’ŒæŒæ¡ã€‚æˆ‘ä¸å¤ªæå€¡è¿™ç§æƒ³æ³•ï¼Œåˆ«çš„ä¸è¯´ï¼Œç”¨ä¸­æ–‡å†™å…³é”®å­—å’Œå˜é‡åï¼Œéœ€è¦è¾“å…¥æ›´å¤šçš„å­—ç¬¦ï¼Œæœ‰ç‚¹å„¿éº»çƒ¦ã€‚ä¸­å›½çš„è‹±è¯­æ•™è‚²å¾ˆæ™®åŠï¼Œç”¨è‹±è¯­æ¥å†™ä»£ç ï¼Œå…¶å®å°±å¤Ÿäº†ã€‚

ä¸è¿‡ï¼Œä½ å¤§å¯ä»¥è¯•ä¸€ä¸‹ï¼Œè®©è‡ªå·±çš„è¯æ³•è§„åˆ™æ”¯æŒä¸­æ–‡å…³é”®å­—ã€‚æ¯”å¦‚ï¼ŒæŠŠâ€œIfâ€çš„è§„åˆ™æ”¹æˆåŒæ—¶æ”¯æŒè‹±æ–‡çš„â€œifâ€ï¼Œä»¥åŠä¸­æ–‡çš„â€œå¦‚æœâ€ï¼š

```
If:                 'if' | 'å¦‚æœ';
```

å†æŠŠæµ‹è¯•ç”¨çš„è„šæœ¬hello.playä¸­çš„â€œifâ€ä¹Ÿæ”¹æˆâ€œå¦‚æœâ€ï¼Œå†™æˆï¼š

```
å¦‚æœ (age >= 17+8+20){
```

é‡æ–°ç”Ÿæˆè¯æ³•åˆ†æå™¨å¹¶è¿è¡Œï¼Œä½ ä¼šå‘ç°è¾“å‡ºä¸­æœ‰è¿™ä¹ˆä¸€è¡Œï¼š

```
[@5,14:15='å¦‚æœ',<If>,2:0]
```

è¿™ä¸ªTokençš„æ–‡æœ¬å€¼æ˜¯â€œå¦‚æœâ€ï¼Œä½†ç±»åˆ«ä»ç„¶æ˜¯â€œIfâ€ã€‚æ‰€ä»¥ï¼Œè¦æƒ³å®ç°æ‰€è°“çš„â€œä¸­æ–‡ç¼–ç¨‹è¯­è¨€â€ï¼ŒæŠŠCã€Javaç­‰è¯­è¨€çš„è¯æ³•è§„åˆ™æ”¹ä¸€æ”¹ï¼Œå†æŠŠç¼–è¯‘å™¨é‡æ–°ç¼–è¯‘ä¸€ä¸‹å°±è¡Œäº†ï¼

## ç”¨Antlrç”Ÿæˆè¯­æ³•åˆ†æå™¨

è¯´å›æˆ‘ä»¬çš„è¯é¢˜ã€‚ç°åœ¨ï¼Œä½ å·²ç»çŸ¥é“å¦‚ä½•ç”¨Antlråšä¸€ä¸ªè¯æ³•åˆ†æå™¨ï¼Œè¿˜çŸ¥é“å¯ä»¥å€Ÿé‰´æˆç†Ÿçš„è§„åˆ™æ–‡ä»¶ï¼Œè®©è‡ªå·±çš„è¯æ³•è§„åˆ™æ–‡ä»¶å˜å¾—æ›´å®Œå–„ã€æ›´ä¸“ä¸šã€‚æ¥ä¸‹æ¥ï¼Œè¯•ç€ç”¨Antlrç”Ÿæˆä¸€ä¸ªè¯­æ³•åˆ†æå™¨ï¼Œæ›¿ä»£ä¹‹å‰æ‰‹å†™çš„è¯­æ³•åˆ†æå™¨å§ï¼

è¿™ä¸€æ¬¡çš„æ–‡ä»¶åå«åšPlayScript.g4ã€‚playscriptæ˜¯ä¸ºæˆ‘ä»¬çš„è„šæœ¬è¯­è¨€èµ·çš„åç§°ï¼Œæ–‡ä»¶å¼€å¤´æ˜¯è¿™æ ·çš„ï¼š

```
grammar PlayScript;
import CommonLexer;   //å¯¼å…¥è¯æ³•å®šä¹‰

/*ä¸‹é¢çš„å†…å®¹åŠ åˆ°æ‰€ç”Ÿæˆçš„Javaæºæ–‡ä»¶çš„å¤´éƒ¨ï¼Œå¦‚åŒ…åç§°ï¼Œimportè¯­å¥ç­‰ã€‚*/
@header {
package antlrtest;
}
```

ç„¶åæŠŠä¹‹å‰åšè¿‡çš„è¯­æ³•å®šä¹‰æ”¾è¿›å»ã€‚Antlrå†…éƒ¨æœ‰è‡ªåŠ¨å¤„ç†å·¦é€’å½’çš„æœºåˆ¶ï¼Œä½ å¯ä»¥æ”¾å¿ƒå¤§èƒ†åœ°æŠŠè¯­æ³•è§„åˆ™å†™æˆä¸‹é¢çš„æ ·å­ï¼š

```
expression
    :   assignmentExpression
    |   expression ',' assignmentExpression
    ;

assignmentExpression
    :   additiveExpression
    |   Identifier assignmentOperator additiveExpression
    ;

assignmentOperator
    :   '='
    |   '*='
    |	'/='
    |   '%='
    |   '+='
    |   '-='
    ;

additiveExpression
    :   multiplicativeExpression
    |   additiveExpression '+' multiplicativeExpression
    |   additiveExpression '-' multiplicativeExpression
    ;

multiplicativeExpression
    :   primaryExpression
    |   multiplicativeExpression '*' primaryExpression
    |   multiplicativeExpression '/' primaryExpression
    |   multiplicativeExpression '%' primaryExpression
    ;
```

ä½ å¯èƒ½ä¼šé—®ï¼šâ€œæ—¢ç„¶ç”¨Antlrå¯ä»¥ä¸ç®¡å·¦é€’å½’é—®é¢˜ï¼Œé‚£ä¹‹å‰ä¸ºä»€ä¹ˆè¦è´¹åŠ›æ°”è§£å†³å®ƒå‘¢ï¼Ÿâ€é‚£æ˜¯å› ä¸ºå½“ä½ é‡åˆ°æŸäº›é—®é¢˜å´æ²¡æœ‰ç°æˆå·¥å…·æ—¶ï¼Œè¿˜æ˜¯è¦ç”¨çº¯æ‰‹å·¥çš„æ–¹æ³•å»è§£å†³é—®é¢˜ã€‚è€Œä¸”ï¼Œæœ‰çš„å·¥å…·å¯èƒ½æ²¡æœ‰è¿™ä¹ˆæ™ºèƒ½ï¼Œä½ éœ€è¦å†™å‡ºç¬¦åˆè¿™ä¸ªå·¥å…·çš„è§„åˆ™æ–‡ä»¶ï¼Œæ¯”å¦‚è¯´ä¸èƒ½æœ‰å·¦é€’å½’çš„è¯­æ³•è§„åˆ™ã€‚**è¿˜æ˜¯é‚£å¥è¯ï¼šæ‡‚å¾—åŸºç¡€åŸç†ï¼Œä¼šè®©ä½ ç«™å¾—æ›´é«˜ã€‚**

æˆ‘ä»¬ç»§ç»­è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œç”Ÿæˆè¯­æ³•åˆ†æå™¨ï¼š

```
antlr PlayScript.g4
javac antlrtest/*.java
```

ç„¶åæµ‹è¯•ä¸€ä¸‹ç”Ÿæˆçš„è¯­æ³•åˆ†æå™¨ï¼š

```
grun antlrtest.PlayScript expression -gui
```

è¿™ä¸ªå‘½ä»¤çš„æ„æ€æ˜¯ï¼šæµ‹è¯•PlayScriptè¿™ä¸ªç±»çš„expressionæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è§£æè¡¨è¾¾å¼çš„æ–¹æ³•ï¼Œç»“æœç”¨å›¾å½¢åŒ–ç•Œé¢æ˜¾ç¤ºã€‚

æˆ‘ä»¬åœ¨æ§åˆ¶å°ç•Œé¢ä¸­è¾“å…¥ä¸‹é¢çš„å†…å®¹ï¼š

```
age + 10 * 2  + 10
^D
```

å…¶ä¸­^Dæ˜¯æŒ‰ä¸‹Ctlé”®çš„åŒæ—¶æŒ‰ä¸‹Dï¼Œç›¸å½“äºåœ¨ç»ˆç«¯è¾“å…¥ä¸€ä¸ªEOFå­—ç¬¦ï¼Œå³æ–‡ä»¶ç»“æŸç¬¦å·ï¼ˆWindowsæ“ä½œç³»ç»Ÿè¦ä½¿ç”¨^Zï¼‰ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥æå‰æŠŠè¿™äº›è¯­å¥æ”¾åˆ°æ–‡ä»¶ä¸­ï¼ŒæŠŠæ–‡ä»¶åä½œä¸ºå‘½ä»¤å‚æ•°ã€‚ä¹‹åï¼Œè¯­æ³•åˆ†æå™¨ä¼šåˆ†æè¿™äº›è¯­æ³•ï¼Œå¹¶å¼¹å‡ºä¸€ä¸ªçª—å£æ¥æ˜¾ç¤ºASTï¼š

![](https://static001.geekbang.org/resource/image/96/17/96ef2f2ca1f1465893a70e742b93fd17.jpg?wh=1142%2A655)

çœ‹å¾—å‡ºæ¥ï¼ŒASTå®Œå…¨æ­£ç¡®ï¼Œä¼˜å…ˆçº§å’Œç»“åˆæ€§ä¹Ÿéƒ½æ²¡é”™ã€‚æ‰€ä»¥ï¼ŒAntlrç”Ÿæˆçš„è¯­æ³•åˆ†æå™¨è¿˜æ˜¯å¾ˆé è°±çš„ã€‚ä»¥åï¼Œä½ ä¸“æ³¨å†™è¯­æ³•è§„åˆ™å°±è¡Œäº†ï¼Œå¯ä»¥æŠŠç²¾åŠ›æ”¾åœ¨è¯­è¨€çš„è®¾è®¡å’Œåº”ç”¨ä¸Šã€‚

## è¯¾ç¨‹å°ç»“

ä»Šå¤©ï¼Œæˆ‘å¸¦ä½ äº†è§£äº†Antlrï¼Œå¹¶ç”¨Antlrç”Ÿæˆäº†è¯æ³•åˆ†æå™¨å’Œè¯­æ³•åˆ†æå™¨ã€‚æœ‰äº†å·¥å…·çš„æ”¯æŒï¼Œä½ å¯ä»¥æŠŠä¸»è¦çš„ç²¾åŠ›æ”¾åœ¨ç¼–å†™è¯æ³•å’Œè¯­æ³•è§„åˆ™ä¸Šï¼Œæå‡äº†å·¥ä½œæ•ˆç‡ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘å¸¦ä½ å€Ÿé‰´äº†æˆç†Ÿçš„è¯æ³•è§„åˆ™å’Œè¯­æ³•è§„åˆ™ã€‚ä½ å¯ä»¥å°†è¿™äº›è§„åˆ™ç”¨åˆ°è‡ªå·±çš„è¯­è¨€è®¾è®¡ä¸­ã€‚é‡‡ç”¨å·¥å…·å’Œå€Ÿé‰´æˆç†Ÿè§„åˆ™ååˆ†é‡è¦ï¼Œç«™åœ¨åˆ«äººçš„è‚©è†€ä¸Šèƒ½è®©è‡ªå·±æ›´å¿«æˆé•¿ã€‚

åœ¨åé¢çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä¼šå¸¦ä½ å¿«é€Ÿå®ç°æŠ¥è¡¨å·¥å…·ã€SQLè§£æå™¨è¿™ç§éœ€è¦ç¼–è¯‘åŠŸèƒ½çš„åº”ç”¨ã€‚é‚£æ—¶ï¼Œä½ å°±æ›´èƒ½ä½“ä¼šåˆ°ï¼Œç”¨ç¼–è¯‘æŠ€æœ¯å®ç°ä¸€ä¸ªåŠŸèƒ½çš„è¿‡ç¨‹ï¼Œæ˜¯éå¸¸é«˜æ•ˆçš„ï¼ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä¹Ÿä¼šå¸¦ä½ æ‰©å±•æ›´å¤šçš„è¯­æ³•è§„åˆ™ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæ›´å¼ºå¤§çš„è„šæœ¬è¯­è¨€è§£é‡Šå™¨ã€‚è¿™æ ·ï¼Œä½ å°±ä¼šå®ç°æµç¨‹æ§åˆ¶è¯­å¥ï¼Œæ¥ç€æ¢ç´¢å‡½æ•°ã€é—­åŒ…ã€é¢å‘å¯¹è±¡åŠŸèƒ½çš„å®ç°æœºåˆ¶ã€‚å‡ èŠ‚è¯¾ä¹‹åï¼Œä½ çš„æ‰‹é‡Œå°±çœŸçš„æœ‰ä¸€é—¨ä¸é”™çš„è„šæœ¬è¯­è¨€äº†ï¼

## ä¸€è¯¾ä¸€æ€

ä»Šå¤©æˆ‘ä»¬ä»‹ç»äº†Antlrè¿™ä¸ªå·¥å…·ï¼Œä½ æœ‰æ²¡æœ‰ä½¿ç”¨ç±»ä¼¼å·¥å…·çš„ç»éªŒï¼Ÿåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­åˆæœ‰ä»€ä¹ˆå¿ƒå¾—æˆ–é—®é¢˜å‘¢ï¼Ÿæ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„å¿ƒå¾—æˆ–é—®é¢˜ã€‚

æœ€åï¼Œæ„Ÿè°¢ä½ çš„é˜…è¯»ï¼Œå¦‚æœè¿™ç¯‡æ–‡ç« è®©ä½ æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿ä½ å°†å®ƒåˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ã€‚

æœ¬è®²çš„ç¤ºä¾‹ä»£ç ä½äºlab/antlrtestï¼Œä»£ç é“¾æ¥æˆ‘æ”¾åœ¨äº†æ–‡æœ«ï¼Œä¾›ä½ å‚è€ƒã€‚

- Hello.g4ï¼ˆç”¨Antlré‡å†™äº†å‰å‡ è®²çš„è¯æ³•è§„åˆ™ï¼‰ï¼š[ç äº‘](https://gitee.com/richard-gong/PlayWithCompiler/blob/master/lab/antlrtest/src/antlrtest/Hello.g4) [GitHub](https://github.com/RichardGong/PlayWithCompiler/blob/master/lab/antlrtest/src/antlrtest/Hello.g4)
- CommonLexer.g4ï¼ˆæ¯”è¾ƒæˆç†Ÿçš„è¯æ³•æ–‡ä»¶ï¼‰ï¼š[ç äº‘](https://gitee.com/richard-gong/PlayWithCompiler/blob/master/lab/antlrtest/src/antlrtest/CommonLexer.g4) [GitHub](https://github.com/RichardGong/PlayWithCompiler/blob/master/lab/antlrtest/src/antlrtest/CommonLexer.g4)
- PlayScript.g4ï¼ˆç”¨Antlré‡å†™äº†å‰å‡ è®²çš„è¯­æ³•è§„åˆ™ï¼‰ï¼š[ç äº‘](https://gitee.com/richard-gong/PlayWithCompiler/blob/master/lab/antlrtest/src/antlrtest/PlayScript.g4) [GitHub](https://github.com/RichardGong/PlayWithCompiler/blob/master/lab/antlrtest/src/antlrtest/PlayScript.g4)
- ASTEvaluator.javaï¼ˆå¯¹ASTéå†ï¼Œå®ç°æ•´æ•°çš„ç®—æœ¯è¿ç®—ï¼‰ï¼š[ç äº‘](https://gitee.com/richard-gong/PlayWithCompiler/blob/master/lab/antlrtest/src/antlrtest/ASTEvaluator.java) [GitHub](https://github.com/RichardGong/PlayWithCompiler/blob/master/lab/antlrtest/src/antlrtest/ASTEvaluator.java)
- PlayScript.javaï¼ˆä¸€ä¸ªæµ‹è¯•ç¨‹åºï¼Œå®ç°è¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€å…¬å¼è®¡ç®—ï¼‰ï¼š[ç äº‘](https://gitee.com/richard-gong/PlayWithCompiler/blob/master/lab/antlrtest/src/antlrtest/PlayScript.java) [GitHub](https://github.com/RichardGong/PlayWithCompiler/blob/master/lab/antlrtest/src/antlrtest/PlayScript.java)
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ15ï¼‰</strong></div><ul>
<li><span>äº¬äº¬beaver</span> ğŸ‘ï¼ˆ21ï¼‰ ğŸ’¬ï¼ˆ4ï¼‰<p>1. windowsç¯å¢ƒä¸‹é…ç½®
å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ”¾åœ¨D:\tools\antlr\antlr-4.7.2-complete.jarä¸‹é¢

2.é…ç½®ç¯å¢ƒæ–‡ä»¶
CLASSPATH=%CLASSPATH%;D:\tools\antlr\antlr-4.7.2-complete.jar
PATH=%PATH%n;D:\tools\antlr

3.æ‰‹å†™æ–‡ä»¶antlr4.batå’Œgrun.bat
antlr4.bat
java org.antlr.v4.Tool %*

grun.bat
@ECHO OFF
SET TEST_CURRENT_DIR=%CLASSPATH:.;=%
if &quot;%TEST_CURRENT_DIR%&quot; == &quot;%CLASSPATH%&quot; ( SET CLASSPATH=.;%CLASSPATH% )
@ECHO ON
java org.antlr.v4.gui.TestRig %*

4.ç„¶åå°±å¯ä»¥æ‰§è¡Œantlr4å’Œgrunå‘½ä»¤äº†
æ¯”å¦‚antlr4 Hello.g4,  javac Hello*.java, 
$ grun Hello r -gui
hello parrt
^Z (windows) 

5.javaæ‰§è¡Œè·¯å¾„è¦æ³¨æ„äº‹é¡¹
åœ¨å‘½ä»¤è¡Œæ‰§è¡Œjavaå‘½ä»¤ï¼Œè®°å¾—æŠŠç›®å½•è®¾ç½®åˆ°src&#47;main&#47;javaè¿™é‡Œï¼Œç„¶åè¾“å…¥åŒ…å.ç±»åï¼Œæ‰èƒ½æ‰¾åˆ°ã€‚
è¿™æ˜¯javaæ‰§è¡Œçš„åŸºæœ¬è§„åˆ™ï¼Œä¸€èˆ¬IDEé‡Œé¢æ›¿ä½ åšäº†è·¯å¾„è½¬æ¢ï¼Œåœ¨å‘½ä»¤è¡Œè¦è‡ªå·±æ•²å…¥ã€‚åˆ‡è®°ã€‚

ä¾‹å¦‚
F:\study_repo\mygeek_time\myclang-03-grammar-analysis\src\main\java&gt;
grun com.babayetu.myclang03gramm
aranalysis.antlrtest.PlayScript expression -gui</p>2019-09-10</li><br/><li><span>Smallfly</span> ğŸ‘ï¼ˆ6ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è¿™ä¸€è®²èµ°çš„æœ‰ç‚¹è‰°éš¾ï¼Œè®°å½•ä¸€ä¸‹ï¼š

1ã€
å¼€å§‹æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼ŒæŠ¥æ‰¾ä¸åˆ° CommonLexerã€‚

antlr PlayScript.g4

çœ‹äº†ä¸‹ Github æ‰å‘ç°æœ‰è¿™ä¸ªæ–‡ä»¶ã€‚

import CommonLexer, åœ¨è¯­æ³•è§„åˆ™æ–‡ä»¶ PlayScript.g4 ä¸­å¯¼å…¥è¯æ³•è§„åˆ™ã€‚

2ã€

antlr PlayScript.g4

ä¸Šé¢çš„å‘½ä»¤ååº”è¯¥å…ˆ cd .. å›é€€ä¸€çº§ç›®å½•ï¼Œå†æ‰§è¡Œï¼š

javac antlrtest&#47;*.java

æˆ–è€…ï¼Œç›´æ¥:

javac .&#47;*java

3ã€

grun antlrtest.PlayScript expression -gui

æ–‡ä¸­è¯´æ‰§è¡Œè¿™æ¡å‘½ä»¤ç»“æœä¼šä»¥å›¾å½¢åŒ–ç•Œé¢æ˜¾ç¤ºï¼Œæˆ‘æ‰§è¡Œä¹‹åä»€ä¹ˆéƒ½æ²¡æœ‰è¾“å‡ºï¼Œä»¥ä¸ºå‰é¢æ­¥éª¤æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œé‡æ–°æ¥äº†ä¸€æ¬¡ï¼Œè¿˜æ˜¯è¿™æ ·ï¼Œå¾€ä¸‹çœ‹æ‰æ„è¯†åˆ°æ²¡è¾“å‡ºæ‰æ˜¯æ­£å¸¸çš„ã€‚ã€‚ã€‚

â€”â€”

çœ‹åˆ°æœ€åå¼¹å‡ºçš„ AST æ ‘è¿˜æ˜¯è›®æœ‰æ„æ€çš„ã€‚

æˆ‘å†™äº†ä¸€ç‰ˆç®€å•çš„ Swfit è§„åˆ™æ–‡ä»¶ï¼š

https:&#47;&#47;github.com&#47;iostalks&#47;PlayWithCompiler&#47;tree&#47;lecture-6&#47;PlayWithCompiler&#47;Antlr</p>2019-09-05</li><br/><li><span>kaixiao7</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>åœ¨Windowsä¸‹éœ€è¦ç”¨ ^z å³Ctrl+z æ¥å¼¹å‡ºASTçª—å£

That ^D means EOF on unix; it&#39;s ^Z in Windows.</p>2019-08-26</li><br/><li><span>ä¸ƒæœˆæœ‰é£</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>macOSä¸‹ï¼Œéœ€è¦å°†æŠŠ Antlr çš„ JAR æ–‡ä»¶è®¾ç½®åˆ° CLASSPATH ç¯å¢ƒå˜é‡ä¸­ï¼š
å¦‚æœæ˜¯ç”¨Homebrew å®‰è£…çš„ Antlrï¼Œå®‰è£…è·¯å¾„æ˜¯ï¼š&#47;usr&#47;local&#47;Cellar&#47;antlr&#47;4.7.2&#47;antlr-4.7.2-complete.jarï¼›
å¯ä»¥ä½¿ç”¨vi ~&#47;.bash_profileå‘½ä»¤æ‰“å¼€bash_profileæ–‡ä»¶ï¼Œå°†export CLASSPATH=&quot;.:&#47;usr&#47;local&#47;Cellar&#47;antlr&#47;4.7.2&#47;antlr-4.7.2-complete.jar:$CLASSPATH&quot;è¿™æ®µä»£ç å¤åˆ¶åˆ°é‡Œé¢ã€‚
ç„¶åå°±å¯ä»¥è¿è¡Œjavac *.javaäº†</p>2019-12-23</li><br/><li><span>PythonAI</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<p>âœ  antlr grun antlrtest.PlayScriptexpression -gui

Can&#39;t load antlrtest.PlayScriptexpression as lexer or parser</p>2019-08-26</li><br/><li><span>æ±Ÿä¸–æ°‘</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>é‡åˆ°äº†ä¸€ä¸ªå¤§å‘ã€‚
Windowsç¯å¢ƒä¸‹ï¼Œæ·»åŠ jaråŒ…åˆ°CLASSPATHä¸­æ—¶ï¼Œæœ€å¥½å†™åœ¨å‰é¢ã€‚å¦‚æœæ˜¯è¿½åŠ åœ¨åé¢ï¼Œç³»ç»Ÿå¾ˆå¯èƒ½ä¸è¯†åˆ«ã€‚</p>2020-06-28</li><br/><li><span>ä¸ƒæœˆæœ‰é£</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>ä¸çŸ¥é“æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Ÿ
$ grun Hello tokens -tokens Hello.play
Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: antlrtest&#47;Hello (wrong name: Hello)
        at java.base&#47;java.lang.ClassLoader.defineClass1(Native Method)
        at java.base&#47;java.lang.ClassLoader.defineClass(ClassLoader.java:1016)
        at java.base&#47;java.security.SecureClassLoader.defineClass(SecureClassLoader.java:174)
        at java.base&#47;jdk.internal.loader.BuiltinClassLoader.defineClass(BuiltinClassLoader.java:802)
        at java.base&#47;jdk.internal.loader.BuiltinClassLoader.findClassOnClassPathOrNull(BuiltinClassLoader.java:700)
        at java.base&#47;jdk.internal.loader.BuiltinClassLoader.loadClassOrNull(BuiltinClassLoader.java:623)
        at java.base&#47;jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:581)
        at java.base&#47;jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:178)
        at java.base&#47;java.lang.ClassLoader.loadClass(ClassLoader.java:521)
        at org.antlr.v4.gui.TestRig.process(TestRig.java:135)
        at org.antlr.v4.gui.TestRig.main(TestRig.java:119)</p>2019-12-25</li><br/><li><span>mudfrog</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>è€å¸ˆï¼Œæˆ‘çš„ç¨‹åºèƒ½ç¼–è¯‘é€šè¿‡ï¼Œä¹Ÿèƒ½æ­£å¸¸è¿è¡Œï¼Œèƒ½æ­£å¸¸çš„è§£æå’Œè¿ç®—å‡ºæ¥ï¼Œä½†å°±æ˜¯æƒ³çœ‹çœ‹è¯­æ³•æ ‘ç›´è§‚ä¸€äº›ã€‚æˆ‘ä½¿ç”¨grunçš„æ—¶å€™æ€»æ˜¯æç¤ºCan&#39;t load CalExpr as lexer or parserï¼Œè¿™é‡ŒCalExpråˆ°åº•æ˜¯G4æ–‡ä»¶è¿˜æ˜¯tokensæ–‡ä»¶å‘¢ï¼Œæˆ‘æŠŠè¿™ä¸¤ä¸ªæ–‡ä»¶éƒ½æ‹·è´åˆ°srcç›®å½•ä¸‹äº†ã€‚æˆ‘ç”¨çš„æ˜¯win7åº•ä¸‹çš„eclipseï¼Œ</p>2019-09-01</li><br/><li><span>minghu6</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>ANTLRçš„ä½¿ç”¨ä¸€å®šè¦æœ‰ â€œThe Definitive ANTLR 4 Referenceâ€  æ¨èç”µå­ç‰ˆ https:&#47;&#47;github.com&#47;antlr&#47;antlr4&#47;blob&#47;master&#47;doc&#47;index.md

å¯ä»¥åšå…³é”®å­—æœç´¢ï¼ŒæŸ¥ç‚¹å„¿è¯­æ³•æ¦‚å¿µæ€§çš„ä¸œè¥¿æ¯”è¾ƒæ–¹ä¾¿ï¼Œç”¨ä¸€ä½ç½‘å‹è¯´çš„è¯ï¼š
If you do not already have &quot;The Definitive ANTLR 4 Reference&quot; book I recommend getting hold of it. Will save you a lot of time. 
è¯è¯´æå®¢æ—¶é—´çš„å†…å®¹è¿˜ä¸é”™ï¼Œæ²¡æœ‰é‚£ä¹ˆå¤šèŠ±é‡Œèƒ¡å“¨çš„å™±å¤´ï¼Œä½†æ˜¯è¿™ä¸ªä¹¦ç­¾ç¬”è®°å’Œè¯„è®ºçš„ä½“éªŒå¤ªå·®ï¼
ä¹¦ç­¾ç¬”è®°ç”šè‡³æ²¡æœ‰ç»“æ„ï¼Œç•™è¨€ä¹Ÿä¸æ”¯æŒmarkdown

ä¸€å®šè¦ommonLexer.g4</p>2021-03-18</li><br/><li><span>englefly</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>å®«è€å¸ˆï¼ŒAntlrçš„æ€§èƒ½æ€æ ·ï¼Ÿæˆ‘ä»¬ç”¨antlråšäº†ä¸€ä¸ªsqlè§£æï¼Œå½“é‡åˆ°æ¯”è¾ƒé•¿çš„sqlè¯­å¥æ˜¯ï¼Œantlrè§£æèŠ±äº†100msï¼Œè€Œmysql åªç”¨äº†9msã€‚ä¸çŸ¥é“æ˜¯æˆ‘ä»¬ç”¨æ³•çš„é—®é¢˜ï¼Œè¿˜æ˜¯antlræœ¬èº«ä¸ºäº†ä½¿ç”¨ç®€å•ç‰ºç‰²äº†ä¸€äº›æ€§èƒ½ã€‚</p>2020-06-16</li><br/><li><span>æ¼ç½‘ä¹‹æ¸”</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>å¼„äº†ä¸‰ä¸ªå°æ—¶ï¼Œç»ˆäºå¥½äº†ã€‚è€å¸ˆæ–‡æ¡£å†™çš„å¾ˆæ¸…æ¥šã€‚
https:&#47;&#47;github.com&#47;RichardGong&#47;PlayWithCompiler&#47;blob&#47;master&#47;antlr_install.md
æˆ‘é‡åˆ°çš„é—®é¢˜æœ‰ä¸¤ç‚¹ï¼š
1.æ‰§è¡Œ grun çš„æ—¶å€™ æ²¡å¸¦packageåå¦‚grun Hello tokens -tokens hello.playï¼Œä¼šæç¤ºjava.lang.NoClassDefFoundError: Hello (wrong name: antlrtest&#47;Hello)ï¼Œè¿™æ˜¯å› ä¸ºè€å¸ˆæºç Helloå¸¦äº†packä¿å‘½antlrtest

æˆ‘çš„è§£å†³æ–¹æ³•æ˜¯åœ¨src\antlrtest\ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤grun antlrtest.Hello tokens -tokens hello.play

2.æ‰§è¡Œgrunå‘½ä»¤æŠ¥é”™è¯¯java.nio.file.NoSuchFileException: hello.playï¼Œè¿™æ˜¯å› ä¸ºæˆ‘åœ¨antlrtest\src\ç›®å½•ä¸‹è¿è¡Œçš„grunï¼Œè€Œhello.playåœ¨antlrtest\src\antlrtest\ä¸‹ï¼Œè§£å†³æ–¹æ³•æ˜¯åœ¨antlrtest\src\antlrtest\ä¸‹æ‰§è¡Œgrunå‘½ä»¤
ï¼Œæˆ–è€…æŠŠhello.playæ–‡ä»¶ä»£ç æ‹·è´åˆ°src\ç›®å½•ä¸‹å†æ‰§è¡Œgrunå‘½ä»¤ã€‚

å¦å¤–å¦‚æœé‡åˆ°javacå‘½ä»¤é‡è§GBKé”™è¯¯ï¼Œæ˜¯å› ä¸ºç¼–ç æ ¼å¼é—®é¢˜ï¼Œè§£å†³æ–¹æ³•ï¼šjavac -encoding utf-8 PlayScript.java

å¦‚æœé‡åˆ°æ‰¾ä¸åˆ°parse lexeré—®é¢˜ï¼ŒClass Pathéœ€è¦æ·»åŠ srcç›®å½•</p>2020-03-24</li><br/><li><span>å¾ç‚œ</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>Antlrã€Lex&#47;Flexã€ Yacc&#47;Bison åœ¨ç›®å‰å¸‚åœºä¸Šå“ªä¸ªä¼šæ¯”è¾ƒå¸¸ç”¨å‘¢ï¼Œåœ¨æ—¶é—´æœ‰é™çš„æƒ…å†µä¸‹ï¼Œå“ªä¸€ç§ä¼šæ¯”è¾ƒåˆé€‚å»å­¦ä¹ ã€‚</p>2020-02-15</li><br/><li><span>ç«ç«</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<p>Hello.java:2: é”™è¯¯: ç¨‹åºåŒ…org.antlr.v4.runtimeä¸å­˜åœ¨
import org.antlr.v4.runtime.Lexer;
                           ^
Hello.java:3: é”™è¯¯: ç¨‹åºåŒ…org.antlr.v4.runtimeä¸å­˜åœ¨
import org.antlr.v4.runtime.CharStream;
                           ^
Hello.java:4: é”™è¯¯: ç¨‹åºåŒ…org.antlr.v4.runtimeä¸å­˜åœ¨
import org.antlr.v4.runtime.Token;
                           ^
Hello.java:5: é”™è¯¯: ç¨‹åºåŒ…org.antlr.v4.runtimeä¸å­˜åœ¨
import org.antlr.v4.runtime.TokenStream;
                           ^
Hello.java:8: é”™è¯¯: ç¨‹åºåŒ…org.antlr.v4.runtime.dfaä¸å­˜åœ¨
import org.antlr.v4.runtime.dfa.DFA;
                               ^
Hello.java:12: é”™è¯¯: æ‰¾ä¸åˆ°ç¬¦å·</p>2019-11-28</li><br/><li><span>æ²‰æ·€çš„æ¢¦æƒ³</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>è€å¸ˆï¼Œä¸ºä»€ä¹ˆæˆ‘ç”¨antlrç”Ÿæˆçš„AdditiveExpressionContextå°±æ²¡æœ‰ç¤ºä¾‹ç¨‹åºä¸­çš„ADD() SUB()è¿™äº›ç›´æ¥ä»¥tokenåå­—å‘½åçš„æ–¹æ³•å‘¢ï¼Ÿ</p>2019-08-29</li><br/><li><span>ç´«çµæ–—åœ£</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>antlrçš„è¯­æ³•è§„åˆ™çš„é¡ºåºåˆè¦æ±‚å—ï¼Œæ˜¯å¦è§„åˆ™1æ˜¯ç¨‹åºçš„å¼€å¤´</p>2021-04-01</li><br/>
</ul>