ä½ å¥½ï¼Œæˆ‘æ˜¯ç‹æ˜Šå¤©ã€‚

ä»å¤è‡³ä»Šï¼Œäººä»¬ä¸ºäº†æ–¹ä¾¿è‡ªå·±çš„ç”Ÿæ´»ï¼Œå‘æ˜å‡ºå„ç§å„æ ·çš„å·¥å…·ã€‚å°±æ‹¿æ‰«åœ°æ¥è¯´ï¼Œè¿™æ˜¯æˆ‘å°æ—¶å€™æœ€è®¨åŒçš„å®¶åŠ¡æ´»åŠ¨ï¼Œå› ä¸ºæ‰«åœ°æ—¶æ‰¬èµ·çš„ç°å°˜ä¼šè®©æˆ‘ååˆ†éš¾å—ï¼Œè€Œä¸”æœ‰çš„æ­»è§’å¾ˆéš¾è¢«æ‰“æ‰«å¹²å‡€ã€‚æ‰«åœ°æœºå™¨äººçš„å‡ºç°ç»™æˆ‘ä»¬å¸¦æ¥äº†æå¤§çš„ä¾¿åˆ©ï¼Œæˆ‘ä»¬åªè¦æ‹¥æœ‰å®ƒï¼Œå°±ä¸éœ€è¦å†äº²è‡ªæ‰«åœ°äº†ã€‚

åœ¨å‰å‡ èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†SQLæ³¨å…¥çš„åŸç†å’Œæ–¹æ³•ï¼Œç›¸ä¿¡ä½ å·²ç»å°è¯•ç‰›åˆ€äº†ã€‚ä¸çŸ¥é“ä½ åœ¨åšæ³¨å…¥æµ‹è¯•çš„æ—¶å€™æ˜¯å¦ä¼šè§‰å¾—å›°éš¾å‘¢ï¼Ÿåæ­£æˆ‘å­¦çš„æ—¶å€™æ˜¯é‡åˆ°äº†ä¸å°‘å›°éš¾ï¼Œæ¯”å¦‚ï¼Œç»•è¿‡æŠ€å·§å¤šç§å¤šæ ·ï¼Œæˆ‘ä»¬å‡ ä¹ä¸å¯èƒ½å…¨éƒ¨è®°ä½å®ƒä»¬ï¼Œå°±ç®—è®°ä½äº†æˆ‘ä»¬ä¸€ä¸€å»å°è¯•ä¹Ÿéœ€è¦å¾ˆå¤šçš„æ—¶é—´ï¼Œè´¹æ—¶åˆä¼¤ç¥ã€‚

å°±åƒæˆ‘ä»¬åˆšæ‰è¯´è¿‡çš„ï¼Œå½“é—®é¢˜å‡ºç°æ—¶ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šåˆ›é€ å‡ºä¸€ç§å·¥å…·ï¼Œæ¥è§£å†³å¯¹åº”çš„é—®é¢˜ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€æ¬¾å·¥å…·ï¼Œèƒ½å¸®æˆ‘ä»¬è‡ªåŠ¨å»è¿›è¡Œæ³¨å…¥æµ‹è¯•å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œè¿™ä¸ªå·¥å…·å°±æ˜¯sqlmapã€‚

è¿™èŠ‚è¯¾å‘¢ï¼Œæˆ‘ä»¬æ­£å¼å¼€å¯sqlmapå­¦ä¹ ä¹‹æ—…ï¼Œæ·±å…¥æ¢ç©¶è¿™æ¬¾è‡ªåŠ¨åŒ–æ³¨å…¥ç¥å™¨çš„å®ç°åŸç†ã€‚**é¦–å…ˆæˆ‘ä»¬è¦å¯¹ä¸€äº›çŸ¥è¯†æœ‰æ‰€äº†è§£ï¼ŒåŒ…æ‹¬å¦‚ä½•è·å–è½¯ä»¶çš„ä»£ç ï¼Œå¦‚ä½•æ­å»ºè½¯ä»¶çš„è¿è¡Œç¯å¢ƒï¼Œä»¥åŠè½¯ä»¶æ–‡ä»¶åŠŸèƒ½ç­‰ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¼šå¯¹sqlmapçš„å·¥ä½œæµç¨‹åšä¸€ä¸ªæ•´ä½“çš„ä»‹ç»ï¼Œè¿™ä¼šä¸ºæˆ‘ä»¬åç»­å­¦ä¹ sqlmapæ‰“å¥½åŸºç¡€ã€‚**

## sqlmap

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/34/9a/347a42c49613eea753d176b53396ba9a.png?wh=1895x662)

æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹åˆ°åº•ä»€ä¹ˆæ˜¯sqlmapã€‚

sqlmapæ˜¯ä¸€ä¸ªå¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨æ£€æµ‹sqlæ³¨å…¥æ˜¯å¦å­˜åœ¨çš„æµ‹è¯•å·¥å…·ï¼Œå®ƒä¼šä½¿ç”¨ä¸åŒæ³¨å…¥æ–¹æ³•è¿›è¡Œæµ‹è¯•ï¼Œå¹¶å°†æµ‹è¯•ç»“æœå±•ç¤ºç»™æˆ‘ä»¬ï¼Œä¾›æˆ‘ä»¬åˆ©ç”¨ã€‚è¿™äº›æ–¹æ³•éƒ½æ˜¯æˆ‘ä»¬ä¹‹å‰å­¦è¿‡çš„å†…å®¹ï¼ŒåŒ…æ‹¬è”åˆæ³¨å…¥ã€æ—¶å»¶æ³¨å…¥ã€å¸ƒå°”ç›²æ³¨ã€æŠ¥é”™æ³¨å…¥å’Œå †æŸ¥è¯¢æ³¨å…¥ã€‚å¦‚æœä½ æ„Ÿå…´è¶£ï¼Œå¯ä»¥å»ä¸ŠèŠ‚è¯¾å¯»æ‰¾æ›´åŠ è¯¦ç»†çš„ä»‹ç»ã€‚

å› ä¸ºå®ƒçš„æŒç»­æ›´æ–°å’Œç»´æŠ¤ï¼Œæ‰€ä»¥å¤§å®¶æ™®éè®¤ä¸ºå®ƒæ—¢æ–¹ä¾¿åˆå¥½ç”¨ï¼Œä»å›¾ç‰‡ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¶…è¿‡4kçš„forkæ•°é‡ï¼Œä»¥åŠé«˜é¢‘çš„æºç æ›´æ–°ã€‚å°±åƒä¸€æšç¡¬å¸çš„ä¸¤é¢ï¼Œè¿™ç§ä¼˜åŠ¿ä¹Ÿä¼šä¼´éšä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ç»™æˆ‘ä»¬é˜…è¯»æºä»£ç å¢åŠ äº†éš¾åº¦ï¼Œè€Œæˆ‘ä»¬è¦æƒ³çœŸæ­£å»ç†è§£ã€æŒæ¡è¿™æ¬¾å·¥å…·ï¼Œå°±å¿…é¡»è¦è¿éš¾è€Œä¸Šï¼Œå¯¹å®ƒçš„æºä»£ç è¿›è¡Œå‰–æã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/2e/ca/2e17e69bf2856256754fc409ab2ebaca.png?wh=1751x480)

**ä»£ç è·å–**

æˆ‘ä»¬ç”¨å¦‚ä¸‹å‘½ä»¤å°†sqlmapçš„æºä»£ç å…‹éš†ä¸‹æ¥ã€‚

```bash
git clone https://github.com/sqlmapproject/sqlmap
cd sqlmap
```

å› ä¸ºè¯¥è¿‡ç¨‹éœ€è¦è®¿é—®å¤–ç½‘ï¼Œæ‰€ä»¥å…‹éš†çš„é€Ÿåº¦ä¼šè¾ƒä¸ºç¼“æ…¢ï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥å€ŸåŠ©ä¸€äº›ä»£ç†å·¥å…·æ¥åŠ é€Ÿè¿™ä¸ªè¿‡ç¨‹ã€‚

è¿™é‡Œæˆ‘ä»¬åˆ†æçš„sqlmapç‰ˆæœ¬æ˜¯æœ€æ–°çš„ç‰ˆæœ¬1.6ï¼Œå®ƒäº2022å¹´åˆå‘å¸ƒï¼Œç›¸æ¯”äºä¸Šä¸€ä»£1.5.12ç‰ˆæœ¬ï¼Œåªæ˜¯ä¿®å¤äº†å‡ ä¸ªç¼–ç å¼‚å¸¸ï¼Œå¹¶ä¸”æ›¿æ¢ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆé‡å¤§çš„æ”¹åŠ¨ã€‚å› æ­¤å­¦ä¹ ä¸¤ä¸ªå¤§ç‰ˆæœ¬çš„ä»£ç éƒ½æ˜¯å¯ä»¥çš„ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/35/80/35e9758f3c123549d2a25488c9224580.png?wh=1296x363)![å›¾ç‰‡](https://static001.geekbang.org/resource/image/65/e6/65ff8f7d9aca2ac1b79afbf44548fbe6.png?wh=1243x347)

åœ¨è·å–åˆ°æºä»£ç ä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦é…ç½®è½¯ä»¶çš„è¿è¡Œç¯å¢ƒï¼Œè¿™æ ·sqlmapæ‰èƒ½é¡ºåˆ©çš„è¿è¡Œã€‚ä¸‹é¢è®©æˆ‘ä»¬è¿›å…¥åˆ°ç¯å¢ƒæ­å»ºè¿™ä¸€æ­¥éª¤ã€‚

**ç¯å¢ƒæ­å»º**

è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬é‡‡ç”¨çš„åˆ†æç¯å¢ƒæ˜¯python3.10.1ï¼Œå¯ä»¥åˆ©ç”¨ä¸‹é¢çš„å‘½ä»¤æ–°å»ºä¸€ä¸ªè™šæ‹Ÿçš„è§£é‡Šç¯å¢ƒï¼Œè¿™æ ·åšæœ‰åˆ©äºè¿è¡Œç¯å¢ƒçš„éš”ç¦»ï¼Œé˜²æ­¢å…¶ä»–ç¯å¢ƒå› ç´ å¹²æ‰°sqlmapçš„æ‰§è¡Œè¿‡ç¨‹ã€‚

```bash
python3 -m venv venv
```

**é…ç½®æ–‡ä»¶**

åœ¨åšå®Œç¯å¢ƒæ­å»ºä¹‹åï¼Œsqlmapå·²ç»å…·æœ‰è¿è¡Œèƒ½åŠ›äº†ã€‚ä½†æ˜¯æˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“å“ªä¸ªæ–‡ä»¶æ‰æ˜¯å®ƒçš„é…ç½®æ–‡ä»¶ï¼Œå³å“ªä¸ªæ–‡ä»¶ä¼šå¯¹å®ƒçš„è¿è¡Œäº§ç”Ÿå½±å“ã€‚æ‰€ä»¥å‘¢ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥çœ‹çœ‹ï¼Œsqlmapä¸­æœ‰å“ªäº›é‡è¦çš„æ–‡ä»¶ï¼Œå®ƒä»¬åˆæœ‰å“ªäº›åŠŸèƒ½ã€‚

é¦–å…ˆæˆ‘ä»¬ä¸€èµ·çœ‹ä¸‹sqlmapçš„é…ç½®æ–‡ä»¶`sqlmap.conf`ï¼š

```python
# At least one of these options has to be specified to set the source to
# get target URLs from.
[Target]

# Target URL.
# Example: http://192.168.1.121/sqlmap/mysql/get_int.php?id=1&cat=2
url =

# Direct connection to the database.
# Examples:
#   mysql://USER:PASSWORD@DBMS_IP:DBMS_PORT/DATABASE_NAME
#   oracle://USER:PASSWORD@DBMS_IP:DBMS_PORT/DATABASE_SID
direct = 

# Parse targets from Burp or WebScarab logs
# Valid: Burp proxy (http://portswigger.net/suite/) requests log file path
# or WebScarab proxy (http://www.owasp.org/index.php/Category:OWASP_WebScarab_Project)
# 'conversations/' folder path
logFile = 

# Scan multiple targets enlisted in a given textual file
bulkFile =

# Load HTTP request from a file
# Example (file content): POST /login.jsp HTTP/1.1\nHost: example.com\nUser-Agent: Mozilla/4.0\n\nuserid=joe&password=guessme
requestFile = 

# At least one of these options has to be specified to set the source to
# get target URLs from.
[Target]

# Target URL.
# Example: http://192.168.1.121/sqlmap/mysql/get_int.php?id=1&cat=2
url =

# Direct connection to the database.
# Examples:
#   mysql://USER:PASSWORD@DBMS_IP:DBMS_PORT/DATABASE_NAME
#   oracle://USER:PASSWORD@DBMS_IP:DBMS_PORT/DATABASE_SID
direct = 

# Parse targets from Burp or WebScarab logs
# Valid: Burp proxy (http://portswigger.net/suite/) requests log file path
# or WebScarab proxy (http://www.owasp.org/index.php/Category:OWASP_WebScarab_Project)
# 'conversations/' folder path
logFile = 

# Scan multiple targets enlisted in a given textual file
bulkFile =

# Load HTTP request from a file
# Example (file content): POST /login.jsp HTTP/1.1\nHost: example.com\nUser-Agent: Mozilla/4.0\n\nuserid=joe&password=guessme
requestFile = 
......
# Force back-end DBMS operating system to provided value. If this option is

# set, the back-end DBMS identification process will be minimized as

# needed.

# If not set, sqlmap will detect back-end DBMS operating system

# automatically by default.

# Valid: linux, windows

os = 
......
```

ç”±äºé…ç½®æ–‡ä»¶å¾ˆé•¿ï¼Œæ‰€ä»¥è¿™é‡Œæ²¡æœ‰å…¨éƒ¨å±•ç¤ºå‡ºæ¥ã€‚æˆ‘ä»¬éœ€è¦çŸ¥é“çš„æ˜¯ï¼Œ**é…ç½®æ–‡ä»¶çš„å‚æ•°é…ç½®å¯ä»¥å¯¹sqlmapç¨‹åºè¿è¡Œçš„æµç¨‹äº§ç”Ÿå½±å“**ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­å¯ä»¥è®¾ç½®OSé…ç½®é¡¹ï¼Œsqlmapå°±æ— éœ€æ¢æµ‹æ“ä½œç³»ç»Ÿçš„ç±»å‹äº†ï¼Œè¿™æ ·å°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨ä¸€äº›ç‰¹å®šæƒ…å†µä¸‹ä¼˜åŒ–sqlmapçš„æ‰§è¡Œé€Ÿåº¦ã€‚

çœ‹å®Œé…ç½®æ–‡ä»¶ä¹‹åï¼Œæˆ‘ä»¬å›å¿†ä¸€ä¸‹ä¹‹å‰å­¦è¿‡çš„å†…å®¹ï¼Œåœ¨åšSQLæ³¨å…¥æ—¶ï¼Œéƒ½éœ€è¦ç»å†å“ªäº›æ­¥éª¤å‘¢ï¼Ÿ

æˆ‘ä»¬çŸ¥é“ï¼Œä¸€èˆ¬æ¥è¯´SQLæ³¨å…¥æ”»å‡»å¯ä»¥åˆ†ä¸ºä¸‰æ­¥ï¼Œé¦–å…ˆæ˜¯å¯»æ‰¾æ³¨å…¥ç‚¹ï¼Œä¹‹åè¦é€‰æ‹©é—­åˆå‚æ•°çš„ä½ç½®ï¼Œæœ€åè¦æ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„payloadï¼Œæ¥å®ç°æˆ‘ä»¬çš„æ³¨å…¥æ”»å‡»æ“ä½œã€‚

sqlmapå’Œæ‰‹åŠ¨SQLæ³¨å…¥çš„æ€æƒ³æ˜¯ç›¸ä¼¼çš„ï¼Œç¨‹åºå¯ä»¥ç›´æ¥ä»è¯·æ±‚çš„å‚æ•°ä¸­è·å–åˆ°æ³¨å…¥ç‚¹ä½ç½®çš„ä¿¡æ¯ï¼Œè€Œé—­åˆå‚æ•°çš„ä½ç½®å’Œpayloadçš„é€‰æ‹©åˆ™ä¼šå› ä¸ºå®ƒä»¬çš„å¤šæ ·æ€§å˜å¾—ç•¥å¾®å¤æ‚ï¼Œä¸‹é¢å°±è®©æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ä¸ä¹‹ç›¸å…³çš„ä¸¤ä¸ªé…ç½®æ–‡ä»¶ã€‚

æˆ‘ä»¬å…ˆæ¥çœ‹sqlmapä¸­é—­åˆå‚æ•°çš„é…ç½®å†…å®¹ï¼Œè¿™é‡Œä¸¾ä¸ªä¾‹å­å¸®åŠ©ä½ æ¥ç†è§£ä»€ä¹ˆæ˜¯é—­åˆå‚æ•°ã€‚ä»¥ä¸€ä¸ªå…¸å‹çš„SQLæ³¨å…¥è¯­å¥ä¸ºä¾‹ï¼š

```python
SELECT id FROM users WHERE name = '$name';
```

æƒ³è¦å¯¹å…¶è¿›è¡Œæ³¨å…¥ï¼Œå°±éœ€è¦å°†nameå‚æ•°é—­åˆï¼Œè¿™åœ¨å‰ä¸¤èŠ‚è¯¾ä¸­æœ‰è¿‡è¾ƒæ·±å…¥çš„æ¢è®¨ã€‚

å¯¹äºsqlmapè€Œè¨€ï¼Œdata.xml.boundaries.xmlå°±æ˜¯ç”¨äºé—­åˆå‚æ•°çš„é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡è¯¥æ–‡ä»¶æˆ‘ä»¬å¯ä»¥ç¡®å®šé—­åˆå…ƒç´ çš„å­—ç¬¦å’Œä½ç½®ç­‰ç­‰ä¿¡æ¯ï¼Œäº†è§£è¯¥æ–‡ä»¶æœ‰åŠ©äºæˆ‘ä»¬ç†è§£sqlmapçœŸæ­£å‘é€çš„æµ‹è¯•payloadçš„æ ¼å¼ï¼Œå…³äºpayloadæ ¼å¼è¿™éƒ¨åˆ†çš„å†…å®¹æˆ‘ä»¬ä¼šåœ¨ä¸‹ä¸€è®²å…·ä½“çš„è®²è§£ã€‚

```plain
<?xml version="1.0" encoding="UTF-8"?>

<!--
Tag: <boundary>
    How to prepend and append to the test ' <payload><comment> ' string.

    Sub-tag: <level>
        From which level check for this test.

        Valid values:
            1: Always (<100 requests)
            2: Try a bit harder (100-200 requests)
            3: Good number of requests (200-500 requests)
            4: Extensive test (500-1000 requests)
            5: You have plenty of time (>1000 requests)

    Sub-tag: <clause>
        In which clause the payload can work.

        NOTE: for instance, there are some payload that do not have to be
        tested as soon as it has been identified whether or not the
        injection is within a WHERE clause condition.
......
```

è€Œå…³äºpayloadè¿™ä¸€éƒ¨åˆ†ï¼Œå°±è®©æˆ‘ä»¬çœ‹ä¸€çœ‹sqlmapä¸­payloadçš„é…ç½®æ–‡ä»¶å¤¹ï¼Œ`data.xml.payloads/`ã€‚è¿™ä¸ªæ–‡ä»¶å¤¹å‚¨å­˜æœ‰ä¸åŒæ³¨å…¥æ”»å‡»ç±»å‹çš„payloadä¿¡æ¯ã€‚

è¯¥æ–‡ä»¶å¤¹ä¸‹çš„æ¯ä¸€ä¸ªæ–‡ä»¶éƒ½ä¸ç¨‹åºä¸­ä¸€ä¸ªé‡è¦çš„ç»“æ„testæ¯æ¯ç›¸å…³ï¼Œå®ƒæ˜¯ä¸€ä¸ªpayloadçš„åŸºæœ¬ä¿¡æ¯å•å…ƒï¼Œæ¯ä¸ªtesté‡Œé¢åŒ…å«äº†ä¸€ä¸ªå®Œæ•´çš„payloadéœ€è¦çš„ä¿¡æ¯ï¼Œ sqlmapå‘é€çš„æ”»å‡»è½½è·å°±æ˜¯åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡ŒåŠ å·¥å¾—å‡ºçš„ï¼Œå¦‚ä¸‹ä»£ç å°±æ˜¯è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„`boolean_blind.xml`æ–‡ä»¶çš„éƒ¨åˆ†å†…å®¹ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰å–äº†å®Œæ•´çš„testç»“æ„æ–¹ä¾¿ä½ äº†è§£ã€‚

```python
 <test>

        <title>AND boolean-based blind - WHERE or HAVING clause (MySQL comment)</title>

        <stype>1</stype>

        <level>3</level>

        <risk>1</risk>

        <clause>1</clause>

        <where>1</where>

        <vector>AND [INFERENCE]</vector>

        <request>

            <payload>AND [RANDNUM]=[RANDNUM]</payload>

            <comment>#</comment>

        </request>

        <respons e>

            <comparison>AND [RANDNUM]=[RANDNUM1]</comparison>

        </response>

        <details>

            <dbms>MySQL</dbms>

        </details>

    </test>
```

å¯ä»¥çœ‹åˆ°å®ƒçš„ç»“æ„å†…éƒ¨å®šä¹‰æ”»å‡»ç±»å‹ã€æ–¹å¼ã€ç”Ÿæ•ˆä½ç½®ã€å…³è”æ•°æ®åº“ç­‰ç­‰ä¿¡æ¯ã€‚  
è‡³æ­¤ï¼Œæˆ‘ä»¬å¤§è‡´äº†è§£äº†sqlmapå·¥ä½œçš„åº•å±‚ä¾èµ–ã€‚ä¸‹ä¸€æ­¥åªéœ€è¦åˆ†æå’ŒæŒæ¡sqlmapçš„è¿è¡Œè¿‡ç¨‹ï¼Œæ—¥ååœ¨ä½¿ç”¨ä¸­æˆ‘ä»¬å°±å¯ä»¥æ›´åŠ å¾—å¿ƒåº”æ‰‹ã€‚

sqlmapä½œä¸ºä¸€ä¸ªè§„æ¨¡è¾ƒå¤§çš„å·¥å…·ï¼Œåœ¨å¯åŠ¨è¿‡ç¨‹ä¸­é¦–å…ˆä¼šæ‰§è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œä¸‹é¢å°±è®©æˆ‘ä»¬ä¸€èµ·å­¦ä¹ sqlmapçš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œé€šè¿‡è¿™éƒ¨åˆ†å†…å®¹ä½ å¯ä»¥æ˜ç™½sqlmapåœ¨å¯åŠ¨ä¹‹åˆåšäº†å“ªäº›äº‹æƒ…ã€‚

## åˆå§‹åŒ–è¿‡ç¨‹

sqlmapçš„åˆå§‹åŒ–è¿‡ç¨‹åŒ…å«å››ä¸ªæ­¥éª¤ï¼šç¯å¢ƒåˆå§‹åŒ–ã€å‘½ä»¤è¡Œå‚æ•°çš„è§£æã€å…¨å±€å˜é‡çš„èµ‹å€¼ï¼Œä»¥åŠè¿è¡Œç¯å¢ƒçš„æ£€æŸ¥ã€‚æˆ‘ä»¬å°†ç»“åˆä»£ç å’Œå›¾ç‰‡æ³¨é‡Šï¼Œé¡ºç€sqlmapä»£ç è¿è¡Œçš„é¡ºåºï¼Œè¯¦ç»†è®²è¿°æ¯ä¸€ä¸ªæ­¥éª¤ã€‚ä¸‹é¢è®©æˆ‘ä»¬ä»ç¯å¢ƒåˆå§‹åŒ–å¼€å§‹å§ã€‚

**ç¯å¢ƒåˆå§‹åŒ–**

é¦–å…ˆæˆ‘ä»¬ä¼šå‘ç°ï¼Œsqlmapçš„å…¥å£æ–‡ä»¶æ˜¯sqlmap.pyï¼Œè¿™ä¸ªæ–‡ä»¶çš„mainå¦‚ä¸‹æ‰€ç¤ºï¼š

```python
if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        pass
    except SystemExit:
        raise
    except:
        traceback.print_exc()
    finally:
        if threading.active_count() > 1:
            os._exit(getattr(os, "_exitcode", 0))
        else:
            sys.exit(getattr(os, "_exitcode", 0))
else:
    __import__("lib.controller.controller")
```

æ ¹æ®mainå‡½æ•°çš„åå­—ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œç¨‹åºçš„æ ¸å¿ƒé€»è¾‘ä¸€å®šè¢«å°è£…åœ¨äº†mianå‡½æ•°é‡Œé¢ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è¿›å…¥åˆ°mianå‡½æ•°é‡ŒæŸ¥çœ‹ã€‚

```python
def main():
    try:
        dirtyPatches()
        resolveCrossReferences()
        checkEnvironment()
        setPaths(modulePath())
        banner()
        args = cmdLineParser()
        cmdLineOptions.update(args.__dict__ if hasattr(args, "__dict__") else args)
        initOptions(cmdLineOptions)
        if checkPipedInput():
            conf.batch = True
        if conf.get("api"):
            from lib.utils.api import StdDbOut
            from lib.utils.api import setRestAPILog
            sys.stdout = StdDbOut(conf.taskid, messagetype="stdout")
            sys.stderr = StdDbOut(conf.taskid, messagetype="stderr")
            setRestAPILog()
        conf.showTime = True
        dataToStdout("[!] legal disclaimer: %s\n\n" % LEGAL_DISCLAIMER, forceOutput=True)
        dataToStdout("[*] starting @ %s\n\n" % time.strftime("%X /%Y-%m-%d/"), forceOutput=True)
        init()
```

è¿›å…¥åˆ°mianå‡½æ•°ä¹‹åæˆ‘ä»¬å°±ä¼šå‘ç°ï¼Œç¯å¢ƒåˆå§‹åŒ–åˆå§‹åŒ–è¿‡ç¨‹çš„ä»£ç å°±åœ¨è¿™é‡Œï¼Œè¯¥è¿‡ç¨‹å¼•å…¥äº†ä¸¤ä¸ªé‡è¦æ•°æ®å®¹å™¨çš„æ˜ å°„confå’Œkbã€‚ä»–ä»¬éƒ½æ˜¯å…¨å±€çš„ç¯å¢ƒå˜é‡ï¼Œæ˜¯å­˜å‚¨ç¨‹åºè¿è¡Œä¸­é—´æ•°æ®å’Œä¿¡æ¯æ•°æ®çš„å®¹å™¨ï¼Œå…¶ä¸­sqlmapçš„ç»“æœä¿¡æ¯ã€æ³¨å…¥ä¿¡æ¯ã€æ§åˆ¶ä¿¡æ¯éƒ½æ˜¯é€šè¿‡å®ƒä»¬è¿›è¡Œè¯»å†™æ¥å®Œæˆç¨‹åºçš„æ‰§è¡Œçš„ã€‚è¿™éƒ¨åˆ†å†…å®¹æˆ‘ä»¬ä¼šåœ¨ä¸‹èŠ‚è¯¾å±•å¼€ã€‚

```python
from lib.core.data import conf
from lib.core.data import kb
```

åœ¨è¿™é‡Œï¼Œä¸ºäº†ä½ æ›´å¥½åœ°ç†è§£å®ƒä»¬ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿™ä¸¤ä¸ªæ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°lib.core.data.pyæ–‡ä»¶è¿›è¡Œè§‚å¯Ÿã€‚

```python
# object to share within function and classes command

# line options and settings

conf = AttribDict()





# object to share within function and classes results

kb = AttribDict()
```

å¯ä»¥å‘ç°ï¼Œè¿™ä¸¤ä¸ªæ•°æ®ç»“æ„æ˜¯ä½œè€…è‡ªå·±å°è£…çš„å‡½æ•°ï¼Œå°è£…çš„ä¸»è¦ç›®çš„æ˜¯å®ç°æ·±æ‹·è´ï¼ˆ`__deepcopy__` ï¼‰è¿™ä¸ªé­”æ³•å‡½æ•°ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒPythonå†…å®¹æ•°æ®çš„æ‹·è´æ“ä½œä¼šè¢«å¤§å¤§ä¼˜åŒ–ã€‚

```python
class AttribDict(dict):
      ......
    def __deepcopy__(self, memo):

        retVal = self.__class__()

        memo[id(self)] = retVal





        for attr in dir(self):

            if not attr.startswith('_'):

                value = getattr(self, attr)

                if not isinstance(value, (types.BuiltinFunctionType, types.FunctionType, types.MethodType)):

                    setattr(retVal, attr, copy.deepcopy(value, memo))





        for key, value in self.items():

            retVal.__setitem__(key, copy.deepcopy(value, memo))





        return retVal
```

æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­è§‚å¯Ÿmainå‡½æ•°ã€‚

```python
        dirtyPatches()  # è¡¥ä¸å‡½æ•°
        resolveCrossReferences()  # æ¶ˆé™¤äº¤å‰å¼•ç”¨
        checkEnvironment()  # æ£€æŸ¥ç¯å¢ƒ
        setPaths(modulePath())  # å¦‚æœä½¿ç”¨py2exe ä½œä¸ºfileè·å–ç¨‹åºè·¯å¾„çš„æ›¿ä»£ è®¾ç½®ç»å¯¹è·¯å¾„
        banner()
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç¨‹åºåœ¨è¿›å…¥åˆ°tryè¯­å¥ä¹‹åï¼Œé¦–å…ˆä¼šæ‰§è¡Œå‡ ä¸ªå‡½æ•°ã€‚

ç¬¬ä¸€ä¸ªå‡½æ•°æ˜¯dirtyPatches() ï¼Œå®ƒæ˜¯ä¸€ä¸ªè¡¥ä¸å‡½æ•°ã€‚

```python
def dirtyPatches():
    """
    Place for "dirty" Python related patches
    """
    # accept overly long result lines (e.g. SQLi results in HTTP header responses)
    _http_client._MAXLINE = 1 * 1024 * 1024
    # prevent double chunked encoding in case of sqlmap chunking (Note: Python3 does it automatically if 'Content-length' is missing)
    if six.PY3:
        if not hasattr(_http_client.HTTPConnection, "__send_output"):
            _http_client.HTTPConnection.__send_output = _http_client.HTTPConnection._send_output
        def _send_output(self, *args, **kwargs):
            if conf.get("chunked") and "encode_chunked" in kwargs:
                kwargs["encode_chunked"] = False
            self.__send_output(*args, **kwargs)
        _http_client.HTTPConnection._send_output = _send_output
    # add support for inet_pton() on Windows OS
    if IS_WIN:
        from thirdparty.wininetpton import win_inet_pton
    # Reference: https://github.com/nodejs/node/issues/12786#issuecomment-298652440
    codecs.register(lambda name: codecs.lookup("utf-8") if name == "cp65001" else None)
    # Reference: http://bugs.python.org/issue17849
    if hasattr(_http_client, "LineAndFileWrapper"):
        def _(self, *args):
            return self._readline()
        _http_client.LineAndFileWrapper._readline = _http_client.LineAndFileWrapper.readline
        _http_client.LineAndFileWrapper.readline = _
    # to prevent too much "guessing" in case of binary data retrieval
    thirdparty.chardet.universaldetector.MINIMUM_THRESHOLD = 0.90
    match = re.search(r" --method[= ](\w+)", " ".join(sys.argv))
    if match and match.group(1).upper() != PLACE.POST:
        PLACE.CUSTOM_POST = PLACE.CUSTOM_POST.replace("POST", "%s (body)" % match.group(1))
    # https://github.com/sqlmapproject/sqlmap/issues/4314
    try:
        os.urandom(1)
    except NotImplementedError:
        if six.PY3:
            os.urandom = lambda size: bytes(random.randint(0, 255) for _ in range(size))
        else:
            os.urandom = lambda size: "".join(chr(random.randint(0, 255)) for _ in xrange(size))
```

ä¹‹æ‰€ç§°å®ƒä¸ºè¡¥ä¸å‡½æ•°å‘¢ï¼Œæ˜¯å› ä¸ºè¿™ä¸ªå‡½æ•°åŠŸèƒ½ï¼Œä¸»è¦ç”¨æ¥å¤„ç†sqlmapçš„ä¸€äº›å†å²ä¿¡æ¯ã€‚ä¾‹å¦‚æ”¯æŒPython2å‡çº§Python3ã€æ”¯æŒWindowså¹³å°çš„inet\_pton()å‡½æ•°ã€é™åˆ¶httplibçš„æœ€å¤§è¡Œé•¿åº¦ç­‰ç­‰ã€‚è¿™äº›æ“ä½œå¯¹sqlmapçš„å®é™…åŠŸèƒ½å½±å“å¹¶ä¸æ˜¯ç‰¹åˆ«å¤§ï¼Œå±äºä¿è¯ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿè®¾ç½®çš„æ­£å¸¸é€‰é¡¹ï¼Œæˆ‘ä»¬ä¸éœ€è¦è¿‡å¤šå…³å¿ƒã€‚

æ¥ä¸‹æ¥æ˜¯resolveCrossReferenceså‡½æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯æ¶ˆé™¤äº¤å‰å¼•ç”¨ã€‚æˆ‘ä»¬é€šè¿‡ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ç†è§£ä¸‹ä»€ä¹ˆæ˜¯äº¤å‰å¼•ç”¨ã€‚

````python
```python
a.py
from b import b_var
a_var = 1
b.py
from a import a_var
b_var = 2
````

````
è¿™å°±æ˜¯ä¸€ä¸ªäº¤å‰å¼•ç”¨çš„ç¤ºä¾‹ï¼Œæ–‡ä»¶`a.py`å’Œ`b.py`äº’ç›¸å¼•ç”¨å¯¼è‡´äº†è¿è¡Œçš„pythonè§£é‡Šå™¨æŠ¥é”™ã€‚ä¸ºäº†é¿å…äº¤å‰å¼•ç”¨å¼•èµ·è¿™æ ·çš„é—®é¢˜ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©é€šè¿‡`resolveCrossReferences()`å‡½æ•°æ¥æ¶ˆé™¤äº¤å‰å¼•ç”¨ã€‚
```python
def resolveCrossReferences():
    â€œâ€â€
    Place for cross-reference resolution
    â€œâ€â€
    lib.core.threads.isDigit = isDigit
    lib.core.threads.readInput = readInput
    lib.core.common.getPageTemplate = getPageTemplate
    lib.core.convert.filterNone = filterNone
    lib.core.convert.isListLike = isListLike
    lib.core.convert.shellExec = shellExec
    lib.core.convert.singleTimeWarnMessage = singleTimeWarnMessage
    lib.core.option._pympTempLeakPatch = pympTempLeakPatch
    lib.request.connect.setHTTPHandlers = _setHTTPHandlers
    lib.utils.search.setHTTPHandlers = _setHTTPHandlers
    lib.controller.checks.setVerbosity = setVerbosity
    lib.utils.sqlalchemy.getSafeExString = getSafeExString
    thirdparty.ansistrm.ansistrm.stdoutEncode = stdoutEncode
````

sqlmapåœ¨æ¶ˆé™¤äº¤å‰å¼•ç”¨ä¹‹åï¼Œç¨‹åºä¼šå¼€å§‹è¿è¡Œæ£€æŸ¥ç¯å¢ƒçš„å‡½æ•°checkEnvironment()ã€‚

```python
def checkEnvironment():
    try:
         os.path.isdir(modulePath())
    except UnicodeEncodeError:
        errMsg = â€œyour system does not properly handle non-ASCII paths. â€œ
        errMsg += â€œPlease move the sqlmapâ€™s directory to the other locationâ€
        logger.critical(errMsg)
        raise SystemExit
    if LooseVersion(VERSION) < LooseVersion(â€œ1.0â€):
        errMsg = â€œyour runtime environment (e.g. PYTHONPATH) is â€œ
        errMsg += â€œbroken. Please make sure that you are not running â€œ
        errMsg += â€œnewer versions of sqlmap with runtime scripts for older â€œ
        errMsg += â€œversionsâ€
        logger.critical(errMsg)
        raise SystemExit
    # Patch for pip (import) environment
    if â€œsqlmap.sqlmapâ€ in sys.modules:
        for _ in (â€œcmdLineOptionsâ€, â€œconfâ€, â€œkbâ€):
            globals()[_] = getattr(sys.modules[â€œlib.core.dataâ€], _)
        for _ in (â€œSqlmapBaseExceptionâ€, â€œSqlmapShellQuitExceptionâ€, â€œSqlmapSilentQuitExceptionâ€, â€œSqlmapUserQuitExceptionâ€):
            globals()[_] = getattr(sys.modules[â€œlib.core.exceptionâ€], _)
```

checkEnvironmentå‡½æ•°ä¼šå¯¹å½“å‰çš„ç¯å¢ƒè¿›è¡Œåˆæ­¥æ£€æŸ¥ï¼Œæ£€æŸ¥çš„å†…å®¹åŒ…æ‹¬ï¼Œå­˜æ”¾sqlmapçš„è·¯å¾„æ˜¯å¦åŒ…å«éASCIIå­—ç¬¦ï¼Œä»¥åŠsqlmapçš„ç‰ˆæœ¬æ˜¯å¦å°äº1.0ã€‚

ä¸‹ä¸€ä¸ªå‡½æ•°`setPaths(modulePath())`æ˜¯ç”¨æ¥ç»™é¡¹ç›®ä¸­çš„æ–‡ä»¶å¤¹å’Œæ–‡ä»¶è®¾ç½®ç»å¯¹è·¯å¾„çš„ã€‚

```python
def setPaths(rootPath):
    """
    Sets absolute paths for project directories and files
    """
    paths.SQLMAP_ROOT_PATH = rootPath
    # sqlmap paths
    paths.SQLMAP_DATA_PATH = os.path.join(paths.SQLMAP_ROOT_PATH, "data")
    paths.SQLMAP_EXTRAS_PATH = os.path.join(paths.SQLMAP_ROOT_PATH, "extra")
    paths.SQLMAP_SETTINGS_PATH = os.path.join(paths.SQLMAP_ROOT_PATH, "lib", "core", "settings.py")
    paths.SQLMAP_TAMPER_PATH = os.path.join(paths.SQLMAP_ROOT_PATH, "tamper")
    paths.SQLMAP_PROCS_PATH = os.path.join(paths.SQLMAP_DATA_PATH, "procs")
    paths.SQLMAP_SHELL_PATH = os.path.join(paths.SQLMAP_DATA_PATH, "shell")
    paths.SQLMAP_TXT_PATH = os.path.join(paths.SQLMAP_DATA_PATH, "txt")
    paths.SQLMAP_UDF_PATH = os.path.join(paths.SQLMAP_DATA_PATH, "udf")
    paths.SQLMAP_XML_PATH = os.path.join(paths.SQLMAP_DATA_PATH, "xml")
    paths.SQLMAP_XML_BANNER_PATH = os.path.join(paths.SQLMAP_XML_PATH, "banner")
    paths.SQLMAP_XML_PAYLOADS_PATH = os.path.join(paths.SQLMAP_XML_PATH, "payloads")
    # sqlmap files
    paths.COMMON_COLUMNS = os.path.join(paths.SQLMAP_TXT_PATH, "common-columns.txt")
    paths.COMMON_FILES = os.path.join(paths.SQLMAP_TXT_PATH, "common-files.txt")
    paths.COMMON_TABLES = os.path.join(paths.SQLMAP_TXT_PATH, "common-tables.txt")
    paths.COMMON_OUTPUTS = os.path.join(paths.SQLMAP_TXT_PATH, 'common-outputs.txt')
    paths.SQL_KEYWORDS = os.path.join(paths.SQLMAP_TXT_PATH, "keywords.txt")
    paths.SMALL_DICT = os.path.join(paths.SQLMAP_TXT_PATH, "smalldict.txt")
    paths.USER_AGENTS = os.path.join(paths.SQLMAP_TXT_PATH, "user-agents.txt")
    paths.WORDLIST = os.path.join(paths.SQLMAP_TXT_PATH, "wordlist.tx_")
    paths.ERRORS_XML = os.path.join(paths.SQLMAP_XML_PATH, "errors.xml")
    paths.BOUNDARIES_XML = os.path.join(paths.SQLMAP_XML_PATH, "boundaries.xml")
    paths.QUERIES_XML = os.path.join(paths.SQLMAP_XML_PATH, "queries.xml")
    paths.GENERIC_XML = os.path.join(paths.SQLMAP_XML_BANNER_PATH, "generic.xml")
    paths.MSSQL_XML = os.path.join(paths.SQLMAP_XML_BANNER_PATH, "mssql.xml")
    paths.MYSQL_XML = os.path.join(paths.SQLMAP_XML_BANNER_PATH, "mysql.xml")
    paths.ORACLE_XML = os.path.join(paths.SQLMAP_XML_BANNER_PATH, "oracle.xml")
    paths.PGSQL_XML = os.path.join(paths.SQLMAP_XML_BANNER_PATH, "postgresql.xml")
    for path in paths.values():
        if any(path.endswith(_) for _ in (".txt", ".xml", ".tx_")):
            checkFile(path)
    if IS_WIN:
        # Reference: https://pureinfotech.com/list-environment-variables-windows-10/
        if os.getenv("LOCALAPPDATA"):
            paths.SQLMAP_HOME_PATH = os.path.expandvars("%LOCALAPPDATA%\\sqlmap")
        elif os.getenv("USERPROFILE"):
            paths.SQLMAP_HOME_PATH = os.path.expandvars("%USERPROFILE%\\Local Settings\\sqlmap")
        else:
            paths.SQLMAP_HOME_PATH = os.path.join(os.path.expandvars(os.path.expanduser("~")), "sqlmap")
    else:
        paths.SQLMAP_HOME_PATH = os.path.join(os.path.expandvars(os.path.expanduser("~")), ".sqlmap")
        if not os.path.isdir(paths.SQLMAP_HOME_PATH):
            if "XDG_DATA_HOME" in os.environ:
                paths.SQLMAP_HOME_PATH = os.path.join(os.environ["XDG_DATA_HOME"], "sqlmap")
            else:
                paths.SQLMAP_HOME_PATH = os.path.join(os.path.expandvars(os.path.expanduser("~")), ".local", "share", "sqlmap")
    paths.SQLMAP_OUTPUT_PATH = getUnicode(paths.get("SQLMAP_OUTPUT_PATH", os.path.join(paths.SQLMAP_HOME_PATH, "output")), encoding=sys.getfilesystemencoding() or UNICODE_ENCODING)
    paths.SQLMAP_DUMP_PATH = os.path.join(paths.SQLMAP_OUTPUT_PATH, "%s", "dump")
    paths.SQLMAP_FILES_PATH = os.path.join(paths.SQLMAP_OUTPUT_PATH, "%s", "files")
    # History files
    paths.SQLMAP_HISTORY_PATH = getUnicode(os.path.join(paths.SQLMAP_HOME_PATH, "history"), encoding=sys.getfilesystemencoding() or UNICODE_ENCODING)
    paths.API_SHELL_HISTORY = os.path.join(paths.SQLMAP_HISTORY_PATH, "api.hst")
    paths.OS_SHELL_HISTORY = os.path.join(paths.SQLMAP_HISTORY_PATH, "os.hst")
    paths.SQL_SHELL_HISTORY = os.path.join(paths.SQLMAP_HISTORY_PATH, "sql.hst")
    paths.SQLMAP_SHELL_HISTORY = os.path.join(paths.SQLMAP_HISTORY_PATH, "sqlmap.hst")
    paths.GITHUB_HISTORY = os.path.join(paths.SQLMAP_HISTORY_PATH, "github.hst")
```

è®¾ç½®å®Œç»å¯¹è·¯å¾„åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œsqlmapè¿è¡Œäº†ä¸€ä¸ªbannerå‡½æ•°ï¼Œå®ƒå¯¹äºsqlmapçš„è¿è¡Œæ²¡æœ‰å®é™…çš„ä½œç”¨ï¼Œä½†æ˜¯ä½œè€…å¯ä»¥é€šè¿‡bannerå‡½æ•°ç»˜åˆ¶ä¸€å¹…å­—ç¬¦ç”»ï¼Œæ˜¯ä¸æ˜¯å¾ˆé…·ï¼

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/a5/c2/a5dc76a4f24686649413121e108d58c2.png?wh=1556x290)

ä¸‹æ–¹æ˜¯bannerå‡½æ•°çš„ä»£ç ï¼Œä½ åœ¨æ„å»ºè‡ªå·±å·¥å…·çš„æ—¶å€™ä¹Ÿå¯ä»¥è€ƒè™‘å¼•å…¥è¿™ç§æœ‰è¶£çš„å°å‡½æ•°ï¼Œä¸ºä½ çš„å·¥å…·å¢æ·»ä¸ªæ€§åŒ–è‰²å½©ï¼Œè®©å®ƒçœ‹èµ·æ¥åˆé…·åˆå®ç”¨ã€‚

```python
def banner():
    """
    This function prints sqlmap banner with its version
    """
    if not any(_ in sys.argv for _ in ("--version", "--api")) and not conf.get("disableBanner"):
        result = BANNER
        if not IS_TTY or any(_ in sys.argv for _ in ("--disable-coloring", "--disable-colouring")):
            result = clearColors(result)
        elif IS_WIN:
            coloramainit()
        dataToStdout(result, forceOutput=True)
```

**å‘½ä»¤è¡Œå‚æ•°è§£æ**

ç»è¿‡ä¸Šé¢çš„å‡½æ•°æ‰§è¡Œä¹‹åï¼ŒåŸºæœ¬ç¯å¢ƒå·²ç»é…ç½®å¥½äº†ï¼Œç¨‹åºå°†å¼€å§‹å¤„ç†ç”¨æˆ·çš„è¾“å…¥ï¼ŒåŒ…æ‹¬æœ‰å‘½ä»¤è¡Œå‚æ•°ä»¥åŠé…ç½®çš„æ–‡ä»¶å‚æ•°ã€‚

```python
def main():
    """
    Main function of sqlmap when running from command line.
    """
    try:
        dirtyPatches()
        resolveCrossReferences()
        checkEnvironment()
        setPaths(modulePath())
        banner()
        # Store original command line options for possible later restoration
        args = cmdLineParser()
        cmdLineOptions.update(args.__dict__ if hasattr(args, "__dict__") else args)
        initOptions(cmdLineOptions)
```

**å…¨å±€å˜é‡èµ‹å€¼ä¸ç¯å¢ƒæ£€æŸ¥**

åœ¨æ¥æ”¶ç”¨æˆ·çš„è¾“å…¥å‚æ•°ä¹‹åï¼Œç¨‹åºå¼€å§‹è¿›å…¥initæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªé‡è¦çš„å‰æœŸé…ç½®æ–¹æ³•ï¼Œé‡Œé¢åŒ…å«å¤§é‡çš„é…ç½®æ“ä½œï¼Œè¿™äº›æ“ä½œæˆ‘ä»¬å¯ä»¥è¿›å…¥å‡½æ•°ä¸­è§‚å¯Ÿã€‚

```python
def init():
    _useWizardInterface() # å¯åŠ¨å¼•å¯¼æ¨¡å¼
    setVerbosity() # è®¾ç½®é»˜è®¤çš„æ—¥å¿—è¾“å‡ºè¯¦ç»†åº¦
    _saveConfig()  # ä¿å­˜å½“å‰æ‰«æçš„é…ç½®
    _setRequestFromFile() # è§£æ request file çš„æ–‡ä»¶å†…å®¹
    _cleanupOptions() # ä¸º conf ä¸­çš„å‚æ•°èµ‹åˆå€¼
    _cleanupEnvironment() 
    _purge() # æ¸…ç©º sqlmap ç›¸å…³ä¿¡æ¯
    _checkDependencies() # æ£€æŸ¥æ˜¯å¦ç¼ºå¤±ä¾èµ–
    _createHomeDirectories() # åˆ›å»º outputã€history ç›®å½•
    _createTemporaryDirectory() # åˆ›å»ºä¸´æ—¶ç›®å½•
    _basicOptionValidation() # éªŒè¯éƒ¨åˆ†å‚æ•°å€¼æ˜¯å¦ç¬¦åˆé¢„æœŸ
    _setProxyList() # è§£æ proxy file çš„æ–‡ä»¶å†…å®¹
    _setTorProxySettings() # è®¾ç½® tor ä»£ç†
    _setDNSServer() # åˆ›å»º DNS æœåŠ¡å™¨
    _adjustLoggingFormatter() # åˆå§‹åŒ–æ—¥å¿—æ ¼å¼åŒ–å·¥å…·
    _setMultipleTargets() # è§£æ burp log çš„æ–‡ä»¶å†…å®¹
    _listTamperingFunctions() # è¾“å‡º tamper çš„è¯¦ç»†ä¿¡æ¯
    _setTamperingFunctions() # è®¾ç½®åç»­è¦è°ƒç”¨çš„ tamper
    _setPreprocessFunctions() # è®¾ç½®å¤„ç†è¯·æ±‚çš„å‡½æ•°
    _setPostprocessFunctions() # è®¾ç½®å¤„ç†å“åº”çš„å‡½æ•°
    _setTrafficOutputFP() # åˆ›å»º trafficFile å¹¶è·å–æ–‡ä»¶å¥æŸ„
    _setupHTTPCollector() # åˆ›å»º HAR æ–‡ä»¶
    _setHttpChunked() # è®¾ç½® chunked 
    _checkWebSocket() # æ£€æŸ¥ websocket ç¯å¢ƒæ˜¯å¦æ­£å¸¸

    parseTargetDirect() # è§£ææ•°æ®åº“é“¾æ¥

    if any((conf.url, conf.logFile, conf.bulkFile, conf.requestFile, conf.googleDork, conf.stdinPipe)):
        _setHostname() # è®¾ç½® conf ä¸­çš„ hostname
        _setHTTPTimeout() # è®¾ç½®è¯·æ±‚æœ€å¤§è¶…æ—¶æ—¶é—´
        _setHTTPExtraHeaders() # è®¾ç½®è¯·æ±‚çš„ headers
        _setHTTPCookies() # è®¾ç½®è¯·æ±‚çš„ cookies
        _setHTTPReferer() # è®¾ç½®è¯·æ±‚çš„ referer
        _setHTTPHost() # è®¾ç½®è¯·æ±‚çš„ host
        _setHTTPUserAgent() # è®¾ç½®è¯·æ±‚çš„ UA
        _setHTTPAuthentication() # è®¾ç½®è¯·æ±‚çš„è®¤è¯ä¿¡æ¯
        _setHTTPHandlers() # è®¾ç½®å¯¹åº”çš„è¯·æ±‚å¤„ç†ç±»
        _setDNSCache() # è®¾ç½® dns ç¼“å­˜
        _setSocketPreConnect() 
        _setSafeVisit()
        _doSearch() # å¤„ç† Google Dork è§£æ
        _setStdinPipeTargets() # ä» pipeline ä¸­è·å– targets
        _setBulkMultipleTargets() # ä»æ–‡æœ¬ä¸­è·å– targets
        _checkTor() # æ£€æŸ¥ tor ä»£ç†
        _setCrawler() # è®¾ç½®çˆ¬è™«ä¿¡æ¯
        _findPageForms() # å¯»æ‰¾é¡µé¢ä¸­çš„è¡¨å•
        _setDBMS() # è®¾ç½® DBMS
        _setTechnique() # è®¾ç½®æ£€æµ‹ç±»å‹

    _setThreads() # è®¾ç½®çº¿ç¨‹æ•°
    _setOS() # è®¾ç½®æ“ä½œç³»ç»Ÿç±»å‹
    _setWriteFile() # è®¾ç½®æ–‡ä»¶å†™å…¥ä¿¡æ¯
    _setMetasploit() # è®¾ç½® MSF ä¿¡æ¯
    _setDBMSAuthentication() # è®¾ç½® DBMS çš„è®¤è¯ä¿¡æ¯
    loadBoundaries() # åŠ è½½ Boundaries
    loadPayloads() # åŠ è½½ Payloads
    _setPrefixSuffix() # è®¾ç½®æ–°çš„ prefix å’Œsufix
    update() # æ›´æ–° sqlmap
    _loadQueries() # åŠ è½½ queries
```

å…¶å®æˆ‘ä»¬åªéœ€è¦æ ¹æ®åé¢çš„æ³¨é‡Šï¼Œäº†è§£æ¯ä¸ªå‡½æ•°å¤§æ¦‚å®ç°çš„åŠŸèƒ½å°±å¯ä»¥äº†ï¼Œå®ƒä»¬æœ‰äº›ä¸åˆå§‹åŒ–é…ç½®æ–‡ä»¶ç›¸å…³ï¼Œæœ‰äº›ä¸å®é™…æ”»å‡»è¿‡ç¨‹ç›¸å…³ã€‚å®é™…ä¸Šï¼Œè¿™é‡Œåªæ˜¯ä¼šåˆæ­¥è§£æå‘½ä»¤è¡Œä¼ å…¥çš„å‚æ•°ï¼Œå¹¶ä¸æ¶‰åŠåˆ°å¤§éƒ¨åˆ†å‡½æ•°çš„è°ƒç”¨è¿‡ç¨‹ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦ç†è§£çš„å¾ˆç»†è‡´ï¼Œæˆ‘ä»¬çš„æ ¸å¿ƒå…³æ³¨ç‚¹åº”è¯¥åœ¨æ³¨å…¥é€»è¾‘ä¸Šã€‚

```python
        init()
        if not conf.updateAll:
            # Postponed imports (faster start)
            if conf.smokeTest:
                from lib.core.testing import smokeTest
                os._exitcode = 1 - (smokeTest() or 0)
            elif conf.vulnTest:
                from lib.core.testing import vulnTest
                os._exitcode = 1 - (vulnTest() or 0)
            else:
                from lib.controller.controller import start
                if conf.profile:
                    from lib.core.profiling import profile
                    globals()["start"] = start
                    profile()
                else:
                    try:
                        if conf.crawlDepth and conf.bulkFile:
                            targets = getFileItems(conf.bulkFile)
                            for i in xrange(len(targets)):
                                target = None
                                try:
                                    kb.targets = OrderedSet()
                                    target = targets[i]
                                    if not re.search(r"(?i)\Ahttp[s]*://", target)
                                        target = "http://%s" % target
                                    infoMsg = "starting crawler for target URL '%s' (%d/%d)" % (target, i + 1, len(targets))
                                    logger.info(infoMsg)
                                    crawl(target)
                                except Exception as ex:
                                    if target and not isinstance(ex, SqlmapUserQuitException):
                                        errMsg = "problem occurred while crawling '%s' ('%s')" % (target, getSafeExString(ex))
                                        logger.error(errMsg)
                                    else:
                                        raise
                                else:
                                    if kb.targets:
                                        start()
```

å­¦ä¹ å®Œæ¯•initæ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬å°±å®Œæˆäº†æ•´ä¸ªåˆå§‹åŒ–è¿‡ç¨‹ã€‚

## æ€»ç»“

è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å­¦ä¹ äº†è‡ªåŠ¨åŒ–SQLæ³¨å…¥æµ‹è¯•å·¥å…·â€“sqlmapçš„è®¾è®¡æ€è·¯ã€‚

ä½œä¸ºä¸šå†…çŸ¥åä¸”å¸¸ç”¨çš„SQLè‡ªåŠ¨åŒ–æ³¨å…¥å·¥å…·ï¼Œsqlmapå·²ç»æŒç»­ç»´æŠ¤äº†è¶…è¿‡10å¹´çš„æ—¶é—´ã€‚ä½œä¸ºæœ‰æ¢¦æƒ³çš„å·¥ç¨‹å¸ˆï¼Œæˆ‘ä»¬ä¸ä»…éœ€è¦æŒæ¡å¦‚ä½•ä½¿ç”¨sqlmapï¼Œæ›´è¦å­¦ä¹ å®ƒçš„è®¾è®¡æ€æƒ³å’Œå·¥ä½œåŸç†ï¼Œç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šæ‰èƒ½å¸®åŠ©æˆ‘ä»¬çœ‹çš„æ›´è¿œã€‚

sqlmapçš„ä»£ç é‡ååˆ†åºå¤§ï¼Œå› ä¸ºæŒæ¡å…¶æ ¸å¿ƒè®¾è®¡æ€æƒ³å’Œå·¥ä½œåŸç†å°±ååˆ†é‡è¦ï¼Œè¿™ä¼šæˆä¸ºæˆ‘ä»¬æ·±å…¥ä»£ç é€»è¾‘æ¢ç´¢çš„é£å‘æ ‡ã€‚å› æ­¤ï¼Œåœ¨äº†è§£å¦‚ä½•è·å–sqlmapä»£ç ä»¥åŠå¦‚ä½•æ­å»ºsqlmapçš„è¿è¡Œç¯å¢ƒåï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥å­¦ä¹ äº†sqlmapè®¾è®¡åŸç†çš„ç›¸å…³çŸ¥è¯†ï¼Œæ¯”å¦‚sqlmapçš„é…ç½®æ–‡ä»¶ä»‹ç»ç­‰ã€‚

æ¥ä¸‹æ¥ï¼Œä¸å¤§éƒ¨åˆ†å¼€æºè½¯ä»¶çš„è®¾è®¡æ€è·¯ç±»ä¼¼ï¼Œsqlmapåœ¨çœŸæ­£å¼€å§‹å·¥ä½œå‰éœ€è¦åšå¤§é‡çš„åˆå§‹åŒ–å·¥ä½œï¼Œå› æ­¤æˆ‘ä»¬å¯¹sqlmapçš„åˆå§‹åŒ–æµç¨‹è¿›è¡Œäº†æ¢³ç†ã€‚ç»è¿‡åˆ†æï¼Œæ€»ç»“å‡ºå®ƒä¸»è¦åŒ…å«æœ‰å…¨å±€å˜é‡åˆå§‹åŒ–ã€å‘½ä»¤è¡Œå‚æ•°è§£æã€å…¨å±€å˜é‡èµ‹å€¼ä»¥åŠç¯å¢ƒæ£€æŸ¥è¿™å››ä¸ªé€šç”¨çš„åˆå§‹åŒ–æ­¥éª¤ï¼Œç„¶åæˆ‘ä»¬åˆå…·ä½“å­¦ä¹ äº†è¿™å››ä¸ªæµç¨‹æ˜¯å¦‚ä½•å®ç°çš„ã€‚

åœ¨å­¦ä¹ å®Œsqlmapçš„åˆå§‹åŒ–åï¼Œå¾ˆå¿«æˆ‘ä»¬å°±ä¼šè¿›å…¥sqlmapçš„å·¥ä½œæµç¨‹å­¦ä¹ ï¼Œè¿™æ—¶æˆ‘ä»¬éœ€è¦é‡æ–°å®¡è§†sqlmapçš„è®¾è®¡æ¶æ„ï¼Œäº†è§£æˆ‘ä»¬æ‰€å¤„çš„ä½ç½®ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/0f/bc/0fbeefeec2d41ffd8949e164076180bc.png?wh=1436x768)

è¿™æ˜¯æˆ‘æ•´ç†çš„ä¸€å¹…sqlmapå·¥ä½œåŸç†å›¾ï¼Œåœ¨æœ¬èŠ‚è¯¾æˆ‘ä»¬å­¦ä¹ äº†sqlmapå·¥ä½œå‰çš„åˆå§‹åŒ–æµç¨‹ï¼Œè¿™äº›å†…å®¹å¯ä»¥å¸®åŠ©ä½ è®¤è¯†åˆ°sqlmapè®¾è®¡æ—¶çš„åº•å±‚é€»è¾‘ã€‚ä¸‹èŠ‚è¯¾æˆ‘ä»¬å°†æ­£å¼å¼€å§‹å­¦ä¹ sqlmapçš„è‡ªåŠ¨åŒ–æ³¨å…¥åŠŸèƒ½ï¼Œå®ƒçš„èµ·ç‚¹æ˜¯é¢„æ³¨å…¥ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬åœ¨å‰å‡ èŠ‚è¯¾ç¨‹ä¸­æ‰€è®²çš„èµ·æ‰‹å¼é˜¶æ®µã€‚

## æ€è€ƒ

sqlmapçš„åˆå§‹åŒ–æµç¨‹æœ‰ä»€ä¹ˆå€¼å¾—æ”¹è¿›çš„åœ°æ–¹å—ï¼Ÿ

æ¬¢è¿åœ¨è¯„è®ºåŒºç•™ä¸‹ä½ çš„æ€è€ƒï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ2ï¼‰</strong></div><ul>
<li><span>ret2basic</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>è€å¸ˆmianå‡½æ•°æ˜¯ä»€ä¹ˆ åˆ€å‰Šé¢è¿˜æ˜¯æ‰‹æ“€é¢</p>2022-04-30</li><br/><li><span>ifelse</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>å­¦ä¹ æ‰“å¡</p>2023-03-13</li><br/>
</ul>