ä½ å¥½ï¼Œæˆ‘æ˜¯Chronoã€‚

åˆ°ä»Šå¤©æˆ‘ä»¬â€œä¸­çº§ç¯‡â€çš„å­¦ä¹ ä¹Ÿå‘Šä¸€æ®µè½äº†ï¼Œåœ¨è¿™æ®µæ—¶é—´é‡Œæˆ‘ä»¬ä½¿ç”¨kubeadmæ­å»ºäº†æ›´æ¥è¿‘ç”Ÿäº§ç¯å¢ƒçš„å¤šèŠ‚ç‚¹Kubernetesé›†ç¾¤ï¼Œç„¶åå­¦ä¹ äº†Deploymentã€DaemonSetã€Serviceã€Ingressè¿™4ä¸ªéå¸¸é‡è¦çš„APIå¯¹è±¡ã€‚

è¿™èŠ‚è¯¾ä½œä¸ºå¯¹â€œä¸­çº§ç¯‡â€çš„æ€»ç»“å’Œå›é¡¾ï¼Œä»ç„¶æ˜¯è§†é¢‘çš„å½¢å¼ï¼ŒæŠŠå‰é¢å‡ èŠ‚è¯¾é‡Œçš„ä¸€äº›æ“ä½œéƒ½å®é™…æ¼”ç¤ºå‡ºæ¥ï¼Œæ–¹ä¾¿ä½ å¯¹ç…§ç€æ“ä½œä¸Šä¸‹æ–‡æ¥å­¦ä¹ ã€‚

é¦–å…ˆæˆ‘ä¼šå¸¦ä½ çœ‹çœ‹kubeadmæ­å»ºé›†ç¾¤çš„å®Œæ•´è¿‡ç¨‹ï¼Œç„¶åç¼–å†™YAMLæ–‡ä»¶ï¼Œç¤ºèŒƒDeploymentã€DaemonSetã€Serviceã€Ingressç­‰å¯¹è±¡çš„å…·ä½“ç”¨æ³•ï¼Œæœ€åæ˜¯ä½¿ç”¨è¿™äº›å¯¹è±¡æ­å»ºWordPressç½‘ç«™ã€‚

è®©æˆ‘ä»¬å¼€å§‹è§†é¢‘è¯¾ç¨‹çš„å­¦ä¹ å§ã€‚

> ä¸€ç‚¹è¯´æ˜ï¼šè§†é¢‘æ˜¯æˆ‘çš„æ“ä½œå®å½•ï¼Œæœ‰äº›åŒ…å®‰è£…æ¯”è¾ƒæ…¢ï¼Œå±å¹•ä¼šå‡ ç§’æ²¡æœ‰åŠ¨ä½œï¼Œåœ¨å‚è€ƒè§†é¢‘ä»¥åŠä½ è‡ªå·±æ“ä½œçš„æ—¶å€™å¯ä»¥è€å¿ƒä¸€äº›ã€‚

* * *

### ä¸€. å®‰è£…kubeadm

æˆ‘ä»¬å…ˆæ¥å®‰è£…MasterèŠ‚ç‚¹ï¼Œå½“ç„¶åœ¨è¿™ä¹‹å‰ä½ éœ€è¦ä¿è¯å·²ç»å®‰è£…å¥½äº†Dockerï¼ˆå®‰è£…å‚è€ƒ[ç¬¬1è®²](https://time.geekbang.org/column/article/528619)ï¼‰ã€‚

é¦–å…ˆå››æ­¥å‡†å¤‡å·¥ä½œï¼šæ”¹ä¸»æœºåã€æ”¹Dockeré…ç½®ã€æ”¹ç½‘ç»œè®¾ç½®ã€æ”¹äº¤æ¢åˆ†åŒºã€‚

ä¿®æ”¹ä¸»æœºåï¼ŒæŠŠå®ƒæ”¹æˆ `master`ï¼š

```plain
sudo vi /etc/hostname
```

ä¿®æ”¹Dockerçš„é…ç½®æ–‡ä»¶ï¼ŒæŠŠcgroupçš„é©±åŠ¨ç¨‹åºæ”¹æˆ `systemd`ï¼Œç„¶åæ˜¯ä¿®æ”¹iptablesçš„é…ç½®ï¼Œå¯ç”¨ `br_netfilter` æ¨¡å—ï¼Œè¿˜æœ‰ä¿®æ”¹â€œ**/etc/fstab**â€ï¼Œå…³é—­Linuxçš„swapåˆ†åŒºã€‚

è¿™äº›æ“ä½œæ­¥éª¤éƒ½å·²ç»åˆ—åœ¨äº†[ç¬¬17è®²](https://time.geekbang.org/column/article/534762)é‡Œäº†ï¼Œå› ä¸ºä¸€ä¸ªä¸ªæ–‡ä»¶ä¿®æ”¹å¾ˆéº»çƒ¦ï¼Œæˆ‘å°±å†™äº†ä¸€ä¸ªè„šæœ¬æ–‡ä»¶ï¼ŒæŠŠè¿™äº›æ“ä½œéƒ½è‡ªåŠ¨åŒ–äº†ï¼Œå¤§æ¦‚çœ‹ä¸€ä¸‹ï¼š

```plain
vi prepare.sh
```

ç¬¬ä¸€éƒ¨åˆ†æ˜¯ä¿®æ”¹Dockeré…ç½®æ–‡ä»¶ç„¶åé‡å¯ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯ä¿®æ”¹iptablesé…ç½®ï¼Œç¬¬ä¸‰éƒ¨åˆ†æ˜¯å…³é—­Linuxçš„swapåˆ†åŒºã€‚æˆ‘ä»¬æ‰§è¡Œè¿™ä¸ªè„šæœ¬ï¼Œå®‰è£…çš„å‡†å¤‡å·¥ä½œå°±åšå¥½äº†ã€‚

æ¥ä¸‹æ¥ï¼Œä¸‹è½½kubeadmå¯æ‰§è¡Œæ–‡ä»¶ï¼ŒåŒæ ·æˆ‘ä¹Ÿå†™æˆäº†ä¸€ä¸ªæ–¹ä¾¿çš„è„šæœ¬æ–‡ä»¶ï¼š

```plain
vi admin.sh
```

åŸºæœ¬æµç¨‹å’ŒKuberneteså®˜æ–¹æ–‡æ¡£æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯æ”¹æˆäº†å›½å†…çš„è½¯ä»¶æºã€‚

**æ³¨æ„åœ¨ä½¿ç”¨ `apt install` çš„æ—¶å€™ï¼Œåº”è¯¥æ˜ç¡®æŒ‡å®šè¦å®‰è£…çš„ç‰ˆæœ¬å·**ï¼Œåƒè¿™é‡Œæˆ‘å°±ä½¿ç”¨çš„æ˜¯Kubernetes 1.23.3ï¼Œå¦‚æœä¸æŒ‡å®šå°±ä¼šä½¿ç”¨å½“å‰çš„æœ€æ–°ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯1.24ã€‚

å®‰è£…å®Œæˆä¹‹åï¼Œæˆ‘ä»¬ç”¨ `kubeadm version`ã€`kubectl version` æ¥çœ‹ä¸€ä¸‹ç‰ˆæœ¬æ˜¯å¦æ­£ç¡®ï¼š

```plain
kubeadm version
kubectl version --client
```

å¯ä»¥çœ‹åˆ°ç¡®å®æ˜¯å®‰è£…äº†æˆ‘ä»¬åˆšæ‰æŒ‡å®šçš„1.23.3ç‰ˆæœ¬ã€‚

* * *

### äºŒ. å®‰è£…Kubernetes

æœ‰äº†kubeadmï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹æ­£å¼å®‰è£…Kubernetesäº†ã€‚å®‰è£…æ—¶éœ€è¦ä»gcr.ioæ‹‰å–é•œåƒï¼Œæˆ‘è¿™é‡Œä»å›½å†…é•œåƒç½‘ç«™ä¸Šæå‰ä¸‹è½½å¥½äº†é•œåƒï¼Œç»™ä½ çœ‹ä¸€ä¸‹ï¼š

```plain
docker images
```

è¿™äº›é•œåƒä¸­åŒ…æ‹¬Kubernetesçš„æ ¸å¿ƒç»„ä»¶ï¼Œæ¯”å¦‚etcdã€apiserverã€controller-managerã€‚

ç°åœ¨æˆ‘ä»¬æ¥æ‰§è¡Œ `kubeadm init` åˆå§‹åŒ–MasterèŠ‚ç‚¹ï¼Œçœ‹ä¸€ä¸‹è„šæœ¬æ–‡ä»¶ï¼š

```plain
vi master.sh
```

åˆå§‹åŒ–çš„æ—¶å€™æˆ‘ä½¿ç”¨äº†å‚æ•° `pod-network-cidr` æŒ‡å®šPodçš„IPåœ°å€èŒƒå›´æ˜¯â€œ10.10.0.0/16â€ï¼Œç„¶åKubernetesç‰ˆæœ¬ä¹ŸæŒ‡å®šä½¿ç”¨1.23.3ã€‚

ä¸ºäº†è®©kubectlåœ¨å®‰è£…å®Œæˆåèƒ½æ­£å¸¸å·¥ä½œï¼Œè„šæœ¬é‡Œè¿˜ä¼šæŠŠKubernetesçš„é…ç½®æ–‡ä»¶æ‹·è´åˆ°å½“å‰ç”¨æˆ·çš„ `.kube` ç›®å½•ä¸‹ã€‚

å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å°±è¿è¡Œè¿™ä¸ªè„šæœ¬ã€‚

æ³¨æ„MasterèŠ‚ç‚¹åˆå§‹åŒ–å®Œæˆåï¼Œkubeadmä¼šç»™å‡ºä¸€äº›é‡è¦çš„æç¤ºä¿¡æ¯ï¼Œä¸€ä¸ªæ˜¯æ‹·è´é…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªæˆ‘ä»¬å·²ç»åœ¨è„šæœ¬é‡Œåšè¿‡äº†ï¼Œ**å¦ä¸€ä¸ªæ˜¯WorkerèŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„ `kubeadm join` å‘½ä»¤ï¼Œä¸€å®šè¦ä¿å­˜å¥½ã€‚æˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œæ¯”å¦‚k.txtï¼Œç„¶åæŠŠå®ƒå­˜ä¸‹æ¥ã€‚**

æˆ‘ä»¬å†ç”¨ `kubectl version`ã€`kubectl get node` æ¥æ£€æŸ¥Kubernetesçš„ç‰ˆæœ¬å’Œé›†ç¾¤çš„èŠ‚ç‚¹çŠ¶æ€äº†ï¼š

```plain
kubectl version
kubectl get node
```

MasterèŠ‚ç‚¹çš„çŠ¶æ€æ˜¯â€œNotReadyâ€ï¼Œæ¥ä¸‹æ¥è¿˜è¦å®‰è£…ç½‘ç»œæ’ä»¶Flannelã€‚

Flannelçš„å®‰è£…å¾ˆç®€å•ï¼Œè®°å¾—è¦ä¿®æ”¹å®ƒçš„YAMLæ–‡ä»¶ï¼Œâ€œ**net-conf.json**â€é‡Œçš„ç½‘ç»œèŒƒå›´å¿…é¡»å’Œ `kubeadm init` é‡Œçš„ä¸€æ ·ï¼š

```plain
vi flannel.yml
```

ç°åœ¨æˆ‘ä»¬ç”¨ `kubectl apply` æ¥å®‰è£…Flannelç½‘ç»œï¼š

```plain
kubectl apply -f kube-flannel.yml
```

ç¨ç­‰ä¸€å°ä¼šï¼Œæˆ‘ä»¬å†æ‰§è¡Œ `kubectl get node` æ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼š

```plain
kubectl get node
```

å°±çœ‹åˆ°MasterèŠ‚ç‚¹çš„çŠ¶æ€æ˜¯â€œReadyâ€ï¼Œè¡¨æ˜èŠ‚ç‚¹ç½‘ç»œä¹Ÿå·¥ä½œæ­£å¸¸äº†ã€‚

* * *

### ä¸‰. Kubernetesé›†ç¾¤éƒ¨ç½²

WorkerèŠ‚ç‚¹çš„å®‰è£…æ­¥éª¤å’ŒMasterèŠ‚ç‚¹æ˜¯å·®ä¸å¤šçš„ï¼Œå…ˆæ˜¯æ”¹ä¸»æœºåï¼Œå†ç”¨prepare.shåšå‡†å¤‡å·¥ä½œï¼Œä¿®æ”¹Dockeré…ç½®æ–‡ä»¶ã€iptablesï¼Œå…³é—­Linuxçš„swapåˆ†åŒºï¼Œç„¶åä¸‹è½½kubeadmå¯æ‰§è¡Œæ–‡ä»¶å’ŒKubernetesé•œåƒã€‚

è¿™å‡ æ­¥å’ŒMasterèŠ‚ç‚¹å®Œå…¨ä¸€æ ·ï¼Œæˆ‘å°±ä¸å±•ç¤ºè„šæœ¬æ–‡ä»¶äº†ï¼Œç›´æ¥è¿è¡Œã€‚

æœ‰äº†kubeadmä¹‹åï¼Œå› ä¸ºè¿™ä¸ªæ˜¯WorkerèŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦æ‰§è¡Œ `kubeadm init`ï¼Œ**è€Œæ˜¯è¦æ‰§è¡Œ `kubeadm join`ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰å®‰è£…MasterèŠ‚ç‚¹æ—¶æ‹·è´çš„é‚£æ¡å‘½ä»¤**ã€‚å®ƒä¼šè‡ªåŠ¨è¿æ¥MasterèŠ‚ç‚¹ï¼Œç„¶åæ‹‰å–é•œåƒï¼Œå®‰è£…ç½‘ç»œæ’ä»¶ï¼Œæœ€åæŠŠèŠ‚ç‚¹åŠ å…¥é›†ç¾¤ã€‚

WorkerèŠ‚ç‚¹å®‰è£…å¥½ä¹‹åï¼Œè®©æˆ‘ä»¬åœ¨æ§åˆ¶å°æ£€æŸ¥èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œæ‰§è¡Œ `kubectl get node`ï¼Œä¼šçœ‹åˆ°ä¸¤ä¸ªèŠ‚ç‚¹éƒ½æ˜¯â€œReadyâ€ã€‚

ç°åœ¨è®©æˆ‘ä»¬ç”¨ `kubectl run`ï¼Œè¿è¡ŒNginxæ¥æµ‹è¯•ä¸€ä¸‹ï¼š

```plain
kubectl run ngx --image=nginx:alpine
kubectl get pod -o wide
```

ä¼šçœ‹åˆ°Podè¿è¡Œåœ¨WorkerèŠ‚ç‚¹ä¸Šï¼Œè¡¨æ˜æˆ‘ä»¬çš„Kuberneteså¤šèŠ‚ç‚¹é›†ç¾¤éƒ¨ç½²æˆåŠŸã€‚

* * *

### å››. Deploymentçš„ä½¿ç”¨

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹Deploymentçš„ç”¨æ³•ã€‚

é¦–å…ˆæ˜¯ `kubectl api-resources` æ¥æŸ¥çœ‹Deploymentçš„åŸºæœ¬ä¿¡æ¯ï¼š

```plain
kubectl api-resources | grep deploy
```

å¯ä»¥çœ‹åˆ°Deploymentçš„ç®€ç§°æ˜¯â€œ**deploy**â€ï¼Œå®ƒçš„apiVersionæ˜¯â€œ**apps/v1**â€ï¼Œkindæ˜¯â€œ**Deployment**â€ã€‚

ç„¶åæˆ‘ä»¬æ‰§è¡Œ `kubectl create`ï¼Œè®©Kubernetesä¸ºæˆ‘ä»¬è‡ªåŠ¨ç”ŸæˆDeploymentçš„æ ·æ¿æ–‡ä»¶ã€‚

å…ˆè¦å®šä¹‰ä¸€ä¸ªç¯å¢ƒå˜é‡out:

```plain
export out="--dry-run=client -o yaml"
```

ç„¶ååˆ›å»ºåå­—å«â€œngx-depâ€çš„å¯¹è±¡ï¼Œä½¿ç”¨çš„é•œåƒæ˜¯â€œnginx:alpineâ€ï¼š

```plain
kubectl create deploy ngx-dep --image=nginx:alpine $out
```

æˆ‘ä»¬æŠŠè¿™ä¸ªæ ·æ¿å­˜å…¥ä¸€ä¸ªæ–‡ä»¶ngx.ymlï¼š

```plain
kubectl create deploy ngx-dep --image=nginx:alpine $out > deploy.yml
```

è¿™é‡Œå¯ä»¥åˆ é™¤ä¸€äº›ä¸éœ€è¦çš„å­—æ®µï¼Œè®©YAMLçœ‹èµ·æ¥æ›´å¹²å‡€ï¼Œç„¶åæŠŠreplicasæ”¹æˆ2ï¼Œæ„æ€æ˜¯å¯åŠ¨ä¸¤ä¸ªNginx Podã€‚

æŠŠDeploymentçš„YAMLå†™å¥½ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ `kubectl apply` æ¥åˆ›å»ºå¯¹è±¡äº†ï¼š

```plain
kubectl apply -f deploy.yml
```

ç”¨ `kubectl get` å‘½ä»¤æŸ¥çœ‹Deploymentçš„çŠ¶æ€ï¼š

```plain
kubectl get deploy
kubectl get pod
```

æœ€åæ¥è¯•éªŒä¸€ä¸‹Deploymentçš„åº”ç”¨ä¼¸ç¼©åŠŸèƒ½ï¼Œä½¿ç”¨å‘½ä»¤ `kubectl scale`ï¼ŒæŠŠPodæ•°é‡æ”¹æˆ5ä¸ªï¼š

```plain
kubectl scale --replicas=5 deploy ngx-dep
```

æˆ‘ä»¬å†ç”¨ `kubectl get` å‘½ä»¤æŸ¥çœ‹ï¼Œå°±ä¼šå‘ç°Podå·²ç»æˆåŠŸå˜æˆäº†5ä¸ªå‰¯æœ¬ï¼š

```plain
kubectl get pod 
```

æœ€ååˆ é™¤è¿™ä¸ªDeploymentï¼š

```plain
kubectl delete deploy ngx-dep
```

* * *

### äº”. DaemonSetçš„ä½¿ç”¨

çœ‹å®ŒDeploymentï¼Œæˆ‘å†æ¥æ¼”ç¤ºDaemonSetã€‚

å› ä¸ºDaemonSetä¸èƒ½ä½¿ç”¨ `kubectl create` ç›´æ¥ç”Ÿæˆæ ·æ¿æ–‡ä»¶ï¼Œä½†å¤§ä½“ç»“æ„å’ŒDeploymentæ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆç”Ÿæˆä¸€ä¸ªDeploymentï¼Œç„¶åå†ä¿®æ”¹å‡ ä¸ªå­—æ®µå°±è¡Œäº†ã€‚

è¿™é‡Œæˆ‘ä½¿ç”¨äº†**Linuxç³»ç»Ÿé‡Œå¸¸ç”¨çš„å°å·¥å…·sedï¼Œç›´æ¥æ›¿æ¢Deploymenté‡Œçš„åå­—**ï¼Œå†åˆ é™¤replicaså­—æ®µï¼Œè¿™æ ·å°±è‡ªåŠ¨ç”Ÿæˆäº†DaemonSetçš„æ ·æ¿æ–‡ä»¶ï¼š

```plain
kubectl create deploy redis-ds --image=redis:5-alpine $out \
Â  | sed 's/Deployment/DaemonSet/g' - \
Â  | sed -e '/replicas/d' -
```

è¿™ä¸ªæ ·æ¿æ–‡ä»¶å› ä¸ºæ˜¯ä»Deploymentæ”¹æ¥çš„ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰tolerationså­—æ®µï¼Œä¸èƒ½åœ¨MasterèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œéœ€è¦æ‰‹å·¥æ·»åŠ ã€‚

ä¸‹é¢è¿™ä¸ªå°±æ˜¯å·²ç»æ”¹å¥½çš„å®Œæ•´çš„DaemonSet YAMLæè¿°æ–‡ä»¶ï¼š

```plain
vi ds.yml
```

æ³¨æ„çœ‹é‡Œé¢çš„tolerationså­—æ®µï¼Œå®ƒèƒ½å¤Ÿå®¹å¿èŠ‚ç‚¹çš„ `node-role.kubernetes.io/master:NoSchedule` è¿™ä¸ªæ±¡ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´èƒ½å¤Ÿè¿è¡Œåœ¨MasterèŠ‚ç‚¹ä¸Šã€‚

ç°åœ¨è®©æˆ‘ä»¬éƒ¨ç½²è¿™ä¸ªåŠ ä¸Šäº†â€œå®¹å¿åº¦â€çš„DaemonSetï¼š

```plain
kubectl apply -f ds.yml
```

å†ç”¨ `kubectl get` æŸ¥çœ‹å¯¹è±¡çš„çŠ¶æ€ï¼š

```plain
kubectl get ds
kubectl get pod -o wide
```

å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªRedis çš„DaemonSetå·²ç»è·‘åœ¨äº†Masterå’ŒWorkerèŠ‚ç‚¹ä¸Šã€‚

æœ€ååˆ é™¤è¿™ä¸ªDaemonSetï¼š

```plain
kubectl delete -f ds.yml
```

* * *

### å…­. Serviceçš„ä½¿ç”¨

ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹Kubernetesé‡Œçš„è´Ÿè½½å‡è¡¡å¯¹è±¡Serviceã€‚

å› ä¸ºServiceå¯¹è±¡æœåŠ¡äºPodã€Deploymentç­‰å¯¹è±¡ï¼Œæ‰€ä»¥åœ¨åˆ›å»ºå®ƒä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªDeploymentï¼š

```plain
kubectl apply -f deploy.yml
```

è¿™ä¸ªDeploymentç®¡ç†äº†ä¸¤ä¸ªNginx Podï¼š

```plain
kubectl get pod -o wide
```

ç„¶åæˆ‘ä»¬æˆ‘ä»¬ä½¿ç”¨ `kubectl expose` åˆ›å»ºServiceæ ·æ¿æ–‡ä»¶ï¼š

```plain
kubectl expose deploy ngx-dep --port=80 --target-port=80 $out
```

ä¿®æ”¹ä¹‹åå°±æ˜¯svc.ymlï¼Œå†ç”¨ `kubectl apply` åˆ›å»ºServiceå¯¹è±¡ï¼š

```plain
kubectl apply -f svc.yml
```

ç”¨ `kubectl get svc` å¯ä»¥åˆ—å‡ºServiceå¯¹è±¡ï¼Œå¯ä»¥çœ‹åˆ°å®ƒçš„è™šIPåœ°å€ï¼š

```plain
kubectl get svc
```

æƒ³è¦çœ‹Serviceä»£ç†äº†å“ªäº›åç«¯çš„Podï¼Œè¦ç”¨ `kubectl describe` å‘½ä»¤ï¼š

```plain
kubectl describe svc ngx-svc
```

ç”¨ `kubectl get pod` å¯ä»¥å¯¹æ¯”éªŒè¯Serviceæ˜¯å¦æ­£ç¡®ä»£ç†äº†Nginx Podï¼š

```plain
kubectl get pod -o wide
```

ç°åœ¨è®©æˆ‘ä»¬ç”¨ `kubectl exec` è¿›å…¥Podï¼ŒéªŒè¯Serviceçš„åŸŸååŠŸèƒ½ï¼š

```plain
kubectl exec -it ngx-dep-6796688696-4h6lb -- sh
```

ä½¿ç”¨curlï¼ŒåŠ ä¸ŠåŸŸåâ€œngx-svcâ€ï¼Œä¹Ÿå°±æ˜¯Serviceå¯¹è±¡çš„åå­—ï¼š

```plain
curl ngx-svc
```

å¤šæ‰§è¡Œå‡ æ¬¡ï¼Œå°±ä¼šçœ‹åˆ°é€šè¿‡è¿™ä¸ªåŸŸåï¼ŒServiceå¯¹è±¡å®ç°äº†å¯¹åç«¯Podçš„è´Ÿè½½å‡è¡¡ï¼ŒæŠŠæµé‡åˆ†å‘åˆ°ä¸åŒçš„Podã€‚

æˆ‘ä»¬è¿˜å¯ä»¥å†å°è¯•Serviceçš„å…¶ä»–åŸŸåå½¢å¼ï¼Œæ¯”å¦‚åŠ ä¸Šåå­—ç©ºé—´ï¼š

```plain
curl ngx-svc.default
curl ngx-svc.default.svc.cluster.local
```

æœ€åçœ‹ä¸€ä¸‹Serviceä½¿ç”¨NodePortæ–¹å¼å¯¹å¤–æš´éœ²æœåŠ¡çš„ç”¨æ³•ï¼Œçœ‹ä¸€ä¸‹Serviceå¯¹è±¡ï¼š

```plain
kubectl get svc
```

åœ¨PORTé‡Œæ˜¾ç¤ºå®ƒåˆ†é…äº†ä¸€ä¸ªéšæœºçš„ç«¯å£å·31980ï¼Œåªè¦è®¿é—®é›†ç¾¤é‡Œä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒåŠ ä¸Šè¿™ä¸ªç«¯å£å·ï¼Œå°±å¯ä»¥è®¿é—®åˆ°Serviceå¯¹è±¡å’Œå®ƒåé¢çš„Podã€‚

æˆ‘ä»¬æ¥è¯•éªŒä¸€ä¸‹ï¼Œæ³¨æ„210æ˜¯MasterèŠ‚ç‚¹ï¼Œ220æ˜¯WorkerèŠ‚ç‚¹ï¼š

```plain
curl 192.168.10.210:31980
curl 192.168.10.220:31980
```

æœ€ååˆ é™¤Deploymentå’ŒServiceå¯¹è±¡ï¼š

```plain
kubectl delete -f deploy.yml
kubectl delete -f svc.yml
```

* * *

### ä¸ƒ. Ingressçš„ä½¿ç”¨

å­¦ä¹ äº†Serviceä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹ç®¡ç†é›†ç¾¤å…¥å£æµé‡çš„Ingresså¯¹è±¡ã€‚

æˆ‘ä»¬ä½¿ç”¨Nginxå…¬å¸å¼€å‘çš„Ingress Controllerï¼Œéœ€è¦æŒ‰ç…§å®ƒçš„æ–‡æ¡£ï¼Œåˆ›å»ºåå­—ç©ºé—´ã€RBACç­‰ç›¸å…³çš„èµ„æºï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨ä¸€ä¸ªç®€å•è„šæœ¬æ¥å®Œæˆï¼š

```plain
cat setup.sh
./setup.sh
```

ä½¿ç”¨å‘½ä»¤ `kubectl get ns` å¯ä»¥çœ‹åˆ°å·²ç»æœ‰äº†ä¸€ä¸ªæ–°çš„åå­—ç©ºé—´ `nginx-ingress`ã€‚

ä¸ºäº†æµ‹è¯•éªŒè¯Ingresså’ŒIngress controllerçš„ç”¨æ³•ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦å…ˆåˆ›å»ºDeploymentå’ŒServiceå¯¹è±¡ï¼š

```plain
kubectl apply -f deploy.yml
kubectl apply -f svc.yml
```

æ¥çœ‹ä¸€ä¸‹Ingressçš„å®šä¹‰ï¼š

```plain
vi ingress.yml
```

è¿™ä¸ªYAMLé‡ŒåŒ…å«äº†ä¸¤ä¸ªAPIå¯¹è±¡ï¼Œç¬¬ä¸€ä¸ªæ˜¯Ingress Classï¼Œåå­—æ˜¯ngx-inkï¼Œæ³¨æ„åœ¨specé‡Œï¼Œcontrollerè¦æŒ‡å®šæˆNginx Ingress Controllerã€‚

ç¬¬äºŒä¸ªå¯¹è±¡å°±æ˜¯è·¯ç”±è§„åˆ™å¯¹è±¡Ingressäº†ï¼Œæˆ‘ä¸ºå®ƒæ·»åŠ äº†ä¸€ä¸ªæ³¨è§£nginx.org/lb-methodï¼ŒæŒ‡å®šä½¿ç”¨Round-Robinè´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œç„¶åæ˜¯å…³é”®å­—æ®µingressClassNameï¼Œè¿™æ ·å°±å¯ä»¥æŠŠIngresså’ŒIngress Classè”ç³»èµ·æ¥ã€‚

åé¢çš„ruleså°±æ˜¯å…·ä½“çš„è·¯ç”±è§„åˆ™ï¼Œæ¯”è¾ƒå¤æ‚ï¼Œè¦æŒ‡å®šhostã€pathï¼Œè¿˜æœ‰åç«¯è¦è½¬å‘çš„Serviceï¼Œ**æœ€å¥½ç”¨kubectl createæ¥è‡ªåŠ¨ç”Ÿæˆï¼Œä¸ç„¶å¾ˆå®¹æ˜“å†™é”™**ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹Ingress Controllerçš„å®šä¹‰ï¼Œå®ƒåœ¨kic YAML é‡Œï¼š

```plain
vi kic.yml
```

å®ƒå…¶å®æ˜¯ä»Nginxå®˜æ–¹çš„ç¤ºä¾‹æ–‡ä»¶ä¿®æ”¹è€Œæ¥çš„ï¼Œæ‰€ä»¥åªéœ€è¦å…³æ³¨å‡ ä¸ªåœ°æ–¹ã€‚

ç¬¬ä¸€ä¸ªæ˜¯é•œåƒï¼Œæˆ‘æ”¹æˆäº†æ›´ç²¾ç®€çš„Alpineç‰ˆæœ¬ï¼Œ**ç¬¬äºŒä¸ªæ˜¯å¯åŠ¨å‚æ•°argsï¼Œä¸€å®šè¦åŠ ä¸Š-ingress-classï¼Œå…³è”ä¸Šåˆšæ‰çš„Ingress Classå¯¹è±¡**ï¼Œå¦åˆ™Ingress Controllerå°±æ— æ³•æ‰¾åˆ°è·¯ç”±è§„åˆ™Ingressã€‚

å®ƒåé¢è¿˜æœ‰å‡ ä¸ªå‚æ•°ï¼Œæ¯”å¦‚-health-statusã€-ready-statusç­‰ç­‰ï¼Œä½ å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£äº†è§£å®ƒä»¬çš„ä½œç”¨ã€‚

ç°åœ¨æˆ‘ä»¬å°±åº”ç”¨è¿™ä¸¤ä¸ªYAML æ–‡ä»¶ï¼Œåˆ›å»ºIngresså¯¹è±¡ï¼š

```plain
kubectl apply -f ingress.yml
kubectl apply -f kic.yml
```

ç”¨ `kubectl get` æ¥é€ä¸ªæŸ¥çœ‹è¿™äº›å¯¹è±¡çš„çŠ¶æ€ï¼š

```plain
kubectl get ingressclass
kubectl get ing
kubectl describe ing ngx-ing

kubectl get deploy -n nginx-ingress
kubectl get pod -n nginx-ingress
```

ç¡®è®¤å®ƒä»¬éƒ½å·¥ä½œæ­£å¸¸ï¼Œæˆ‘ä»¬æ¥åšä¸ªæµ‹è¯•ï¼ŒæŠŠæœ¬åœ°çš„8080ç«¯å£æ˜ å°„åˆ°Ingress Controller Podçš„80ç«¯å£ï¼š

```plain
kubectl port-forward -n nginx-ingress ngx-kic-dep-8859b7b86-cplgp 8080:80 &
```

å› ä¸ºåœ¨Ingressé‡Œæˆ‘ä»¬è®¾å®šçš„è·¯ç”±è§„åˆ™æ˜¯ngx.teståŸŸåï¼Œæ‰€ä»¥è¦ç”¨curlçš„resolveå‚æ•°æ¥æŠŠå®ƒå¼ºåˆ¶è§£æåˆ°127.0.0.1ï¼š

```plain
curl --resolve ngx.test:8080:127.0.0.1 http://ngx.test:8080
```

å¤šæ‰§è¡Œå‡ æ¬¡ï¼Œä½ å°±ä¼šå‘ç°Nginx Ingress Controlleré€šè¿‡åŸŸåè·¯ç”±è§„åˆ™ï¼ŒæŠŠè¯·æ±‚è½¬å‘åˆ°äº†ä¸åŒçš„åç«¯Podã€‚

æœ€åæˆ‘ä»¬åˆ é™¤åˆšæ‰åˆ›å»ºçš„è¿™äº›Deploymentã€Serviceã€Ingressç­‰å¯¹è±¡ï¼š

```plain
kubectl delete -f deploy.yml
kubectl delete -f svc.yml
kubectl delete -f ingress.yml
kubectl delete -f kic.yml
```

* * *

### å…«. æ­å»ºWordPressç½‘ç«™

è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯æ¥æ­å»ºWordPressç½‘ç«™ï¼Œå®é™…æ“ä½œDeploymentã€Serviceã€Ingressè¿™äº›å¯¹è±¡çš„ç”¨æ³•ã€‚

ç¬¬ä¸€æ­¥æ˜¯éƒ¨ç½²MariaDBï¼š

```plain
wp-maria.yml
```

å®ƒçš„ConfigMapæ²¡æœ‰å˜åŒ–ï¼Œè¿˜æ˜¯â€œDATABASEâ€â€œUSERâ€â€œPASSWORDâ€é‚£å‡ ä¸ªç¯å¢ƒå˜é‡ã€‚ä¸‹é¢çš„éƒ¨ç½²æ–¹å¼æ”¹æˆäº†Deploymentï¼Œç®€å•èµ·è§åªä½¿ç”¨ä¸€ä¸ªå®ä¾‹ã€‚ä¹‹ååˆä¸ºå®ƒå®šä¹‰äº†ä¸€ä¸ªServiceå¯¹è±¡ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨åŸŸåè€Œä¸æ˜¯IPåœ°å€æ¥è®¿é—®æ•°æ®åº“ã€‚

ç¬¬äºŒæ­¥æ˜¯éƒ¨ç½²WordPressåº”ç”¨ï¼š

```plain
vi wp-dep.yml
```

**æ³¨æ„åœ¨ConfigMapé‡Œæˆ‘ä»¬ä¸å†ä½¿ç”¨å›ºå®šIPåœ°å€äº†ï¼Œè€Œæ˜¯æ”¹ç”¨äº†Serviceæä¾›çš„åŸŸåmaria-svcã€‚**ç„¶ååœ¨Deploymenté‡Œï¼ŒæŠŠWordPresså®ä¾‹è®¾ç½®ä¸º2ï¼Œå¢åŠ äº†å†—ä½™åº¦ï¼Œæé«˜äº†å¯ç”¨æ€§ã€‚ä¹‹åæˆ‘ä»¬è¿˜æ˜¯ä¸ºå®ƒå®šä¹‰äº†Serviceå¯¹è±¡ï¼Œå¹¶ä¸”è®¾ç½®ä¸ºNodePortæ¨¡å¼ï¼ŒæŒ‡å®šä½¿ç”¨ç«¯å£30088ã€‚

ç¬¬ä¸‰æ­¥æ˜¯éƒ¨ç½²Ingressï¼š

```plain
vi wp-ing.yml
```

Ingressçš„å®šä¹‰å’Œä¹‹å‰å·®ä¸å¤šï¼Œä½†Ingress Classçš„åå­—æ”¹æˆäº†wp-inkï¼ŒIngressè·¯ç”±çš„hostæ”¹æˆäº†wp.testã€‚

Ingress Controllerçš„å˜åŒ–ä¹Ÿä¸å¤§ï¼š

```plain
vi wp-kic.yml
```

**å…³é”®è¿˜æ˜¯argsé‡Œçš„å‚æ•°-ingress-classï¼Œå¿…é¡»å’ŒIngress ClassåŒ¹é…ï¼Œä¹Ÿå°±æ˜¯wp-ink**ã€‚è¿˜æœ‰å°±æ˜¯å­—æ®µhostNetwork: trueï¼Œè®©Podç›´æ¥ä½¿ç”¨èŠ‚ç‚¹çš„ç½‘ç»œ

çœ‹å®Œäº†è¿™äº›YAML ï¼Œè®©æˆ‘ä»¬ç”¨kubectl applyæ¥åˆ›å»ºå¯¹è±¡ï¼š

```plain
kubectl applyÂ -f wp-maria.yml
kubectl applyÂ -f wp-dep.yml
kubectl applyÂ -f wp-ing.yml
kubectl applyÂ -f wp-kic.yml
```

åˆ›å»ºå®Œæˆä¹‹åï¼Œæˆ‘ä»¬å†ç”¨kubectl getçœ‹ä¸€ä¸‹å¯¹è±¡çš„çŠ¶æ€ï¼š

```plain
kubectl get deploy
kubectl get svc
kubectl get pod -n nginx-ingress
```

ç°åœ¨è®©æˆ‘ä»¬æ¥åˆ°é›†ç¾¤ä¹‹å¤–ï¼Œå‡è®¾ä½ å·²ç»ä¿®æ”¹äº†æœ¬åœ°çš„hostsåŸŸåè§£ææ–‡ä»¶ï¼ŒæŠŠåŸŸåwp.testè§£æåˆ°Kubernetesçš„èŠ‚ç‚¹ï¼Œé‚£å°±å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨é‡Œè¾“å…¥[http://wp.test](http://wp.test)æ¥è®¿é—®Nginx Ingress Controllerï¼Œå†è®¿é—®WordPressç½‘ç«™äº†ã€‚

## è¯¾åä½œä¸š

å¦‚æœä½ åœ¨æ“ä½œè¿‡ç¨‹ä¸­é‡åˆ°å›°éš¾ï¼Œæ¬¢è¿åœ¨ç•™è¨€åŒºç•™è¨€ï¼Œè®°å¾—æŠŠä½ çš„é—®é¢˜æè¿°æ¸…æ¥šï¼Œè¿™æ ·æˆ‘å’Œå…¶ä»–åŒå­¦ä¹Ÿèƒ½æ›´å¥½åœ°å°±é—®é¢˜è¯¦ç»†è®¨è®ºã€‚

å¸Œæœ›ä½ åœ¨è¿™æ®µæ—¶é—´çš„å­¦ä¹ è¿‡ç¨‹ä¸­æœ‰æ‰€æ”¶è·ï¼Œä¸‹èŠ‚è¯¾å°±æ˜¯æœ€åçš„é«˜çº§ç¯‡äº†ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ15ï¼‰</strong></div><ul>
<li><span>YueShi</span> ğŸ‘ï¼ˆ10ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>1ã€æ¨èä¹‹å‰çš„è¯¾ç¨‹å…¨éƒ½è‡ªå·±å®Œæˆä¸€éï¼Œç„¶ååœ¨çœ‹è¿™ä¸ªå®æˆ˜è§†é¢‘ï¼Œå°±æœ‰ç‚¹æŸ¥æ¼è¡¥ç¼ºçš„å‘³é“äº†ï¼Œçœ‹çš„å¾ˆè½»æ¾
2ã€å…³äºæ¥¼ä¸ŠåŒå­¦â€œæŒ‰é“ç†åº”è¯¥æ˜¯è¿›å…¥Serviceâ€çš„å›°æƒ‘ï¼Œæœ‰æ„Ÿï¼ŒK8Sçš„åŸºæœ¬æ€æƒ³å°±æ˜¯ç»„åˆå’Œé€‚é…å™¨æ¨¡å¼ï¼Œåœ¨k8sé‡Œæ„Ÿè§‰ä¸‡ç‰©çš†å¯ç»„åˆï¼Œå¦‚æœä¸èƒ½æ»¡è¶³ï¼ŒåŸºäºç°æœ‰çš„apiåœ¨é€‚é…å‡ºä¸€ä¸ªapiå‡ºæ¥ï¼Œç»„åˆå’Œé€‚é…åœ¨k8sé‡Œæ˜¯äº’é€†çš„
3ã€åŒå¿—ä»¬ç»§ç»­å­¦å‘€ï¼Œåœ¨åšæŒå­¦ä¸€èŠ‚ï¼Œå°±ç”©æ‰äº†å¾ˆå¤šäººï¼ŒåŠ æ²¹ğŸ’ªğŸ’ªğŸ’ªğŸ’ª</p>2022-08-14</li><br/><li><span>å°æ±Ÿçˆ±å­¦æœ¯</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆé—®ä¸ªé—®é¢˜å‘€

kubectl get deploy
kubectl get svc
kubectl get pod -n nginx-ingress

ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºåº”ç”¨çš„deployä»¥åŠsvcæ˜¯åœ¨defaultå‘½åç©ºé—´ä¸‹çš„ï¼Œingressæ˜¯åœ¨è‡ªå·±çš„nginx-ingresså‘½åç©ºé—´ä¸‹ï¼Œä»–ä»¬åœ¨k8sä¸­ä¸å±äºä¸€ä¸ªå‘½åç©ºé—´ã€‚ä½†æ˜¯åœ¨ingress ruleçš„é…ç½®é‡Œï¼Œå…³äºbackendçš„é…ç½®ç›´æ¥ç”¨çš„serviceçš„åå­—ï¼Œæ˜¯å› ä¸ºå¦‚æœè¿™é‡Œä¸æä¾›å…·ä½“çš„å‘½åç©ºé—´çš„åå­—ï¼Œä»–ä¼šè‡ªåŠ¨è®¤ä¸ºæ˜¯defaultå—ã€‚è°¢è°¢ã€‚</p>2022-10-08</li><br/><li><span>èŠ±èŠ±å¤§è„¸çŒ«</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>é‡åˆ°ä¸ªå¥‡æ€ªçš„é—®é¢˜ï¼Œåœ¨nodeèŠ‚ç‚¹æ‰§è¡Œkubeadm joinçš„æ—¶å€™ï¼Œéƒ½ä¼šå¡æ­»ï¼Œç„¶åé€šè¿‡--v=5ï¼Œå‘ç°è¿æ¥masterä¸€ç›´æ‹’ç»ï¼šI0816 23:05:48.343080    5359 token.go:217] [discovery] Failed to request cluster-info, will try again: Get &quot;https:&#47;&#47;10.0.3.15:6443&#47;api&#47;v1&#47;namespaces&#47;kube-public&#47;configmaps&#47;cluster-info?timeout=10s&quot;: dial tcp 10.0.3.15:6443: connect: connection refusedï¼Œçœ‹è§£å†³æ–¹æ¡ˆæœ‰è¯´åœ¨kubeadm initçš„æ—¶å€™éœ€è¦æŒ‡å®šï¼ˆ108æ˜¯æˆ‘nodeèŠ‚ç‚¹çš„è™šæ‹ŸæœºIPï¼‰--apiserver-cert-extra-sans 192.168.56.108 --apiserver-advertise-address 192.168.56.108 \ï¼Œå‡Œä¹±äº†</p>2022-08-16</li><br/><li><span>ç‰™å°æœ¨</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>å¦‚æœå¿˜äº†äº†masterçš„join ä¿¡æ¯ä¹Ÿæ²¡å…³ç³»ï¼Œå¯ä»¥æ‰§è¡Œ 
kubeadm token create --print-join-command
å¦‚æœæ²¡æœ‰ä¿¡æ¯ï¼Œæˆ–è€…è¿‡æœŸäº†ï¼Œå¯ä»¥æ‰§è¡Œ
kubeadm token create</p>2023-07-28</li><br/><li><span>peter</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>è¯·æ•™è€å¸ˆå‡ ä¸ªé—®é¢˜ï¼š
Q1ï¼šâ€œkubeadm joinâ€å‘½ä»¤é‡Œçš„tokençš„æ—¶æ•ˆæ€§æ²¡æœ‰èµ·ä½œç”¨ã€‚
è®²kubeadmçš„æ—¶å€™ï¼Œæåˆ°ï¼šâ€œkubeadm joinâ€å‘½ä»¤é‡Œçš„tokenæœ‰æ—¶æ•ˆæ€§ï¼Œé»˜è®¤æ˜¯24å°æ—¶ã€‚
ä½†æ˜¯ï¼Œæˆ‘çš„é›†ç¾¤ç¯å¢ƒåˆ›å»ºæˆåŠŸåï¼Œmasterè™šæ‹Ÿæœºå¯åŠ¨åk8sè‡ªåŠ¨è¿è¡Œï¼Œworkerè™šæ‹Ÿæœºå¯åŠ¨åè‡ªåŠ¨
è¿æ¥åˆ°masterï¼Œä¸€ä¸ªå¤šæ˜ŸæœŸäº†è¿˜æ˜¯è¿™æ ·ï¼Œå¥½åƒtokenæ°¸è¿œä¸ä¼šè¿‡æœŸï¼Œä¸ºä»€ä¹ˆï¼Ÿ

Q2ï¼šæ˜¯å¦éœ€è¦æ¸…ç†ç¯å¢ƒï¼Œæœ‰ä¸€é”®æ¸…é™¤çš„å‘½ä»¤å—ï¼Ÿ
è€å¸ˆçš„è§†é¢‘ï¼Œæ¯ä¸€ä¸ªè§†é¢‘çš„ç¯å¢ƒéƒ½æ˜¯å¹²å‡€çš„ï¼Œå’Œå…¶ä»–è§†é¢‘æ— å…³ã€‚
è€Œæˆ‘çš„æ“ä½œä¸æ˜¯è¿™æ ·ã€‚æˆ‘çš„æ“ä½œæ˜¯ï¼šæ¯ä¸€è®²éƒ½åœ¨åŒä¸€ä¸ªé›†ç¾¤ç¯å¢ƒä¸­æ“ä½œï¼Œæ“ä½œä¹‹å‰ä¹Ÿæ²¡æœ‰æ¸…ç†
ä»¥å‰çš„ä¸œè¥¿ï¼Œæ¯”å¦‚ä»¥å‰åˆ›å»ºçš„PODã€deployç­‰éƒ½å­˜åœ¨ã€‚è¿™ç§æ“ä½œæ–¹æ³•ä¸å¥½å§ï¼Œåº”è¯¥æ¸…ç†å§ã€‚

å¦‚æœéœ€è¦æ¸…ç†ï¼Œæœ‰ä¸€é”®æ¸…é™¤çš„å‘½ä»¤å—ï¼Ÿè¿˜æ˜¯éœ€è¦é€ä¸ªåˆ é™¤ï¼Ÿæ¯”å¦‚é€ä¸ªæŸ¥çœ‹cmã€dsã€PODç­‰ã€‚

Q3ï¼šServiceä»£ç†PODåï¼Œç”¨execè¿›å…¥PODï¼Œå†ç”¨curlè®¿é—®ã€‚
è¯·é—®ï¼šä¸ºä»€ä¹ˆæ˜¯è¿›å…¥PODï¼ŒServiceä»£ç†PODï¼ŒæŒ‰é“ç†åº”è¯¥æ˜¯è¿›å…¥Serviceå‘€ã€‚

Q4ï¼šåˆ é™¤serviceçš„æ—¶å€™ï¼Œä¹Ÿå¿…é¡»åˆ é™¤deployå—ï¼Ÿ
è§†é¢‘ä¸­çš„åˆ é™¤æ–¹æ³•æ˜¯ï¼š kubectl delete -f deploy.yml -f svc.ymlï¼Œ
æœ‰ä¸¤ä¸ªå­é—®é¢˜ï¼š
ç¬¬ä¸€ï¼Œè¿™é‡Œçš„deploy.ymlåº”è¯¥æ˜¯å¯¹åº”svc.ymlå§ï¼Œå°±æ˜¯è¯´svc.ymlåˆ›å»ºçš„serviceï¼Œ
ä»£ç†çš„PODæ˜¯ç”±deploy.ymlåˆ›å»ºå‡ºæ¥çš„ï¼Œå¯¹å§ã€‚

å¦å¤–ï¼Œå¯ä»¥åªåˆ é™¤serviceè€Œä¸åˆ é™¤serviceä»£ç†çš„PODå—ï¼Ÿ

Q5ï¼šä¸¤ç§åˆ é™¤æ–¹æ³•éƒ½å¯ä»¥å—ï¼Ÿ
ç¬¬ä¸€ç§ï¼škubectl delete delploy xxx
ç¬¬äºŒç§ï¼škubctl delete -f deploy.yml
ç¬¬ä¸€ç§æ–¹æ³•ä¸­çš„xxxæ˜¯ç¬¬äºŒç§æ–¹æ³•ä¸­çš„ deploy.ymlåˆ›å»ºå‡ºæ¥çš„ã€‚
è¿™ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥å—ï¼Ÿ è€Œä¸”ï¼Œå¥½åƒæ‰€æœ‰çš„å¯¹è±¡éƒ½æœ‰è¿™ä¸¤ç§åˆ é™¤æ–¹æ³•ã€‚</p>2022-08-12</li><br/><li><span>Greenery</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆï¼Œè¿™ä¸ªwp-kicä¸­çš„serviceæ˜¯ä»€ä¹ˆä½œç”¨çš„ï¼Ÿæˆ‘è®¿é—®30080ç«¯å£æ˜¾ç¤ºnginx404...</p>2023-06-25</li><br/><li><span>åƒé¸¡åƒé¸¡</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>å¦‚æœIngress Controllerçš„serviceæ¢æˆäº‘å‚å•†slb&#47;albï¼Œé‚£ä¹ˆå…¥å£æœåŠ¡å‘ç°èƒ½çš„é‡ä»»å°±åœ¨è´Ÿè½½å‡è¡¡äº†</p>2023-04-07</li><br/><li><span>å†œæ°‘å›­ä¸</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>å…«. æ­å»º WordPress ç½‘ç«™ 
è®¿é—®http:&#47;&#47;wp.test&#47;è¿›å…¥å®‰è£…é¡µé¢ï¼Œä½†æ˜¯ä¹‹åç™»å½•æµè§ˆå™¨æ˜¾ç¤ºè·³è½¬åˆ°ä»¥ä¸‹è¿æ¥æ—¶ï¼š
http:&#47;&#47;wp.test&#47;wp-login.php?redirect_to=http%3A%2F%2Fwp.test%2Fwp-admin%2F&amp;reauth=1
æ²¡æœ‰ç™»å½•ï¼Œè¿˜æ˜¯åœåœ¨ç™»å½•ç•Œé¢ï¼Œç”¨æˆ·åå’Œå¯†ç éƒ½è¾“å¯¹äº†ã€‚
è¯·æ•™è¿™æ˜¯ä¸Šé¢é—®é¢˜ï¼Ÿ
è¿˜æœ‰å°±æ˜¯å®¿ä¸»æœºçš„hostså°†wp.hostä¸å…¶ä¸­1ä¸ªèŠ‚ç‚¹ç»‘å®šï¼Œè¿˜æ˜¯ä»»æ„1ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥ï¼Œå®éªŒå‘ç°å¥½åƒåªèƒ½ç»‘å®šå…¶ä¸­1ä¸ªèŠ‚ç‚¹ã€‚</p>2023-01-14</li><br/><li><span>æ— ä¸º</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>è€å¸ˆæ‚¨å¥½, æ‚¨çš„è¯¾ç¨‹éå¸¸çš„æ˜“å­¦.
æˆ‘æœ‰ä¸€ä¸ªé—®é¢˜, æˆ‘æœ¬åœ°çš„ kubeadm å¹¶æ²¡æœ‰ä½¿ç”¨docker images çš„é•œåƒ, æ˜¯æˆ‘æ¼äº†ä»€ä¹ˆæ­¥éª¤å—?</p>2022-12-04</li><br/><li><span>MonsterCale</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>workerèŠ‚ç‚¹kubeadm joinä¹‹åï¼ŒworkerèŠ‚ç‚¹ä¸Škubectl get nodesèƒ½çœ‹åˆ°masterã€workerèŠ‚ç‚¹éƒ½Readyäº†ï¼ŒmasterèŠ‚ç‚¹kubectl get nodesåªèƒ½çœ‹åˆ°masterèŠ‚ç‚¹çœ‹ä¸åˆ°workerèŠ‚ç‚¹ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆ</p>2022-10-09</li><br/><li><span>å¤§å¸ˆå…„</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>å¯¹æ¯”äº†ç›¸å…³gitä¸Šçš„æ–‡ä»¶ï¼Œé‡æ–°å¼„äº†ä¸€æ¬¡ï¼Œè®¿é—® wp.test  è¿”å›é”™è¯¯ä¿¡æ¯:
Error establishing a database connectionï¼Œæ˜¯å¦è¿˜éœ€è¦å…¶ä»–å†…å®¹è°ƒæ•´ï¼Œç›®å‰æ˜¯ç”¨äº†gitä¸Šçš„yamlï¼Œè·Ÿç€è§†é¢‘éƒ¨ç½²äº†ä¸€é</p>2022-09-02</li><br/><li><span>é¾™ä¹‹å¤§è€…</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>workèŠ‚ç‚¹ä¸Šé¢ï¼Œjoinåˆ°é›†ç¾¤æˆåŠŸåï¼Œè¿è¡Œkubectl get nodesï¼ŒæŠ¥é”™å¦‚ä¸‹
Unable to connect to the server: dial tcp 192.168.49.2:8443: connect: no route to host

masterèŠ‚ç‚¹ä¸Šé¢kubectl get nodesï¼Œå¯ä»¥çœ‹åˆ°masterå’Œworkerï¼ŒworkçŠ¶æ€not ready</p>2022-08-17</li><br/><li><span>BROOKS</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ5ï¼‰<p>æœ‰ç”¨ oh my zsh çš„å—ï¼Œåœ¨ ~&#47;.zshrc ä¸­å®šä¹‰äº† export out=&quot;--dry-run=client -o yaml&quot;ï¼Œä½¿ç”¨å‘½ä»¤å¯¼å‡ºæ¨¡æ¿æ—¶ä¼šæç¤ºï¼š
error: Invalid dry-run value (client -o yaml). Must be &quot;none&quot;, &quot;server&quot;, or &quot;client&quot;.</p>2022-08-16</li><br/><li><span>å¢¨é¾™</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è¯·é—®è€å¸ˆï¼Œä¸ºä»€ä¹ˆreplicas=2çš„deploymentåˆ›å»ºç¬¬äºŒä¸ªpodçš„æ—¶å€™é‚£ä¹ˆæ…¢ï¼Œä½†æ˜¯scaleåˆ°replicas=5æ“ä½œæ—¶podå‡ ä¹ç§’æ‰©å®¹åˆ°äº†5ä¸ªï¼Ÿè°¢è°¢</p>2022-08-13</li><br/><li><span>é»˜é»˜ä¸”å¬é£</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è‡ªå·±ç”¨k3sçæäº†ä¸€å¹´å¤šï¼Œå›æ¥å†çœ‹è€å¸ˆè¿™ç¯‡æ–‡ç« æœ‰ç§èŒ…å¡é¡¿å¼€çš„èµ¶è„š</p>2024-05-28</li><br/>
</ul>