ä½ å¥½ï¼Œæˆ‘æ˜¯Chronoã€‚

ç»è¿‡ä¸¤ä¸ªæ˜ŸæœŸçš„å­¦ä¹ ï¼Œåˆ°ä»Šå¤©æˆ‘ä»¬çš„â€œåˆçº§ç¯‡â€ä¹Ÿå¿«è¦ç»“æŸäº†ã€‚

å’Œä¹‹å‰çš„â€œå…¥é—¨ç¯‡â€ä¸€æ ·ï¼Œåœ¨è¿™æ¬¡è¯¾é‡Œï¼Œæˆ‘ä¹Ÿä¼šå¯¹å‰é¢å­¦è¿‡çš„çŸ¥è¯†åšä¸€ä¸ªæ¯”è¾ƒå…¨é¢çš„å›é¡¾ï¼Œæ¯•ç«ŸKubernetesé¢†åŸŸé‡Œæœ‰å¾ˆå¤šæ–°åè¯ã€æ–°æœ¯è¯­ã€æ–°æ¶æ„ï¼ŒçŸ¥è¯†ç‚¹å¤šä¸”æ‚ï¼Œè¿™æ ·çš„æ€»ç»“å¤ä¹ å°±æ›´æœ‰å¿…è¦ã€‚

æ¥ä¸‹æ¥æˆ‘è¿˜æ˜¯å…ˆç®€è¦åˆ—ä¸¾ä¸€ä¸‹â€œåˆçº§ç¯‡â€é‡Œè®²åˆ°çš„Kubernetesè¦ç‚¹ï¼Œç„¶åå†ç»¼åˆè¿ç”¨è¿™äº›çŸ¥è¯†ï¼Œæ¼”ç¤ºä¸€ä¸ªå®æˆ˜é¡¹ç›®â€”â€”è¿˜æ˜¯æ­å»ºWordPressç½‘ç«™ï¼Œä¸è¿‡è¿™æ¬¡ä¸æ˜¯åœ¨Dockeré‡Œï¼Œè€Œæ˜¯åœ¨Kubernetesé›†ç¾¤é‡Œã€‚

## KubernetesæŠ€æœ¯è¦ç‚¹å›é¡¾

å®¹å™¨æŠ€æœ¯å¼€å¯äº†äº‘åŸç”Ÿçš„å¤§æ½®ï¼Œä½†æˆç†Ÿçš„å®¹å™¨æŠ€æœ¯ï¼Œåˆ°ç”Ÿäº§ç¯å¢ƒçš„åº”ç”¨éƒ¨ç½²çš„æ—¶å€™ï¼Œå´æ˜¾å¾—â€œæ­¥å±¥ç»´è‰°â€ã€‚å› ä¸ºå®¹å™¨åªæ˜¯é’ˆå¯¹å•ä¸ªè¿›ç¨‹çš„éš”ç¦»å’Œå°è£…ï¼Œè€Œå®é™…çš„åº”ç”¨åœºæ™¯å´æ˜¯è¦æ±‚è®¸å¤šçš„åº”ç”¨è¿›ç¨‹äº’ç›¸ååŒå·¥ä½œï¼Œå…¶ä¸­çš„å„ç§å…³ç³»å’Œéœ€æ±‚éå¸¸å¤æ‚ï¼Œåœ¨å®¹å™¨è¿™ä¸ªæŠ€æœ¯å±‚æ¬¡å¾ˆéš¾æŒæ§ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ**å®¹å™¨ç¼–æ’**ï¼ˆContainer Orchestrationï¼‰å°±å‡ºç°äº†ï¼Œå®ƒå¯ä»¥è¯´æ˜¯ä»¥å‰çš„è¿ç»´å·¥ä½œåœ¨äº‘åŸç”Ÿä¸–ç•Œçš„è½åœ°å®è·µï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯åœ¨é›†ç¾¤é‡Œè°ƒåº¦ç®¡ç†åº”ç”¨ç¨‹åºï¼Œåªä¸è¿‡ç®¡ç†çš„ä¸»ä½“ç”±äººå˜æˆäº†è®¡ç®—æœºï¼Œç®¡ç†çš„ç›®æ ‡ç”±åŸç”Ÿè¿›ç¨‹å˜æˆäº†å®¹å™¨å’Œé•œåƒã€‚

è€Œç°åœ¨ï¼Œå®¹å™¨ç¼–æ’é¢†åŸŸçš„ç‹è€…å°±æ˜¯â€”â€”Kubernetesã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ30ï¼‰</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/18/cd/ba/3a348f2d.jpg" width="30px"><span>YueShi</span> ğŸ‘ï¼ˆ18ï¼‰ ğŸ’¬ï¼ˆ7ï¼‰<div>Macä¸Šæˆ–è€…Windowä¸Šï¼Œå¯èƒ½å‡ºç°è®¿é—®ä¸åˆ°é—®é¢˜ï¼Œè¿™é‡Œå†™äº†ä¸€ç¯‡æ’æŸ¥é—®é¢˜çš„æ€è·¯ï¼ŒæœŸæœ›èƒ½å¸®åˆ°å„ä½è€æ¿

https:&#47;&#47;juejin.cn&#47;post&#47;7127679053242302477</div>2022-08-04</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/ibZVAmmdAibBeVpUjzwId8ibgRzNk7fkuR5pgVicB5mFSjjmt2eNadlykVLKCyGA0GxGffbhqLsHnhDRgyzxcKUhjg/132" width="30px"><span>pyhhou</span> ğŸ‘ï¼ˆ18ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<div>æ€è€ƒé¢˜ 2ï¼Œ

è¯•ç€å†™å‡ºäº† Pod çš„ YAML æ–‡ä»¶

apiVersion: v1
kind: ConfigMap
metadata:
  name: ngx-cm

data:
  default.conf: |-
    server {
      listen 80;
      default_type text&#47;html;

      location &#47; {
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_pass http:&#47;&#47;127.0.0.1:8080;
      }
    }

---

apiVersion: v1
kind: Pod
metadata:
  name: ngx-pod
  labels:
    app: nginx-alpine
    role: website

spec:
  volumes:
    - name: conf
      configMap:
        name: ngx-cm

  containers:
  - volumeMounts:
    - mountPath: &#47;etc&#47;nginx&#47;conf.d&#47;
      name: conf

    image: nginx:alpine
    name: ngx-pod
    imagePullPolicy: IfNotPresent
    ports:
    - containerPort: 80

å¯ä»¥æˆåŠŸåˆ›å»º Podï¼Œnginx çš„é…ç½®æ–‡ä»¶ä¹Ÿè¢«æŒ‚è½½åˆ°æŒ‡å®šçš„ä½ç½®ï¼Œä½†æ˜¯æµè§ˆå™¨è¿˜æ˜¯æ— æ³•è®¿é—® wordpressï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯æˆ‘çš„ YAML æ–‡ä»¶ä¸­å°‘äº†ä»€ä¹ˆğŸ¤”ï¼Œè¿˜æœ›è€å¸ˆæŒ‡ç‚¹</div>2022-07-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/cd/e0/c85bb948.jpg" width="30px"><span>æœ±é›¯</span> ğŸ‘ï¼ˆ11ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>å­¦äº†è¿™ä¸€èŠ‚ï¼Œæ²¡æ„Ÿè§‰åˆ°å®¹å™¨ç¼–æ’çš„å¥½ç”¨ï¼Œåè€Œé‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨é…ç½®ä¸­ï¼Œæˆ‘æŠŠwordpressé“¾æ¥æ•°æ®åº“çš„hostç»™å°å†™äº†ï¼Œç»“æœä¸€ç›´å‘Šè¯‰æˆ‘é“¾æ¥æ•°æ®åº“å¤±è´¥ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰æ’æŸ¥æ‰‹æ®µï¼Œä¸€ç›´å¤±è´¥ï¼Œæˆ‘æƒ³çš„æ˜¯ï¼Œè¿™ä¸ªk8sçš„éƒ¨ç½²æ­¥éª¤å®åœ¨æ˜¯å¤ªå¤æ‚äº†ï¼Œå¤æ‚åˆ°é…ç½®éœ€è¦ä¸€ä¸ªyamlï¼Œå®¹å™¨éœ€è¦ä¸€ä¸ªyamlï¼Œport-forwardä¹Ÿéœ€è¦ä¸€ä¸ªyamlï¼Œæˆ‘æƒ³å¦‚æœæ˜¯dockerç›´æ¥éƒ¨ç½²ï¼Œå…¶å®å°±éœ€è¦ä¸¤æ¡å‘½ä»¤ï¼Œæ‰€æœ‰å‚æ•°éƒ½æ”¾åˆ°envä¸­ï¼Œæˆ–è€…æ”¾åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼Œä¹Ÿæ¯”æ£€æŸ¥yamlæ–‡ä»¶å¼ºï¼Œåœ¨å…¥é—¨ç¯‡ä¸­æ²¡æ„Ÿå—åˆ°k8sçš„å¥½ç”¨ï¼Œåªæ„Ÿè§‰åˆ°çç¢ï¼Œæ˜¯å› ä¸ºæœåŠ¡å¤ªå°ï¼Œè¿˜æ˜¯å› ä¸ºæ²¡ç”¨å¥½çš„åŸå› å‘¢
</div>2022-07-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/83/af/1cb42cd3.jpg" width="30px"><span>é©¬ä»¥</span> ğŸ‘ï¼ˆ9ï¼‰ ğŸ’¬ï¼ˆ7ï¼‰<div>å†™ä¸€ä¸‹ç¬¬2é¢˜å§è§£é¢˜æ­¥éª¤ï¼š
é¦–å…ˆå¦‚æœæˆ‘ä»¬æŠŠdocker å½¢å¼æ”¹æˆpodå½¢å¼è¿™é‡Œå­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼ˆ1ï¼‰ç½‘ç»œé—®é¢˜ï¼Œï¼ˆ2ï¼‰nginxé…ç½®æ–‡ä»¶åŠ è½½é—®é¢˜ï¼Œ
ç¬¬ä¸€ä¸ªé—®é¢˜k8sçš„æ’ä»¶ä¼šå¤„ç†èŠ‚ç‚¹å†…ä»¥åŠèŠ‚ç‚¹é—´ç½‘ç»œé€šä¿¡é—®é¢˜ï¼Œè¿™ä¸ªæˆ‘ä»¬è¿™é‡Œæš‚æ—¶ä¸éœ€è¦è€ƒè™‘ï¼Œ
é‚£ä¹ˆéœ€è¦æˆ‘ä»¬å¤„ç†çš„å°±æ˜¯é…ç½®æ–‡ä»¶é—®é¢˜ï¼šè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨å¤šä¸ªæ–¹æ³•å¤„ç†
   a: podæŒ‚è½½å®¿ä¸»æœºç›®å½•ï¼ŒæŠŠé…ç½®æ–‡ä»¶æ”¾åˆ°å®¿ä¸»æœºç›®å½•ä¸‹ï¼Œå®¹å™¨å¯åŠ¨æŒ‚è½½
   b: ä½¿ç”¨æˆ‘ä»¬å­¦è¿‡çš„configMap
   cï¼šä½¿ç”¨pvã€pvc è¿™ä¸ªåé¢è€å¸ˆåº”è¯¥ä¼šè®²åˆ°
è¿™é‡Œæˆ‘é—¨å°±ä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•ï¼Œä¹Ÿæ˜¯è¯„è®ºé‡Œä½¿ç”¨æœ€å¤šçš„æ–¹æ³•ï¼š
ymlæ–‡ä»¶å¦‚ä¸‹ï¼š
    ngx-cm.yml

apiVersion: v1
kind: ConfigMap
metadata:
  name: ngx-cm
data:
  nginx.conf: |
    server {
      listen 8080;
      #default_type text&#47;html;

      location &#47; {
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_pass http:&#47;&#47;172.17.0.9:80;
      }
    }

nginx.yml:

apiVersion: v1
kind: Pod
metadata:
  name: ngx-pod
  labels:
    env: demo
    owner: ant

spec:
  volumes:
    - name: nginx-conf
      configMap:
        name: ngx-cm
        items:
        - key: nginx.conf
          path: default.conf
  containers:
  - image: nginx:alpine
    name: ngx
    volumeMounts:
      - name: nginx-conf
        mountPath: &#47;etc&#47;nginx&#47;conf.d
    ports:
    - containerPort: 8080

ç„¶åä½¿ç”¨ kubectl apply -f nginx.yml åˆ›å»ºpodï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™ç”±äºk8sèŠ‚ç‚¹è¿˜æ˜¯ä¸€ä¸ªéš”ç¦»ç¯å¢ƒï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯æ— æ³•è®¿é—®ï¼Œ
æ‰€ä»¥æˆ‘ä»¬è¦åœ¨ç½‘é¡µè§‚å¯Ÿåˆ°å…·ä½“çš„ç½‘é¡µå†…å®¹ï¼Œè¿˜æ˜¯è¦å†ç”¨dockeråˆ›å»ºä¸€å±‚nginxä»£ç†ï¼Œserver å†…å®¹å¦‚ä¸‹ï¼š
server {
  listen 80;
  default_type text&#47;html;

  location &#47; {
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      proxy_pass http:&#47;&#47;127.0.0.1:8888;
  }
}

ä½¿ç”¨ docker run -d --rm --net=host -v &#47;home&#47;ant&#47;kubernetes&#47;pod&#47;nginx-conf&#47;nginx.conf:&#47;etc&#47;nginx&#47;conf.d&#47;default.conf nginx:alpine
å¯åŠ¨ï¼Œ
ç„¶åä½¿ç”¨ kubectl port-forward ngx-pod 8888:8080 &amp; åšè½¬å‘

è®¿é—® http:&#47;&#47;192.168.56.208&#47; æ­£å¸¸è®¿é—®</div>2022-08-12</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKQuaDVYz2jWN9vrmgbB785SNkmYmxf1xzEG8m8ku3ZvzYSkiaanTjqt7O47ficOQUpGmEy7eImplDw/132" width="30px"><span>æ¤°å­</span> ğŸ‘ï¼ˆ7ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆï¼Œç›®å‰Podé…ç½®ä¸­ä½¿ç”¨äº†å›ºå®šIPã€‚å¦‚æœpodè¢«é‡å¯äº†ï¼Œip æ˜¯å¦ä¼šå˜åŒ–ï¼Ÿå¦‚æœæœ‰å˜åŒ–ï¼Œè¿™æ ·é…ç½®æ˜¯å¦æœ‰ç‚¹ä¸åˆç†ï¼Ÿ</div>2022-07-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/14/e7/c534fab3.jpg" width="30px"><span>wcy</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>ä½œä¸š1ï¼šæ”¹ç”¨secretå¯ä»¥ï¼Œè¿™ä¸ªç®€å•ï¼ŒæŠŠdataé‡Œå¯¹åº”çš„å€¼ç”¨base64ç¼–ç å°±è¡Œï¼Œå¯¹åº”podçš„ymlæ”¹ä¸‹
ä½œä¸š2ï¼šnginxæ”¹æˆpod è¿è¡Œæ˜¯æˆåŠŸçš„ï¼Œ ä½†æ˜¯port-forwardå‡ºæ¥ï¼Œlinuxè™šæœºä¸Šç”¨firefoxæ‰“å¼€é¡µé¢æ˜¯okçš„ã€‚ä½†åœ¨shellç»ˆç«¯æœ¬åœ°æµè§ˆå™¨è®¿é—®ä¸äº†ï¼Œçœ‹äº†ä¸‹åº”è¯¥æ˜¯port-forwardçš„é—®é¢˜ï¼Œæ˜ å°„çš„ç«¯å£ç»‘å®šåœ¨Linuxè™šæœº127.0.0.1ä¸Šï¼Œæ‰€ä»¥virtualboxè½¬å‘ä¸å‡ºæ¥ã€‚
nginx cm:
apiVersion: v1
kind: ConfigMap
metadata:
  name: ngx-cm
data:
  nginx.conf: |
    server {
    #  listen 80;
       listen 8080;
    #   default_type text&#47;html;

       location &#47; {
           proxy_http_version 1.1;
           proxy_set_header Host $host;
           proxy_pass http:&#47;&#47;172.17.0.10:80;
       }
     }

nginx podé…ç½®ï¼š
apiVersion: v1
kind: Pod
metadata:
  name: wp-ngx-pod
  labels:
    env: test

spec:
  containers:
  - image: nginx:alpine
    name: wp-ngx
    ports:
    - containerPort: 8080
    volumeMounts:
    - mountPath: &#47;etc&#47;nginx&#47;conf.d&#47;
      name: myngxconf

  volumes:
  - name: myngxconf
    configMap:
      name: ngx-cm
      items:
      - key: nginx.conf
        path: default.conf
</div>2022-08-04</li><br/><li><img src="" width="30px"><span>edward</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>kubectl port-forward è€å¸ˆè¯·æ•™ä¸‹ è¿™ä¸ªå‘½ä»¤è®¾ç½®ç«¯å£è½¬å‘åï¼Œæ€ä¹ˆæŸ¥çœ‹å’Œå–æ¶ˆï¼Ÿ</div>2022-11-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg" width="30px"><span>peter</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>è¯·æ•™è€å¸ˆå‡ ä¸ªé—®é¢˜ï¼š
Q1ï¼šMariaDBå’ŒWPå¯ä»¥è·‘åœ¨ä¸€ä¸ªPODé‡Œé¢å—ï¼Ÿ

Q2ï¼šæ–‡ä¸­çš„prefixæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ
æ–‡ä¸­å®šä¹‰mariadb-pod.ymlçš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªprefix: &#39;MARIADB_&#39;ï¼Œ è¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ
æ˜¯æŠŠconfigMapä¸­çš„å˜é‡åå­—å‰é¢åŠ ä¸Šè¿™ä¸ªå‰ç¼€ä½œä¸ºpodä¸­çš„å˜é‡åç§°å—ï¼Ÿ
å³ï¼špodä¸­çš„å˜é‡åç§° = MARIADB_&#39; + configMapä¸­çš„å˜é‡åç§°ã€‚
Q3ï¼šå…³äºè½¬å‘çš„ç–‘é—®
æ–‡ä¸­æœ‰ä¸€å¥ï¼šâ€œå› ä¸º WordPress ç½‘ç«™ä½¿ç”¨äº† URL é‡å®šå‘ï¼Œç›´æ¥ä½¿ç”¨â€œ8080â€ä¼šå¯¼è‡´è·³è½¬æ•…éšœâ€ã€‚ å¦‚æœæ²¡æœ‰nginxï¼Œå®¿ä¸»æœºä¸Šç”¨æµè§ˆå™¨ç›´æ¥è®¿é—®WPçš„8080ç«¯å£ï¼Œåˆ™ä¼šå› ä¸ºWPå†…éƒ¨å®ç°æœºåˆ¶è€Œäº§ç”Ÿé”™è¯¯ï¼› å¦‚æœåŠ ä¸Šnginxï¼Œnginxå»è®¿é—®WPçš„8080ç«¯å£ï¼Œå°±æ²¡äº‹ã€‚ æ˜¯è¿™æ ·å—ï¼Ÿ</div>2022-07-25</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/ibZVAmmdAibBeVpUjzwId8ibgRzNk7fkuR5pgVicB5mFSjjmt2eNadlykVLKCyGA0GxGffbhqLsHnhDRgyzxcKUhjg/132" width="30px"><span>pyhhou</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<div>æœ‰åœ¨æ“ä½œè¿‡ç¨‹ä¸­é‡åˆ°å‡ ä¸ªé—®é¢˜ï¼Œè¿˜çƒ¦è¯·è€å¸ˆæŒ‡ç‚¹

1ã€å‰é¢ 2 ä¸ªæ­¥éª¤ä¸­ï¼Œåœ¨ kubectl apply -f *-pod.yml ä¹‹å‰æ˜¯ä¸æ˜¯ä¹Ÿå¾— apply ä¸€ä¸‹ä¹‹å‰å®šä¹‰çš„ configMap å¯¹è±¡ï¼Ÿ

2ã€å¯¹äºåå‘ä»£ç†ï¼Œä¸æ˜¯ç‰¹åˆ«çš„ç†è§£ï¼Œè€å¸ˆèƒ½ç®€å•è§£é‡Šä¸€ä¸‹åå‘ä»£ç†ï¼Œå¹¶é™„å¸¦è¯´æ˜è¿™é‡Œ Nginx è¿™é‡Œä½œä¸ºåå‘ä»£ç†çš„ç›®çš„æ˜¯ä»€ä¹ˆå—ï¼Ÿ

3ã€`minikube dashboard` æ— æ³•åœ¨å‘½ä»¤è¡Œæ˜¾ç¤ºç•Œé¢ï¼Œæˆ‘å°† URL å¤åˆ¶ç²˜è´´åˆ° Ubuntu è™šæ‹Ÿæœºå›¾å½¢ç•Œé¢ä¸Šçš„æµè§ˆå™¨ä¸­ï¼Œä½†å›å¤çš„ JSON ä¸­æ˜¾ç¤º 404ï¼Ÿä¸å¤ªæ¸…æ¥šæœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•
Opening http:&#47;&#47;127.0.0.1:38539&#47;api&#47;v1&#47;namespaces&#47;kubernetes-dashboard&#47;services&#47;http:kubernetes-dashboard:&#47;proxy&#47; in your default browser...
Error: no DISPLAY environment variable specified

4ã€å¯¹äºæ€è€ƒé¢˜çš„ 2ï¼Œæˆ‘åˆ›å»ºä¸€ä¸ªäº† nginx Podï¼Œç„¶åå°†å…¶é…ç½®æ–‡ä»¶é€šè¿‡ kubectl cp æ‹·è´åˆ° Pod å®¹å™¨ä¸­çš„å¯¹åº”ä½ç½®ï¼Œä½†æ˜¯å‘ç°å¹¶ä¸èµ·ä½œç”¨ï¼Œæœ¬æ¥æƒ³ç€é‡å¯ Pod è®©é…ç½®ç”Ÿæ•ˆï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„æŒ‡ä»¤ã€‚è¿™é‡Œæ˜¯ä¸æ˜¯éœ€è¦å…¶ä»–çš„ K8S API å¯¹è±¡çš„å¸®åŠ©ï¼Ÿ</div>2022-07-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/1d/3a/cdf9c55f.jpg" width="30px"><span>æœªæ¥å·²æ¥</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>ç¬¬å››æ­¥ Nginx éƒ¨åˆ†ä½¿ç”¨ docker å¯åŠ¨å‘½ä»¤æŠŠ -v åé¢çš„ &#47;tmp&#47;proxy.conf æ”¹ä¸º `pwd`&#47;proxy.conf å³å¯ï¼Œè·Ÿ dokcer å®æˆ˜éƒ¨åˆ†ä¿æŒä¸€è‡´</div>2023-05-14</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/g4os8I4iaB6jn06PsvyqI1BooV5XbOC0vI3niaJ4I3SlAhkbBKG2eewlPHHJ4ROcDia18bbPFSZPDXXmgHXtrBlLg/132" width="30px"><span>Geek_f2f06e</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆæˆ‘æœ‰ä¸€ä¸ªç–‘é—®æƒ³è¯·æ•™æ‚¨ï¼š
è¿™é‡ŒæŠŠæ¯ä¸ªåº”ç”¨éƒ½å°è£…æˆpodï¼Œä¸ºä»€ä¹ˆä¸å°†MariaDBå’ŒWordPresså°è£…åˆ°ä¸€ä¸ªpodé‡Œé¢ï¼Œpodçš„æ„ä¹‰ä¸å°±æ˜¯å°†å¤šä¸ªå¯†åˆ‡çš„å®¹å™¨å°è£…åœ¨ä¸€èµ·</div>2023-04-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg" width="30px"><span>doos</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è¿™ä¸ªå…¥é—¨å†™çš„å¤ªå¥½äº†ï¼Œæˆ‘å½“æ—¶å­¦æ˜¯å…ˆå­¦ä¹ dockerï¼Œç ”ç©¶äº†3ä¸ªæœˆdockerï¼Œåæ¥æ‰æ…¢æ…¢å»æ¥è§¦k8så­¦äº†åŠå¹´ï¼Œæ„Ÿè§‰å†…å®¹å¤ªå¤šäº†ï¼Œè€Œä¸”çŸ¥è¯†æ¯”è¾ƒåˆ†æ•£</div>2023-02-23</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/cK4aAENG9h42KqeibyVNTeSUichzhv6zH1nA6iah4u6USqITMDA6qzuiaKY3of68tROwSzuRIsPpLnqgVW8ClMRH2Q/132" width="30px"><span>Geek_39bdd5</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ4ï¼‰<div>kubectl get pod -o wideæŸ¥çœ‹çš„æ—¶å€™ipæ˜¾ç¤ºæ˜¯noneæ˜¯æ€ä¹ˆå›äº‹
</div>2022-08-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/cf/d5382404.jpg" width="30px"><span>RRR</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>ä¸¤ä¸ªé—®é¢˜

1. port-forward å®é™…åœ¨ç”Ÿäº§ç”¨çš„å¤šä¹ˆï¼Ÿåº”è¯¥éƒ½æ˜¯ ingress å§
2. è€å¸ˆåé¢èƒ½è®²è®² helm å’Œ Istio å—ï¼Œä»–ä»¬å’Œ k8s å…³ç³»æ˜¯ä»€ä¹ˆï¼Œæˆ‘çœ‹ä¸æ˜ç™½</div>2022-07-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/e2/52/56dbb738.jpg" width="30px"><span>ç‰™å°æœ¨</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>æ³¨æ„wp-pod.yamlä¸­çš„HOSTå€¼ï¼Œéœ€è¦æŒ‰ç…§è‡ªå·±æœºå™¨ä¸Šçš„æ¥ã€‚
tb@tb-laptop:~$ k get pod maria-pod -o wide
NAME        READY   STATUS    RESTARTS   AGE   IP            NODE       NOMINATED NODE   READINESS GATES
maria-pod   1&#47;1     Running   0          26m   10.244.0.76   minikube   &lt;none&gt;           &lt;none&gt;

</div>2023-07-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/9d/c8/695f838c.jpg" width="30px"><span>æ–‡é™çš„å®‰è¿ª</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆï¼Œæˆ‘æ‰€æœ‰çš„è¯¾ç¨‹éƒ½è·Ÿç€ä½ çš„è¿™ä¸ªè¯¾ç¨‹èµ°çš„ï¼Œä½†æ˜¯åœ¨æœ¬æ–‡ä¸­ï¼Œåˆ›å»ºmariadb-podçš„æ—¶å€™ï¼Œä¸€åªæ‹‰å–é•œåƒå¤±è´¥ï¼Œä½†æ˜¯æˆ‘æœ¬åœ°è¿™ä¸ªé•œåƒå¾ˆæ—©å°±ä¸‹è½½ä¸‹æ¥äº†çš„ï¼Œä½†æ˜¯podä¸€ç›´æ— æ³•åˆ›å»ºæˆåŠŸImagePullBackOffï¼Œçœ‹æ—¥å¿—æ˜¯æ‹‰å–é•œåƒå¤±è´¥ï¼Œä¸ºä»€ä¹ˆæˆ‘æœ¬åœ°æœ‰è¿˜è¦å»æ‹‰é•œåƒå‘¢ï¼Ÿ

ubuntu@ip-10-0-12-235:~$ kubectl get pod
NAME        READY   STATUS             RESTARTS   AGE
maria-pod   0&#47;1     ImagePullBackOff   0          5m17s

ubuntu@ip-10-0-12-235:~$ docker images
REPOSITORY       TAG       IMAGE ID       CREATED         SIZE
mariadb          10        4af0c16be4b1   12 hours ago    403MB
alpine           latest    5e2b554c1c45   2 days ago      7.33MB
hello-world      latest    9c7a54a9a43c   7 days ago      13.3kB
nginx            1.23      448a08f1d2f9   8 days ago      142MB
nginx            latest    448a08f1d2f9   8 days ago      142MB
redis            latest    116cad43b6af   8 days ago      117MB
kicbase&#47;stable   v0.0.39   67a4b1138d2d   5 weeks ago     1.05GB
nginx            alpine    8e75cbc5b25c   6 weeks ago     41MB
busybox          latest    7cfbbec8963d   8 weeks ago     4.86MB
ubuntu           latest    6b7dfa7e8fdb   5 months ago    77.8MB
wordpress        5         140ebc8d8136   12 months ago   605MB


</div>2023-05-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/89/c8/53085ffb.jpg" width="30px"><span>tzhiyu</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>è¿è¡Œä¸‹é¢è¿™è¡Œå‘½ä»¤ä¹‹å
kubectl apply -f wp-pod.yml

æ²¡æœ‰å‡ºç°è€å¸ˆå›¾ç‰‡ä¸Šå‡ºç°çš„&quot;configmap&#47;maria-cm created&quot;, æ˜¯å› ä¸ºæˆ‘æ²¡æœ‰å•ç‹¬å†™maria-cm.ymlå¯¼è‡´çš„å—
</div>2023-04-24</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Gtf3tMDmYRoCL9Eico52ciatacq4PUHfQ8icQIYKV6KLDAJyTa8ZnLXMKf05pEice5RnEagocFobca5zv8jwyPhNKA/132" width="30px"><span>Geek_9d43c0</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>æˆ‘æœ‰ä¸ªç–‘é—® mariadbå¯åŠ¨çš„æ—¶å€™ æ‹‰å– åœ¨maria-cmé‡Œé¢å£°æ˜çš„é…ç½® è¿™ä¸ªé…ç½®çš„å­—æ®µå¯åŠ¨çš„æ—¶å€™æ˜¯æ€ä¹ˆæ‰¾åˆ°çš„ å› ä¸ºæˆ‘ä»¬åœ¨dockerå¯åŠ¨çš„æ—¶å€™æ˜¯ä¼šæ˜¾å¼çš„é…ç½®å¯åŠ¨å‚æ•° å¦‚æœåŠ äº†ç»Ÿä¸€çš„å‰ç¼€ä¸ä¼šå½±å“mariadbå¯åŠ¨æ‰¾è‡ªå·±çš„é…ç½®å— </div>2023-04-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/c7/11/89ba9915.jpg" width="30px"><span>æ°¸è¿œçš„è‰è“åœ°</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>æœ‰ä¸ªç–‘é—®ï¼Œmaria db åˆ›å»ºä¹‹åä¼šæœ‰ä¸€ä¸ª ip ï¼Œè¿™ä¸ª ip ç›´æ¥å°±å¯ä»¥è®©å…¶ä»– pod è®¿é—®ï¼Œè¿™æ ·ä¸æ˜¯å¤ªä¸å®‰å…¨äº†å—ï¼Ÿ</div>2023-03-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/7e/25/3932dafd.jpg" width="30px"><span>GeekNeo</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šæˆ‘å¹¶ä¸èƒ½åœ¨ä¸€ä¸ªæ–‡ä»¶ç›´æ¥åˆ›å»ºconfigmapå¯¹è±¡å’Œpod
æˆ‘éœ€è¦æ‰§è¡Œconfigmapå¯¹è±¡çš„ymlæ–‡ä»¶ ç„¶ååœ¨æ‰§è¡Œpodçš„ymlæ–‡ä»¶</div>2023-03-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/31/e5/8d45547d.jpg" width="30px"><span>éšé‡è€Œå®‰</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆï¼Œè¯¾ç¨‹çš„æºç æœ‰å—ï¼Ÿå°±æ˜¯æ¯ä¸ªå†…å®¹ä¸­ç”¨åˆ°çš„ymlæ–‡ä»¶ã€‚ä¸ºå•¥æˆ‘è§‰å¾—åº”è¯¥å…ˆkubectl apply -f cm.ymlä¹‹åï¼Œetdæ‰ä¼šæœ‰cmçš„é…ç½®ä¿¡æ¯å•Šã€‚æˆ‘çœ‹åˆ°çš„podçš„ymlä¸­ï¼Œç›´æ¥å¼•ç”¨äº†cmé…ç½®ï¼Œä¸å¯¹å§</div>2023-02-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/20/d2/0e/579fc19b.jpg" width="30px"><span>conorzhong</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>æ–‡ä¸­ç¼ºå°‘kubectl apply -f maria-cm.yml</div>2022-12-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/8f/48/c7fb8067.jpg" width="30px"><span>zzz</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>Hi chrono , å‡ºç°è¿™æ ·çš„é—®é¢˜,è°ƒè¯•äº†ä¸€ä¸ªä¸‹åˆï¼š
ubuntu@master:~&#47;k8s02p&#47;k8s&#47;worldPress$ k get pods  -o wide
NAME        READY   STATUS             RESTARTS        AGE     IP            NODE       NOMINATED NODE   READINESS GATES
maria-pod   1&#47;1     Running            0               29m     10.244.1.11   worker01   &lt;none&gt;           &lt;none&gt;
wp-pod      0&#47;1     CrashLoopBackOff   3 (2m35s ago)   3m23s   10.244.1.14   worker01   &lt;none&gt;           &lt;none&gt;

é€šè¿‡ k logs æ£€æŸ¥ï¼š
ubuntu@master:~&#47;k8s02p&#47;k8s&#47;worldPress$ k logs wp-pod 
wordpress 09:54:52.41 
wordpress 09:54:52.42 Welcome to the Bitnami wordpress container
wordpress 09:54:52.42 Subscribe to project updates by watching https:&#47;&#47;github.com&#47;bitnami&#47;containers
wordpress 09:54:52.43 Submit issues and feature requests at https:&#47;&#47;github.com&#47;bitnami&#47;containers&#47;issues
wordpress 09:54:52.44 
wordpress 09:54:52.45 INFO  ==&gt; ** Starting WordPress setup **
realpath: &#47;bitnami&#47;apache&#47;conf: No such file or directory
wordpress 09:54:52.55 INFO  ==&gt; Configuring Apache ServerTokens directive
wordpress 09:54:52.62 INFO  ==&gt; Configuring PHP options
wordpress 09:54:52.63 INFO  ==&gt; Setting PHP expose_php option
wordpress 09:54:52.69 INFO  ==&gt; Validating settings in MYSQL_CLIENT_* env vars
wordpress 09:54:52.87 WARN  ==&gt; Hostname mariadb could not be resolved, this could lead to connection issues
wordpress 09:54:52.88 ERROR ==&gt; The WORDPRESS_DATABASE_PASSWORD environment variable is empty or not set. Set the environment variable ALLOW_EMPTY_PASSWORD=yes to allow a blank password. This is only recommended for development environments.

ä½†æ˜¯wp-cm.yaml é‡Œé¢ï¼ŒHOSTåº”è¯¥æ˜¯æ²¡æœ‰é…ç½®é”™è¯¯çš„ï¼š
ubuntu@master:~&#47;k8s02p&#47;k8s&#47;worldPress$ cat wp-cm.yaml 

apiVersion: v1
kind: ConfigMap
metadata:
  name: wp-cm
data:
  HOST: &#39;10.244.1.11&#39;
  USER: &#39;wp&#39;
  PASSWORD: &#39;123&#39;
  NAME: &#39;db&#39;
</div>2022-12-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/20/3f/84/47f7b661.jpg" width="30px"><span>ä½ å¥½æå®¢æ—¶é—´</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<div>è€å¸ˆå¥½ï¼Œæˆ‘è¿™é‡Œè®¿é—®127.0.0.1:80ï¼ŒæŠ¥é”™502ï¼Œæ˜¯wordpressçš„é—®é¢˜ä¹ˆï¼Ÿ

[root@localhost ~]# curl http:&#47;&#47;127.0.0.1
&lt;html&gt;
&lt;head&gt;&lt;title&gt;502 Bad Gateway&lt;&#47;title&gt;&lt;&#47;head&gt;
&lt;body&gt;
&lt;center&gt;&lt;h1&gt;502 Bad Gateway&lt;&#47;h1&gt;&lt;&#47;center&gt;
&lt;hr&gt;&lt;center&gt;nginx&#47;1.23.2&lt;&#47;center&gt;
&lt;&#47;body&gt;
&lt;&#47;html&gt;
[root@localhost ~]#
</div>2022-12-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/f3/37/30a09a4a.jpg" width="30px"><span>è·¯å…ˆç”Ÿ</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>podä¸€ç›´æ˜¯ContainerCreatingçŠ¶æ€ï¼Œå‡ åˆ†é’Ÿåå˜ImagePullBackOffï¼Œæ‹‰å–ä¸äº†mariadb:10é•œåƒ
æ‰§è¡Œminikube delete
minikube start --kubernetes-version=v1.23.3 --image-mirror-country=&#39;cn&#39; --image-repository=&#39;registry.cn-hangzhou.aliyuncs.com&#47;google_containers&#39; --force
æŠŠrepositoryæ¢æˆå›½å†…çš„è¿˜æ˜¯è€æ ·å­ï¼Œå¡åŠå¤©äº†
kubectl describe pod maria-podçš„Events:
Normal  Pulling    4m47s  kubelet            Pulling image &quot;mariadb:10&quot;</div>2022-11-16</li><br/><li><img src="" width="30px"><span>edward</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>è€å¸ˆè¯·é—®ä¸‹ï¼Œä¸ºä»€ä¹ˆæˆ‘åœ¨æœ¬åœ°ubuntuä¸‹ip addr å’Œæˆ‘è¿›å…¥nginxçš„dockerå®¹å™¨å†…éƒ¨æ‰§è¡Œip addr æ²¡çœ‹åˆ°åŒä¸€ä¸ªIPå‘¢ï¼Œå¯åŠ¨dockeræ—¶ç¡®å®ä½¿ç”¨äº† --net=host å‚æ•°ã€‚</div>2022-11-08</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ1VPGSQg7SqrN1Gutx31Kicks2icZjTCg1gZoDLfEcSSricYD6l5qQgE3MkMpqlhkM4gMicymOYzaudg/132" width="30px"><span>å¯å¯</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>kubectl apply -f wp-pod.ymlæ‰§è¡Œåæ¯æ¬¡éƒ½å¤±è´¥ï¼Œçœ‹äº†ä¸€ä¸‹kubectl describe pod wp-podï¼Œå‘ç°æ˜¯æ‹‰å»é•œåƒè¶…æ—¶ã€‚æˆ‘å°±çº³é—·ä¸ºå•¥æˆ‘æœ¬åœ°å­˜åœ¨wordpress:5çš„dockeré•œåƒï¼Œä¸ºå•¥è¿™é‡Œæ‰¾ä¸åˆ°å‘¢ã€‚åæ¥åœ¨ç½‘ä¸Šçœ‹åˆ°minikubeä½¿ç”¨ç‹¬ç«‹çš„docker daemonï¼Œä¸åŒäºæœ¬åœ°çš„dockerå®ˆæŠ¤è¿›ç¨‹ã€‚æ‰€ä»¥éœ€è¦å…ˆæŠŠæœ¬åœ°çš„dockeré•œåƒå¯¼å…¥åˆ°minikubeä¹‹ä¸­æ‰èƒ½ä½¿ç”¨ã€‚
docker save wordpress:5 | (eval $(minikube docker-env) &amp;&amp; docker load)
æ­¤å‘½ä»¤å°†é•œåƒä¿å­˜ä¸ºtarå­˜æ¡£,ç„¶åå°†é•œåƒåŠ è½½åˆ°minikubeä¸­ã€‚è¿™æ—¶å€™åˆ é™¤æ‰ä¹‹å‰applyå¤±è´¥çš„podï¼Œé‡æ–°applyå°±æˆåŠŸäº†ã€‚</div>2022-10-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/b8/bf/39151455.jpg" width="30px"><span>Aioria</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆï¼Œæœ‰ä¸ªç–‘é—®ï¼Œ` kubectl port-forward`è¿™æ¡å‘½ä»¤æ˜¯å¦ä¹Ÿèƒ½åœ¨.ymlæ–‡ä»¶ä¸­æè¿°å‘¢ï¼Ÿè¿è¡ŒPodåå†ä»¥å‘½ä»¤æ–¹å¼æ˜ å°„ç«¯å£ï¼Œä¼¼ä¹ä¸åˆ©äºCI&#47;CDã€‚</div>2022-08-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg" width="30px"><span>lesserror</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆï¼Œå®ä½“å¯¹è±¡å’Œéå®ä½“å¯¹è±¡æ˜¯æ€ä¹ˆåŒºåˆ†çš„ï¼Ÿ å¸¦æœ‰å®¹å™¨çš„å°±æ˜¯å®ä½“å¯¹è±¡å—ï¼Ÿ</div>2022-08-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg" width="30px"><span>lesserror</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆï¼Œdocker run -d --rm \ --net=host ï¼Œè¿™é‡Œçš„--net=host èµ·ä»€ä¹ˆä½œç”¨å•Šï¼ŸåŠ äº†ä»¥åï¼Œç›´æ¥æ‹’ç»è®¿é—®äº†ï¼Œä¹‹å‰ä¸éƒ½æ˜¯ä¼šç«¯å£æ˜ å°„ç”¨æ¥è®¿é—®çš„å—ï¼Ÿ</div>2022-08-02</li><br/>
</ul>