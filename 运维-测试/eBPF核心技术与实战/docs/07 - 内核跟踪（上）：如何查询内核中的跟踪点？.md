ä½ å¥½ï¼Œæˆ‘æ˜¯å€ªæœ‹é£ã€‚

åœ¨ä¸Šä¸€ä¸ªæ¨¡å—â€œåŸºç¡€å…¥é—¨ç¯‡â€ä¸­ï¼Œæˆ‘å¸¦ä½ æ­å»ºäº† eBPF çš„å¼€å‘ç¯å¢ƒï¼Œå¹¶è¯¦ç»†ä»‹ç»äº† eBPF ç¨‹åºçš„å·¥ä½œåŸç†ã€ç¼–ç¨‹æ¥å£ä»¥åŠäº‹ä»¶è§¦å‘æœºåˆ¶ã€‚å­¦ä¹ å®Œè¿™äº›å†…å®¹ï¼Œæˆ‘æƒ³ä½ å·²ç»æŒæ¡äº† eBPF å¿…å¤‡çš„åŸºç¡€çŸ¥è¯†ï¼Œå¹¶é€šè¿‡ç®€å•çš„ç¤ºä¾‹ï¼Œåˆæ­¥ä½“éªŒäº† eBPF ç¨‹åºçš„å¼€å‘å’Œæ‰§è¡Œè¿‡ç¨‹ã€‚

æˆ‘åœ¨å‰é¢çš„å†…å®¹ä¸­åå¤å¼ºè°ƒè¿‡ï¼Œå­¦ä¹ ä¸€é—¨æ–°æŠ€æœ¯ï¼Œæœ€å¿«çš„æ–¹æ³•å°±æ˜¯åœ¨ç†è§£åŸç†çš„åŒæ—¶é…åˆå¤§é‡çš„å®è·µï¼ŒeBPF ä¹Ÿä¸ä¾‹å¤–ã€‚æ‰€ä»¥ï¼Œä»è¿™ä¸€è®²èµ·æˆ‘ä»¬å¼€å§‹â€œå®æˆ˜è¿›é˜¶ç¯‡â€çš„å­¦ä¹ ï¼Œä¸€èµ·è¿›å…¥ eBPF çš„å®è·µç¯èŠ‚ï¼Œé€šè¿‡çœŸå®çš„åº”ç”¨æ¡ˆä¾‹æŠŠ eBPF æŠ€æœ¯ç”¨èµ·æ¥ã€‚

ä»Šå¤©æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ï¼Œæ€æ ·ä½¿ç”¨ eBPF å»è·Ÿè¸ªå†…æ ¸çš„çŠ¶æ€ï¼Œç‰¹åˆ«æ˜¯æœ€ç®€å•çš„ bpftrace çš„ä½¿ç”¨æ–¹æ³•ã€‚åœ¨ä¸‹ä¸€è®²ä¸­ï¼Œæˆ‘è¿˜å°†ä»‹ç»ä¸¤ç§ eBPF ç¨‹åºçš„è¿›é˜¶ç¼–ç¨‹æ–¹æ³•ã€‚

ä¸Šä¸€è®²æˆ‘æåˆ°è¿‡ï¼Œè·Ÿè¸ªç±» eBPF ç¨‹åºä¸»è¦åŒ…å«å†…æ ¸æ’æ¡©ï¼ˆ`BPF_PROG_TYPE_KPROBE`ï¼‰ã€è·Ÿè¸ªç‚¹ï¼ˆ`BPF_PROG_TYPE_TRACEPOINT`ï¼‰ä»¥åŠæ€§èƒ½äº‹ä»¶ï¼ˆ`BPF_PROG_TYPE_PERF_EVENT`ï¼‰ç­‰ç¨‹åºç±»å‹ï¼Œè€Œæ¯ç±» eBPF ç¨‹åºç±»å‹åˆå¯ä»¥æŒ‚è½½åˆ°ä¸åŒçš„å†…æ ¸å‡½æ•°ã€å†…æ ¸è·Ÿè¸ªç‚¹æˆ–æ€§èƒ½äº‹ä»¶ä¸Šã€‚å½“è¿™äº›å†…æ ¸å‡½æ•°ã€å†…æ ¸è·Ÿè¸ªç‚¹æˆ–æ€§èƒ½äº‹ä»¶è¢«è°ƒç”¨çš„æ—¶å€™ï¼ŒæŒ‚è½½åˆ°å…¶ä¸Šçš„ eBPF ç¨‹åºå°±ä¼šè‡ªåŠ¨æ‰§è¡Œã€‚

é‚£ä¹ˆï¼Œä½ å¯èƒ½æƒ³é—®äº†ï¼šå½“æˆ‘ä¸çŸ¥é“å†…æ ¸ä¸­éƒ½æœ‰å“ªäº›å†…æ ¸å‡½æ•°ã€å†…æ ¸è·Ÿè¸ªç‚¹æˆ–æ€§èƒ½äº‹ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨å“ªé‡ŒæŸ¥è¯¢åˆ°å®ƒä»¬çš„åˆ—è¡¨å‘¢ï¼Ÿå¯¹äºå†…æ ¸å‡½æ•°å’Œå†…æ ¸è·Ÿè¸ªç‚¹ï¼Œåœ¨éœ€è¦è·Ÿè¸ªå®ƒä»¬çš„ä¼ å…¥å‚æ•°å’Œè¿”å›å€¼çš„æ—¶å€™ï¼Œåˆè¯¥å¦‚ä½•æŸ¥è¯¢è¿™äº›æ•°æ®ç»“æ„çš„å®šä¹‰æ ¼å¼å‘¢ï¼Ÿåˆ«æ‹…å¿ƒï¼Œæ¥ä¸‹æ¥å°±è·Ÿæˆ‘ä¸€èµ·å»æ¢ç´¢ä¸‹å§ã€‚

## **åˆ©ç”¨è°ƒè¯•ä¿¡æ¯æŸ¥è¯¢è·Ÿè¸ªç‚¹**

å®é™…ä¸Šï¼Œä½œä¸ºä¸€ä¸ªè½¯ä»¶ç³»ç»Ÿï¼Œå†…æ ¸ä¹Ÿç»å¸¸ä¼šå‘ç”Ÿå„ç§å„æ ·çš„é—®é¢˜ï¼Œæ¯”å¦‚å®‰å…¨æ¼æ´ã€é€»è¾‘é”™è¯¯ã€æ€§èƒ½å·®ï¼Œç­‰ç­‰ã€‚å› æ­¤ï¼Œå†…æ ¸æœ¬èº«çš„è°ƒè¯•ä¸è·Ÿè¸ªä¸€ç›´éƒ½æ˜¯å†…æ ¸æä¾›çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ã€‚

æ¯”å¦‚ï¼Œä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œå†…æ ¸æŠŠæ‰€æœ‰å‡½æ•°ä»¥åŠéæ ˆå˜é‡çš„åœ°å€éƒ½æŠ½å–åˆ°äº†Â `/proc/kallsyms`Â ä¸­ï¼Œè¿™æ ·è°ƒè¯•å™¨å°±å¯ä»¥æ ¹æ®åœ°å€æ‰¾å‡ºå¯¹åº”çš„å‡½æ•°å’Œå˜é‡åç§°ã€‚å¾ˆæ˜¾ç„¶ï¼Œå…·æœ‰å®é™…å«ä¹‰çš„åç§°è¦æ¯” 16 è¿›åˆ¶çš„åœ°å€æ˜“è¯»å¾—å¤šã€‚å¯¹å†…æ ¸æ’æ¡©ç±»çš„ eBPF ç¨‹åºæ¥è¯´ï¼Œå®ƒä»¬è¦æŒ‚è½½çš„å†…æ ¸å‡½æ•°å°±å¯ä»¥ä»Â `/proc/kallsyms`Â è¿™ä¸ªæ–‡ä»¶ä¸­æŸ¥åˆ°ã€‚

æ³¨æ„ï¼Œå†…æ ¸å‡½æ•°æ˜¯ä¸€ä¸ªéç¨³å®š APIï¼Œåœ¨æ–°ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå¹¶ä¸”å†…æ ¸å‡½æ•°çš„æ•°é‡ä¹Ÿåœ¨ä¸æ–­å¢é•¿ä¸­ã€‚ä»¥ v5.13.0 ä¸ºä¾‹ï¼Œæ€»çš„å†…æ ¸ç¬¦å·è¡¨æ•°é‡å·²ç»è¶…è¿‡äº† 16 ä¸‡ï¼š

```bash
$ cat /proc/kallsyms | wc -l
165694
```

ä¸è¿‡éœ€è¦æé†’ä½ çš„æ˜¯ï¼Œè¿™äº›ç¬¦å·è¡¨ä¸ä»…åŒ…å«äº†å†…æ ¸å‡½æ•°ï¼Œè¿˜åŒ…å«äº†éæ ˆæ•°æ®å˜é‡ã€‚è€Œä¸”ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„å†…æ ¸å‡½æ•°éƒ½æ˜¯å¯è·Ÿè¸ªçš„ï¼Œåªæœ‰æ˜¾å¼å¯¼å‡ºçš„å†…æ ¸å‡½æ•°æ‰å¯ä»¥è¢« eBPF è¿›è¡ŒåŠ¨æ€è·Ÿè¸ªã€‚å› è€Œï¼Œé€šå¸¸æˆ‘ä»¬å¹¶ä¸ç›´æ¥ä»å†…æ ¸ç¬¦å·è¡¨æŸ¥è¯¢å¯è·Ÿè¸ªç‚¹ï¼Œè€Œæ˜¯ä½¿ç”¨æˆ‘æ¥ä¸‹æ¥ä»‹ç»çš„æ–¹æ³•ã€‚

ä¸ºäº†æ–¹ä¾¿å†…æ ¸å¼€å‘è€…è·å–æ‰€éœ€çš„è·Ÿè¸ªç‚¹ä¿¡æ¯ï¼Œå†…æ ¸[è°ƒè¯•æ–‡ä»¶ç³»ç»Ÿ](https://www.kernel.org/doc/html/latest/filesystems/debugfs.html)è¿˜å‘ç”¨æˆ·ç©ºé—´æä¾›äº†å†…æ ¸è°ƒè¯•æ‰€éœ€çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚å†…æ ¸ç¬¦å·åˆ—è¡¨ã€è·Ÿè¸ªç‚¹ã€å‡½æ•°è·Ÿè¸ªï¼ˆftraceï¼‰çŠ¶æ€ä»¥åŠå‚æ•°æ ¼å¼ç­‰ã€‚ä½ å¯ä»¥åœ¨ç»ˆç«¯ä¸­æ‰§è¡ŒÂ `sudo ls /sys/kernel/debug`Â æ¥æŸ¥è¯¢å†…æ ¸è°ƒè¯•æ–‡ä»¶ç³»ç»Ÿçš„å…·ä½“ä¿¡æ¯ã€‚æ¯”å¦‚ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå°±å¯ä»¥æŸ¥è¯¢Â `execve`Â ç³»ç»Ÿè°ƒç”¨çš„å‚æ•°æ ¼å¼ï¼š

```bash
sudo cat /sys/kernel/debug/tracing/events/syscalls/sys_enter_execve/format
```

å¦‚æœä½ ç¢°åˆ°äº†Â `/sys/kernel/debug`Â ç›®å½•ä¸å­˜åœ¨çš„é”™è¯¯ï¼Œè¯´æ˜ä½ çš„ç³»ç»Ÿæ²¡æœ‰è‡ªåŠ¨æŒ‚è½½è°ƒè¯•æ–‡ä»¶ç³»ç»Ÿã€‚åªéœ€è¦æ‰§è¡Œä¸‹é¢çš„ mount å‘½ä»¤å°±å¯ä»¥æŒ‚è½½å®ƒï¼š

```plain
sudo mount -t debugfs debugfs /sys/kernel/debug
```

æ³¨æ„ï¼Œ**eBPF ç¨‹åºçš„æ‰§è¡Œä¹Ÿä¾èµ–äºè°ƒè¯•æ–‡ä»¶ç³»ç»Ÿ**ã€‚å¦‚æœä½ çš„ç³»ç»Ÿæ²¡æœ‰è‡ªåŠ¨æŒ‚è½½å®ƒï¼Œé‚£ä¹ˆæˆ‘æ¨èä½ æŠŠå®ƒåŠ å…¥åˆ°ç³»ç»Ÿå¼€æœºå¯åŠ¨è„šæœ¬é‡Œé¢ï¼Œè¿™æ ·æœºå™¨é‡å¯å eBPF ç¨‹åºä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œã€‚

æœ‰äº†è°ƒè¯•æ–‡ä»¶ç³»ç»Ÿï¼Œä½ å°±å¯ä»¥ä»Â `/sys/kernel/debug/tracing`Â ä¸­æ‰¾åˆ°æ‰€æœ‰å†…æ ¸é¢„å®šä¹‰çš„è·Ÿè¸ªç‚¹ï¼Œè¿›è€Œå¯ä»¥åœ¨éœ€è¦æ—¶æŠŠ eBPF ç¨‹åºæŒ‚è½½åˆ°å¯¹åº”çš„è·Ÿè¸ªç‚¹ã€‚

é™¤äº†å†…æ ¸å‡½æ•°å’Œè·Ÿè¸ªç‚¹ä¹‹å¤–ï¼Œæ€§èƒ½äº‹ä»¶åˆè¯¥å¦‚ä½•æŸ¥è¯¢å‘¢ï¼Ÿä½ å¯ä»¥ä½¿ç”¨ Linux æ€§èƒ½å·¥å…·Â [perf](https://man7.org/linux/man-pages/man1/perf.1.html)Â æ¥æŸ¥è¯¢æ€§èƒ½äº‹ä»¶çš„åˆ—è¡¨ã€‚å¦‚ä¸‹é¢çš„å‘½ä»¤æ‰€ç¤ºï¼Œä½ å¯ä»¥ä¸å¸¦å‚æ•°æŸ¥è¯¢æ‰€æœ‰çš„æ€§èƒ½äº‹ä»¶ï¼Œä¹Ÿå¯ä»¥åŠ å…¥å¯é€‰çš„äº‹ä»¶ç±»å‹å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼š

```bash
sudo perf list [hw|sw|cache|tracepoint|pmu|sdt|metric|metricgroup]
```

## **åˆ©ç”¨ bpftrace æŸ¥è¯¢è·Ÿè¸ªç‚¹**

è™½ç„¶ä½ å¯ä»¥åˆ©ç”¨å†…æ ¸è°ƒè¯•ä¿¡æ¯å’Œ perf å·¥å…·æŸ¥è¯¢å†…æ ¸å‡½æ•°ã€è·Ÿè¸ªç‚¹ä»¥åŠæ€§èƒ½äº‹ä»¶çš„åˆ—è¡¨ï¼Œä½†å®ƒä»¬çš„ä½ç½®æ¯”è¾ƒåˆ†æ•£ï¼Œå¹¶ä¸”ç”¨è¿™ç§æ–¹æ³•ä¹Ÿä¸å®¹æ˜“æŸ¥è¯¢å†…æ ¸å‡½æ•°çš„å®šä¹‰æ ¼å¼ã€‚æ‰€ä»¥ï¼Œæˆ‘å†ç»™ä½ æ¨èä¸€ä¸ªæ›´å¥½ç”¨çš„ eBPF å·¥å…·Â [bpftrace](https://github.com/iovisor/bpftrace/blob/master/docs/reference_guide.md)ã€‚

bpftrace åœ¨ eBPF å’Œ BCC ä¹‹ä¸Šæ„å»ºäº†ä¸€ä¸ªç®€åŒ–çš„è·Ÿè¸ªè¯­è¨€ï¼Œé€šè¿‡ç®€å•çš„å‡ è¡Œè„šæœ¬ï¼Œå°±å¯ä»¥å®ç°å¤æ‚çš„è·Ÿè¸ªåŠŸèƒ½ã€‚å¹¶ä¸”ï¼Œå¤šè¡Œçš„è·Ÿè¸ªæŒ‡ä»¤ä¹Ÿå¯ä»¥æ”¾åˆ°è„šæœ¬æ–‡ä»¶ä¸­æ‰§è¡Œï¼ˆè„šæœ¬åç¼€é€šå¸¸ä¸ºÂ `.bt`ï¼‰ã€‚

å¦‚ä¸‹å›¾ï¼ˆå›¾ç‰‡æ¥è‡ª bpftrace[æ–‡æ¡£](https://github.com/iovisor/bpftrace/blob/master/docs/internals_development.md)ï¼‰æ‰€ç¤ºï¼Œbpftrace ä¼šæŠŠä½ å¼€å‘çš„è„šæœ¬å€ŸåŠ© BCC ç¼–è¯‘åŠ è½½åˆ°å†…æ ¸ä¸­æ‰§è¡Œï¼Œå†é€šè¿‡ BPF æ˜ å°„è·å–æ‰§è¡Œçš„ç»“æœï¼š

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/17/fb/175853e38141433058e05770285ee5fb.png?wh=1500x1050 "bpftrace åŸç†")

å› æ­¤ï¼Œåœ¨ç¼–å†™ç®€å•çš„ eBPF ç¨‹åºï¼Œç‰¹åˆ«æ˜¯ç¼–å†™çš„ eBPF ç¨‹åºç”¨äºä¸´æ—¶çš„è°ƒè¯•å’Œæ’é”™æ—¶ï¼Œä½ å¯ä»¥è€ƒè™‘ç›´æ¥ä½¿ç”¨ bpftrace ï¼Œè€Œä¸éœ€è¦ç”¨ C æˆ– Python å»å¼€å‘ä¸€ä¸ªå¤æ‚çš„ç¨‹åºã€‚

é‚£ bpftrace è¯¥å¦‚ä½•å®‰è£…å‘¢ï¼Ÿå¯¹äº Ubuntu 19.04+ã€RHEL8+ ç­‰ç³»ç»Ÿï¼Œä½ å¯ä»¥ç›´æ¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥å®‰è£… bpftraceï¼š

```bash
# Ubuntu 19.04
sudo apt-get install -y bpftrace

# RHEL8/CentOS8
sudo dnf install -y bpftrace
```

è€Œå¯¹äºå…¶ä»–æ—§ç‰ˆæœ¬çš„ç³»ç»Ÿæˆ–å…¶ä»–çš„å‘è¡Œç‰ˆï¼Œä½ å¯ä»¥é€šè¿‡æºä»£ç ç¼–è¯‘çš„å½¢å¼å®‰è£…ã€‚è‡³äºå…·ä½“çš„æ­¥éª¤ï¼Œä½ å¯ä»¥å‚è€ƒå®ƒçš„[å®‰è£…æ–‡æ¡£](https://github.com/iovisor/bpftrace/blob/master/INSTALL.md)ï¼Œè¿™é‡Œæˆ‘å°±ä¸å±•å¼€è®²äº†ã€‚

å®‰è£…å¥½ bpftrace ä¹‹åï¼Œä½ å°±å¯ä»¥æ‰§è¡ŒÂ `bpftrace -l`Â æ¥æŸ¥è¯¢å†…æ ¸æ’æ¡©å’Œè·Ÿè¸ªç‚¹äº†ã€‚æ¯”å¦‚ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼æ¥æŸ¥è¯¢ï¼š

```bash
# æŸ¥è¯¢æ‰€æœ‰å†…æ ¸æ’æ¡©å’Œè·Ÿè¸ªç‚¹
sudo bpftrace -l

# ä½¿ç”¨é€šé…ç¬¦æŸ¥è¯¢æ‰€æœ‰çš„ç³»ç»Ÿè°ƒç”¨è·Ÿè¸ªç‚¹
sudo bpftrace -l 'tracepoint:syscalls:*'

# ä½¿ç”¨é€šé…ç¬¦æŸ¥è¯¢æ‰€æœ‰åå­—åŒ…å«"execve"çš„è·Ÿè¸ªç‚¹
sudo bpftrace -l '*execve*'
```

å¯¹äºè·Ÿè¸ªç‚¹æ¥è¯´ï¼Œä½ è¿˜å¯ä»¥åŠ ä¸ŠÂ `-v`Â å‚æ•°æŸ¥è¯¢å‡½æ•°çš„å…¥å£å‚æ•°æˆ–è¿”å›å€¼ã€‚è€Œç”±äºå†…æ ¸å‡½æ•°å±äºä¸ç¨³å®šçš„ APIï¼Œåœ¨ bpftrace ä¸­åªèƒ½é€šè¿‡Â `arg0`ã€`arg1`Â è¿™æ ·çš„å‚æ•°æ¥è®¿é—®ï¼Œå…·ä½“çš„å‚æ•°æ ¼å¼è¿˜éœ€è¦å‚è€ƒå†…æ ¸æºä»£ç ã€‚

æ¯”å¦‚ï¼Œä¸‹é¢å°±æ˜¯ä¸€ä¸ªæŸ¥è¯¢ç³»ç»Ÿè°ƒç”¨Â `execve`Â å…¥å£å‚æ•°ï¼ˆå¯¹åº”ç³»ç»Ÿè°ƒç”¨`sys_enter_execve`ï¼‰å’Œè¿”å›å€¼ï¼ˆå¯¹åº”ç³»ç»Ÿè°ƒç”¨`sys_exit_execve`ï¼‰çš„ç¤ºä¾‹ï¼š

```bash
# æŸ¥è¯¢execveå…¥å£å‚æ•°æ ¼å¼
$ sudo bpftrace -lv tracepoint:syscalls:sys_enter_execve
tracepoint:syscalls:sys_enter_execve
    int __syscall_nr
    const char * filename
    const char *const * argv
    const char *const * envp

# æŸ¥è¯¢execveè¿”å›å€¼æ ¼å¼
$ sudo bpftrace -lv tracepoint:syscalls:sys_exit_execve
tracepoint:syscalls:sys_exit_execve
    int __syscall_nr
    long ret
```

æ‰€ä»¥ï¼Œä½ æ—¢å¯ä»¥é€šè¿‡å†…æ ¸è°ƒè¯•ä¿¡æ¯å’Œ perf æ¥æŸ¥è¯¢å†…æ ¸å‡½æ•°ã€è·Ÿè¸ªç‚¹ä»¥åŠæ€§èƒ½äº‹ä»¶çš„åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ bpftrace å·¥å…·æ¥æŸ¥è¯¢ã€‚

åœ¨è¿™ä¸¤ç§æ–¹æ³•ä¸­ï¼Œæˆ‘æ›´æ¨èä½¿ç”¨æ›´ç®€å•çš„ bpftrace è¿›è¡ŒæŸ¥è¯¢ã€‚è¿™æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬é€šå¸¸åªéœ€è¦åœ¨å¼€å‘ç¯å¢ƒæŸ¥è¯¢è¿™äº›åˆ—è¡¨ï¼Œä»¥ä¾¿å»å‡†å¤‡ eBPF ç¨‹åºçš„æŒ‚è½½ç‚¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè™½ç„¶ bpftrace ä¾èµ– BCC å’Œ LLVM å¼€å‘å·¥å…·ï¼Œä½†å¼€å‘ç¯å¢ƒæœ¬æ¥å°±éœ€è¦è¿™äº›åº“å’Œå¼€å‘å·¥å…·ã€‚ç»¼åˆæ¥çœ‹ï¼Œç”¨ bpftrace å·¥å…·æ¥æŸ¥è¯¢çš„æ–¹æ³•æ˜¾ç„¶æ›´ç®€å•å¿«æ·ã€‚

åˆ°è¿™é‡Œï¼Œæˆ‘å·²ç»å¸¦ä½ äº†è§£äº†å†…æ ¸å‡½æ•°ã€è·Ÿè¸ªç‚¹ä»¥åŠæ€§èƒ½äº‹ä»¶çš„æŸ¥è¯¢æ–¹æ³•ï¼Œä½ æ˜¯ä¸æ˜¯è¿«ä¸åŠå¾…åœ°æƒ³å»å¼€å‘ä¸€ä¸ªå†…æ ¸è·Ÿè¸ªçš„ eBPF ç¨‹åºäº†ï¼Ÿ

åˆ«æ€¥ï¼Œåœ¨å¼€å‘ eBPF ç¨‹åºä¹‹å‰ï¼Œä½ è¿˜éœ€è¦åœ¨è¿™äº›é•¿é•¿çš„å‡½æ•°åˆ—è¡¨ä¸­è¿›è¡Œé€‰æ‹©ï¼Œç¡®å®šä½ åº”è¯¥æŒ‚è½½åˆ°å“ªä¸€ä¸ªä¸Šã€‚é‚£ä¹ˆï¼Œå…·ä½“è¯¥å¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿæ¥ä¸‹æ¥ï¼Œå°±è¿›å…¥æˆ‘ä»¬çš„æ¡ˆä¾‹ç¯èŠ‚ï¼Œä¸€èµ·çœ‹çœ‹å†…æ ¸è·Ÿè¸ªç‚¹çš„å…·ä½“ä½¿ç”¨æ–¹æ³•ã€‚

## **å¦‚ä½•åˆ©ç”¨å†…æ ¸è·Ÿè¸ªç‚¹æ’æŸ¥çŸ­æ—¶è¿›ç¨‹é—®é¢˜ï¼Ÿ**

åœ¨æ’æŸ¥ç³»ç»Ÿ CPU ä½¿ç”¨ç‡é«˜çš„é—®é¢˜æ—¶ï¼Œæˆ‘æƒ³ä½ å¾ˆå¯èƒ½é‡åˆ°è¿‡è¿™æ ·çš„å›°æƒ‘ï¼šæ˜æ˜é€šè¿‡Â `top`Â å‘½ä»¤å‘ç°ç³»ç»Ÿçš„ CPU ä½¿ç”¨ç‡ï¼ˆç‰¹åˆ«æ˜¯ç”¨æˆ· CPU ä½¿ç”¨ç‡ï¼‰ç‰¹åˆ«é«˜ï¼Œä½†é€šè¿‡Â `ps`ã€`pidstat`Â ç­‰å·¥å…·éƒ½æ‰¾ä¸å‡º CPU ä½¿ç”¨ç‡é«˜çš„è¿›ç¨‹ã€‚è¿™æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´çš„å‘¢ï¼Ÿä½ å¯ä»¥å…ˆåœä¸‹æ¥æ€è€ƒä¸€ä¸‹ï¼Œå†ç»§ç»­ä¸‹é¢çš„å†…å®¹ã€‚

ä½ æƒ³åˆ°å¯èƒ½çš„åŸå› äº†å—ï¼Ÿåœ¨æˆ‘çœ‹æ¥ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™ç±»é—®é¢˜å¾ˆå¯èƒ½æ˜¯ä»¥ä¸‹ä¸¤ä¸ªåŸå› å¯¼è‡´çš„ï¼š

- ç¬¬ä¸€ï¼Œåº”ç”¨ç¨‹åºé‡Œé¢ç›´æ¥è°ƒç”¨å…¶ä»–äºŒè¿›åˆ¶ç¨‹åºï¼Œå¹¶ä¸”è¿™äº›ç¨‹åºçš„è¿è¡Œæ—¶é—´å¾ˆçŸ­ï¼Œé€šè¿‡Â `top`Â å·¥å…·ä¸å®¹æ˜“å‘ç°ï¼›
- ç¬¬äºŒï¼Œåº”ç”¨ç¨‹åºè‡ªèº«åœ¨ä¸åœåœ°å´©æºƒé‡å¯ä¸­ï¼Œä¸”é‡å¯é—´éš”è¾ƒçŸ­ï¼Œå¯åŠ¨è¿‡ç¨‹ä¸­èµ„æºçš„åˆå§‹åŒ–å¯¼è‡´äº†é«˜ CPU ä½¿ç”¨ç‡ã€‚

ä½¿ç”¨Â `top`ã€`ps`Â ç­‰æ€§èƒ½å·¥å…·å¾ˆéš¾å‘ç°è¿™ç±»çŸ­æ—¶è¿›ç¨‹ï¼Œè¿™æ˜¯å› ä¸ºå®ƒä»¬éƒ½åªä¼šæŒ‰ç…§ç»™å®šçš„æ—¶é—´é—´éš”é‡‡æ ·ï¼Œè€Œä¸ä¼šå®æ—¶é‡‡é›†åˆ°æ‰€æœ‰æ–°åˆ›å»ºçš„è¿›ç¨‹ã€‚é‚£è¦å¦‚ä½•æ‰èƒ½é‡‡é›†åˆ°æ‰€æœ‰çš„çŸ­æ—¶è¿›ç¨‹å‘¢ï¼Ÿä½ è‚¯å®šå·²ç»æƒ³åˆ°äº†ï¼Œé‚£å°±æ˜¯**åˆ©ç”¨ eBPF çš„äº‹ä»¶è§¦å‘æœºåˆ¶ï¼Œè·Ÿè¸ªå†…æ ¸æ¯æ¬¡æ–°åˆ›å»ºçš„è¿›ç¨‹**ï¼Œè¿™æ ·å°±å¯ä»¥æªå‡ºè¿™äº›çŸ­æ—¶è¿›ç¨‹ã€‚

è¦è·Ÿè¸ªå†…æ ¸æ–°åˆ›å»ºçš„è¿›ç¨‹ï¼Œé¦–å…ˆå¾—æ‰¾åˆ°è¦è·Ÿè¸ªçš„å†…æ ¸å‡½æ•°æˆ–è·Ÿè¸ªç‚¹ã€‚å¦‚æœä½ äº†è§£è¿‡ Linux ç¼–ç¨‹ä¸­åˆ›å»ºè¿›ç¨‹çš„è¿‡ç¨‹ï¼Œæˆ‘æƒ³ä½ å·²ç»çŸ¥é“äº†ï¼Œåˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹é€šå¸¸éœ€è¦è°ƒç”¨Â `fork()`Â å’ŒÂ `execve()`Â è¿™ä¸¤ä¸ªæ ‡å‡†å‡½æ•°ï¼Œå®ƒä»¬çš„è°ƒç”¨è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/ef/1c/efda99288b5366ca24a00f374c6fba1c.jpg?wh=1920x2645 "Linuxè¿›ç¨‹åˆ›å»ºæµç¨‹")

å› ä¸ºæˆ‘ä»¬è¦å…³å¿ƒçš„ä¸»è¦æ˜¯æ–°åˆ›å»ºè¿›ç¨‹çš„åŸºæœ¬ä¿¡æ¯ï¼Œè€Œåƒè¿›ç¨‹åç§°å’Œå‚æ•°ç­‰ä¿¡æ¯éƒ½åœ¨Â `execve()`Â çš„å‚æ•°é‡Œï¼Œæ‰€ä»¥æˆ‘ä»¬å°±è¦æ‰¾å‡ºÂ `execve()`Â æ‰€å¯¹åº”çš„å†…æ ¸å‡½æ•°æˆ–è·Ÿè¸ªç‚¹ã€‚

å€ŸåŠ©åˆšæ‰æåˆ°çš„Â `bpftrace`Â å·¥å…·ï¼Œä½ å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼ŒæŸ¥è¯¢æ‰€æœ‰åŒ…å«Â `execve`Â å…³é”®å­—çš„è·Ÿè¸ªç‚¹ï¼š

```bash
sudo bpftrace -l '*execve*'
```

å‘½ä»¤æ‰§è¡Œåï¼Œä½ ä¼šå¾—åˆ°å¦‚ä¸‹çš„è¾“å‡ºå†…å®¹ï¼š

```plain
kprobe:__ia32_compat_sys_execve
kprobe:__ia32_compat_sys_execveat
kprobe:__ia32_sys_execve
kprobe:__ia32_sys_execveat
kprobe:__x32_compat_sys_execve
kprobe:__x32_compat_sys_execveat
kprobe:__x64_sys_execve
kprobe:__x64_sys_execveat
kprobe:audit_log_execve_info
kprobe:bprm_execve
kprobe:do_execveat_common.isra.0
kprobe:kernel_execve
tracepoint:syscalls:sys_enter_execve
tracepoint:syscalls:sys_enter_execveat
tracepoint:syscalls:sys_exit_execve
tracepoint:syscalls:sys_exit_execveat
```

ä»è¾“å‡ºä¸­ï¼Œä½ å¯ä»¥å‘ç°è¿™äº›å‡½æ•°å¯ä»¥åˆ†ä¸ºå†…æ ¸æ’æ¡©ï¼ˆkprobeï¼‰å’Œè·Ÿè¸ªç‚¹ï¼ˆtracepointï¼‰ä¸¤ç±»ã€‚åœ¨ä¸Šä¸€å°èŠ‚ä¸­æˆ‘æ›¾æåˆ°ï¼Œå†…æ ¸æ’æ¡©å±äºä¸ç¨³å®šæ¥å£ï¼Œè€Œè·Ÿè¸ªç‚¹åˆ™æ˜¯ç¨³å®šæ¥å£ã€‚å› è€Œï¼Œ**åœ¨å†…æ ¸æ’æ¡©å’Œè·Ÿè¸ªç‚¹ä¸¤è€…éƒ½å¯ç”¨çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥é€‰æ‹©æ›´ç¨³å®šçš„è·Ÿè¸ªç‚¹ï¼Œä»¥ä¿è¯ eBPF ç¨‹åºçš„å¯ç§»æ¤æ€§ï¼ˆå³åœ¨ä¸åŒç‰ˆæœ¬çš„å†…æ ¸ä¸­éƒ½å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼‰**ã€‚

æ’é™¤æ‰Â `kprobe`Â ç±»å‹ä¹‹åï¼Œå‰©ä¸‹çš„Â `tracepoint:syscalls:sys_enter_execve`ã€`tracepoint:syscalls:sys_enter_execveat`ã€`tracepoint:syscalls:sys_exit_execve`Â ä»¥åŠÂ `tracepoint:syscalls:sys_exit_execveat`Â å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ eBPF è·Ÿè¸ªç‚¹ã€‚å…¶ä¸­ï¼Œ`sys_enter_`Â å’ŒÂ `sys_exit_`Â åˆ†åˆ«è¡¨ç¤ºåœ¨ç³»ç»Ÿè°ƒç”¨çš„å…¥å£å’Œå‡ºå£æ‰§è¡Œã€‚

åªæœ‰è·Ÿè¸ªç‚¹çš„åˆ—è¡¨è¿˜ä¸å¤Ÿï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æƒ³çŸ¥é“å…·ä½“å¯åŠ¨çš„è¿›ç¨‹åç§°ã€å‘½ä»¤è¡Œé€‰é¡¹ä»¥åŠè¿”å›å€¼ï¼Œè€Œè¿™äº›ä¹Ÿéƒ½å¯ä»¥é€šè¿‡ bpftrace æ¥æŸ¥è¯¢ã€‚åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå³å¯æŸ¥è¯¢ï¼š

```bash
# æŸ¥è¯¢sys_enter_execveå…¥å£å‚æ•°
$ sudo bpftrace -lv tracepoint:syscalls:sys_enter_execve
tracepoint:syscalls:sys_enter_execve
    int __syscall_nr
    const char * filename
    const char *const * argv
    const char *const * envp

# æŸ¥è¯¢sys_exit_execveè¿”å›å€¼
$ sudo bpftrace -lv tracepoint:syscalls:sys_exit_execve
tracepoint:syscalls:sys_exit_execve
    int __syscall_nr
    long ret

# æŸ¥è¯¢sys_enter_execveatå…¥å£å‚æ•°
$ sudo bpftrace -lv tracepoint:syscalls:sys_enter_execveat
tracepoint:syscalls:sys_enter_execveat
    int __syscall_nr
    int fd
    const char * filename
    const char *const * argv
    const char *const * envp
    int flags

# æŸ¥è¯¢sys_exit_execveatè¿”å›å€¼
$ sudo bpftrace -lv tracepoint:syscalls:sys_exit_execveat
tracepoint:syscalls:sys_exit_execveat
    int __syscall_nr
    long ret
```

ä»è¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°ï¼Œ`sys_enter_execveat()`Â æ¯”Â `sys_enter_execve()`Â å¤šäº†ä¸¤ä¸ªå‚æ•°ï¼Œè€Œæ–‡ä»¶åÂ `filename`ã€å‘½ä»¤è¡Œé€‰é¡¹Â `argv`Â ä»¥åŠè¿”å›å€¼Â `ret`çš„å®šä¹‰éƒ½æ˜¯ä¸€æ ·çš„ã€‚

åˆ°è¿™é‡Œï¼Œæˆ‘å¸¦ä½ ä½¿ç”¨ bpftrace æŸ¥è¯¢åˆ°äº† execve ç›¸å…³çš„è·Ÿè¸ªç‚¹ï¼Œä»¥åŠè¿™äº›è·Ÿè¸ªç‚¹çš„å…·ä½“æ ¼å¼ã€‚æ¥ä¸‹æ¥ï¼Œä¸ºäº†å¸®ä½ å…¨æ–¹ä½æŒæ¡ eBPF ç¨‹åºçš„å¼€å‘è¿‡ç¨‹ï¼Œæˆ‘ä¼šä»¥ bpftraceã€BCC å’Œ libbpf è¿™ä¸‰ç§æ–¹å¼ä¸ºä¾‹ï¼Œå¸¦ä½ å¼€å‘ä¸€ä¸ªè·Ÿè¸ªçŸ­æ—¶è¿›ç¨‹çš„ eBPF ç¨‹åºã€‚è¿™ä¸‰ç§æ–¹å¼å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œåœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­éƒ½æœ‰å¤§é‡çš„åº”ç”¨ï¼š

- **bpftrace é€šå¸¸ç”¨åœ¨å¿«é€Ÿæ’æŸ¥å’Œå®šä½ç³»ç»Ÿä¸Šï¼Œå®ƒæ”¯æŒç”¨å•è¡Œè„šæœ¬çš„æ–¹å¼æ¥å¿«é€Ÿå¼€å‘å¹¶æ‰§è¡Œä¸€ä¸ª eBPF ç¨‹åºã€‚**ä¸è¿‡ï¼Œbpftrace çš„åŠŸèƒ½æœ‰é™ï¼Œä¸æ”¯æŒç‰¹åˆ«å¤æ‚çš„ eBPF ç¨‹åºï¼Œä¹Ÿä¾èµ–äº BCC å’Œ LLVM åŠ¨æ€ç¼–è¯‘æ‰§è¡Œã€‚
- **BCC é€šå¸¸ç”¨åœ¨å¼€å‘å¤æ‚çš„ eBPF ç¨‹åºä¸­ï¼Œå…¶å†…ç½®çš„å„ç§å°å·¥å…·ä¹Ÿæ˜¯ç›®å‰åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ eBPF å°ç¨‹åºã€‚**ä¸è¿‡ï¼ŒBCC ä¹Ÿä¸æ˜¯å®Œç¾çš„ï¼Œå®ƒä¾èµ–äº LLVM å’Œå†…æ ¸å¤´æ–‡ä»¶æ‰å¯ä»¥åŠ¨æ€ç¼–è¯‘å’ŒåŠ è½½ eBPF ç¨‹åºã€‚
- **libbpf æ˜¯ä»å†…æ ¸ä¸­æŠ½ç¦»å‡ºæ¥çš„æ ‡å‡†åº“ï¼Œç”¨å®ƒå¼€å‘çš„ eBPF ç¨‹åºå¯ä»¥ç›´æ¥åˆ†å‘æ‰§è¡Œï¼Œè¿™æ ·å°±ä¸éœ€è¦æ¯å°æœºå™¨éƒ½å®‰è£… LLVM å’Œå†…æ ¸å¤´æ–‡ä»¶äº†ã€‚**ä¸è¿‡ï¼Œå®ƒè¦æ±‚å†…æ ¸å¼€å¯ BTF ç‰¹æ€§ï¼Œéœ€è¦éå¸¸æ–°çš„å‘è¡Œç‰ˆæ‰ä¼šé»˜è®¤å¼€å¯ï¼ˆå¦‚ RHEL 8.2+ å’Œ Ubuntu 20.10+ ç­‰ï¼‰ã€‚

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯ä»¥æ ¹æ®ä½ çš„å†…æ ¸ç‰ˆæœ¬ã€å†…æ ¸é…ç½®ã€eBPF ç¨‹åºå¤æ‚åº¦ï¼Œä»¥åŠæ˜¯å¦å…è®¸å®‰è£…å†…æ ¸å¤´æ–‡ä»¶å’Œ LLVM ç­‰ç¼–è¯‘å·¥å…·ç­‰ï¼Œæ¥é€‰æ‹©æœ€åˆé€‚çš„æ–¹æ¡ˆã€‚

### **bpftrace æ–¹æ³•**

è¿™ä¸€è®²æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ï¼Œå¦‚ä½•ä½¿ç”¨ bpftrace æ¥è·Ÿè¸ªçŸ­æ—¶è¿›ç¨‹ã€‚

ç”±äºÂ `execve()`Â å’ŒÂ `execveat()`Â è¿™ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨çš„å…¥å£å‚æ•°æ–‡ä»¶åÂ `filename`Â å’Œå‘½ä»¤è¡Œé€‰é¡¹Â `argv`Â ï¼Œä»¥åŠè¿”å›å€¼Â `ret`Â çš„å®šä¹‰éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå› è€Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸¤ä¸ªè·Ÿè¸ªç‚¹æ”¾åˆ°ä¸€èµ·æ¥å¤„ç†ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆå¿½ç•¥è¿”å›å€¼ï¼Œåªçœ‹å…¥å£å‚æ•°ã€‚æ‰“å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œæ‰§è¡Œä¸‹é¢çš„ bpftrace å‘½ä»¤ï¼š

```bash
sudo bpftrace -e 'tracepoint:syscalls:sys_enter_execve,tracepoint:syscalls:sys_enter_execveat { printf("%-6d %-8s", pid, comm); join(args->argv);}'
```

è¿™ä¸ªå‘½ä»¤ä¸­çš„å…·ä½“å†…å®¹å«ä¹‰å¦‚ä¸‹ï¼š

- `bpftrace -e`Â è¡¨ç¤ºç›´æ¥ä»åé¢çš„å­—ç¬¦ä¸²å‚æ•°ä¸­è¯»å…¥ bpftrace ç¨‹åºï¼ˆé™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜æ”¯æŒä»æ–‡ä»¶ä¸­è¯»å…¥ bpftrace ç¨‹åºï¼‰ï¼›
- `tracepoint:syscalls:sys_enter_execve,tracepoint:syscalls:sys_enter_execveat`Â è¡¨ç¤ºç”¨é€—å·åˆ†éš”çš„å¤šä¸ªè·Ÿè¸ªç‚¹ï¼Œå…¶åçš„ä¸­æ‹¬å·è¡¨ç¤ºè·Ÿè¸ªç‚¹çš„å¤„ç†å‡½æ•°ï¼›
- `printf()`Â è¡¨ç¤ºå‘ç»ˆç«¯ä¸­æ‰“å°å­—ç¬¦ä¸²ï¼Œå…¶ç”¨æ³•ç±»ä¼¼äº C è¯­è¨€ä¸­çš„Â `printf()`Â å‡½æ•°ï¼›
- `pid`Â å’ŒÂ `comm`Â æ˜¯ bpftrace å†…ç½®çš„å˜é‡ï¼Œåˆ†åˆ«è¡¨ç¤ºè¿›ç¨‹ PID å’Œè¿›ç¨‹åç§°ï¼ˆä½ å¯ä»¥åœ¨å…¶[å®˜æ–¹æ–‡æ¡£](https://github.com/iovisor/bpftrace/blob/master/docs/reference_guide.md#1-builtins)ä¸­æ‰¾åˆ°å…¶ä»–çš„å†…ç½®å˜é‡ï¼‰ï¼›
- `join(args->argv)`Â è¡¨ç¤ºæŠŠå­—ç¬¦ä¸²æ•°ç»„æ ¼å¼çš„å‚æ•°ç”¨ç©ºæ ¼æ‹¼æ¥èµ·æ¥ï¼Œå†æ‰“å°åˆ°ç»ˆç«¯ä¸­ã€‚å¯¹äºè·Ÿè¸ªç‚¹æ¥è¯´ï¼Œä½ å¯ä»¥ä½¿ç”¨Â `args->å‚æ•°å`Â çš„æ–¹å¼ç›´æ¥è¯»å–å‚æ•°ï¼ˆæ¯”å¦‚è¿™é‡Œçš„Â `args->argv`Â å°±æ˜¯è¯»å–ç³»ç»Ÿè°ƒç”¨ä¸­çš„Â `argv`Â å‚æ•°ï¼‰ã€‚

åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­æ‰§è¡ŒÂ `ls`Â å‘½ä»¤ï¼Œç„¶åä½ ä¼šåœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯ä¸­çœ‹åˆ°å¦‚ä¸‹çš„è¾“å‡ºï¼š

```plain
Attaching 2 probes...
157286 zsh     ls --color=tty
157289 zsh     git rev-parse --git-dir
```

ä½ å¯ä»¥å‘ç°ï¼Œæˆ‘çš„ç³»ç»Ÿä½¿ç”¨äº†Â `zsh`Â ç»ˆç«¯ï¼Œåœ¨Â `zsh`Â ç»ˆç«¯ä¸­æ‰§è¡Œäº†`ls`Â å’ŒÂ `git`Â å‘½ä»¤ã€‚è¿™å„¿å¤šäº†ä¸ªÂ `git`Â å‘½ä»¤ï¼Œæ˜¯å› ä¸ºæˆ‘ä¸ºÂ `zsh`Â é…ç½®äº†Â `git`Â æ’ä»¶ï¼Œè€Œæ’ä»¶æ˜¯ç”±Â `zsh`Â è‡ªåŠ¨è°ƒç”¨çš„ã€‚

æ­å–œä½ ï¼Œç°åœ¨ä½ å·²ç»å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„å•è¡Œå‘½ä»¤æ¥è·Ÿè¸ªçŸ­æ—¶è¿›ç¨‹é—®é¢˜äº†ã€‚ä¸è¿‡ï¼Œè¿™ä¸ªç¨‹åºè¿˜ä¸å¤Ÿå®Œå–„ï¼Œå› ä¸ºå®ƒçš„è¿”å›å€¼è¿˜æ²¡æœ‰å¤„ç†ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•å¤„ç†è¿”å›å€¼å‘¢ï¼Ÿ

ä¸€ä¸ªæœ€ç®€å•çš„æ€è·¯å°±æ˜¯åœ¨ç³»ç»Ÿè°ƒç”¨çš„å…¥å£æŠŠå‚æ•°ä¿å­˜åˆ° BPF æ˜ å°„ä¸­ï¼Œç„¶åå†åœ¨ç³»ç»Ÿè°ƒç”¨å‡ºå£è·å–è¿”å›å€¼åä¸€èµ·è¾“å‡ºã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥å°è¯•æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼ŒæŠŠæ–°è¿›ç¨‹çš„å‚æ•°å­˜å…¥å“ˆå¸Œæ˜ å°„ä¸­ï¼š

```bash
# å…¶ä¸­ï¼Œtidè¡¨ç¤ºçº¿ç¨‹IDï¼Œ@execs[tid]è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªå“ˆå¸Œæ˜ å°„
sudo bpftrace -e 'tracepoint:syscalls:sys_enter_execve,tracepoint:syscalls:sys_enter_execveat {@execs[tid] = join(args->argv);}'
```

å¾ˆé—æ†¾ï¼Œè¿™æ¡å‘½ä»¤å¹¶ä¸èƒ½æ­£å¸¸è¿è¡Œã€‚æ ¹æ®ä¸‹é¢çš„é”™è¯¯ä¿¡æ¯ï¼Œä½ å¯ä»¥å‘ç°ï¼Œ`join()`Â è¿™ä¸ªå†…ç½®å‡½æ•°æ²¡æœ‰è¿”å›å­—ç¬¦ä¸²ï¼Œä¸èƒ½ç”¨æ¥èµ‹å€¼ï¼š

```plain
stdin:1:92-108: ERROR: join() should not be used in an assignment or as a map key
```

å®é™…ä¸Šï¼Œåœ¨ bpftrace çš„ GitHub é¡µé¢ä¸Šï¼Œå·²ç»æœ‰å…¶ä»–ç”¨æˆ·æ±‡æŠ¥äº†åŒæ ·çš„[é—®é¢˜](https://github.com/iovisor/bpftrace/issues/1390)ï¼Œå¹¶ä¸”åˆ°ç°åœ¨è¿˜æ˜¯æ²¡æœ‰è§£å†³ã€‚

æ­£å¦‚æˆ‘å‰é¢æåˆ°çš„ï¼Œbpftrace æœ¬èº«å¹¶ä¸é€‚ç”¨äºæ‰€æœ‰çš„ eBPF åº”ç”¨ã€‚å¦‚æœæ˜¯å¤æ‚çš„åº”ç”¨ï¼Œæˆ‘è¿˜æ˜¯æ¨èä½¿ç”¨ BCC æˆ–è€… libbpf å¼€å‘ã€‚å…³äº BCC å’Œ libbpf çš„å…·ä½“ä½¿ç”¨æ–¹æ³•ï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€è®²ï¼Œä¹Ÿå°±æ˜¯â€œå†…æ ¸è·Ÿè¸ªâ€çš„ä¸‹ç¯‡ä¸­ç»§ç»­ä¸ºä½ è®²è§£ã€‚

## **å°ç»“**

ä»Šå¤©ï¼Œæˆ‘å¸¦ä½ æ¢³ç†äº†æŸ¥è¯¢ eBPF è·Ÿè¸ªç‚¹çš„å¸¸ç”¨æ–¹æ³•ï¼Œå¹¶ä»¥çŸ­æ—¶è¿›ç¨‹çš„è·Ÿè¸ªä¸ºä¾‹ï¼Œé€šè¿‡ bpftrace å®ç°äº†çŸ­æ—¶è¿›ç¨‹çš„è·Ÿè¸ªç¨‹åºã€‚

åœ¨è·Ÿè¸ªå†…æ ¸æ—¶ï¼Œä½ è¦è®°å¾—ï¼Œæ‰€æœ‰çš„å†…æ ¸è·Ÿè¸ªéƒ½æ˜¯è¢«å†…æ ¸å‡½æ•°ã€å†…æ ¸è·Ÿè¸ªç‚¹æˆ–æ€§èƒ½äº‹ä»¶ç­‰äº‹ä»¶æºè§¦å‘åæ‰æ‰§è¡Œçš„ã€‚æ‰€ä»¥ï¼Œåœ¨è·Ÿè¸ªå†…æ ¸ä¹‹å‰ï¼Œæˆ‘ä»¬å°±éœ€è¦é€šè¿‡è°ƒè¯•ä¿¡æ¯ã€perfã€bpftrace ç­‰ï¼Œæ‰¾åˆ°è¿™äº›äº‹ä»¶æºï¼Œç„¶åå†åˆ©ç”¨ eBPF æä¾›çš„å¼ºå¤§åŠŸèƒ½å»è·Ÿè¸ªè¿™äº›äº‹ä»¶çš„æ‰§è¡Œè¿‡ç¨‹ã€‚

bpftrace æ˜¯ä¸€ä¸ªä½¿ç”¨æœ€ä¸ºç®€å•çš„ eBPF å·¥å…·ï¼Œå› æ­¤åœ¨åˆå­¦ eBPF æ—¶ï¼Œå»ºè®®ä½ å¯ä»¥ä»å®ƒå¼€å§‹ã€‚bpftrace æä¾›äº†ä¸€ä¸ªç®€å•çš„è„šæœ¬è¯­è¨€ï¼Œåªéœ€è¦ç®€å•çš„å‡ æ¡è„šæœ¬å°±å¯ä»¥å®ç°å¾ˆä¸°å¯Œçš„ eBPF ç¨‹åºã€‚å®ƒé€šå¸¸ç”¨åœ¨å¿«é€Ÿæ’æŸ¥å’Œå®šä½ç³»ç»Ÿä¸Šï¼Œå¹¶æ”¯æŒç”¨å•è¡Œè„šæœ¬çš„æ–¹å¼æ¥å¿«é€Ÿå¼€å‘å¹¶æ‰§è¡Œä¸€ä¸ª eBPF ç¨‹åºã€‚

è™½ç„¶ bpftrace å¾ˆå¥½ç”¨ï¼Œä½†ä½ ä¹Ÿè¦æ³¨æ„ï¼Œå®ƒå¹¶ä¸é€‚åˆæ‰€æœ‰çš„ eBPF åº”ç”¨åœºæ™¯ã€‚æˆ‘é€šå¸¸æŠŠå®ƒä½œä¸º eBPF è·Ÿè¸ªç¨‹åºçš„åŸå‹ä½¿ç”¨ï¼Œå½“éœ€è¦åœ¨ç”Ÿäº§ç¯å¢ƒè¿è¡Œ eBPF ç¨‹åºæ—¶ï¼Œå†åˆ‡æ¢åˆ° BCC æˆ–è€… libbpfã€‚

## **æ€è€ƒé¢˜**

è™½ç„¶ä½¿ç”¨ bpftrace æ—¶è¿˜æœ‰å¾ˆå¤šçš„é™åˆ¶ï¼Œä½†ä»Šå¤©æˆ‘å¸¦ä½ å¼€å‘çš„è¿™ä¸ªè·Ÿè¸ªç¨‹åºï¼Œå…¶å®å·²ç»å¯ä»¥ç”¨åˆ°çŸ­æ—¶è¿›ç¨‹é—®é¢˜çš„æ’æŸ¥ä¸­äº†ã€‚å› ä¸ºé€šå¸¸æ¥è¯´ï¼Œåœ¨è§£å†³çŸ­æ—¶è¿›ç¨‹å¼•å‘çš„æ€§èƒ½é—®é¢˜æ—¶ï¼Œæ‰¾å‡ºçŸ­æ—¶è¿›ç¨‹æ‰æ˜¯æœ€é‡è¦çš„ã€‚è‡³äºçŸ­æ—¶è¿›ç¨‹çš„æ‰§è¡Œç»“æœï¼Œæˆ‘ä»¬ä¸€èˆ¬å¯ä»¥é€šè¿‡æ—¥å¿—çœ‹åˆ°è¯¦ç»†çš„è¿è¡Œè¿‡ç¨‹ã€‚

ä¸è¿‡ï¼Œè¿™ä¸ªè·Ÿè¸ªç¨‹åºè¿˜æ˜¯æœ‰ä¸€äº›æ¯”è¾ƒå¤§çš„é™åˆ¶ï¼Œæ¯”å¦‚ï¼š

- æ²¡æœ‰è¾“å‡ºæ—¶é—´æˆ³ï¼Œè¿™æ ·å»å¤§é‡æ—¥å¿—é‡Œé¢å®šä½é—®é¢˜å°±æ¯”è¾ƒå›°éš¾ï¼›
- æ²¡æœ‰çˆ¶è¿›ç¨‹ PIDï¼Œè¿˜éœ€è¦ä¸€äº›é¢å¤–çš„å·¥å…·æˆ–ç»éªŒï¼Œæ‰å¯ä»¥æ‰¾å‡ºçˆ¶è¿›ç¨‹ã€‚

é‚£ä¹ˆï¼Œè¿™äº›é—®é¢˜è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿä½ å¯ä»¥åœ¨ä»Šå¤©çš„ bpftrace è„šæœ¬åŸºç¡€ä¸Šæ”¹è¿›ï¼ŒæŠŠæ—¶é—´æˆ³å’Œçˆ¶è¿›ç¨‹ PID ä¹Ÿè¾“å‡ºåˆ°ç»“æœä¸­å—ï¼Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºç•™ä¸‹ä½ çš„æ€è€ƒå’Œå®è·µç»éªŒã€‚

æœŸå¾…ä½ åœ¨ç•™è¨€åŒºå’Œæˆ‘è®¨è®ºï¼Œä¹Ÿæ¬¢è¿æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™ä½ çš„åŒäº‹ã€æœ‹å‹ã€‚è®©æˆ‘ä»¬ä¸€èµ·åœ¨å®æˆ˜ä¸­æ¼”ç»ƒï¼Œåœ¨äº¤æµä¸­è¿›æ­¥ã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ13ï¼‰</strong></div><ul>
<li><span>è«å</span> ğŸ‘ï¼ˆ37ï¼‰ ğŸ’¬ï¼ˆ5ï¼‰<p>1ã€é¦–å…ˆç»™å€ªè€å¸ˆæä¸ªé—®é¢˜ã€‚ã€ä»¥ v5.13.0 ä¸ºä¾‹ï¼Œæ€»çš„å†…æ ¸å‡½æ•°æ•°é‡å·²ç»è¶…è¿‡äº† 16 ä¸‡ã€‘è§‰å¾—è¿™ä¸€è¡¨è¿°ä¸å¤ªå‡†ç¡®ï¼Œå†…æ ¸ç¬¦å·è¡¨ &#47;proc&#47;kallsyms ä¸ä»…åŒ…å«äº†å†…æ ¸å‡½æ•°(staticã€é static)ï¼Œè¿˜åŒ…å«äº†éæ ˆæ•°æ®å˜é‡ã€‚&#47;proc&#47;kallsyms è¾“å‡ºçš„ç¬¬äºŒåˆ—è¡¨ç¤ºç¬¦å·ç±»å‹ï¼ŒåŒ…æ‹¬ Aã€bã€Dã€tã€T ç­‰ï¼Œå…¶ä¸­ T(t) è¡¨ç¤ºä»£ç æ®µç¬¦å·è¡¨ï¼Œå¤§æ¦‚æœ‰ 7w+ å†…æ ¸å‡½æ•°ï¼ˆå…¶å®è¿˜æœ‰æå°‘æ•°å¹¶éçœŸæ­£çš„å†…æ ¸å‡½æ•°ï¼‰ã€‚ è¿™ 7w+ å†…æ ¸å‡½æ•°ä¸­ï¼Œåªæœ‰è¢«æ˜¾å¼å¯¼å‡ºçš„å†…æ ¸å‡½æ•°ï¼ˆ5w+ï¼‰æ‰èƒ½è¢« BPF kprobe ç±»å‹ç¨‹åºåŠ¨æ€è¿½è¸ªã€‚

ä»¥ 5.13 å†…æ ¸ç‰ˆæœ¬ä¸ºä¾‹ï¼Œå¯é€šè¿‡ tracefs æˆ– bpftrace ç»Ÿè®¡ï¼Œå…± 52259 ä¸ªå†…æ ¸å‡½æ•°å¯ä»¥è¢« BPF åˆ©ç”¨ kprobe æŠ€æœ¯åŠ¨æ€è¿½è¸ªï¼š

# cat &#47;sys&#47;kernel&#47;debug&#47;tracing&#47;available_filter_functions | wc -l
52259

# bpftrace -l &#39;kprobe:*&#39; | wc -l
52259

2ã€è¯¾åæ€è€ƒé¢˜ï¼Œå€Ÿç”¨ bpftrace å†…ç½®å‡½æ•° time() è¾“å‡ºæ—¶é—´ &amp; å†…ç½®å˜é‡ curtask è·å–çˆ¶è¿›ç¨‹ pidï¼ˆ$task-&gt;parent-&gt;tgidï¼‰ï¼Œå†™æˆå•è¡Œç¨‹åºçœ‹èµ·æ¥ä¸å¤ªç›´è§‚ï¼Œæ•´ç†ä¸ºä»¥ä¸‹è„šæœ¬ execsnoop.btã€‚

---------------- execsnoop.bt -----------------

#!&#47;usr&#47;bin&#47;bpftrace

#include &lt;linux&#47;sched.h&gt;

BEGIN
{
    printf(&quot;%-9s %-6s %-6s %-16s %s\n&quot;, &quot;TIME&quot;, &quot;PID&quot;, &quot;PPID&quot;, &quot;COMM&quot;, &quot;ARGS&quot;)
}

tracepoint:syscalls:sys_enter_execve,
tracepoint:syscalls:sys_enter_execveat
{
    $task = (struct task_struct *)curtask;

    time(&quot;%H:%M:%S  &quot;);
    printf(&quot;%-6d %-6d %-16s&quot;, pid, $task-&gt;parent-&gt;tgid, comm);
    join(args-&gt;argv);
}</p>2022-01-31</li><br/><li><span>Geek_508898</span> ğŸ‘ï¼ˆ7ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<p>bpftrace --include linux&#47;sched.h -e &#39;tracepoint:syscalls:sys_enter_execve,tracepoint:syscalls:sys_enter_execveat { time(&quot;%H:%M:%S &quot;);printf(&quot;%-6d %-6d %-8s &quot;, pid,curtask-&gt;parent-&gt;pid, comm); join(args-&gt;argv)}&#39;</p>2022-02-08</li><br/><li><span>Tok1c</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>Ubuntu 22.04
ERROR: Could not resolve symbol: &#47;proc&#47;self&#47;exe:BEGIN_trigger

è§£å†³æ–¹æ¡ˆï¼š

https:&#47;&#47;github.com&#47;iovisor&#47;bpftrace&#47;issues&#47;2168

echo &quot;deb http:&#47;&#47;ddebs.ubuntu.com $(lsb_release -cs) main restricted universe multiverse
deb http:&#47;&#47;ddebs.ubuntu.com $(lsb_release -cs)-updates main restricted universe multiverse
deb http:&#47;&#47;ddebs.ubuntu.com $(lsb_release -cs)-proposed main restricted universe multiverse&quot; | \
sudo tee -a &#47;etc&#47;apt&#47;sources.list.d&#47;ddebs.list
sudo apt install ubuntu-dbgsym-keyring
sudo apt update
sudo apt install bpftrace-dbgsym

</p>2022-10-07</li><br/><li><span>muggle</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>æ‰§è¡Œ  bpftrace -l &#39;*execve*&#39;
stdin:1:1-8: ERROR: No probe type matched for *execve
*execve*
~~~~~~~
é‡åˆ°è¿™ä¸ªçš„å¯ä»¥å‡çº§ä¸‹bpftraceç‰ˆæœ¬ï¼Œ0.13.0+  
https:&#47;&#47;github.com&#47;iovisor&#47;bpftrace&#47;pull&#47;1775

</p>2022-03-07</li><br/><li><span>åš</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆï¼Œæˆ‘çš„ç³»ç»Ÿæ˜¯Ubuntu21.10ï¼Œæˆ‘åœ¨æ‰§è¡Œsudo bpftrace -l &#39;*execve*&#39;çš„æ—¶å€™ï¼Œå‘ç°é™¤äº†å†…æ ¸æ’æ¡©ï¼ˆkprobeï¼‰å’Œè·Ÿè¸ªç‚¹ï¼ˆtracepointï¼‰è¿™ä¸¤ç±»ï¼Œè¿˜æœ‰ä¸€ç±»kfuncï¼Œæˆ‘ç™¾åº¦äº†ä¸€ä¸‹ï¼Œè¿˜æ˜¯ä¸å¤ªäº†è§£è¿™ä¸ªä¸œè¥¿ï¼Œè€å¸ˆå¯ä»¥ç®€å•è¯´è¯´å—ï¼Ÿ</p>2022-02-23</li><br/><li><span>Geek_b914ab</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>$ sudo bpftrace -e &#39;tracepoint:syscalls:sys_enter_execve { printf(&quot;%ld %s  &quot;, nsecs, comm); join(args-&gt;argv);}&#39;
Attaching 1 probe...
349663019454998 core::system::S  &#47;usr&#47;bin&#47;cat &#47;proc&#47;cpuinfo
349663023173472 core::system::S  &#47;usr&#47;bin&#47;lscpu
349665017216698 core::system::S  &#47;usr&#47;bin&#47;cat &#47;proc&#47;cpuinfo
349665040019654 core::system::S  &#47;usr&#47;bin&#47;lscpu
349667017603472 core::system::S  &#47;usr&#47;bin&#47;cat &#47;proc&#47;cpuinfo
349667040035265 core::system::S  &#47;usr&#47;bin&#47;lscpu
349669017626924 core::system::S  &#47;usr&#47;bin&#47;cat &#47;proc&#47;cpuinfo
349669039803679 core::system::S  &#47;usr&#47;bin&#47;lscpu
349671018720543 core::system::S  &#47;usr&#47;bin&#47;cat &#47;proc&#47;cpuinfo
349671039711997 core::system::S  &#47;usr&#47;bin&#47;lscpu
349673018112968 core::system::S  &#47;usr&#47;bin&#47;cat &#47;proc&#47;cpuinfo
349673039088168 core::system::S  &#47;usr&#47;bin&#47;lscpu
349675016659748 core::system::S  &#47;usr&#47;bin&#47;cat &#47;proc&#47;cpuinfo
349675039289844 core::system::S  &#47;usr&#47;bin&#47;lscpu
349677018311393 core::system::S  &#47;usr&#47;bin&#47;cat &#47;proc&#47;cpuinfo

å‘ç°æ¯éš”2Så°±æœ‰ä¸€ä¸ªcore::system::Sçš„è¿›ç¨‹ä¸æ–­ä½¿ç”¨lscpuå¹¶è¯»å–çš„å†…å®¹&#47;proc&#47;cpuinfoï¼Œè¿™ä¸ªcore::system::Sæ˜¯ä¸ªå•¥å‘¢ï¼Ÿ</p>2022-03-04</li><br/><li><span>Li. Mr</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<p>è¯·é—®å€ªè€å¸ˆï¼Œebpfèƒ½å¯¹è¿›ç¨‹çš„I&#47;Oè¡Œä¸ºåšæ¯”è¾ƒç»†è‡´ç´§å¯†çš„ç›‘æ§æ¢æµ‹ä¹ˆï¼Ÿ</p>2022-02-27</li><br/><li><span>åš</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆå¥½ï¼Œæˆ‘æœ‰ä¸ªç–‘é—®ï¼ŒeBPFå’Œftraceræœ‰ä»€ä¹ˆå…³ç³»å—ï¼Ÿæˆ‘çœ‹ä¸¤ä¸ªéƒ½æ˜¯åœ¨debugfsä¸‹çš„tracingè¿™ä¸ªç›®å½•æ“ä½œçš„</p>2022-02-17</li><br/><li><span>heyhd9475</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è¯·é—®è€å¸ˆï¼Œbpftraceæ— æ³•æ”¯æŒforå¾ªç¯å’Œæ•°ç»„ä¸´æ—¶å˜é‡å—</p>2022-02-16</li><br/><li><span>Ethan Liu</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>ä½¿ç”¨bpftraceèƒ½æŸ¥è¯¢æ€§èƒ½äº‹ä»¶å—ï¼Ÿ</p>2022-02-08</li><br/><li><span>Gavin</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>1. å…‹éš†è€å¸ˆä»“åº“åæ‰§è¡Œ sudo python3 execsnoop_v2.py
2. å¦å¤–å¼€ç»ˆç«¯æ‰§è¡Œlsæ²¡æœ‰ç»“æœè¾“å‡º
3. å†…æ ¸ç‰ˆæœ¬ Linux version 5.18.0-kali5-arm64
4.   
â”€$ sudo bpftrace -l &quot;*execve*&quot; 
hardware:*execve*:
kfunc:vmlinux:__arm64_compat_sys_execve
kfunc:vmlinux:__arm64_compat_sys_execveat
kfunc:vmlinux:__arm64_sys_execve
kfunc:vmlinux:__arm64_sys_execveat
kfunc:vmlinux:audit_log_execve_info
kfunc:vmlinux:bprm_execve
kfunc:vmlinux:kernel_execve
kprobe:__arm64_compat_sys_execve
kprobe:__arm64_compat_sys_execveat
kprobe:__arm64_sys_execve
kprobe:__arm64_sys_execveat
kprobe:audit_log_execve_info
kprobe:bprm_execve
kprobe:do_execveat_common.isra.0
kprobe:kernel_execve
software:*execve*:
tracepoint:syscalls:sys_enter_execve
tracepoint:syscalls:sys_enter_execveat
tracepoint:syscalls:sys_exit_execve
tracepoint:syscalls:sys_exit_execveat
</p>2023-06-20</li><br/><li><span>Bachue Zhou</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>çœ‹æ–‡æ¡£ï¼Œjoin å‡½æ•°å®è´¨ä¸ŠæŒ‡çš„å¹¶ä¸æ˜¯å°†æ•°ç»„è¿æ¥èµ·æ¥ï¼Œè€Œæ˜¯æ‰“å°æ•°ç»„ã€‚è¿™ä¸ªå‡½æ•°åå¾ˆå®¹æ˜“è®©äººè¯¯è§£å•Šï¼Œæ„Ÿè§‰æ˜¯è®¾è®¡å¤±è¯¯ï¼Œæ‰“å°æ•°ç»„å®Œå…¨å¯ä»¥äº¤ç»™ printf è¿›è¡Œï¼Œæ²¡å¿…è¦ç”¨ join è¿™ç§å®¹æ˜“è®©äººè¯¯è§£çš„åå­—ã€‚</p>2023-04-03</li><br/><li><span>17</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<p>é—®é¢˜æè¿°ï¼š
ä½¿ç”¨bpftrace -lå‘½ä»¤ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š
Could not read symbols from &#47;sys&#47;kernel&#47;debug&#47;tracing&#47;available_filter_functions: Permission denied

å·²ç»å°è¯•ä½¿ç”¨å‘½ä»¤ä½†ä»æ— æ³•è§£å†³
mount -t debugfs none &#47;sys&#47;kernel&#47;debug
chmod 700 &#47;sys&#47;kernel&#47;debug&#47;tracing

ç¯å¢ƒä¿¡æ¯
Ubuntu 22.04 å†…æ ¸ç‰ˆæœ¬5.19.0
bpftrace&#47;jammy,now 0.14.0-1 amd64

éº»çƒ¦è€å¸ˆå¸®çœ‹ä¸€ä¸‹ï¼Œè¿™æ˜¯ä»€ä¹ˆé”™è¯¯ï¼Œè¯¥å¦‚ä½•è§£å†³</p>2023-03-17</li><br/>
</ul>