ä½ å¥½ï¼Œæˆ‘æ˜¯é›ªé£ã€‚

ä¸Šä¸€è®²æˆ‘å¸¦ä½ åŠ¨æ‰‹æ­å»ºäº†ä¸€å¥— K8s é›†ç¾¤ï¼Œä½ åœ¨æ­å»ºè¿‡ç¨‹ä¸­æ˜¯ä¸æ˜¯æ„Ÿè§‰æœ‰ç‚¹éš¾ï¼Ÿæ²¡å…³ç³»ï¼Œè¿™æ˜¯å¾ˆæ­£å¸¸çš„ã€‚ä½ ä¼šå‘ç°ï¼Œæ˜æ˜æ˜¯æŒ‰ç…§æ–‡æ¡£ä¸€æ­¥æ­¥æ‰§è¡Œï¼Œæ€»æ˜¯æœ‰æŠ¥é”™ã€‚è¿™ç§æƒ…å†µï¼Œå»ºè®®ä½ åœ¨æ­å»ºçš„æ—¶å€™ï¼Œä»”ç»†é˜…è¯»æ–‡æ¡£ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­æ³¨æ„è§„èŒƒæ“ä½œï¼Œé¿å…å°é”™è¯¯ã€‚æœ€å¥½è¦æ˜ç™½æ¯ä¸€æ­¥æ“ä½œçš„ç›®çš„ï¼Œå¤šè¯•å‡ æ¬¡å°±ä¸€å®šèƒ½æˆåŠŸã€‚æˆ‘è¿˜è®°å¾—å½“æ—¶æˆ‘ç¬¬ä¸€æ¬¡æ­å»ºæˆåŠŸé‚£ä¸€åˆ»çœŸæ˜¯éå¸¸æ¿€åŠ¨ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªç¨‹åºå‘˜çš„å°å¿«ä¹å§ï¼Œç›¸ä¿¡ä½ ä¹Ÿèƒ½ä½“ä¼šåˆ°è¿™ç§å¿«ä¹ï¼

ä»Šå¤©è¿™èŠ‚è¯¾æˆ‘ä»¬å°±æ¥æ·±å…¥å­¦ä¹  K8s çš„å„ç§ç»„ä»¶å’Œèµ„æºå¯¹è±¡ï¼Œå¹¶åŠ¨æ‰‹åœ¨ K8s ç¯å¢ƒéƒ¨ç½²ä¸€ä¸ª Nginx çš„åº”ç”¨ã€‚ä½ ä¼šå‘ç° K8s æ¶æ„è®¾è®¡éå¸¸çµæ´»é«˜æ•ˆï¼Œæä¾›çš„èµ„æºå¯¹è±¡ä¹Ÿæ˜¯éå¸¸ä¸°å¯Œï¼Œèƒ½å¤Ÿæ»¡è¶³å„ç§å„æ ·çš„éƒ¨ç½²éœ€æ±‚ã€‚

## K8s ç»„ä»¶

K8s ç”±ç®¡ç†èŠ‚ç‚¹å’Œå·¥ä½œèŠ‚ç‚¹ç»„æˆï¼Œå› ä¸ºå®ƒä»¬æ‰€æ‰¿æ‹…çš„å·¥ä½œå†…å®¹ä¸ä¸€æ ·ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šå®‰è£…ç€ä¸åŒçš„ K8s ç»„ä»¶ã€‚ç®¡ç†èŠ‚ç‚¹å®‰è£…æ‰¿æ‹…è°ƒåº¦å’Œç®¡ç†ç›¸å…³çš„ç»„ä»¶ï¼Œè€Œå·¥ä½œèŠ‚ç‚¹è‡ªç„¶å°±æ˜¯å®‰è£…å…·ä½“æ‰§è¡Œçš„ç»„ä»¶äº†ã€‚ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«ä»‹ç»è¿™ä¸¤ç§èŠ‚ç‚¹ä¸Šçš„ç»„ä»¶ã€‚

#### ![å›¾ç‰‡](https://static001.geekbang.org/resource/image/43/ac/4398dd080a10a31f2ebd968251d214ac.jpg?wh=2082x1171)

### ç®¡ç†èŠ‚ç‚¹ï¼ˆMaster Nodeï¼‰

ç®¡ç†èŠ‚ç‚¹æ˜¯ K8s é›†ç¾¤çš„â€œå¤§è„‘â€ï¼Œè´Ÿè´£ç®¡ç†æ•´ä¸ªé›†ç¾¤ã€‚ç®¡ç†èŠ‚ç‚¹ä¸Šè¿è¡Œçš„æ ¸å¿ƒç»„ä»¶åŒ…æ‹¬ï¼š

- **API server**ï¼šå®ƒæ˜¯æ•´ä¸ª K8s é›†ç¾¤çš„å”¯ä¸€è®¿é—®å…¥å£ï¼Œå®ƒå¯¹å¤–å¼€æ”¾äº†ä¸€å¥— RESTful API æ¥å£ï¼Œè¦è®¿é—® K8s é‡Œçš„èµ„æºå¯¹è±¡å°±éœ€è¦è°ƒç”¨ API server æä¾›çš„æ¥å£ã€‚èµ„æºå¯¹è±¡æ˜¯ K8s æä¾›çš„ç”¨äºå®ç°å„ç§ç®¡ç†å’Œéƒ¨ç½²éœ€æ±‚çš„â€œå·¥å…·åŒ…â€ã€‚K8s å†…éƒ¨çš„å„ä¸ªç»„ä»¶ä¹‹é—´ä¸èƒ½ç›´æ¥äº’ç›¸è°ƒç”¨ï¼Œä¹Ÿéœ€è¦è°ƒç”¨ API server çš„æ¥å£æ¥å®Œæˆè‡ªå·±éœ€è¦çš„å·¥ä½œã€‚å°±è¿æˆ‘ä»¬ä½¿ç”¨çš„ kubectl å‘½ä»¤äº¤äº’å·¥å…·ä¹Ÿæ˜¯é€šè¿‡è°ƒç”¨ API server çš„æ¥å£æ¥æ“ä½œé›†ç¾¤ã€‚
- **Scheduler**ï¼šå®ƒè´Ÿè´£å¯¹é›†ç¾¤å†…éƒ¨çš„èµ„æºå¯¹è±¡è¿›è¡Œè°ƒåº¦ï¼Œç›¸å½“äºè°ƒåº¦å‘˜çš„è§’è‰²ã€‚K8s ä¸­ç®¡ç†çš„æœ€å°èµ„æºå¯¹è±¡æ˜¯ Podï¼ŒPod ç›¸å½“äºä¸€ä¸ªå®¹å™¨ç»„ï¼Œé‡Œé¢åŒ…å«äº†å¤šä¸ªå®¹å™¨ï¼Œå½“ K8s æ¥åˆ°ä¸€ä¸ªPod å¯¹è±¡çš„éƒ¨ç½²ä»»åŠ¡ï¼ŒScheduler å°±ä¼šæ ¹æ®è°ƒåº¦ç­–ç•¥æ¥å†³å®šè¿™ä¸ª Pod åº”è¯¥è¿è¡Œåœ¨å“ªäº›èŠ‚ç‚¹ä¸Šã€‚
- **Controller Manager**ï¼šå®ƒæ˜¯ K8s çš„ç®¡ç†ä¸­å¿ƒï¼Œå®ƒåŒ…å«çš„ Controller æ§åˆ¶å™¨å’Œ K8s çš„èµ„æºå¯¹è±¡ä¸€ä¸€å¯¹åº”ï¼Œè´Ÿè´£é›†ç¾¤å†…èµ„æºå¯¹è±¡çš„ç®¡ç†ï¼Œå®ƒä¿éšœèµ„æºå¯¹è±¡ç»´æŒåœ¨é¢„æœŸçš„å·¥ä½œçŠ¶æ€ã€‚
- **etcd**ï¼šå®ƒæ˜¯ä¸€ä¸ªé”®å€¼å¯¹å­˜å‚¨ç»„ä»¶ï¼Œç›¸å½“äºæ•´ä¸ª K8s é›†ç¾¤ç»„ä»¶å…±äº«çš„æ•°æ®åº“ï¼Œç”¨äºä¿å­˜é›†ç¾¤çš„æ‰€æœ‰é…ç½®æ•°æ®ï¼ŒåŒ…å«é›†ç¾¤ä¸­å½“å‰çš„èµ„æºå¯¹è±¡ã€çŠ¶æ€æ•°æ®ã€ç»Ÿè®¡æ•°æ®ç­‰ã€‚etcd ä¸­å­˜å‚¨çš„æ•°æ®é€šå¸¸éœ€è¦åšå¤‡ä»½ï¼Œå¦‚æœé›†ç¾¤å‡ºç°é—®é¢˜å¯ä»¥ä½¿ç”¨å¤‡ä»½æ•°æ®æ¢å¤æ‰€æœ‰èµ„æºå¯¹è±¡å’Œå·¥ä½œçŠ¶æ€ã€‚

Master èŠ‚ç‚¹ä¸Šè¿˜å®‰è£…äº†ä¸€ä¸ª kubectl å·¥å…·ï¼Œè™½ç„¶å®ƒä¸æ˜¯ K8s çš„ç»„ä»¶ï¼Œä½†æ˜¯å®ƒæ˜¯ç”¨æ¥æ‰§è¡Œ K8s å‘½ä»¤çš„äº¤äº’å·¥å…·ã€‚

### å·¥ä½œèŠ‚ç‚¹ï¼ˆNodeï¼‰

å·¥ä½œèŠ‚ç‚¹æ˜¯ K8s é›†ç¾¤ä¸­å…·ä½“è¿è¡Œå®¹å™¨çš„æœåŠ¡å™¨ã€‚å®ƒä»¬æ˜¯é›†ç¾¤çš„æ‰§è¡Œè€…ï¼Œå°±åƒâ€œå››è‚¢â€ä¸€æ ·ï¼Œè´Ÿè´£å®é™…è¿è¡Œå„ç§èµ„æºå¯¹è±¡ã€‚æ¯ä¸ªå·¥ä½œèŠ‚ç‚¹éƒ½åŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š

- **kubelet**ï¼šä½ å¯ä»¥å°†å®ƒè§†ä¸ºæ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„ K8s ç®¡ç†å‘˜ã€‚å®ƒè´Ÿè´£å¯åŠ¨ã€åœæ­¢ã€å¤åˆ¶å®¹å™¨ã€ç›‘æ§å®¹å™¨çš„å¥åº·çŠ¶å†µç­‰å·¥ä½œã€‚å…¶ä»–ç»„ä»¶éƒ½æ˜¯éƒ¨ç½²åœ¨ K8s è‡ªèº«é›†ç¾¤é‡Œçš„ï¼Œè€Œ kubelet ä¸ä¸€æ ·ï¼Œå®ƒæ˜¯ç›´æ¥å®‰è£…åœ¨æœåŠ¡å™¨ä¸Šçš„ï¼Œå±äºç³»ç»Ÿçº§æœåŠ¡ã€‚è¿™æ˜¯å› ä¸º kubelet éœ€è¦ç®¡ç†é›†ç¾¤ä¸­çš„å®¹å™¨ï¼Œè¿™éœ€è¦èƒ½å¯¹æœåŠ¡å™¨è¿›è¡Œæ“ä½œçš„é«˜çº§æƒé™ï¼Œå› æ­¤å®ƒä¸èƒ½é€šè¿‡å®¹å™¨çš„æ–¹å¼éƒ¨ç½²ã€‚
- **Container Runtime**ï¼šè¿™ä¸ªç»„ä»¶å«åšå®¹å™¨è¿è¡Œæ—¶ç»„ä»¶ï¼Œå®ƒè´Ÿè´£å®é™…è¿è¡Œå’Œç®¡ç†å®¹å™¨ï¼Œä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯å®¹å™¨å¼•æ“ã€‚èŠ‚ç‚¹ä¸Šçš„ kubelet ä¸å®¹å™¨è¿è¡Œæ—¶è¿›è¡Œäº¤äº’ï¼Œä»è€Œç®¡ç†å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸã€‚K8s æ”¯æŒç¬¬ä¸‰æ–¹æä¾›çš„å®¹å™¨è¿è¡Œæ—¶ç»„ä»¶ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„æ˜¯ Docker æˆ– Containerdã€‚
- **kube-proxy**ï¼šå®ƒå°±åƒé›†ç¾¤ä¸­çš„äº¤é€šæ¢çº½ï¼Œè´Ÿè´£ç®¡ç†é›†ç¾¤å†…éƒ¨çš„ç½‘ç»œæµé‡ã€‚å®ƒçš„ä¸»è¦ä»»åŠ¡åŒ…æ‹¬æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼ŒåŒæ—¶æä¾›æ›´åŠ åŠ¨æ€å’Œçµæ´»çš„ç½‘ç»œä»£ç†æœåŠ¡ã€‚

å·¥ä½œèŠ‚ç‚¹çš„æ•°é‡å¯ä»¥è‡ªç”±æ‰©å±•ï¼Œä½†æ˜¯å·¥ä½œèŠ‚ç‚¹è¶Šå¤šï¼Œå¯¹ Master èŠ‚ç‚¹çš„é…ç½®è¦æ±‚ä¹Ÿå°±è¶Šé«˜ï¼Œæ¯•ç«Ÿé…ç½®é«˜çš„å¤§è„‘æ‰èƒ½ç®¡çš„äº†æ›´å¤šèŠ‚ç‚¹ã€‚é€šå¸¸æˆ‘ä»¬å¼€å‘çš„ toB ä¸šåŠ¡ç³»ç»Ÿï¼Œ10 ä¸ªå·¦å³çš„å·¥ä½œèŠ‚ç‚¹ä¹Ÿå°±å¤Ÿç”¨ã€‚

ä»‹ç»äº†è¿™äº› K8s çš„ç»„ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å»é›†ç¾¤é‡Œæ‰¾æ‰¾è¿™äº›ç»„ä»¶ã€‚åœ¨ Master èŠ‚ç‚¹ä¸Šæ‰§è¡Œ â€œkubectl get podâ€ å‘½ä»¤æŸ¥çœ‹ Pod åˆ—è¡¨ï¼Œå¯ä»¥çœ‹åˆ° K8s çš„è¿™äº›æ ¸å¿ƒç»„ä»¶å‡ ä¹éƒ½æ˜¯ä»¥ Pod çš„æ–¹å¼è¿è¡Œåœ¨é›†ç¾¤ä¸­ï¼Œé™¤äº† kubelet æ˜¯ç›´æ¥å®‰è£…åˆ°æœåŠ¡å™¨ä¸Šã€‚

```bash
[root@k8s-master ~]# kubectl get pod -n kube-systemÂ 
NAMEÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â READYÂ  Â STATUSÂ  Â  RESTARTSÂ  Â AGE
coredns-66f779496c-dgtfqÂ  Â  Â  Â  Â  Â  Â 1/1Â  Â  Â RunningÂ  Â 0Â  Â  Â  Â  Â  13h
coredns-66f779496c-zjzlcÂ  Â  Â  Â  Â  Â  Â 1/1Â  Â  Â RunningÂ  Â 0Â  Â  Â  Â  Â  13h
etcd-k8s-masterÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  1/1Â  Â  Â RunningÂ  Â 0Â  Â  Â  Â  Â  13h
kube-apiserver-k8s-masterÂ  Â  Â  Â  Â  Â  1/1Â  Â  Â RunningÂ  Â 0Â  Â  Â  Â  Â  13h
kube-controller-manager-k8s-masterÂ  Â 1/1Â  Â  Â RunningÂ  Â 0Â  Â  Â  Â  Â  13h
kube-proxy-7sttsÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 1/1Â  Â  Â RunningÂ  Â 0Â  Â  Â  Â  Â  13h
kube-proxy-k4grzÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 1/1Â  Â  Â RunningÂ  Â 0Â  Â  Â  Â  Â  13h
kube-proxy-spxv2Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 1/1Â  Â  Â RunningÂ  Â 0Â  Â  Â  Â  Â  13h
kube-scheduler-k8s-masterÂ  Â  Â  Â  Â  Â  1/1Â  Â  Â RunningÂ  Â 0Â  Â  Â  Â  Â  13h
```

æ€»çš„æ¥è¯´ï¼ŒK8s é›†ç¾¤æ¶æ„ç”±ç®¡ç†èŠ‚ç‚¹å’Œå·¥ä½œèŠ‚ç‚¹ç»„æˆã€‚ç®¡ç†èŠ‚ç‚¹è´Ÿè´£æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€ç›‘æ§å’Œèµ„æºå¯¹è±¡è°ƒåº¦ï¼Œè€Œå·¥ä½œèŠ‚ç‚¹ä¸“é—¨è´Ÿè´£è¿è¡Œå’Œç®¡ç†å®¹å™¨ï¼Œè¿™ç§åˆ†ç¦»çš„è®¾è®¡ä¸ä»…å¢å¼ºäº† K8s çš„çµæ´»æ€§å’Œæ‰©å±•æ€§ï¼Œä¹Ÿè®©å®ƒèƒ½å¤Ÿæœ‰æ•ˆåœ°æ”¯æŒå¤§è§„æ¨¡å’ŒåŠ¨æ€å˜åŒ–çš„äº‘åŸç”Ÿåº”ç”¨éƒ¨ç½²éœ€æ±‚ã€‚

### æ’ä»¶

é™¤äº†æ ¸å¿ƒç»„ä»¶å¤–ï¼ŒK8s è¿˜æä¾›äº†è®¸å¤šæ’ä»¶æ¥æ‹“å±•åŠŸèƒ½ã€‚ä»‹ç»ä¸¤ä¸ªå¸¸ç”¨çš„ K8s æ’ä»¶ã€‚

- **core DNSï¼š**å®ƒæ˜¯ K8s é›†ç¾¤ä¸­çš„åŸŸåè§£ææ’ä»¶ï¼Œæä¾›äº†ç®€å•è€Œå¯é çš„ DNS æœåŠ¡ã€‚ä½ å¯ä»¥é€šè¿‡åŸŸåçš„æ–¹å¼è½»æ¾åœ°è®¿é—®åˆ°é›†ç¾¤ä¸­ Pod å’Œ Service è¿™äº›èµ„æºå¯¹è±¡ã€‚
- **Dashboardï¼š**Dashboard æ˜¯ K8s é›†ç¾¤ä¸­çš„ Web ç•Œé¢ç®¡ç†å·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªå¯è§†åŒ–ç•Œé¢ï¼Œè®©ä½ å¯ä»¥åœ¨ä¸ç†Ÿæ‚‰ K8s å‘½ä»¤çš„æƒ…å†µä¸‹ï¼Œè½»æ¾åœ°ç®¡ç†å’Œç›‘æ§é›†ç¾¤ä¸­çš„èµ„æºå¯¹è±¡ã€‚

## K8s çš„èµ„æºå¯¹è±¡ï¼ˆResource Objectï¼‰

ä¸Šé¢ä»‹ç»ç»„ä»¶çš„æ—¶å€™ä¸€ç›´æåˆ° K8s çš„èµ„æºå¯¹è±¡ï¼Œç°åœ¨å°±æ¥ä»‹ç»ä¸€ä¸‹ã€‚èµ„æºå¯¹è±¡æ˜¯ K8s ä¸­çš„æ ¸å¿ƒæ¦‚å¿µï¼Œå®ƒæ˜¯ K8s æä¾›ç®¡ç†é›†ç¾¤å’Œéƒ¨ç½²åº”ç”¨çš„å„ç§å·¥å…·ã€‚æœ‰çš„èµ„æºå¯¹è±¡è´Ÿè´£ç®¡ç†å®¹å™¨ï¼Œæœ‰çš„èµ„æºå¯¹è±¡è´Ÿè´£ç®¡ç†é…ç½®å‚æ•°ï¼Œè¿˜æœ‰äº›è´Ÿè´£ç®¡ç†ç½‘ç»œå’Œå­˜å‚¨ç­‰ç­‰ã€‚è¿™äº›èµ„æºå¯¹è±¡é€šè¿‡ K8s çš„ API è¿›è¡Œå®šä¹‰å’Œç®¡ç†ï¼Œæ‰€ä»¥æ¯ä¸ªèµ„æºå¯¹è±¡éƒ½æœ‰å®ƒå¯¹åº”çš„ API ç‰ˆæœ¬ã€‚

è¿™é‡Œæˆ‘ç®€å•ä»‹ç»å‡ ä¸ªé‡è¦çš„èµ„æºå¯¹è±¡ï¼Œè®©ä½ æœ‰ä¸ªæ€»ä½“äº†è§£ã€‚

æœ€å¸¸ç”¨çš„èµ„æºå¯¹è±¡å°±æ˜¯ Podï¼Œå®ƒæ˜¯ K8s ä¸­çš„åŸºæœ¬éƒ¨ç½²å•å…ƒï¼Œæ¯ä¸ª Pod åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ï¼Œè¿™äº›å®¹å™¨é‡Œå°±è¿è¡Œç€æˆ‘ä»¬çš„åº”ç”¨é•œåƒã€‚

åœ¨ Pod çš„åŸºç¡€ä¸Šï¼ŒK8s åšäº†ä¸€äº›æ»¡è¶³ä¸åŒåŠŸèƒ½éœ€æ±‚çš„å°è£…ï¼ŒåŒ…è£…æˆäº†æ–°çš„èµ„æºå¯¹è±¡ï¼Œä¾‹å¦‚å¯ä»¥æ‰§è¡Œä»»åŠ¡å’Œå®šæ—¶ä»»åŠ¡çš„ Job å’Œ CronJobï¼Œä»¥åŠæä¾›äº†ç±»ä¼¼æ¯ä¸ªèŠ‚ç‚¹ä¸Šå®ˆæŠ¤è¿›ç¨‹çš„ DaemonSetï¼Œè¿™äº›èµ„æºå¯¹è±¡é‡Œéƒ½åŒ…å«äº†å®é™…è¦è¿è¡Œçš„ Podã€‚

Deployment å’Œ StatefulSet åˆ†åˆ«å¯¹åº”ç€æ— çŠ¶æ€åº”ç”¨å’Œæœ‰çŠ¶æ€åº”ç”¨çš„éƒ¨ç½²ã€‚å®ƒä»¬éƒ½å¯ä»¥åŒæ—¶éƒ¨ç½²å¤šä¸ª Pod å‰¯æœ¬ï¼Œä»è€Œå®ç°åº”ç”¨ Pod çš„é«˜å¯ç”¨å’Œå¼¹æ€§ä¼¸ç¼©ã€‚

> æ— çŠ¶æ€åº”ç”¨å°±æ˜¯æŒ‡åº”ç”¨åœ¨å¤„ç†è¯·æ±‚æ—¶ä¸ä¾èµ–äºä»»ä½•çŠ¶æ€ä¿¡æ¯ã€‚æ¯æ¬¡å¯¹è¯·æ±‚çš„å¤„ç†å’Œå“åº”éƒ½æ˜¯ç‹¬ç«‹çš„ã€‚æ— çŠ¶æ€åº”ç”¨æ›´å®¹æ˜“æ‰©å±•ï¼Œå®ƒå¯ä»¥æ°´å¹³å¤åˆ¶å¤šä¸ªåº”ç”¨ï¼Œä¾‹å¦‚å¸¸è§çš„ Web æœåŠ¡ï¼Œå¯ä»¥éƒ¨ç½²åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œä¸ç®¡æˆ‘ä»¬çš„è¯·æ±‚åˆ°äº†å“ªä¸ªæœåŠ¡å™¨ï¼Œå¾—åˆ°çš„ç»“æœéƒ½ä¸€æ ·ã€‚  
> Â   
> æœ‰çŠ¶æ€åº”ç”¨ä¸æ— çŠ¶æ€åº”ç”¨ç›¸åï¼Œå¤„ç†è¯·æ±‚éœ€è¦ç»´æŠ¤åº”ç”¨ä¹‹å‰çš„çŠ¶æ€ä¿¡æ¯ã€‚è¿™å¯èƒ½åŒ…æ‹¬ç”¨æˆ·ä¼šè¯ã€æ•°æ®åº“è¿æ¥ç­‰ï¼ŒåŒæ—¶æœ‰çŠ¶æ€åº”ç”¨çš„å¤šä¸ªåº”ç”¨ä¼šå­˜åœ¨ä¸€äº›å¤æ‚å…³ç³»ï¼Œæ¯”å¦‚ä¸»ä»å…³ç³»æˆ–è€…ä¸»å¤‡å…³ç³»ç­‰ï¼Œæ•°æ®åº“åº”ç”¨ MySQLå°±æ˜¯æœ‰çŠ¶æ€åº”ç”¨ã€‚

K8s è¿˜æä¾›è´Ÿè´£è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡å‘ç°çš„ Service å’Œå®ç°è·¯ç”±è®¿é—®è§„åˆ™çš„ Ingressï¼Œä»¥åŠæä¾›è´Ÿè´£æŒä¹…åŒ–å­˜å‚¨çš„ PVï¼ˆPersistent Volume) å’Œ PVCï¼ˆPersistent Volume Claim) ï¼Œç”šè‡³è¿˜æä¾›äº†è´Ÿè´£å­˜å‚¨å˜é‡å‚æ•°çš„ ConfigMap å’Œ Secretã€‚

æ€»ä¹‹ï¼Œé€šè¿‡è¿™äº›ä¸°å¯Œçš„èµ„æºå¯¹è±¡ï¼Œä½ å¯ä»¥çµæ´»åœ°éƒ¨ç½²å’Œç®¡ç†åº”ç”¨ï¼Œæ–¹ä¾¿åœ°ä½¿ç”¨ç½‘ç»œå’Œå­˜å‚¨ï¼Œå¿«é€Ÿå®ç°ä½ æ‰€æœŸæœ›çš„éƒ¨ç½²æ–¹å¼ã€‚å­¦å¥½ K8s ä¸»è¦å°±æ˜¯å¯¹è¿™äº›èµ„æºå¯¹è±¡çš„ç†Ÿç»ƒä½¿ç”¨ï¼Œåç»­çš„è¯¾ç¨‹ä¸­æˆ‘ä¼šé™†ç»­ä»‹ç»è¿™äº›èµ„æºå¯¹è±¡çš„ä½¿ç”¨æ–¹æ³•ã€‚

## å¿«é€Ÿä½¿ç”¨ K8s éƒ¨ç½²åº”ç”¨

ç†è®ºéƒ¨åˆ†è®²å®Œäº†ï¼Œç°åœ¨æˆ‘å°±å¸¦ä½ åŠ¨æ‰‹å®éªŒä¸€ä¸‹åœ¨ K8s é›†ç¾¤ä¸Šéƒ¨ç½²åº”ç”¨ã€‚æˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ª Nginx é•œåƒçš„åº”ç”¨ï¼Œåœ¨è®² Docker å®¹å™¨çš„æ—¶å€™å·²ç»ä½¿ç”¨è¿‡ Nginx é•œåƒï¼Œéƒ¨ç½²æˆåŠŸä¹‹åå¯ä»¥é€šè¿‡ HTTP è¯·æ±‚ç›´æ¥è®¿é—®å®ƒçš„é»˜è®¤ç½‘ç«™é¦–é¡µï¼Œä»è€Œæ¥éªŒè¯ Nginx åº”ç”¨æ˜¯å¦éƒ¨ç½²æˆåŠŸã€‚

å®éªŒå†…å®¹å’Œæ­¥éª¤å¦‚ä¸‹ï¼š

1. æˆ‘ä»¬é€‰æ‹©ä½¿ç”¨ K8s æä¾›çš„ Deployment ä½œä¸ºéƒ¨ç½²å¯¹è±¡ï¼ŒDeployment ç”¨æ¥éƒ¨ç½²æ— çŠ¶æ€åº”ç”¨ï¼Œåˆšå¥½é€‚åˆéƒ¨ç½² Nginx è¿™ç§ web åº”ç”¨ã€‚å…ˆéƒ¨ç½²ä¸€ä¸ª Deployment ï¼Œè®¾ç½® 3 ä¸ª Pod åº”ç”¨å‰¯æœ¬ï¼Œè¿™æ ·å°±åœ¨é›†ç¾¤é‡Œå°±åŒæ—¶è¿è¡Œäº† 3 ä¸ª Podï¼Œæ¯ä¸ª Pod é‡Œéƒ½è¿è¡Œäº† Nginx é•œåƒçš„å®¹å™¨ã€‚
2. Nginx åº”ç”¨çš„ Pod è¿è¡Œèµ·æ¥ä¹‹åï¼Œè¦æä¾›è®¿é—®ç½‘ç»œï¼Œè¿™æ—¶å°±éœ€è¦éƒ¨ç½² Serviceã€‚ä¸Šé¢å†…å®¹è®²è¿‡ Service æ˜¯ K8s æä¾›çš„ç”¨äºç½‘ç»œè®¿é—®çš„èµ„æºå¯¹è±¡ ï¼Œå®ƒå¯ä»¥åˆ›å»ºä¸€ä¸ªè®¿é—®é›†ç¾¤ä¸­ Pod çš„ç½‘ç»œé€šè·¯ï¼Œä»è€Œè®©æˆ‘ä»¬è®¿é—®åˆ°è¿è¡Œ Nginx åº”ç”¨çš„ Podï¼ŒåŒæ—¶è¿”å›å“åº”ç»“æœã€‚

**æ³¨æ„ï¼š**éœ€è¦è®¾ç½® Service çš„ç±»å‹ä¸º NodePortï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä»»æ„é›†ç¾¤èŠ‚ç‚¹æœåŠ¡å™¨çš„å…¬ç½‘ IP å’Œ NodePort ç«¯å£å·æ¥è®¿é—® Nginx åº”ç”¨ã€‚

åœ¨ K8s ä¸­éƒ¨ç½²èµ„æºå¯¹è±¡å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼ï¼šä½¿ç”¨å‘½ä»¤è¡Œå·¥å…· kubectl ç›´æ¥æ‰§è¡Œå‘½ä»¤éƒ¨ç½²ï¼Œæˆ–è€…ä½¿ç”¨ YAML æˆ– JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶éƒ¨ç½²ã€‚è¿™é‡Œä¸¤ç§æ–¹å¼æˆ‘éƒ½ç»™ä½ æ¼”ç¤ºä¸€ä¸‹å§ã€‚

### ä½¿ç”¨ kubectl å‘½ä»¤éƒ¨ç½²

kubectl æä¾›äº†ä¸€ç³»åˆ—çš„å‘½ä»¤æ¥ä¸é›†ç¾¤äº¤äº’ï¼Œä»è€Œç®¡ç†èµ„æºå¯¹è±¡ã€‚ä½ å¯ä»¥ç›´æ¥åœ¨ Master èŠ‚ç‚¹æœåŠ¡å™¨çš„ Shell ç»ˆç«¯çª—å£ä¸­è¾“å…¥ kubectl å‘½ä»¤æ¥åˆ›å»ºã€æŸ¥çœ‹ã€æ›´æ–°æˆ–åˆ é™¤èµ„æºå¯¹è±¡ã€‚

**ç¬¬ä¸€æ­¥ï¼šéƒ¨ç½² Deployment**

```bash
kubectl create deployment nginx-deployment-kc --image=nginx --replicas=3 --port=80 
```

- nginx-deployment-kcï¼šDeployment çš„åç§°ï¼Œå¯ä»¥è‡ªè¡Œå®šä¹‰ï¼Œæˆ‘è¿™é‡ŒåŠ äº†åç¼€ kc æ˜¯ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºè¿™æ˜¯ä½¿ç”¨ kubectl å‘½ä»¤å®‰è£…çš„èµ„æºå¯¹è±¡ã€‚
- â€“image=nginxï¼šè¡¨ç¤ºå®¹å™¨ä½¿ç”¨ Nginx é•œåƒï¼ŒK8s ä¼šè‡ªåŠ¨æ‹‰å– Nginx é•œåƒã€‚
- â€“replicas=3ï¼šè¡¨ç¤º Pod å‰¯æœ¬æ•°ä¸º3ä¸ªï¼Œå³éƒ¨ç½²äº†3ä¸ªåŒæ ·çš„è¿è¡Œ Nginx åº”ç”¨çš„ Podã€‚
- â€“port=80ï¼šè¡¨ç¤º Nginx å®¹å™¨å¯¹å¤–éœ€è¦æš´éœ²80ç«¯å£ã€‚

**ç¬¬äºŒæ­¥ï¼šéƒ¨ç½² Serviceï¼Œå‘å¤–æš´éœ² Nginx å®¹å™¨çš„ç«¯å£**

```bash
kubectl expose deployment nginx-deployment-kc --type=NodePort --port=80 --target-port=80
```

- nginx-deployment-kcï¼šå› ä¸º Service æ˜¯é’ˆå¯¹ Deployment æ¥æä¾›ç½‘ç»œæœåŠ¡ï¼Œæ‰€ä»¥è¿™ä¸ªå‚æ•°è¦è·Ÿä¸Šé¢éƒ¨ç½²çš„ Deployment åç§°ç›¸åŒï¼ŒService è‡ªå·±çš„é»˜è®¤åç§°å’Œ Deployment åç§°ç›¸åŒã€‚
- â€“type=NodePortï¼šæŒ‡å®š Service çš„ç±»å‹ä¸º NodePortã€‚
- â€“port=80 å’Œ --target-port=80ï¼šè¡¨ç¤º Service å¯¹å¤–æš´éœ²ç«¯å£ä¸º80ï¼ŒåŒæ—¶å¯¹åº” Pod ä¸­çš„å®¹å™¨çš„æš´éœ²ç«¯å£ä¹Ÿæ˜¯80ã€‚

**ç¬¬ä¸‰æ­¥ï¼šæ£€æŸ¥éƒ¨ç½²çŠ¶æ€**

```bash
kubectl get deployment  # æŸ¥çœ‹ Deployment åˆ—è¡¨
kubectl get svc   # æŸ¥çœ‹ Service åˆ—è¡¨
```

ç»“æœå¦‚ä¸‹ï¼š

```yaml
[root@k8s-master ~]# kubectl get deploymentÂ 
NAMEÂ  Â  Â  Â  Â  Â  Â  Â  Â  READYÂ  Â UP-TO-DATEÂ  Â AVAILABLEÂ  Â AGE
nginx-deployment-kcÂ  Â 3/3Â  Â  Â 3Â  Â  Â  Â  Â  Â  3Â  Â  Â  Â  Â  Â 70s
[root@k8s-master ~]# kubectl get svcÂ 
NAMEÂ  Â  Â  Â  Â  Â  Â  Â  Â  TYPEÂ  Â  Â  Â  CLUSTER-IPÂ  Â EXTERNAL-IPÂ  Â PORT(S)Â  Â  Â  Â  AGE
nginx-deployment-kcÂ  Â NodePortÂ  Â  10.108.2.2Â  Â <none>Â  Â  Â  Â  80:32608/TCPÂ  Â 10s
```

è¿”å›ç»“æœä¸­ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬éƒ¨ç½²å¥½çš„ Deployment å’Œ Serviceã€‚åœ¨æŸ¥çœ‹ Service åˆ—è¡¨çš„æ—¶å€™å¯ä»¥çœ‹åˆ° Service çš„ TYPE ä¸º NodePortï¼ŒåŒæ—¶ä¼šåœ¨ PORT åˆ—çœ‹åˆ° â€œ80:32608/TCPâ€ï¼Œè¿™ä¸ª 32608 ç«¯å£å·å°±æ˜¯é›†ç¾¤åˆ†é…çš„å¯ä»¥å¤–éƒ¨è®¿é—® Service çš„ç«¯å£å·ã€‚

**ç¬¬å››æ­¥ï¼šéªŒè¯å®éªŒç»“æœ**

æ­¤æ—¶ï¼Œåœ¨æµè§ˆå™¨ä¸­å¯ä»¥ä½¿ç”¨é›†ç¾¤ä¸­ä»»æ„èŠ‚ç‚¹æœåŠ¡å™¨çš„â€œå…¬ç½‘ IP + NodePort ç«¯å£å·â€æ¥è®¿é—® Nginx åº”ç”¨ï¼Œåœ¨æˆ‘çš„é›†ç¾¤ä¸­è®¿é—®åœ°å€ä¸º â€œ[http://82.156.143.14:32608](http://82.156.143.14:32608)â€ã€‚ç”±äº Master èŠ‚ç‚¹é»˜è®¤è®¾ç½®äº†ä¸èƒ½è¢«è°ƒåº¦ Podï¼Œæ‰€ä»¥è¿™é‡Œä¸è¦ä½¿ç”¨ Master èŠ‚ç‚¹çš„å…¬ç½‘ IPã€‚

**æ³¨æ„ï¼š**å¦‚æœä½¿ç”¨å…¬æœ‰äº‘æœåŠ¡å™¨ï¼Œéœ€è¦åœ¨é›†ç¾¤èŠ‚ç‚¹ä¸Šé…ç½®é˜²ç«å¢™ï¼Œå¼€æ”¾è¯¥ NodePort ç«¯å£å·æ‰èƒ½è®¿é—®ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/48/e6/48772229ea5ac2e2f773ae658e8e31e6.png?wh=1762x566)

### ä½¿ç”¨ YAML æ–‡ä»¶éƒ¨ç½²

**ç¬¬ä¸€æ­¥ï¼šéƒ¨ç½² Deployment**

åœ¨ Master èŠ‚ç‚¹ä¸Šæ–°å»ºä¸€ä¸ª YAML æ ¼å¼çš„éƒ¨ç½²æ–‡ä»¶ï¼Œæ–‡ä»¶åä¸º â€œnginx-deployment.yamlâ€ï¼Œç”¨æ¥éƒ¨ç½² Deploymentã€‚

```yaml
# nginx-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
Â  name: nginx-deployment-yaml  # Deployment åç§°
spec:
Â  replicas: 3Â  # å‰¯æœ¬æ•°3ä¸ª
Â  selector:
Â  Â  matchLabels:
Â  Â  Â  app: nginx-deployment-yaml
Â  template:
Â  Â  metadata:
Â  Â  Â  labels:
Â  Â  Â  Â  app: nginx-deployment-yaml
Â  Â  spec:
Â  Â  Â  containers:
Â  Â  Â  - name: my-nginx-c
Â  Â  Â  Â  image: nginxÂ  # nginx é•œåƒ
Â  Â  Â  Â  ports:
Â  Â  Â  Â  - containerPort: 80Â  # æš´éœ²ç«¯å£
```

åœ¨ Master èŠ‚ç‚¹æœåŠ¡å™¨çš„ Shell ç»ˆç«¯çª—å£ä¸­æ‰§è¡Œ â€œkubectlÂ applyâ€ å‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤å¯ä»¥è®© K8s é€šè¿‡ YAML æ–‡ä»¶æ¥è‡ªåŠ¨éƒ¨ç½² Deploymentã€‚

```bash
kubectl apply -f nginx-deployment.yaml
```

**ç¬¬äºŒæ­¥ï¼šéƒ¨ç½² Serviceï¼Œå‘å¤–æš´éœ² Nginx å®¹å™¨çš„ç«¯å£**

åœ¨ Master èŠ‚ç‚¹ä¸Šæ–°å»ºä¸€ä¸ª Service çš„ YAML éƒ¨ç½²æ–‡ä»¶ï¼Œæ–‡ä»¶åä¸º â€œnginx-service.yamlâ€ï¼Œç”¨æ¥éƒ¨ç½² Serviceã€‚

```yaml
# nginx-service.yaml
apiVersion: v1
kind: Service
metadata:
Â  name: nginx-service-yaml
spec:
Â  selector:
Â  Â  app: nginx-deployment-yaml
Â  ports:
Â  Â  - protocol: TCP
Â  Â  Â  port: 80
Â  Â  Â  targetPort: 80
Â  type: NodePort  # ç±»å‹æ˜¯ NodePort
```

åŒæ ·æ‰§è¡Œ â€œkubectlÂ applyâ€ å‘½ä»¤ï¼Œé€šè¿‡ YAML æ–‡ä»¶æ¥è‡ªåŠ¨éƒ¨ç½² Serviceã€‚

```bash
kubectl apply -f nginx-service.yaml
```

**ç¬¬ä¸‰æ­¥ï¼šæ£€æŸ¥éƒ¨ç½²çŠ¶æ€å’ŒéªŒè¯å®éªŒç»“æœ**

æ£€æŸ¥çŠ¶æ€å’ŒéªŒè¯ç»“æœä¸ä½¿ç”¨ kubectl å‘½ä»¤éƒ¨ç½²æ–¹å¼ç›¸åŒï¼Œè¿™é‡Œå°±ä¸å†é‡å¤ã€‚çœ‹åˆ° NodePort ç«¯å£å·ä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡èŠ‚ç‚¹æœåŠ¡å™¨çš„â€œå…¬ç½‘ IP + NodePort ç«¯å£å·â€æ¥è®¿é—® Nginx åº”ç”¨ã€‚

### åˆ é™¤èµ„æºå¯¹è±¡

åœ¨å®éªŒä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ kubectl å‘½ä»¤éƒ¨ç½²äº†åä¸º â€œnginx-deployment-kcâ€ çš„ Deployment å’Œåä¸º â€œnginx-deployment-kcâ€ çš„ Serviceã€‚é€šè¿‡æ‰§è¡Œ YAML æ–‡ä»¶çš„æ–¹å¼åˆ†åˆ«éƒ¨ç½²äº†åä¸º â€œnginx-deployment-yamlâ€ çš„ Deployment å’Œåä¸º â€œnginx-service-yamlâ€ çš„ Service ã€‚

å®éªŒç»“æŸï¼Œå¦‚æœéƒ¨ç½²çš„èµ„æºå¯¹è±¡éƒ½ä¸éœ€è¦äº†ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç›´æ¥åˆ é™¤ã€‚

```bash
kubectl delete deployment <deploymentåç§°>
kubectl delete svc <serviceåç§°>
```

å¦‚æœæ˜¯ç”¨ YAML æ–‡ä»¶éƒ¨ç½²çš„èµ„æºå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼åˆ é™¤ã€‚

```bash
kubectl delete -f <YAMLæ–‡ä»¶å>
```

## **å°ç»“**

åœ¨è¿™èŠ‚è¯¾ä¸­ï¼Œé¦–å…ˆæˆ‘ä»‹ç»äº† K8s ç®¡ç†èŠ‚ç‚¹å’Œå·¥ä½œèŠ‚ç‚¹ä¸Šè¿è¡Œçš„æ ¸å¿ƒç»„ä»¶ã€‚

ç®¡ç†èŠ‚ç‚¹å°±åƒ K8s çš„å¤§è„‘ï¼Œè¿è¡Œç€ API Serverã€Schedulerã€Controller Manager å’Œ Etcd ç»„ä»¶ã€‚å·¥ä½œèŠ‚ç‚¹å°±åƒ K8s çš„å››è‚¢ï¼Œè¿è¡Œç€ kubeletã€kube-proxy å’Œ Container Runtime å®¹å™¨è¿è¡Œæ—¶ç»„ä»¶ã€‚è¿™äº›ç»„ä»¶ç›¸äº’ç‹¬ç«‹ï¼ŒåˆååŒå·¥ä½œï¼Œå…±åŒç»„æˆäº† K8s çš„æ ¸å¿ƒæ¶æ„ï¼Œæ‰€ä»¥ K8s æ‹¥æœ‰å¼ºå¤§çš„çµæ´»æ€§å’Œæ‰©å±•æ€§ã€‚

å…¶æ¬¡ï¼Œæˆ‘ä»‹ç»äº† K8s çš„èµ„æºå¯¹è±¡ï¼Œå®ƒæ˜¯ K8s æä¾›çš„ç®¡ç†é›†ç¾¤å’Œéƒ¨ç½²åº”ç”¨çš„å·¥å…·é›†ã€‚å…¶ä¸­æœ‰æœ€å°éƒ¨ç½²å•å…ƒ Podï¼Œæœ‰ç”¨äºæ‰§è¡Œä»»åŠ¡çš„ Job å’Œ CronJobï¼Œæœ‰ç”¨äºå®ˆæŠ¤ç±»ä»»åŠ¡çš„ Daemonsetï¼Œæœ‰ç”¨äºéƒ¨ç½²åº”ç”¨çš„ Deployment å’Œ Statefulsetï¼Œæœ‰ç”¨äºç½‘ç»œè®¿é—®çš„ Serviceå’Œ Ingressï¼Œæœ‰ç”¨äºæŒä¹…åŒ–å­˜å‚¨çš„ PV å’Œ PVCï¼Œè¿˜æœ‰ç”¨äºå…±äº«å‚æ•°çš„ ConfigMap å’Œ Secretï¼Œç­‰ç­‰ã€‚K8s æä¾›äº†éå¸¸ä¸°å¯Œçš„èµ„æºå¯¹è±¡ï¼Œæ»¡è¶³äº†å„ç§å„æ ·çš„éƒ¨ç½²éœ€æ±‚ã€‚

æœ€åï¼Œæˆ‘å¸¦ä½ åœ¨ K8s é›†ç¾¤ä¸­éƒ¨ç½²äº†ä¸€ä¸ª Nginx åº”ç”¨ï¼Œå±•ç¤ºäº†é€šè¿‡ kubectl å‘½ä»¤å’Œ YAML æ–‡ä»¶æ¥éƒ¨ç½² K8s åº”ç”¨çš„ä¸¤ç§æ–¹å¼ã€‚

## æ€è€ƒé¢˜

è¿™å°±æ˜¯ä»Šå¤©çš„å…¨éƒ¨å†…å®¹ï¼Œæœ€åç•™ä¸€é“ç»ƒä¹ é¢˜ç»™ä½ ã€‚

æŒ‰ç…§è¯¾ç¨‹ä¸­è®²çš„ä¸¤ç§éƒ¨ç½²æ–¹å¼ï¼Œä½ è‡ªå·±åŠ¨æ‰‹è¯•éªŒä¸€ä¸‹ï¼Œçœ‹çœ‹æ˜¯å¦èƒ½æˆåŠŸéƒ¨ç½²ä¸€ä¸ª Apache åº”ç”¨ã€‚æ¬¢è¿ä½ æŠŠè¿‡ç¨‹å†™åˆ°ç•™è¨€åŒºã€‚ç›¸ä¿¡ç»è¿‡åŠ¨æ‰‹å®è·µï¼Œä¼šè®©ä½ å¯¹çŸ¥è¯†çš„ç†è§£æ›´åŠ æ·±åˆ»ã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ2ï¼‰</strong></div><ul>
<li><span>å­è·¯æ— å€¦</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>éƒ¨ç½²ApacheæœåŠ¡å™¨
ImageName: httpd
éƒ¨ç½²deployment
touch apache-deployment.yaml
æ–‡ä»¶å†…å®¹
# apache-deployment.yaml
apiVersion: apps&#47;v1
kind: Deployment
metadata:
  name: test-apache-dep  # Deployment åç§°
spec:
  replicas: 3  # å‰¯æœ¬æ•°3ä¸ª
  selector:
    matchLabels:
      app: test-apache-dep
  template:
    metadata:
      labels:
        app: test-apache-dep
    spec:
      containers:
      - name: my-apache-dep
        image: httpd  # apache é•œåƒ
        ports:
        - containerPort: 80  # æš´éœ²ç«¯å£
æ‰§è¡Œ kubectl apply -f apache-deployment.yaml
éƒ¨ç½²service
touch  apache-service.yaml
å†…å®¹
# apache-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: apache-service
spec:
  selector:
    app: test-apache-dep
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
  type: NodePort  # ç±»å‹æ˜¯ NodePort
kubectl apply -f apache-service.yaml
æŸ¥çœ‹çŠ¶æ€ï¼š kubectl get po&#47;svc
éªŒè¯ï¼š curl -X GET http:&#47;&#47;172.22.1.121:31254
Resp: &lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;&#47;h1&gt;&lt;&#47;body&gt;&lt;&#47;html&gt;</p>2024-12-25</li><br/><li><span>AMI</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>åœ¨éƒ¨ç½²nginxé•œåƒçš„æ—¶å€™ï¼Œæ²¡æœ‰æ‹‰åˆ°nginxé•œåƒï¼Œæ€ä¹ˆç”¨è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸å¥½æ„æ€ï¼Œk8sï¼Œæˆ‘çœŸçš„æ˜¯é›¶åŸºç¡€

[root@k8s-master ~]# kubectl get pod
NAME                                   READY   STATUS             RESTARTS   AGE
nginx-deployment-kc-7c9b7fbfc7-5xdbk   0&#47;1     ImagePullBackOff   0          7m49s
nginx-deployment-kc-7c9b7fbfc7-f4kqc   0&#47;1     ImagePullBackOff   0          7m49s
nginx-deployment-kc-7c9b7fbfc7-l7lfd   0&#47;1     ImagePullBackOff   0          7m49s

</p>2024-10-25</li><br/>
</ul>