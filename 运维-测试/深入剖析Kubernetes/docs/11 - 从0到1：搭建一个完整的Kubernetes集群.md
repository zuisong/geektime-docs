ä½ å¥½ï¼Œæˆ‘æ˜¯å¼ ç£Šã€‚ä»Šå¤©æˆ‘å’Œä½ åˆ†äº«çš„ä¸»é¢˜æ˜¯ï¼šä»0åˆ°1æ­å»ºä¸€ä¸ªå®Œæ•´çš„Kubernetesé›†ç¾¤ã€‚

ä¸è¿‡ï¼Œé¦–å…ˆéœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œæœ¬ç¯‡æ­å»ºæŒ‡å—æ˜¯å®Œå…¨çš„æ‰‹å·¥æ“ä½œï¼Œç»†èŠ‚æ¯”è¾ƒå¤šï¼Œå¹¶ä¸”æœ‰äº›å¤–éƒ¨é“¾æ¥å¯èƒ½è¿˜ä¼šé‡åˆ°ç‰¹æ®Šçš„â€œç½‘ç»œé—®é¢˜â€ã€‚æ‰€ä»¥ï¼Œå¯¹äºåªå…³å¿ƒå­¦ä¹  Kubernetes æœ¬èº«çŸ¥è¯†ç‚¹ã€ä¸å¤ªå…³æ³¨å¦‚ä½•æ‰‹å·¥éƒ¨ç½² Kubernetes é›†ç¾¤çš„åŒå­¦ï¼Œå¯ä»¥ç•¥è¿‡æœ¬èŠ‚ï¼Œç›´æ¥ä½¿ç”¨ [MiniKube](https://github.com/kubernetes/minikube) æˆ–è€… [Kind](https://github.com/kubernetes-sigs/kind)ï¼Œæ¥åœ¨æœ¬åœ°å¯åŠ¨ç®€å•çš„ Kubernetes é›†ç¾¤è¿›è¡Œåé¢çš„å­¦ä¹ å³å¯ã€‚å¦‚æœæ˜¯ä½¿ç”¨ MiniKube çš„è¯ï¼Œé˜¿é‡Œäº‘è¿˜ç»´æŠ¤äº†ä¸€ä¸ª[å›½å†…ç‰ˆçš„ MiniKube](https://github.com/AliyunContainerService/minikube)ï¼Œè¿™å¯¹äºåœ¨å›½å†…çš„åŒå­¦æ¥è¯´ä¼šæ¯”è¾ƒå‹å¥½ã€‚

åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»‹ç»äº†kubeadmè¿™ä¸ªKubernetesåŠå®˜æ–¹ç®¡ç†å·¥å…·çš„å·¥ä½œåŸç†ã€‚æ—¢ç„¶kubeadmçš„åˆè¡·æ˜¯è®©Kubernetesé›†ç¾¤çš„éƒ¨ç½²ä¸å†è®©äººå¤´ç–¼ï¼Œé‚£ä¹ˆè¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°±æ¥ä½¿ç”¨å®ƒéƒ¨ç½²ä¸€ä¸ªå®Œæ•´çš„Kubernetesé›†ç¾¤å§ã€‚

> å¤‡æ³¨ï¼šè¿™é‡Œæ‰€è¯´çš„â€œå®Œæ•´â€ï¼ŒæŒ‡çš„æ˜¯è¿™ä¸ªé›†ç¾¤å…·å¤‡Kubernetesé¡¹ç›®åœ¨GitHubä¸Šå·²ç»å‘å¸ƒçš„æ‰€æœ‰åŠŸèƒ½ï¼Œå¹¶èƒ½å¤Ÿæ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒçš„æ‰€æœ‰ä½¿ç”¨éœ€æ±‚ã€‚ä½†å¹¶ä¸ä»£è¡¨è¿™ä¸ªé›†ç¾¤æ˜¯ç”Ÿäº§çº§åˆ«å¯ç”¨çš„ï¼šç±»ä¼¼äºé«˜å¯ç”¨ã€æˆæƒã€å¤šç§Ÿæˆ·ã€ç¾éš¾å¤‡ä»½ç­‰ç”Ÿäº§çº§åˆ«é›†ç¾¤çš„åŠŸèƒ½æš‚æ—¶ä¸åœ¨æœ¬ç¯‡æ–‡ç« çš„è®¨è®ºèŒƒå›´ã€‚  
> ç›®å‰ï¼Œkubeadmçš„é«˜å¯ç”¨éƒ¨ç½²[å·²ç»æœ‰äº†ç¬¬ä¸€ä¸ªå‘å¸ƒ](https://kubernetes.io/docs/setup/independent/high-availability/)ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªç‰¹æ€§è¿˜æ²¡æœ‰GAï¼ˆç”Ÿäº§å¯ç”¨ï¼‰ï¼Œæ‰€ä»¥åŒ…æ‹¬äº†å¤§é‡çš„æ‰‹åŠ¨å·¥ä½œï¼Œè·Ÿæˆ‘ä»¬æ‰€é¢„æœŸçš„ä¸€é”®éƒ¨ç½²è¿˜æœ‰ä¸€å®šè·ç¦»ã€‚GAçš„æ—¥æœŸé¢„è®¡æ˜¯2018å¹´åº•åˆ°2019å¹´åˆã€‚å±Šæ—¶ï¼Œå¦‚æœæœ‰æœºä¼šæˆ‘ä¼šå†å’Œä½ åˆ†äº«è¿™éƒ¨åˆ†å†…å®¹ã€‚

è¿™æ¬¡éƒ¨ç½²ï¼Œæˆ‘ä¸ä¼šä¾èµ–äºä»»ä½•å…¬æœ‰äº‘æˆ–ç§æœ‰äº‘çš„èƒ½åŠ›ï¼Œè€Œæ˜¯å®Œå…¨åœ¨Bare-metalç¯å¢ƒä¸­å®Œæˆã€‚è¿™æ ·çš„éƒ¨ç½²ç»éªŒä¼šæ›´æœ‰æ™®é€‚æ€§ã€‚è€Œåœ¨åç»­çš„è®²è§£ä¸­ï¼Œå¦‚éç‰¹æ®Šå¼ºè°ƒï¼Œæˆ‘ä¹Ÿéƒ½ä¼šä»¥æœ¬æ¬¡æ­å»ºçš„è¿™ä¸ªé›†ç¾¤ä¸ºåŸºç¡€ã€‚

## å‡†å¤‡å·¥ä½œ

é¦–å…ˆï¼Œå‡†å¤‡æœºå™¨ã€‚æœ€ç›´æ¥çš„åŠæ³•ï¼Œè‡ªç„¶æ˜¯åˆ°å…¬æœ‰äº‘ä¸Šç”³è¯·å‡ ä¸ªè™šæ‹Ÿæœºã€‚å½“ç„¶ï¼Œå¦‚æœæ¡ä»¶å…è®¸çš„è¯ï¼Œæ‹¿å‡ å°æœ¬åœ°çš„ç‰©ç†æœåŠ¡å™¨æ¥ç»„é›†ç¾¤æ˜¯æœ€å¥½ä¸è¿‡äº†ã€‚è¿™äº›æœºå™¨åªè¦æ»¡è¶³å¦‚ä¸‹å‡ ä¸ªæ¡ä»¶å³å¯ï¼š

1. æ»¡è¶³å®‰è£…Dockeré¡¹ç›®æ‰€éœ€çš„è¦æ±‚ï¼Œæ¯”å¦‚64ä½çš„Linuxæ“ä½œç³»ç»Ÿã€3.10åŠä»¥ä¸Šçš„å†…æ ¸ç‰ˆæœ¬ï¼›
2. x86æˆ–è€…ARMæ¶æ„å‡å¯ï¼›
3. æœºå™¨ä¹‹é—´ç½‘ç»œäº’é€šï¼Œè¿™æ˜¯å°†æ¥å®¹å™¨ä¹‹é—´ç½‘ç»œäº’é€šçš„å‰æï¼›
4. æœ‰å¤–ç½‘è®¿é—®æƒé™ï¼Œå› ä¸ºéœ€è¦æ‹‰å–é•œåƒï¼›
5. èƒ½å¤Ÿè®¿é—®åˆ°`gcr.ioã€quay.io`è¿™ä¸¤ä¸ªdocker registryï¼Œå› ä¸ºæœ‰å°éƒ¨åˆ†é•œåƒéœ€è¦åœ¨è¿™é‡Œæ‹‰å–ï¼›
6. å•æœºå¯ç”¨èµ„æºå»ºè®®2æ ¸CPUã€8 GBå†…å­˜æˆ–ä»¥ä¸Šï¼Œå†å°çš„è¯é—®é¢˜ä¹Ÿä¸å¤§ï¼Œä½†æ˜¯èƒ½è°ƒåº¦çš„Podæ•°é‡å°±æ¯”è¾ƒæœ‰é™äº†ï¼›
7. 30 GBæˆ–ä»¥ä¸Šçš„å¯ç”¨ç£ç›˜ç©ºé—´ï¼Œè¿™ä¸»è¦æ˜¯ç•™ç»™Dockeré•œåƒå’Œæ—¥å¿—æ–‡ä»¶ç”¨çš„ã€‚

åœ¨æœ¬æ¬¡éƒ¨ç½²ä¸­ï¼Œæˆ‘å‡†å¤‡çš„æœºå™¨é…ç½®å¦‚ä¸‹ï¼š

1. 2æ ¸CPUã€ 7.5 GBå†…å­˜ï¼›
2. 30 GBç£ç›˜ï¼›
3. Ubuntu 16.04ï¼›
4. å†…ç½‘äº’é€šï¼›
5. å¤–ç½‘è®¿é—®æƒé™ä¸å—é™åˆ¶ã€‚

> å¤‡æ³¨ï¼šåœ¨å¼€å§‹éƒ¨ç½²å‰ï¼Œæˆ‘æ¨èä½ å…ˆèŠ±å‡ åˆ†é’Ÿæ—¶é—´ï¼Œå›å¿†ä¸€ä¸‹Kubernetesçš„æ¶æ„ã€‚

ç„¶åï¼Œæˆ‘å†å’Œä½ ä»‹ç»ä¸€ä¸‹ä»Šå¤©å®è·µçš„ç›®æ ‡ï¼š

1. åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šå®‰è£…Dockerå’Œkubeadmï¼›
2. éƒ¨ç½²Kubernetes Masterï¼›
3. éƒ¨ç½²å®¹å™¨ç½‘ç»œæ’ä»¶ï¼›
4. éƒ¨ç½²Kubernetes Workerï¼›
5. éƒ¨ç½²Dashboardå¯è§†åŒ–æ’ä»¶ï¼›
6. éƒ¨ç½²å®¹å™¨å­˜å‚¨æ’ä»¶ã€‚

å¥½äº†ï¼Œç°åœ¨ï¼Œå°±æ¥å¼€å§‹è¿™æ¬¡é›†ç¾¤éƒ¨ç½²ä¹‹æ—…å§ï¼

## å®‰è£…kubeadmå’ŒDocker

æˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ã€Š Kubernetesä¸€é”®éƒ¨ç½²åˆ©å™¨ï¼škubeadmã€‹ä¸­ï¼Œå·²ç»ä»‹ç»è¿‡kubeadmçš„åŸºç¡€ç”¨æ³•ï¼Œå®ƒçš„ä¸€é”®å®‰è£…éå¸¸æ–¹ä¾¿ï¼Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ kubeadmçš„æºï¼Œç„¶åç›´æ¥ä½¿ç”¨apt-getå®‰è£…å³å¯ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š

> å¤‡æ³¨ï¼šä¸ºäº†æ–¹ä¾¿è®²è§£ï¼Œæˆ‘åç»­éƒ½ä¼šç›´æ¥åœ¨rootç”¨æˆ·ä¸‹è¿›è¡Œæ“ä½œã€‚

```
$ curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -
$ cat <<EOF > /etc/apt/sources.list.d/kubernetes.list
deb http://apt.kubernetes.io/ kubernetes-xenial main
EOF
$ apt-get update
$ apt-get install -y docker.io kubeadm
```

> æç¤ºï¼šå¦‚æœ apt.kubernetes.io å› ä¸ºç½‘ç»œé—®é¢˜è®¿é—®ä¸åˆ°ï¼Œå¯ä»¥æ¢æˆä¸­ç§‘å¤§çš„ Ubuntu é•œåƒæºdeb [http://mirrors.ustc.edu.cn/kubernetes/apt](http://mirrors.ustc.edu.cn/kubernetes/apt) kubernetes-xenial mainã€‚

åœ¨ä¸Šè¿°å®‰è£…kubeadmçš„è¿‡ç¨‹ä¸­ï¼Œkubeadmå’Œkubeletã€kubectlã€kubernetes-cniè¿™å‡ ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶éƒ½ä¼šè¢«è‡ªåŠ¨å®‰è£…å¥½ã€‚

å¦å¤–ï¼Œè¿™é‡Œæˆ‘ç›´æ¥ä½¿ç”¨Ubuntuçš„docker.ioçš„å®‰è£…æºï¼ŒåŸå› æ˜¯Dockerå…¬å¸æ¯æ¬¡å‘å¸ƒçš„æœ€æ–°çš„Docker CEï¼ˆç¤¾åŒºç‰ˆï¼‰äº§å“å¾€å¾€è¿˜æ²¡æœ‰ç»è¿‡Kubernetesé¡¹ç›®çš„éªŒè¯ï¼Œå¯èƒ½ä¼šæœ‰å…¼å®¹æ€§æ–¹é¢çš„é—®é¢˜ã€‚

## éƒ¨ç½²Kubernetesçš„MasterèŠ‚ç‚¹

åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å·²ç»ä»‹ç»è¿‡kubeadmå¯ä»¥ä¸€é”®éƒ¨ç½²MasterèŠ‚ç‚¹ã€‚ä¸è¿‡ï¼Œåœ¨æœ¬ç¯‡æ–‡ç« ä¸­æ—¢ç„¶è¦éƒ¨ç½²ä¸€ä¸ªâ€œå®Œæ•´â€çš„Kubernetesé›†ç¾¤ï¼Œé‚£æˆ‘ä»¬ä¸å¦¨ç¨å¾®æé«˜ä¸€ä¸‹éš¾åº¦ï¼šé€šè¿‡é…ç½®æ–‡ä»¶æ¥å¼€å¯ä¸€äº›å®éªŒæ€§åŠŸèƒ½ã€‚

æ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘ç¼–å†™äº†ä¸€ä¸ªç»™kubeadmç”¨çš„YAMLæ–‡ä»¶ï¼ˆåå«ï¼škubeadm.yamlï¼‰ï¼š

```
apiVersion: kubeadm.k8s.io/v1alpha1
kind: MasterConfiguration
controllerManagerExtraArgs:
  horizontal-pod-autoscaler-use-rest-clients: "true"
  horizontal-pod-autoscaler-sync-period: "10s"
  node-monitor-grace-period: "10s"
apiServerExtraArgs:
  runtime-config: "api/all=true"
kubernetesVersion: "stable-1.11"
```

è¿™ä¸ªé…ç½®ä¸­ï¼Œæˆ‘ç»™kube-controller-managerè®¾ç½®äº†ï¼š

```
horizontal-pod-autoscaler-use-rest-clients: "true"
```

è¿™æ„å‘³ç€ï¼Œå°†æ¥éƒ¨ç½²çš„kube-controller-managerèƒ½å¤Ÿä½¿ç”¨è‡ªå®šä¹‰èµ„æºï¼ˆCustom Metricsï¼‰è¿›è¡Œè‡ªåŠ¨æ°´å¹³æ‰©å±•ã€‚è¿™æ˜¯æˆ‘åé¢æ–‡ç« ä¸­ä¼šé‡ç‚¹ä»‹ç»çš„ä¸€ä¸ªå†…å®¹ã€‚

å…¶ä¸­ï¼Œâ€œstable-1.11â€å°±æ˜¯kubeadmå¸®æˆ‘ä»¬éƒ¨ç½²çš„Kubernetesç‰ˆæœ¬å·ï¼Œå³ï¼šKubernetes release 1.11æœ€æ–°çš„ç¨³å®šç‰ˆï¼Œåœ¨æˆ‘çš„ç¯å¢ƒä¸‹ï¼Œå®ƒæ˜¯v1.11.1ã€‚ä½ ä¹Ÿå¯ä»¥ç›´æ¥æŒ‡å®šè¿™ä¸ªç‰ˆæœ¬ï¼Œæ¯”å¦‚ï¼škubernetesVersion: â€œv1.11.1â€ã€‚

ç„¶åï¼Œæˆ‘ä»¬åªéœ€è¦æ‰§è¡Œä¸€å¥æŒ‡ä»¤ï¼š

```
$ kubeadm init --config kubeadm.yaml
```

å°±å¯ä»¥å®ŒæˆKubernetes Masterçš„éƒ¨ç½²äº†ï¼Œè¿™ä¸ªè¿‡ç¨‹åªéœ€è¦å‡ åˆ†é’Ÿã€‚éƒ¨ç½²å®Œæˆåï¼Œkubeadmä¼šç”Ÿæˆä¸€è¡ŒæŒ‡ä»¤ï¼š

```
kubeadm join 10.168.0.2:6443 --token 00bwbx.uvnaa2ewjflwu1ry --discovery-token-ca-cert-hash sha256:00eb62a2a6020f94132e3fe1ab721349bbcd3e9b94da9654cfe15f2985ebd711
```

è¿™ä¸ªkubeadm joinå‘½ä»¤ï¼Œå°±æ˜¯ç”¨æ¥ç»™è¿™ä¸ªMasterèŠ‚ç‚¹æ·»åŠ æ›´å¤šå·¥ä½œèŠ‚ç‚¹ï¼ˆWorkerï¼‰çš„å‘½ä»¤ã€‚æˆ‘ä»¬åœ¨åé¢éƒ¨ç½²WorkerèŠ‚ç‚¹çš„æ—¶å€™é©¬ä¸Šä¼šç”¨åˆ°å®ƒï¼Œæ‰€ä»¥æ‰¾ä¸€ä¸ªåœ°æ–¹æŠŠè¿™æ¡å‘½ä»¤è®°å½•ä¸‹æ¥ã€‚

æ­¤å¤–ï¼Œkubeadmè¿˜ä¼šæç¤ºæˆ‘ä»¬ç¬¬ä¸€æ¬¡ä½¿ç”¨Kubernetesé›†ç¾¤æ‰€éœ€è¦çš„é…ç½®å‘½ä»¤ï¼š

```
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
```

è€Œéœ€è¦è¿™äº›é…ç½®å‘½ä»¤çš„åŸå› æ˜¯ï¼šKubernetesé›†ç¾¤é»˜è®¤éœ€è¦åŠ å¯†æ–¹å¼è®¿é—®ã€‚æ‰€ä»¥ï¼Œè¿™å‡ æ¡å‘½ä»¤ï¼Œå°±æ˜¯å°†åˆšåˆšéƒ¨ç½²ç”Ÿæˆçš„Kubernetesé›†ç¾¤çš„å®‰å…¨é…ç½®æ–‡ä»¶ï¼Œä¿å­˜åˆ°å½“å‰ç”¨æˆ·çš„.kubeç›®å½•ä¸‹ï¼Œkubectlé»˜è®¤ä¼šä½¿ç”¨è¿™ä¸ªç›®å½•ä¸‹çš„æˆæƒä¿¡æ¯è®¿é—®Kubernetesé›†ç¾¤ã€‚

å¦‚æœä¸è¿™ä¹ˆåšçš„è¯ï¼Œæˆ‘ä»¬æ¯æ¬¡éƒ½éœ€è¦é€šè¿‡export KUBECONFIGç¯å¢ƒå˜é‡å‘Šè¯‰kubectlè¿™ä¸ªå®‰å…¨é…ç½®æ–‡ä»¶çš„ä½ç½®ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨kubectl getå‘½ä»¤æ¥æŸ¥çœ‹å½“å‰å”¯ä¸€ä¸€ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€äº†ï¼š

```
$ kubectl get nodes

NAME      STATUS     ROLES     AGE       VERSION
master    NotReady   master    1d        v1.11.1
```

å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªgetæŒ‡ä»¤è¾“å‡ºçš„ç»“æœé‡Œï¼ŒMasterèŠ‚ç‚¹çš„çŠ¶æ€æ˜¯NotReadyï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

åœ¨è°ƒè¯•Kubernetesé›†ç¾¤æ—¶ï¼Œæœ€é‡è¦çš„æ‰‹æ®µå°±æ˜¯ç”¨kubectl describeæ¥æŸ¥çœ‹è¿™ä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰å¯¹è±¡çš„è¯¦ç»†ä¿¡æ¯ã€çŠ¶æ€å’Œäº‹ä»¶ï¼ˆEventï¼‰ï¼Œæˆ‘ä»¬æ¥è¯•ä¸€ä¸‹ï¼š

```
$ kubectl describe node master

...
Conditions:
...

Ready   False ... KubeletNotReady  runtime network not ready: NetworkReady=false reason:NetworkPluginNotReady message:docker: network plugin is not ready: cni config uninitialized
```

é€šè¿‡kubectl describeæŒ‡ä»¤çš„è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°NodeNotReadyçš„åŸå› åœ¨äºï¼Œæˆ‘ä»¬å°šæœªéƒ¨ç½²ä»»ä½•ç½‘ç»œæ’ä»¶ã€‚

å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡kubectlæ£€æŸ¥è¿™ä¸ªèŠ‚ç‚¹ä¸Šå„ä¸ªç³»ç»ŸPodçš„çŠ¶æ€ï¼Œå…¶ä¸­ï¼Œkube-systemæ˜¯Kubernetesé¡¹ç›®é¢„ç•™çš„ç³»ç»ŸPodçš„å·¥ä½œç©ºé—´ï¼ˆNamepsaceï¼Œæ³¨æ„å®ƒå¹¶ä¸æ˜¯Linux Namespaceï¼Œå®ƒåªæ˜¯Kubernetesåˆ’åˆ†ä¸åŒå·¥ä½œç©ºé—´çš„å•ä½ï¼‰ï¼š

```
$ kubectl get pods -n kube-system

NAME               READY   STATUS   RESTARTS  AGE
coredns-78fcdf6894-j9s52     0/1    Pending  0     1h
coredns-78fcdf6894-jm4wf     0/1    Pending  0     1h
etcd-master           1/1    Running  0     2s
kube-apiserver-master      1/1    Running  0     1s
kube-controller-manager-master  0/1    Pending  0     1s
kube-proxy-xbd47         1/1    NodeLost  0     1h
kube-scheduler-master      1/1    Running  0     1s
```

å¯ä»¥çœ‹åˆ°ï¼ŒCoreDNSã€kube-controller-managerç­‰ä¾èµ–äºç½‘ç»œçš„Podéƒ½å¤„äºPendingçŠ¶æ€ï¼Œå³è°ƒåº¦å¤±è´¥ã€‚è¿™å½“ç„¶æ˜¯ç¬¦åˆé¢„æœŸçš„ï¼šå› ä¸ºè¿™ä¸ªMasterèŠ‚ç‚¹çš„ç½‘ç»œå°šæœªå°±ç»ªã€‚

## éƒ¨ç½²ç½‘ç»œæ’ä»¶

åœ¨Kubernetesé¡¹ç›®â€œä¸€åˆ‡çš†å®¹å™¨â€çš„è®¾è®¡ç†å¿µæŒ‡å¯¼ä¸‹ï¼Œéƒ¨ç½²ç½‘ç»œæ’ä»¶éå¸¸ç®€å•ï¼Œåªéœ€è¦æ‰§è¡Œä¸€å¥kubectl applyæŒ‡ä»¤ï¼Œä»¥Weaveä¸ºä¾‹ï¼š

```
$ kubectl apply -f https://git.io/weave-kube-1.6
```

éƒ¨ç½²å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡kubectl geté‡æ–°æ£€æŸ¥Podçš„çŠ¶æ€ï¼š

```
$ kubectl get pods -n kube-system

NAME                             READY     STATUS    RESTARTS   AGE
coredns-78fcdf6894-j9s52         1/1       Running   0          1d
coredns-78fcdf6894-jm4wf         1/1       Running   0          1d
etcd-master                      1/1       Running   0          9s
kube-apiserver-master            1/1       Running   0          9s
kube-controller-manager-master   1/1       Running   0          9s
kube-proxy-xbd47                 1/1       Running   0          1d
kube-scheduler-master            1/1       Running   0          9s
weave-net-cmk27                  2/2       Running   0          19s
```

å¯ä»¥çœ‹åˆ°ï¼Œæ‰€æœ‰çš„ç³»ç»ŸPodéƒ½æˆåŠŸå¯åŠ¨äº†ï¼Œè€Œåˆšåˆšéƒ¨ç½²çš„Weaveç½‘ç»œæ’ä»¶åˆ™åœ¨kube-systemä¸‹é¢æ–°å»ºäº†ä¸€ä¸ªåå«weave-net-cmk27çš„Podï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™äº›Podå°±æ˜¯å®¹å™¨ç½‘ç»œæ’ä»¶åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„æ§åˆ¶ç»„ä»¶ã€‚

Kubernetesæ”¯æŒå®¹å™¨ç½‘ç»œæ’ä»¶ï¼Œä½¿ç”¨çš„æ˜¯ä¸€ä¸ªåå«CNIçš„é€šç”¨æ¥å£ï¼Œå®ƒä¹Ÿæ˜¯å½“å‰å®¹å™¨ç½‘ç»œçš„äº‹å®æ ‡å‡†ï¼Œå¸‚é¢ä¸Šçš„æ‰€æœ‰å®¹å™¨ç½‘ç»œå¼€æºé¡¹ç›®éƒ½å¯ä»¥é€šè¿‡CNIæ¥å…¥Kubernetesï¼Œæ¯”å¦‚Flannelã€Calicoã€Canalã€Romanaç­‰ç­‰ï¼Œå®ƒä»¬çš„éƒ¨ç½²æ–¹å¼ä¹Ÿéƒ½æ˜¯ç±»ä¼¼çš„â€œä¸€é”®éƒ¨ç½²â€ã€‚å…³äºè¿™äº›å¼€æºé¡¹ç›®çš„å®ç°ç»†èŠ‚å’Œå·®å¼‚ï¼Œæˆ‘ä¼šåœ¨åç»­çš„ç½‘ç»œéƒ¨åˆ†è¯¦ç»†ä»‹ç»ã€‚

è‡³æ­¤ï¼ŒKubernetesçš„MasterèŠ‚ç‚¹å°±éƒ¨ç½²å®Œæˆäº†ã€‚å¦‚æœä½ åªéœ€è¦ä¸€ä¸ªå•èŠ‚ç‚¹çš„Kubernetesï¼Œç°åœ¨ä½ å°±å¯ä»¥ä½¿ç”¨äº†ã€‚ä¸è¿‡ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒKubernetesçš„MasterèŠ‚ç‚¹æ˜¯ä¸èƒ½è¿è¡Œç”¨æˆ·Podçš„ï¼Œæ‰€ä»¥è¿˜éœ€è¦é¢å¤–åšä¸€ä¸ªå°æ“ä½œã€‚åœ¨æœ¬ç¯‡çš„æœ€åéƒ¨åˆ†ï¼Œæˆ‘ä¼šä»‹ç»åˆ°å®ƒã€‚

## éƒ¨ç½²Kubernetesçš„WorkerèŠ‚ç‚¹

Kubernetesçš„WorkerèŠ‚ç‚¹è·ŸMasterèŠ‚ç‚¹å‡ ä¹æ˜¯ç›¸åŒçš„ï¼Œå®ƒä»¬è¿è¡Œç€çš„éƒ½æ˜¯ä¸€ä¸ªkubeletç»„ä»¶ã€‚å”¯ä¸€çš„åŒºåˆ«åœ¨äºï¼Œåœ¨kubeadm initçš„è¿‡ç¨‹ä¸­ï¼Œkubeletå¯åŠ¨åï¼ŒMasterèŠ‚ç‚¹ä¸Šè¿˜ä¼šè‡ªåŠ¨è¿è¡Œkube-apiserverã€kube-schedulerã€kube-controller-mangerè¿™ä¸‰ä¸ªç³»ç»ŸPodã€‚

æ‰€ä»¥ï¼Œç›¸æ¯”ä¹‹ä¸‹ï¼Œéƒ¨ç½²WorkerèŠ‚ç‚¹åè€Œæ˜¯æœ€ç®€å•çš„ï¼Œåªéœ€è¦ä¸¤æ­¥å³å¯å®Œæˆã€‚

ç¬¬ä¸€æ­¥ï¼Œåœ¨æ‰€æœ‰WorkerèŠ‚ç‚¹ä¸Šæ‰§è¡Œâ€œå®‰è£…kubeadmå’ŒDockerâ€ä¸€èŠ‚çš„æ‰€æœ‰æ­¥éª¤ã€‚

ç¬¬äºŒæ­¥ï¼Œæ‰§è¡Œéƒ¨ç½²MasterèŠ‚ç‚¹æ—¶ç”Ÿæˆçš„kubeadm joinæŒ‡ä»¤ï¼š

```
$ kubeadm join 10.168.0.2:6443 --token 00bwbx.uvnaa2ewjflwu1ry --discovery-token-ca-cert-hash sha256:00eb62a2a6020f94132e3fe1ab721349bbcd3e9b94da9654cfe15f2985ebd711
```

## é€šè¿‡Taint/Tolerationè°ƒæ•´Masteræ‰§è¡ŒPodçš„ç­–ç•¥

æˆ‘åœ¨å‰é¢æåˆ°è¿‡ï¼Œé»˜è®¤æƒ…å†µä¸‹MasterèŠ‚ç‚¹æ˜¯ä¸å…è®¸è¿è¡Œç”¨æˆ·Podçš„ã€‚è€ŒKubernetesåšåˆ°è¿™ä¸€ç‚¹ï¼Œä¾é çš„æ˜¯Kubernetesçš„Taint/Tolerationæœºåˆ¶ã€‚

å®ƒçš„åŸç†éå¸¸ç®€å•ï¼šä¸€æ—¦æŸä¸ªèŠ‚ç‚¹è¢«åŠ ä¸Šäº†ä¸€ä¸ªTaintï¼Œå³è¢«â€œæ‰“ä¸Šäº†æ±¡ç‚¹â€ï¼Œé‚£ä¹ˆæ‰€æœ‰Podå°±éƒ½ä¸èƒ½åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œå› ä¸ºKubernetesçš„Podéƒ½æœ‰â€œæ´ç™–â€ã€‚

é™¤éï¼Œæœ‰ä¸ªåˆ«çš„Podå£°æ˜è‡ªå·±èƒ½â€œå®¹å¿â€è¿™ä¸ªâ€œæ±¡ç‚¹â€ï¼Œå³å£°æ˜äº†Tolerationï¼Œå®ƒæ‰å¯ä»¥åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œã€‚

å…¶ä¸­ï¼Œä¸ºèŠ‚ç‚¹æ‰“ä¸Šâ€œæ±¡ç‚¹â€ï¼ˆTaintï¼‰çš„å‘½ä»¤æ˜¯ï¼š

```
$ kubectl taint nodes node1 foo=bar:NoSchedule
```

è¿™æ—¶ï¼Œè¯¥node1èŠ‚ç‚¹ä¸Šå°±ä¼šå¢åŠ ä¸€ä¸ªé”®å€¼å¯¹æ ¼å¼çš„Taintï¼Œå³ï¼šfoo=bar:NoScheduleã€‚å…¶ä¸­å€¼é‡Œé¢çš„NoScheduleï¼Œæ„å‘³ç€è¿™ä¸ªTaintåªä¼šåœ¨è°ƒåº¦æ–°Podæ—¶äº§ç”Ÿä½œç”¨ï¼Œè€Œä¸ä¼šå½±å“å·²ç»åœ¨node1ä¸Šè¿è¡Œçš„Podï¼Œå“ªæ€•å®ƒä»¬æ²¡æœ‰Tolerationã€‚

é‚£ä¹ˆPodåˆå¦‚ä½•å£°æ˜Tolerationå‘¢ï¼Ÿ

æˆ‘ä»¬åªè¦åœ¨Podçš„.yamlæ–‡ä»¶ä¸­çš„specéƒ¨åˆ†ï¼ŒåŠ å…¥tolerationså­—æ®µå³å¯ï¼š

```
apiVersion: v1
kind: Pod
...
spec:
  tolerations:
  - key: "foo"
    operator: "Equal"
    value: "bar"
    effect: "NoSchedule"
```

è¿™ä¸ªTolerationçš„å«ä¹‰æ˜¯ï¼Œè¿™ä¸ªPodèƒ½â€œå®¹å¿â€æ‰€æœ‰é”®å€¼å¯¹ä¸ºfoo=barçš„Taintï¼ˆ operator: â€œEqualâ€ï¼Œâ€œç­‰äºâ€æ“ä½œï¼‰ã€‚

ç°åœ¨å›åˆ°æˆ‘ä»¬å·²ç»æ­å»ºçš„é›†ç¾¤ä¸Šæ¥ã€‚è¿™æ—¶ï¼Œå¦‚æœä½ é€šè¿‡kubectl describeæ£€æŸ¥ä¸€ä¸‹MasterèŠ‚ç‚¹çš„Taintå­—æ®µï¼Œå°±ä¼šæœ‰æ‰€å‘ç°äº†ï¼š

```
$ kubectl describe node master

Name:               master
Roles:              master
Taints:             node-role.kubernetes.io/master:NoSchedule
```

å¯ä»¥çœ‹åˆ°ï¼ŒMasterèŠ‚ç‚¹é»˜è®¤è¢«åŠ ä¸Šäº†`node-role.kubernetes.io/master:NoSchedule`è¿™æ ·ä¸€ä¸ªâ€œæ±¡ç‚¹â€ï¼Œå…¶ä¸­â€œé”®â€æ˜¯`node-role.kubernetes.io/master`ï¼Œè€Œæ²¡æœ‰æä¾›â€œå€¼â€ã€‚

æ­¤æ—¶ï¼Œä½ å°±éœ€è¦åƒä¸‹é¢è¿™æ ·ç”¨â€œExistsâ€æ“ä½œç¬¦ï¼ˆoperator: â€œExistsâ€ï¼Œâ€œå­˜åœ¨â€å³å¯ï¼‰æ¥è¯´æ˜ï¼Œè¯¥Podèƒ½å¤Ÿå®¹å¿æ‰€æœ‰ä»¥fooä¸ºé”®çš„Taintï¼Œæ‰èƒ½è®©è¿™ä¸ªPodè¿è¡Œåœ¨è¯¥MasterèŠ‚ç‚¹ä¸Šï¼š

```
apiVersion: v1
kind: Pod
...
spec:
  tolerations:
  - key: "foo"
    operator: "Exists"
    effect: "NoSchedule"
```

å½“ç„¶ï¼Œå¦‚æœä½ å°±æ˜¯æƒ³è¦ä¸€ä¸ªå•èŠ‚ç‚¹çš„Kubernetesï¼Œåˆ é™¤è¿™ä¸ªTaintæ‰æ˜¯æ­£ç¡®çš„é€‰æ‹©ï¼š

```
$ kubectl taint nodes --all node-role.kubernetes.io/master-
```

å¦‚ä¸Šæ‰€ç¤ºï¼Œæˆ‘ä»¬åœ¨â€œ`node-role.kubernetes.io/master`â€è¿™ä¸ªé”®åé¢åŠ ä¸Šäº†ä¸€ä¸ªçŸ­æ¨ªçº¿â€œ-â€ï¼Œè¿™ä¸ªæ ¼å¼å°±æ„å‘³ç€ç§»é™¤æ‰€æœ‰ä»¥â€œ`node-role.kubernetes.io/master`â€ä¸ºé”®çš„Taintã€‚

åˆ°äº†è¿™ä¸€æ­¥ï¼Œä¸€ä¸ªåŸºæœ¬å®Œæ•´çš„Kubernetesé›†ç¾¤å°±éƒ¨ç½²å®Œæ¯•äº†ã€‚æ˜¯ä¸æ˜¯å¾ˆç®€å•å‘¢ï¼Ÿ

æœ‰äº†kubeadmè¿™æ ·çš„åŸç”Ÿç®¡ç†å·¥å…·ï¼ŒKubernetesçš„éƒ¨ç½²å·²ç»è¢«å¤§å¤§ç®€åŒ–ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œåƒè¯ä¹¦ã€æˆæƒã€å„ä¸ªç»„ä»¶çš„é…ç½®ç­‰éƒ¨ç½²ä¸­æœ€éº»çƒ¦çš„æ“ä½œï¼Œkubeadméƒ½å·²ç»å¸®ä½ å®Œæˆäº†ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†åœ¨è¿™ä¸ªKubernetesé›†ç¾¤ä¸Šå®‰è£…ä¸€äº›å…¶ä»–çš„è¾…åŠ©æ’ä»¶ï¼Œæ¯”å¦‚Dashboardå’Œå­˜å‚¨æ’ä»¶ã€‚

## éƒ¨ç½²Dashboardå¯è§†åŒ–æ’ä»¶

åœ¨Kubernetesç¤¾åŒºä¸­ï¼Œæœ‰ä¸€ä¸ªå¾ˆå—æ¬¢è¿çš„Dashboardé¡¹ç›®ï¼Œå®ƒå¯ä»¥ç»™ç”¨æˆ·æä¾›ä¸€ä¸ªå¯è§†åŒ–çš„Webç•Œé¢æ¥æŸ¥çœ‹å½“å‰é›†ç¾¤çš„å„ç§ä¿¡æ¯ã€‚æ¯«ä¸æ„å¤–ï¼Œå®ƒçš„éƒ¨ç½²ä¹Ÿç›¸å½“ç®€å•ï¼š

```
$ kubectl apply -f 
$ $ kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-rc6/aio/deploy/recommended.yaml
```

éƒ¨ç½²å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æŸ¥çœ‹Dashboardå¯¹åº”çš„Podçš„çŠ¶æ€äº†ï¼š

```
$ kubectl get pods -n kube-system

kubernetes-dashboard-6948bdb78-f67xk   1/1       Running   0          1m
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºDashboardæ˜¯ä¸€ä¸ªWeb Serverï¼Œå¾ˆå¤šäººç»å¸¸ä¼šåœ¨è‡ªå·±çš„å…¬æœ‰äº‘ä¸Šæ— æ„åœ°æš´éœ²Dashboardçš„ç«¯å£ï¼Œä»è€Œé€ æˆå®‰å…¨éšæ‚£ã€‚æ‰€ä»¥ï¼Œ1.7ç‰ˆæœ¬ä¹‹åçš„Dashboardé¡¹ç›®éƒ¨ç½²å®Œæˆåï¼Œé»˜è®¤åªèƒ½é€šè¿‡Proxyçš„æ–¹å¼åœ¨æœ¬åœ°è®¿é—®ã€‚å…·ä½“çš„æ“ä½œï¼Œä½ å¯ä»¥æŸ¥çœ‹Dashboardé¡¹ç›®çš„[å®˜æ–¹æ–‡æ¡£](https://github.com/kubernetes/dashboard)ã€‚

è€Œå¦‚æœä½ æƒ³ä»é›†ç¾¤å¤–è®¿é—®è¿™ä¸ªDashboardçš„è¯ï¼Œå°±éœ€è¦ç”¨åˆ°Ingressï¼Œæˆ‘ä¼šåœ¨åé¢çš„æ–‡ç« ä¸­ä¸“é—¨ä»‹ç»è¿™éƒ¨åˆ†å†…å®¹ã€‚

## éƒ¨ç½²å®¹å™¨å­˜å‚¨æ’ä»¶

æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬å®Œæˆè¿™ä¸ªKubernetesé›†ç¾¤çš„æœ€åä¸€å—æ‹¼å›¾ï¼šå®¹å™¨æŒä¹…åŒ–å­˜å‚¨ã€‚

æˆ‘åœ¨å‰é¢ä»‹ç»å®¹å™¨åŸç†æ—¶å·²ç»æåˆ°è¿‡ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦ç”¨æ•°æ®å·ï¼ˆVolumeï¼‰æŠŠå¤–é¢å®¿ä¸»æœºä¸Šçš„ç›®å½•æˆ–è€…æ–‡ä»¶æŒ‚è½½è¿›å®¹å™¨çš„Mount Namespaceä¸­ï¼Œä»è€Œè¾¾åˆ°å®¹å™¨å’Œå®¿ä¸»æœºå…±äº«è¿™äº›ç›®å½•æˆ–è€…æ–‡ä»¶çš„ç›®çš„ã€‚å®¹å™¨é‡Œçš„åº”ç”¨ï¼Œä¹Ÿå°±å¯ä»¥åœ¨è¿™äº›æ•°æ®å·ä¸­æ–°å»ºå’Œå†™å…¥æ–‡ä»¶ã€‚

å¯æ˜¯ï¼Œå¦‚æœä½ åœ¨æŸä¸€å°æœºå™¨ä¸Šå¯åŠ¨çš„ä¸€ä¸ªå®¹å™¨ï¼Œæ˜¾ç„¶æ— æ³•çœ‹åˆ°å…¶ä»–æœºå™¨ä¸Šçš„å®¹å™¨åœ¨å®ƒä»¬çš„æ•°æ®å·é‡Œå†™å…¥çš„æ–‡ä»¶ã€‚**è¿™æ˜¯å®¹å™¨æœ€å…¸å‹çš„ç‰¹å¾ä¹‹ä¸€ï¼šæ— çŠ¶æ€ã€‚**

è€Œå®¹å™¨çš„æŒä¹…åŒ–å­˜å‚¨ï¼Œå°±æ˜¯ç”¨æ¥ä¿å­˜å®¹å™¨å­˜å‚¨çŠ¶æ€çš„é‡è¦æ‰‹æ®µï¼šå­˜å‚¨æ’ä»¶ä¼šåœ¨å®¹å™¨é‡ŒæŒ‚è½½ä¸€ä¸ªåŸºäºç½‘ç»œæˆ–è€…å…¶ä»–æœºåˆ¶çš„è¿œç¨‹æ•°æ®å·ï¼Œä½¿å¾—åœ¨å®¹å™¨é‡Œåˆ›å»ºçš„æ–‡ä»¶ï¼Œå®é™…ä¸Šæ˜¯ä¿å­˜åœ¨è¿œç¨‹å­˜å‚¨æœåŠ¡å™¨ä¸Šï¼Œæˆ–è€…ä»¥åˆ†å¸ƒå¼çš„æ–¹å¼ä¿å­˜åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œè€Œä¸å½“å‰å®¿ä¸»æœºæ²¡æœ‰ä»»ä½•ç»‘å®šå…³ç³»ã€‚è¿™æ ·ï¼Œæ— è®ºä½ åœ¨å…¶ä»–å“ªä¸ªå®¿ä¸»æœºä¸Šå¯åŠ¨æ–°çš„å®¹å™¨ï¼Œéƒ½å¯ä»¥è¯·æ±‚æŒ‚è½½æŒ‡å®šçš„æŒä¹…åŒ–å­˜å‚¨å·ï¼Œä»è€Œè®¿é—®åˆ°æ•°æ®å·é‡Œä¿å­˜çš„å†…å®¹ã€‚**è¿™å°±æ˜¯â€œæŒä¹…åŒ–â€çš„å«ä¹‰ã€‚**

ç”±äºKubernetesæœ¬èº«çš„æ¾è€¦åˆè®¾è®¡ï¼Œç»å¤§å¤šæ•°å­˜å‚¨é¡¹ç›®ï¼Œæ¯”å¦‚Cephã€GlusterFSã€NFSç­‰ï¼Œéƒ½å¯ä»¥ä¸ºKubernetesæä¾›æŒä¹…åŒ–å­˜å‚¨èƒ½åŠ›ã€‚åœ¨è¿™æ¬¡çš„éƒ¨ç½²å®æˆ˜ä¸­ï¼Œæˆ‘ä¼šé€‰æ‹©éƒ¨ç½²ä¸€ä¸ªå¾ˆé‡è¦çš„Kuberneteså­˜å‚¨æ’ä»¶é¡¹ç›®ï¼šRookã€‚

Rooké¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºCephçš„Kuberneteså­˜å‚¨æ’ä»¶ï¼ˆå®ƒåæœŸä¹Ÿåœ¨åŠ å…¥å¯¹æ›´å¤šå­˜å‚¨å®ç°çš„æ”¯æŒï¼‰ã€‚ä¸è¿‡ï¼Œä¸åŒäºå¯¹Cephçš„ç®€å•å°è£…ï¼ŒRookåœ¨è‡ªå·±çš„å®ç°ä¸­åŠ å…¥äº†æ°´å¹³æ‰©å±•ã€è¿ç§»ã€ç¾éš¾å¤‡ä»½ã€ç›‘æ§ç­‰å¤§é‡çš„ä¼ä¸šçº§åŠŸèƒ½ï¼Œä½¿å¾—è¿™ä¸ªé¡¹ç›®å˜æˆäº†ä¸€ä¸ªå®Œæ•´çš„ã€ç”Ÿäº§çº§åˆ«å¯ç”¨çš„å®¹å™¨å­˜å‚¨æ’ä»¶ã€‚

å¾—ç›Šäºå®¹å™¨åŒ–æŠ€æœ¯ï¼Œç”¨å‡ æ¡æŒ‡ä»¤ï¼ŒRookå°±å¯ä»¥æŠŠå¤æ‚çš„Cephå­˜å‚¨åç«¯éƒ¨ç½²èµ·æ¥ï¼š

```
$ kubectl apply -f https://raw.githubusercontent.com/rook/rook/master/cluster/examples/kubernetes/ceph/common.yaml

$ kubectl apply -f https://raw.githubusercontent.com/rook/rook/master/cluster/examples/kubernetes/ceph/operator.yaml

$ kubectl apply -f https://raw.githubusercontent.com/rook/rook/master/cluster/examples/kubernetes/ceph/cluster.yaml
```

åœ¨éƒ¨ç½²å®Œæˆåï¼Œä½ å°±å¯ä»¥çœ‹åˆ°Rooké¡¹ç›®ä¼šå°†è‡ªå·±çš„Podæ”¾ç½®åœ¨ç”±å®ƒè‡ªå·±ç®¡ç†çš„ä¸¤ä¸ªNamespaceå½“ä¸­ï¼š

```
$ kubectl get pods -n rook-ceph-system
NAME                                  READY     STATUS    RESTARTS   AGE
rook-ceph-agent-7cv62                 1/1       Running   0          15s
rook-ceph-operator-78d498c68c-7fj72   1/1       Running   0          44s
rook-discover-2ctcv                   1/1       Running   0          15s

$ kubectl get pods -n rook-ceph
NAME                   READY     STATUS    RESTARTS   AGE
rook-ceph-mon0-kxnzh   1/1       Running   0          13s
rook-ceph-mon1-7dn2t   1/1       Running   0          2s
```

è¿™æ ·ï¼Œä¸€ä¸ªåŸºäºRookæŒä¹…åŒ–å­˜å‚¨é›†ç¾¤å°±ä»¥å®¹å™¨çš„æ–¹å¼è¿è¡Œèµ·æ¥äº†ï¼Œè€Œæ¥ä¸‹æ¥åœ¨Kubernetesé¡¹ç›®ä¸Šåˆ›å»ºçš„æ‰€æœ‰Podå°±èƒ½å¤Ÿé€šè¿‡Persistent Volumeï¼ˆPVï¼‰å’ŒPersistent Volume Claimï¼ˆPVCï¼‰çš„æ–¹å¼ï¼Œåœ¨å®¹å™¨é‡ŒæŒ‚è½½ç”±Cephæä¾›çš„æ•°æ®å·äº†ã€‚

è€ŒRooké¡¹ç›®ï¼Œåˆ™ä¼šè´Ÿè´£è¿™äº›æ•°æ®å·çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€ç¾éš¾å¤‡ä»½ç­‰è¿ç»´å·¥ä½œã€‚å…³äºè¿™äº›å®¹å™¨æŒä¹…åŒ–å­˜å‚¨çš„çŸ¥è¯†ï¼Œæˆ‘ä¼šåœ¨åç»­ç« èŠ‚ä¸­ä¸“é—¨è®²è§£ã€‚

è¿™æ—¶å€™ï¼Œä½ å¯èƒ½ä¼šæœ‰ä¸ªç–‘é—®ï¼šä¸ºä»€ä¹ˆæˆ‘è¦é€‰æ‹©Rooké¡¹ç›®å‘¢ï¼Ÿ

å…¶å®ï¼Œæ˜¯å› ä¸ºè¿™ä¸ªé¡¹ç›®å¾ˆæœ‰å‰é€”ã€‚

å¦‚æœä½ å»ç ”ç©¶ä¸€ä¸‹Rooké¡¹ç›®çš„å®ç°ï¼Œå°±ä¼šå‘ç°å®ƒå·§å¦™åœ°ä¾èµ–äº†Kubernetesæä¾›çš„ç¼–æ’èƒ½åŠ›ï¼Œåˆç†çš„ä½¿ç”¨äº†å¾ˆå¤šè¯¸å¦‚Operatorã€CRDç­‰é‡è¦çš„æ‰©å±•ç‰¹æ€§ï¼ˆè¿™äº›ç‰¹æ€§æˆ‘éƒ½ä¼šåœ¨åé¢çš„æ–‡ç« ä¸­é€ä¸€è®²è§£åˆ°ï¼‰ã€‚è¿™ä½¿å¾—Rooké¡¹ç›®ï¼Œæˆä¸ºäº†ç›®å‰ç¤¾åŒºä¸­åŸºäºKubernetes APIæ„å»ºçš„æœ€å®Œå–„ä¹Ÿæœ€æˆç†Ÿçš„å®¹å™¨å­˜å‚¨æ’ä»¶ã€‚æˆ‘ç›¸ä¿¡ï¼Œè¿™æ ·çš„å‘å±•è·¯çº¿ï¼Œå¾ˆå¿«å°±ä¼šå¾—åˆ°æ•´ä¸ªç¤¾åŒºçš„æ¨å´‡ã€‚

> å¤‡æ³¨ï¼šå…¶å®ï¼Œåœ¨å¾ˆå¤šæ—¶å€™ï¼Œå¤§å®¶è¯´çš„æ‰€è°“â€œäº‘åŸç”Ÿâ€ï¼Œå°±æ˜¯â€œKubernetesåŸç”Ÿâ€çš„æ„æ€ã€‚è€ŒåƒRookã€Istioè¿™æ ·çš„é¡¹ç›®ï¼Œæ­£æ˜¯è´¯å½»è¿™ä¸ªæ€è·¯çš„å…¸èŒƒã€‚åœ¨æˆ‘ä»¬åé¢è®²è§£äº†å£°æ˜å¼APIä¹‹åï¼Œç›¸ä¿¡ä½ å¯¹è¿™äº›é¡¹ç›®çš„è®¾è®¡æ€æƒ³ä¼šæœ‰æ›´æ·±åˆ»çš„ä½“ä¼šã€‚

## æ€»ç»“

åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å®Œå…¨ä»0å¼€å§‹ï¼Œåœ¨Bare-metalç¯å¢ƒä¸‹ä½¿ç”¨kubeadmå·¥å…·éƒ¨ç½²äº†ä¸€ä¸ªå®Œæ•´çš„Kubernetesé›†ç¾¤ï¼šè¿™ä¸ªé›†ç¾¤æœ‰ä¸€ä¸ªMasterèŠ‚ç‚¹å’Œå¤šä¸ªWorkerèŠ‚ç‚¹ï¼›ä½¿ç”¨Weaveä½œä¸ºå®¹å™¨ç½‘ç»œæ’ä»¶ï¼›ä½¿ç”¨Rookä½œä¸ºå®¹å™¨æŒä¹…åŒ–å­˜å‚¨æ’ä»¶ï¼›ä½¿ç”¨Dashboardæ’ä»¶æä¾›äº†å¯è§†åŒ–çš„Webç•Œé¢ã€‚

è¿™ä¸ªé›†ç¾¤ï¼Œä¹Ÿå°†ä¼šæ˜¯æˆ‘è¿›è¡Œåç»­è®²è§£æ‰€ä¾èµ–çš„é›†ç¾¤ç¯å¢ƒï¼Œå¹¶ä¸”åœ¨åé¢çš„è®²è§£ä¸­ï¼Œæˆ‘è¿˜ä¼šç»™å®ƒå®‰è£…æ›´å¤šçš„æ’ä»¶ï¼Œæ·»åŠ æ›´å¤šçš„æ–°èƒ½åŠ›ã€‚

å¦å¤–ï¼Œè¿™ä¸ªé›†ç¾¤çš„éƒ¨ç½²è¿‡ç¨‹å¹¶ä¸åƒä¼ è¯´ä¸­é‚£ä¹ˆç¹çï¼Œè¿™ä¸»è¦å¾—ç›Šäºï¼š

1. kubeadmé¡¹ç›®å¤§å¤§ç®€åŒ–äº†éƒ¨ç½²Kubernetesçš„å‡†å¤‡å·¥ä½œï¼Œå°¤å…¶æ˜¯é…ç½®æ–‡ä»¶ã€è¯ä¹¦ã€äºŒè¿›åˆ¶æ–‡ä»¶çš„å‡†å¤‡å’Œåˆ¶ä½œï¼Œä»¥åŠé›†ç¾¤ç‰ˆæœ¬ç®¡ç†ç­‰æ“ä½œï¼Œéƒ½è¢«kubeadmæ¥ç®¡äº†ã€‚
2. Kubernetesæœ¬èº«â€œä¸€åˆ‡çš†å®¹å™¨â€çš„è®¾è®¡æ€æƒ³ï¼ŒåŠ ä¸Šè‰¯å¥½çš„å¯æ‰©å±•æœºåˆ¶ï¼Œä½¿å¾—æ’ä»¶çš„éƒ¨ç½²éå¸¸ç®€ä¾¿ã€‚

ä¸Šè¿°æ€æƒ³ï¼Œä¹Ÿæ˜¯å¼€å‘å’Œä½¿ç”¨Kubernetesçš„é‡è¦æŒ‡å¯¼æ€æƒ³ï¼Œå³ï¼šåŸºäºKuberneteså¼€å±•å·¥ä½œæ—¶ï¼Œä½ ä¸€å®šè¦ä¼˜å…ˆè€ƒè™‘è¿™ä¸¤ä¸ªé—®é¢˜ï¼š

1. æˆ‘çš„å·¥ä½œæ˜¯ä¸æ˜¯å¯ä»¥å®¹å™¨åŒ–ï¼Ÿ
2. æˆ‘çš„å·¥ä½œæ˜¯ä¸æ˜¯å¯ä»¥å€ŸåŠ©Kubernetes APIå’Œå¯æ‰©å±•æœºåˆ¶æ¥å®Œæˆï¼Ÿ

è€Œä¸€æ—¦è¿™é¡¹å·¥ä½œèƒ½å¤ŸåŸºäºKuberneteså®ç°å®¹å™¨åŒ–ï¼Œå°±å¾ˆæœ‰å¯èƒ½åƒä¸Šé¢çš„éƒ¨ç½²è¿‡ç¨‹ä¸€æ ·ï¼Œå¤§å¹…ç®€åŒ–åŸæœ¬å¤æ‚çš„è¿ç»´å·¥ä½œã€‚å¯¹äºæ—¶é—´å®è´µçš„æŠ€æœ¯äººå‘˜æ¥è¯´ï¼Œè¿™ä¸ªå˜åŒ–çš„é‡è¦æ€§æ˜¯ä¸è¨€è€Œå–»çš„ã€‚

## æ€è€ƒé¢˜

1. ä½ æ˜¯å¦ä½¿ç”¨å…¶ä»–å·¥å…·éƒ¨ç½²è¿‡Kubernetesé¡¹ç›®ï¼Ÿç»å†å¦‚ä½•ï¼Ÿ
2. ä½ æ˜¯å¦çŸ¥é“Kubernetesé¡¹ç›®å½“å‰ï¼ˆv1.11ï¼‰èƒ½å¤Ÿæœ‰æ•ˆç®¡ç†çš„é›†ç¾¤è§„æ¨¡æ˜¯å¤šå°‘ä¸ªèŠ‚ç‚¹ï¼Ÿä½ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¸Œæœ›éƒ¨ç½²æˆ–è€…æ­£åœ¨éƒ¨ç½²çš„é›†ç¾¤è§„æ¨¡åˆæ˜¯å¤šå°‘ä¸ªèŠ‚ç‚¹å‘¢ï¼Ÿ

æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæ¬¢è¿ä½ ç»™æˆ‘ç•™è¨€ï¼Œä¹Ÿæ¬¢è¿åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ15ï¼‰</strong></div><ul>
<li><span>Roy Liang</span> ğŸ‘ï¼ˆ65ï¼‰ ğŸ’¬ï¼ˆ7ï¼‰<p>kubeadmæœ€æ–°ç‰ˆæœ¬å·²ç»ä¸º1.12ï¼Œçœ‹åˆ°ä¸Šé¢å¾ˆå¤šäººé‡åˆ°æç¤ºç‰ˆæœ¬ä¸å¯¹ï¼Œé‡æ–°å®‰è£…ä½ç‰ˆæœ¬å°±å¥½äº†
apt remove kubelet kubectl kubeadm
apt install kubelet=1.11.3-00
apt install kubectl=1.11.3-00
apt install kubeadm=1.11.3-00</p>2018-09-29</li><br/><li><span>Andy</span> ğŸ‘ï¼ˆ29ï¼‰ ğŸ’¬ï¼ˆ6ï¼‰<p>æœ€æ–°çš„éƒ¨ç½²ceph clusteréœ€è¦å¤šä¸€æ¡éƒ¨ç½²å‘½ä»¤æ‰å¯ä»¥éƒ¨ç½²æˆåŠŸï¼š
1. kubectl apply -f https:&#47;&#47;raw.githubusercontent.com&#47;rook&#47;rook&#47;master&#47;cluster&#47;examples&#47;kubernetes&#47;ceph&#47;common.yaml
2. kubectl apply -f https:&#47;&#47;raw.githubusercontent.com&#47;rook&#47;rook&#47;master&#47;cluster&#47;examples&#47;kubernetes&#47;ceph&#47;operator.yaml
3. kubectl apply -f https:&#47;&#47;raw.githubusercontent.com&#47;rook&#47;rook&#47;master&#47;cluster&#47;examples&#47;kubernetes&#47;ceph&#47;cluster.yaml</p>2019-04-17</li><br/><li><span>åŒ…æ²»ç»“å·´</span> ğŸ‘ï¼ˆ12ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>å¼ è€å¸ˆï¼Œè¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼Œmasteréƒ¨ç½²å®Œæˆåç”ŸæˆæŒ‡ä»¤ï¼Œæ¯”å¦‚â€œ kubeadm join 172.19.0.7:6443 --token xw4d6t.1dmpctojkcg9yqlf --discovery-token-ca-cert-hash sha256:45168e55ad19ac6126728e86c0a4c46e98c7df5d0312aec3fdd8d437dc24a3b9â€ï¼Œå‡å¦‚å½“æ—¶æ²¡æœ‰è®°ä¸‹æ¥ï¼Œæœ‰ä»€ä¹ˆå‘½ä»¤å¯ä»¥å†æ¬¡è®©masterç”Ÿæˆè¿™ä¸ªæŒ‡ä»¤å—ï¼Ÿ</p>2018-09-18</li><br/><li><span>å¿ƒæƒ…ä¸é”™</span> ğŸ‘ï¼ˆ11ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>ä»¥åæ˜¯ä¸æ˜¯å¼€å‘è´Ÿè´£éƒ¨ç½²å•ä¸ªdockerï¼Œ è¿ç»´è´Ÿè´£å®è§‚kubernetes?</p>2018-09-17</li><br/><li><span>John</span> ğŸ‘ï¼ˆ10ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>éå¸¸å¼ºçš„æŒ«è´¥æ„Ÿã€‚ç¬¬ä¸€ï¼Œæ‰“è´¥å¢™ï¼ŒèŠ±äº†å‡ å¤©ã€‚ç„¶åï¼Œåº”ç”¨äº†ç½‘ç»œæ’ä»¶ï¼Œä½†æ˜¯ä»ç„¶æ˜¯ not readyï¼Œæç¤ºè¿˜æ˜¯ network plugin  is not ready cni config uninitiatedã€‚è¯·é—®æ€ä¹ˆçœ‹æ—¥å¿—å‘¢ï¼Ÿ</p>2018-09-25</li><br/><li><span>hpfish</span> ğŸ‘ï¼ˆ10ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>ä¸ºä»€ä¹ˆä¸è§£é‡Šä¸€äº›å¸¸è§çš„é—®é¢˜å‘¢ï¼Ÿç¬¬ä¸€æ¬¡éƒ¨å“ªæœ‰é‚£ä¹ˆé¡ºå•Š</p>2018-09-22</li><br/><li><span>é€‰æ‹©</span> ğŸ‘ï¼ˆ8ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>ä½ å¥½ï¼Œç…§ç€ä½ çš„æ•™ç¨‹ï¼Œæˆ‘åœ¨æ‰§è¡Œkubeadm init --config kubeadm.yamlï¼Œ æç¤ºï¼šyour configuration file uses an old API spec: &quot;kubeadm.k8s.io&#47;v1alpha1&quot;. Please use kubeadm v1.11 instead and run &#39;kubeadm config migrate --old-config old.yaml --new-config new.yaml&#39;, which will write the new, similar spec using a newer API version.ç”¨å…¨æ–°çš„è™šæ‹Ÿæœºå®‰è£…çš„ è¯¥æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ è°¢è°¢äº†</p>2018-09-26</li><br/><li><span>Jeff.W</span> ğŸ‘ï¼ˆ7ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>ç½‘ç»œå—é™çš„è¯è§‰å¾—å¯ä»¥å‚è€ƒä¸€ä¸‹è¿™ä¸ªï¼Œä½¿ç”¨Ansibleè„šæœ¬å®‰è£…K8Sé›†ç¾¤ï¼Œä»‹ç»ç»„ä»¶äº¤äº’åŸç†ï¼Œæ–¹ä¾¿ç›´æ¥ï¼Œä¸å—å›½å†…ç½‘ç»œç¯å¢ƒå½±å“ https:&#47;&#47;github.com&#47;gjmzj&#47;kubeaszã€‚æœºå™¨èµ„æºæœ‰é™å°±å¼„ä¸ªAllInOneï¼Ÿæˆ–è€…å•ä¸»å¤šä»ï¼Ÿè€å¸ˆæ€ä¹ˆçœ‹ï¼Ÿ</p>2018-09-20</li><br/><li><span>huan</span> ğŸ‘ï¼ˆ7ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>åˆ†äº«ä¸€ä¸‹è¿™ç¯‡å®è·µçš„å°æ’æ›²ï¼Œæˆ‘æ˜¯ä½¿ç”¨DigitalOceançš„æœºå™¨åšçš„ï¼Œæ²¡æœ‰å¢™çš„é—®é¢˜ã€‚
åœ¨ä½¿ç”¨weave-netçš„æ—¶å€™ï¼Œæ€ä¹ˆéƒ½é€šä¸è¿‡ï¼ŒæŠ¥é”™æ˜¯ weave-netçš„çŠ¶æ€æ˜¯ CrashLoopBackOffï¼Œçœ‹äº†containerçš„logï¼Œä¹Ÿä¸æ‡‚å•¥æ„æ€ï¼Œæ‰¾äº†ä¸‹k8sçš„troubleshooté¡µé¢çš„è¯´æ˜ ï¼ˆhttps:&#47;&#47;kubernetes.io&#47;docs&#47;setup&#47;independent&#47;troubleshooting-kubeadm&#47;#pods-in-runcontainererror-crashloopbackoff-or-error-stateï¼‰ï¼Œè¯´æ˜¯ç‰ˆæœ¬é—®é¢˜ï¼Œä¸çŸ¥é“æ€ä¹ˆè§£å†³ã€‚
ç„¶åéšä¾¿æ‰¾äº†å¦ä¸€ä¸ªå®ç° Romanaï¼Œæ›¿æ¢weavenet
`kubectl apply -f https:&#47;&#47;raw.githubusercontent.com&#47;romana&#47;romana&#47;master&#47;containerize&#47;specs&#47;romana-kubeadm.yml` ç»ˆäºæˆåŠŸäº†ï¼Œç„¶åä½“éªŒåˆ°äº†ä»¥å‰æƒ³éƒ½ä¸æ•¢æƒ³çš„Cephï¼Œè¶…èµ</p>2018-09-17</li><br/><li><span>wu526</span> ğŸ‘ï¼ˆ5ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>åœ¨æ‰§è¡Œkubeadm init config kubeadm.yamlæ—¶æŠ¥å¦‚ä¸‹é”™è¯¯ï¼š
your configuration file uses an old API spec: &quot;kubeadm.k8s.io&#47;v1alpha1&quot;. Please use kubeadm v1.11 instead and run &#39;kubeadm config migrate --old-config old.yaml --new-config new.yaml&#39;, which will write the new, similar spec using a newer API version.

kubedadmçš„ç‰ˆæœ¬ä¿¡æ¯æ˜¯:
kubeadm version: &amp;version.Info{Major:&quot;1&quot;, Minor:&quot;12&quot;, GitVersion:&quot;v1.12.0&quot;, GitCommit:&quot;0ed33881dc4355495f623c6f22e7dd0b7632b7c0&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-09-27T17:02:38Z&quot;, GoVersion:&quot;go1.10.4&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux&#47;amd64&quot;}
ç³»ç»Ÿç¯å¢ƒæ˜¯ï¼šubuntu server 16.04

åœ¨googleä¹Ÿæœç´¢äº†ï¼Œæ²¡æœ‰æ‰¾åˆ°è§£å†³æ–¹æ³•ã€‚éº»çƒ¦è€å¸ˆè§£ç­”ä¸€ä¸‹è§£å†³æ–¹æ³•ã€‚
ä»Šååœ¨é‡åˆ°ç±»ä¼¼çš„é—®é¢˜æ—¶ï¼Œåº”è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Œå¸Œæœ›å¼ è€å¸ˆèƒ½æä¾›ä¸€ä¸ªè§£å†³é—®é¢˜çš„æ€è·¯ã€‚æˆ–è€…æ˜¯å¦‚ä½•æ‰èƒ½æŸ¥çœ‹ä¸åŒç‰ˆæœ¬çš„kubernetesçš„å‚æ•°çš„å·®å¼‚å˜åŒ–ã€‚
è°¢è°¢å¼ è€å¸ˆ~</p>2018-09-28</li><br/><li><span>åŒå¿ƒç»“</span> ğŸ‘ï¼ˆ5ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>ä½ å¥½ï¼Œæˆ‘æ­å¥½äº†èŠ‚ç‚¹é‡å¯ä¹‹åæœåŠ¡æ²¡èµ·æ¥ï¼Œæˆ‘æ€ä¹ˆè®©æœåŠ¡è·‘èµ·æ¥å‘€</p>2018-09-24</li><br/><li><span>John</span> ğŸ‘ï¼ˆ5ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>ä¸ç¿»å¢™ æœ‰åŠæ³•è£… kubeadm å—ï¼Ÿ</p>2018-09-18</li><br/><li><span>å°é±¼å„¿</span> ğŸ‘ï¼ˆ5ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>è€å¸ˆï¼Œè¯·é—®ä½ çš„â€œ-â€æ˜¯æ€ä¹ˆè¯»çš„ï¼Ÿ</p>2018-09-17</li><br/><li><span>Hurt</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆ æˆ‘ä¸€ç›´æƒ³é—® è¿™ä¸ªé›†ç¾¤ æ˜¯åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šå— è¿˜æ˜¯å¤šå°å•Š</p>2018-09-21</li><br/><li><span>åˆ˜æ¬£æ´²</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>Rook èƒ½å¤Ÿç›´æ¥æ”¯æŒGoogle çš„ GCPçš„persistent disk å—ï¼Ÿè¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ</p>2018-09-18</li><br/>
</ul>