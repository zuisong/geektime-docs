ä½ å¥½ï¼Œæˆ‘æ˜¯é«˜æ¥¼ã€‚

è¿™èŠ‚è¯¾æˆ‘è¦å¸¦ä½ æ¥çœ‹ä¸€ä¸ªå®Œæ•´çš„æ€§èƒ½åˆ†ææ¡ˆä¾‹çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œç”¨æ‰“å¼€é¦–é¡µæ¥å£åšå‹åŠ›åœºæ™¯ï¼Œæ¥åˆ†æä¸‹æ€§èƒ½é—®é¢˜ã€‚é€šè¿‡è¿™ä¸ªæ¡ˆä¾‹ï¼Œä½ å°†çœ‹åˆ°å„ç§åŸºç¡€ç¡¬ä»¶è®¾æ–½å±‚é¢çš„æ€§èƒ½é—®é¢˜ï¼Œæ¯”å¦‚ç”±è™šæœºè¶…åˆ†å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ã€CPUè¿è¡Œæ¨¡å¼ä¸‹çš„æ€§èƒ½é—®é¢˜ã€IOé«˜ã€ç¡¬ä»¶èµ„æºè€—å°½ä½†TPSå¾ˆä½çš„é—®é¢˜ç­‰ç­‰ã€‚

å¦‚æœä½ æ˜¯ä»é›¶å¼€å§‹åšä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®ï¼Œé‚£ä¹ˆè¿™äº›é—®é¢˜å¾ˆå¯èƒ½æ˜¯ä½ é¦–å…ˆè¦å»é¢å¯¹çš„ã€‚å¹¶ä¸”ï¼ŒæŠŠå®ƒä»¬è§£å†³å¥½ï¼Œæ˜¯æ€§èƒ½åˆ†æäººå‘˜å¿…å¤‡çš„ä¸€ç§èƒ½åŠ›ã€‚åŒæ—¶ï¼Œä½ è¿˜ä¼šçœ‹åˆ°é’ˆå¯¹ä¸åŒè®¡æ•°å™¨é‡‡é›†çš„æ•°æ®ï¼Œæˆ‘ä»¬çš„åˆ†æé“¾è·¯æ˜¯ä¸åŒçš„ï¼Œè€Œè¿™ä¸ªåˆ†æé“¾è·¯å°±æ˜¯æˆ‘ä¸€ç›´å¼ºè°ƒçš„è¯æ®é“¾ï¼Œå¦‚æœä½ ä¸æ¸…æ¥šå¯ä»¥å†å›é¡¾ä¸€ä¸‹[ç¬¬3è®²](https://time.geekbang.org/column/article/355982)ã€‚

é€šè¿‡è¿™èŠ‚è¯¾ï¼Œæˆ‘å¸Œæœ›ä½ èƒ½æ˜ç™½ï¼Œæœ‰äº›æ€§èƒ½é—®é¢˜å…¶å®å¹¶æ²¡æœ‰é‚£ä¹ˆå•ä¸€ï¼Œè€Œä¸”ä¸ç®¡æ€§èƒ½é—®é¢˜å‡ºåœ¨å“ªé‡Œï¼Œæˆ‘ä»¬éƒ½å¿…é¡»å»å¤„ç†ã€‚

å¥½ï¼Œä¸å•°å—¦äº†ï¼Œä¸‹é¢æˆ‘ä»¬å°±æŠŠæ‰“å¼€é¦–é¡µæ¥å£çš„æ€§èƒ½ç“¶é¢ˆä»”ç»†æ‰’ä¸€æ‰’ã€‚

## çœ‹æ¶æ„å›¾

åœ¨æ¯æ¬¡åˆ†ææ€§èƒ½ç“¶é¢ˆä¹‹å‰ï¼Œæˆ‘éƒ½ä¼šç”»è¿™æ ·ä¸€å¼ å›¾ï¼Œçœ‹çœ‹è¿™ä¸ªæ¥å£ä¼šæ¶‰åŠåˆ°å“ªäº›æœåŠ¡å’ŒæŠ€æœ¯ç»„ä»¶ï¼Œè¿™å¯¹æˆ‘ä»¬åç»­çš„æ€§èƒ½åˆ†æä¼šæœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚

![](https://static001.geekbang.org/resource/image/69/8d/6913fb342aa32fae5b46c6f1ecddc58d.png?wh=845%2A685)

å¦‚æœä½ æœ‰å·¥å…·å¯ä»¥ç›´æ¥å±•ç¤ºï¼Œé‚£å°±æ›´å¥½äº†ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£æˆ‘å»ºè®®ä½ ä¸è¦è‡ªä¿¡åœ°è®¤ä¸ºè‡ªå·±å¯ä»¥è®°ä½ä¸€ä¸ªç®€å•çš„æ¶æ„ã€‚ç›¸ä¿¡æˆ‘ï¼Œå“ªæ€•æ˜¯åœ¨çº¸ä¸Šç®€å•ç”»ä¸€ç”»ï¼Œéƒ½ä¼šå¯¹ä½ åé¢çš„åˆ†ææ€è·¯æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚

å›åˆ°ä¸Šé¢è¿™å¼ å›¾ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°è¿™ä¸ªæ‰“å¼€é¦–é¡µçš„é€»è¾‘æ˜¯ï¼šUser - Gateway(Redis)- Portal - (Redis,MySQL)ã€‚

## é¡ºä¾¿çœ‹ä¸‹ä»£ç é€»è¾‘

åœ¨åšæ‰“å¼€é¦–é¡µçš„åŸºå‡†åœºæ™¯ä¹‹å‰ï¼Œæˆ‘å»ºè®®ä½ å…ˆçœ‹ä¸€çœ¼è¿™ä¸ªæ¥å£çš„ä»£ç å®ç°é€»è¾‘ï¼Œä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ¥å£åœ¨åšå“ªäº›åŠ¨ä½œã€‚æ ¹æ®è¿™äº›åŠ¨ä½œï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æå®ƒä»¬çš„åç»­é“¾è·¯ã€‚

è¿™ä¸ªä»£ç çš„é€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯åˆ—å‡ºé¦–é¡µä¸Šçš„å„ç§ä¿¡æ¯ï¼Œç„¶åè¿”å›ä¸€ä¸ªJSONã€‚

```
public HomeContentResult contentnew() {
        HomeContentResult result = new HomeContentResult();
        if (redisService.get("HomeContent") == null) {
            //é¦–é¡µå¹¿å‘Š
            result.setAdvertiseList(getHomeAdvertiseList());
            //å“ç‰Œæ¨è
            result.setBrandList(homeDao.getRecommendBrandList(0, 6));
            //ç§’æ€ä¿¡æ¯
            result.setHomeFlashPromotion(getHomeFlashPromotion());
            //æ–°å“æ¨è
            result.setNewProductList(homeDao.getNewProductList(0, 4));
            //äººæ°”æ¨è
            result.setHotProductList(homeDao.getHotProductList(0, 4));
            //ä¸“é¢˜æ¨è
            result.setSubjectList(homeDao.getRecommendSubjectList(0, 4));
            redisService.set("HomeContent", result);
        }
        Object homeContent = redisService.get("HomeContent");
        // result = JSON.parseObject(homeContent.toString(), HomeContentResult.class);
        result = JSONUtil.toBean(JSONUtil.toJsonPrettyStr(homeContent), HomeContentResult.class);

        return result;
}
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œé¢ä¸€å…±è°ƒç”¨äº†6ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”è¿™äº›æ–¹æ³•éƒ½æ˜¯ç›´æ¥åˆ°æ•°æ®åº“é‡Œåšäº†æŸ¥è¯¢ï¼Œå¦‚æ­¤è€Œå·²ã€‚

## ç¡®å®šå‹åŠ›æ•°æ®

äº†è§£å®Œä»£ç é€»è¾‘åï¼Œæˆ‘ä»¬ä¸Š10ä¸ªçº¿ç¨‹è¯•è¿è¡Œä¸€ä¸‹ï¼Œçœ‹çœ‹åœ¨ä¸€ä¸ªä¸ªçº¿ç¨‹é€’å¢çš„è¿‡ç¨‹ä¸­ï¼ŒTPSä¼šæœ‰ä»€ä¹ˆæ ·çš„è¶‹åŠ¿ã€‚

è¿è¡Œä¹‹åï¼Œæˆ‘ä»¬å¾—åˆ°è¿™æ ·çš„ç»“æœï¼š

![](https://static001.geekbang.org/resource/image/87/0f/876yya208a923dd9c42fe9538063b10f.png?wh=1830%2A535)

ä»ç»“æœæ¥çœ‹ï¼Œåœ¨ä¸€å¼€å§‹ï¼Œä¸€ä¸ªçº¿ç¨‹ä¼šäº§ç”Ÿ40å·¦å³çš„TPSã€‚è¿™é‡Œæˆ‘ä»¬å°±è¦æ€è€ƒä¸€ä¸‹äº†ï¼š**å¦‚æœæƒ³è¦æ‰§è¡Œä¸€ä¸ªåœºæ™¯ï¼Œå¹¶ä¸”è¿™ä¸ªåœºæ™¯å¯ä»¥å‹å‡ºæ‰“å¼€é¦–é¡µæ¥å£çš„æœ€å¤§TPSï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆè®¾ç½®å‹åŠ›å·¥å…·ä¸­çš„çº¿ç¨‹æ•°ã€é€’å¢ç­–ç•¥å’ŒæŒç»­æ‰§è¡Œç­–ç•¥å‘¢ï¼Ÿ**

å¯¹æ­¤ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹Portalåº”ç”¨èŠ‚ç‚¹æ‰€åœ¨æœºå™¨çš„ç¡¬ä»¶ä½¿ç”¨æƒ…å†µï¼Œäº†è§£ä¸€ä¸‹TPSè¶‹åŠ¿å’Œèµ„æºä½¿ç”¨ç‡ä¹‹é—´çš„å…³ç³»ã€‚è¿™ä¸ªæœºå™¨çš„æƒ…å†µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆæ³¨æ„ï¼Œæˆ‘è·³è¿‡äº†Gatewayæ‰€åœ¨çš„èŠ‚ç‚¹ï¼‰ï¼š

![](https://static001.geekbang.org/resource/image/d9/67/d991a5548f72d6f7bcf0257c40da6b67.png?wh=1828%2A912)

å¯ä»¥çœ‹åˆ°ï¼Œå½“å‰PortalèŠ‚ç‚¹æ‰€åœ¨çš„æœºå™¨æ˜¯8C16Gï¼ˆè™šæ‹Ÿæœºï¼‰ï¼Œå¹¶ä¸”è¿™ä¸ªæœºå™¨åŸºæœ¬ä¸Šæ²¡ä»€ä¹ˆå‹åŠ›ã€‚

ç°åœ¨æˆ‘ä»¬å…ˆä¸è®¡ç®—å…¶ä»–èµ„æºï¼Œåªè€ƒè™‘8C16Gçš„é…ç½®æƒ…å†µã€‚å¦‚æœTPSæ˜¯çº¿æ€§å¢é•¿çš„è¯ï¼Œé‚£ä¹ˆå½“è¯¥æœºå™¨çš„CPUä½¿ç”¨ç‡è¾¾åˆ° 100%çš„æ—¶å€™ï¼ŒTPSå¤§æ¦‚å°±æ˜¯800å·¦å³ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å‹åŠ›å·¥å…·ä¸­çš„çº¿ç¨‹æ•°åº”è¯¥è®¾ç½®ä¸ºï¼š

$$ çº¿ç¨‹æ•° = 800 TPS \\div 40 TPS = 20 ä¸ªçº¿ç¨‹$$

ä¸è¿‡ï¼Œåœ¨å‹åŠ›æŒç»­çš„è¿‡ç¨‹ä¸­ï¼ŒTPSå’Œèµ„æºä½¿ç”¨ç‡ä¹‹é—´çš„ç­‰æ¯”å…³ç³»åº”è¯¥æ˜¯åšä¸åˆ°çš„ã€‚å› ä¸ºåœ¨å‹åŠ›è¿‡ç¨‹ä¸­ï¼Œå„ç§èµ„æºçš„æ¶ˆè€—éƒ½ä¼šå¢åŠ ä¸€äº›å“åº”æ—¶é—´ï¼Œè¿™äº›ä¹Ÿéƒ½å±äºæ­£å¸¸çš„å“åº”æ—¶é—´æŸè€—ã€‚

åœ¨ç¡®å®šäº†å‹åŠ›å·¥å…·çš„çº¿ç¨‹æ•°ä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹é€’å¢ç­–ç•¥æ€ä¹ˆè®¾ç½®ã€‚

æˆ‘å¸Œæœ›é€’å¢æ—¶é—´å¯ä»¥å¢åŠ å¾—æ…¢ä¸€äº›ï¼Œä»¥ä¾¿äºæˆ‘ä»¬æŸ¥çœ‹å„ç¯èŠ‚æ€§èƒ½æ•°æ®çš„ååº”ã€‚æ ¹æ®[ç¬¬2è®²](https://time.geekbang.org/column/article/355019)ä¸­çš„æ€§èƒ½åˆ†æå†³ç­–æ ‘ï¼Œåœ¨è¿™æ ·çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸å°‘è®¡æ•°å™¨éœ€è¦åˆ†ææŸ¥çœ‹ï¼Œæ‰€ä»¥æˆ‘è®¾ç½®ä¸º30ç§’ä¸Šä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´é€’å¢å‘¨æœŸä¸º600ç§’ã€‚

åœ¨ç¡®å®šå¥½å‹åŠ›å‚æ•°åï¼Œæˆ‘ä»¬çš„è¯•è¿è¡Œåœºæ™¯å°±å¯ä»¥åœ¨JMeterä¸­è®¾ç½®ä¸ºå¦‚ä¸‹å€¼ï¼š

```
 <stringProp name="ThreadGroup.num_threads">20</stringProp>
        <stringProp name="ThreadGroup.ramp_time">600</stringProp>
        <boolProp name="ThreadGroup.scheduler">true</boolProp>
        <stringProp name="ThreadGroup.duration">700</stringProp>
```

è®¾ç½®å¥½è¯•è¿è¡Œå‚æ•°åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è¿™æ ·çš„åœºæ™¯ä¸‹è¿›ä¸€æ­¥è®¾ç½®è¶³å¤Ÿçš„çº¿ç¨‹æ¥è¿è¡Œï¼Œä»¥è¾¾åˆ°èµ„æºä½¿ç”¨ç‡çš„æœ€å¤§åŒ–ã€‚

ä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼šéš¾é“ä¸ç”¨æ›´é«˜çš„çº¿ç¨‹äº†å—ï¼Ÿå¦‚æœä½ æƒ³åšä¸€ä¸ªæ­£å¸¸çš„åœºæ™¯ï¼Œé‚£ç¡®å®ä¸éœ€è¦ç”¨æ›´é«˜çš„çº¿ç¨‹äº†ï¼›å¦‚æœä½ å°±æ˜¯æƒ³çŸ¥é“å‹åŠ›çº¿ç¨‹åŠ å¤šäº†æ˜¯ä»€ä¹ˆæ ·å­ï¼Œé‚£ä½ å¯ä»¥è¯•è¯•ã€‚æˆ‘åœ¨æ€§èƒ½åœºæ™¯æ‰§è¡Œæ—¶ï¼Œä¹Ÿç»å¸¸ç”¨å„ç§æ–¹å¼å‹ç€ç©ã€‚

ä¸è¿‡ï¼Œè¯è¯´å›æ¥ï¼Œç¡®å®æœ‰ä¸€ç§æƒ…å†µéœ€è¦æˆ‘ä»¬æ­£å„¿å…«ç»åœ°å¢åŠ æ›´å¤šçš„å‹åŠ›ï¼Œé‚£å°±æ˜¯ä½ çš„å“åº”æ—¶é—´å·²ç»å¢åŠ äº†ï¼Œå¯æ˜¯å¢åŠ å¾—åˆä¸å¤šï¼ŒTPSä¹Ÿä¸å†ä¸Šå‡ã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬æ‹†åˆ†å“åº”æ—¶é—´æ˜¯æ¯”è¾ƒå›°éš¾çš„ï¼Œç‰¹åˆ«æ˜¯å½“ä¸€äº›ç³»ç»Ÿå¾ˆå¿«çš„æ—¶å€™ï¼Œå“åº”æ—¶é—´å¯èƒ½åªæ˜¯å‡ ä¸ªæ¯«ç§’ä¹‹é—´ã€‚æ‰€ä»¥ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å¤šå¢åŠ ä¸€äº›çº¿ç¨‹ï¼Œè®©å“åº”æ—¶é—´æ…¢çš„åœ°æ–¹æ›´æ¸…æ™°åœ°è¡¨ç°å‡ºæ¥ï¼Œè¿™æ ·ä¹Ÿå°±æ›´å®¹æ˜“æ‹†åˆ†æ—¶é—´ã€‚

é€šè¿‡å‹åŠ›åœºæ™¯çš„é€’å¢è®¾ç½®ï¼ˆå‰é¢ç®—çš„æ˜¯åªéœ€è¦20ä¸ªçº¿ç¨‹å³å¯è¾¾åˆ°æœ€å¤§å€¼ï¼Œè€Œè¿™é‡Œï¼Œæˆ‘æŠŠå‹åŠ›çº¿ç¨‹è®¾ç½®ä¸º100å¯åŠ¨åœºæ™¯ï¼Œç›®çš„æ˜¯ä¸ºäº†çœ‹åˆ°é€’å¢åˆ°æ›´å¤§å‹åŠ›æ—¶çš„TPSè¶‹åŠ¿ä»¥åŠå“åº”æ—¶é—´çš„å¢åŠ ï¼Œè¿™æ ·æ›´å®¹æ˜“åšæ—¶é—´çš„æ‹†åˆ†ï¼‰ï¼Œæˆ‘ä»¬çœ‹åˆ°è¿™ä¸ªæ¥å£çš„å“åº”æ—¶é—´ç¡®å®åœ¨æ…¢æ…¢å¢åŠ ï¼Œå¹¶ä¸”éšç€çº¿ç¨‹æ•°çš„å¢åŠ ï¼Œå“åº”æ—¶é—´å¾ˆå¿«å°±ä¸Šå‡åˆ°äº†å‡ ç™¾æ¯«ç§’ã€‚è¿™æ˜¯ä¸€ä¸ªæ˜æ˜¾çš„ç“¶é¢ˆï¼Œæˆ‘ä»¬è‡ªç„¶æ˜¯ä¸èƒ½æ¥å—çš„ã€‚

![](https://static001.geekbang.org/resource/image/b5/b9/b51a9979095ba9bd963e657b96fyy0b9.png?wh=1834%2A474)

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±è¦å¥½å¥½åˆ†æä¸€ä¸‹è¿™ä¸ªå“åº”æ—¶é—´ç©¶ç«Ÿæ¶ˆè€—åˆ°äº†å“ªé‡Œã€‚

## æ‹†åˆ†æ—¶é—´

æˆ‘ä»¬å‰é¢æåˆ°ï¼Œæ‰“å¼€é¦–é¡µçš„é€»è¾‘æ˜¯ï¼šUser - Gateway(Redis)- Portal - (Redis,MySQL)ï¼Œé‚£æˆ‘ä»¬å°±æŒ‰ç…§è¿™ä¸ªé€»è¾‘ï¼Œå€ŸåŠ©é“¾è·¯ç›‘æ§å·¥å…·SkyWalkingæŠŠå“åº”æ—¶é—´å…·ä½“æ‹†åˆ†ä¸€ä¸‹ã€‚

![](https://static001.geekbang.org/resource/image/1d/99/1d3b42340dd5dfdda16bdf1332d34c99.png?wh=1803%2A761)

- **User â€”Gatewayä¹‹é—´çš„æ—¶é—´æ¶ˆè€—**

![](https://static001.geekbang.org/resource/image/bd/b9/bd8117bdc6124d95893b16c7653be7b9.png?wh=266%2A661)

æˆ‘ä»¬çœ‹åˆ°ï¼ŒUser - Gatewayä¹‹é—´çš„æ—¶é—´æ¶ˆè€—æ…¢æ…¢ä¸Šå‡åˆ°äº†150æ¯«ç§’å·¦å³ã€‚

- **Gatewayå“åº”æ—¶é—´**

![](https://static001.geekbang.org/resource/image/73/37/733a7e7f13ea455826aee0bbb2393237.png?wh=268%2A472)

gatewayä¸Šä¹Ÿæ¶ˆè€—äº†150æ¯«ç§’ï¼Œè¿™å°±è¯´æ˜useråˆ°gatewayä¹‹é—´çš„ç½‘ç»œå¹¶æ²¡æœ‰å¤šå°‘æ—¶é—´æ¶ˆè€—ï¼Œåœ¨æ¯«ç§’çº§ã€‚

- **Gateway â€”Portalä¹‹é—´çš„æ—¶é—´æ¶ˆè€—**

![](https://static001.geekbang.org/resource/image/f9/fe/f9ac563b64d7a1c6e923d8222fdfyyfe.png?wh=263%2A666)

åœ¨Portalä¸Šï¼Œå“åº”æ—¶é—´åªæ¶ˆè€—äº†50æ¯«ç§’å·¦å³ã€‚æˆ‘ä»¬å†åˆ°Portalä¸Šçœ‹ä¸€çœ¼ã€‚

- **Portalå“åº”æ—¶é—´**

![](https://static001.geekbang.org/resource/image/72/49/721ae8d7ef027fdc56dd05860cafa849.png?wh=258%2A467)

Portalçš„å“åº”æ—¶é—´æ˜¯50æ¯«ç§’å·¦å³ï¼Œå’Œæˆ‘ä»¬ä¸Šé¢çœ‹åˆ°çš„æ—¶é—´ä¸€è‡´ã€‚

é€šè¿‡ä¸Šè¿°å¯¹å“åº”æ—¶é—´çš„æ‹†åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šæ˜¯Gatewayæ¶ˆè€—äº†å“åº”æ—¶é—´ï¼Œå¹¶ä¸”è¿™ä¸ªæ—¶é—´è¾¾åˆ°äº†è¿‘100æ¯«ç§’ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸‹ä¸€æ­¥å®šä½çš„ç›®æ ‡å°±æ˜¯Gatewayäº†ã€‚

## å®šä½Gatewayä¸Šçš„å“åº”æ—¶é—´æ¶ˆè€—

#### ç¬¬ä¸€é˜¶æ®µï¼šåˆ†æst cpu

æ—¢ç„¶Gatewayä¸Šçš„å“åº”æ—¶é—´æ¶ˆè€—å¾ˆé«˜ï¼Œæˆ‘ä»¬è‡ªç„¶å°±è¦æŸ¥ä¸€ä¸‹è¿™å°ä¸»æœºæŠŠæ—¶é—´æ¶ˆè€—åœ¨äº†å“ªé‡Œã€‚

æˆ‘ä»¬çš„åˆ†æé€»è¾‘ä»ç„¶æ˜¯**å…ˆçœ‹å…¨å±€ç›‘æ§ï¼Œåçœ‹å®šå‘ç›‘æ§**ã€‚å…¨å±€ç›‘æ§è¦ä»æ•´ä¸ªæ¶æ„å¼€å§‹çœ‹èµ·ï¼Œç„¶åå†ç¡®å®šæŸä¸ªèŠ‚ç‚¹ä¸Šçš„èµ„æºæ¶ˆè€—ã€‚æ³¨æ„ï¼Œåœ¨çœ‹å…¨å±€ç›‘æ§æ—¶ï¼Œæˆ‘ä»¬è¦ä»æœ€åŸºç¡€çš„æŸ¥èµ·ï¼Œè€Œåˆ†æçš„è¿‡ç¨‹ä¸­æœ€åŸºç¡€çš„å°±æ˜¯æ“ä½œç³»ç»Ÿäº†ã€‚

é€šè¿‡topå‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°GatewayèŠ‚ç‚¹ä¸Šçš„èµ„æºæƒ…å†µï¼Œå…·ä½“å¦‚ä¸‹ï¼š

![](https://static001.geekbang.org/resource/image/c5/f5/c5af9b566db8bdeb7fc8d6ea448aa2f5.png?wh=1298%2A559)

å…¶ä¸­ï¼Œst cpuè¾¾åˆ°äº†15%å·¦å³ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œst cpuæ˜¯æŒ‡è™šæ‹Ÿæœºè¢«å®¿ä¸»æœºä¸Šçš„å…¶ä»–åº”ç”¨æˆ–è™šæ‹ŸæœºæŠ¢èµ°çš„CPUï¼Œå®ƒçš„å€¼è¿™ä¹ˆé«˜æ˜¾ç„¶æ˜¯ä¸å¤ªæ­£å¸¸çš„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦è¿›ä¸€æ­¥æŸ¥çœ‹st cpuå¼‚å¸¸çš„åŸå› ã€‚

æˆ‘ä»¬ç”¨mpstatå‘½ä»¤å…ˆæ¥çœ‹çœ‹å®¿ä¸»æœºï¼ˆè¿è¡ŒGatewayçš„è™šæ‹Ÿæœºæ‰€åœ¨çš„ç‰©ç†æœºï¼‰ä¸Šçš„èµ„æºè¡¨ç°ï¼š

![](https://static001.geekbang.org/resource/image/f4/90/f40e7c2f2a790b289b6d2332dbc47390.png?wh=1186%2A448)

å¯ä»¥çœ‹åˆ°ï¼ŒCPUè¿˜æœ‰20%æ²¡æœ‰ç”¨å®Œï¼Œè¯´æ˜å®¿ä¸»æœºè¿˜æœ‰ç©ºé—´ã€‚ä¸è¿‡ï¼Œå®¿ä¸»æœºçš„CPUä½¿ç”¨ç‡å·²ç»ä¸å°äº†ï¼Œè€Œæ¶ˆè€—è¿™äº›å®¿ä¸»æœºçš„å°±åªæœ‰è™šæ‹Ÿæœºé‡Œçš„åº”ç”¨ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦æŸ¥ä¸€ä¸‹æ˜¯ä¸æ˜¯æŸä¸ªè™šæ‹Ÿæœºçš„CPUæ¶ˆè€—ç‰¹åˆ«é«˜ã€‚å®¿ä¸»æœºä¸Šçš„KVMåˆ—è¡¨å¦‚ä¸‹ï¼š

```
  [root@dell-server-3 ~]# virsh list --all
 Id    åç§°                         çŠ¶æ€
----------------------------------------------------
 12    vm-jmeter                      running
 13    vm-k8s-worker-8                running
 14    vm-k8s-worker-7                running
 15    vm-k8s-worker-9                running

[root@dell-server-3 ~]#
```

å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªå®¿ä¸»æœºä¸Šè·‘äº†å››ä¸ªè™šæ‹Ÿæœºï¼Œé‚£æˆ‘ä»¬å°±å…·ä½“çœ‹ä¸€ä¸‹è¿™å››ä¸ªè™šæ‹Ÿæœºçš„èµ„æºæ¶ˆè€—æƒ…å†µã€‚

- **vm-jmeter**

```
   top - 23:42:49 up 28 days,  8:14,  6 users,  load average: 0.61, 0.48, 0.38
Tasks: 220 total,   1 running, 218 sleeping,   1 stopped,   0 zombie
%Cpu0  :  6.6 us,  3.5 sy,  0.0 ni, 88.5 id,  0.0 wa,  0.0 hi,  0.0 si,  1.4 st
%Cpu1  :  6.5 us,  1.8 sy,  0.0 ni, 88.2 id,  0.0 wa,  0.0 hi,  0.4 si,  3.2 st
KiB Mem :  3880180 total,   920804 free,  1506128 used,  1453248 buff/cache
KiB Swap:  2097148 total,  1256572 free,   840576 used.  2097412 avail Mem 

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                                                  
 7157 root      20   0 3699292 781204  17584 S  27.8 20.1   1:09.44 java                                                                                                                     
    9 root      20   0       0      0      0 S   0.3  0.0  30:25.77 rcu_sched                                                                                                                
  376 root      20   0       0      0      0 S   0.3  0.0  16:40.44 xfsaild/dm-
```

- **vm-k8s-worker-8**

```
top - 23:43:47 up 5 days, 22:28,  3 users,  load average: 9.21, 6.45, 5.74
Tasks: 326 total,   1 running, 325 sleeping,   0 stopped,   0 zombie
%Cpu0  : 20.2 us,  3.7 sy,  0.0 ni, 60.7 id,  0.0 wa,  0.0 hi,  2.9 si, 12.5 st
%Cpu1  : 27.3 us,  7.4 sy,  0.0 ni, 50.2 id,  0.0 wa,  0.0 hi,  3.7 si, 11.4 st
%Cpu2  : 29.9 us,  5.6 sy,  0.0 ni, 48.5 id,  0.0 wa,  0.0 hi,  4.9 si, 11.2 st
%Cpu3  : 31.2 us,  5.6 sy,  0.0 ni, 47.6 id,  0.0 wa,  0.0 hi,  4.5 si, 11.2 st
%Cpu4  : 25.6 us,  4.3 sy,  0.0 ni, 52.7 id,  0.0 wa,  0.0 hi,  3.6 si, 13.7 st
%Cpu5  : 26.0 us,  5.2 sy,  0.0 ni, 53.5 id,  0.0 wa,  0.0 hi,  4.1 si, 11.2 st
%Cpu6  : 19.9 us,  6.2 sy,  0.0 ni, 57.6 id,  0.0 wa,  0.0 hi,  3.6 si, 12.7 st
%Cpu7  : 27.3 us,  5.0 sy,  0.0 ni, 53.8 id,  0.0 wa,  0.0 hi,  2.3 si, 11.5 st
KiB Mem : 16265688 total,  6772084 free,  4437840 used,  5055764 buff/cache
KiB Swap:        0 total,        0 free,        0 used. 11452900 avail Mem 

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                                                  
13049 root      20   0 9853712 593464  15752 S 288.4  3.6  67:24.22 java                                                                                                                     
 1116 root      20   0 2469728  57932  16188 S  12.6  0.4 818:40.25 containerd                                                                                                               
 1113 root      20   0 3496336 118048  38048 S  12.3  0.7 692:30.79 kubelet                                                                                                                  
 4961 root      20   0 1780136  40700  17864 S  12.3  0.3 205:51.15 calico-node                                                                                                              
 3830 root      20   0 2170204 114920  33304 S  11.6  0.7 508:00.00 scope                                                                                                                    
 1118 root      20   0 1548060 111768  29336 S  11.3  0.7 685:27.95 dockerd                                                                                                                  
 8216 techstar  20   0 2747240 907080 114836 S   5.0  5.6   1643:33 prometheus                                                                                                               
21002 root      20   0 9898708 637616  17316 S   3.3  3.9 718:56.99 java                                                                                                                     
 1070 root      20   0 9806964 476716  15756 S   2.0  2.9 137:13.47 java                                                                                                                     
11492 root      20   0  441996  33204   4236 S   1.3  0.2  38:10.49 gvfs-udisks2-vo  
```

- **vm-k8s-worker-7**

```
top - 23:44:22 up 5 days, 22:26,  3 users,  load average: 2.50, 1.67, 1.13
Tasks: 308 total,   1 running, 307 sleeping,   0 stopped,   0 zombie
%Cpu0  :  4.2 us,  3.5 sy,  0.0 ni, 82.3 id,  0.0 wa,  0.0 hi,  1.7 si,  8.3 st
%Cpu1  :  6.2 us,  2.7 sy,  0.0 ni, 82.8 id,  0.0 wa,  0.0 hi,  1.4 si,  6.9 st
%Cpu2  :  5.2 us,  2.8 sy,  0.0 ni, 84.0 id,  0.0 wa,  0.0 hi,  1.0 si,  6.9 st
%Cpu3  :  4.5 us,  3.8 sy,  0.0 ni, 81.2 id,  0.0 wa,  0.0 hi,  1.4 si,  9.2 st
%Cpu4  :  4.4 us,  2.4 sy,  0.0 ni, 83.3 id,  0.0 wa,  0.0 hi,  1.4 si,  8.5 st
%Cpu5  :  5.5 us,  2.4 sy,  0.0 ni, 84.5 id,  0.0 wa,  0.0 hi,  1.0 si,  6.6 st
%Cpu6  :  3.7 us,  2.7 sy,  0.0 ni, 85.6 id,  0.0 wa,  0.0 hi,  0.7 si,  7.4 st
%Cpu7  :  3.1 us,  1.7 sy,  0.0 ni, 84.7 id,  0.0 wa,  0.0 hi,  1.4 si,  9.0 st
KiB Mem : 16265688 total,  8715820 free,  3848432 used,  3701436 buff/cache
KiB Swap:        0 total,        0 free,        0 used. 12019164 avail Mem 

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                                                  
18592 27        20   0 4588208 271564  12196 S  66.9  1.7 154:58.93 mysqld                                                                                                                   
 1109 root      20   0 2381424 105512  37208 S   9.6  0.6 514:18.00 kubelet                                                                                                                  
 1113 root      20   0 1928952  55556  16024 S   8.9  0.3 567:43.53 containerd                                                                                                               
 1114 root      20   0 1268692 105212  29644 S   8.6  0.6 516:43.38 dockerd                                                                                                                  
 3122 root      20   0 2169692 117212  33416 S   7.0  0.7 408:21.79 scope                                                                                                                    
 4132 root      20   0 1780136  43188  17952 S   6.0  0.3 193:27.58 calico-node                                                                                                              
 3203 nfsnobo+  20   0  116748  19720   5864 S   2.0  0.1  42:43.57 node_exporter                                                                                                            
12089 techstar  20   0 5666480   1.3g  23084 S   1.3  8.5  78:04.61 java                                                                                                                     
 5727 root      20   0  449428  38616   4236 S   1.0  0.2  49:02.98 gvfs-udisks2-vo  
```

- **vm-k8s-worker-9**

```
 top - 23:45:23 up 5 days, 22:21,  4 users,  load average: 12.51, 10.28, 9.19
Tasks: 333 total,   4 running, 329 sleeping,   0 stopped,   0 zombie
%Cpu0  : 20.1 us,  7.5 sy,  0.0 ni, 43.3 id,  0.0 wa,  0.0 hi, 13.4 si, 15.7 st
%Cpu1  : 20.1 us, 11.2 sy,  0.0 ni, 41.4 id,  0.0 wa,  0.0 hi, 11.9 si, 15.3 st
%Cpu2  : 23.8 us, 10.0 sy,  0.0 ni, 35.4 id,  0.0 wa,  0.0 hi, 14.2 si, 16.5 st
%Cpu3  : 15.1 us,  7.7 sy,  0.0 ni, 49.1 id,  0.0 wa,  0.0 hi, 12.2 si, 15.9 st
%Cpu4  : 22.8 us,  6.9 sy,  0.0 ni, 40.5 id,  0.0 wa,  0.0 hi, 14.7 si, 15.1 st
%Cpu5  : 17.5 us,  5.8 sy,  0.0 ni, 50.0 id,  0.0 wa,  0.0 hi, 10.6 si, 16.1 st
%Cpu6  : 22.0 us,  6.6 sy,  0.0 ni, 45.1 id,  0.0 wa,  0.0 hi, 11.0 si, 15.4 st
%Cpu7  : 19.2 us,  8.0 sy,  0.0 ni, 44.9 id,  0.0 wa,  0.0 hi,  9.8 si, 18.1 st
KiB Mem : 16265688 total,  2567932 free,  7138952 used,  6558804 buff/cache
KiB Swap:        0 total,        0 free,        0 used.  8736000 avail Mem 

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                                                  
24122 root      20   0 9890064 612108  16880 S 201.0  3.8   1905:11 java                                                                                                                     
 2794 root      20   0 2307652 161224  33464 S  57.7  1.0   1065:54 scope                                                                                                                    
 1113 root      20   0 2607908  60552  15484 S  13.8  0.4   1008:04 containerd                                                                                                               
 1109 root      20   0 2291748 110768  39140 S  12.8  0.7 722:41.17 kubelet                                                                                                                  
 1114 root      20   0 1285500 108664  30112 S  11.1  0.7 826:56.51 dockerd                                                                                                                  
   29 root      20   0       0      0      0 S   8.9  0.0  32:09.89 ksoftirqd/4                                                                                                              
    6 root      20   0       0      0      0 S   8.2  0.0  41:28.14 ksoftirqd/0                                                                                                              
   24 root      20   0       0      0      0 R   8.2  0.0  41:00.46 ksoftirqd/3                                                                                                              
   39 root      20   0       0      0      0 R   8.2  0.0  41:08.18 ksoftirqd/6                                                                                                              
   19 root      20   0       0      0      0 S   7.9  0.0  39:10.22 ksoftirqd/2                                                                                                              
   14 root      20   0       0      0      0 S   6.2  0.0  40:58.25 ksoftirqd/1    
```

å¾ˆæ˜¾ç„¶ï¼Œworker-9çš„siï¼ˆä¸­æ–­ä½¿ç”¨çš„CPUï¼‰å’Œstï¼ˆè¢«å·èµ°çš„CPUï¼‰éƒ½ä¸ç®—ä½ã€‚é‚£è¿™ç§æƒ…å†µå°±æ¯”è¾ƒå¥‡æ€ªäº†ï¼Œè™šæ‹Ÿæœºæœ¬èº«éƒ½æ²¡æœ‰å¾ˆé«˜çš„CPUä½¿ç”¨ç‡ï¼Œä¸ºä»€ä¹ˆstè¿˜è¿™ä¹ˆé«˜å‘¢ï¼Ÿéš¾é“CPUåªèƒ½ç”¨åˆ°è¿™ç§ç¨‹åº¦ï¼Ÿ

æ¥ï¼Œæˆ‘ä»¬æ¥ç€æŸ¥ä¸‹å»ã€‚

#### ç¬¬äºŒé˜¶æ®µï¼šæŸ¥çœ‹ç‰©ç†æœºCPUè¿è¡Œæ¨¡å¼

åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬è¦æŸ¥ä¸€ä¸‹æœåŠ¡é‡Œæœ‰æ²¡æœ‰é˜»å¡ã€‚å°±åƒå‰é¢æåˆ°çš„ï¼Œæˆ‘ä»¬è¦ä»å…¨å±€ç›‘æ§çš„è§’åº¦ï¼Œæ¥è€ƒè™‘æ‰€æŸ¥çœ‹çš„æ€§èƒ½åˆ†æè®¡æ•°å™¨æ˜¯ä¸æ˜¯å®Œæ•´ï¼Œä»¥å…å‡ºç°åˆ¤æ–­ä¸Šçš„åå·®ã€‚ä¸è¿‡ï¼Œæˆ‘å»æŸ¥çœ‹äº†çº¿ç¨‹æ ˆçš„å…·ä½“å†…å®¹ï¼Œçœ‹åˆ°çº¿ç¨‹æ ˆä¸­å¹¶æ²¡æœ‰Blockedå•¥çš„ï¼Œé‚£æˆ‘ä»¬å°±åªèƒ½å†å›åˆ°ç‰©ç†æœºçš„é…ç½®é‡Œçœ‹äº†ã€‚

é‚£å¯¹äºç‰©ç†æœºCPUï¼Œæˆ‘ä»¬è¿˜æœ‰ä»€ä¹ˆå¯çœ‹çš„å‘¢ï¼Ÿå³ä½¿ä½ ç›–ä¸Šè¢«å­è’™ç€å¤´æƒ³å¾ˆä¹…ï¼Œä»ä¸‹åˆ°ä¸ŠæŠŠæ‰€æœ‰çš„é€»è¾‘éƒ½ç†ä¸€éï¼Œä¹Ÿæ‰¾ä¸å‡ºä»€ä¹ˆåœ°æ–¹ä¼šæœ‰é˜»å¡ã€‚é‚£æˆ‘ä»¬å°±åªæœ‰çœ‹å®¿ä¸»æœºçš„CPUè¿è¡Œæ¨¡å¼äº†ã€‚

```
-- ç‰©ç†æœºå™¨1
[root@hp-server ~]# cpupower frequency-info
analyzing CPU 0:
  driver: pcc-cpufreq
  CPUs which run at the same hardware frequency: 0
  CPUs which need to have their frequency coordinated by software: 0
  maximum transition latency:  Cannot determine or is not supported.
  hardware limits: 1.20 GHz - 2.10 GHz
  available cpufreq governors: conservative userspace powersave ondemand performance
  current policy: frequency should be within 1.20 GHz and 2.10 GHz.
                  The governor "conservative" may decide which speed to use
                  within this range.
  current CPU frequency: 1.55 GHz (asserted by call to hardware)
  boost state support:
    Supported: yes
    Active: yes

-- ç‰©ç†æœºå™¨2
[root@dell-server-2 ~]# cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
powersave
[root@dell-server-2 ~]# cpupower frequency-info
analyzing CPU 0:
  driver: intel_pstate
  CPUs which run at the same hardware frequency: 0
  CPUs which need to have their frequency coordinated by software: 0
  maximum transition latency:  Cannot determine or is not supported.
  hardware limits: 1.20 GHz - 2.20 GHz
  available cpufreq governors: performance powersave
  current policy: frequency should be within 1.20 GHz and 2.20 GHz.
                  The governor "powersave" may decide which speed to use
                  within this range.
  current CPU frequency: 2.20 GHz (asserted by call to hardware)
  boost state support:
    Supported: no
    Active: no
    2200 MHz max turbo 4 active cores
    2200 MHz max turbo 3 active cores
    2200 MHz max turbo 2 active cores
    2200 MHz max turbo 1 active cores

-- ç‰©ç†æœºå™¨3
[root@dell-server-3 ~]# cpupower frequency-info
analyzing CPU 0:
  driver: intel_pstate
  CPUs which run at the same hardware frequency: 0
  CPUs which need to have their frequency coordinated by software: 0
  maximum transition latency:  Cannot determine or is not supported.
  hardware limits: 1.20 GHz - 2.20 GHz
  available cpufreq governors: performance powersave
  current policy: frequency should be within 1.20 GHz and 2.20 GHz.
                  The governor "powersave" may decide which speed to use
                  within this range.
  current CPU frequency: 2.20 GHz (asserted by call to hardware)
  boost state support:
    Supported: no
    Active: no
    2200 MHz max turbo 4 active cores
    2200 MHz max turbo 3 active cores
    2200 MHz max turbo 2 active cores
    2200 MHz max turbo 1 active cores

-- ç‰©ç†æœºå™¨4
[root@lenvo-nfs-server ~]# cpupower frequency-info
analyzing CPU 0:
  driver: acpi-cpufreq
  CPUs which run at the same hardware frequency: 0
  CPUs which need to have their frequency coordinated by software: 0
  maximum transition latency: 10.0 us
  hardware limits: 2.00 GHz - 2.83 GHz
  available frequency steps:  2.83 GHz, 2.00 GHz
  available cpufreq governors: conservative userspace powersave ondemand performance
  current policy: frequency should be within 2.00 GHz and 2.83 GHz.
                  The governor "conservative" may decide which speed to use
                  within this range.
  current CPU frequency: 2.00 GHz (asserted by call to hardware)
  boost state support:
    Supported: no
    Active: no
```

å¯ä»¥çœ‹åˆ°ï¼Œæ²¡æœ‰ä¸€ä¸ªç‰©ç†æœºæ˜¯è¿è¡Œåœ¨performanceæ¨¡å¼ä¹‹ä¸‹çš„ã€‚

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦å¯¹CPUçš„è¿è¡Œæ¨¡å¼æœ‰ä¸€ä¸ªäº†è§£ï¼š

![](https://static001.geekbang.org/resource/image/8c/82/8cd3a3bee80eb77bf348b1a063a90682.jpg?wh=2000%2A1263)

æ—¢ç„¶æˆ‘ä»¬æ˜¯æ€§èƒ½åˆ†æäººå‘˜ï¼Œé‚£è‡ªç„¶è¦ç”¨performanceæ¨¡å¼äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠCPUæ¨¡å¼ä¿®æ”¹å¦‚ä¸‹ï¼š

```
-- ç‰©ç†æœºå™¨1
[root@hp-server ~]# cpupower -c all frequency-set -g performance
Setting cpu: 0
Setting cpu: 1
Setting cpu: 2
Setting cpu: 3
Setting cpu: 4
Setting cpu: 5
Setting cpu: 6
Setting cpu: 7
Setting cpu: 8
Setting cpu: 9
Setting cpu: 10
Setting cpu: 11
Setting cpu: 12
Setting cpu: 13
Setting cpu: 14
Setting cpu: 15
Setting cpu: 16
Setting cpu: 17
Setting cpu: 18
Setting cpu: 19
Setting cpu: 20
Setting cpu: 21
Setting cpu: 22
Setting cpu: 23
Setting cpu: 24
Setting cpu: 25
Setting cpu: 26
Setting cpu: 27
Setting cpu: 28
Setting cpu: 29
Setting cpu: 30
Setting cpu: 31
[root@hp-server ~]# cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
performance
[root@hp-server ~]#

-- ç‰©ç†æœºå™¨2
[root@dell-server-2 ~]# cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
powersave
[root@dell-server-2 ~]# cpupower -c all frequency-set -g performance
Setting cpu: 0
Setting cpu: 1
Setting cpu: 2
Setting cpu: 3
Setting cpu: 4
Setting cpu: 5
Setting cpu: 6
Setting cpu: 7
Setting cpu: 8
Setting cpu: 9
Setting cpu: 10
Setting cpu: 11
Setting cpu: 12
Setting cpu: 13
Setting cpu: 14
Setting cpu: 15
[root@dell-server-2 ~]# cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
performance
[root@dell-server-2 ~]#

-- ç‰©ç†æœºå™¨3
[root@dell-server-3 ~]# cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
powersave
[root@dell-server-3 ~]#  cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
powersave
[root@dell-server-3 ~]# cpupower -c all frequency-set -g performance
Setting cpu: 0
Setting cpu: 1
Setting cpu: 2
Setting cpu: 3
Setting cpu: 4
Setting cpu: 5
Setting cpu: 6
Setting cpu: 7
Setting cpu: 8
Setting cpu: 9
Setting cpu: 10
Setting cpu: 11
Setting cpu: 12
Setting cpu: 13
Setting cpu: 14
Setting cpu: 15
[root@dell-server-3 ~]#  cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
performance
[root@dell-server-3 ~]#

-- ç‰©ç†æœºå™¨4
[root@lenvo-nfs-server ~]# cpupower -c all frequency-set -g performance
Setting cpu: 0
Setting cpu: 1
Setting cpu: 2
Setting cpu: 3
[root@lenvo-nfs-server ~]# cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
performance
[root@lenvo-nfs-server ~]# 
```

åœ¨æˆ‘ä»¬ä¸€é¡¿æ“ä½œçŒ›å¦‚è™ä¹‹åï¼Œæ€§èƒ½ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ

ç»“æœï¼Œæ€§èƒ½å¹¶æ²¡æœ‰å¥½èµ·æ¥â€¦â€¦è¿™é‡Œæˆ‘å°±ä¸æˆªå›¾äº†ï¼Œå› ä¸ºå›¾å’Œä¸€å¼€å§‹çš„é‚£å¼ åœºæ™¯è¿è¡Œå›¾ä¸€æ ·ã€‚

åœ¨è¿™é‡Œæˆ‘ä»¬è¦çŸ¥é“ï¼Œä»¥ä¸Šçš„åˆ†æè¿‡ç¨‹è¯´æ˜ä¸æ­¢æ˜¯è¿™ä¸ªé—®é¢˜ç‚¹ï¼Œè¿˜æœ‰å…¶ä»–èµ„æºä½¿ç”¨æœ‰çŸ­æ¿æˆ‘ä»¬æ²¡æœ‰æ‰¾åˆ°ã€‚æ²¡åŠæ³•ï¼Œæˆ‘ä»¬åªèƒ½æ¥ç€æŸ¥ã€‚

## æ€»ç»“

åœ¨è¿™èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å‹åŠ›å·¥å…·ä¸­çš„æ›²çº¿ï¼Œåˆ¤æ–­äº†ç“¶é¢ˆçš„å­˜åœ¨ã€‚ç„¶åé€šè¿‡SkyWalkingæ‹†åˆ†äº†å“åº”æ—¶é—´ã€‚

åœ¨ç¡®å®šäº†å“åº”æ—¶é—´æ¶ˆè€—ç‚¹ä¹‹åï¼Œæˆ‘ä»¬åˆå¼€å§‹äº†ä¸¤ä¸ªé˜¶æ®µçš„åˆ†æï¼šç¬¬ä¸€ä¸ªé˜¶æ®µçš„è¯æ®é“¾æ˜¯ä»ç°è±¡å¼€å§‹å¾€ä¸‹åˆ†æçš„ï¼Œå› ä¸ºst cpuæ˜¯æŒ‡å®¿ä¸»æœºä¸Šçš„å…¶ä»–åº”ç”¨çš„æ¶ˆè€—å¯¼è‡´äº†æ­¤è™šæ‹Ÿæœºçš„cpuèµ„æºè¢«æ¶ˆè€—ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å»å®¿ä¸»æœºä¸Šå»æŸ¥äº†å…¶ä»–çš„è™šæ‹Ÿæœºã€‚è¿™é‡Œæˆ‘ä»¬è¦æ˜ç¡®CPUèµ„æºåº”è¯¥ç”¨åˆ°ä»€ä¹ˆæ ·çš„ç¨‹åº¦ï¼Œåœ¨å‘ç°äº†èµ„æºä½¿ç”¨ä¸åˆç†ä¹‹åï¼Œå†æ¥ç€åšç¬¬äºŒé˜¶æ®µçš„åˆ¤æ–­ã€‚

åœ¨ç¬¬äºŒé˜¶æ®µä¸­ï¼Œæˆ‘ä»¬åˆ¤æ–­äº†CPUè¿è¡Œæ¨¡å¼ã€‚åœ¨ç‰©ç†æœºä¸­ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå·±ä¸åšä¸»åŠ¨çš„é™åˆ¶ï¼ŒCPUçš„æ¶ˆè€—æ˜¯æ²¡æœ‰é»˜è®¤é™åˆ¶çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰å»æŸ¥çœ‹CPUçš„è¿è¡Œæ¨¡å¼ã€‚

ä½†æ˜¯ï¼Œå³ä¾¿æˆ‘ä»¬åˆ†æå¹¶å°è¯•è§£å†³äº†ä»¥ä¸Šçš„é—®é¢˜ï¼ŒTPSä»ç„¶æ²¡ä»€ä¹ˆå˜åŒ–ã€‚å¯è§ï¼Œåœ¨è®¡æ•°å™¨çš„åˆ†æé€»è¾‘ä¸­ï¼Œè™½ç„¶æˆ‘ä»¬åšäº†ä¼˜åŒ–åŠ¨ä½œï¼Œä½†ç³»ç»Ÿä»ç„¶æœ‰é—®é¢˜ã€‚åªèƒ½è¯´æˆ‘ä»¬å½“å‰çš„ä¼˜åŒ–æ‰‹æ®µï¼Œåªè§£å†³äº†æœ¨æ¡¶ä¸­çš„æœ€çŸ­æ¿ï¼Œä½†æ˜¯å…¶ä»–çŸ­æ¿ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰æ‰¾åˆ°ã€‚

è¯·ä½ æ³¨æ„ï¼Œè¿™å¹¶ä¸æ˜¯è¯´æˆ‘ä»¬è¿™èŠ‚è¯¾çš„åˆ†æä¼˜åŒ–è¿‡ç¨‹æ²¡æœ‰æ„ä¹‰ã€‚è¦çŸ¥é“ï¼Œè¿™äº›é—®é¢˜ä¸è§£å†³ï¼Œä¸‹ä¸€ä¸ªé—®é¢˜ä¹Ÿä¸ä¼šå‡ºç°ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¿™èŠ‚è¯¾çš„åˆ†æä¼˜åŒ–è¿‡ç¨‹ä¹Ÿéå¸¸æœ‰ä»·å€¼ã€‚

ä¸‹èŠ‚è¯¾ï¼Œæˆ‘ä»¬æ¥ç€æ¥æ‰¾æ‰“å¼€é¦–é¡µæ¥å£çš„æ€§èƒ½ç“¶é¢ˆã€‚

## è¯¾åä½œä¸š

æœ€åï¼Œè¯·ä½ æ€è€ƒä¸€ä¸‹ï¼š

1. ä¸ºä»€ä¹ˆæˆ‘ä»¬çœ‹åˆ°è™šæ‹Ÿæœºä¸­st cpué«˜ï¼Œå°±è¦å»æŸ¥çœ‹å®¿ä¸»æœºä¸Šçš„å…¶ä»–è™šæ‹Ÿæœºï¼Ÿå¦‚æœåœ¨å®¿ä¸»æœºä¸Šçœ‹åˆ°st cpué«˜ï¼Œæˆ‘ä»¬åº”è¯¥åšæ€æ ·çš„åˆ¤æ–­ï¼Ÿ
2. CPUçš„è¿è¡Œæ¨¡å¼åœ¨powersaveæ—¶ï¼ŒCPUçš„è¿è¡Œé€»è¾‘æ˜¯ä»€ä¹ˆï¼Ÿ

è®°å¾—åœ¨ç•™è¨€åŒºå’Œæˆ‘è®¨è®ºã€äº¤æµä½ çš„æƒ³æ³•ï¼Œæ¯ä¸€æ¬¡æ€è€ƒéƒ½ä¼šè®©ä½ æ›´è¿›ä¸€æ­¥ã€‚

å¦‚æœè¿™èŠ‚è¯¾è®©ä½ æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿ä½ åˆ†äº«ç»™ä½ çš„æœ‹å‹ï¼Œå…±åŒå­¦ä¹ è¿›æ­¥ã€‚æˆ‘ä»¬ä¸‹ä¸€è®²å†è§ï¼
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ13ï¼‰</strong></div><ul>
<li><span>Geek_bbe4c8</span> ğŸ‘ï¼ˆ7ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>â€œåªè€ƒè™‘ 8C16G çš„é…ç½®æƒ…å†µã€‚å¦‚æœ TPS æ˜¯çº¿æ€§å¢é•¿çš„è¯ï¼Œé‚£ä¹ˆå½“è¯¥æœºå™¨çš„ CPU ä½¿ç”¨ç‡è¾¾åˆ° 100% çš„æ—¶å€™ï¼ŒTPS å¤§æ¦‚å°±æ˜¯ 800 å·¦å³ã€‚â€
è€å¸ˆï¼Œè¿™é‡Œçš„TPS 800æ˜¯æ€ä¹ˆå¾—åˆ°çš„ï¼Ÿæ²¡å¤ªæ‡‚</p>2021-04-14</li><br/><li><span>sierlu</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>1.å¦‚æœè™šæ‹Ÿæœºçš„sté«˜ï¼Œå¯èƒ½æ€€ç–‘æ˜¯è¯¥å®¿ä¸»æœºçš„å…¶ä»–è™šæ‹Ÿæœºåœ¨ç«äº‰cpuèµ„æºï¼Œé‚£ä¹ˆå…¶ä»–è™šæ‹Ÿæœºåº”è¯¥ä¹Ÿä¼šå‡ºç°sté«˜çš„æƒ…å†µï¼Œå¯èƒ½æ˜¯cpuèµ„æºè¶…åˆ†é…ï¼Œå¦‚æœç‰©ç†æœºç¡®å®sté«˜ï¼Œä¸”è™šæ‹Ÿæœºçš„åº”ç”¨ä¹Ÿéœ€è¦ç”¨è¿™ä¹ˆå¤šï¼Œåˆ™éœ€è¦å¯¹ç‰©ç†æœºè¿›è¡Œæ‰©å®¹ï¼Œæˆ–è€…å°†å®¿ä¸»æœºä¸Šçš„è™šæ‹Ÿæœºå™¨è¿ç§»åˆ°å…¶å®ƒå®¿ä¸»æœº
2.powersaveæ¨¡å¼åº”è¯¥æ˜¯ä¸€ä¸ªæœ€ä½é¢‘ç‡ä½¿ç”¨æ¨¡å¼ï¼Œé™ä½cpuçš„ç”¨ç”µé‡ï¼Œæ¸©åº¦ã€‚
å¦å¤–é«˜è€å¸ˆï¼Œåæ¥è°ƒèŠ‚è¿™ä¸ªå·¥ä½œæ¨¡å¼åï¼Œè™½ç„¶å‹æµ‹ä¸šåŠ¡æŒ‡æ ‡æ²¡æœ‰å˜åŒ–ä½†æ˜¯å»ºè®®åº”è¯¥å†è´´ä¸€ä¸‹è™šæ‹Ÿæœºçš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œè¿™ä¸ªå·¥ä½œæ¨¡å¼çš„æ›´æ”¹æ˜¯å¦ç¡®å®è§£å†³äº†é™ä½äº†siï¼Œstï¼Ÿ</p>2021-06-15</li><br/><li><span>æ‚¦éœ–</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>é«˜è€å¸ˆï¼Œsté«˜ï¼Œçœ‹äº†å®¿ä¸»æœºcpuä½¿ç”¨ç‡è¿˜æœ‰ç©ºé—²ï¼Œä¸ºå•¥å°±ç›´æ¥å»çœ‹æ˜¯å¦æœ‰é˜»å¡ï¼Œä»¥åŠæ²¡é˜»å¡åcpuè¿è¡Œæ¨¡å¼ï¼Œè¿™ä¸ªè¯æ®é“¾æ„Ÿè§‰ä¸è¿ç»­å•Šï¼Ÿ</p>2021-07-29</li><br/><li><span>æ¶µæ¶µ</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>Portal èŠ‚ç‚¹æ‰€åœ¨çš„æœºå™¨æ˜¯ 8C16Gï¼ˆè™šæ‹Ÿæœºï¼‰ï¼Œé€šè¿‡Portalè®¡ç®—TPS 800ï¼Œå¦‚æœgatewayè™šæ‹Ÿæœºåªæœ‰2C4Gæ€ä¹ˆåŠï¼Ÿ</p>2021-08-12</li><br/><li><span>å¼ é±¼</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>å…¨å±€ç›‘æ§ã€å®šå‘ç›‘æ§ï¼Œè¿™ä¸ªç›‘æ§çš„æ—¶æœºæ˜¯æ€ä¹ˆæŠŠæ¡çš„ï¼Ÿæ˜¯è·‘è„šæœ¬ä¹‹å‰ï¼Œå°†ä¸¤è€…éƒ½ç›‘æ§èµ·æ¥ã€‚å‘ç°æ€§èƒ½é—®é¢˜ï¼Œå…ˆçœ‹å…¨å±€ç›‘æ§ï¼Œå†å»çœ‹å®šå‘ç›‘æ§ï¼Ÿ</p>2021-04-15</li><br/><li><span>start</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆä½ ä¸Šé¢çš„æ¶æ„å›¾ç”¨ä»€ä¹ˆå·¥å…·ç”»çš„ï¼Ÿ</p>2021-04-15</li><br/><li><span>Geek_b1b237</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è¿™ä¸ªç”µå•†é¡¹ç›®å¦‚ä½•æ­å»ºï¼Œæœ‰æ–‡æ¡£å—</p>2023-06-07</li><br/><li><span>Geek_b1b237</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>å¦‚ä½•æ­å»ºé¡¹ç›®ä¸­æ‰€è®²çš„ç¯å¢ƒ
</p>2023-06-07</li><br/><li><span>Olivia</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆæ‚¨è¯´çš„åšæ€§èƒ½è¦æ‰“å¼€performanceæ¨¡å¼ï¼ŒæŒ‡çš„æ˜¯æ€§èƒ½æµ‹è¯•æ—¶æ‰“å¼€ï¼Œè¿˜æ˜¯æ€§èƒ½è°ƒä¼˜éƒ½è¦æ‰“å¼€ï¼Œå¦‚æœæ˜¯åè€…ï¼Œé‚£æ„å‘³ç€ç”Ÿäº§ä¸Šéƒ½è¦æ‰“å¼€performance æ¨¡å¼ï¼Ÿ</p>2022-10-07</li><br/><li><span>Geek_0ddc27</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>é€šè¿‡ä¸Šè¿°å¯¹å“åº”æ—¶é—´çš„æ‹†åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šæ˜¯ Gateway æ¶ˆè€—äº†å“åº”æ—¶é—´ï¼Œå¹¶ä¸”è¿™ä¸ªæ—¶é—´è¾¾åˆ°äº†è¿‘ 100 æ¯«ç§’ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸‹ä¸€æ­¥å®šä½çš„ç›®æ ‡å°±æ˜¯ Gateway äº†ã€‚é«˜è€å¸ˆï¼Œgatewayä¸æ˜¯æ¶ˆè€—äº†150å—ï¼Œæ€ä¹ˆåé¢åˆè¯´100äº†å‘¢</p>2022-07-02</li><br/><li><span>*å›çœ¸*Â·wdlcoke</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆï¼š
       windowsæœåŠ¡æ€ä¹ˆæŸ¥çœ‹è™šæ‹Ÿæœºè¢«å®¿ä¸»æœºä¸Šçš„å…¶ä»–åº”ç”¨æˆ–è™šæ‹ŸæœºæŠ¢èµ°çš„ CPUï¼Œæœ‰æ²¡æœ‰windowsæœåŠ¡å™¨ç›‘æ§å·¥å…·çš„å¥—è£…ï¼Ÿ</p>2021-12-21</li><br/><li><span>å°å­”ä¸ç›¸</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>æ¶æ„æ‹“æ‰‘å›¾æ˜¯ç”¨ä»€ä¹ˆç”»çš„å‘€</p>2021-05-18</li><br/><li><span>å°é¾™</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆï¼Œ TPS å‘ˆç°å‘¨æœŸæ€§æŠ–åŠ¨è¯¥æ€ä¹ˆå»åˆ†æï¼Ÿ </p>2021-04-15</li><br/>
</ul>