ä½ å¥½ï¼Œæˆ‘æ˜¯ä½•è¾‰ã€‚ä»Šå¤©æˆ‘ä»¬æ¢ç´¢Dubboæ¡†æ¶çš„ç¬¬å…­é“ç‰¹è‰²é£å‘³ï¼Œå‚æ•°éªŒè¯ã€‚

è¯´åˆ°å‚æ•°æ ¡éªŒï¼Œç›¸ä¿¡ä½ ä¸€å®šæ˜¯åˆçˆ±åˆæ¨ã€‚åœ¨å‘é€æˆ–æ¥æ”¶è¯·æ±‚çš„æ—¶å€™ï¼Œå¿…è¦çš„å‚æ•°æ ¡éªŒå¯ä»¥æ‹¦æˆªéæ³•è¯·æ±‚ï¼Œæå‡è¯·æ±‚è´¨é‡ï¼Œè¿™æ ·ä¸€ä¸ªç®€å•çš„æ•°å€¼æ¯”å¯¹é€»è¾‘çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä½†å†™çš„è¿‡ç¨‹å´å¾ˆæ¯ç‡¥å’Œä¹å‘³ï¼Œä¸€ä¸ç•™ç¥å°±ä¼šå¯¼è‡´ä¸€äº›å¿…è¦æ€§æ ¡éªŒæ²¡è€ƒè™‘åˆ°ã€‚

ç°åœ¨ä½ çš„åŒäº‹å°é©¬å°±å› ä¸ºæ¼å†™äº†å‚æ•°æ ¡éªŒè¢«è€å¤§è®­è¯äº†ï¼Œæ¥çœ‹ä»–å†™çš„ä¸€æ®µæ¶ˆè´¹æ–¹è°ƒç”¨æä¾›æ–¹çš„ä»£ç ï¼š

```java
///////////////////////////////////////////////////
// æ¶ˆè´¹æ–¹çš„ä¸€æ®µè°ƒç”¨ä¸‹æ¸¸ validateUser çš„ä»£ç 
///////////////////////////////////////////////////
@Component
public class InvokeDemoFacade {
    @DubboReference
    private ValidationFacade validationFacade;
    
    // ä¸€ä¸ªç®€å•çš„è§¦å‘è°ƒç”¨ä¸‹æ¸¸ ValidationFacade.validateUser çš„æ–¹æ³•
    public String invokeValidate(String id, String name, String 
        // è°ƒç”¨ä¸‹æ¸¸æ¥å£
        return validationFacade.validateUser(new ValidateUserInfo(id, name, sex));
    }
}

///////////////////////////////////////////////////
// æä¾›æ–¹çš„ä¸€æ®µæ¥æ”¶ validateUser è¯·æ±‚çš„ä»£ç 
///////////////////////////////////////////////////
@DubboService
@Component
public class ValidationFacadeImpl implements ValidationFacade {
    @Override
    public String validateUser(ValidateUserInfo userInfo) {
        // è¿™é‡Œå°±è±¡å¾æ€§åœ°æ¨¡æ‹Ÿä¸€ä¸‹ä¸šåŠ¡é€»è¾‘
        String retMsg = "Ret: "
                + userInfo.getId()
                + "," + userInfo.getName()
                + "," + userInfo.getSex();
        System.out.println(retMsg);
        return retMsg;
    }
}
```

è€å¤§çœ‹å®Œè¿™æ®µä»£ç åï¼ŒæŠŠå°é©¬å«äº†è¿‡æ¥ã€‚

> è€å¤§ï¼šå°é©¬ï¼Œä½ è¿‡æ¥ä¸€ä¸‹ã€‚  
> å°é©¬ï¼šå¥½çš„ï¼Œè€å¤§ã€‚  
> è€å¤§ï¼šæˆ‘åˆšåˆšåœ¨CRä½ çš„ä»£ç ï¼Œå‘ç°ä½ å†™çš„è¿™ä¸ª validateUser æ–¹æ³•ï¼Œä½ å…ˆçœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆä¸å¦¥çš„ï¼Ÿ  
> å°é©¬ï¼šè¿™ä¸å°±æ˜¯ä¸ªæ ¡éªŒç”¨æˆ·çš„æ–¹æ³•ä¹ˆï¼Œæ¥æ”¶è¯·æ±‚ç„¶åç›´æ¥è°ƒç”¨ä¸‹æ¸¸ï¼Œé¢ï½æˆ‘æ²¡æœ‰çœ‹å‡ºå•¥ä¸å¦¥çš„ï½  
> è€å¤§ï¼šä½ å†æƒ³æƒ³ï¼Œå¦‚æœæˆ‘éšæ„ä¼ å…¥ä¸€äº›ç©ºå€¼ç»™ä¸‹æ¸¸ä¼šæ€ä¹ˆæ ·ï¼Ÿ  
> å°é©¬ï¼šé¢ï½å¯èƒ½ä¼šå‡ºç°ç©ºæŒ‡é’ˆæˆ–è€…å…¶ä»–æ„å¤–çš„å¼‚å¸¸ï¼Œæ€»ä¹‹ä¼šå¯¼è‡´ä¸€äº›ä¸å¿…è¦çš„æŠ¥é”™ã€‚  
> è€å¤§ï¼šä½ éƒ½çŸ¥é“ä¼šå‡ºç°ä¸å¿…è¦çš„å¼‚å¸¸å‘ç”Ÿï¼Œæ˜¯ä¸æ˜¯è¯¥åšç‚¹ä»€ä¹ˆå‘¢ï¼Ÿæ˜æ˜èƒ½é¢„è§çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰å¥½å¥½å¤„ç†ï¼Ÿä¸€å®šè¦ç­‰åˆ°æµ‹è¯•æµ‹å‡ºé—®é¢˜ï¼Œæˆ–è€…ç”¨æˆ·ä¸ŠæŠ¥ç³»ç»Ÿå¼‚å¸¸åï¼Œå†ç«æ€¥ç«ç‡åœ°ä¿®æ”¹çº¿ä¸Šç´§æ€¥bugä¹ˆï¼Ÿ  
> å°é©¬ï¼šè€å¤§ï¼Œæˆ‘çŸ¥é“é”™äº†ï¼Œæˆ‘è¿™å°±å›å»è®¤çœŸæ”¹ä¸‹ã€‚  
> è€å¤§ï¼šè¿˜æœ‰ï¼Œæä¾›æ–¹è¿™è¾¹ä»£ç ä¹Ÿæ˜¯ä¸€æ ·ï¼Œæ˜æ˜¾é¢„è§å¯èƒ½æœ‰å‚æ•°ä¸åˆæ³•æƒ…å†µï¼Œä¸ºä»€ä¹ˆä¸å‰ç½®æ ¡éªŒä¸€ä¸‹å‚æ•°çš„åˆæ³•æ€§å‘¢ï¼Ÿä½ å†™çš„å¦å¤–å‡ ä¸ªæ–¹æ³•ä¹Ÿæœ‰ç±»ä¼¼çš„é—®é¢˜ã€‚ä½ å›å»æŠŠè¿™ä¸ªæ ¡éªŒå‚æ•°çš„é€»è¾‘å¥½å¥½æ”¹æ”¹ï¼Œè¿™ç§ä½çº§é—®é¢˜å¸Œæœ›åˆ«æœ‰ä¸‹æ¬¡äº†ã€‚  
> å°é©¬ï¼šå—¯ï¼Œæˆ‘è¿™å°±å»æ”¹ã€‚

çœ‹å®Œè¿™æ®µå¯¹è¯ï¼Œä¸çŸ¥é“æœ‰æ²¡æœ‰è®©ä½ å›æƒ³èµ·å½“å¹´è¢«è®­æ–¥çš„åœºæ™¯ï¼Œé¢å¯¹è¿™æ ·çš„ä¸€ä¸ªå‚æ•°éªŒè¯åˆæ³•æ€§æƒ…å†µï¼Œä½ ä¼šæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ

## ä¸‰ç§éªŒè¯æ–¹æ¡ˆ

æƒ³è¦çŸ¥é“å¦‚ä½•å¤„ç†ï¼Œæˆ‘ä»¬å…ˆæ¥æ¢³ç†ä¸‹è€å¤§æŒ‡å‡ºçš„å‡ ä¸ªé—®é¢˜ï¼š

- é—®é¢˜1ï¼šæ¶ˆè´¹æ–¹ä»£ç ï¼Œåœ¨è°ƒç”¨ä¸‹æ¸¸çš„ validateUser æ–¹æ³•æ—¶ï¼Œæ²¡æœ‰é¢„å…ˆåšä¸€äº›å‚æ•°çš„åˆæ³•æ€§æ ¡éªŒã€‚
- é—®é¢˜2ï¼šæä¾›æ–¹ä»£ç ï¼ŒæœåŠ¡æ–¹ä»£ç åœ¨æ¥æ”¶è¯·æ±‚çš„æ—¶å€™ï¼Œæ²¡æœ‰å¯¹ä¸€äº›å¿…è¦çš„å­—æ®µè¿›è¡Œåˆæ³•æ€§æ ¡éªŒã€‚
- é—®é¢˜3ï¼šä¸ä»…ä»…æ˜¯ validateUser æ–¹æ³•ï¼Œå…¶ä»–å‡ ä¸ªæ–¹æ³•ä¹Ÿæ²¡æœ‰å¯¹å‚æ•°è¿›è¡Œåˆæ³•æ€§æ ¡éªŒã€‚

é—®é¢˜éƒ½å·²ç»ç½—åˆ—å‡ºæ¥äº†ï¼Œå¦‚ä½•ä¿®æ”¹å‘¢ï¼Ÿ

### 1.ç®€å•éªŒè¯

æœ€ç›´æ¥çš„æ€è·¯å°±æ˜¯ï¼Œå“ªé‡Œæœ‰é”…è¡¥å“ªé‡Œã€‚è¿™ä¸‰ä¸ªé—®é¢˜ä¸å°±æ˜¯è¦å¯¹å‡ ä¸ªæ–¹æ³•çš„å‚æ•°è¿›è¡Œåˆæ³•æ€§æ ¡éªŒå˜›ï¼Œé‚£å°±ç®€å•ç‚¹ï¼Œå“ªé‡Œç”¨åˆ°äº†ï¼Œæˆ‘ä»¬å°±åœ¨å“ªé‡Œæå‰é¢„åˆ¤ä¸€ä¸‹ï¼Œä¿è¯ä¸è®©æœ‰é—®é¢˜çš„å‚æ•°æ±¡æŸ“æ­£å¸¸çš„ä¸šåŠ¡é€»è¾‘å°±è¡Œã€‚

äºæ˜¯æˆ‘ä»¬å†™å‡ºäº†è¿™æ ·çš„ä»£ç ï¼š

```java
///////////////////////////////////////////////////
// ç®€å•éªŒè¯ï¼šæ¶ˆè´¹æ–¹çš„ä¸€æ®µè°ƒç”¨ä¸‹æ¸¸ validateUser çš„ä»£ç 
///////////////////////////////////////////////////
@Component
public class InvokeDemoFacade {
    @DubboReference
    private ValidationFacade validationFacade;
    
    // ä¸€ä¸ªç®€å•çš„è§¦å‘è°ƒç”¨ä¸‹æ¸¸ ValidationFacade.validateUser çš„æ–¹æ³•
    public String invokeValidate(String id, String name, String sex) {
        // æ ¡éªŒ id å±æ€§å¿…å¡«
        if (StringUtils.isBlank(id)) {
            throw new RuntimeException("id ä¸èƒ½ä¸ºç©º");
        }
        // æ ¡éªŒ name å±æ€§çš„é•¿åº¦å¿…é¡»åœ¨ 5~10 ä¹‹é—´
        if (StringUtils.isNotBlank(name) && (name.length() < 5 || name.length() > 10)) {
            throw new RuntimeException("name å¿…é¡»åœ¨ 5~10 ä¸ªé•¿åº¦ä¹‹é—´");
        }
        // ç„¶åå†è°ƒç”¨ä¸‹æ¸¸æ¥å£
        return validationFacade.validateUser(new ValidateUserInfo(id, name, sex));
    }
}

///////////////////////////////////////////////////
// ç®€å•éªŒè¯ï¼šæä¾›æ–¹çš„ä¸€æ®µæ¥æ”¶ validateUser è¯·æ±‚çš„ä»£ç 
///////////////////////////////////////////////////
@DubboService
@Component
public class ValidationFacadeImpl implements ValidationFacade {
    @Override
    public String validateUser(ValidateUserInfo userInfo) {
        // æ ¡éªŒ id å±æ€§å¿…å¡«
        if (StringUtils.isBlank(userInfo.getId())) {
            throw new RuntimeException("[provider] id ä¸èƒ½ä¸ºç©º");
        }
        // æ ¡éªŒ name å±æ€§çš„é•¿åº¦å¿…é¡»åœ¨ 5~10 ä¹‹é—´
        String name = userInfo.getName();
        if (StringUtils.isNotBlank(name) && (name.length() < 5 || name.length() > 10)) {
            throw new RuntimeException("[provider] name å¿…é¡»åœ¨ 5~10 ä¸ªé•¿åº¦ä¹‹é—´");
        }
        
        // è¿™é‡Œå°±è±¡å¾æ€§çš„æ¨¡æ‹Ÿä¸‹ä¸šåŠ¡é€»è¾‘
        String retMsg = "Ret: "
                + userInfo.getId()
                + "," + userInfo.getName()
                + "," + userInfo.getSex();
        System.out.println(retMsg);
        return retMsg;
    }
}
```

ä»£ç ä¸­çš„æ”¹å˜ä¹Ÿæ¯”è¾ƒç®€å•ç›´æ¥ï¼Œä¸»è¦æœ‰ 2 ç‚¹ï¼š

- æ¶ˆè´¹æ–¹ä»£ç ï¼Œåœ¨çœŸæ­£å‘èµ· validationFacade.validateUser æ–¹æ³•è°ƒç”¨ä¹‹å‰ï¼Œå…ˆåˆ¤æ–­äº† id å€¼ä¸èƒ½ä¸ºç©ºï¼Œç„¶ååˆ¤æ–­äº† name å€¼çš„é•¿åº¦å¿…é¡»åœ¨ 5~10 ä¹‹é—´ã€‚
- æä¾›æ–¹ä»£ç ï¼ŒåŒæ ·æ˜¯åœ¨å¤„ç†æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä¹‹å‰ï¼Œé’ˆå¯¹ idã€name è¿›è¡Œåˆæ³•æ€§åˆ¤æ–­ï¼Œè‹¥ä¸åˆæ³•å°±ä»¥å¼‚å¸¸çš„æ–¹å¼å‘Šè¯‰è°ƒç”¨æ–¹ã€‚

è½»è½»æ¾æ¾æ”¹å®Œä¸€ä¸ª validateUser æ–¹æ³•çš„ä»£ç ï¼Œè¿™ä¸‹åº”è¯¥æ²¡å•¥å¤§é—®é¢˜äº†å§ã€‚

å†çœ‹è€å¤§æŒ‡å‡ºçš„å¦å¤–å‡ ä¸ªæ–¹æ³•ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿç”¨åŒæ ·çš„æ€è·¯ä¾è‘«èŠ¦ç”»ç“¢å¤„ç†ä¸‹ï¼Œåœ¨æ¶ˆè´¹æ–¹è°ƒç”¨ä¸‹æ¸¸ä¹‹å‰æ£€æŸ¥ä¸€ä¸‹å‚æ•°çš„åˆæ³•æ€§ï¼Œæä¾›æ–¹çš„ä»£ç ä¹Ÿå†æ¬¡å¯¹å…¥å‚è¿›è¡ŒéªŒè¯ä¸€ä¸‹ï¼Ÿ

å°‘æ•°å‡ ä¸ªè¿˜èƒ½è¿™ä¹ˆåšï¼Œä½†ä½ ä¹Ÿæƒ³åˆ°äº†ï¼Œä»¥åè¿˜æœ‰åä¸ªã€ç™¾ä¸ªæ–¹æ³•ä¹Ÿè¦æŒ‰ç…§è¿™æ ·çš„æ–¹å¼å¤„ç†ï¼Œå¤´å°±å¤§ï¼Œå¥½åƒä¸èƒ½è¿™ä¹ˆå¹²äº†ï¼Œåº”è¯¥è¦æ‰¾ä¸ªçœäº‹ç‚¹çš„ã€ä»£ç å°‘çš„æ–¹å¼æ¥å¤„ç†ã€‚

å¯è¯¥å¦‚ä½•æ›´çœäº‹ç‚¹å‘¢ï¼Ÿ

### 2.é€šçŸ¥éªŒè¯

æƒ³çœäº‹ï¼Œæˆ‘ä»¬å°±ä¸èƒ½åœ¨ä»£ç çš„å„ä¸ªè§’è½å†™å„ç§æ ¡éªŒçš„é€»è¾‘äº†ï¼Œå¾—æ‰¾ä¸ªæ¯”è¾ƒé›†ä¸­çš„åœ°æ–¹æ¥å†™è¿™æ®µæ ¡éªŒé€»è¾‘ï¼Œå¹¶ä¸”è¿™ä¸ªåœ°æ–¹è¿˜å¿…é¡»å‘ç”Ÿåœ¨çœŸå®è°ƒç”¨ä¹‹å‰ã€‚

å›å¿†ä¸Šä¸€è®²å­¦è¿‡çš„â€œäº‹ä»¶é€šçŸ¥â€ï¼Œä½ æœ‰æ²¡æœ‰çµå…‰ä¸€é—ªï¼Œäº‹ä»¶é€šçŸ¥æ­£å¥½å¯ä»¥åœ¨è°ƒç”¨ä¹‹å‰ã€ä¹‹åã€å¼‚å¸¸æ—¶è§¦å‘ç”¨æˆ·è‡ªå®šä¹‰çš„é€šçŸ¥å¤„ç†ç±»ï¼Œè€Œæˆ‘ä»¬å¯¹å‚æ•°æ ¡éªŒçš„è¦æ±‚ï¼Œå°±æ˜¯éœ€è¦åœ¨è°ƒç”¨ä¹‹å‰æ‹¦æˆªä¸€ä¸‹ã€‚

è²Œä¼¼å¯ä»¥å®ç°ï¼Œæ ¹æ®è¿™ä¸ªæ€è·¯ï¼Œæˆ‘ä»¬ç¨å¾®è°ƒæ•´ä¸€ä¸‹äº‹ä»¶é€šçŸ¥çš„é“¾è·¯ï¼š

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/e7/e6/e7365269d318db194f896f8a07304ae6.jpg?wh=1920x858)

æ ¡éªŒç”¨æˆ·åŠŸèƒ½ï¼Œåœ¨è°ƒç”¨ä¸‹æ¸¸çš„ validateUser ç”¨æˆ·ä¹‹å‰æ‹¦æˆªä¸€ä¸‹ï¼Œç„¶åæŒ‰ç…§äº‹ä»¶é€šçŸ¥çš„çº¦æŸè§„èŒƒï¼Œå†™ä¸€ä¸ªæ ¡éªŒç”¨æˆ·çš„äº‹ä»¶é€šçŸ¥ç±»ï¼Œå°±å¯ä»¥æ¯”è¾ƒè½»æ¾åœ°è§£å†³é—®é¢˜äº†ã€‚å…´å¥‹çš„ä½ ç«‹é©¬å†™å‡ºäº†æ¶ˆè´¹æ–¹çš„ä»£ç æ”¹é€ ï¼š

```java
///////////////////////////////////////////////////
// é€šçŸ¥éªŒè¯ï¼šæ¶ˆè´¹æ–¹çš„ä¸€æ®µè°ƒç”¨ä¸‹æ¸¸ validateUser çš„ä»£ç 
///////////////////////////////////////////////////
@Component
public class InvokeDemoFacade {
     @DubboReference(
            /** æ¥å£è°ƒç ”è¶…æ—¶æ—¶é—´ï¼Œ1æ¯«ç§’ **/
            timeout = 5000,
            /** å¯åŠ¨æ—¶ä¸æ£€æŸ¥ DemoFacade æ˜¯å¦èƒ½æ­£å¸¸æä¾›æœåŠ¡ **/
            check = false,
            /** ä¸º ValidationFacade çš„ validateUser æ–¹æ³•è®¾ç½®äº‹ä»¶é€šçŸ¥æœºåˆ¶ **/
            methods = {@Method(
                        name = "validateUser",
                        oninvoke = "eventValidateUserService.onInvoke",
                        onreturn = "eventValidateUserService.onReturn",
                        onthrow = "eventValidateUserService.onThrow")}
    )
    private ValidationFacade validationFacade;
    // ä¸€ä¸ªç®€å•çš„è§¦å‘è°ƒç”¨ä¸‹æ¸¸ ValidationFacade.validateUser çš„æ–¹æ³•
    public String invokeValidate(String id, String name, String sex) {
        return validationFacade.validateUser(new ValidateUserInfo(id, name, sex));
    }
}

///////////////////////////////////////////////////
// ä¸“é—¨ä¸ºè°ƒç”¨ä¸‹æ¸¸ validateUser æ–¹æ³•æ—¶å®šåˆ¶çš„ä¸€å¥—äº‹ä»¶é€šçŸ¥ç±»
///////////////////////////////////////////////////
@Component("eventValidateUserService")
public class EventValidateUserServiceImpl implements EventValidateUserService {
    // è°ƒç”¨ä¹‹å‰
    @Override
    public void onInvoke(ValidateUserInfo userInfo){
        System.out.println("[äº‹ä»¶é€šçŸ¥][è°ƒç”¨ä¹‹å‰] onInvoke æ‰§è¡Œ.");
        // æ ¡éªŒ id å±æ€§å¿…å¡«
        if (StringUtils.isBlank(userInfo.getId())) {
            throw new RuntimeException("[onInvoke] id ä¸èƒ½ä¸ºç©º");
        }
        // æ ¡éªŒ name å±æ€§çš„é•¿åº¦å¿…é¡»åœ¨ 5~10 ä¹‹é—´
        String name = userInfo.getName();
        if (StringUtils.isNotBlank(name) && (name.length() < 5 || name.length() > 10)) {
            throw new RuntimeException("[onInvoke] name å¿…é¡»åœ¨ 5~10 ä¸ªé•¿åº¦ä¹‹é—´");
        }
    }
    // è°ƒç”¨ä¹‹å
    @Override
    public void onReturn(String result, ValidateUserInfo userInfo){
        System.out.println("[äº‹ä»¶é€šçŸ¥][è°ƒç”¨ä¹‹å] onReturn æ‰§è¡Œ.");
    }
    // è°ƒç”¨å¼‚å¸¸
    @Override
    public void onThrow(Throwable ex, ValidateUserInfo userInfo){
        System.out.println("[äº‹ä»¶é€šçŸ¥][è°ƒç”¨å¼‚å¸¸] onThrow æ‰§è¡Œ.");
    }
}
```

ä»£ç åšå‡ºçš„æ”¹å˜ä¸»è¦æœ‰ 3 ç‚¹ï¼š

- æ–°å¢äº†ä¸€ä¸ªä¸“é—¨æ‹¦æˆªè°ƒç”¨ä¸‹æ¸¸ validateUser æ–¹æ³•çš„äº‹ä»¶é€šçŸ¥å®ç°ç±» EventValidateUserServiceImplÂ ã€‚
- åœ¨ InvokeDemoFacade ä¸­ï¼ŒvalidationFacade å­—æ®µçš„ @DubboReference æ³¨è§£ï¼Œå®šä¹‰äº†methods å±æ€§ï¼Œä¸“é—¨æŒ‡å‘ validateUser æ–¹æ³•ï¼Œå¹¶ä¸ºè¯¥æ–¹æ³•é…ä¸Šäº†äº‹ä»¶é€šçŸ¥å¤„ç†ç±»ã€‚
- ValidateUserInfo å¯¹è±¡ä¸­çš„ idã€name å­—æ®µçš„æ ¡éªŒé€»è¾‘ï¼Œå®Œå…¨æ¬åˆ°äº†äº‹ä»¶é€šçŸ¥ç±»çš„ onInvoke æ–¹æ³•ä¸­ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠè°ƒç”¨å…¶ä»–ä¸‹æ¸¸çš„æ–¹æ³•ï¼Œéƒ½é…ä¸Šäº‹ä»¶é€šçŸ¥ç±»å³å¯ï¼Œèƒ½å¤ç”¨å°±å¤ç”¨ï¼Œä¸èƒ½å¤ç”¨å°±æ–°å†™ï¼Œè¿™æ ·åº”è¯¥æŒºå®Œç¾äº†ã€‚

æ­£å¸¸é€»è¾‘å¾ˆæµç•…ï¼Œä½†æ€ç»´ç¼œå¯†çš„ä½ è€ƒè™‘åˆ°å¼‚å¸¸é€»è¾‘ï¼Œå‘ç°äº†ä¸€ä¸ªç»†èŠ‚é—®é¢˜ï¼šåœ¨äº‹ä»¶é€šçŸ¥å¤„ç†ç±»çš„ onInvoke æ–¹æ³•ä¸­ï¼Œå‚æ•°ä¸åˆæ³•ä¼šæŠ›å¼‚å¸¸ï¼Œé‚£æŠ›å‡ºçš„è¿™ä¸ªå¼‚å¸¸ä¼šä¸­æ–­è°ƒç”¨æµç¨‹ä¹ˆï¼Ÿæˆ–è€…è¯´ **onInvoke æŠ›å‡ºå¼‚å¸¸åï¼Œæ¶ˆè´¹æ–¹è¿˜ä¼šæŠŠè¯·æ±‚å‘åˆ°æä¾›æ–¹ä¹ˆï¼Ÿ**

ä¸€è¯­ä¸­çš„ï¼Œæˆ‘ä»¬åœ¨æ¶ˆè´¹æ–¹å†™æ®µä»£ç è°ƒç”¨ä¸€ä¸‹çœ‹çœ‹æ•ˆæœï¼š

```java
// ä» Spring çš„ä¸Šä¸‹æ–‡ä¸­æ‹¿åˆ° InvokeDemoFacade çš„å®ä¾‹å¯¹è±¡
InvokeDemoFacade invokeDemoFacade = SpringCtxUtils.getBean(InvokeDemoFacade.class);
// ç„¶åæƒ³åŠæ³•è§¦å‘è°ƒç”¨ä¸€ä¸‹ invokeValidate æ–¹æ³•ï¼Œç›®çš„æ˜¯éœ€è¦è°ƒç”¨ä¸‹æ¸¸çš„ validateUser æ–¹æ³•
String retMsg = invokeDemoFacade.invokeValidate("1", "Geek", "F");
// ç„¶åå°†è¿”å›çš„ç»“æœæ‰“å°å‡ºæ¥
System.out.println(retMsg);
```

è¿è¡Œä¹‹åï¼Œå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š

```java
[äº‹ä»¶é€šçŸ¥][è°ƒç”¨å¼‚å¸¸] onThrow æ‰§è¡Œ.
[äº‹ä»¶é€šçŸ¥][è°ƒç”¨ä¹‹å] onReturn æ‰§è¡Œ.
Ret: 1,Geek,F
```

ç°å®çš„ç»“æœå’Œæˆ‘ä»¬é¢„æƒ³çš„ä¸å¤ªä¸€æ ·ï¼Œæ˜æ˜æ‹¦æˆªåˆ°äº†ï¼Œä¹ŸæŠ›äº†å¼‚å¸¸ï¼Œä¸ºä»€ä¹ˆè¿˜èƒ½æ‹¿åˆ°è¿”å›ç»“æœå‘¢ï¼Ÿ

çœ‹æ¥æˆ‘ä»¬å¾—åˆ°æä¾›äº‹ä»¶é€šçŸ¥æœºåˆ¶çš„è¿‡æ»¤å™¨ FutureFilter é‡Œé¢æ¢ä¸ªç©¶ç«Ÿï¼š

```java
// FutureFilter#fireInvokeCallbackï¼Œé€šè¿‡åå°„è°ƒç”¨é€šçŸ¥å¤„ç†ç±»çš„ onInvoke æ–¹æ³•
private void fireInvokeCallback(final Invoker<?> invoker, final Invocation invocation) {
    // çœç•¥äº†éƒ¨åˆ†å…¶ä»–ä»£ç 
    Object[] params = invocation.getArguments();
    try {
        // è¿™é‡Œä¼šåå°„è°ƒç”¨ EventValidateUserServiceImplÂ çš„ onInvoke æ–¹æ³•
        onInvokeMethod.invoke(onInvokeInst, params);
    } catch (InvocationTargetException e) {
        // å¦‚æœ onInvoke è¿›å…¥äº†è¿™é‡Œçš„å¼‚å¸¸ï¼Œä¼šç»§ç»­å›è°ƒ onThrow æ–¹æ³•
        fireThrowCallback(invoker, invocation, e.getTargetException());
    } catch (Throwable e) {
        // å¦‚æœ onInvoke è¿›å…¥äº†è¿™é‡Œçš„å¼‚å¸¸ï¼Œä¼šç»§ç»­å›è°ƒ onThrow æ–¹æ³•
        fireThrowCallback(invoker, invocation, e);
    }
}

// FutureFilter#fireThrowCallbackï¼Œé€šè¿‡åå°„è°ƒç”¨é€šçŸ¥å¤„ç†ç±»çš„ onThrow æ–¹æ³•
private void fireThrowCallback(final Invoker<?> invoker, final Invocation invocation, final Throwable exception) {
    // çœç•¥äº†éƒ¨åˆ†å…¶ä»–ä»£ç 
    Class<?>[] rParaTypes = onthrowMethod.getParameterTypes();
    if (rParaTypes[0].isAssignableFrom(exception.getClass())) {
        try {
            // çœç•¥äº†éƒ¨åˆ†å…¶ä»–ä»£ç 
            // è¿™é‡Œä¼šåå°„è°ƒç”¨ EventValidateUserServiceImplÂ çš„ onThrow æ–¹æ³•
            onthrowMethod.invoke(onthrowInst, params);
        } catch (Throwable e) {
            // å¦‚æœ onThrow è¿›å…¥äº†è¿™é‡Œçš„å¼‚å¸¸ï¼Œåˆ™åªæ˜¯æ‰“ä¸ªé”™è¯¯æ—¥å¿—è€Œå·²ï¼Œä¼šåæ‰å¼‚å¸¸
            logger.error(invocation.getMethodName() + ".call back method invoke error . callback method :" + onthrowMethod + ", url:" + invoker.getUrl(), e);
        }
    } else {
        logger.error(invocation.getMethodName() + ".call back method invoke error . callback method :" + onthrowMethod + ", url:" + invoker.getUrl(), exception);
    }
}
```

åœ¨ FutureFilter çš„æºç ä¸­èƒ½å‘ç°ï¼Œæ— è®ºå¦‚ä½•ï¼Œä¸ç®¡æ˜¯ onInvoke æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿˜æ˜¯ onInvoke æŠ›å‡ºçš„å¼‚å¸¸è¿›å…¥äº† onThrow é€»è¾‘ï¼Œç”šè‡³æ˜¯ onThrow é€»è¾‘æŠ›å‡ºçš„å¼‚å¸¸ï¼Œéƒ½ä¼šè¢«åæ‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œäº‹ä»¶é€šçŸ¥ç»™æˆ‘ä»¬æä¾›äº†ä¸€ç§å®‰å…¨çš„è°ƒç”¨æœºåˆ¶ï¼Œæ— è®ºåœ¨é€šçŸ¥æœºåˆ¶çš„å®ç°ç±»ä¸­å‘ç”Ÿä»€ä¹ˆæ ·çš„å¼‚å¸¸ï¼Œæœ€ç»ˆéƒ½ä¸ä¼šå½±å“ç¨‹åºç»§ç»­å¾€åæ‰§è¡Œã€‚

æ‰€ä»¥ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬å‘ç°äº‹ä»¶é€šçŸ¥æœºåˆ¶ä¼šåƒæ‰å‚æ•°æ ¡éªŒæŠ›å‡ºçš„å¼‚å¸¸ï¼Œæ— æ³•é˜»æ–­æµç¨‹ï¼Œè¿™ä¸ªæ–¹æ³•è¡Œä¸é€šäº†ã€‚è¿™ä¹Ÿæ˜¯æºç æœ‰æ—¶å€™ä¸å°½å¦‚äººæ„çš„åœ°æ–¹ï¼Œä½†æ˜¯åè¿‡æ¥æƒ³è¿™ä¹Ÿæ˜¯ä¸€ç§çº¦æŸï¼Œæ¯•ç«Ÿäº‹ä»¶é€šçŸ¥ä¸æ˜¯ä¸“é—¨ä¸ºå‚æ•°æ ¡éªŒè€Œè®¾è®¡çš„ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªä¸‡èƒ½çš„ USB è®¾å¤‡ï¼Œè°æ’ä¸Šäº†å°±èƒ½ç”¨ã€‚

æ—¢ç„¶äº‹ä»¶é€šçŸ¥æœºåˆ¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„è¯‰æ±‚ï¼Œé‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥ä»¿ç…§äº‹ä»¶é€šçŸ¥æœºåˆ¶çš„åšæ³•ï¼Œè‡ªå·±å®ç°ä¸€å¥—æ ¡éªŒæœºåˆ¶å‘¢ï¼Ÿ

### 3.ç»Ÿä¸€éªŒè¯

é¡ºç€è¿™ä¸ªæƒ³æ³•æˆ‘ä»¬ç»§ç»­æ€è€ƒã€‚

å…ˆæ¢³ç†ä¸€ä¸‹å¤§æ€è·¯ï¼Œç±»ä¼¼äº‹ä»¶æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥åšåˆ°æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼Œè¯·æ±‚ä¼šè§¦å‘è¿‡æ»¤å™¨çš„ invoke æ–¹æ³•ï¼Œç„¶ååˆå› ä¸º invoke æ–¹æ³•ä¸­çš„ invocation å¯¹è±¡å°è£…äº†ä»»æ„æ¥å£çš„è¯·æ±‚å‚æ•°ï¼Œæˆ‘ä»¬å°±åªéœ€è¦æ‹¿ç€ invocation é‡Œé¢çš„å…¥å‚å€¼è¿›è¡ŒæŒ¨ä¸ªæ ¡éªŒã€‚

è¿™ä¸ªæ€è·¯å¥½åƒæŒºå¯è¡Œçš„ï¼Œæˆ‘ä»¬ç»§ç»­æ€è€ƒç»†èŠ‚ã€‚

å‡ä½¿ä» invocation é‡Œé¢æ‹¿åˆ°äº†ä¸€ä¸ªä¸ªå‚æ•°å€¼ï¼Œè™½ç„¶çŸ¥é“æ¯ä¸ªå­—æ®µå€¼æ˜¯ä»€ä¹ˆï¼Œä½†æ˜¯å¯¹æ¯ä¸ªå­—æ®µæŒ‰ç…§æ€ä¹ˆæ ·çš„è§„åˆ™è¿›è¡Œæ ¡éªŒï¼Œè¿™ä¸ªæ ‡å‡†æ˜¯ç¼ºä¹çš„ï¼Œ**æ‰€ä»¥éœ€è¦ä¸€ä¸ªå¯è¡¡é‡çš„ã€é’ˆå¯¹å­—æ®µæŒ‰ç…§æ€æ ·çš„è§„åˆ™è¿›è¡Œæ ¡éªŒçš„æ ‡å‡†äº§ç‰©ï¼Œè€Œä¸”è¿™ä¸ªæ ‡å‡†äº§ç‰©è¿˜å¾—å¿…é¡»åœ¨ invoke è¢«è§¦å‘è°ƒç”¨çš„è¿è¡Œæ—¶æ€èƒ½è·å–åˆ°ã€‚**

å›å¿†æˆ‘ä»¬æ‰€å­¦çš„JavaçŸ¥è¯†ç‚¹ï¼Œå“ªä¸ªæ˜¯å¯ä»¥åœ¨è¿è¡Œæ—¶è¢«è·å–åˆ°ï¼Œèƒ½è·Ÿç€ä»»ä½•å­—æ®µèµ°ï¼Œå¹¶ä¸”å­—æ®µçš„æ ¡éªŒè§„åˆ™ä¸åŒè¿˜èƒ½æä¾›ä¸åŒçš„å†…å®¹å‘¢ï¼Ÿ

ä½ ä¸€å®šæƒ³åˆ°äº†â€”â€”æ³¨è§£ã€‚

æ²¡é”™ï¼Œæ³¨è§£å°±æ˜¯æˆ‘ä»¬çš„æ ‡å‡†äº§ç‰©ã€‚åªè¦è‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼Œåœ¨æ³¨è§£ä¸­æä¾›æˆ‘ä»¬çš„æ ¡éªŒè§„åˆ™ï¼Œç„¶ååœ¨ invocation ä¸­æ‰¾å­—æ®µæ—¶ï¼Œé¡ºä¾¿çœ‹çœ‹è¿™ä¸ªå­—æ®µæ³¨è§£ä¸­çš„æ ¡éªŒè§„åˆ™æ˜¯æ€ä¹ˆæ ·çš„ï¼Œä¸€äº”ä¸€ååœ°æŒ‰ç…§æ ¡éªŒè§„åˆ™æ ¡éªŒå­—æ®µå€¼ä¸å°±ä¸‡äº‹å¤§å‰äº†ä¹ˆã€‚

æ¯ä¸ªç¯èŠ‚éƒ½æƒ³æ¸…æ¥šï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥å‡†å¤‡åŠ¨æ‰‹å®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨äº†ã€‚

åˆ«æ€¥ï¼Œæˆ‘è¿™é‡Œæ•™ä½ ä¸€ä¸ªå°æŠ€å·§ï¼Œ**åƒè¿‡æ»¤å™¨è¿™ç§å…·æœ‰æ‹¦æˆªæ‰€æœ‰è¯·æ±‚æœºåˆ¶åŠŸèƒ½çš„ç±»ï¼Œä¸€å®šè¦å…ˆçœ‹çœ‹ä½ æ‰€åœ¨ç³»ç»Ÿçš„ç›¸å…³åº•å±‚èƒ½åŠ›æ”¯æ’‘ï¼Œè¯´ä¸å®šç±»ä¼¼çš„åŠŸèƒ½å·²ç»å­˜åœ¨ï¼Œæˆ‘ä»¬å°±èƒ½ç‰©å°½å…¶ç”¨äº†ã€‚**å…·ä½“æ­¥éª¤å°±æ˜¯ï¼š

- é¦–å…ˆæ‰¾åˆ°å…·æœ‰æ‹¦æˆªæœºåˆ¶çš„ç±»ï¼Œè¿™é‡Œå°±æ˜¯ org.apache.dubbo.rpc.Filter è¿‡æ»¤å™¨ã€‚
- å…¶æ¬¡æ‰¾åˆ°è¯¥ org.apache.dubbo.rpc.Filter è¿‡æ»¤å™¨çš„æ‰€æœ‰å®ç°ç±»ã€‚
- æœ€åè®¤çœŸé˜…è¯»æ¯ä¸ªè¿‡æ»¤å™¨çš„ç±»åï¼Œç¿»é˜…ä¸€ä¸‹æ¯ä¸ªè¿‡æ»¤å™¨çš„ç±»æ³¨é‡Šï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆç”¨ã€‚

æˆ‘ä»¬æŒ‰ç…§å°æŠ€å·§æ“ä½œä¸€ä¸‹ï¼Œorg.apache.dubbo.rpc.Filteræ¥å£ä¸‹æœ‰å¥½å¤šä¸ªå®ç°ç±»ï¼š

```java
Filter (org.apache.dubbo.rpc)
- TokenFilter (org.apache.dubbo.rpc.filter)
- MetricsFilter (org.apache.dubbo.monitor.dubbo)
- DeprecatedFilter (org.apache.dubbo.rpc.filter)
- ClassLoaderCallbackFilter (org.apache.dubbo.rpc.filter)
- CacheFilter (org.apache.dubbo.cache.filter)
- ActiveLimitFilter (org.apache.dubbo.rpc.filter)
- ConsumerContextFilter (org.apache.dubbo.rpc.filter)
- ValidationFilter (org.apache.dubbo.validation.filter)
- GenericImplFilter (org.apache.dubbo.rpc.filter)
- MetricsFilter (org.apache.dubbo.monitor.support)
- CompatibleFilter (org.apache.dubbo.rpc.filter)
- ProfilerServerFilter (org.apache.dubbo.rpc.filter)
- ClassLoaderFilter (org.apache.dubbo.rpc.filter)
- ExceptionFilter (org.apache.dubbo.rpc.filter)
- ProviderAuthFilter (org.apache.dubbo.auth.filter)
- ListenableFilter (org.apache.dubbo.rpc)
- FutureFilter (org.apache.dubbo.rpc.protocol.dubbo.filter)
- AccessLogFilter (org.apache.dubbo.rpc.filter)
- TimeoutFilter (org.apache.dubbo.rpc.filter)
- TraceFilter (org.apache.dubbo.rpc.protocol.dubbo.filter)
- ConsumerSignFilter (org.apache.dubbo.auth.filter)
- TpsLimitFilter (org.apache.dubbo.rpc.filter)
- GenericFilter (org.apache.dubbo.rpc.filter)
- MonitorFilter (org.apache.dubbo.monitor.support)
- ExecuteLimitFilter (org.apache.dubbo.rpc.filter)
- ContextFilter (org.apache.dubbo.rpc.filter)
- Filter (com.alibaba.dubbo.rpc)
- EchoFilter (org.apache.dubbo.rpc.filter)
```

è€å¿ƒäº›ä¸€è·¯çœ‹ä¸‹å»ï¼Œåœ¨ç¬¬9è¡Œï¼Œä½ ä¼šå‘ç°ä¸€ä¸ª ValidationFilter ç±»ï¼Œé€šè¿‡ç±»åçš„è‹±æ–‡å•è¯èƒ½å¤§è‡´çœ‹å‡ºæ˜¯ä¸€ä¸ªéªŒè¯çš„è¿‡æ»¤å™¨ã€‚æ˜¯ä¸æ˜¯åº•å±‚æ¡†æ¶å·²ç»åšäº†æˆ‘ä»¬æƒ³åšçš„äº‹æƒ…äº†å‘¢ï¼Ÿæˆ‘ä»¬è¿›å…¥æºç ä¸€æ¢ç©¶ç«Ÿã€‚

ValidationFilter çš„ç±»æ³¨é‡Šä¿¡æ¯æ˜¯è¿™æ ·çš„ï¼š

```markdown
ValidationFilter invoke the validation by finding the right Validator instance based on the configured validation attribute value of invoker url before the actual method invocation.
```

ç®€å•ç†è§£å°±æ˜¯ï¼ŒValidationFilter ä¼šæ ¹æ® url é…ç½®çš„ validation å±æ€§å€¼æ‰¾åˆ°æ­£ç¡®çš„æ ¡éªŒå™¨ï¼Œåœ¨æ–¹æ³•çœŸæ­£æ‰§è¡Œä¹‹å‰è§¦å‘è°ƒç”¨æ ¡éªŒå™¨æ‰§è¡Œå‚æ•°éªŒè¯é€»è¾‘ã€‚

ç±»æ³¨é‡Šé‡Œè¿˜ä¸¾äº†ä¸ªä¾‹å­ï¼š

```markdown
e.g. <dubbo:method name="save" validation="jvalidation" />
```

å¯ä»¥åœ¨æ–¹æ³•å±‚é¢æ·»åŠ  validation å±æ€§ï¼Œå¹¶è®¾ç½®å±æ€§å€¼ä¸º jvalidationï¼Œè¿™æ ·å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨åº•å±‚æä¾›çš„å‚æ•°æ ¡éªŒæœºåˆ¶äº†ã€‚

è¿˜æåˆ°ç‰¹æ®Šè®¾ç½®æ–¹å¼ï¼š

```markdown
e.g. <dubbo:method name="save" validation="special" />
where "special" is representing a validator for special character.
special=xxx.yyy.zzz.SpecialValidation under META-INF folders org.apache.dubbo.validation.Validation file.
```

å¯ä»¥åœ¨ validation å±æ€§çš„å€¼ä¸Šï¼Œå¡«å……ä¸€ä¸ªè‡ªå®šä¹‰çš„æ ¡éªŒç±»åï¼Œå¹¶ä¸”å˜±å’æˆ‘ä»¬è®°å¾—å°†è‡ªå®šä¹‰çš„æ ¡éªŒç±»åæ·»åŠ åˆ° META-INF æ–‡ä»¶å¤¹ä¸‹çš„ org.apache.dubbo.validation.Validation æ–‡ä»¶ä¸­ã€‚

ä»æºç å±‚é¢äº†è§£ä¸€ç•ªåï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†ç°æˆçš„å·¥å…·ï¼Œå¯ä»¥å°½æƒ…æ”¹é€ äº†ã€‚

## ä»£ç æ”¹é€ 

æ”¹é€ å‰ï¼Œæˆ‘ä»¬è¿˜æ˜¯å…ˆæ¢³ç†ä¸‹è¦æ”¹é€ çš„åœ°æ–¹ï¼š

1. ä¸ºè°ƒç”¨ä¸‹æ¸¸çš„æ¥å£æ·»åŠ  validation å±æ€§ã€‚
2. ä»æºç ä¸­å¯»æ‰¾èƒ½æä¾›æ ¡éªŒè§„åˆ™çš„æ ‡å‡†äº§ç‰©ï¼Œä¹Ÿå°±æ˜¯æ³¨è§£ã€‚
3. åœ¨ä¸‹æ¸¸çš„æ–¹æ³•å…¥å‚å¯¹è±¡ä¸­ï¼Œä¸ºéœ€è¦æ ¡éªŒçš„å­—æ®µæ·»åŠ æ³¨è§£ã€‚

è¿™é‡Œæœ‰ä¸ªå°éš¾é¢˜ï¼Œæ ‡å‡†äº§ç‰©æ€ä¹ˆå¯»æ‰¾å‘¢ï¼Ÿ

åŒæ ·åœ°ï¼Œå…ˆåˆ«ç€æ€¥è‡ªå·±å†™ï¼ŒDubboä½œä¸ºä¸€ä¸ªæ— æ•°å¼€å‘è€…ä½¿ç”¨è¿‡çš„ä¼˜ç§€æ¡†æ¶ï¼Œè¯´ä¸å®šå·²ç»æƒ³æˆ‘ä»¬æ‰€æƒ³ï¼Œåšæˆ‘ä»¬æ‰€åšäº†ã€‚

é¡ºç€ ValidationFilter çš„æºç é€»è¾‘ï¼Œä¸ç”¨ç²¾ç»†ç ”è¯»æ¯è¡Œä»£ç ï¼Œåœ¨å¤§è‡´æµè§ˆä»£ç è°ƒç”¨é“¾è·¯çš„è¿‡ç¨‹ä¸­ï¼Œæ³¨æ„çœ‹ä¸åŒçš„æ–¹æ³•ï¼Œæœ‰æ²¡æœ‰å…³äº checkã€verifyã€validator ä¹‹ç±»æ ¡éªŒå•è¯çš„ jar åŒ…æˆ–åŒ…è·¯å¾„ï¼Œä½ ä¼šæœ‰æ„æƒ³ä¸åˆ°çš„æ”¶è·ã€‚

æˆ‘ä»¬å†æ¬¡è¿›å…¥ ValidationFilter æºç ç±»çœ‹çœ‹ï¼Œæ‰¾åˆ° invoke æ–¹æ³•ï¼Œé¡ºç€é€»è¾‘é€è¡Œç‚¹è¿›æ¯ä¸ªæ–¹æ³•ï¼š

```java
// org.apache.dubbo.validation.filter.ValidationFilter.invoke
public Result invoke(Invoker<?> invoker, Invocation invocation) throws RpcException {
    // Validation æ¥å£çš„ä»£ç†ç±»è¢«æ³¨å…¥æˆåŠŸï¼Œä¸”è¯¥è°ƒç”¨çš„æ–¹æ³•æœ‰ validation å±æ€§
    if (validation != null && !invocation.getMethodName().startsWith("$")
            && ConfigUtils.isNotEmpty(invoker.getUrl().getMethodParameter(invocation.getMethodName(), "validation"))) {
        try {
            // æ¥ç€é€šè¿‡ url ä¸­ validation å±æ€§å€¼ï¼Œå¹¶ä¸”ä¸ºè¯¥æ–¹æ³•åˆ›å»ºå¯¹åº”çš„æ ¡éªŒå®ç°ç±»
            Validator validator = validation.getValidator(invoker.getUrl());
            if (validator != null) {
                // è‹¥æ‰¾åˆ°æ ¡éªŒå®ç°ç±»çš„è¯ï¼Œåˆ™çœŸæ­£å¼€å¯å¯¹æ–¹æ³•çš„å‚æ•°è¿›è¡Œæ ¡éªŒ
                validator.validate(invocation.getMethodName(), invocation.getParameterTypes(), invocation.getArguments());
            }
        } catch (RpcException e) {
            // RpcException å¼‚å¸¸ç›´æ¥æŠ›å‡ºå»
            throw e;
        } catch (Throwable t) {
            // é RpcException å¼‚å¸¸çš„è¯ï¼Œåˆ™ç›´æ¥å°è£…ç»“æœè¿”å›
            return AsyncRpcResult.newDefaultAsyncResult(t, invocation);
        }
    }
    // èƒ½æ¥åˆ°è¿™é‡Œï¼Œè¯´æ˜è¦ä¹ˆæ²¡æœ‰é…ç½®æ ¡éªŒè¿‡æ»¤å™¨ï¼Œè¦ä¹ˆå°±æ˜¯æ ¡éªŒäº†ä½†å‚æ•°éƒ½åˆæ³•
    // æ—¢ç„¶æ²¡æœ‰æŠ›å¼‚å¸¸çš„è¯ï¼Œé‚£ä¹ˆå°±ç›´æ¥è°ƒç”¨ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨çš„é€»è¾‘
    return invoker.invoke(invocation);
}

// org.apache.dubbo.validation.support.AbstractValidation.getValidator
public Validator getValidator(URL url) {
    // å°† url è½¬æˆå­—ç¬¦ä¸²å½¢å¼
    String key = url.toFullString();
    // validators æ˜¯ä¸€ä¸ª Map ç»“æ„ï¼Œå³åº•å±‚å¯ä»¥è¯´æ˜æ¯ä¸ªæ–¹æ³•éƒ½å¯ä»¥æœ‰ä¸åŒçš„æ ¡éªŒå™¨
    Validator validator = validators.get(key);
    if (validator == null) {
        // è‹¥é€šè¿‡ url ä» Map ç»“æ„ä¸­æ‰¾ä¸åˆ° value çš„è¯ï¼Œåˆ™ç›´æ¥æ ¹æ® url åˆ›å»ºä¸€ä¸ªæ ¡éªŒå™¨å®ç°ç±»
        // è€Œä¸” createValidator æ˜¯ä¸€ä¸ª protected abstract ä¿®é¥°çš„
        // è¯´æ˜æ˜¯ä¸€ç§æ¨¡æ¿æ–¹å¼ï¼Œåˆ›å»ºæ ¡éªŒå™¨å®ç°ç±»ï¼Œæ˜¯å¯è¢«é‡å†™é‡æ–°åˆ›å»ºè‡ªå®šä¹‰çš„æ ¡éªŒå™¨
        validators.put(key, createValidator(url));
        validator = validators.get(key);
    }
    return validator;
}

// org.apache.dubbo.validation.support.jvalidation.JValidation
public class JValidation extends AbstractValidation {
    @Override
    protected Validator createValidator(URL url) {
        // åˆ›å»ºä¸€ä¸ª Dubbo æ¡†æ¶é»˜è®¤çš„æ ¡éªŒå™¨
        return new JValidator(url);
    }
}

// org.apache.dubbo.validation.support.jvalidation.JValidator
public class JValidator implements Validator {
    // çœç•¥å…¶ä»–éƒ¨åˆ†ä»£ç 
    // è¿›å…¥åˆ° Dubbo æ¡†æ¶é»˜è®¤çš„æ ¡éªŒå™¨ä¸­ï¼Œå‘ç°çœŸå®é‡‡ç”¨çš„æ˜¯ javax ç¬¬ä¸‰æ–¹çš„ validation æ’ä»¶
    // ç”±æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥æ‰¾åˆ°äº†æ ‡å‡†äº§ç‰©çš„å…³é”®çªç ´å£äº†
    private final javax.validation.Validator validator;
}
```

è·Ÿè¸ªæºç çš„è¿‡ç¨‹ï¼š

- å…ˆæ‰¾åˆ° ValidationFilter è¿‡æ»¤å™¨çš„ invoke å…¥å£ã€‚
- ç´§æ¥ç€æ‰¾åˆ°æ ¹æ® validation å±æ€§å€¼åˆ›å»ºæ ¡éªŒå™¨çš„ createValidator æ–¹æ³•ã€‚
- ç„¶åå‘ç°åˆ›å»ºäº†ä¸€ä¸ª JValidator å¯¹è±¡ã€‚
- åœ¨è¯¥å¯¹è±¡ä¸­å‘ç°äº†å…³äº javax åŒ…åçš„ç¬¬ä¸‰æ–¹ validation æ’ä»¶ã€‚

æœ€ç»ˆæˆ‘ä»¬ç¡®å®å‘ç°äº†ä¸€ä¸ªç¬¬ä¸‰æ–¹ validation æ’ä»¶ï¼Œé¡ºè—¤æ‘¸ç“œä½ å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„ maven åæ ‡ï¼š

```xml
<dependency>
    <groupId>org.hibernate</groupId>
    <artifactId>hibernate-validator</artifactId>
</dependency>
```

å¦‚æ„¿å‘ç°äº† hibernate-validator è¿™ä¸ªç¬¬ä¸‰æ–¹æ’ä»¶ã€‚ä½†ä½ å¯èƒ½ä¼šé—®äº†ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ²¡èƒ½æ‰¾åˆ°è¿™ä¸ªæ ‡å‡†äº§ç‰©å•Šï¼Œé—®é¢˜è¿˜æ˜¯æ²¡æœ‰è§£å†³ï¼Ÿ

ä¸æ€¥ï¼Œæ—¢ç„¶æ‰¾åˆ°äº†ç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œä¸å¦¨å°†è¿™ä¸ªmaven åæ ‡å¼•å…¥åˆ°æ¶ˆè´¹æ–¹å·¥ç¨‹ä¸­ï¼Œå†è¿›å…¥åˆ°è¯¥æ’ä»¶çš„ pom æ–‡ä»¶ä¸­ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰æ„å¤–çš„æ”¶è·ã€‚æˆ‘ä»¬è¿›å…¥ hibernate-validator æ’ä»¶çš„ pom ä¸­ï¼Œèƒ½çœ‹åˆ°é‡Œé¢å¼•ç”¨äº†ä¸€ä¸ª validation-api æ’ä»¶åæ ‡ï¼š

```xml
<dependency>
    <groupId>javax.validation</groupId>
    <artifactId>validation-api</artifactId>
</dependency>
```

ç°åœ¨ä½ å†è¿›å…¥è¿™ä¸ªåæ ‡å¯¹åº”çš„ java ä»£ç ä¸­ï¼Œä¼šçœ‹åˆ°äº†ä¸€å †æ³¨è§£ï¼Œæ¯”å¦‚ NotNullã€Maxã€Size ç­‰ç­‰ï¼Œè¯´æ˜**è¿™äº›æ³¨è§£å¤©ç”Ÿå°±å¯ä»¥è®¾ç½®ä¸åŒçš„æ ¡éªŒè§„åˆ™**ã€‚ç°åœ¨æ ‡å‡†äº§ç‰©æ‰¾åˆ°äº†ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾å¿ƒæ”¹é€ äº†ã€‚

ä¸‡äº‹ä¿±å¤‡ï¼Œåªæ¬ ä»£ç ï¼Œæ”¹é€ å¦‚ä¸‹ï¼š

```java
///////////////////////////////////////////////////
// ç»Ÿä¸€éªŒè¯ï¼šä¸‹æ¸¸ validateUser çš„æ–¹æ³•å…¥å‚å¯¹è±¡
///////////////////////////////////////////////////
@Setter
@Getter
public class ValidateUserInfo implements Serializable {
    private static final long serialVersionUID = 1558193327511325424L;
    // æ·»åŠ äº† @NotBlank æ³¨è§£
    @NotBlank(message = "id ä¸èƒ½ä¸ºç©º")
    private String id;
    // æ·»åŠ äº† @Length æ³¨è§£
    @Length(min = 5, max = 10, message = "name å¿…é¡»åœ¨ 5~10 ä¸ªé•¿åº¦ä¹‹é—´")
    private String name;
    // æ— æ³¨è§£ä¿®é¥°
    private String sex;
}

///////////////////////////////////////////////////
// ç»Ÿä¸€éªŒè¯ï¼šæ¶ˆè´¹æ–¹çš„ä¸€æ®µè°ƒç”¨ä¸‹æ¸¸ validateUser çš„ä»£ç 
///////////////////////////////////////////////////
@Component
public class InvokeDemoFacade {

    // æ³¨æ„ï¼Œ@DubboReference è¿™é‡Œæ·»åŠ äº† validation å±æ€§
    @DubboReference(validation ï¼ "jvalidation")
    private ValidationFacade validationFacade;
    
    // ä¸€ä¸ªç®€å•çš„è§¦å‘è°ƒç”¨ä¸‹æ¸¸ ValidationFacade.validateUser çš„æ–¹æ³•
    public String invokeValidate(String id, String name, String sex) {
        return validationFacade.validateUser(new ValidateUserInfo(id, name, sex));
    }
}

///////////////////////////////////////////////////
// ç»Ÿä¸€éªŒè¯ï¼šæä¾›æ–¹çš„ä¸€æ®µæ¥æ”¶ validateUser è¯·æ±‚çš„ä»£ç 
///////////////////////////////////////////////////
// æ³¨æ„ï¼Œ@DubboService è¿™é‡Œæ·»åŠ äº† validation å±æ€§
@DubboService(validation ï¼ "jvalidation")
@Component
public class ValidationFacadeImpl implements ValidationFacade {
    @Override
    public String validateUser(ValidateUserInfo userInfo) {
        // è¿™é‡Œå°±è±¡å¾æ€§çš„æ¨¡æ‹Ÿä¸‹ä¸šåŠ¡é€»è¾‘
        String retMsg = "Ret: "
                + userInfo.getId()
                + "," + userInfo.getName()
                + "," + userInfo.getSex();
        System.out.println(retMsg);
        return retMsg;
    }
}
```

å…¶ä»–ä»£ç æ²¡æœ‰å¤šå¤§å˜åŒ–ï¼Œä¸»è¦æ”¹åŠ¨æ˜¯3ç‚¹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å‰é¢æ¢³ç†çš„éœ€è¦æ”¹é€ çš„3ç‚¹ï¼š

1. æä¾›æ–¹å°†æ–¹æ³•å…¥å‚çš„ idã€name å­—æ®µæ·»åŠ äº†æ³¨è§£ã€‚
2. æä¾›æ–¹åœ¨ ValidationFacadeImpl ç±»çš„ @DubboService æ³¨è§£ä¸­æ·»åŠ äº† validation å±æ€§ï¼Œå±æ€§å¯¹åº”çš„å€¼ä¸º jvalidationã€‚
3. æ¶ˆè´¹æ–¹åœ¨è°ƒç”¨æä¾›æ–¹æ—¶ï¼Œåœ¨ InvokeDemoFacade ä¸­ç»™ validationFacade å­—æ®µçš„ @DubboReference æ³¨è§£ä¸­ä¹Ÿæ·»åŠ äº†ä¸€ä¸ª validation å±æ€§ï¼Œå±æ€§å¯¹åº”çš„å€¼ä¹Ÿä¸º jvalidationã€‚

ä»£ç å†™å®Œï¼Œå†å›è¿‡å¤´æ¥çœ‹çœ‹è€å¤§è®­æ–¥çš„3ä¸ªé—®é¢˜æœ‰æ²¡æœ‰è§£å†³ï¼š

- é—®é¢˜1ï¼šæ¶ˆè´¹æ–¹ä»£ç ï¼Œåœ¨è°ƒç”¨ä¸‹æ¸¸çš„ validateUser æ–¹æ³•æ—¶ï¼Œæ²¡æœ‰é¢„å…ˆåšä¸€äº›å‚æ•°çš„åˆæ³•æ€§æ ¡éªŒã€‚
- é—®é¢˜2ï¼šæä¾›æ–¹ä»£ç ï¼ŒæœåŠ¡æ–¹ä»£ç åœ¨æ¥æ”¶è¯·æ±‚çš„æ—¶å€™ï¼Œæ²¡æœ‰å¯¹ä¸€äº›å¿…è¦çš„å­—æ®µè¿›è¡Œåˆæ³•æ€§æ ¡éªŒã€‚
- é—®é¢˜3ï¼šä¸ä»…ä»…æ˜¯ validateUser æ–¹æ³•ï¼Œå…¶ä»–å‡ ä¸ªæ–¹æ³•ä¹Ÿæ²¡æœ‰å¯¹å‚æ•°è¿›è¡Œåˆæ³•æ€§æ ¡éªŒã€‚

é—®é¢˜1æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ @DubboReference æ³¨è§£ä¸­æ·»åŠ  validation å±æ€§è§£å†³ï¼Œé—®é¢˜2æˆ‘ä»¬å¯ä»¥åœ¨ @DubboService æ³¨è§£ä¸­æ·»åŠ  validation å±æ€§è§£å†³ï¼Œé—®é¢˜3å¯ä»¥å‚è€ƒé—®é¢˜1å’Œ2ã€‚

è¿™æ ·ï¼Œæˆ‘ä»¬è½»æ¾åšåˆ°äº†æ—¢èƒ½åœ¨æ¶ˆè´¹æ–¹æå‰é¢„åˆ¤å‚æ•°çš„åˆæ³•æ€§ï¼Œä¹Ÿèƒ½åœ¨æä¾›æ–¹è¿›è¡Œå‚æ•°çš„å…œåº•æ ¡éªŒï¼Œè¿˜èƒ½è®©ä»£ç æ›´åŠ ç²¾ç®€æå‡ç¼–ç æ•ˆç‡ï¼Œå‡å°‘å¤§é‡æ¯ç‡¥æ— å‘³çš„é›·åŒä»£ç ã€‚

## å‚æ•°éªŒè¯çš„åº”ç”¨

ä½†æ˜¯è¿™ç§ç®€å•çš„å‚æ•°æ ¡éªŒä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„ï¼Œåœ¨æˆ‘ä»¬å®é™…åº”ç”¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå“ªäº›åº”ç”¨åœºæ™¯å¯ä»¥è€ƒè™‘è¿™ç§å‚æ•°æ ¡éªŒå‘¢ï¼Ÿ

- ç¬¬ä¸€ï¼Œå•å€¼ç®€å•è§„åˆ™åˆ¤æ–­ï¼Œå„ä¸ªå­—æ®µçš„æ ¡éªŒé€»è¾‘æ¯«æ— å…³è”ã€ç›¸äº’ç‹¬ç«‹ã€‚
- ç¬¬äºŒï¼Œæå‰æ‹¦æˆªæ‰è„è¯·æ±‚ï¼Œå°½å¯èƒ½æŠŠä¸€äº›å‚æ•°å€¼ä¸åˆæ³•çš„æƒ…å†µæå‰è¿‡æ»¤æ‰ï¼Œå¯¹äºæ¶ˆè´¹æ–¹æ¥è¯´å°½é‡æŠŠé«˜è´¨é‡çš„è¯·æ±‚å‘å¾€æä¾›æ–¹ï¼Œå¯¹äºæä¾›æ–¹æ¥è¯´ï¼Œå°½é‡æŠŠéæ³•çš„å­—æ®µå€¼æå‰æ‹¦æˆªï¼Œä»¥æ­¤ä¿è¯æ ¸å¿ƒé€»è¾‘ä¸è¢«è„è¯·æ±‚æ±¡æŸ“ã€‚
- ç¬¬ä¸‰ï¼Œé€šç”¨ç½‘å…³æ ¡éªŒé¢†åŸŸï¼Œåœ¨ç½‘å…³é¢†åŸŸéƒ¨åˆ†å¾ˆå°‘æœ‰ä¸šåŠ¡é€»è¾‘ï¼Œä½†åˆå¾—æ‰¿æ¥è¯·æ±‚ï¼Œå¯¹äºä¸åˆæ³•çš„å‚æ•°è¯·æ±‚å°±éœ€è¦å°½é‡æ‹¦æˆªæ‰ï¼Œé¿å…ä¸å¿…è¦çš„è¯·æ±‚æ‰“åˆ°ä¸‹æ¸¸ç³»ç»Ÿï¼Œé€ æˆèµ„æºæµªè´¹ã€‚

## æ€»ç»“

å¯¹äºå°é©¬å†™çš„å‚æ•°æ ¡éªŒï¼Œè€å¤§CRåå‘ç°å¥½å‡ ä¸ªæ–¹æ³•å¹¶ä¸å®Œå–„ï¼Œæˆ‘ä»¬åˆ†åˆ«ä»ç®€å•éªŒè¯ã€é€šçŸ¥éªŒè¯ã€ç»Ÿä¸€éªŒè¯ä¸‰ç§æ–¹å¼åˆ†æå¹¶å°è¯•è§£å†³ã€‚

- ç®€å•éªŒè¯ï¼Œå¥½å¤„æ˜¯ç®€å•ç›´æ¥ï¼Œä¸ç”¨è¿‡å¤šæŠ½è±¡å°è£…ä»£ç ï¼Œä½†ä¼šå¯¼è‡´ä»£ç å……æ–¥ç€å¤§é‡ä»·å€¼ä¸é«˜çš„é›·åŒä»£ç ã€‚
- é€šçŸ¥éªŒè¯ï¼Œå€Ÿé‰´äº‹ä»¶é€šçŸ¥é‡‡ç”¨æ‹¦æˆªçš„æ€è·¯ï¼Œä½†æ˜¯å¿½ç•¥äº†äº‹ä»¶é€šçŸ¥æœºåˆ¶çš„ç‰¹å®šåº”ç”¨åœºæ™¯ï¼Œäº‹ä»¶é€šçŸ¥æœºåˆ¶ä¼šåæ‰å„ç§å®ç°ç±»æŠ›å‡ºçš„å¼‚å¸¸ã€‚
- ç»Ÿä¸€éªŒè¯ï¼Œç»§ç»­æ€è€ƒæ‹¦æˆªçš„æ€è·¯ï¼Œè‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼Œå¹¶åœ¨æºç ä¸­æ‰¾åˆ°äº†ç ´è§£ä¹‹é“ã€‚

ä»æºç ä¸­æˆ‘ä»¬å‘ç°Dubboå‚æ•°æ ¡éªŒæœ‰ä¸¤ç§æ–¹å¼ï¼š

- ä¸€èˆ¬æ–¹å¼ï¼Œè®¾ç½® validation ä¸º jvalidationã€jvalidationNew ä¸¤ç§æ¡†æ¶æä¾›çš„å€¼ã€‚
- ç‰¹æ®Šæ–¹å¼ï¼Œè®¾ç½® validation ä¸ºè‡ªå®šä¹‰æ ¡éªŒå™¨çš„ç±»è·¯å¾„ï¼Œå¹¶å°†è‡ªå®šä¹‰çš„ç±»è·¯å¾„æ·»åŠ åˆ° META-INF æ–‡ä»¶å¤¹ä¸‹é¢çš„ org.apache.dubbo.validation.Validation æ–‡ä»¶ä¸­ã€‚

å¦‚ä½•è¿›è¡Œå‚æ•°æ ¡éªŒæ”¹é€ ï¼Œä¹Ÿæœ‰é€šç”¨ä¸‰éƒ¨æ›²ï¼š

- é¦–å…ˆï¼Œå¯»æ‰¾å…·æœ‰æ‹¦æˆªæœºåˆ¶çš„æ¥å£ï¼Œä¸”è¯¥æ¥å£å…·æœ‰è¯»å–è¯·æ±‚å¯¹è±¡æ•°æ®çš„èƒ½åŠ›ã€‚
- å…¶æ¬¡ï¼Œå¯»æ‰¾ä¸€å¥—æ³¨è§£æ¥å®šä¹‰æ ¡éªŒçš„æ ‡å‡†è§„åˆ™ï¼Œå¹¶å°†è¯¥æ³¨è§£ä¿®é¥°åˆ°è¯·æ±‚å¯¹è±¡çš„å­—æ®µä¸Šã€‚
- æœ€åï¼Œå¯»æ‰¾ä¸€å¥—æ ¡éªŒé€»è¾‘æ¥æ ¹æ®æ³¨è§£çš„æ ‡å‡†è§„åˆ™æ¥æ ¡éªŒå­—æ®µå€¼ï¼Œæä¾›é€šç”¨çš„æ ¡éªŒèƒ½åŠ›ã€‚

å‚æ•°æ ¡éªŒçš„åº”ç”¨åœºæ™¯ä¸»è¦æœ‰3ç±»ï¼Œå•å€¼ç®€å•è§„åˆ™åˆ¤æ–­ã€é™ä½æ— è°“çš„è„è¯·æ±‚ã€é€šç”¨ç½‘å…³æ ¡éªŒé¢†åŸŸã€‚

### æ€è€ƒé¢˜

ä½ å·²ç»æŒæ¡äº†åœ¨Dubboä¸­å¦‚ä½•æ›´åŠ ä¼˜é›…åœ°è¿›è¡Œç®€å•çš„å‚æ•°éªŒè¯ï¼Œè¿™é‡Œç•™ä¸€ä¸ªå°å®éªŒè®©ä½ æ´»å­¦æ´»ç”¨ï¼Œå‚è€ƒå‚æ•°æ ¡éªŒçš„é€šç”¨ä¸‰éƒ¨æ›²ï¼Œå°è¯•åœ¨Springçš„åˆ‡é¢ä¸­å®Œæˆå¯¹å‚æ•°çš„ç»Ÿä¸€éªŒè¯ã€‚

æ¬¢è¿å†™ä¸‹ä½ çš„æ€è·¯å’Œä»£ç ï¼Œå‚ä¸è®¨è®ºï¼Œå¦‚æœæœ‰æ”¶è·ä¹Ÿæ¬¢è¿åˆ†äº«ç»™èº«è¾¹çš„æœ‹å‹ï¼Œè¯´ä¸å®šå°±å¸®ä»–è§£å†³äº†ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¸‹ä¸€è®²è§ã€‚

### 06æ€è€ƒé¢˜å‚è€ƒ

Dubboæ¡†æ¶çš„äº‹ä»¶é€šçŸ¥æœºåˆ¶ï¼Œå³ä½¿æœ‰é‡è¯•æœºåˆ¶çš„å­˜åœ¨ï¼Œä½†ä¹Ÿåªä¼šè§¦å‘ä¸€æ¬¡ã€‚è¿™ä¸ªé—®é¢˜ç®€å•ï¼Œæˆ‘æ¯”è¾ƒæ¨èåœ¨å¼‚å¸¸ä¸­å¯»æ‰¾ç­”æ¡ˆï¼Œæ¯”å¦‚é€šè¿‡è®©è°ƒç”¨å‡ºç°è¶…æ—¶å¼‚å¸¸ã€‚

å…ˆå†™ä¸Šè¿™æ ·ä¸€æ®µç®€å•çš„æ¨¡æ‹Ÿè°ƒç”¨ä»£ç ï¼š

```java
@Component
public class InvokeDemoFacade {
    @Autowired
    @DubboReference(
            /** æ¥å£è°ƒç ”è¶…æ—¶æ—¶é—´ï¼Œ1æ¯«ç§’ **/
            timeout = 1,
            /** å¯åŠ¨æ—¶ä¸æ£€æŸ¥ DemoFacade æ˜¯å¦èƒ½æ­£å¸¸æä¾›æœåŠ¡ **/
            check = false,
            
            /** ä¸º DemoFacade çš„ sayHello æ–¹æ³•è®¾ç½®äº‹ä»¶é€šçŸ¥æœºåˆ¶ **/
            methods = {@Method(
                            name = "sayHello",
                            oninvoke = "eventNotifyService.onInvoke",
                            onreturn = "eventNotifyService.onReturn",
                            onthrow = "eventNotifyService.onThrow")}
    )
    private DemoFacade demoFacade;
    
    // ç®€å•çš„ä¸€ä¸ª hello æ–¹æ³•ï¼Œç„¶åå†…éƒ¨è°ƒç”¨ä¸‹æ¸¸Dubboæ¥å£ DemoFacade çš„ sayHello æ–¹æ³•
    public String hello(String name){
        return demoFacade.sayHello(name);
    }
}
```

ä»£ç æ¯”è¾ƒç®€å•ï¼Œå®šä¹‰äº†ä¸€ä¸ª InvokeDemoFacade ç±»ï¼Œæ¥ç€åœ¨é‡Œé¢å®šä¹‰ä¸€ä¸ª hello æ–¹æ³•ï¼Œç„¶ååœ¨ hello æ–¹æ³•é‡Œé¢è°ƒç”¨ä¸‹æ¸¸çš„Dubboæ¥å£ DemoFacade çš„ sayHello æ–¹æ³•ã€‚åŒæ—¶ä¸º demoFacade å­—æ®µæ·»åŠ äº† @DubboReference æ³¨è§£ï¼Œå¹¶åœ¨ @DubboReference æ³¨è§£ä¸­ä¸ºä¸‹æ¸¸çš„ sayHello æ–¹æ³•æ·»åŠ äº†äº‹ä»¶é€šçŸ¥é…ç½®ã€‚

è¿™é‡Œéœ€è¦ç‰¹åˆ«å…³æ³¨çš„æ˜¯ timeout = 1 è¿™ä¸ª1æ¯«ç§’çš„è®¾ç½®ï¼Œç›®çš„æ˜¯ä¸ºäº†é‡è¯•å¤šæ¬¡æœ€åæŠ›å¼‚å¸¸ï¼Œæ–¹ä¾¿æŸ¥çœ‹è°ƒç”¨æ ˆå…³ç³»ã€‚

ç„¶ååœ¨ org.apache.dubbo.rpc.cluster.support.FailoverClusterInvoker#doInvoke æ–¹æ³•å¼€å¤´æ‰“ä¸ªæ–­ç‚¹ï¼Œæƒ³åŠæ³•ä»¥Debugæ–¹å¼è§¦å‘è°ƒç”¨ä¸€ä¸‹ InvokeDemoFacade.hello æ–¹æ³•ï¼Œæ¥ç€ä½ ä¼šå‘ç°è¿™æ ·çš„è°ƒç”¨æ ˆå…³ç³»ï¼š

```java
doInvoke:58, FailoverClusterInvoker (org.apache.dubbo.rpc.cluster.support)
invoke:340, AbstractClusterInvoker (org.apache.dubbo.rpc.cluster.support)
invoke:46, RouterSnapshotFilter (org.apache.dubbo.rpc.cluster.router)
invoke:321, FilterChainBuilder$CopyOfFilterChainNode (org.apache.dubbo.rpc.cluster.filter)
invoke:99, MonitorFilter (org.apache.dubbo.monitor.support)
invoke:321, FilterChainBuilder$CopyOfFilterChainNode (org.apache.dubbo.rpc.cluster.filter)
invoke:51, FutureFilter (org.apache.dubbo.rpc.protocol.dubbo.filter)
invoke:321, FilterChainBuilder$CopyOfFilterChainNode (org.apache.dubbo.rpc.cluster.filter)
invoke:109, ConsumerContextFilter (org.apache.dubbo.rpc.cluster.filter.support)
invoke:321, FilterChainBuilder$CopyOfFilterChainNode (org.apache.dubbo.rpc.cluster.filter)
invoke:193, FilterChainBuilder$CallbackRegistrationInvoker (org.apache.dubbo.rpc.cluster.filter)
invoke:92, AbstractCluster$ClusterFilterInvoker (org.apache.dubbo.rpc.cluster.support.wrapper)
invoke:97, MockClusterInvoker (org.apache.dubbo.rpc.cluster.support.wrapper)
invoke:280, MigrationInvoker (org.apache.dubbo.registry.client.migration)
invoke:57, InvocationUtil (org.apache.dubbo.rpc.proxy)
invoke:73, InvokerInvocationHandler (org.apache.dubbo.rpc.proxy)
sayHello:-1, DemoFacadeDubboProxy1 (com.hmilyylimh.cloud.facade.demo)
invoke0:-1, NativeMethodAccessorImpl (jdk.internal.reflect)
invoke:62, NativeMethodAccessorImpl (jdk.internal.reflect)
invoke:43, DelegatingMethodAccessorImpl (jdk.internal.reflect)
invoke:567, Method (java.lang.reflect)
invokeJoinpointUsingReflection:344, AopUtils (org.springframework.aop.support)
invoke:208, JdkDynamicAopProxy (org.springframework.aop.framework)
sayHello:-1, $Proxy56 (com.sun.proxy)
hello:39, InvokeDemoFacade (com.hmilyylimh.cloud.anno.demo)
```

å›¾ä¸­ä»£ç å°±æ˜¯åˆšåˆšDebugæ—¶åˆ°è¾¾äº† FailoverClusterInvoker.doInvoke æ–¹æ³•çš„æ–­ç‚¹è¿™é‡Œï¼Œæˆ‘ä»¬é¡ºç€è°ƒç”¨æ ˆå¾€ä¸‹çœ‹ï¼Œä½ ä¼šå‘ç° FutureFilter æ˜¯åœ¨ FailoverClusterInvoker ä¹‹å‰è°ƒç”¨çš„ï¼Œä¸éš¾å¾—å‡º FailoverClusterInvoker å³ä½¿å†…éƒ¨å°è¯•äº†å¤šæ¬¡å¤±è´¥åæŠ›å‡ºçš„å¼‚å¸¸ï¼Œæœ€åä¼šè¢« FutureFilter æ•è·åˆ°ï¼Œè¿™å°±èƒ½è§£é‡Šä¸ºä»€ä¹ˆé‡è¯•æœºåˆ¶æ‰§è¡Œå¤šæ¬¡åï¼Œäº‹ä»¶é€šçŸ¥æœºåˆ¶åªæ‰§è¡Œä¸€æ¬¡ã€‚

ç”¨ä¸€å¼ å›¾æ¥æè¿°ä¸Šè¿°Debugçš„è°ƒç”¨æµç¨‹ï¼š

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/5c/5a/5ce8861a4747aa0bc745a64fde917d5a.png?wh=1920x540)

è¯·æ±‚ä¼šç»å†ä¸€äº›å…¶ä»–çš„æ¨¡å—ï¼Œä½†å§‹ç»ˆä¼šç»è¿‡ FutureFilter è¿‡æ»¤å™¨ï¼Œè¿‡æ»¤å™¨å†…éƒ¨å…ˆè§¦å‘è°ƒç”¨ onInvoke æ–¹æ³•ï¼Œç„¶åç´§æ¥ç€è§¦å‘é›†ç¾¤æ¨¡å—è¿›è¡ŒRPCè°ƒç”¨ã€‚

å› ä¸ºæœ‰ç€ timeout = 1 è¿™ä¸ª1æ¯«ç§’çš„è¶…æ—¶è®¾ç½®ï¼Œæ‰€ä»¥å‡ ä¹æ˜¯è¯·æ±‚è¿˜æ²¡å‘å‡ºå»å°±è¶…æ—¶äº†ï¼Œå› æ­¤é›†ç¾¤æ¨¡å—é‡è¯•äº†3æ¬¡åï¼Œä¼šç»§ç»­è°ƒç”¨ FutureFilter çš„ onThrow æ–¹æ³•ï¼Œè€Œ onThrow åœ¨ FutureFilter æºç ä¸­çš„æµç¨‹å°±ä¼šè¿›è¡Œåå°„è°ƒç”¨Dubboæ¥å£ sayHello è®¾ç½®çš„äº‹ä»¶å›è°ƒé…ç½®ã€‚

åˆ°è§£é‡Šäº†ä¸ºä»€ä¹ˆDubboæ¡†æ¶çš„äº‹ä»¶é€šçŸ¥æœºåˆ¶ä¸ä¼šå› ä¸ºæœ‰é‡è¯•æœºåˆ¶è€Œè§¦å‘å¤šæ¬¡ã€‚è‹¥å¯¹ FutureFilter æ˜¯æ€ä¹ˆåå°„è°ƒç”¨çš„æ“ä½œæ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥ç»§ç»­æ·±å…¥ç ”ç©¶ä¸€ç•ªã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ3ï¼‰</strong></div><ul>
<li><span>Lum</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>çœ‹åˆ°è¿™é‡Œ å…¶å®å¯¹invocationï¼Œfilterä¸ºå•¥ä¼šæ‰§è¡Œinvokeç­‰ä»£ç é€»è¾‘è¿˜æ˜¯ä¸å¤ªæ¸…æ¥šï¼Œå…ˆæ’ä¸ªçœ¼ï¼Œçœ‹å®Œåæ€»ç»“ä¸€ä¸‹</p>2023-02-28</li><br/><li><span>æ˜ŸæœŸå…«</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>@DubboService(validation ï¼ &quot;jvalidation&quot;)  ç”¨ä»£ç æµ‹è¯•äº†ä¸€ä¸‹ï¼Œåœ¨æä¾›è€…ä¸ç”Ÿæ•ˆ ä»€ä¹ˆæƒ…å†µï¼@DubboReference(validation = &quot;jvalidation&quot;) å®¢æˆ·ç«¯æ˜¯ç”Ÿæ•ˆçš„</p>2023-02-22</li><br/><li><span>Six Days</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>æ€è€ƒé¢˜ï¼šSpring çš„åˆ‡é¢ä¸­å®Œæˆå¯¹å‚æ•°çš„ç»Ÿä¸€éªŒè¯ï¼Ÿ
æ ¹æ®æœ¬æ–‡ä¸­ä½œè€…ç€é‡æ¢³ç†é€šç”¨éªŒè¯æ€è·¯ï¼Œå¯ä»¥åœ¨é¡¹ç›®ä¸­è‡ªå®šä¹‰æ³¨è§£å®šä¹‰æ ¡éªŒå‚æ•°çš„æ ‡å‡†ï¼Œå¯é€šè¿‡è‡ªå®šä¹‰æ³¨è§£æ ‡è®°AOPæ‹¦æˆªçš„åˆ‡å…¥ç‚¹ï¼Œè¯†åˆ«æ‹¦æˆªç‚¹ä¹‹åï¼Œå¯åœ¨æ–¹æ³•è°ƒç”¨å‰è¿›è¡Œè‡ªå®šä¹‰çš„å‚æ•°æ ¡éªŒé€»è¾‘ï¼›åœ¨é¡¹ç›®å†…å¯é€šè¿‡è‡ªå®šä¹‰æ³¨è§£å®ç°å‚æ•°çš„ç»Ÿä¸€éªŒè¯ï¼Œæœ‰åˆ©äºä»£ç çš„ç»´æŠ¤</p>2023-01-29</li><br/>
</ul>