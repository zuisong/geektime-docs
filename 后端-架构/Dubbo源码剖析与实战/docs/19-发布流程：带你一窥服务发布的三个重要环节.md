ä½ å¥½ï¼Œæˆ‘æ˜¯ä½•è¾‰ã€‚ä»Šå¤©æˆ‘ä»¬æ·±å…¥ç ”ç©¶Dubboæºç çš„ç¬¬å…«ç¯‡ï¼Œå‘å¸ƒæµç¨‹ã€‚

æåˆ°å‘å¸ƒï¼Œè¿˜è®°å¾—åœ¨â€œ[æ¸©æ•…çŸ¥æ–°](https://time.geekbang.org/column/article/611355)â€ä¸­å­¦è¿‡çš„é‚£å¼ Dubboæ€»ä½“æ¶æ„ç¤ºæ„å›¾ä¹ˆï¼š

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/ec/9c/ec0b894f582039838e7ce5d32d8bb99c.jpg?wh=1920x1136)

æˆ‘ä»¬å›é¡¾å’Œå‘å¸ƒæœ‰å…³çš„ç¯èŠ‚ï¼Œç¬¬ â‘  æ­¥ç¼–å†™æä¾›æ–¹çš„ XML é…ç½®æ–‡ä»¶ï¼ŒæœåŠ¡çš„å‘å¸ƒé¦–å…ˆéœ€è¦è¿›è¡Œä¸€ç³»åˆ—çš„é…ç½®ï¼Œé…ç½®å¥½åï¼Œå¯ä»¥é€šè¿‡ dubbo:service æ ‡ç­¾è¿›è¡ŒæœåŠ¡çš„å¯¼å‡ºä¸æ³¨å†Œï¼Œç„¶åï¼Œåœ¨ç¬¬ â‘¢ æ­¥ä¸­ï¼Œæä¾›æ–¹å¯ä»¥é€šè¿‡è®¾ç½® dubbo.application.register-mode å±æ€§æ¥è‡ªç”±æ§åˆ¶æœåŠ¡çš„æ³¨å†Œæ–¹å¼ã€‚

æ€»çš„æ¥è¯´ï¼Œå‘å¸ƒçš„å¤§è‡´æµç¨‹å°± 3 ä¸ªç¯èŠ‚â€œ**é…ç½® -&gt; å¯¼å‡º -&gt; æ³¨å†Œ**â€ï¼Œé‚£ä½ çŸ¥é“æ¯ä¸ªç¯èŠ‚çš„æœºåˆ¶ç©¶ç«Ÿæ˜¯ä»€ä¹ˆæ ·çš„ä¹ˆï¼Ÿæˆ‘ä»¬ä»Šå¤©å°±æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

æ€ä¹ˆæ¢ç´¢å‘¢ï¼Ÿåœ¨ç¼–å†™æä¾›æ–¹æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šç»™å³å°†å¯¼å‡ºçš„æœåŠ¡ä¸Šé¢æ·»åŠ ä¸€ä¸ª @DubboService æ³¨è§£ï¼Œé‚£æˆ‘ä»¬å°±ä»è¿™ä¸ªæ³¨è§£å¼€å§‹ï¼Œé¦–å…ˆé€†å‘æ‰¾åˆ° @DubboService ä¸­è¿™äº›é…ç½®å»å“ªé‡Œäº†ï¼Œç„¶ååœ¨é…ç½®è¢«ä½¿ç”¨çš„åœ°æ–¹ï¼Œå†çœ‹çœ‹èƒ½ä¸èƒ½å‘ç°å¯¼å‡ºæœåŠ¡çš„æ ¸å¿ƒä»£ç ï¼Œé¡ºç€å¯¼å‡ºé€»è¾‘ï¼Œæ¢ç©¶æœåŠ¡æ³¨å†Œçš„æ ¸å¿ƒåŸç†ã€‚

è¦ç‰¹åˆ«è¯´æ˜çš„æ˜¯ï¼Œä»Šå¤©å¤§éƒ¨åˆ†æ—¶é—´éƒ½ä¼šåœ¨è®²æºç ï¼Œå¯èƒ½ä¼šæ¯”è¾ƒæ¯ç‡¥ï¼Œä½†ä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘ä¼šå°½é‡è®²çš„ç®€å•æ˜“æ‡‚ï¼Œè€Œä¸”æºç çš„åˆ†ææµç¨‹ä½ æŒæ¡é€äº†ï¼Œä»¥ååˆ†æé—®é¢˜å’Œæ¡†æ¶æ‰©å±•ä¼šå¦‚æœ‰ç¥åŠ©ã€‚

## é…ç½®

æˆ‘ä»¬å¼€å§‹å§ï¼Œå…ˆæ¥ç®€å•çœ‹çœ‹æä¾›æ–¹çš„ä¸€æ®µä»£ç ã€‚

```java
///////////////////////////////////////////////////
// æä¾›æ–¹åº”ç”¨å·¥ç¨‹çš„å¯åŠ¨ç±»
///////////////////////////////////////////////////
// å¯åŠ¨Dubboæ¡†æ¶çš„æ³¨è§£
@EnableDubbo
// SpringBootåº”ç”¨çš„ä¸€é”®å¼å¯åŠ¨æ³¨è§£
@SpringBootApplication
public class Dubbo19DubboDeployProviderApplication {
    public static void main(String[] args) {
        // è°ƒç”¨æœ€ä¸ºæ™®é€šå¸¸è§çš„åº”ç”¨å¯åŠ¨API
        SpringApplication.run(Dubbo19DubboDeployProviderApplication.class, args);
        // å¯åŠ¨æˆåŠŸåæ‰“å°ä¸€æ¡æ—¥å¿—
        System.out.println("ã€ã€ã€ã€ã€ã€ Dubbo19DubboDeployProviderApplication ã€‘ã€‘ã€‘ã€‘ã€‘ã€‘å·²å¯åŠ¨.");
    }
}
///////////////////////////////////////////////////
// æä¾›æ–¹åº”ç”¨å·¥ç¨‹çš„å¯åŠ¨é…ç½®
///////////////////////////////////////////////////
@Configuration
public class DeployProviderConfig {
    // æä¾›è€…çš„åº”ç”¨æœåŠ¡åç§°
    @Bean
    public ApplicationConfig applicationConfig() {
        return new ApplicationConfig("dubbo-19-dubbo-deploy-provider");
    }
    // æ³¨å†Œä¸­å¿ƒçš„åœ°å€ï¼Œé€šè¿‡ address å¡«å†™çš„åœ°å€æä¾›æ–¹å°±å¯ä»¥è”ç³»ä¸Š zk æœåŠ¡
    @Bean
    public RegistryConfig registryConfig() {
        return new RegistryConfig("zookeeper://127.0.0.1:2181");
    }
    // æä¾›è€…éœ€è¦æš´éœ²æœåŠ¡çš„åè®®ï¼Œæä¾›è€…éœ€è¦æš´éœ²æœåŠ¡çš„ç«¯å£
    @Bean
    public ProtocolConfig protocolConfig(){
        return new ProtocolConfig("dubbo", 28190);
    }
}
///////////////////////////////////////////////////
// æä¾›æ–¹åº”ç”¨å·¥ç¨‹çš„ä¸€ä¸ªDemoFacadeæœåŠ¡
///////////////////////////////////////////////////
@Component
@DubboService(timeout = 8888)
public class DemoFacadeImpl implements DemoFacade {
    @Override
    public String sayHello(String name) {
        String result = String.format("Hello %s, I'm in 'dubbo-19-dubbo-deploy-provider.", name);
        System.out.println(result);
        return result;
    }
}
///////////////////////////////////////////////////
// èµ„æºç›®å½•æ–‡ä»¶
// è·¯å¾„ä¸ºï¼š/dubbo.properties
// åªè¿›è¡Œæ¥å£çº§åˆ«æ³¨å†Œ
///////////////////////////////////////////////////
dubbo.application.register-mode=interface
```

è¿™æ®µä»£ç éå¸¸æ™®é€šï¼Œåœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ  @EnableDubbo å’Œ @SpringBootApplication ä¸¤ä¸ªæ³¨è§£ã€‚æ¥ç€ï¼Œä¸ºæä¾›æ–¹å¯åŠ¨æ·»åŠ ä¸€ä¸ªå¯åŠ¨é…ç½®ç±»ï¼Œé…ç½®ç±»ä¸­è®¾ç½®å¥½åº”ç”¨æœåŠ¡åç§°ã€æ³¨å†Œä¸­å¿ƒåœ°å€ã€æš´éœ²åè®®ã€‚æœ€åï¼Œç¼–å†™ä¸€ä¸ªDemoFacadeæœåŠ¡ï¼Œåœ¨ dubbo.properties ä¸­è®¾ç½®æä¾›æ–¹ä½¿ç”¨æ¥å£è¿›è¡Œæ³¨å†Œã€‚

çœ‹å®Œä»£ç ï¼Œæˆ‘ä»¬æ­£å¼è¿›å…¥é€†å‘å¯»æ‰¾ç¯èŠ‚ã€‚

åœ¨â€œ[æ³›åŒ–è°ƒç”¨](https://time.geekbang.org/column/article/613308)â€ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ @DubboReference æ³¨è§£ï¼Œæ‰¾åˆ°äº†æ³›åŒ–è°ƒç”¨çš„æ ¸å¿ƒå…³é”®ç±»ï¼Œä»Šå¤©æˆ‘ä»¬æŒ‰ç…§åŒæ ·çš„é…æ–¹ï¼Œ**å…ˆçœ‹çœ‹ @DubboService æ³¨è§£ä¼šè¢«å“ªäº›è°ƒç”¨æ–¹ä½¿ç”¨ï¼Œç„¶åä»è¿™äº›è°ƒç”¨æ–¹çš„ç±»åä¸­æ‰¾åˆ°ä¸€ä¸ªå¤§æ¦‚ç‡ä¼šè¢«è°ƒç”¨çš„ç±»ï¼Œæœ€åæ·±æŒ–ä¸€ä¸‹ä»£ç ç»†èŠ‚ï¼Œçœ‹çœ‹èƒ½å‘ç°å“ªäº›å®è—ã€‚**

å¥½ï¼Œç¬¬ä¸€æ­¥ï¼ŒæŸ¥çœ‹ DubboService.classã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/ba/44/ba424f8a4c567ce2dyy3db634e4a4344.jpg?wh=4800x1401)

å¯ä»¥å‘ç°æºç ä¸­æœ‰ 3 ä¸ªè°ƒç”¨æ–¹ï¼Œä¸è¿‡ï¼Œæˆ‘ä»¬è¯¥ç»†çœ‹å“ªä¸ªå‘¢ï¼Ÿ

è¿™é‡Œæˆ‘æ•™ä½ ä¸€ä¸ªå°æŠ€å·§ï¼Œå‘ç°å¤šä¸ªè°ƒç”¨æ–¹æ—¶ï¼Œå¯ä»¥ä»è°ƒç”¨æ–¹å½’å±çš„ç±»åçœ‹ï¼Œå“ªä¸ªç±»åè·Ÿéœ€è¦å¯»æ‰¾çš„å†…å®¹å¯†åˆ‡ç›¸å…³ï¼Œæˆ‘ä»¬å°±è¿›å…¥å“ªä¸ªç»†çœ‹ã€‚

è¿™é‡Œï¼Œæˆ‘ä»¬è¦æ‰¾çš„æ˜¯æ³¨è§£è¢«ä½¿ç”¨çš„åœ°æ–¹ï¼Œè€Œè°ƒç”¨æ–¹â‘¡å¯¹åº”çš„ç±»åï¼Œæ­£å¥½å«æœ‰ Annotation æ³¨è§£è¿™ä¸ªå•è¯ï¼Œæˆ‘ä»¬å°±è¿›å…¥è°ƒç”¨æ–¹â‘¡çœ‹ä¸ªç©¶ç«Ÿã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/d4/e9/d472f99f45549206319cd0322e0b28e9.jpg?wh=4680x939)

å¯ä»¥å‘ç° @DubboService æ³¨è§£ï¼Œæ”¾åœ¨ä¸€ä¸ªå«åš serviceAnnotationTypes å˜é‡åçš„åˆ—è¡¨ä¸­ï¼Œä¸è¿‡ï¼Œå¥½åœ¨è¯¥å˜é‡æ˜¯è¢« private ç§æœ‰å±æ€§ä¿®é¥°çš„ï¼Œäºæ˜¯å°±ç»§ç»­æŸ¥è¿™ä¸ªå˜é‡ï¼Œå‘ç°å®ƒä¹Ÿè¢« 3 ä¸ªåœ°æ–¹è°ƒç”¨äº†ã€‚

é’ˆå¯¹è¿™ 3 ä¸ªè°ƒç”¨æ–¹çš„æ–¹æ³•åï¼Œæˆ‘ä»¬å¤§è‡´çœ‹ä¸‹ï¼Œ199 è¡Œè¢«ä¸€ä¸ªæ‰«ææœåŠ¡åˆ—è¡¨ï¼ˆscanServiceBeansï¼‰çš„æ–¹æ³•è°ƒç”¨ï¼Œ358 è¡Œè¢«ä¸€ä¸ªæŸ¥æ‰¾æœåŠ¡æ³¨è§£ï¼ˆfindServiceAnnotationï¼‰çš„æ–¹æ³•è°ƒç”¨ï¼Œ527 è¡Œè¢«ä¸€ä¸ªè·å–æœåŠ¡æ³¨è§£å±æ€§ï¼ˆgetServiceAnnotationAttributesï¼‰çš„æ–¹æ³•è°ƒç”¨ã€‚

ä» 3 ä¸ªæ–¹æ³•åçš„åŠŸèƒ½æ¥çœ‹ï¼Œæ‰«ææœåŠ¡åˆ—è¡¨çš„åŠŸèƒ½æ›´é‡è¦ï¼Œæˆ‘ä»¬æ·±å…¥æŸ¥çœ‹è¿™ä¸ªï¼Œæˆ‘å±•ç¤ºäº†å…³é”®æºç ã€‚

```java
// org.apache.dubbo.config.spring.beans.factory.annotation.ServiceAnnotationPostProcessor#scanServiceBeans
private void scanServiceBeans(Set<String> packagesToScan, BeanDefinitionRegistry registry) {
    // çœç•¥å…¶ä»–éƒ¨åˆ†ä»£ç ...
    
    // åˆ›å»ºä¸€ä¸ªæ‰«æå™¨æ¥æ‰«æ Dubbo è·¯å¾„ä¸‹çš„æ‰€æœ‰ Bean å®šä¹‰
    DubboClassPathBeanDefinitionScanner scanner =
            new DubboClassPathBeanDefinitionScanner(registry, environment, resourceLoader);
    // çœç•¥å…¶ä»–éƒ¨åˆ†ä»£ç ...
    for (String packageToScan : packagesToScan) {
        // çœç•¥å…¶ä»–éƒ¨åˆ†ä»£ç ...
        
        // æ‰«æç»™å®šçš„åŒ…åï¼Œå…¶å®ä¹Ÿå°±æ˜¯æ‰«æ com.hmilyylimh.cloud.deploy è·¯å¾„
        // æ‰«æé‚£äº›å±äº serviceAnnotationTypes æ³¨è§£ç±»å‹çš„ Bean å®šä¹‰
        scanner.scan(packageToScan);
        // Finds all BeanDefinitionHolders of @Service whether @ComponentScan scans or not.
        Set<BeanDefinitionHolder> beanDefinitionHolders =
                findServiceBeanDefinitionHolders(scanner, packageToScan, registry, beanNameGenerator);
        if (!CollectionUtils.isEmpty(beanDefinitionHolders)) {
            // çœç•¥å…¶ä»–éƒ¨åˆ†ä»£ç ...
            // å¤„ç†æ‰«æåˆ°çš„ Bean å®šä¹‰å¯¹è±¡é›†åˆ
            for (BeanDefinitionHolder beanDefinitionHolder : beanDefinitionHolders) {
                // å¤„ç†å•ä¸ª Bean å®šä¹‰å¯¹è±¡
                processScannedBeanDefinition(beanDefinitionHolder, registry, scanner);
                servicePackagesHolder.addScannedClass(beanDefinitionHolder.getBeanDefinition().getBeanClassName());
            }
        } else {
            // çœç•¥å…¶ä»–éƒ¨åˆ†ä»£ç ...
        }
        servicePackagesHolder.addScannedPackage(packageToScan);
    }
}
```

ä»æ‰«ææœåŠ¡åˆ—è¡¨çš„æ–¹æ³•ä¸­ï¼Œå¯ä»¥å‘ç° Dubbo æ¡†æ¶åœ¨æœåŠ¡æ³¨è§£è¿™ä¸ªåç½®å¤„ç†å™¨ï¼ˆServiceAnnotationPostProcessorï¼‰ä¸­ï¼Œåˆ©ç”¨æ‰«æå™¨ï¼ŒæŠŠå«æœ‰ @DubboService æ³¨è§£çš„ç±»å¯¹åº”çš„ Bean å®šä¹‰æ”¶é›†åˆ°äº†ä¸€å—ï¼Œç„¶åé€ä¸ªé’ˆå¯¹ Bean å®šä¹‰è¿›è¡Œäº†å¤„ç†ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ¨æ–­å‡ºä¸€å®šå¯¹ Bean å®šä¹‰åšäº†äº›äº‹æƒ…ï¼Œé‚£æˆ‘ä»¬å°±ç»§ç»­è¿›å…¥å¤„ç†æ‰«æåˆ°çš„ Bean å®šä¹‰æ–¹æ³•ã€‚

```java
// ServiceAnnotationPostProcessor#processScannedBeanDefinition
private void processScannedBeanDefinition(BeanDefinitionHolder beanDefinitionHolder, BeanDefinitionRegistry registry,
                                          DubboClassPathBeanDefinitionScanner scanner) {
    // ä» Bean å®šä¹‰ä¸­æ‰¾åˆ°å¯¹åº”çš„ Dubbo æ¥å£æœåŠ¡ç±»ä¿¡æ¯
    // å³ï¼šbeanClass = com.hmilyylimh.cloud.deploy.demo.DemoFacadeImpl ç±»ä¿¡æ¯
    Class<?> beanClass = resolveClass(beanDefinitionHolder);
    // ä» beanClass ä¸­æ‰¾åˆ°å«æœ‰ @DubboService æ³¨è§£çš„å¯¹è±¡
    // å‡†ç¡®æ¥è¯´ï¼Œåº”è¯¥æ˜¯æŸ¥æ‰¾ serviceAnnotationTypes åˆ—è¡¨ä¸­æœ‰å€¼çš„æ³¨è§£ï¼Œå–å‡ºæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ª
    Annotation service = findServiceAnnotation(beanClass);
    // ä»åˆšåˆšæ‰¾å‡ºçš„ service æ³¨è§£å¯¹è±¡ä¸­æœåˆ®å‡ºæ³¨è§£å±æ€§å€¼
    // @DubboService ä¸­é…ç½®çš„ timeout = 8888 å±æ€§å°±ä¼šå­˜åœ¨äº serviceAnnotationAttributes å˜é‡ä¸­
    Map<String, Object> serviceAnnotationAttributes = AnnotationUtils.getAttributes(service, true);
    
    // æ‰¾åˆ°å¯¹åº”çš„æœåŠ¡æ¥å£åç§°
    // å³ï¼šserviceInterface = com.hmilyylimh.cloud.facade.demo.DemoFacade
    String serviceInterface = resolveInterfaceName(serviceAnnotationAttributes, beanClass);
    // annotatedServiceBeanName = demoFacadeImpl
    String annotatedServiceBeanName = beanDefinitionHolder.getBeanName();
    
    // ç”Ÿæˆ ServiceBean çš„ beanName
    String beanName = generateServiceBeanName(serviceAnnotationAttributes, serviceInterface);
    // é‡æ–°æ ¹æ®ç›¸å…³å‚æ•°æ„å»ºå‡ºä¸€ä¸ªæ–°çš„ beanClass = ServiceBean.class ç±»å‹çš„ Bean å®šä¹‰
    AbstractBeanDefinition serviceBeanDefinition =
            buildServiceBeanDefinition(serviceAnnotationAttributes, serviceInterface, annotatedServiceBeanName);
    // ç„¶åå°†æ„å»ºå‡ºæ¥çš„ Bean å®šä¹‰æ³¨å†Œåˆ° Spring çš„å®¹å™¨ä¸­ï¼Œç­‰ç€åç»­çš„å®ä¾‹åŒ–æ“ä½œ
    registerServiceBeanDefinition(beanName, serviceBeanDefinition, serviceInterface);
}
```

åœ¨è¿™æ®µé€»è¾‘ä¸­ï¼Œæˆ‘ä»¬æœ‰äº†æ–°å‘ç°ï¼Œåœ¨å¤„ç† DemoFacadeImpl çš„ Bean å®šä¹‰æ—¶ï¼Œå°† DemoFacadeImpl ç±»ä¸Š @DubboService æ³¨è§£ä¸­çš„å±æ€§ã€æœåŠ¡æ¥å£åç§°æå–äº†å‡ºæ¥ï¼Œç„¶åæ„å»ºå‡ºäº†ä¸€ä¸ªå«åš ServiceBean ç±»å‹çš„ Bean å®šä¹‰ï¼Œå¹¶æ³¨å†Œåˆ°äº† Spring å®¹å™¨ä¸­ã€‚

å¦‚æœä½ å¯¹ Spring çš„ Bean å®šä¹‰æœ‰äº†è§£ï¼Œæƒ³å¿…ä¹Ÿæƒ³åˆ°äº†ï¼ŒDubbo å¤§æ¦‚æ˜¯åœ¨å¹²è¿™ä¹ˆä¸€ä»¶äº‹æƒ…ã€‚

- åˆ©ç”¨æ‰«æå™¨ï¼ŒæŠŠå«æœ‰ @DubboService æ³¨è§£çš„ç±»æ‰«æå‡ºæ¥ï¼Œå¾—åˆ°ä¸€å † Bean å®šä¹‰é›†åˆã€‚
- å¾ªç¯æ‰«æå‡ºæ¥çš„ Bean å®šä¹‰é›†åˆï¼Œåœ¨å¾ªç¯ä½“ä¸­ï¼Œä»å·²æ‰«æçš„ Bean å®šä¹‰ä¸­ï¼Œæå–æ³¨è§£å±æ€§å’ŒæœåŠ¡æ¥å£åï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„ ServiceBean ç±»å‹çš„ Bean å®šä¹‰ã€‚
- å°†æ¥ï¼Œè¿™ä¸ªæ–° Bean å®šä¹‰åœ¨å®ä¾‹åŒ–åè¢«ä½¿ç”¨æ—¶ï¼Œä¸€å®šä¼šè§¦å‘è°ƒç”¨ ServiceBean ç±»æˆ–çˆ¶ç±»ä¸­çš„ä¸€äº› public æ–¹æ³•ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/dc/12/dc11d8101e38eab4177925071427ec12.jpg?wh=1920x835)

è¿™ä¸ªçŒœæƒ³æ˜¯å¦æ­£ç¡®å‘¢ï¼Ÿæˆ‘ä»¬éªŒè¯ä¸€ä¸‹ã€‚

å†æ¬¡è¿›å…¥ ServiceBean æ–¹æ³•ï¼Œæ²¡å‘ç°å•¥å¼‚æ ·ï¼Œç„¶åè¿›å…¥çˆ¶ç±» ServiceConfig ï¼Œå‘ç°äº†ä¸€ä¸ªå«åš export å•è¯çš„å…¬å¼€æ–¹æ³•ï¼Œä»”ç»†ç§ç§ã€‚

```java
///////////////////////////////////////////////////
// ServiceConfig.exportÂ æœåŠ¡æ¥å£å¯¼å‡ºçš„æ–¹æ³•
///////////////////////////////////////////////////
public void export() {
    // å¦‚æœå·²å¯¼å‡ºçš„è¯ï¼Œåˆ™ä¸å†å¤„ç†å¯¼å‡ºé€»è¾‘
    if (this.exported) {
        return;
    }
    // çœç•¥å…¶ä»–éƒ¨åˆ†ä»£ç ...
    // synchronized ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå³åªå…è®¸å¯¼å‡ºæœ‰ä¸”ä»…æœ‰ä¸€æ¬¡
    synchronized (this) {
        // å†æ¬¡æ£€æµ‹ï¼Œå¦‚æœå·²å¯¼å‡ºçš„è¯ï¼Œåˆ™ä¸å†å¤„ç†å¯¼å‡ºé€»è¾‘
        if (this.exported) {
            return;
        }
        // Dubbo Config å±æ€§é‡å†™
        if (!this.isRefreshed()) {
            this.refresh();
        }
        if (this.shouldExport()) {
            this.init();
            // æ˜¯å¦æœ‰è®¾ç½®å»¶è¿Ÿ delay å¯¼å‡ºå±æ€§
            if (shouldDelay()) {
                doDelayExport();
            } else {
                // å¯¼å‡ºçš„æ ¸å¿ƒé€»è¾‘
                doExport();
            }
        }
    }
}
```

ä¸€çœ‹åˆ° export æ–¹æ³•ï¼Œç›¸ä¿¡ä½ å¯¹æ•´ä½“æµç¨‹çš„é…ç½®è½¬ç§»å·²ç»äº†ç„¶äºèƒ¸äº†ã€‚

æˆ‘ä»¬åœ¨æä¾›æ–¹ä»£ç ä¸­ç¼–å†™çš„ @DubboService æ³¨è§£ï¼Œç”¨æ¥æ ‡è¯† DemoFacadeImpl æ˜¯ä¸€ä¸ª Dubbo æ¥å£æœåŠ¡ï¼Œç„¶åï¼Œåœ¨ Spring æ‰«æ Bean å®šä¹‰ç¯èŠ‚ï¼Œè¢« Dubbo çš„æ‰«æå™¨è¯†åˆ«åˆ°äº†æ‹¥æœ‰ @DubboService æ³¨è§£çš„æ‰€æœ‰çš„ Bean å®šä¹‰ï¼Œå¹¶ä¸”ï¼Œå†æ¬¡åˆ›å»ºä¸€ä¸ªæ–°çš„ ServiceBean ç±»å‹çš„ Bean å®šä¹‰ã€‚

ä»æ­¤ï¼ŒDemoFacadeImpl ä¸­ @DubboService æ³¨è§£çš„æ‰€æœ‰é…ç½®ï¼Œå°±å…¨éƒ¨è½¬ç§»åˆ°äº† ServiceBean çš„ Bean å®šä¹‰ä¸­ï¼Œè€Œåœ¨æŸä¸ªç¯èŠ‚ï¼ŒServiceBean åˆä¼šè¢«è§¦å‘æ‰§è¡Œå¯¼å‡ºæ–¹æ³•ï¼Œå°±è¿™æ ·ï¼Œæˆ‘ä»¬ç¼–å†™çš„é…ç½®å°±ä¼šè·Ÿéšå¯¼å‡ºæ–¹æ³•èµ°åç»­é€»è¾‘äº†ã€‚

å¦‚æœä¸€è·¯çœ‹ä¸‹æ¥æœ‰ç‚¹å¤´æ™•ï¼Œä¹Ÿæ²¡å…³ç³»ï¼Œæˆ‘æ€»ç»“äº†ä¸€ä¸‹é€†å‘æ’æŸ¥çš„æŸ¥æ‰¾æµç¨‹ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/d7/59/d714cb00d10eyyb9674d8e8243623d59.jpg?wh=1920x1213)

## å¯¼å‡º

ç°åœ¨ï¼Œä½ åº”è¯¥çŸ¥é“ @DubboService æ³¨è§£ä¸­çš„é…ç½®æ€ä¹ˆå«æ¥åˆ°äº† ServiceBean ä¸Šäº†å§ï¼Œç¬¬ä¸€æ­¥â€œé…ç½®â€ç¯èŠ‚çš„æºç æˆ‘ä»¬å°±å­¦å¥½äº†ï¼Œæ¥ä¸‹æ¥çœ‹ç¬¬äºŒæ­¥â€œå¯¼å‡ºâ€ï¼Œèµ°è¿› doExport æ ¸å¿ƒå¯¼å‡ºé€»è¾‘çš„å¤§é—¨ã€‚

çœ‹ä¹‹å‰ï¼Œæˆ‘å†æ•™ç»™ä½ ä¸€ä¸ªå°æŠ€å·§ï¼Œåƒè¿™ç§ä»¥ do å•è¯å¼€å¤´çš„æ–¹æ³•åï¼Œä¸€èˆ¬æ˜¯è¿™ä¸ªåŠŸèƒ½çš„æ ¸å¿ƒå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œæ‰€ä»¥ï¼Œå½“ä½ çœ‹åˆ° export ååˆç´§æ¥ç€ doExportï¼Œå¯ä»¥æ¯«ä¸çŠ¹è±«åœ°è¿›å…¥ doExport æ–¹æ³•ä¸­ç»†çœ‹ã€‚

å¥½ï¼Œæˆ‘ä»¬è¿›å…¥ doExport çœ‹çœ‹å§ã€‚

```java
// å•ä¸ªæ¥å£æœåŠ¡çš„å¯¼å‡ºæ–¹æ³•ï¼Œæ¯”å¦‚ DemoFacadeImpl æœåŠ¡çš„å¯¼å‡ºï¼Œå°±ä¼šè¿›å…¥åˆ°è¿™é‡Œæ¥
org.apache.dubbo.config.ServiceConfig#doExport
                  â†“
// å› ä¸ºå­˜åœ¨å¤šåè®®çš„ç¼˜æ•…ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¼šå°†å•ä¸ªæ¥å£æœåŠ¡æŒ‰ç…§ä¸åŒçš„åè®®è¿›è¡Œå¯¼å‡º
org.apache.dubbo.config.ServiceConfig#doExportUrls
                  â†“
// å°†å•ä¸ªæ¥å£æœåŠ¡æŒ‰ç…§å•ä¸ªåè®®è¿›è¡Œå¯¼å‡º
// å…¶å®æ˜¯ doExportUrls æ–¹æ³•ä¸­å¾ªç¯è°ƒç”¨äº† doExportUrlsFor1Protocol æ–¹æ³•
org.apache.dubbo.config.ServiceConfig#doExportUrlsFor1Protocol
                  â†“
// å°†å•ä¸ªæ¥å£æœåŠ¡æŒ‰ç…§å•åè®®å¯¼å‡ºåˆ°å¤šä¸ªæ³¨å†Œä¸­å¿ƒä¸Š
org.apache.dubbo.config.ServiceConfig#exportUrl
// exportUrl æ–¹æ³•çš„å®ç°ä½“é€»è¾‘å¦‚ä¸‹ï¼š
private void exportUrl(URL url, List<URL> registryURLs) {
    String scope = url.getParameter("scope");
    // don't export when none is configured
    if (!"none".equalsIgnoreCase(scope)) {
        // export to local if the config is not remote (export to remote only when config is remote)
        if (!"remote".equalsIgnoreCase(scope)) {
            // æœ¬åœ°å¯¼å‡º
            exportLocal(url);
        }
        // export to remote if the config is not local (export to local only when config is local)
        if (!"local".equalsIgnoreCase(scope)) {
            // è¿œç¨‹å¯¼å‡º
            url = exportRemote(url, registryURLs);
            if (!isGeneric(generic) && !getScopeModel().isInternal()) {
                MetadataUtils.publishServiceDefinition(url, providerModel.getServiceModel(), getApplicationModel());
            }
        }
    }
    this.urls.add(url);
}
```

ä»æ ¸å¿ƒçš„å¯¼å‡ºé€»è¾‘ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡é…ç½® url çš„ scope å±æ€§æ¥æ§åˆ¶æœ¬åœ°å¯¼å‡ºå’Œè¿œç¨‹å¯¼å‡ºï¼Œé…ç½®æ–¹å¼ä¸»è¦æœ‰ 3 ç§æ–¹å¼ã€‚

- æ–¹å¼ä¸€ï¼šscope å±æ€§å€¼ä»€ä¹ˆä¹Ÿä¸é…ç½®ï¼Œæ—¢ä¼šè¿›è¡Œæœ¬åœ°å¯¼å‡ºï¼Œä¹Ÿä¼šè¿›è¡Œè¿œç¨‹å¯¼å‡ºã€‚
- æ–¹å¼äºŒï¼šscope é…ç½®ä¸º localï¼Œåªä¼šè¿›è¡Œæœ¬åœ°å¯¼å‡ºï¼Œä¸ä¼šè¿›è¡Œè¿œç¨‹å¯¼å‡ºã€‚
- æ–¹å¼ä¸‰ï¼šscope é…ç½®ä¸º remoteï¼Œåªä¼šè¿›è¡Œè¿œç¨‹å¯¼å‡ºï¼Œä¸ä¼šè¿›è¡Œæœ¬åœ°å¯¼å‡ºã€‚

è¿™ä¸‰ç§æ–¹å¼ä¸­ï¼Œæœ€ç»ˆè½åœ°çš„è¿˜æ˜¯ exportLocal å’Œ exportRemote ä¸¤ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°±ä»”ç»†ç ”ç©¶ä¸€ä¸‹ã€‚

## 1. exportLocal æœ¬åœ°å¯¼å‡º

å…ˆè¿›å…¥ exportLocal æ–¹æ³•çœ‹çœ‹ã€‚

```java
///////////////////////////////////////////////////
// org.apache.dubbo.config.ServiceConfig#exportLocal
// æœ¬åœ°å¯¼å‡º
///////////////////////////////////////////////////
private void exportLocal(URL url) {
    // å…ˆçœ‹çœ‹ url çš„å†…å­˜å€¼æ˜¯å•¥æ ·çš„ï¼šdubbo://192.168.100.183:28190/com.hmilyylimh.cloud.facade.demo.DemoFacade?anyhost=true&application=dubbo-19-dubbo-deploy-provider&background=false&bind.ip=192.168.100.183&bind.port=28190&deprecated=false&dubbo=2.0.2&dynamic=true&generic=false&interface=com.hmilyylimh.cloud.facade.demo.DemoFacade&methods=sayHello,say&pid=15092&qos.enable=false&register-mode=interface&release=3.0.7&side=provider&timeout=8888&timestamp=1670674553481
    // åœ¨è¿™é‡Œå°† url çš„ protocol å±æ€§å€¼æ›¿æ¢ä¸ºäº† injvm å€¼
    // ç„¶åå°† url çš„ host å±æ€§å€¼æ›¿æ¢ä¸ºäº† 127.0.0.1
    URL local = URLBuilder.from(url)
            .setProtocol("injvm")
            .setHost("127.0.0.1")
            .setPort(0)
            .build();
    local = local.setScopeModel(getScopeModel())
        .setServiceModel(providerModel);
    // exportLocal çš„æ ¸å¿ƒæ–¹æ³•ï¼Œè¿™é‡Œä¹Ÿç»™ä½ é¡ºä¾¿æ‰“å°äº†ä¸€ä¸‹ local çš„å±æ€§å€¼ï¼š
    // local = injvm://127.0.0.1/com.hmilyylimh.cloud.facade.demo.DemoFacade?anyhost=true&application=dubbo-19-dubbo-deploy-provider&background=false&bind.ip=192.168.100.183&bind.port=28190&deprecated=false&dubbo=2.0.2&dynamic=true&generic=false&interface=com.hmilyylimh.cloud.facade.demo.DemoFacade&methods=sayHello,say&pid=15092&qos.enable=false&register-mode=interface&release=3.0.7&side=provider&timeout=8888&timestamp=1670674553481
    doExportUrl(local, false);
    logger.info("Export dubbo service " + interfaceClass.getName() + " to local registry url : " + local);
}
                  â†“
///////////////////////////////////////////////////                  
// org.apache.dubbo.config.ServiceConfig#doExportUrl
// é€šç”¨æ–¹æ³•ï¼Œæ ¹æ®ç»™å®šçš„å…¥å‚ url è¿›è¡ŒæœåŠ¡å¯¼å‡º
///////////////////////////////////////////////////
private void doExportUrl(URL url, boolean withMetaData) {
    // url å¯¹åº”çš„å†…å­˜å€¼ä¸ºï¼šinjvm://127.0.0.1/com.hmilyylimh.cloud.facade.demo.DemoFacade?anyhost=true&application=dubbo-19-dubbo-deploy-provider&background=false&bind.ip=192.168.100.183&bind.port=28190&deprecated=false&dubbo=2.0.2&dynamic=true&generic=false&interface=com.hmilyylimh.cloud.facade.demo.DemoFacade&methods=sayHello,say&pid=15092&qos.enable=false&register-mode=interface&release=3.0.7&side=provider&timeout=8888&timestamp=1670674553481
    // proxyFactory ä¸ºä»£ç†è‡ªé€‚åº”æ‰©å±•ç‚¹
    // è·å–ç»è¿‡ AbstractProxyInvoker åŒ…è£…è¿‡çš„ Wrapper åŠ¨æ€ä»£ç†ç±»
    // å³ invoker æ˜¯ AbstractProxyInvoker ç±»å‹çš„ï¼Œ
    // ç„¶å AbstractProxyInvoker ä¸­æŒæœ‰äº† Wrapper åŠ¨æ€ä»£ç†ç±»
    Invoker<?> invoker = proxyFactory.getInvoker(ref, (Class) interfaceClass, url);
    if (withMetaData) {
        invoker = new DelegateProviderMetaDataInvoker(invoker, this);
    }
    // protocolSPI ä¸ºåè®®è‡ªå®šä¹‰æ‰©å±•ç‚¹
    // å°† invoker æŒ‰ç…§æŒ‡å®šçš„åè®®è¿›è¡Œå¯¼å‡º
    Exporter<?> exporter = protocolSPI.export(invoker);
    exporters.add(exporter);
}
```

ä¸éš¾å‘ç°è¿™é‡Œå·æ¢æ¢æŸ±äº†ï¼Œä¸€è¿›å…¥æœ¬åœ°å¯¼å‡ºçš„æ–¹æ³•ï¼Œå°±å°†åè®®æ›¿æ¢ä¸ºäº† injvm åè®®ï¼Œæ„æ€æ˜¯ï¼ŒæŒ‰ç…§å†…ç½®çš„ JVM å†…å­˜çº§åˆ«çš„åè®®ä¹Ÿå¯¼å‡ºä¸€ä¸‹ï¼Œæœ€ç»ˆè°ƒç”¨äº†æ ¹æ® url è¿›è¡ŒæœåŠ¡å¯¼å‡ºçš„æ ¸å¿ƒæ–¹æ³•ï¼ˆdoExportUrlï¼‰ã€‚

doExportUrlè¿™ä¸ªæ–¹æ³•ï¼Œåªæœ‰ä¸¤è¡Œç®€çŸ­çš„ä»£ç è°ƒç”¨ï¼Œä¸€è¡Œæ˜¯è·å–ä»£ç†å¯¹è±¡ï¼ˆproxyFactory.getInvokerï¼‰ï¼Œä¸€è¡Œæ˜¯åè®®å¯¼å‡ºä»£ç†å¯¹è±¡ï¼ˆprotocolSPI.exportï¼‰ã€‚

ä½ å¯åˆ«å°çœ‹è¿™ä¸¤è¡Œä»£ç ï¼Œæ­£æ˜¯è¿™ä¸¤è¡Œç®€çŸ­çš„ä»£ç ï¼Œå®Œæˆäº†çœ‹ä¼¼ç®€å•å®åˆ™æå…¶å¤æ‚çš„å¯¼å‡ºé€»è¾‘ï¼Œå€¼å¾—æˆ‘ä»¬ä»”ç»†ç ”ç©¶ã€‚

### proxyFactory.getInvoker

æˆ‘ä»¬å…ˆçœ‹çœ‹ç¬¬ä¸€è¡Œï¼Œè·å–ä»£ç†å¯¹è±¡çš„é€»è¾‘ã€‚

æ ¹æ®â€œ[Adaptive é€‚é…](https://time.geekbang.org/column/article/620941)â€ä¸­æŒæ¡çš„æŠ€èƒ½ï¼Œæ—¢ç„¶é€šè¿‡ proxyFactory å˜é‡è°ƒç”¨ getInvoker æ–¹æ³•ï¼Œé‚£æˆ‘ä»¬è‡ªç„¶å°±ä¼šæƒ³ï¼Œåˆ°åº•è°ƒç”¨å“ªä¸ªå®ç°ç±»ã€‚

- ç¬¬ä¸€æ­¥ï¼ŒæŸ¥çœ‹ getInvoker æ–¹æ³•æœ‰æ²¡æœ‰ @Adaptive æ³¨è§£ï¼Œç„¶åçœ‹æ³¨è§£ä¸­æœ‰æ²¡æœ‰å€¼ã€‚
- ç¬¬äºŒæ­¥ï¼Œå†æŸ¥çœ‹ ProxyFactory æ¥å£æœ‰æ²¡æœ‰ç›´æ¥è¢« @Adaptive ä¿®é¥°çš„å®ç°ç±»ã€‚
- ç¬¬ä¸‰æ­¥ï¼Œæœ€åæŸ¥çœ‹ ProxyFactory æ¥å£æœ‰æ²¡æœ‰åŒ…è£…ç±»ã€‚

æ ¹æ®ç¬¬ä¸€æ­¥æŒ‡ç¤ºï¼Œæˆ‘ä»¬ç›´æ¥è¿›å…¥ getInvoker æ–¹æ³•ä¸­ã€‚

```java
@Adaptive({"proxy"})
<T> Invoker<T> getInvoker(T proxy, Class<T> type, URL url) throws RpcException;
```

å‘ç°ç¡®å®æœ‰æ–¹æ³•å±‚é¢çš„ @Adaptive æ³¨è§£ï¼Œå¹¶ä¸”è¯¥æ³¨è§£ä¸­æœ‰ä¸ª proxy å±æ€§ï¼Œè¯´æ˜éœ€è¦ä» url ä¸­å–å‡º proxy å¯¹åº”å€¼ã€‚

æˆ‘ä»¬ä»ä¸Šé¢çš„æ³¨é‡Šä¸­å‘ç°ï¼ŒdoExportUrl çš„å…¥å‚ url ä¸­ç¡®å®æ²¡æœ‰ proxy å±æ€§ï¼Œé‚£å°±æœ‰å¿…è¦å†çœ‹çœ‹ ProxyFactory æ¥å£ï¼Œé»˜è®¤è®¾ç½®çš„æ‰©å±•ç‚¹åç§°æ˜¯ä»€ä¹ˆï¼š

```java
@SPI(value = "javassist", scope = FRAMEWORK)
public interface ProxyFactory { ... ï½
```

ä» ProxyFactory æ¥å£çš„ @SPI æ³¨è§£ä¸­ï¼Œçœ‹åˆ°äº†é»˜è®¤çš„ javassist å±æ€§å€¼ï¼Œå› æ­¤ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬è‡³å°‘å¯ä»¥æ˜ç¡®è¦æ‰¾çš„æ ¸å¿ƒå®ç°ç±»æ˜¯ JavassistProxyFactory å®ç°ç±»ã€‚  
æ ¹æ®ç¬¬äºŒæ­¥æŒ‡ç¤ºï¼Œæˆ‘ä»¬ä» ProxyFactory æ¥å£çš„æ‰€æœ‰å®ç°ç±»ä¸­ï¼Œç¡®å®æ²¡æœ‰æ‰¾åˆ°å«æœ‰ @Adaptive æ³¨è§£çš„å®ç°ç±»ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/5c/fe/5caf97162dd2b158f973af7be06345fe.jpg?wh=5115x1407)

é‚£å°±çœ‹ç¬¬ä¸‰æ­¥æŒ‡ç¤ºï¼Œå‘ç°æœ‰åŒ…è£…ç±»ï¼Œè€Œä¸”è¿˜ç¡®è®¤åŒ…è£…ç±»åœ¨ SPI æ–‡ä»¶ä¸­å­˜åœ¨ï¼Œè¯´æ˜åŒ…è£…ç±»æ˜¯ç”Ÿæ•ˆçš„ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/17/e4/1746e4870d25bcf9e4eb8f8a2bd9cfe4.jpg?wh=1920x534)

åˆ†æä¸‹æ¥åï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡º proxyFactory.getInvoker æ–¹æ³•æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š

- é¦–å…ˆï¼Œå…ˆæ‰§è¡Œ ProxyFactory æ¥å£çš„è‡ªé€‚åº”æ‰©å±•ç‚¹ä»£ç†ç±»ï¼ˆProxyFactory$Adaptiveï¼‰çš„ getInvoker æ–¹æ³•ã€‚
- ç„¶åï¼Œæ‰§è¡ŒåŒ…è£…ç±»ï¼ˆStubProxyFactoryWrapperï¼‰çš„ getInvoker æ–¹æ³•ã€‚
- æœ€åï¼Œæ‰§è¡Œ JavassistProxyFactory å®ç°ç±»çš„ getInvoker æ–¹æ³•ã€‚

å…³é”®çš„æ—¶åˆ»æ¥äº†ï¼Œè¿›å…¥ JavassistProxyFactory å®ç°ç±»çš„ getInvoker æ–¹æ³•ä¸­ä¸€çœ‹ã€‚

```java
///////////////////////////////////////////////////
// JavassistProxyFactory#getInvoker å°†å…¥å‚å¯¹è±¡åŒ…è£…ä¸ºä¸€ä¸ªä»£ç†å¯¹è±¡è¿”å›
///////////////////////////////////////////////////
@Override
public <T> Invoker<T> getInvoker(T proxy, Class<T> type, URL url) {
    try {
        // TODO Wrapper cannot handle this scenario correctly: the classname contains '$'
        // ç”Ÿæˆ Wrapper ä»£ç†ç±»
        final Wrapper wrapper = Wrapper.getWrapper(proxy.getClass().getName().indexOf('$') < 0 ? proxy.getClass() : type);
        // ä½¿ç”¨ AbstractProxyInvoker å†…éƒ¨ç±»æ¥å°è£…å¯¹ wrapper ä»£ç†ç±»çš„è°ƒç”¨
        return new AbstractProxyInvoker<T>(proxy, type, url) {
            @Override
            protected Object doInvoke(T proxy, String methodName,
                                      Class<?>[] parameterTypes,
                                      Object[] arguments) throws Throwable {
                // ä¸Šå±‚è‹¥å¯¹ Invoker çš„è°ƒç”¨çš„è¯
                // é‚£ä¹ˆæœ€ç»ˆä¼šé€šè¿‡ wrapper å†…éƒ¨çš„ if...else æ‰¾åˆ°è¢«ä»£ç†ç±»è¿›è¡Œå¼ºè½¬è°ƒç”¨
                return wrapper.invokeMethod(proxy, methodName, parameterTypes, arguments);
            }
        };
    } catch (Throwable fromJavassist) {
        // try fall back to JDK proxy factory
        // è¿™é‡Œè¿›è¡Œäº†é™çº§å¤„ç†ï¼Œè‹¥å‘ç° Wrapper ç”Ÿæˆä»£ç†å‡ºç°äº†æœªçŸ¥å¼‚å¸¸çš„è¯ï¼Œ
        // é‚£ä¹ˆå°±é™çº§ä¸ºé€šè¿‡ JDK ç”Ÿæˆä»£ç†
        try {
            Invoker<T> invoker = jdkProxyFactory.getInvoker(proxy, type, url);
            logger.error("Failed to generate invoker by Javassist failed. Fallback to use JDK proxy success. " +
                "Interfaces: " + type, fromJavassist);
            // log out error
            return invoker;
        } catch (Throwable fromJdk) {
            logger.error("Failed to generate invoker by Javassist failed. Fallback to use JDK proxy is also failed. " +
                "Interfaces: " + type + " Javassist Error.", fromJavassist);
            logger.error("Failed to generate invoker by Javassist failed. Fallback to use JDK proxy is also failed. " +
                "Interfaces: " + type + " JDK Error.", fromJdk);
            throw fromJavassist;
        }
    }
}
```

è¿™æ®µä»£ç å±…ç„¶å¦‚æ­¤ç†Ÿæ‚‰ï¼Œæˆ‘ä»¬åœ¨â€œ[Wrapper æœºåˆ¶](https://time.geekbang.org/column/article/620918)â€ä¸­å°±ç ”ç©¶è¿‡è¿™æ®µæºç ï¼Œæ‰€è°“ç”Ÿæˆçš„ Invoker å¯¹è±¡ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ª AbstractProxyInvoker çš„å†…éƒ¨ç±»ï¼Œåªä¸è¿‡ï¼Œè¿™ä¸ªå†…éƒ¨ç±»æŒæœ‰ Wrapper ä»£ç†ç±»çš„å¼•ç”¨ï¼Œæ–¹ä¾¿åç»­æ¥æ”¶è¯·æ±‚å¤„ç†ã€‚

### protocolSPI.export

åœ¨æœ‰äº† getInvoker çš„æºç åˆ†æç»éªŒï¼Œæƒ³å¿…å†åˆ†æ protocolSPI çš„ export æ–¹æ³•ï¼Œå°±ä¸æ˜¯ä»€ä¹ˆéš¾äº‹äº†ï¼Œè¿™é‡Œæˆ‘ä¹Ÿæ€»ç»“äº†æ€è·¯ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/73/87/73658a890391cfd44a21d1d68c28bb87.jpg?wh=1920x1200)

å¯ä»¥çœ‹åˆ°ï¼Œç»è¿‡äº†å››ä¸ªåŒ…è£…ç±»ï¼Œé‚£ä¹ˆï¼Œè°ƒç”¨åè®®çš„ export æ–¹æ³•ä¼šç»å†å±‚å±‚åˆ‡é¢æ‹¦æˆªå¤„ç†ï¼Œæœ€åæ‰æµè½¬åˆ° InjvmProtocol ä¸­ã€‚

```java
///////////////////////////////////////////////////
// org.apache.dubbo.rpc.protocol.injvm.InjvmProtocol#export
// InjvmProtocol ç±»ä¸­çš„ export çš„å¯¼å‡ºæ ¸å¿ƒé€»è¾‘ï¼Œ
// å…¶å®å°±æ˜¯å°†å…¥å‚çš„ invoker å¯¹è±¡å°è£…åˆ° exporterMap ä¸­è€Œå·²
///////////////////////////////////////////////////
@Override
public <T> Exporter<T> export(Invoker<T> invoker) throws RpcException {
    return new InjvmExporter<T>(invoker, invoker.getUrl().getServiceKey(), exporterMap);
}
                  â†“
///////////////////////////////////////////////////                  
// org.apache.dubbo.rpc.protocol.injvm.InjvmExporter#InjvmExporter
// injvm åè®®å¯¹åº”çš„å¯¼å‡ºå¯¹è±¡
///////////////////////////////////////////////////
public class InjvmExporter<T> extends AbstractExporter<T> {
    private final String key;
    private final Map<String, Exporter<?>> exporterMap;
    InjvmExporter(Invoker<T> invoker, String key, Map<String, Exporter<?>> exporterMap) {
        super(invoker);
        this.key = key;
        this.exporterMap = exporterMap;
        // å­˜å‚¨åˆ°ä¸€ä¸ª exporterMap é›†åˆä¸­
        exporterMap.put(key, this);
    }
    // çœç•¥å…¶ä»–éƒ¨åˆ†é€»è¾‘...
}
```

é˜…è¯» InjvmProtocol çš„ export æ–¹æ³•åï¼Œå‘ç°åŸæ¥æœ¬åœ°å¯¼å‡ºå¦‚æ­¤ç®€å•ï¼Œ**æ ¸å¿ƒåŸç†å°±æ˜¯ï¼Œå°†ç”Ÿæˆçš„ Invoker ä»£ç†ç±»ç¼“å­˜åˆ°äº† InjvmProtocol ä¸­çš„ exporterMap æˆå‘˜å˜é‡ä¸­ã€‚**

## 2. exportRemote è¿œç¨‹å¯¼å‡º

æœ‰äº†æœ¬åœ°å¯¼å‡ºçš„åˆ†æç»éªŒï¼Œæˆ‘ä»¬å†æ¥çœ‹è¿œç¨‹å¯¼å‡ºå°±è½»æ¾å¾ˆå¤šã€‚

è¯ä¸å¤šè¯´ï¼Œç›´æ¥è¿›å…¥ exportRemote æ–¹æ³•çœ‹çœ‹ã€‚

```java
///////////////////////////////////////////////////
// org.apache.dubbo.config.ServiceConfig#exportRemote
// è¿œç¨‹å¯¼å‡ºçš„é€»è¾‘
///////////////////////////////////////////////////
private URL exportRemote(URL url, List<URL> registryURLs) {
    // è‹¥æ³¨å†Œä¸­å¿ƒåœ°å€é›†åˆä¸ä¸ºç©ºï¼Œåˆ™è¿›è¡Œ for å¾ªç¯å¤„ç†
    if (CollectionUtils.isNotEmpty(registryURLs)) {
        // å¼€å§‹å¾ªç¯æ¯ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒåœ°å€
        for (URL registryURL : registryURLs) {
            // service-discovery-registry ä¸ºäº†å°†æœåŠ¡çš„æ¥å£ç›¸å…³ä¿¡æ¯å­˜å‚¨åœ¨å†…å­˜ä¸­
            if ("service-discovery-registry".equals(registryURL.getProtocol())) {
                url = url.addParameterIfAbsent("service-name-mapping", "true");
            }
            //if protocol is only injvm ,not register
            // å¦‚æœå‘ç°æ³¨å†Œä¸­å¿ƒåœ°å€æ˜¯å†™ç€ injvm åè®®çš„è¯ï¼Œåˆ™è·³è¿‡ä¸åšä»»ä½•å¯¼å‡ºå¤„ç†
            if ("injvm".equalsIgnoreCase(url.getProtocol())) {
                continue;
            }
            // dynamic = true å°±ä¼šåœ¨æ³¨å†Œä¸­å¿ƒåˆ›å»ºä¸´æ—¶èŠ‚ç‚¹
            // dynamic = false å°±ä¼šåœ¨æ³¨å†Œä¸­å¿ƒåˆ›å»ºæ°¸ä¹…èŠ‚ç‚¹ï¼Œè‹¥æœåŠ¡å™¨å®•æœºçš„è¯ï¼Œéœ€è¦äººå·¥æ‰‹åŠ¨åˆ é™¤æ³¨å†Œä¸­å¿ƒä¸Šçš„æä¾›æ–¹ IP èŠ‚ç‚¹
            url = url.addParameterIfAbsent("dynamic", registryURL.getParameter("dynamic"));
            // ç›‘æ§ä¸­å¿ƒçš„åœ°å€ï¼Œå¦‚æœé…ç½®äº†çš„è¯ï¼ŒæœåŠ¡è°ƒç”¨ä¿¡æ¯å°±ä¼šä¸ŠæŠ¥
            URL monitorUrl = ConfigValidationUtils.loadMonitor(this, registryURL);
            if (monitorUrl != null) {
                url = url.putAttribute("monitor", monitorUrl);
            }
            // For providers, this is used to enable custom proxy to generate invoker
            // åœ¨æä¾›æ–¹ï¼Œè¿™é‡Œæ”¯æŒè‡ªå®šä¹‰æ¥ç”Ÿæˆä»£ç†
            String proxy = url.getParameter("proxy");
            if (StringUtils.isNotEmpty(proxy)) {
                registryURL = registryURL.addParameter("proxy", proxy);
            }
            // æœ‰æ³¨å†Œä¸­å¿ƒçš„é€»è¾‘ï¼šè¿œç¨‹å¯¼å‡ºçš„æ ¸å¿ƒé€»è¾‘
            // urlï¼šdubbo://192.168.100.183:28190/com.hmilyylimh.cloud.facade.demo.DemoFacade?anyhost=true&application=dubbo-19-dubbo-deploy-provider&background=false&bind.ip=192.168.100.183&bind.port=28190&deprecated=false&dubbo=2.0.2&dynamic=true&generic=false&interface=com.hmilyylimh.cloud.facade.demo.DemoFacade&methods=sayHello,say&pid=9636&qos.enable=false&register-mode=interface&release=3.0.7&side=provider&timeout=8888&timestamp=1670679510821
            // registryURLï¼šregistry://127.0.0.1:2181/org.apache.dubbo.registry.RegistryService?REGISTRY_CLUSTER=registryConfig&application=dubbo-19-dubbo-deploy-provider&dubbo=2.0.2&pid=9636&qos.enable=false&register-mode=interface&registry=zookeeper&release=3.0.7&timestamp=1670679510811
            doExportUrl(registryURL.putAttribute("export", url), true);
        }
    } else {
        // çœç•¥å…¶ä»–éƒ¨åˆ†é€»è¾‘...
        // æ— æ³¨å†Œä¸­å¿ƒçš„é€»è¾‘ï¼šè¿œç¨‹å¯¼å‡ºçš„æ ¸å¿ƒé€»è¾‘
        doExportUrl(url, true);
    }

    return url;
}
                  â†“
///////////////////////////////////////////////////                  
// org.apache.dubbo.config.ServiceConfig#doExportUrl
// é€šç”¨æ–¹æ³•ï¼Œæ ¹æ®ç»™å®šçš„å…¥å‚ url è¿›è¡ŒæœåŠ¡å¯¼å‡º
///////////////////////////////////////////////////
private void doExportUrl(URL url, boolean withMetaData) {
    // url å¯¹åº”çš„å†…å­˜å€¼ä¸ºï¼šinjvm://127.0.0.1/com.hmilyylimh.cloud.facade.demo.DemoFacade?anyhost=true&application=dubbo-19-dubbo-deploy-provider&background=false&bind.ip=192.168.100.183&bind.port=28190&deprecated=false&dubbo=2.0.2&dynamic=true&generic=false&interface=com.hmilyylimh.cloud.facade.demo.DemoFacade&methods=sayHello,say&pid=15092&qos.enable=false&register-mode=interface&release=3.0.7&side=provider&timeout=8888&timestamp=1670674553481
    // proxyFactory ä¸ºä»£ç†è‡ªé€‚åº”æ‰©å±•ç‚¹
    // è·å–ç»è¿‡ AbstractProxyInvoker åŒ…è£…è¿‡çš„ Wrapper åŠ¨æ€ä»£ç†ç±»
    // å³ invoker æ˜¯ AbstractProxyInvoker ç±»å‹çš„ï¼Œ
    // ç„¶å AbstractProxyInvoker ä¸­æŒæœ‰äº† Wrapper åŠ¨æ€ä»£ç†ç±»
    Invoker<?> invoker = proxyFactory.getInvoker(ref, (Class) interfaceClass, url);
    if (withMetaData) {
        invoker = new DelegateProviderMetaDataInvoker(invoker, this);
    }
    // protocolSPI ä¸ºåè®®è‡ªå®šä¹‰æ‰©å±•ç‚¹
    // å°† invoker æŒ‰ç…§æŒ‡å®šçš„åè®®è¿›è¡Œå¯¼å‡º
    Exporter<?> exporter = protocolSPI.export(invoker);
    exporters.add(exporter);
}
```

å¤§è‡´é€šè¯»ä¸€ç•ª exportRemote æ–¹æ³•åï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡º 3 ç‚¹ã€‚

- ç¬¬ä¸€ï¼Œæ˜¯å¦æœ‰ registryURL æ³¨å†Œä¸­å¿ƒåœ°å€ï¼Œä¼šè®©å¯¼å‡ºçš„é€»è¾‘ä¸å¤ªä¸€æ ·ã€‚æœ‰ registryURLï¼Œåˆ™ç”¨ registryURL ä¼ å…¥åˆ° doExportUrl æ–¹æ³•ï¼Œæ—  registryURLï¼Œåˆ™ç”¨æ¥å£æœåŠ¡çš„åœ°å€ä¼ å…¥åˆ° doExportUrl æ–¹æ³•ã€‚
- ç¬¬äºŒï¼Œä½¿ç”¨ registryURL ä¼ å…¥åˆ° doExportUrl æ–¹æ³•ï¼Œæœ‰ä¸ªå°ç»†èŠ‚ï¼Œä¼šå°†æ¥å£æœåŠ¡çš„åœ°å€å†…å®¹ä»¥ key = export å±æ€§å½¢å¼ï¼Œæ”¾åœ¨ registryURL ä¸­ã€‚
- ç¬¬ä¸‰ï¼Œæœ¬åœ°å¯¼å‡ºå’Œè¿œç¨‹å¯¼å‡ºï¼Œéƒ½è°ƒç”¨åŒä¸€ä¸ª doExportUrl æ–¹æ³•ï¼Œä¹Ÿå°±æ„å‘³ç€å¯¼å‡ºçš„ä¸»æµç¨‹ä»£ç è¿˜æ˜¯ä¹‹å‰çš„ä¸¤è¡Œä»£ç ï¼Œåªä¸è¿‡è¿œç¨‹å¯¼å‡ºæ—¶ä¼šèµ°å…¶ä»–çš„å®ç°ç±»è€Œå·²ã€‚

è‡³äºè¿œç¨‹å¯¼å‡ºä¼šèµ°åˆ°å“ªäº›å®ç°ç±»ï¼Œæˆ‘ä¹Ÿæ€»ç»“å‡ºæ¥äº†ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/28/2e/288b9b8ac236957870af06e17e23092e.jpg?wh=1920x1200)

å¯ä»¥å‘ç°ï¼Œæœ¬åœ°å¯¼å‡ºå’Œè¿œç¨‹å¯¼å‡ºçš„åŒºåˆ«ï¼Œå±…ç„¶å°±æ˜¯æœ€åä¸€ä¸ªå®ç°ç±»ï¼Œèµ°çš„æ˜¯ä¸€ä¸ªå…¼å®¹æ¥å£çº§æ³¨å†Œåè®®çš„å®ç°ç±»ï¼ˆInterfaceCompatibleRegistryProtocolï¼‰ã€‚

```java
///////////////////////////////////////////////////
// å…¼å®¹æ¥å£çº§æ³¨å†Œåè®®çš„å®ç°ç±»ï¼Œç»§æ‰¿äº† RegistryProtocol
// è¿™é‡Œå°† InterfaceCompatibleRegistryProtocol æ‰€æœ‰æ–¹æ³•å±•ç¤ºå‡ºæ¥äº†
// æ²¡æœ‰æ‰¾åˆ°æˆ‘ä»¬æƒ³è¦çš„ export æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥æ¨æµ‹ export æ–¹æ³•åœ¨å…¶çˆ¶ç±»ä¸­
///////////////////////////////////////////////////
public class InterfaceCompatibleRegistryProtocol extends RegistryProtocol {
    @Override
    protected URL getRegistryUrl(Invoker<?> originInvoker) { ... }
    @Override
    protected URL getRegistryUrl(URL url) { ... }
    @Override
    public <T> ClusterInvoker<T> getInvoker(Cluster cluster, Registry registry, Class<T> type, URL url) { ... }
    public <T> ClusterInvoker<T> getServiceDiscoveryInvoker(Cluster cluster, Registry registry, Class<T> type, URL url) { ... }
    @Override
    protected <T> ClusterInvoker<T> getMigrationInvoker(RegistryProtocol registryProtocol, Cluster cluster, Registry registry, Class<T> type, URL url, URL consumerUrl){ ... }
}    
```

ä¸è¿‡å¾ˆä¸å·§çš„æ˜¯ï¼Œä»è¿™ä¸ªå®ç°ç±»ï¼ˆInterfaceCompatibleRegistryProtocolï¼‰ä¸­ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å‘ç° export æ–¹æ³•ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¾—ç»§ç»­çœ‹å…¶çˆ¶ç±» RegistryProtocolï¼Œæœ€ç»ˆåœ¨ RegistryProtocol ä¸­æ‰¾åˆ°äº† export æ–¹æ³•ã€‚

```java
///////////////////////////////////////////////////
// org.apache.dubbo.registry.integration.RegistryProtocol#export
// è¿œç¨‹å¯¼å‡ºæ ¸å¿ƒé€»è¾‘ï¼Œå¼€å¯Nettyç«¯å£æœåŠ¡ + å‘æ³¨å†Œä¸­å¿ƒå†™æ•°æ®
///////////////////////////////////////////////////
@Override
public <T> Exporter<T> export(final Invoker<T> originInvoker) throws RpcException {
    // originInvoker.getUrl()ï¼šå…¶å®æ˜¯æ³¨å†Œä¸­å¿ƒåœ°å€
    // originInvoker.getUrl().toFullString()ï¼šregistry://127.0.0.1:2181/org.apache.dubbo.registry.RegistryService?REGISTRY_CLUSTER=registryConfig&application=dubbo-19-dubbo-deploy-provider&dubbo=2.0.2&pid=13556&qos.enable=false&register-mode=interface&registry=zookeeper&release=3.0.7&timestamp=1670717595475
    // registryUrlï¼šzookeeper://127.0.0.1:2181/org.apache.dubbo.registry.RegistryService?REGISTRY_CLUSTER=registryConfig&application=dubbo-19-dubbo-deploy-provider&dubbo=2.0.2&pid=13556&qos.enable=false&register-mode=interface&release=3.0.7&timestamp=1670717595475
    
    // ä» originInvoker å–å‡º "registry" çš„å±æ€§å€¼ï¼Œç»“æœå–å‡ºäº† zookeeper å€¼
    // ç„¶åå°† zookeeper æ›¿æ¢åè®® "protocol" å±æ€§çš„å€¼å°±å˜æˆäº† registryUrl
    URL registryUrl = getRegistryUrl(originInvoker);
    
    // providerUrlï¼šdubbo://192.168.100.183:28190/com.hmilyylimh.cloud.facade.demo.DemoFacade?anyhost=true&application=dubbo-19-dubbo-deploy-provider&background=false&bind.ip=192.168.100.183&bind.port=28190&deprecated=false&dubbo=2.0.2&dynamic=true&generic=false&interface=com.hmilyylimh.cloud.facade.demo.DemoFacade&methods=sayHello,say&pid=13556&qos.enable=false&register-mode=interface&release=3.0.7&side=provider&timeout=8888&timestamp=1670717595488
    // ä» originInvoker.getUrl() æ³¨å†Œä¸­å¿ƒåœ°å€ä¸­å–å‡º "export" å±æ€§å€¼
    URL providerUrl = getProviderUrl(originInvoker);
    // çœç•¥éƒ¨åˆ†å…¶ä»–ä»£ç ...
    
    // åˆçœ‹åˆ°äº†ä¸€ä¸ªâ€œæœ¬åœ°å¯¼å‡ºâ€ï¼Œæ­¤æœ¬åœ°å¯¼å‡ºå¹¶ä¸æ˜¯ä¹‹å‰çœ‹åˆ°çš„â€œæœ¬åœ°å¯¼å‡ºâ€
    // è¿™é‡Œæ˜¯æ³¨å†Œä¸­å¿ƒåè®®å®ç°ç±»çš„æœ¬åœ°å¯¼å‡ºï¼Œæ˜¯éœ€è¦æœ¬åœ°å¼€å¯20880ç«¯å£çš„nettyæœåŠ¡
    final ExporterChangeableWrapper<T> exporter = doLocalExport(originInvoker, providerUrl);
    
    // æ ¹æ® registryUrl è·å–å¯¹åº”çš„æ³¨å†Œå™¨ï¼Œè¿™é‡Œè·å–çš„æ˜¯å¯¹è±¡ä»å¤–å±‚åˆ°å†…å±‚ä¾æ¬¡æ˜¯ï¼š
    // ListenerRegistryWrapper -> ZookeeperRegistryï¼Œæœ€ç»ˆæ‹¿åˆ°äº† zookeeper æ³¨å†Œå™¨
    final Registry registry = getRegistry(registryUrl);
    final URL registeredProviderUrl = getUrlToRegistry(providerUrl, registryUrl);
    boolean register = providerUrl.getParameter(REGISTER_KEY, true) && registryUrl.getParameter(REGISTER_KEY, true);
    if (register) {
        // å‘ zookeeper è¿›è¡Œå†™æ•°æ®ï¼Œå°† registeredProviderUrl å†™åˆ°æ³¨å†Œä¸­å¿ƒæœåŠ¡ä¸­å»
        register(registry, registeredProviderUrl);
    }
    // çœç•¥éƒ¨åˆ†å…¶ä»–ä»£ç ...
.    
}
```

ç®€ç›´æ˜¯å¦‚è·çå®ï¼Œè¿™æ®µä»£ç çš„æµç¨‹å¤ªé‡è¦äº†ã€‚

é¦–å…ˆï¼Œä»ä¼ è¿›æ¥çš„ Invoker ä»£ç†å¯¹è±¡ä¸­ï¼Œå–å‡ºæ³¨å†Œæ³¨å†Œä¸­å¿ƒåœ°å€ï¼Œå¹¶ä¸”ä»æ³¨å†Œä¸­å¿ƒåœ°å€ä¸­å–å‡º registry å±æ€§å€¼å¾—åˆ° zookeeperå€¼ï¼Œæ‘‡èº«ä¸€å˜ï¼Œç”Ÿæˆäº†ä¸€ä¸ªä»¥ zookeeper ä¸ºåè®®çš„æ–° registryUrl åœ°å€ã€‚

ç„¶åï¼Œå†æ¬¡çœ‹åˆ°äº†ä¸€ä¸ª doLocalExport æ–¹æ³•ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¸æ˜¯æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„â€œæœ¬åœ°å¯¼å‡ºâ€ï¼Œè¿™é‡Œæ˜¯æ³¨å†Œåè®®å®ç°ç±»ä¸­æœ¬åœ°å¯¼å‡ºï¼Œä¸»è¦æ˜¯å¼€å¯æœ¬åœ° Dubbo åè®®ç«¯å£çš„ Netty æœåŠ¡ã€‚

æœ€åï¼Œä» registryUrl ä¸­ï¼Œæ ¹æ® zookeeper è·å–åˆ° ZookeeperRegistryï¼Œå¹¶ä¸”ï¼ŒæŠŠæ„å»ºå¥½çš„æä¾›æ–¹æ¥å£æœåŠ¡åœ°å€ï¼Œå†™åˆ° Zookeeper æ³¨å†Œä¸­å¿ƒæœåŠ¡å»ã€‚

è¿™æ®µæµç¨‹ï¼Œå…³é”®çš„æ˜¯ doLocalExport æ–¹æ³•ï¼Œæœ¬åœ°å¯¼å‡ºæ‰€æ‰§è¡Œçš„ä¸šåŠ¡é€»è¾‘ä¹Ÿè¦å…ˆç»è¿‡åŒ…è£…å™¨ï¼Œå†åˆ°æ ¸å¿ƒçš„ DubboProtocol å®ç°ç±»å»å¤„ç†ï¼Œé€»è¾‘æŒºæ·±çš„ï¼Œæˆ‘ä¹Ÿæ€»ç»“å‡ºäº†ä»£ç æµç¨‹ç¤ºæ„å›¾ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/10/b6/1078abe0716ddf4214deabe62c38f6b6.jpg?wh=1920x1584)

é€šè¿‡åå…«å¼¯æºç ï¼Œä» doLocalExportï¼Œè¿½åˆ° DubboProtocol çš„ export å’Œ openServer æ–¹æ³•ï¼Œç´§æ¥ç€æ‰¾åˆ°äº† NettyTransporter çš„ bind æ–¹æ³•ï¼Œçœ‹è§äº† NettyServer æœåŠ¡ç±»ï¼Œç„¶åç»§ç»­è¿½åˆ°äº†å…¶çˆ¶ç±» AbstractServer è°ƒç”¨äº†å­ç±»çš„ doOpen æ–¹æ³•ï¼Œæœ€åï¼Œåœ¨ NettyServer çš„ doOpen å®ç°ç±»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Dubbo æ¡†æ¶é‡‡ç”¨ Netty ç½‘ç»œé€šä¿¡æ¡†æ¶ï¼Œè¿›è¡Œäº†ç«¯å£æœåŠ¡çš„ç»‘å®šã€‚

## æ³¨å†Œ

ç¬¬äºŒæ­¥å¯¼å‡ºçš„æºç æˆ‘ä»¬æ¢ç´¢å®Œæˆï¼Œæœ€åæˆ‘ä»¬çœ‹çœ‹ç¬¬ä¸‰æ­¥æ³¨å†Œï¼ŒæœåŠ¡æ¥å£ä¿¡æ¯åˆæ˜¯å¦‚ä½•å†™åˆ°æ³¨å†Œä¸­å¿ƒçš„ï¼Ÿ

ä»£ç çš„é€»è¾‘ä¹Ÿæ˜¯æŒºæ·±çš„ï¼Œä¸è¿‡æ€è·¯å’Œå‰ä¸¤æ­¥ä¸€æ ·ï¼Œç»†èŠ‚å°±ä¸å†èµ˜è¿°äº†ï¼Œè¿™é‡Œæˆ‘ä¹Ÿç»™ä½ æ€»ç»“äº†ä»£ç è°ƒç”¨æµç¨‹ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/18/7c/182fc49508d49814d401e38yy9a5877c.jpg?wh=1920x1086)

ä» RegistryProtocol çš„æ³¨å†Œå…¥å£ï¼Œç»è¿‡å‡ æ­¥æ·±å…¥ï¼Œæœ€ç»ˆå¯ä»¥å‘ç°ï¼Œå‘ Zookeeper æœåŠ¡å†™æ•°æ®å…¶å®ä¹Ÿéå¸¸ç®€å•ï¼Œæˆ‘ä»¬è°ƒç”¨äº† CuratorFramework æ¡†æ¶çš„ç±»æ¥å‘ Zookeeper å†™æ•°æ®ã€‚

**æ‰€ä»¥ï¼Œåœ¨â€œæ¸©æ•…çŸ¥æ–°â€ä¸­æåˆ°çš„â€œæœåŠ¡æ³¨å†Œâ€ï¼Œå…¶å®å°±æ˜¯åˆ©ç”¨ Zookeeper å®¢æˆ·ç«¯ï¼Œå¾€ Zookeeper æœåŠ¡ç«¯å†™äº†ä¸€æ¡æ•°æ®ï¼Œå³åˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶ç›®å½•è€Œå·²**ï¼Œè¿™å°±æ˜¯æœåŠ¡æ³¨å†Œçš„åº•å±‚æ ¸å¿ƒåŸç†ã€‚

## å‘å¸ƒæµç¨‹æ€æƒ³çš„åæ€

ä»Šå¤©çš„æºç æ¢ç´¢å†ç¨‹æ¯”è¾ƒè‰°éš¾ï¼Œæƒ³å¿…ä½ ä¹Ÿæ»¡è½½è€Œå½’äº†ã€‚

ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œä¸€åˆ‡éƒ½æ˜¯ä»åˆ›å»º ServiceBean çš„ Bean å®šä¹‰å¼€å§‹ï¼Œç„¶åå±•å¼€äº†ä¸€ç³»åˆ—åç»­æµç¨‹ï¼Œæ‰€ä»¥ï¼ŒBean å®šä¹‰çš„åˆ›å»ºè‡³å…³é‡è¦ã€‚å¯æ˜¯ä¸ºä»€ä¹ˆè¦åˆ›å»ºè¿™äº› Bean å®šä¹‰å‘¢ï¼Ÿ

è¦è§£ç­”è¿™ä¸ªé—®é¢˜ï¼Œé¦–å…ˆä½ è¦ç†è§£ Bean å®šä¹‰æ ¸å¿ƒæ˜¯ä»€ä¹ˆã€‚

æ‰“ä¸ªæ¯”æ–¹ï¼Œå°±åƒä¸€ä¸ªè±†å­ï¼Œå‘èŠ½å‰éœ€è¦ç»è¿‡æµ‡æ°´ã€é˜³å…‰ã€æ–½è‚¥ç­‰ä¸€ç³»åˆ—æµç¨‹ï¼ŒServiceBean çš„ Bean å®šä¹‰åˆ›å»ºï¼Œå°±åƒè¿™ä¸€ç³»åˆ—æµç¨‹ï¼Œåœ¨æ¥å£æœåŠ¡å¯¹è±¡ DemoFacadeImpl æœªå®ä¾‹åŒ–ï¼ˆå‘èŠ½ï¼‰ä¹‹å‰ï¼Œæˆ‘ä»¬ä¼šç§å¾ˆå¤šä¸ªè±†å­ï¼Œè·Ÿéš Spring è‡ªèº«çš„ä¸€äº›å®ä¾‹åŒ–æœºåˆ¶ï¼Œç­‰å¾…å®ä¾‹åŒ–åˆ›å»ºã€‚æ¯ä¸ªè±†å­å‘èŠ½åï¼Œå°±å„è‡ªå»å®Œæˆå¯¹åº”æ¥å£çš„å‘å¸ƒã€‚

è¿™æ ·ï¼Œæˆ‘ä»¬å°±åšåˆ°äº†ä½¿ç”¨ä¸€å¥—æµç¨‹æ’­ç§ N ä¸ªè±†å­ï¼Œæ¯ä¸ªéƒ½æŒ‰ç…§ç»Ÿä¸€çš„æ—¢å®šæµç¨‹å®æ–½æ‰§è¡Œã€‚å½“ä½ åœ¨åšåº•å±‚æ¡†æ¶æ—¶ï¼Œå¦‚æœæƒ³è®©ä¸€ç³»åˆ—çš„ç±»éƒ½å…·æœ‰ä¸€æ ·çš„è¡Œä¸ºï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç¼–ç¨‹å¼çš„æ–¹å¼ä¿®æ”¹æˆ–åˆ›å»º Bean å®šä¹‰ã€‚

**æ—¢å®šçš„å‘å¸ƒæµç¨‹ï¼Œä¹Ÿéå¸¸ç®€å•ï¼Œæ— éå°±æ˜¯æ‹¿åˆ°é…ç½®ï¼Œå…ˆæœ¬åœ°å¯¼å‡ºï¼Œç„¶åè¿œç¨‹å¯¼å‡ºï¼Œåœ¨è¿œç¨‹å¯¼å‡ºä¸­åˆé¡ºä¾¿åšäº†æœåŠ¡çš„æ³¨å†ŒåŠŸèƒ½**ã€‚æ•´ä½“æ¸…æ™°æ˜äº†ï¼Œåªè¦ä½ æŠ“ä½äº†è¿™æ¡ä¸»å¹²çº¿è·¯ï¼Œçœ‹æºç æ—¶å°±ä¸ä¼šè¢«å„ç§ç»†èŠ‚å¸¦åã€‚

## æ€»ç»“

ä»Šå¤©ï¼Œæˆ‘ä»¬å’ŒDubbo æ€»ä½“æ¶æ„ç¤ºæ„å›¾ä¸­çš„ â‘ â‘¡â‘¢ æ­¥å†ç»­å‰ç¼˜ï¼Œé€šè¿‡ç†ŸçŸ¥çš„æµç¨‹ï¼Œå¼•å‡ºäº†é™Œç”Ÿçš„å‘å¸ƒæµç¨‹ï¼Œä»é…ç½®ã€å¯¼å‡ºã€æ³¨å†Œä¸‰æ–¹é¢æ·±å…¥ç ”ç©¶äº†æºç ã€‚

- é…ç½®æµç¨‹ï¼Œé€šè¿‡æ‰«ææŒ‡å®šåŒ…è·¯å¾„ä¸‹å«æœ‰ @DubboService æ³¨è§£çš„ Bean å®šä¹‰ï¼ŒæŠŠæ‰«æå‡ºæ¥çš„ Bean å®šä¹‰å±æ€§ï¼Œå…¨éƒ¨è½¬ç§»è‡³æ–°åˆ›å»ºçš„ ServiceBean ç±»å‹çš„ Bean å®šä¹‰ä¸­ï¼Œä¸ºåç»­å¯¼å‡ºåšå‡†å¤‡ã€‚
- å¯¼å‡ºæµç¨‹ï¼Œä¸»è¦æœ‰ä¸¤å—ï¼Œä¸€å—æ˜¯ injvm åè®®çš„æœ¬åœ°å¯¼å‡ºï¼Œä¸€å—æ˜¯æš´éœ²åè®®çš„è¿œç¨‹å¯¼å‡ºï¼Œè¿œç¨‹å¯¼å‡ºä¸æœ¬åœ°å¯¼å‡ºæœ‰ç€å®è´¨æ€§çš„åŒºåˆ«ï¼Œè¿œç¨‹å¯¼å‡ºä¼šä½¿ç”¨åè®®ç«¯å£é€šè¿‡ Netty ç»‘å®šæ¥æä¾›ç«¯å£æœåŠ¡ã€‚
- æ³¨å†Œæµç¨‹ï¼Œå…¶å®æ˜¯è¿œç¨‹å¯¼å‡ºçš„ä¸€ä¸ªåˆ†æ”¯æµç¨‹ï¼Œä¼šå°†æä¾›æ–¹çš„æœåŠ¡æ¥å£ä¿¡æ¯ï¼Œé€šè¿‡ Curator å®¢æˆ·ç«¯ï¼Œå†™åˆ° Zookeeper æ³¨å†Œä¸­å¿ƒæœåŠ¡ç«¯å»ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/2c/cd/2c4c58169731a6092afbdfa59aafcfcd.jpg?wh=5664x2370)

å¾ˆå¤šäººä¼šè®¤ä¸ºæºç å¤æ‚ï¼Œä¸è¿‡æ˜¯å› ä¸º Dubbo æ¡†æ¶çš„å±‚æ¬¡å°è£…ç²’åº¦æ¯”è¾ƒç»†ã€æ¯”è¾ƒçµæ´»è€Œå·²ã€‚ä¹‹å‰æˆ‘ä»¬ä¹Ÿè§è¯†äº† Dubbo æ¡†æ¶çš„åå±‚æ¨¡å—ï¼Œæ¯å±‚æ¨¡å—éƒ½æœ‰å„è‡ªçš„æ¥å£å’Œä¼—å¤šå®ç°ç±»ï¼Œè¿™äº›éƒ½æ˜¯ä¸»å¹²èº«ä¸Šçš„æå¶ï¼Œä½†ç”±äºè¿‡äºç¹èŒ‚ï¼Œæºç çœ‹ç€çœ‹ç€å°±ä¸çŸ¥é“è¯¥èµ°å“ªä¸ªå®ç°ç±»äº†ï¼Œæœ¬è´¨ä¸Šï¼Œè¿˜æ˜¯å¯¹ä¸»å¹²æµç¨‹æŠŠæ§åŠ›åº¦ä¸å¤Ÿã€‚

è¿™ä¸ªé—®é¢˜ä¹Ÿå¥½è§£å†³ï¼Œå¤šçœ‹å‡ éå°±è¡Œï¼Œçœ‹çš„åŒæ—¶æ³¨æ„æŠŠæ¡æ¯ä¸ªç¯èŠ‚æ ¹æ®å“ªäº›å‚æ•°èµ°äº†åˆ†æ”¯é€»è¾‘ï¼Œå‰©ä¸‹çš„å°±æ˜¯å®ç°ç±»çš„ç»†ç²’åº¦é€»è¾‘äº†ï¼Œæ¯ä¸ªå®ç°ç±»å¹²å„è‡ªçš„äº‹æƒ…ã€‚

### æ€è€ƒé¢˜

ç•™ä¸ªä½œä¸šç»™ä½ ï¼Œæœ¬åœ°å¯¼å‡ºå’Œè¿œç¨‹å¯¼å‡ºçš„ä»£ç ï¼Œéƒ½è°ƒç”¨äº† protocolSPI.export è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨ä¼šç»å†ä¸€ä¸ª ProtocolFilterWrapper åè®®è¿‡æ»¤å™¨åŒ…è£…ç±»ï¼Œä½ èƒ½å¦å°è¯•ç ”ç©¶ä¸‹è¿™ä¸ªåŒ…è£…ç±»ï¼Œçœ‹çœ‹å®ƒæ‹¦æˆª export æ–¹æ³•æ—¶åšäº†å“ªäº›äº‹æƒ…ï¼Ÿ

æœŸå¾…çœ‹åˆ°ä½ çš„æ€è€ƒï¼Œå¦‚æœè§‰å¾—ä»Šå¤©çš„å†…å®¹å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¹Ÿæ¬¢è¿åˆ†äº«ç»™èº«è¾¹çš„æœ‹å‹ä¸€èµ·è®¨è®ºã€‚æˆ‘ä»¬ä¸‹ä¸€è®²è§ã€‚

### 18 æ€è€ƒé¢˜å‚è€ƒ

ä¸Šä¸€æœŸç•™äº†ä¸ªä½œä¸šï¼Œåœ¨ AppleWrapper å®ç°ç±»ï¼Œåˆ©ç”¨ setter æ–¹å¼åœ¨é‡Œé¢æ³¨å…¥ä¸€ä¸ª SpringCloud å®ç°ç±»ï¼Œå¹¶ä¸”è°ƒç”¨ SpringCloud å®ç°ç±»çš„ getCourse æ–¹æ³•ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚

æˆ‘ä»¬é¡ºç€é¢˜ç›®çš„æ€è·¯æ¥ï¼Œç›´æ¥å» AppleWrapper ä¸­é€šè¿‡ setter æ–¹å¼åœ¨é‡Œé¢æ³¨å…¥ä¸€ä¸ª SpringCloud å®ç°ç±»ï¼Œçœ‹ä»£ç ã€‚

```java
@Wrapper(order = 1)
public class AppleWrapper implements Geek {
    private Geek geek;
    private Geek springCloud;
    public AppleWrapper(Geek geek) {
        this.geek = geek;
    }
    // !!!!!!!!!! é‡ç‚¹çœ‹è¿™é‡Œ !!!!!!!!!!
    // è¿™é‡Œæ·»åŠ äº†ä¸€ä¸ªé€šè¿‡ setter æ–¹å¼æ³¨å…¥çš„å®ç°ç±»
    public void setSpringcloud(Geek geek){
        this.springCloud = geek;
    }
    @Override
    public String getCourse(URL url) {
        // ç„¶ååœ¨æ–¹æ³•è§¦å‘è°ƒç”¨çš„æ—¶å€™ï¼Œé¦–å…ˆè°ƒç”¨ springCloud æ³¨å…¥è¿›æ¥çš„å®ç°ç±»çš„æ–¹æ³•
        return springCloud.getCourse(url) + "ã€è¯¾ç¨‹AppleWrapperå‰...ã€‘" + geek.getCourse(url) + "ã€è¯¾ç¨‹AppleWrapperå...ã€‘";
    }
}
```

ç„¶åè¿è¡Œä¸€ä¸‹å¯åŠ¨ç±»ï¼Œç„¶åçœ‹åˆ°äº†å¼‚å¸¸ä¿¡æ¯ã€‚

```java
Exception in thread "main" java.lang.StackOverflowError
	at java.util.HashMap.hash(HashMap.java:338)
	at java.util.HashMap.containsKey(HashMap.java:595)
	at java.util.Collections$UnmodifiableMap.containsKey(Collections.java:1452)
	at org.apache.dubbo.common.url.component.URLParam.getParameter(URLParam.java:843)
	at org.apache.dubbo.common.URL.getParameter(URL.java:544)
	at org.apache.dubbo.common.URL.getParameter(URL.java:548)
	at com.hmilyylimh.cloud.inject.spi.Geek$Adaptive.getCourse(Geek$Adaptive.java)
	at com.hmilyylimh.cloud.inject.spi.AppleWrapper.getCourse(AppleWrapper.java:23)
	at com.hmilyylimh.cloud.inject.spi.Geek$Adaptive.getCourse(Geek$Adaptive.java)
	at com.hmilyylimh.cloud.inject.spi.AppleWrapper.getCourse(AppleWrapper.java:23)
	at com.hmilyylimh.cloud.inject.spi.Geek$Adaptive.getCourse(Geek$Adaptive.java)
	at com.hmilyylimh.cloud.inject.spi.AppleWrapper.getCourse(AppleWrapper.java:23)
	at com.hmilyylimh.cloud.inject.spi.Geek$Adaptive.getCourse(Geek$Adaptive.java)
    at com.hmilyylimh.cloud.inject.spi.AppleWrapper.getCourse(AppleWrapper.java:23)
    ... æ­¤å¤„çœç•¥ä¸Šåƒè¡Œã€AppleWrapper.getCourseã€Geek$Adaptive.getCourseã€‘é‡å¤çš„æ—¥å¿—æ‰“å°
```

ä»å¼‚å¸¸ä¿¡æ¯ä¸­å‘ç°ï¼ŒStackOverflowError å †æ ˆæº¢å‡ºçš„é”™è¯¯ï¼Œæ—¢ç„¶å‡ºç°äº†å †æ ˆæº¢å‡ºï¼Œé‚£å°±è¯´æ˜å­˜åœ¨è‡ªå·±è°ƒç”¨è‡ªå·±ï¼Œè¿›å…¥äº†æ­»å¾ªç¯æ“ä½œï¼Œç›´åˆ°çº¿ç¨‹å †æ ˆç©ºé—´æ¶ˆè€—æ®†å°½ï¼Œç„¶åå°±æŠ›å‡ºäº†å †æ ˆæº¢å‡ºçš„å¼‚å¸¸ã€‚

ä¸ºä»€ä¹ˆä¼šå‡ºç°å‘¢ï¼Ÿå…¶å®ä»å †æ ˆä»ä¸‹å¾€ä¸Šçœ‹ï¼Œä½ å¯ä»¥å‘ç°ï¼Œå…ˆè°ƒç”¨äº† `AppleWrapper.getCourse` æ–¹æ³•ï¼Œç„¶åè°ƒç”¨äº† `Geek$Adaptive.getCourse` æ–¹æ³•ã€‚ä½†æ˜¯ä¸€çœ‹åˆ° `Geek$Adaptive` è¿™ä¸ªç±»åå°±å¾ˆç†Ÿæ‚‰äº†ï¼Œè¿™ä¸å°±æ˜¯ Geek æ¥å£çš„è‡ªé€‚åº”æ‰©å±•ç‚¹ä»£ç†ç±»ä¹ˆã€‚

æ—¢ç„¶æ˜¯ä»£ç†ç±»ï¼Œä¸ºä»€ä¹ˆä¼šè¿›å…¥æ­»å¾ªç¯å‘¢ï¼Œç°åœ¨å°±æ˜¯è¦æ‰¾åˆ°è¿›å…¥äº†ä»£ç†ç±»åæ€ä¹ˆåˆè°ƒç”¨äº† `AppleWrapper.getCourse` è¿™ä¸ªæ–¹æ³•ï¼Ÿæ‰¾åˆ°è¿™ä¸ªåŸå› ï¼Œä¼°è®¡å°±æ°´è½çŸ³å‡ºäº†ã€‚

é‚£åœ¨å‰é¢â€œCompilerç¼–è¯‘â€ç« èŠ‚ï¼Œæˆ‘ä»¬å­¦è¿‡å¦‚ä½•çœ‹è‡ªé€‚åº”æ‰©å±•ç‚¹ä»£ç†ç±»çš„æºä»£ç ï¼ŒæŠŠæºä»£ç å¼„å‡ºæ¥ã€‚

```java
package com.hmilyylimh.cloud.inject.spi;
import org.apache.dubbo.rpc.model.ScopeModel;
import org.apache.dubbo.rpc.model.ScopeModelUtil;
public class Geek$Adaptive implements com.hmilyylimh.cloud.inject.spi.Geek {
    public java.lang.String getCourse(org.apache.dubbo.common.URL arg0) {
        if (arg0 == null) throw new IllegalArgumentException("url == null");
        org.apache.dubbo.common.URL url = arg0;
        String extName = url.getParameter("geek", "dubbo");
        if (extName == null)
            throw new IllegalStateException("Failed to get extension (com.hmilyylimh.cloud.inject.spi.Geek) name from" +
                    " url (" + url.toString() + ") use keys([geek])");
        ScopeModel scopeModel = ScopeModelUtil.getOrDefault(url.getScopeModel(),
                com.hmilyylimh.cloud.inject.spi.Geek.class);
        // æ‹¿åˆ°æŒ‡å®šæ‰©å±•ç‚¹åç§°å¯¹åº”çš„å®ä¾‹å¯¹è±¡
        com.hmilyylimh.cloud.inject.spi.Geek extension =
                (com.hmilyylimh.cloud.inject.spi.Geek) scopeModel.getExtensionLoader(com.hmilyylimh.cloud.inject.spi.Geek.class).getExtension(extName);
        // ç†è®ºä¸Šè¿™ä¸ª extension å®ä¾‹å¯¹è±¡æ˜¯è¢«åŒ…è£…ç±»åŒ…è£¹çš„
        // ä»å¤–åˆ°å†…ä¾æ¬¡ä¸ºï¼šåŒ…è£…ç±» -> SPI æ¥å£å®ç°ç±»
        return extension.getCourse(arg0);
    }
}
```

çœ‹åˆ° `Geek$Adaptive` æºç åï¼Œå‘ç°ä¹Ÿæ˜¯ä¸€å¥ç®€å•çš„é€šè¿‡æ‰©å±•ç‚¹åç§°æ‹¿åˆ°å¯¹åº”çš„å®ä¾‹å¯¹è±¡ï¼Œä»£ç ä¹ŸæŒºç›´ç™½å¹²å‡€çš„ï¼Œä¸ºä»€ä¹ˆå°±ä¼šå‡ºç°è¿™ç§å †æ ˆå¼‚å¸¸æƒ…å†µå‘¢ï¼Ÿ

è¿˜æ˜¯çœ‹ä¸å‡ºæ¥ï¼Œæœ€åçš„ç»æ‹›å°±æ˜¯æ–­ç‚¹èµ°ä¸€å›çœ‹çœ‹ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/39/e5/399ce93a685c27cd54f195cd8d3ee3e5.jpg?wh=5085x1989)

ä»æ–­ç‚¹ä¸­ï¼Œæˆ‘ä»¬å‘ç°å›¾ä¸­çš„ geek å¯¹è±¡æ˜¯ä¸€ä¸ªä»£ç†ç±»ï¼Œä»£ç†ç±»åœ¨çœŸæ­£æ‰§è¡Œ getCourse æ–¹æ³•æ—¶ï¼Œèµ°çš„æ˜¯ AppleWrapper å®ç°ç±»çš„ getCourse æ–¹æ³•ã€‚è€Œ AppleWrapper å®ç°ç±»ä¸­çš„ springCloud å¯¹è±¡åˆæ˜¯ `Geek$Adaptive` ä»£ç†ç±»ï¼Œé‚£ä¹ˆ `springCloud.getCourse` æ–¹æ³•åœ¨çœŸå®è°ƒç”¨æ—¶çš„å®ä¾‹å¯¹è±¡å¤–å±‚åˆæ˜¯ AppleWrapper åŒ…è£…ç±»ã€‚

é‚£è¿™æ ·ä¸‹å»ï¼Œä¸å°±å‡ºç°ä» `geek.getCourse` æ–¹æ³•è¿›å…¥äº† `AppleWrapper.getCourse` è°ƒç”¨ï¼Œç„¶å `AppleWrapper.getCourse` ä¸­è°ƒç”¨äº† `springCloud.getCourse` æ–¹æ³•ï¼Œè€Œ `springCloud.getCourse` æœ€ç»ˆåˆä¼šè¿›å…¥ `AppleWrapper.getCourse` æ–¹æ³•ï¼Œè¿™æ ·ä¸‹å»å°±æ­»å¾ªç¯äº†ï¼Œè‡ªç„¶å°±å‡ºç°äº†å¼‚å¸¸æ—¥å¿—ä¸­çš„å †æ ˆå¼‚å¸¸ç°è±¡ã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ6ï¼‰</strong></div><ul>
<li><span>Mysteryæ£®æ·¼ï¼ŒğŸƒ</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆï¼ŒæœåŠ¡çš„æš´éœ²åº”è¯¥æ€ä¹ˆç†è§£å‘¢ï¼Œ</p>2023-04-01</li><br/><li><span>w ğŸ</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>protocolSPIé»˜è®¤æ˜¯dubboï¼Œé‚£ä¹ˆæ˜¯æ€ä¹ˆæ‰¾åˆ°injvmçš„</p>2023-06-13</li><br/><li><span>Geek_10086</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<p>è€å¸ˆï¼Œè¯·é—® serviceBeanæ€ä¹ˆè§¦å‘çš„ serviceConfig#exprotæ–¹æ³•ï¼Œä¸€ç›´æ²¡æœ‰æ‰¾åˆ°</p>2023-02-24</li><br/><li><span>é˜¿æ˜•</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>æœ¬åœ°å¯¼å‡ºæ˜¯ä¸ºäº†å¼€å¯æœ¬åœ°åè®®ç«¯å£çš„nettyæœåŠ¡ï¼Œè¿œç¨‹å¯¼å‡ºæ˜¯ä¸ºäº†å†™å…¥æ•°æ®åˆ°æ³¨å†Œä¸­å¿ƒï¼Œå¯ä»¥è¿™æ ·ç†è§£å—ï¼Ÿ</p>2023-02-07</li><br/><li><span>å°å»º</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>è€å¸ˆï¼Œé—®ä¸‹ï¼Œä¸€è‡´æ€§hashä¸æ”¯æŒé¢„çƒ­ï¼Œä¸€å¼€å§‹æµé‡å°±ä¼šæ‰“åˆ°æ–°å®ä¾‹ï¼Œè¿™ä¸ªæœ‰åŠæ³•åŠ ä¸€ä¸ªé¢„çƒ­æœºåˆ¶å—ï¼Œæˆ‘è¿™è¾¹çš„åœºæ™¯æ˜¯å¯åŠ¨åï¼Œå¯ä»¥åœ¨ä¸€æ®µæ—¶é—´å†…å…è®¸hashè®¡ç®—é”™è¯¯</p>2024-07-15</li><br/><li><span>William</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>1ã€é…ç½®: @DubblService , å®šä¹‰å®ç°ç±»service --&gt;&gt;æœ€ç»ˆç”Ÿæˆ ServiceBean(BeanDefinition) 
2ã€å¯¼å‡º: export æš´éœ²æ¥å£ç»™å¤–éƒ¨ä½¿ç”¨(æœ¬åœ°ã€è¿œç¨‹)
3ã€æ³¨å†Œ: æ³¨å†Œåˆ°ç›¸åº”çš„åè®®ä¸Š(zkä¸´æ—¶èŠ‚ç‚¹). </p>2023-12-04</li><br/>
</ul>