ä½ å¥½ï¼Œæˆ‘æ˜¯ä½•è¾‰ã€‚ä»Šå¤©æˆ‘ä»¬æ¢ç´¢Dubboæ¡†æ¶çš„ç¬¬ä¸ƒé“ç‰¹è‰²é£å‘³ï¼Œç¼“å­˜æ“ä½œã€‚

ç§»åŠ¨ç«¯Appä½ åº”è¯¥ä¸é™Œç”Ÿäº†ï¼Œä¸è¿‡æœ€è¿‘æœ‰ä¸ªé¡¹ç›®å¼•å‘äº†ç”¨æˆ·åæ§½ï¼š

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/91/94/911c0c06315a3yy7f07b78099ebc9d94.jpg?wh=1920x849)

å›¾ä¸­çš„Appï¼Œåœ¨é¦–é¡µè¿›è¡Œé¡µé¢æ¸²æŸ“åŠ è½½æ—¶ä¼šå‘ç½‘å…³å‘èµ·è¯·æ±‚ï¼Œç½‘å…³ä¼šä»æƒé™ç³»ç»Ÿæ‹¿åˆ°è§’è‰²ä¿¡æ¯åˆ—è¡¨å’Œèœå•ä¿¡æ¯åˆ—è¡¨ï¼Œä»ç”¨æˆ·ç³»ç»Ÿæ‹¿åˆ°å½“å‰ç™»å½•ç”¨æˆ·çš„ç®€å•ä¿¡æ¯ï¼Œç„¶åæŠŠä¸‰å—ä¿¡æ¯ä¸€å¹¶è¿”å›ç»™åˆ°Appã€‚

ç„¶è€Œï¼Œå°±æ˜¯è¿™æ ·ä¸€ä¸ªçœ‹ä¼¼ç®€å•çš„åŠŸèƒ½ï¼Œæ¯å½“ä¸Šä¸‹ç­çš„æ—¶å€™å› ä¸ºAppè¢«æ‰“å¼€çš„é¢‘ç‡éå¸¸é«˜ï¼Œé¦–é¡µåŠ è½½çš„è¯·æ±‚æµé‡åœ¨çŸ­æ—¶é—´å†…å±…é«˜ä¸ä¸‹ï¼Œæ‰“å¼€å¾ˆå¡é¡¿ï¼Œæ¸²æŸ“å¾ˆæ…¢ã€‚

ç»è¿‡æ’æŸ¥åï¼Œå‘ç°è¯¥Appåªæœ‰æ•°åä¸‡ç”¨æˆ·ï¼Œä½†æ„å¤–çš„æ˜¯åœ¨è®¿é—®é«˜å³°æœŸï¼Œæƒé™ç³»ç»Ÿçš„å“åº”æ—¶é—´æ¯”ä»¥å¾€å¢é•¿äº†è¿‘10å€ï¼Œæƒé™ç³»ç»Ÿé›†ç¾¤ä¸­å•æœºæŸ¥è¯¢æ•°æ®åº“çš„QPSé«˜è¾¾500å¤šï¼Œå¯¼è‡´æ•°æ®åº“çš„æŸ¥è¯¢å‹åŠ›ç‰¹åˆ«å¤§ï¼Œä»è€Œå¯¼è‡´æŸ¥è¯¢è¯·æ±‚å“åº”ç‰¹åˆ«æ…¢ã€‚

ç”±äºç›®å‰ç”¨æˆ·ä½“é‡å°šä¸”ä¸å¤§ï¼Œæ¶æ„å›¢é˜Ÿå•†è®¨åï¼Œä¸ºäº†ç¨³ä½ç”¨æˆ·ä½“éªŒï¼Œæœ€å¿«çš„åŠæ³•å°±æ˜¯åœ¨ç½‘å…³å¢åŠ ç¼“å­˜åŠŸèƒ½ï¼ŒæŠŠé¦–é¡µåŠ è½½è¯·æ±‚çš„ç»“æœç¼“å­˜èµ·æ¥ï¼Œä»¥æå‡é¦–é¡µå¿«é€Ÿæ¸²æŸ“é¡µé¢çš„æ—¶æ•ˆã€‚

å¯¹äºè¿™ä¸ªåŠ ç¼“å­˜çš„éœ€æ±‚ï¼Œä½ ä¼šå¦‚ä½•ä¼˜é›…åœ°å¤„ç†å‘¢ï¼Ÿ

## ç¼“å­˜ç–‘æƒ‘

åœ¨æ­£å¼æ€è€ƒå¤„ç†æ€è·¯å‰ï¼Œä¸çŸ¥é“ä½ å¯¹æ¶æ„å›¢é˜Ÿçš„ç»“è®ºæœ‰æ²¡æœ‰ç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆå¢åŠ ä¸€ä¸ªç®€å•çš„ç¼“å­˜åŠŸèƒ½ï¼Œå°±èƒ½æå‡æ¥å£å“åº”æ—¶æ•ˆå‘¢ï¼Ÿ

æˆ‘ä»¥å‰ä¹Ÿæœ‰è¿‡è¿™æ ·çš„ç–‘æƒ‘ï¼Œç›´åˆ°æœ‰ä¸€å¤©ç ”ç©¶volatileåŸç†æ—¶ï¼Œçœ‹åˆ°äº†ä¸€å¼ å…³äºç³»ç»Ÿå­˜å‚¨åª’ä»‹çš„å»¶æ—¶é‡åŒ–å›¾ï¼ˆ[ä½ å¯ä»¥æœç´¢ â€œLatency numbers every programmer should knowâ€ å…³é”®å­—](https://colin-scott.github.io/personal_website/research/interactive_latency.html)ï¼‰ï¼Œæ‰æç„¶å¤§æ‚Ÿï¼š

```java
// è¿™é‡Œæˆ‘å°±åˆ—ä¸¾å‡ºï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨çš„æ•°æ®
L1 cache reference ........................... 1 ns
L2 cache reference ........................... 4 ns
Main memory reference ...................... 100 ns             
Send packet CA->Netherlands->CA .... 150,000,000 ns  = 150 ms
```

è¿˜è®°å¾—ä½ ä¹‹å‰å­¦è¿‡çš„è®¡ç®—æœºç»„æˆåŸç†å—ï¼Œæˆ‘ä»¬çœ‹è¿™é‡Œä¸åŒå­˜å‚¨åª’ä»‹çš„å»¶æ—¶å…³ç³»ï¼ŒL1å’ŒL2è¯»å–æ—¶é—´ä¸ºçº³ç§’çº§ï¼ŒMemoryè¯»å–æ—¶é—´ä¸ºçº³ç§’çº§ï¼Œå‘é€æ•°æ®åŒ…çš„æ—¶é—´ä¸ºæ¯«ç§’çº§ã€‚

é‚£ä¹ˆï¼Œå‘é€æ•°æ®åŒ…çš„æ—¶é—´ï¼ˆ150msï¼‰é™¤ä»¥Memoryè¯»å–æ—¶é—´ï¼ˆ100nsï¼‰ç­‰äº 1500000ï¼Œä¹Ÿå°±æ˜¯è¯´ç½‘ç»œé—´çš„ä¼ è¾“æ¯”å†…å­˜ä¼ è¾“æ…¢äº†150ä¸‡å€ï¼Œå·®å¼‚ä¸€ä¸‹å°±ä½“ç°å‡ºæ¥äº†ã€‚ç°åœ¨æˆ‘æƒ³ä½ åº”è¯¥ç†è§£äº†ï¼Œç¼“å­˜çš„å¢åŠ ï¼Œå¯¹æ¥å£å“åº”æ—¶é—´çš„å‡å°‘æœ‰ç€è´¨çš„é£è¶Šã€‚

è§£å¼€äº†ä¸ºä»€ä¹ˆå¢åŠ ç¼“å­˜çš„ç–‘æƒ‘åï¼Œæˆ‘ä»¬è¿›å…¥æ­£é¢˜çœ‹çœ‹æ€ä¹ˆåœ¨ç½‘å…³è¿™è¾¹å¢åŠ ç¼“å­˜åŠŸèƒ½ã€‚

## 1.ç®€å•å¤„ç†

ä½ å¯èƒ½ä¼šè¯´è¿™ä¸æ˜¯å°èœä¸€ç¢Ÿï¼Œå¯ä»¥åœ¨ç½‘å…³å‘æƒé™ç³»ç»Ÿå‘èµ·è°ƒç”¨ä¹‹å‰ï¼Œå¢åŠ ä¸€å±‚ç¼“å­˜æ¨¡å—ï¼Œç³»ç»Ÿä¹‹é—´çš„è°ƒç”¨è¿™ä¹ˆè®¾è®¡ï¼š

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/c4/7b/c4cefbaafdab926d3e9980163deeb67b.jpg?wh=1920x700)

ç½‘å…³å…ˆæŸ¥è¯¢ç¼“å­˜ï¼Œæœ‰æ•°æ®åˆ™ç›´æ¥ä½¿ç”¨ï¼Œæ²¡æœ‰æ•°æ®å†å‘èµ·è¿œç¨‹è°ƒç”¨ï¼Œæ‹¿åˆ°è¿œç¨‹è°ƒç”¨çš„ç»“æœåå†æ”¾åˆ°ç¼“å­˜ä¸­ã€‚å¤§å¤§å‡å°‘äº†è¿œç¨‹è°ƒç”¨çš„æ¬¡æ•°ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæƒé™ç³»ç»ŸæŸ¥è¯¢æ•°æ®åº“çš„é¢‘æ¬¡å°±é™ä½äº†ï¼Œæƒé™ç³»ç»ŸæŸ¥è¯¢æ•°æ®åº“çš„æ€§èƒ½è‡ªç„¶å°±å›å½’æ­£å¸¸äº†ã€‚ç‰ºç‰²ç©ºé—´æ¥æ¢å–æ—¶æ•ˆçš„æå‡ï¼Œè¾¾åˆ°äº†æ›²çº¿æ•‘å›½çš„ç›®çš„ã€‚

ä»£ç å¯ä»¥è¿™æ ·æ”¹é€ ï¼š

```java
public class InvokeCacheFacade {
    // å¼•ç”¨ä¸‹æ¸¸æŸ¥è¯¢è§’è‰²ä¿¡æ¯åˆ—è¡¨çš„æ¥å£
    @DubboReference
    private RoleQueryFacade roleQueryFacade;
    // å¼•ç”¨ä¸‹æ¸¸æŸ¥è¯¢èœå•ä¿¡æ¯åˆ—è¡¨çš„æ¥å£
    @DubboReference
    private MenuQueryFacade menuQueryFacade;
    // å¼•ç”¨ä¸‹æ¸¸æŸ¥è¯¢èœå•ä¿¡æ¯åˆ—è¡¨çš„æ¥å£
    @DubboReference
    private UserQueryFacade userQueryFacade;
    
    public void invokeCache(){
        // å¾ªç¯ 3 æ¬¡ï¼Œæ¨¡æ‹Ÿç½‘å…³è¢« App è¯·æ±‚è°ƒç”¨äº† 3 æ¬¡
        for (int i = 1; i <= 3; i++) {
            // æŸ¥è¯¢è§’è‰²ä¿¡æ¯åˆ—è¡¨
            String roleRespMsg = null;
            // æ£€æŸ¥æœ‰æ²¡æœ‰ç¼“å­˜è§’è‰²ä¿¡æ¯åˆ—è¡¨çš„æ•°æ®
            if (hasCachedQueryRoleList("Geek")) {
                // æœ‰ç¼“å­˜åˆ™ç›´æ¥ä½¿ç”¨
                roleRespMsg = queryCachedQueryRoleList("Geek");
            } else {
                // æ²¡ç¼“å­˜åˆ™ç»§ç»­è°ƒç”¨è¿œç¨‹
                roleRespMsg = roleQueryFacade.queryRoleList("Geek");
                if (roleRespMsg != null) {
                    // æ‹¿åˆ°è¿œç¨‹ç»“æœåå†å­˜å‚¨åˆ°ç¼“å­˜ä¸­
                    cacheQueryRoleListResult(roleRespMsg);
                }
            }
            // æŸ¥è¯¢èœå•ä¿¡æ¯åˆ—è¡¨
            String menuRespMsg = null;
            // æ£€æŸ¥æœ‰æ²¡æœ‰ç¼“å­˜èœå•ä¿¡æ¯åˆ—è¡¨çš„æ•°æ®
            if (hasCachedQueryAuthorizedMenuList("Geek")) {
                // æœ‰ç¼“å­˜åˆ™ç›´æ¥ä½¿ç”¨
                menuRespMsg = queryCachedQueryAuthorizedMenuList("Geek");
            } else {
                // æ²¡ç¼“å­˜åˆ™ç»§ç»­è°ƒç”¨è¿œç¨‹
                menuRespMsg = menuQueryFacade.queryAuthorizedMenuList("Geek");
                if (menuRespMsg != null) {
                    // æ‹¿åˆ°è¿œç¨‹ç»“æœåå†å­˜å‚¨åˆ°ç¼“å­˜ä¸­
                    cacheQueryAuthorizedMenuListResult(roleRespMsg);
                }
            }
            // æŸ¥è¯¢ç™»å½•ç”¨æˆ·ç®€æƒ…
            String userRespMsg = userQueryFacade.queryUser("Geek");
            // æ‰“å°è¿œç¨‹è°ƒç”¨çš„ç»“æœï¼Œçœ‹çœ‹æ˜¯èµ°ç¼“å­˜è¿˜æ˜¯èµ°è¿œç¨‹
            String idx = new DecimalFormat("00").format(i);
            System.out.println("ç¬¬ "+ idx + " æ¬¡è°ƒç”¨ã€è§’è‰²ä¿¡æ¯åˆ—è¡¨ã€‘ç»“æœä¸º: " + roleRespMsg);
            System.out.println("ç¬¬ "+ idx + " æ¬¡è°ƒç”¨ã€èœå•ä¿¡æ¯åˆ—è¡¨ã€‘ç»“æœä¸º: " + menuRespMsg);
            System.out.println("ç¬¬ "+ idx + " æ¬¡è°ƒç”¨ã€ç™»å½•ç”¨æˆ·ç®€æƒ…ã€‘ç»“æœä¸º: " + userRespMsg);
            System.out.println();
        }
    }
}
```

ä¸»è¦åšäº† 2 ç‚¹æ”¹é€ ï¼š

1. æ‰¾åˆ°æŸ¥è¯¢è§’è‰²ä¿¡æ¯åˆ—è¡¨ã€æŸ¥è¯¢èœå•ä¿¡æ¯åˆ—è¡¨ä¸¤æ®µä»£ç çš„åˆ‡å…¥ç‚¹ï¼Œè¿›è¡Œç¼“å­˜æ”¹é€ ã€‚
2. è°ƒç”¨è¿œç¨‹ä¹‹å‰å…ˆæŸ¥ç¼“å­˜ï¼Œæœ‰å°±ç›´æ¥ä½¿ç”¨ï¼Œæ²¡æœ‰åˆ™ç»§ç»­è°ƒç”¨è¿œç¨‹ï¼Œå¾…æ‹¿åˆ°è¿œç¨‹çš„ç»“æœåå†æ¬¡ä¿å­˜åˆ°ç¼“å­˜ä¸­ã€‚

æ€»ä½“å°±æ˜¯æŒ‰ç…§æƒ¯æ€§æ€ç»´ï¼Œå“ªé‡Œè¦ç”¨åˆ°ï¼Œæˆ‘ä»¬å°±åœ¨å“ªé‡Œç¼“å­˜ä¸€ä¸‹ï¼Œä»£ç æ”¹å®Œåï¼Œä½ æœ‰æ²¡æœ‰å‘ç°è¿™ä¸ªæ”¹æ³•æœ‰ç‚¹ä¼¼æ›¾ç›¸ä¼¼ï¼Ÿæ²¡é”™ï¼Œå’Œä¸Šä¸€è®²â€œ[å‚æ•°éªŒè¯](https://time.geekbang.org/column/article/613339)â€æœ‰ç€åŒæ ·çš„é…æ–¹ï¼ŒåŒæ ·çš„åä»£ç å‘³é“ã€‚

é‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬ä¹Ÿå­¦ä¹ â€œå‚æ•°éªŒè¯â€çš„ç»Ÿä¸€å¤„ç†æ–¹å¼ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯å¯ä»¥æç‚¼ä¸€ä¸‹ï¼Œè°ƒç”¨Aæ¥å£çš„æ—¶å€™æœ‰ç¼“å­˜çš„è¯‰æ±‚ï¼Œå¦‚æœè°ƒç”¨Bã€Cæ¥å£ä¹Ÿæœ‰ç¼“å­˜çš„è¯‰æ±‚ï¼Œåªè¦ç¨å¾®é…ç½®ä¸€ä¸‹ï¼Œå°±å¯ä»¥ç¼“å­˜è°ƒç”¨ç»“æœäº†ã€‚

## 2.å¥—ç”¨æºç 

å¥½ï¼Œæˆ‘ä»¬é¡ºç€â€œå‚æ•°éªŒè¯â€çš„ç»Ÿä¸€å¤„ç†æ€è·¯æ•´ç†ä¸€ä¸‹ï¼š

- é¦–å…ˆï¼Œå¾—å®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œç›®çš„æ˜¯æ‹¦æˆªæ‰€æœ‰è°ƒç”¨å‡ºå»çš„æ¥å£åšç‚¹ç¼“å­˜çš„é€»è¾‘ã€‚
- å…¶æ¬¡ï¼Œé€šè¿‡è¿‡æ»¤å™¨çš„ invocation å¯¹è±¡ï¼Œå¯»æ‰¾æ„å»ºç¼“å­˜ key çš„è§„åˆ™æ ‡å‡†ã€‚
- æœ€åï¼Œå®ç°ä¸€å¥—é€šè¿‡ key æŸ¥æ‰¾ç¼“å­˜æ•°æ®çš„é€»è¾‘ã€‚

ä¸‹é¢è¦å¼€å§‹ç¼–å†™ä»£ç äº†ã€‚

ä¸è¿‡åˆ«æ€¥ï¼Œè¿˜è®°å¾—ä¸Šä¸€è®²å­¦è¿‡çš„å°æŠ€å·§å—ï¼Œ**åƒè¿‡æ»¤å™¨è¿™ç§å…·æœ‰æ‹¦æˆªæ‰€æœ‰è¯·æ±‚æœºåˆ¶åŠŸèƒ½çš„ç±»ï¼Œä¸€å®šè¦å…ˆçœ‹çœ‹ä½ æ‰€åœ¨ç³»ç»Ÿçš„ç›¸å…³åº•å±‚èƒ½åŠ›æ”¯æ’‘ï¼Œå¦‚æœç±»ä¼¼çš„åŠŸèƒ½å­˜åœ¨ï¼Œæˆ‘ä»¬å°±èƒ½ç‰©å°½å…¶ç”¨ã€‚**

æŒ‰ç…§å°æŠ€å·§æ¥çœ‹ org.apache.dubbo.rpc.Filter æ¥å£çš„å®ç°ç±»ï¼Œå¯»æ‰¾æœ‰æ²¡æœ‰ç¼“å­˜è‹±æ–‡å•è¯çš„ç±»åï¼Œä½ ä¼šå‘ç°è¿˜çœŸæœ‰ä¸€ä¸ªå« CacheFilter åå­—çš„ç±»ï¼Œçœ‹èµ·æ¥åƒæ˜¯ç¼“å­˜è¿‡æ»¤å™¨ï¼Œå’±ä»¬ç›´æ¥è¿›å…¥æºç æ¢ä¸ªç©¶ç«Ÿã€‚

çœ‹æºç ï¼Œä½ è¦å…»æˆå…ˆçœ‹ç±»æ³¨é‡Šçš„ä¹ æƒ¯ï¼š

```makefile
CacheFilter is a core component of dubbo.Enabling cache key of service,method,consumer or provider dubbo will cache method return value. Along with cache key we need to configure cache type. Dubbo default implemented cache types areï¼š
lru
threadlocal
jcache
expiring
```

å¯ä»¥å¾—çŸ¥ 3 ä¸ªæœ‰ç”¨çš„ä¿¡æ¯ï¼š

- CacheFilter æ˜¯ Dubbo çš„ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶ã€‚
- å¯ç”¨ç¼“å­˜é”®å±æ€§ï¼Œå°†ä¼šç¼“å­˜ method çš„è¿”å›å€¼ã€‚
- éœ€è¦ä¸ºç¼“å­˜é”®å±æ€§é…ç½®ç¼“å­˜ç±»å‹ï¼Œç±»å‹æœ‰ lruã€threadlocalã€jcacheã€expiring å››ç§ã€‚

çœ‹å®Œè¿™æ ·çš„æ³¨é‡Šä¿¡æ¯åï¼Œæˆ‘ä»¬å¿ƒé‡Œæœ‰åº•äº†ï¼Œé€šè¿‡ç®€çŸ­çš„3ç‚¹è²Œä¼¼èƒ½æ»¡è¶³ç¼“å­˜è°ƒç”¨ç»“æœçš„è¯‰æ±‚ï¼Œç„¶è€Œï¼Œè¯¥æ€ä¹ˆç®€å•é…ç½®å‘¢ï¼Ÿ

æˆ‘ä»¬ç»§ç»­çœ‹æ³¨é‡Šï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†æ³¨é‡Šæ˜¯æ•™æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨ç¼“å­˜çš„ï¼š

```makefile
e.g. 1)<dubbo:service cache="lru" />
Â  Â  Â 2)<dubbo:service /> <dubbo:method name="method2" cache="threadlocal" /> <dubbo:service/>
Â  Â  Â 3)<dubbo:provider cache="expiring" />
Â  Â  Â 4)<dubbo:consumer cache="jcache" />
```

æ³¨é‡Šä¸­å‘Šè¯‰æˆ‘ä»¬æœ‰ 4 ç§æ–¹å¼å¯ç”¨ç¼“å­˜ï¼Œåˆ†åˆ«æ˜¯ &lt;dubbo:service/&gt;ã€&lt;dubbo:method/&gt;ã€&lt;dubbo:provider/&gt;ã€&lt;dubbo:consumer/&gt; å››ç§æ ‡ç­¾ï¼Œè€Œä¸”ä»æ ‡ç­¾ä¸­å¯ä»¥æ›´ä¸ºç›´è§‚åœ°çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨æä¾›æ–¹ã€æ¶ˆè´¹æ–¹éƒ½å¯ä»¥å¯¹æ–¹æ³•çš„ç»“æœè¿›è¡Œç¼“å­˜ã€‚

è¿˜æ˜¯ Dubbo æ¡†æ¶çš„è®¾è®¡è€…æƒ³çš„å‘¨åˆ°ï¼æˆ‘ä»¬åŸæœ¬åªæƒ³ç€åœ¨æ¶ˆè´¹æ–¹è°ƒç”¨æ—¶å°†ç»“æœç¼“å­˜ä¸€ä¸‹ï¼Œä»æºç ä¸­å¾—çŸ¥ Dubbo åœ¨æä¾›æ–¹åŒæ ·å¯ä»¥ç¼“å­˜æ–¹æ³•ç»“æœï¼Œç¼“å­˜åŠŸèƒ½çš„é€šç”¨æ€§è®¾è®¡éå¸¸å®Œå–„ã€‚

è¿™é‡ŒèŠç‚¹é¢˜å¤–è¯ï¼Œ**ä¸ºä»€ä¹ˆæˆ‘ä»¬èƒ½å¦‚æ­¤å¿«é€Ÿåœ°æ‰¾åˆ°æ‰€éœ€çš„å®ç°ç±»å‘¢ï¼Ÿä¼˜ç§€çš„æºç ä¸»è¦æœ‰ 2 ç‚¹æˆ‘ä»¬å¯ä»¥é‡ç‚¹å­¦ä¹ **ï¼š

- åŠŸèƒ½å¯¹åº”ç±»çš„å•è¯å‘½åå°½é‡ç®€å•æ˜“æ‡‚ï¼Œä½¿ç”¨ä¸åŠŸèƒ½å«ä¹‰è´´è¿‘ä¸”å¤§ä¼—ç†ŸçŸ¥çš„å•è¯ã€‚
- ç±»çš„æ³¨é‡Šä¿¡æ¯è¦æœ‰ 3 å—ï¼Œç¬¬ 1 å—é‡ç‚¹è¯´æ˜è¯¥ç±»çš„ç”¨é€”ï¼Œç¬¬ 2 å—è¯¦ç»†å‘Šè¯‰åˆ«äººæ€ä¹ˆä½¿ç”¨ï¼Œç¬¬ 3 å—ç®€å•åˆ—å‡ºä¸æ­¤åŠŸèƒ½å…³è”éå¸¸ç´§å¯†çš„ç›¸å…³ç±»çš„æŒ‡å¼•ã€‚

è¿™ 2 ç‚¹å¯¹æºç é˜…è¯»è€…æ¥è¯´éå¸¸å…³é”®ã€‚å°†å¿ƒæ¯”å¿ƒï¼Œå½“ä½ é˜…è¯»åˆ«äººä»£ç çš„æ—¶å€™ï¼Œå¦‚æœç±»åå‘½åå¾ˆéšæ„ï¼Œè€Œä¸”æ¯«æ— æ³¨é‡Šä¿¡æ¯ï¼Œå³ä¾¿æ˜¯å†ç‰›é€¼çš„æ¡†æ¶ä¹Ÿæ²¡æœ‰äº†é˜…è¯»ä¸‹å»çš„æ¬²æœ›ã€‚æ‰€ä»¥ï¼Œä¸ç®¡æ˜¯å†™ä¸šåŠ¡ä»£ç è¿˜æ˜¯å†™æ’ä»¶ï¼Œæˆ‘ä»¬éƒ½éœ€è¦å°½é‡éµå®ˆ**è§åçŸ¥æ„**ã€**æ³¨é‡Šå®Œæ•´æ¸…æ™°**çš„è‡ªæˆ‘çº¦æŸã€‚

å¥½äº†ï¼Œå›åˆ°æ­£é¢˜ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥æ ¹æ®æºç æç¤ºçš„è§£å†³æ–¹æ¡ˆå»æ”¹é€ ä»£ç äº†ã€‚æ”¹é€ å¦‚ä¸‹ï¼š

```java
@Component
public class InvokeCacheFacade {
    // å¼•ç”¨ä¸‹æ¸¸æŸ¥è¯¢è§’è‰²ä¿¡æ¯åˆ—è¡¨çš„æ¥å£ï¼Œæ·»åŠ  cache = lru å±æ€§
    @DubboReference(cache = "lru")
    private RoleQueryFacade roleQueryFacade;
    // å¼•ç”¨ä¸‹æ¸¸æŸ¥è¯¢èœå•ä¿¡æ¯åˆ—è¡¨çš„æ¥å£ï¼Œæ·»åŠ  cache = lru å±æ€§
    @DubboReference(cache = "lru")
    private MenuQueryFacade menuQueryFacade;
    // å¼•ç”¨ä¸‹æ¸¸æŸ¥è¯¢èœå•ä¿¡æ¯åˆ—è¡¨çš„æ¥å£ï¼Œæ²¡æœ‰æ·»åŠ ç¼“å­˜å±æ€§
    @DubboReference
    private UserQueryFacade userQueryFacade;
    
    public void invokeCache(){
        // å¾ªç¯ 3 æ¬¡ï¼Œæ¨¡æ‹Ÿç½‘å…³è¢« App è¯·æ±‚è°ƒç”¨äº† 3 æ¬¡
        for (int i = 1; i <= 3; i++) {
            // æŸ¥è¯¢è§’è‰²ä¿¡æ¯åˆ—è¡¨
            String roleRespMsg = roleQueryFacade.queryRoleList("Geek");
            // æŸ¥è¯¢èœå•ä¿¡æ¯åˆ—è¡¨
            String menuRespMsg = menuQueryFacade.queryAuthorizedMenuList("Geek");
            // æŸ¥è¯¢ç™»å½•ç”¨æˆ·ç®€æƒ…
            String userRespMsg = userQueryFacade.queryUser("Geek");
            
            // æ‰“å°è¿œç¨‹è°ƒç”¨çš„ç»“æœï¼Œçœ‹çœ‹æ˜¯èµ°ç¼“å­˜è¿˜æ˜¯èµ°è¿œç¨‹
            String idx = new DecimalFormat("00").format(i);
            System.out.println("ç¬¬ "+ idx + " æ¬¡è°ƒç”¨ã€è§’è‰²ä¿¡æ¯åˆ—è¡¨ã€‘ç»“æœä¸º: " + roleRespMsg);
            System.out.println("ç¬¬ "+ idx + " æ¬¡è°ƒç”¨ã€èœå•ä¿¡æ¯åˆ—è¡¨ã€‘ç»“æœä¸º: " + menuRespMsg);
            System.out.println("ç¬¬ "+ idx + " æ¬¡è°ƒç”¨ã€ç™»å½•ç”¨æˆ·ç®€æƒ…ã€‘ç»“æœä¸º: " + userRespMsg);
            System.out.println();
        }
    }
}
```

ä¸»è¦æ˜¯åœ¨å®šä¹‰ RoleQueryFacade å’Œ MenuQueryFacade çš„å­—æ®µ @DubboReference æ³¨è§£ä¸­ï¼Œæ·»åŠ äº† `cache = "lru"` çš„å±æ€§ï¼Œæ”¹é€ éå¸¸ç®€å•ã€‚

ä¿¡å¿ƒæ»¡æ»¡çš„ä½ ï¼Œè¿è¡Œäº† invokeCache æ–¹æ³•æƒ³çœ‹çœ‹æ”¹é€ æ•ˆæœï¼Œæ‰“å°å¦‚ä¸‹ï¼š

```java
ç¬¬ 01 æ¬¡è°ƒç”¨ã€è§’è‰²ä¿¡æ¯åˆ—è¡¨ã€‘ç»“æœä¸º: 2022-11-18_22:52:00.402: Hello Geek, å·²æŸ¥è¯¢è¯¥ç”¨æˆ·ã€è§’è‰²åˆ—è¡¨ä¿¡æ¯ã€‘
ç¬¬ 01 æ¬¡è°ƒç”¨ã€èœå•ä¿¡æ¯åˆ—è¡¨ã€‘ç»“æœä¸º: 2022-11-18_22:52:00.407: Hello Geek, å·²æŸ¥è¯¢è¯¥ç”¨æˆ·å·²æˆæƒçš„ã€èœå•åˆ—è¡¨ä¿¡æ¯ã€‘
ç¬¬ 01 æ¬¡è°ƒç”¨ã€ç™»å½•ç”¨æˆ·ç®€æƒ…ã€‘ç»“æœä¸º: 2022-11-18_22:52:00.411: Hello Geek, å·²æŸ¥è¯¢ã€ç”¨æˆ·ç®€å•ä¿¡æ¯ã€‘

ç¬¬ 02 æ¬¡è°ƒç”¨ã€è§’è‰²ä¿¡æ¯åˆ—è¡¨ã€‘ç»“æœä¸º: 2022-11-18_22:52:00.415: Hello Geek, å·²æŸ¥è¯¢è¯¥ç”¨æˆ·ã€è§’è‰²åˆ—è¡¨ä¿¡æ¯ã€‘
ç¬¬ 02 æ¬¡è°ƒç”¨ã€èœå•ä¿¡æ¯åˆ—è¡¨ã€‘ç»“æœä¸º: 2022-11-18_22:52:00.419: Hello Geek, å·²æŸ¥è¯¢è¯¥ç”¨æˆ·å·²æˆæƒçš„ã€èœå•åˆ—è¡¨ä¿¡æ¯ã€‘
ç¬¬ 02 æ¬¡è°ƒç”¨ã€ç™»å½•ç”¨æˆ·ç®€æƒ…ã€‘ç»“æœä¸º: 2022-11-18_22:52:00.422: Hello Geek, å·²æŸ¥è¯¢ã€ç”¨æˆ·ç®€å•ä¿¡æ¯ã€‘

ç¬¬ 03 æ¬¡è°ƒç”¨ã€è§’è‰²ä¿¡æ¯åˆ—è¡¨ã€‘ç»“æœä¸º: 2022-11-18_22:52:00.415: Hello Geek, å·²æŸ¥è¯¢è¯¥ç”¨æˆ·ã€è§’è‰²åˆ—è¡¨ä¿¡æ¯ã€‘
ç¬¬ 03 æ¬¡è°ƒç”¨ã€èœå•ä¿¡æ¯åˆ—è¡¨ã€‘ç»“æœä¸º: 2022-11-18_22:52:00.419: Hello Geek, å·²æŸ¥è¯¢è¯¥ç”¨æˆ·å·²æˆæƒçš„ã€èœå•åˆ—è¡¨ä¿¡æ¯ã€‘
ç¬¬ 03 æ¬¡è°ƒç”¨ã€ç™»å½•ç”¨æˆ·ç®€æƒ…ã€‘ç»“æœä¸º: 2022-11-18_22:52:00.426: Hello Geek, å·²æŸ¥è¯¢ã€ç”¨æˆ·ç®€å•ä¿¡æ¯ã€‘
```

â€œè§’è‰²ä¿¡æ¯åˆ—è¡¨â€åœ¨ç¬¬2æ¬¡å’Œç¬¬3æ¬¡çš„æ—¶é—´æˆ³ä¿¡æ¯æ˜¯ä¸€æ ·çš„ 415 ç»“å°¾ï¼Œâ€œèœå•ä¿¡æ¯åˆ—è¡¨â€åœ¨ç¬¬2æ¬¡å’Œç¬¬3æ¬¡çš„æ—¶é—´æˆ³ä¿¡æ¯ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œè€Œâ€œç™»å½•ç”¨æˆ·ç®€æƒ…â€çš„æ—¶é—´æˆ³æ¯æ¬¡éƒ½æ˜¯ä¸ä¸€æ ·ã€‚

æ—¥å¿—ä¿¡æ¯å¾ˆæœ‰åŠ›åœ°è¯´æ˜ç¼“å­˜åŠŸèƒ½ç”Ÿæ•ˆäº†ã€‚å—¯ï¼Œå‚ç…§æºç æä¾›çš„è§£å†³æ–¹æ¡ˆï¼Œç¡®å®æ”¹é€ çš„å¾ˆå¥½ã€‚

### æ”¹é€ æ€è€ƒ

ä¸è¿‡å®Œæˆåï¼Œæˆ‘ä»¬ä»ç„¶å¾—æ€è€ƒä¸‹æ”¹é€ çš„ä¸€äº›å½±å“ã€‚æ¯•ç«Ÿæ¯å¼•å…¥ä¸€ä¸ªç»„ä»¶ï¼ŒåŠ¿å¿…ä¼šå¯¼è‡´å¤æ‚åº¦çš„ä¸Šå‡ï¼Œéœ€è¦åšå¥½åˆ©å¼Šæƒè¡¡ã€‚

ç¼“å­˜ï¼Œè™½ç„¶æå‡äº†å¿«é€Ÿå“åº”çš„æ—¶æ•ˆï¼Œä½†åŒæ—¶ä¹Ÿå¸¦æ¥äº†ä¸€äº›é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä»å†…å­˜å®¹é‡ã€ç¼“å­˜æ•°æ®å¦‚ä½•å®Œæˆåˆ·æ–°å’Œè¿‡æœŸå‰”é™¤ã€æµé‡å³°å€¼å¯èƒ½å¼•å‘çš„ç¼“å­˜é›ªå´©ã€ç©¿é€ã€å‡»ç©¿ç­‰æ–¹é¢è€ƒè™‘ï¼Œå½“ç„¶è¿™äº›éƒ½æ˜¯æ¯”è¾ƒåŸºæœ¬ï¼Œå½“é¡¹ç›®å¤æ‚æ—¶è¿˜è¦è€ƒè™‘æœ‰æ›´å¤šå¤æ‚å› ç´ ã€‚æˆ‘ä»¬å…ˆä¸€ä¸ªä¸ªçœ‹ã€‚

**1.æ”¹é€ æ–¹æ¡ˆçš„æ•°æ®æ˜¯å­˜å‚¨åœ¨ JVM å†…å­˜ä¸­ï¼Œé‚£ä¼šä¸ä¼šæ’‘çˆ†å†…å­˜å‘¢ï¼Ÿ**

æˆ‘ä»¬ç›˜ç®—ä¸€ä¸‹ï¼Œå‡è®¾è§’è‰²ä¿¡æ¯åˆ—è¡¨å’Œèœå•ä¿¡æ¯åˆ—è¡¨å ç”¨å†…å­˜æ€»å’Œçº¦ä¸º 1024 å­—èŠ‚ï¼Œé¢„ä¼°æœ‰ 50 ä¸‡ç”¨æˆ·ä½“é‡ï¼Œé‚£ä¹ˆæœ€ç»ˆæ€»å…±å ç”¨ 50W * 1024å­—èŠ‚ â‰ˆ 488.28 å…†ï¼Œç›®å‰ç½‘å…³çš„è€å¹´ä»£å¤§å°çº¦ä¸º 1200 å…†ï¼Œæ˜¯ä¸ä¼šæ’‘çˆ†å†…å­˜çš„ã€‚è¿™ä¸ªé—®é¢˜è§£å†³ã€‚

**2.å¦‚æœæŸäº›ç”¨æˆ·çš„æƒé™å‘ç”Ÿäº†å˜æ›´ï¼Œä»å˜æ›´å®Œæˆåˆ°èƒ½ä½¿ç”¨æœ€æ–°æ•°æ®çš„å®¹å¿æ—¶é—´é—´éš”æ˜¯å¤šå°‘ï¼Œå¦‚ä½•å®Œæˆå†…å­˜æ•°æ®çš„åˆ·æ–°æ“ä½œå‘¢ï¼Ÿ**

ç›®å‰æ”¹é€ æ–¹æ¡ˆä½¿ç”¨çš„æ˜¯ `cache = "lru"` ç¼“å­˜ç­–ç•¥ï¼Œè™½ç„¶æˆ‘ä»¬å¯¹åº•å±‚çš„å®ç°ç»†èŠ‚ä¸€æ¦‚ä¸çŸ¥ï¼Œä½†ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¥½èƒ†æ€¯çš„ï¼Œå¼€å¯ debug æ¨¡å¼å» CacheFilter ä¸­è°ƒè¯•ä¸€ç•ªï¼š

```java
// è¿‡æ»¤å™¨è¢«è§¦å‘è°ƒç”¨çš„å…¥å£
org.apache.dubbo.cache.filter.CacheFilter#invoke
                  â†“
// æ ¹æ® invoker.getUrl() è·å–ç¼“å­˜å®¹å™¨
org.apache.dubbo.cache.support.AbstractCacheFactory#getCache
                  â†“
// è‹¥ç¼“å­˜å®¹å™¨æ²¡æœ‰çš„è¯ï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªç¼“å­˜å®¹å™¨
org.apache.dubbo.cache.support.lru.LruCacheFactory#createCache
                  â†“
// æœ€ç»ˆåˆ›å»ºçš„æ˜¯ä¸€ä¸ª LruCache å¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„å†…éƒ¨ä½¿ç”¨çš„ LRU2Cache å­˜å‚¨æ•°æ®             
org.apache.dubbo.cache.support.lru.LruCache#LruCache
// å­˜å‚¨è°ƒç”¨ç»“æœçš„å¯¹è±¡
private final Map<Object, Object> store;
public LruCache(URL url) {
    final int max = url.getParameter("cache.size", 1000);
    this.store = new LRU2Cache<>(max);
}
                  â†“
// LRU2Cache çš„å¸¦å‚æ„é€ æ–¹æ³•ï¼Œåœ¨ LruCache æ„é€ æ–¹æ³•ä¸­ï¼Œé»˜è®¤ä¼ å…¥çš„å¤§å°æ˜¯ 1000                  
org.apache.dubbo.common.utils.LRU2Cache#LRU2Cache(int)
public LRU2Cache(int maxCapacity) {
    super(16, DEFAULT_LOAD_FACTOR, true);
    this.maxCapacity = maxCapacity;
    this.preCache = new PreCache<>(maxCapacity);
}
// è‹¥ç»§ç»­æ”¾æ•°æ®æ—¶ï¼Œè‹¥å‘ç°ç°æœ‰æ•°æ®ä¸ªæ•°å¤§äº maxCapacity æœ€å¤§å®¹é‡çš„è¯
// åˆ™ä¼šè€ƒè™‘æŠ›å¼ƒæ‰æœ€å¤è€çš„ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯ä¼šæŠ›å¼ƒæœ€æ—©è¿›å…¥ç¼“å­˜çš„é‚£ä¸ªå¯¹è±¡
@Override
protected boolean removeEldestEntry(java.util.Map.Entry<K, V> eldest) {
    return size() > maxCapacity;
}
                  â†“
// JDK ä¸­çš„ LinkedHashMap æºç åœ¨å‘ç”ŸèŠ‚ç‚¹æ’å…¥å
// ç»™äº†å­ç±»ä¸€ä¸ªæ‰©å±•åˆ é™¤æœ€æ—§æ•°æ®çš„æœºåˆ¶                   
java.util.LinkedHashMap#afterNodeInsertion
void afterNodeInsertion(boolean evict) { // possibly remove eldest
    LinkedHashMap.Entry<K,V> first;
    if (evict && (first = head) != null && removeEldestEntry(first)) {
        K key = first.key;
        removeNode(hash(key), key, null, false, true);
    }
}
```

ä¸€è·¯è·Ÿè¸ªæºç ï¼Œæœ€ç»ˆå‘ç°äº†åº•å±‚å­˜å‚¨æ•°æ®çš„æ˜¯ä¸€ä¸ªç»§æ‰¿äº† LinkedHashMap çš„ç±»ï¼Œå³ LRU2Cacheï¼Œå®ƒé‡å†™äº†çˆ¶ç±» LinkedHashMap ä¸­çš„ removeEldestEntry æ–¹æ³•ï¼Œå½“ LRU2Cache å­˜å‚¨çš„æ•°æ®ä¸ªæ•°å¤§äºè®¾ç½®çš„å®¹é‡åï¼Œä¼šåˆ é™¤æœ€å…ˆå­˜å‚¨çš„æ•°æ®ï¼Œè®©æœ€æ–°çš„æ•°æ®èƒ½å¤Ÿä¿å­˜è¿›æ¥ã€‚

æ‰€ä»¥å®¹å¿çš„æ—¶é—´é—´éš”å…¶å®æ˜¯ä¸ç¡®å®šçš„ï¼Œå› ä¸ºè¯·æ±‚æµé‡çš„ä¸ç¡®å®šæ€§ï¼ŒLRU2Cache çš„å®¹é‡ä¸çŸ¥é“å¤šä¹…æ‰èƒ½æ‰“æ»¡ï¼Œè€Œåˆ·æ–°æ“ä½œä¹Ÿæ˜¯ä¾èµ–äºå®¹é‡è¢«æ‰“æ»¡åå‰”é™¤æœ€æ—§æ•°æ®çš„æœºåˆ¶ï¼Œæ‰€ä»¥å®¹å¿çš„æ—¶é—´é—´éš”å’Œåˆ·æ–°çš„æ—¶æ•ˆéƒ½å­˜åœ¨ä¸ç¡®å®šæ€§ã€‚

**3.æ¯ç§’çš„è¯·æ±‚æµé‡å³°å€¼æ˜¯å¤šå°‘å‘¢ï¼Œä¼šå¼•å‘ç¼“å­˜é›ªå´©ã€ç©¿é€ã€å‡»ç©¿ä¸‰å¤§æ•ˆåº”ä¹ˆï¼Ÿ**

ä»æƒé™ç³»ç»Ÿçš„å•æœºæŸ¥è¯¢æ•°æ®åº“é«˜è¾¾500å¤šçš„QPSå¯ä»¥å¤§æ¦‚å¾—çŸ¥ï¼Œç›®å‰ç½‘å…³æ¥æ”¶é¦–é¡µåŠ è½½çš„è¯·æ±‚åœ¨500å¤šQPSå·¦å³ã€‚

å¦‚æœç”¨æˆ·éƒ½åœ¨æ—©ä¸Šçš„ä¸Šç­æ—¶åˆ»æ‰“å¼€Appï¼Œå› ä¸ºæ¯ä¸ªç”¨æˆ·ç¬¬ä¸€æ¬¡è¯·æ±‚åœ¨ç½‘å…³æ˜¯æ²¡æœ‰ç¼“å­˜æ•°æ®çš„ï¼Œç¬¬äºŒæ¬¡å‘èµ·çš„è¯·æ±‚å°±å¯ä»¥ä½¿ç”¨ä¸Šç¼“å­˜æ•°æ®äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦æ’‘è¿‡ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼Œåé¢çš„ç¬¬äºŒæ¬¡ä¹ƒè‡³ç¬¬Næ¬¡è¯·æ±‚å°±ä¼šæ”¹å–„å¾ˆå¤šã€‚å¯ä»¥åæ¨å‡ºï¼ŒLruCache çš„æ„é€ æ–¹æ³•ä¸­cache.size å‚æ•°è®¾ç½®è‡³å…³é‡è¦ã€‚

å½“ç„¶é—®é¢˜è¿˜æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ç½‘å…³ç³»ç»Ÿåªæœ‰è¿™ä¸ªé¦–é¡µåŠ è½½çš„è¯·æ±‚éœ€è¦ç¼“å­˜ä¹ˆï¼Œæ˜¯å¦è¿˜æœ‰å…¶ä»–çš„åŠŸèƒ½ä¹Ÿç”¨äº†ç¼“å­˜å ç”¨äº† JVM å†…å­˜ï¼Ÿ

è¿™ä¹ˆé—®ä¸‹å»ï¼Œæˆ‘ä»¬ç®€å•åœ°ç”¨ä¸ª lru ç­–ç•¥å·²ç»æ‹›æ¶ä¸ä½äº†ï¼Œè¯¥ç»§ç»­æƒ³å…¶ä»–æ³•å­äº†ã€‚

## æ·±æŒ–æºç 

åˆšåˆšåªæ˜¯ç”¨äº† lru ç­–ç•¥ï¼Œæˆ‘ä»¬è¿˜æœ‰å¦å¤– threadlocalã€jcacheã€expiring ä¸‰ä¸ªç­–ç•¥å¯ä»¥æ›¿æ¢ï¼Œå…ˆåˆ°è¿™ä¸‰ä¸ªç­–ç•¥å¯¹åº”çš„ç¼“å­˜å·¥å‚ç±»ä¸­å»çœ‹çœ‹ç±»æ³¨é‡Šä¿¡æ¯ï¼š

- threadlocalï¼Œä½¿ç”¨çš„æ˜¯ ThreadLocalCacheFactory å·¥å‚ç±»ï¼Œç±»åä¸­ ThreadLocal æ˜¯æœ¬åœ°çº¿ç¨‹çš„æ„æ€ï¼Œè€Œ ThreadLocal æœ€ç»ˆè¿˜æ˜¯ä½¿ç”¨çš„æ˜¯ JVM å†…å­˜ã€‚
- jcacheï¼Œä½¿ç”¨çš„æ˜¯ JCacheFactory å·¥å‚ç±»ï¼Œæ˜¯æä¾› javax-spi ç¼“å­˜å®ä¾‹çš„å·¥å‚ç±»ï¼Œæ—¢ç„¶æ˜¯ä¸€ç§ spi æœºåˆ¶ï¼Œå¯ä»¥æ¥å…¥å¾ˆå¤šè‡ªåˆ¶çš„å¼€æºæ¡†æ¶ã€‚
- expiringï¼Œä½¿ç”¨çš„æ˜¯ ExpiringCacheFactory å·¥å‚ç±»ï¼Œå†…éƒ¨çš„ ExpiringCache ä¸­è¿˜æ˜¯ä½¿ç”¨çš„ Map æ•°æ®ç»“æ„æ¥å­˜å‚¨æ•°æ®ï¼Œä»ç„¶ä½¿ç”¨çš„æ˜¯ JVM å†…å­˜ã€‚

ä»è¿™ä¸‰ç§ç­–ç•¥æ¥çœ‹ï¼Œthreadlocal å’Œ expiring ä¸¤ç§ç­–ç•¥ä½¿ç”¨çš„è¿˜æ˜¯ JVM å†…å­˜æ¥å­˜å‚¨æ•°æ®ï¼Œå’Œ lru ç­–ç•¥æœ‰ç€æœ¬è´¨çš„å…±åŒæ€§ï¼Œç”±äº JVM å†…å­˜çš„æœ‰é™æ€§ï¼Œæ— æ³•æ”¯æ’‘æ›´å¤šçš„æ¥å£å…·æœ‰ç¼“å­˜ç‰¹æ€§ï¼Œå¦‚æœç¨ä¸ç•™ç¥ï¼Œå¾ˆå¯èƒ½å¯¼è‡´ç½‘å…³å†…å­˜æº¢å‡ºæˆ–æƒé™ç³»ç»Ÿçš„æ•°æ®åº“è¢«æ‰“çˆ†ã€‚é‚£æŠŠ `cache = "lru"` æ¢æˆ `cache = "jcache"` è¯•è¯•ï¼Œè¿™æ ·å¥½æ­¹å¯ä»¥ä½¿ç”¨ä¸€äº›å¼€æºæ¡†æ¶æ¥è¿›è¡Œç¼“å­˜äº†ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ ¹æ®æŠ¥é”™ä¿¡æ¯å¼€å¯ä¸€æ®µæºç æ¢ç´¢ä¹‹æ—…ï¼Œè·³è½¬æ¯”è¾ƒå¤šï¼Œä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ç‰¹åœ°å½•åˆ¶äº†ä¸€æ®µè§†é¢‘ï¼Œä½ å¯ä»¥é…åˆæ–‡å­—ä¸€èµ·å­¦ä¹ ï¼š

æ”¹å®Œä»£ç åæˆ‘ä»¬ç»§ç»­è¿è¡Œï¼Œä¸å·§çš„æ˜¯å¯åŠ¨å°±æŠ¥é”™äº†ï¼š

```java
Caused by: java.lang.NoClassDefFoundError: javax/cache/Caching
	at org.apache.dubbo.cache.support.jcache.JCache.<init>(JCache.java:54)
	at org.apache.dubbo.cache.support.jcache.JCacheFactory.createCache(JCacheFactory.java:45)
	at org.apache.dubbo.cache.support.AbstractCacheFactory.getCache(AbstractCacheFactory.java:74)
	at org.apache.dubbo.cache.CacheFactory$Adaptive.getCache(CacheFactory$Adaptive.java)
	at org.apache.dubbo.cache.filter.CacheFilter.invoke(CacheFilter.java:95)
	at org.apache.dubbo.rpc.cluster.filter.FilterChainBuilder$CopyOfFilterChainNode.invoke(FilterChainBuilder.java:321)
	at org.apache.dubbo.rpc.cluster.filter.FilterChainBuilder$CallbackRegistrationInvoker.invoke(FilterChainBuilder.java:193)
	at org.apache.dubbo.rpc.cluster.support.AbstractClusterInvoker.invokeWithContext(AbstractClusterInvoker.java:378)
	at org.apache.dubbo.rpc.cluster.support.FailoverClusterInvoker.doInvoke(FailoverClusterInvoker.java:80)
	... 25 more
```

ä»æŠ¥é”™ä¿¡æ¯ä¸­ï¼Œå‘ç°äº† NoClassDefFoundError å¼‚å¸¸ä¿¡æ¯ï¼Œè€Œè¯¥é”™è¯¯æ˜¯å‘ç”Ÿåœ¨ JVM è¿è¡Œæ—¶ï¼Œæ ¹æ®å·¥ç¨‹ä»£ç ä¸­çš„ç±»åï¼Œåœ¨ classpath è¿›è¡Œç±»åŠ è½½æ—¶æ‰¾ä¸åˆ°è¿™ä¸ªç±»ï¼Œå°±å‡ºç°äº†è¿™ä¸ªé”™è¯¯ã€‚

æ—¢ç„¶æŠ¥é”™è¿™ä¹ˆæ˜æ˜¾ï¼Œç›´æ¥æŠŠ javax/cache/Caching æ”¾åˆ°ç™¾åº¦ä¸­æœç´¢ä¸€ä¸‹ï¼Œå°±å¯ä»¥å¾—å‡ºç­”æ¡ˆå¦‚ä¸‹ï¼š

```java
<dependency>
  <groupId>javax.cache</groupId>
  <artifactId>cache-api</artifactId>
</dependency>
```

æ¥ä¸‹æ¥**æŠŠ cache-api è¿™ä¸ª maven åæ ‡æ·»åŠ åˆ°å·¥ç¨‹ä¸­ï¼Œæˆ‘ä»¬å†æ¬¡è¿è¡Œ invokeCache æ–¹æ³•**ï¼Œç»“æœåˆæŠ¥é”™äº†ï¼š

```java
Caused by: javax.cache.CacheException: No CachingProviders have been configured
	at javax.cache.Caching$CachingProviderRegistry.getCachingProvider(Caching.java:391)
	at javax.cache.Caching$CachingProviderRegistry.getCachingProvider(Caching.java:361)
	at javax.cache.Caching.getCachingProvider(Caching.java:151)
	at org.apache.dubbo.cache.support.jcache.JCache.<init>(JCache.java:54)
	at org.apache.dubbo.cache.support.jcache.JCacheFactory.createCache(JCacheFactory.java:45)
	at org.apache.dubbo.cache.support.AbstractCacheFactory.getCache(AbstractCacheFactory.java:74)
	at org.apache.dubbo.cache.CacheFactory$Adaptive.getCache(CacheFactory$Adaptive.java)
	at org.apache.dubbo.cache.filter.CacheFilter.invoke(CacheFilter.java:95)
	at org.apache.dubbo.rpc.cluster.filter.FilterChainBuilder$CopyOfFilterChainNode.invoke(FilterChainBuilder.java:321)
	at org.apache.dubbo.rpc.cluster.filter.FilterChainBuilder$CallbackRegistrationInvoker.invoke(FilterChainBuilder.java:193)
	at org.apache.dubbo.rpc.cluster.support.AbstractClusterInvoker.invokeWithContext(AbstractClusterInvoker.java:378)
	at org.apache.dubbo.rpc.cluster.support.FailoverClusterInvoker.doInvoke(FailoverClusterInvoker.java:80)
	... 25 more
```

æŠ¥é”™ä¿¡æ¯å‡ºç°äº†ä¸€ä¸ªä»æ¥æ²¡è§è¿‡çš„ CacheException ç¼“å­˜å¼‚å¸¸çš„ç±»ï¼Œè€Œä¸”è¿˜æç¤º `No CachingProviders have been configured` æ²¡æœ‰é…ç½®ç¼“å­˜æä¾›è€…ï¼Œè¿™æ˜¯ä»€ä¹ˆç¼˜æ•…å‘¢ï¼Œæœ‰ç‚¹ä¸çŸ¥æ‰€æªäº†ã€‚

ä½œä¸ºè¿‡æ¥äººä¹Ÿç»™ä½ ä¸€ä¸ªå°å°é”¦å›Šï¼Œé‡åˆ°è¿™ç§æœªçŸ¥çš„é”™è¯¯ï¼Œä¸è¦æœ‰ä»»ä½•å¿ƒé‡Œé˜´å½±ï¼Œç›´æ¥å» Caching.java çš„ç¬¬ 391 è¡Œï¼Œå°è¯•åˆ†ææºç ï¼Œè¯´ä¸å®šæœ‰æ„å¤–å‘ç°ï¼š

```java
/**
 * Obtains the only {@link CachingProvider} defined by the specified
 * {@link ClassLoader}.
 * <p>
 * Should zero or more than one {@link CachingProvider}s be available, a
 * CacheException is thrown.
 * </p>
 * @param classLoader the {@link ClassLoader} to use for loading the
 *                    {@link CachingProvider}
 * @return the {@link CachingProvider}
 * @throws CacheException should zero or more than one
 *                        {@link CachingProvider} be available
 *                        or a {@link CachingProvider} could not be loaded
 * @see #getCachingProviders(ClassLoader)
 */
// javax.cache.Caching.CachingProviderRegistry#getCachingProvider(java.lang.ClassLoader)
public CachingProvider getCachingProvider(ClassLoader classLoader) {
  // è·å–æ‰€æœ‰ CachingProvider æ¥å£çš„æ‰€æœ‰å®ç°ç±»
  // å¦‚æœé…ç½®äº† javax.cache.spi.cachingprovider ç³»ç»Ÿå±æ€§ï¼Œé‚£å°±ç”¨ loadClass æ–¹æ³•åŠ è½½å®ç°ç±»
  // å¦åˆ™é€šè¿‡ ServiceLoader.load JDK çš„ SPI æœºåˆ¶è¿›è¡ŒåŠ è½½æ‰€æœ‰çš„ CachingProvider å®ç°ç±»
  Iterator<CachingProvider> iterator = getCachingProviders(classLoader).iterator();
  // è¿­ä»£å¼€å§‹å¾ªç¯æ‰€æœ‰çš„å®ç°ç±»
  if (iterator.hasNext()) {
    // å–å‡ºç¬¬ä¸€ä¸ªå®ç°ç±»
    CachingProvider provider = iterator.next();
    // ç„¶åå†å°è¯•çœ‹çœ‹æ˜¯å¦è¿˜æœ‰ç¬¬äºŒä¸ªå®ç°ç±»
    if (iterator.hasNext()) {
      // å¦‚æœæœ‰ç¬¬äºŒä¸ªå®ç°ç±»ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¤šä¸ªç¼“å­˜æä¾›è€…çš„å¼‚å¸¸
      throw new CacheException("Multiple CachingProviders have been configured when only a single CachingProvider is expected");
    } else {
      // å¦‚æœæ²¡æœ‰ç¬¬äºŒä¸ªå®ç°ç±»ï¼Œé‚£ä¹ˆå°±ç›´æ¥ä½¿ç”¨ç¬¬ä¸€ä¸ªå®ç°ç±»
      // ä¹Ÿå°±æ„å‘³ç€ï¼Œå½“å‰ç³»ç»Ÿåœ¨è¿è¡Œæ—¶åªå…è®¸æœ‰ä¸€ä¸ªå®ç°ç±»å»å®ç° CachingProvider æ¥å£
      return provider;
    }
  } else {
    // æŠ›å‡ºäº† CacheException å¼‚å¸¸ç±»
    // æŠ›å‡ºçš„æç¤ºä¿¡æ¯ï¼Œä¸æ­£æ˜¯æŠ¥é”™ä¸­çš„çœ‹åˆ°çš„é‚£æ®µæ²¡æœ‰é…ç½®æä¾›è€…çš„åŸæ–‡ä¹ˆ
    throw new CacheException("No CachingProviders have been configured");
  }
}
```

ä¸€ç•ªåˆ†æåï¼ŒåŸæ¥æ˜¯**å› ä¸ºæ²¡æœ‰ CachingProvider çš„å®ç°ç±»**æ‰å¯¼è‡´çš„æŠ¥é”™ï¼Œè€Œå®ç°ç±»æ˜¯å¯ä»¥é€šè¿‡ JDK SPI æœºåˆ¶åŠ è½½çš„ï¼Œæ›´åŠ è¯å®äº† JCacheFactory ç±»æ³¨é‡Šçš„è¯´æ³•ã€‚

é‚£æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯»æ‰¾å“ªäº›å¼€æºæ¡†æ¶å®ç°äº† CachingProvider æ¥å£ï¼Œè€Œä¸”æ•°æ®è¿˜ä¸æ˜¯å­˜å‚¨åœ¨ç½‘å…³çš„ JVM å†…å­˜é‡Œé¢çš„ã€‚

æåˆ°æ¯”è¾ƒç«çƒ­çš„å¼€æºç¼“å­˜æ¡†æ¶ï¼Œè€Œä¸”è¿˜æ˜¯åˆ†å¸ƒå¼ç¼“å­˜æ¡†æ¶ï¼Œæƒ³å¿…ï¼Œæˆ‘æƒ³ä½ å¿ƒä¸­å·²ç»æœ‰äº†ç­”æ¡ˆäº†ï¼Œé‚£å°±æ˜¯ Redis ç¼“å­˜æ¡†æ¶ï¼Œé‚£å…·ä½“å«ä»€ä¹ˆåå­—å‘¢ï¼Ÿè¦æƒ³å¾—åˆ°æƒå¨ç­”æ¡ˆï¼Œè¿˜å¾—å»å®˜ç½‘ Redis çš„å®˜ç½‘å¯»æ‰¾ç­”æ¡ˆã€‚

æœä¸å…¶ç„¶ï¼Œ[åœ¨ Redis ç”¨ Java å†™çš„å®¢æˆ·ç«¯ä¸­](https://redis.io/resources/clients/#java)ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº† Redisson æ¡†æ¶ï¼Œ[è¯¥æ¡†æ¶åœ¨ Github ä¸Šæœ‰è§£é‡Šå…·å¤‡çš„ç‰¹æ€§](https://github.com/redisson/redisson)ï¼Œå…¶ä¸­å°±æåˆ°å®ç°äº† [JCache API (JSR-107)](https://github.com/redisson/redisson/wiki/14.-Integration-with-frameworks/#144-jcache-api-jsr-107-implementation)Â è§„èŒƒï¼Œè€Œä¸”ä» Redisson æ¡†æ¶ä¸­ä¹Ÿæ‰¾åˆ°äº†å®ç° CachingProvider æ¥å£çš„ç±»ï¼Œ è¿™å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ Redis ç¼“å­˜æ¡†æ¶äº†ã€‚

é€šè¿‡ Github çš„å¿«é€Ÿå¼€å§‹ï¼Œ**æˆ‘ä»¬æ‰¾åˆ° Redisson çš„ maven åæ ‡**ï¼š

```java
<dependency>
    <groupId>org.redisson</groupId>
    <artifactId>redisson</artifactId>
    <version>3.18.0</version>
</dependency>
```

**ç„¶åæŠŠåæ ‡ç»§ç»­æ·»åŠ åˆ°å·¥ç¨‹ä¸­ï¼Œå†æ¬¡å¯åŠ¨è¿è¡Œ invokeCache æ–¹æ³•**ã€‚ä½†ï¼Œä»ç„¶æŠ¥é”™äº†ï¼š

```java
Caused by: java.lang.IllegalStateException: Default configuration hasn't been specified!
	at org.redisson.jcache.JCacheManager.createCache(JCacheManager.java:118)
	at org.apache.dubbo.cache.support.jcache.JCache.<init>(JCache.java:67)
	at org.apache.dubbo.cache.support.jcache.JCacheFactory.createCache(JCacheFactory.java:45)
	at org.apache.dubbo.cache.support.AbstractCacheFactory.getCache(AbstractCacheFactory.java:74)
	at org.apache.dubbo.cache.CacheFactory$Adaptive.getCache(CacheFactory$Adaptive.java)
	at org.apache.dubbo.cache.filter.CacheFilter.invoke(CacheFilter.java:95)
	at org.apache.dubbo.rpc.cluster.filter.FilterChainBuilder$CopyOfFilterChainNode.invoke(FilterChainBuilder.java:321)
	at org.apache.dubbo.rpc.cluster.filter.FilterChainBuilder$CallbackRegistrationInvoker.invoke(FilterChainBuilder.java:193)
	at org.apache.dubbo.rpc.cluster.support.AbstractClusterInvoker.invokeWithContext(AbstractClusterInvoker.java:378)
	at org.apache.dubbo.rpc.cluster.support.FailoverClusterInvoker.doInvoke(FailoverClusterInvoker.java:80)
	... 25 more
```

çœ‹è¿™ä¸ªéæ³•çŠ¶æ€çš„å¼‚å¸¸ `Default configuration hasn't been specified!`ï¼Œè¡¨ç¤ºæ²¡æœ‰æŒ‡å®šçš„é»˜è®¤é…ç½®æ–‡ä»¶ï¼Œä¸è¿‡æƒ³æƒ³ä¹Ÿæ˜¯çš„ï¼ŒRedis æ˜¯ç¬¬ä¸‰æ–¹ç¼“å­˜æœåŠ¡ï¼Œå½“ç„¶éœ€è¦å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼Œä¸ç„¶åº”ç”¨ç¨‹åºæ€ä¹ˆçŸ¥é“è¦è¿æ¥å“ªä¸ª Redis æœåŠ¡å‘¢ï¼Ÿ

è€è§„çŸ©ï¼Œæˆ‘ä»¬æ‰¾åˆ°åº•å±‚æºç çœ‹çœ‹éœ€è¦é…ç½®å“ªäº›è¦ç´ ã€‚ç»§ç»­è°ƒè¯•æºç ï¼Œåœ¨ JCacheManager çš„ç¬¬ 118 è¡ŒæŠ¥é”™çš„åœ°æ–¹æ‰“ä¸ªæ–­ç‚¹çœ‹çœ‹ï¼š

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/a4/3a/a4b2cd0d4effa011a1124dc287b86b3a.png?wh=5220x2979)

ä»æ–­ç‚¹å¤„ï¼Œæˆ‘ä»¬å‘ç° cacheRedisson ä¸ºç©ºï¼Œè€Œä¸” cacheRedisson æ˜¯ç”± redisson å¯¹è±¡èµ‹å€¼è¿‡æ¥ï¼Œå› æ­¤æˆ‘ä»¬å¾—åœ¨å½“å‰ JCacheManager ç±»ä¸­å¯»æ‰¾ï¼Œåˆ°åº•æ˜¯è°åˆç»™ redisson è¿›è¡Œèµ‹å€¼äº†ã€‚

å› ä¸ºredissonæ˜¯ç§æœ‰å˜é‡ï¼Œé‚£æˆ‘ä»¬æ£€ç´¢ä¸€ä¸‹å½“å‰ç±»ï¼Œç»“æœæ‰¾åˆ°äº† JCacheManager çš„æ„é€ æ–¹æ³•ï¼š

```java
// org.redisson.jcache.JCacheManager#JCacheManager
public JCacheManager(Redisson redisson, ClassLoader classLoader, CachingProvider cacheProvider, Properties properties, URI uri) {
    super();
    this.classLoader = classLoader;
    this.cacheProvider = cacheProvider;
    this.properties = properties;
    this.uri = uri;
    this.redisson = redisson;
}
```

åœ¨æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å‘ç° redisson å¯¹è±¡æ˜¯é€šè¿‡æ„é€ æ–¹æ³•ä¼ è¿›æ¥çš„ã€‚  
é‚£ä¹ˆï¼Œåˆ°åº•è°è°ƒç”¨äº†è¿™ä¸ªæ„é€ æ–¹æ³•å‘¢ï¼Ÿæˆ‘ä»¬ç»§ç»­åœ¨ JCacheManager çš„è¿™ä¸ªæ„é€ æ–¹æ³•é‡Œé¢æ‰“ä¸ªæ–­ç‚¹ï¼Œç„¶å debug è¿è¡Œä¸€ä¸‹ invokeCache æ–¹æ³•ï¼š

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/15/63/15b1ffeea23bb75d952f6ceaba344163.png?wh=1920x1487)

æƒ³çŸ¥é“è°è°ƒç”¨äº†JCacheManagerï¼Œé¦–å…ˆè¦å…³æ³¨çº¿ç¨‹è°ƒç”¨å †æ ˆï¼Œç„¶åä»è°ƒç”¨å †æ ˆä¸­å»å¯»æ‰¾â€œè°ƒç”¨æ–¹â€ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€å¼ å›¾ç‰‡çº¢æ¡†çš„æŒ‡ç¤ºéƒ¨åˆ†ï¼›æ‰¾åˆ°åï¼Œç‚¹å‡»â€œè°ƒç”¨æ–¹â€ï¼Œå¯ä»¥çœ‹åˆ°ç¬¬äºŒå¼ å›¾ä¸­ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹è¿™é‡Œçš„è¯¦ç»†é€»è¾‘ã€‚

åœ¨è¿™é‡Œï¼Œç»ˆäºæ‰¾åˆ°äº†å¯¼è‡´åˆ›å»º redisson ä¸ºç©ºçš„æºå¤´ï¼š**loadConfig æ–¹æ³•çš„è¿”å›å€¼ä¸ºç©ºï¼Œå¯¼è‡´äº†è·³è¿‡äº† Redisson.create åˆ›å»º redisson çš„æ—¶æœº**ã€‚

é‚£ä¹ˆ loadConfig è¿”å›ä¸ºç©ºçš„çœŸå®åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

åˆ°è¿™é‡Œç›¸ä¿¡ä½ ä¹Ÿå¾ˆæœ‰æŠŠæ¡äº†ï¼Œè¿›å…¥ loadConfig æ–¹æ³•çœ‹çœ‹ï¼Œæ¯ä¸ªå…³é”®é€»è¾‘æˆ‘éƒ½å†™äº†æ³¨é‡Šï¼š

```java
// org.redisson.jcache.JCachingProvider#loadConfig
private Config loadConfig(URI uri) {
    Config config = null;
    try {
        URL yamlUrl = null;
        // å°è¯•åŠ è½½ /redisson-jcache.yaml é…ç½®æ–‡ä»¶
        if ("jsr107-default-config".equals(uri.getPath())) {
            yamlUrl = JCachingProvider.class.getResource("/redisson-jcache.yaml");
        } else {
            yamlUrl = uri.toURL();
        }
        // æœ€ç»ˆè½¬æˆ org.redisson.config.Config å¯¹è±¡
        if (yamlUrl != null) {
            config = Config.fromYAML(yamlUrl);
        } else {
            // è‹¥æ²¡æœ‰ /redisson-jcache.yaml é…ç½®æ–‡ä»¶åˆ™æŠ›å‡ºæ–‡ä»¶ä¸å­˜åœ¨çš„å¼‚å¸¸
            throw new FileNotFoundException("/redisson-jcache.yaml");
        }
    } catch (JsonProcessingException e) {
        throw new CacheException(e);
    } catch (IOException e) {
        try {
            URL jsonUrl = null;
            // å°è¯•åŠ è½½ /redisson-jcache.json é…ç½®æ–‡ä»¶
            if ("jsr107-default-config".equals(uri.getPath())) {
                jsonUrl = JCachingProvider.class.getResource("/redisson-jcache.json");
            } else {
                jsonUrl = uri.toURL();
            }
            // æœ€ç»ˆè¿˜æ˜¯è½¬æˆ org.redisson.config.Config å¯¹è±¡
            if (jsonUrl != null) {
                config = Config.fromJSON(jsonUrl);
            }
        } catch (IOException ex) {
            // skip
        }
    }
    return config;
}
```

è¿›å…¥ loadConfig æ–¹æ³•åï¼Œæ‰å‘ç°åŸæ¥**ç¼ºå°‘å¯ä»¥è½¬æˆ Config å¯¹è±¡çš„ä¸¤ç§é…ç½®æ–‡ä»¶**ã€‚  
é‚£æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±è€è€å®å®æŒ‰ç…§æºç çš„è¦æ±‚å»ç¼–å†™é…ç½®æ–‡ä»¶ã€‚æ‹¿åˆ›å»º redisson-jcache.json æ–‡ä»¶ä¸¾ä¾‹ï¼Œæ–¹ä¾¿æ¼”ç¤ºæˆ‘ä»¬å°±å…ˆé…ç½®ä¸€ä¸ªå•æœº redis æœåŠ¡èŠ‚ç‚¹ï¼Œå¦‚æœè¦ä¸Šåˆ°ç”Ÿäº§ï¼Œè®°å¾—é‡‡ç”¨ clusterServersConfig é›†ç¾¤æœåŠ¡é…ç½®ï¼š

```json
{
  "singleServerConfig": {
    "address": "redis://127.0.0.1:6379"
  }
}
```

.jsoné…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯é…ç½®äº†å•æœºRedisæœåŠ¡çš„èŠ‚ç‚¹ã€‚ç°åœ¨å¯åŠ¨RedisæœåŠ¡ï¼Œå†å»è§¦å‘è°ƒç”¨ä¸€ä¸‹è¿è¡Œ invokeCache æ–¹æ³•çœ‹çœ‹æ•ˆæœã€‚

ç»ˆäºæˆåŠŸäº†ï¼Œæ‰“å°ä¿¡æ¯å¦‚ä¸‹ï¼š

```json
ç¬¬ 01 æ¬¡è°ƒç”¨ã€è§’è‰²ä¿¡æ¯åˆ—è¡¨ã€‘ç»“æœä¸º: 2022-11-19_01:44:43.482: Hello Geek, å·²æŸ¥è¯¢è¯¥ç”¨æˆ·ã€è§’è‰²åˆ—è¡¨ä¿¡æ¯ã€‘
ç¬¬ 01 æ¬¡è°ƒç”¨ã€èœå•ä¿¡æ¯åˆ—è¡¨ã€‘ç»“æœä¸º: 2022-11-19_01:44:43.504: Hello Geek, å·²æŸ¥è¯¢è¯¥ç”¨æˆ·å·²æˆæƒçš„ã€èœå•åˆ—è¡¨ä¿¡æ¯ã€‘
ç¬¬ 01 æ¬¡è°ƒç”¨ã€ç™»å½•ç”¨æˆ·ç®€æƒ…ã€‘ç»“æœä¸º: 2022-11-19_01:44:43.512: Hello Geek, å·²æŸ¥è¯¢ã€ç”¨æˆ·ç®€å•ä¿¡æ¯ã€‘

ç¬¬ 02 æ¬¡è°ƒç”¨ã€è§’è‰²ä¿¡æ¯åˆ—è¡¨ã€‘ç»“æœä¸º: 2022-11-19_01:44:43.482: Hello Geek, å·²æŸ¥è¯¢è¯¥ç”¨æˆ·ã€è§’è‰²åˆ—è¡¨ä¿¡æ¯ã€‘
ç¬¬ 02 æ¬¡è°ƒç”¨ã€èœå•ä¿¡æ¯åˆ—è¡¨ã€‘ç»“æœä¸º: 2022-11-19_01:44:43.504: Hello Geek, å·²æŸ¥è¯¢è¯¥ç”¨æˆ·å·²æˆæƒçš„ã€èœå•åˆ—è¡¨ä¿¡æ¯ã€‘
ç¬¬ 02 æ¬¡è°ƒç”¨ã€ç™»å½•ç”¨æˆ·ç®€æƒ…ã€‘ç»“æœä¸º: 2022-11-19_01:44:43.959: Hello Geek, å·²æŸ¥è¯¢ã€ç”¨æˆ·ç®€å•ä¿¡æ¯ã€‘

ç¬¬ 03 æ¬¡è°ƒç”¨ã€è§’è‰²ä¿¡æ¯åˆ—è¡¨ã€‘ç»“æœä¸º: 2022-11-19_01:44:43.482: Hello Geek, å·²æŸ¥è¯¢è¯¥ç”¨æˆ·ã€è§’è‰²åˆ—è¡¨ä¿¡æ¯ã€‘
ç¬¬ 03 æ¬¡è°ƒç”¨ã€èœå•ä¿¡æ¯åˆ—è¡¨ã€‘ç»“æœä¸º: 2022-11-19_01:44:43.504: Hello Geek, å·²æŸ¥è¯¢è¯¥ç”¨æˆ·å·²æˆæƒçš„ã€èœå•åˆ—è¡¨ä¿¡æ¯ã€‘
ç¬¬ 03 æ¬¡è°ƒç”¨ã€ç™»å½•ç”¨æˆ·ç®€æƒ…ã€‘ç»“æœä¸º: 2022-11-19_01:44:43.975: Hello Geek, å·²æŸ¥è¯¢ã€ç”¨æˆ·ç®€å•ä¿¡æ¯ã€‘
```

â€œè§’è‰²ä¿¡æ¯åˆ—è¡¨â€3æ¬¡è°ƒç”¨çš„æ—¶é—´æˆ³ä¿¡æ¯å®Œå…¨æ˜¯ä¸€æ ·çš„ï¼Œâ€œèœå•ä¿¡æ¯åˆ—è¡¨â€3æ¬¡è°ƒç”¨çš„æ—¶é—´æˆ³ä¿¡æ¯ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬æ¥å…¥ Redis ç¼“å­˜æ¡†æ¶ç”Ÿæ•ˆäº†ï¼

## ç¼“å­˜æ“ä½œçš„åº”ç”¨

åœ¨ç»è¿‡ä¸€ç•ªæ”¹é€ åï¼Œé‡‡ç”¨Redisåˆ†å¸ƒå¼ç¼“å­˜çš„ç¡®å¯ä»¥ç¼“è§£çŸ­æ—¶é—´å†…é¦–é¡µåŠ è½½çš„å‹åŠ›ã€‚

ä½†æ˜¯ä¹Ÿä¸æ˜¯ä»»ä½•æƒ…å†µé‡åˆ°é—®é¢˜äº†å°±ç”¨ç¼“å­˜å¤„ç†ï¼Œç¼“å­˜ä¹Ÿæ˜¯æœ‰ä¸€äº›ç¼ºç‚¹çš„ï¼Œæ¯”å¦‚å¤§å¯¹è±¡ä¸ç”¨æˆ·è¿›è¡Œç¬›å¡å°”ç§¯çš„å®¹é‡å¾ˆå®¹æ˜“æ’‘çˆ†å†…å­˜ï¼ŒæœåŠ¡å™¨æ‰ç”µæˆ–å®•æœºå®¹æ˜“ä¸¢å¤±æ•°æ®ï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ç¼“å­˜çš„ä¸€è‡´æ€§é—®é¢˜ä¸ä½†å¢åŠ äº†ç³»ç»Ÿçš„å®ç°å¤æ‚åº¦ï¼Œè€Œä¸”è¿˜å®¹æ˜“å¼•å‘å„ç§æ•°æ®ä¸ä¸€è‡´çš„ä¸šåŠ¡é—®é¢˜ã€‚

é‚£å“ªäº›æ—¥å¸¸å¼€å‘çš„åº”ç”¨åœºæ™¯å¯ä»¥è€ƒè™‘å‘¢ï¼Ÿ

- ç¬¬ä¸€ï¼Œæ•°æ®åº“ç¼“å­˜ï¼Œå¯¹äºä»æ•°æ®åº“æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®ï¼Œå¦‚æœå¤šæ¬¡æŸ¥è¯¢å˜åŒ–å·®å¼‚è¾ƒå°çš„è¯ï¼Œå¯ä»¥æŒ‰ç…§ä¸€å®šçš„ç»´åº¦ç¼“å­˜èµ·æ¥ï¼Œå‡å°‘è®¿é—®æ•°æ®åº“çš„æ¬¡æ•°ï¼Œä¸ºæ•°æ®åº“å‡å‹ã€‚
- ç¬¬äºŒï¼Œä¸šåŠ¡å±‚ç¼“å­˜ï¼Œå¯¹äºä¸€äº›èšåˆçš„ä¸šåŠ¡é€»è¾‘ï¼Œæ‰§è¡Œæ—¶é—´è¿‡é•¿æˆ–è°ƒç”¨æ¬¡æ•°å¤ªå¤šï¼Œè€Œåˆå¯ä»¥å®¹å¿ä¸€æ®µæ—¶é—´å†…æ•°æ®çš„å·®å¼‚æ€§ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘é‡‡å–ä¸€å®šçš„ç»´åº¦ç¼“å­˜èµ·æ¥ã€‚

## æ€»ç»“

ä»ä¸€ä¸ªç®€å•çš„Appé¦–é¡µåŠ è½½æ¸²æŸ“ç¼“æ…¢ä¾‹å­å¼€å§‹ï¼Œæˆ‘ä»¬æ€è€ƒäº†ç®€å•å¤„ç†ã€å¥—ç”¨æºç ä¸¤ç§æ–¹å¼ï¼Œä½†å› ä¸ºéƒ½æ˜¯é€šè¿‡ JVM å†…å­˜æ¥ç¼“å­˜æ•°æ®çš„ï¼Œæ¨ªå‘æ‰©å±•æ€§å·®ï¼Œå®¹æ˜“å¯¼è‡´å†…å­˜æº¢å‡ºï¼Œæˆ‘ä»¬ä¸å¾—ä¸ç»§ç»­æ·±æŒ–æºç ä¸€è·¯æ¢ç´¢ï¼Œæœ€ç»ˆé›†æˆäº† Redisson ç¼“å­˜æ¡†æ¶å¾—ä»¥è§£å†³ã€‚

- ç®€å•å¤„ç†ï¼Œè¿™ç§æ–¹å¼è™½ç„¶ç®€å•ï¼Œä½†æ˜¯ä»£ç å¤ç”¨æ€§å¤ªå·®ï¼Œæ‰©å±•æ€§å¤ªå¼±ã€‚
- å¥—ç”¨æºç ï¼Œå€Ÿé‰´äº†å‚æ•°éªŒè¯çš„ç»Ÿä¸€æ‹¦æˆªæ€æƒ³ï¼Œå……åˆ†åˆ©ç”¨äº†æºç å·²æœ‰çš„æ”¯æ’‘èƒ½åŠ›ï¼Œä½†æ˜¯åŒæ ·å¿½ç•¥äº†å¯èƒ½å¯¼è‡´ JMV å†…å­˜ä¸è¶³çš„è‡´å‘½é£é™©ã€‚
- æ·±æŒ–æºç ï¼Œæ¢ç´¢æœªçŸ¥çš„å¯èƒ½è§£å†³æ–¹æ¡ˆï¼Œåœ¨ä¸€è·¯æŠ¥é”™ä¸­åˆ†æé—®é¢˜å¹¶å„ä¸ªå‡»ç ´ã€‚

ä»æºç ä¸­æˆ‘ä»¬å‘ç°Dubboç¼“å­˜è®¾ç½®çš„ä¸»è¦æœ‰ä¸¤æ­¥ï¼š

- ç¬¬ä¸€æ­¥ï¼Œæ‰¾åˆ° &lt;dubbo:service/&gt;ã€&lt;dubbo:method/&gt;ã€&lt;dubbo:provider/&gt;ã€&lt;dubbo:consumer/&gt;ã€@DubboReferenceã€@DubboService è¿™äº›å¯ä»¥è®¾ç½®ç¼“å­˜çš„æ ‡ç­¾æˆ–æ³¨è§£ã€‚
- ç¬¬äºŒæ­¥ï¼Œæ·»åŠ  cache å±æ€§ï¼Œå¹¶å¡«å……å±æ€§å€¼ï¼Œå±æ€§å€¼æœ‰ lruã€threadlocalã€jcacheã€expiring å››ç§ç¼“å­˜ç­–ç•¥ã€‚

å›çœ‹æˆ‘ä»¬ä»Šå¤©çš„æºç æ¢ç´¢è¿‡ç¨‹ï¼Œè™½ç„¶ä¸æ˜¯é‚£ä¹ˆé¡ºç•…ï¼Œç»å¸¸è¢«ä¸€äº›ä¸è®¤è¯†çš„å¼‚å¸¸æŒ¡ä½äº†å»è·¯ï¼Œä½†æƒ³åœ¨æŠ€æœ¯è¿™æ¡è·¯ä¸Šæœ‰è¾ƒå¤§çš„æå‡ï¼Œå…³é”®å°±æ˜¯è¦å…‹æœè‡ªèº«å¯¹äºæœªçŸ¥å¼‚å¸¸çš„ææƒ§ï¼Œæ²‰ä¸‹å¿ƒæ¥ä»”ç»†é˜…è¯»é”™è¯¯ä¿¡æ¯ï¼Œä¸€æ­¥ä¸€æ­¥è¿½æ ¹æº¯æºï¼Œä½ ä¸€å®šä¼šæ‰¾åˆ°ç ´è§£ä¹‹é“ã€‚

### æ€è€ƒé¢˜

ä½ å·²ç»æŒæ¡äº†å¦‚ä½•åœ¨Dubboæ¡†æ¶ä¸­ä¼˜é›…æä¾›ç¼“å­˜åŠŸèƒ½äº†ï¼Œä½†æ˜¯æ–¹æ¡ˆä»ç„¶æœ‰äº›ç¾ä¸­ä¸è¶³ã€‚

å‡è®¾è°ƒç”¨ä¸‹æ¸¸æŸæ¥å£çš„å…¥å‚æœ‰ idã€nameã€sex ä¸‰ä¸ªå‚æ•°ï¼Œç›®å‰çš„åšæ³•å°†å…¥å‚çš„æ‰€æœ‰å€¼æ‹¼æ¥åœ¨ä¸€èµ·æ„æˆç¼“å­˜çš„Keyï¼Œå…¶å®æœ‰æ—¶å€™åªéœ€è¦æŠŠ id ä½œä¸ºç¼“å­˜Keyå°±è¡Œäº†ï¼Œå…¶ä»–å¤šä½™çš„å‚æ•°åªä¼šä½¿å¾—å­˜å‚¨æ•°æ®å€å¢ã€‚

æ‰€ä»¥è¿™é‡Œç•™ä¸ªå°ä½œä¸šç»™ä½ ï¼Œå°è¯•æŠŠ CacheFilter ç¨å¾®æ”¹é€ ä¸€ä¸‹ï¼Œæ—¢èƒ½æ”¯æŒæ‰€æœ‰å‚æ•°å€¼æ‹¼æ¥ä½œä¸ºç¼“å­˜Keyï¼Œä¹Ÿèƒ½æŒ‘é€‰æŸäº›å‚æ•°å€¼æ‹¼æ¥ä½œä¸ºç¼“å­˜Keyï¼Œä½ ä¼šæ€ä¹ˆæ”¹é€ å‘¢ï¼Ÿ

æ¬¢è¿å†™ä¸‹ä½ çš„æ€è·¯å’Œä»£ç ï¼Œå‚ä¸è®¨è®ºã€‚å¦‚æœä»Šå¤©çš„å­¦ä¹ ä½ æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿åˆ†äº«ç»™èº«è¾¹çš„æœ‹å‹ï¼Œè¯´ä¸å®šå°±å¸®ä»–è§£å†³äº†ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬ä¸‹ä¸€è®²è§ã€‚

### 07æ€è€ƒé¢˜å‚è€ƒ

ä¸Šä¸€æœŸçš„é—®é¢˜æ˜¯åœ¨Springçš„åˆ‡é¢ä¸­å®Œæˆå¯¹å‚æ•°çš„ç»Ÿä¸€éªŒè¯ã€‚

æˆ‘ä»¬å¯ä»¥å¥—ç”¨å‚æ•°æ ¡éªŒçš„é€šç”¨ä¸‰éƒ¨æ›²ï¼š

- é¦–å…ˆï¼Œå¯»æ‰¾å…·æœ‰æ‹¦æˆªæœºåˆ¶çš„æ¥å£ï¼Œä¸è¿‡åœ¨Springè¿™é‡Œä¼šæœ‰ç‚¹å¤æ‚ï¼Œå¯ä»¥å‚ç…§ [Spring å®˜ç½‘çš„åˆ‡é¢å®ç°æµç¨‹æ­¥éª¤](https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-advice)æ¥ç¼–ç ã€‚
- å…¶æ¬¡ï¼Œå¯»æ‰¾ä¸€å¥—æ³¨è§£æ¥å®šä¹‰æ ¡éªŒçš„æ ‡å‡†è§„åˆ™ï¼ŒDubbo æ¡†æ¶ä¸­çš„ hibernate-validator æ’ä»¶å¼•ç”¨äº†ä¸€ä¸ª validation-api æ’ä»¶ï¼Œé‡Œé¢å¯Œå«æˆ‘ä»¬æ‰€éœ€çš„å„ç§æ³¨è§£æ¥æä¾›ä¸åŒçš„æ ¡éªŒè§„åˆ™ã€‚
- æœ€åï¼Œå¯»æ‰¾ä¸€å¥—æ ¡éªŒé€»è¾‘æ¥æ ¹æ®æ³¨è§£çš„æ ‡å‡†è§„åˆ™æ¥æ ¡éªŒå­—æ®µå€¼ï¼ŒDubbo æ¡†æ¶ä¸­çš„ hibernate-validator æ’ä»¶å·²ç»æä¾›é€šç”¨çš„æ ¡éªŒèƒ½åŠ›ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŒ‰éƒ¨å°±ç­ç¼–å†™ä»£ç ï¼š

```java
@Order(Integer.MIN_VALUE)
@Aspect
@Component
public class ParamsValidatorAspect {
    /** <h2>å®šä¹‰å‚æ•°æ ¡éªŒå™¨æ¥å£</h2> **/
    private static Validator validator;
    static {
        // é€šè¿‡å·¥å‚åˆ›å»ºå‚æ•°æ ¡éªŒå™¨
        ValidatorFactory factory =
                (Validation.byProvider(org.hibernate.validator.HibernateValidator.class).configure())
                .failFast(true)
                .messageInterpolator(new ResourceBundleMessageInterpolator(
                        new AggregateResourceBundleLocator(Arrays.asList("validationMessage"))))
                .buildValidatorFactory();
        validator = factory.getValidator();
    }
    
    // åˆ‡é¢æ‹¦æˆªç¬¦åˆè¯¥æ­£åˆ™è¡¨è¾¾å¼æ ¼å¼çš„ä¸šåŠ¡ç±»
    @Pointcut("execution (* com.hmilyylimh.cloud.biz..*FacadeImpl.* (..))")
    private void executeService() {
    }
    
    // ç¯ç»•é€šçŸ¥ï¼Œå¯ä»¥ç†è§£ä¸ºè¿›ä¸šåŠ¡é€»è¾‘åŒ…è£¹èµ·æ¥äº†
    @Around("executeService()")
    public Object doAround(ProceedingJoinPoint pjp) throws Throwable {
        try {
            // å‚æ•°æ ¡éªŒï¼Œå¦‚æœæ ¡éªŒä¸é€šè¿‡çš„è¯ï¼Œä¼šç›´æ¥æŠ›å¼‚å¸¸
            validateParams(pjp.getArgs());
            // pjp.proceed() è¿™è¡Œä»£ç æ‰æ˜¯çœŸæ­£æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
            // æ¯”å¦‚ï¼šValidationFacadeImpl.validateUser å°±åœ¨è¿™é‡Œè¢«æ‰§è¡Œçš„
            Object result = pjp.proceed();
            // æ­£å¸¸å“åº”
            return buildNormalResp(result);
        } catch (Throwable e) {
            // å¼‚å¸¸å“åº”ï¼Œå¯ä»¥è€ƒè™‘æ€ä¹ˆç»Ÿä¸€åŒ…è£…å¼‚å¸¸å“åº”çš„ç»Ÿä¸€æ•°æ®æ ¼å¼
            return buildExceptionResp(e);
        }
    }
    
    // å‚æ•°æ ¡éªŒ
    private static void validateParams(Object[] args) {
        // å¾ªç¯æ‰€æœ‰å‚æ•°ï¼Œè°ƒç”¨å‚æ•°æ ¡éªŒå™¨çš„æ ¸å¿ƒæ ¡éªŒæ–¹æ³•
        for (Object obj : args) {
            String errorMsg = validate(obj);
            if (StringUtils.isNotBlank(errorMsg)) {
                throw new RuntimeException("å‚æ•°æ ¡éªŒä¸é€šè¿‡: " + errorMsg);
            }
        }
    }
    
    // æ ¡éªŒå…¥å‚å¯¹è±¡ï¼Œæ ¸å¿ƒé€»è¾‘éƒ½æ˜¯è°ƒç”¨ hibernate-validator æ’ä»¶é‡Œé¢çš„æ–¹æ³•
    private static String validate(Object obj) {
        // å¯¹è±¡ä¸ºç©ºåˆ™æå‰è¿”å›
        if (null == obj) {
            return "æ ¡éªŒå¯¹è±¡ä¸èƒ½ä¸ºç©º";
        }
        StringBuilder message = new StringBuilder();
        // è¿™é‡Œçš„ validator.validate æ–¹æ³•æ‰æ˜¯å‚æ•°æ ¡éªŒå™¨çš„æœ€æ ¸å¿ƒAPIé€»è¾‘
        Set<ConstraintViolation<Object>> constraintViolations 
            = validator.validate(obj);
        int size = constraintViolations.size();
        if (size == 0) {
            return "";
        }
        // æœ€ç»ˆå°†æ ¡éªŒä¸åŒçš„æè¿°ä¿¡æ¯æ‹¼æ¥è¿”å›
        int idx = 0;
        for (ConstraintViolation<Object> v : constraintViolations) {
            message.append(v.getPropertyPath()).append(" ").append(v.getMessage());
            idx += 1;
            if (idx < size) {
                message.append("; ");
            }
        }
        return message.toString();
    }
}
```
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ7ï¼‰</strong></div><ul>
<li><span>RocketMQ</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>ä¸ºä»€ä¹ˆlruçš„æ–¹å¼ä¸‹ç¬¬äºŒæ¬¡å’Œç¬¬ä¸‰æ¬¡è°ƒç”¨ç»“æœç›¸åŒï¼Œä¹Ÿå°±æ˜¯ç¬¬äºŒæ¬¡ç›¸åŒçš„è°ƒç”¨æ‰ä¼šç¼“å­˜ä¸‹æ¥ï¼Ÿä½†jcacheæ–¹å¼ä¸‹ä¸‰æ¬¡éƒ½æ˜¯ä¸€æ ·çš„</p>2023-03-17</li><br/><li><span>é£é£</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>å®é™…å¼€å‘çœŸçš„ä¼šçœŸä¹ˆç”¨å—ï¼Ÿä¸€èˆ¬ä¸éƒ½æ˜¯æœåŠ¡æä¾›è€…ç›´æ¥åœ¨è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘é‡Œé¢ä½¿ç”¨redisç­‰ç›´æ¥ç¼“å­˜ç»“æœå—ï¼Ÿä¸éœ€è¦é…ç½®è¿™ä¹ˆå¤šä¸œè¥¿å‘€ï¼Ÿ</p>2023-05-30</li><br/><li><span>Lum</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è¿™ä¸ªdubboä¸­çš„cacheæ”¯æŒè¿‡æœŸæ—¶é—´ç­‰å®šåˆ¶åŒ–åŠŸèƒ½å— çœ‹cacheçš„æ¥å£åªæœ‰ä¸¤ä¸ªæ–¹æ³•</p>2023-03-05</li><br/><li><span>æ¨è€å¸ˆ</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>åœ¨å¹³æ—¶å·¥ä½œä¸­ï¼Œå¯èƒ½ä¸ä¼šé€šè¿‡@DubboReference(cache = &quot;jcache&quot;)æ¥å¼•å…¥redisã€‚
è€Œæ˜¯å°±ç›´æ¥ä½¿ç”¨redisäº†ã€‚
è¿™ä¿©æ–¹æ¡ˆæ²¡å•¥åŒºåˆ«å§ï¼Ÿè€Œä¸”ç¬¬ä¸€ç§å¥½åƒæ›´éº»çƒ¦äº›äº†</p>2023-02-22</li><br/><li><span>æ˜ŸæœŸå…«</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>æœåŠ¡ç«¯æä¾›ç¼“å­˜åŠŸèƒ½æ˜¯ä¸ºäº†ç¼“å­˜æ–¹æ³•è°ƒç”¨åçš„ç»“æœçš„ï¼Œåœ¨ä¸‹ä¸€æ¬¡å®¢æˆ·ç«¯è°ƒç”¨è¿‡æ¥ï¼ŒæœåŠ¡ç«¯åªéœ€è¦å–ç¼“å­˜çš„å—ï¼Ÿ</p>2023-01-15</li><br/><li><span>å­™å‡</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>if (iterator.hasNext()) {
        CachingProvider provider = iterator.next();

        if (iterator.hasNext()) {
          throw new CacheException(&quot;Multiple CachingProviders have been configured when only a single CachingProvider is expected&quot;);
        } else {
          return provider;
        }
      } else {
        throw new CacheException(&quot;No CachingProviders have been configured&quot;);
      }
 è‡ªé—®è‡ªç­”äº†ï¼Œè¿™é‡Œä¼šæ ¡éªŒæ˜¯å¦æœ‰å¤šä¸ªå®ç°ç±»</p>2023-01-06</li><br/><li><span>å­™å‡</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>å¦‚æœåŒæ—¶å¼•å…¥é™¤redissonæ”¯æŒJcacheè§„èŒƒçš„å…¶ä»–mavenåŒ…ä¼šæ€ä¹ˆæ ·ï¼Ÿå¦‚ä½•åˆ¤æ–­è¦ä½¿ç”¨å“ªä¸ªåŒ…çš„Cacheå‘¢ï¼Ÿæ˜¯é€šè¿‡spié…ç½®å—</p>2023-01-06</li><br/>
</ul>