ä½ å¥½ï¼Œæˆ‘æ˜¯é™ˆå¤©ã€‚

ä»è¿™ä¸€è®²å¼€å§‹ï¼Œæˆ‘ä»¬å°±åˆ°è¿›é˜¶ç¯‡äº†ã€‚åœ¨è¿›é˜¶ç¯‡ä¸­ï¼Œæˆ‘ä»¬ä¼šå…ˆè¿›ä¸€æ­¥å¤¯å®å¯¹ç±»å‹ç³»ç»Ÿçš„ç†è§£ï¼Œç„¶åå†å±•å¼€ç½‘ç»œå¤„ç†ã€Unsafe Rustã€FFI ç­‰ä¸»é¢˜ã€‚

ä¸ºä»€ä¹ˆè¦æŠŠç±»å‹ç³»ç»Ÿä½œä¸ºè¿›é˜¶ç¯‡çš„åŸºçŸ³ï¼Ÿä¹‹å‰è®²è§£ rgrep çš„ä»£ç æ—¶ä½ å¯ä»¥çœ‹åˆ°ï¼Œå½“è¦æ„å»ºå¯è¯»æ€§æ›´å¼ºã€æ›´åŠ çµæ´»ã€æ›´åŠ å¯æµ‹è¯•çš„ç³»ç»Ÿæ—¶ï¼Œæˆ‘ä»¬éƒ½è¦æˆ–å¤šæˆ–å°‘ä½¿ç”¨ trait å’Œæ³›å‹ç¼–ç¨‹ã€‚

æ‰€ä»¥å¯ä»¥è¯´åœ¨ Rust å¼€å‘ä¸­ï¼Œæ³›å‹ç¼–ç¨‹æ˜¯æˆ‘ä»¬å¿…é¡»æŒæ¡çš„ä¸€é¡¹æŠ€èƒ½ã€‚åœ¨ä½ æ„å»ºæ¯ä¸€ä¸ªæ•°æ®ç»“æ„æˆ–è€…å‡½æ•°æ—¶ï¼Œæœ€å¥½éƒ½é—®é—®è‡ªå·±ï¼šæˆ‘æ˜¯å¦æœ‰å¿…è¦åœ¨æ­¤åˆ»å°±æŠŠç±»å‹å®šæ­»ï¼Ÿæ˜¯ä¸æ˜¯å¯ä»¥æŠŠè¿™ä¸ªå†³ç­–å»¶è¿Ÿåˆ°å°½å¯èƒ½é åçš„æ—¶åˆ»ï¼Œè¿™æ ·å¯ä»¥ä¸ºæœªæ¥ç•™æœ‰ä½™åœ°ï¼Ÿ

åœ¨ã€Šæ¶æ„æ•´æ´ä¹‹é“ã€‹é‡Œ Uncle Bob è¯´ï¼š**æ¶æ„å¸ˆçš„å·¥ä½œä¸æ˜¯ä½œå‡ºå†³ç­–ï¼Œè€Œæ˜¯å°½å¯èƒ½ä¹…åœ°æ¨è¿Ÿå†³ç­–ï¼Œåœ¨ç°åœ¨ä¸ä½œå‡ºé‡å¤§å†³ç­–çš„æƒ…å†µä¸‹æ„å»ºç¨‹åºï¼Œä»¥ä¾¿ä»¥åæœ‰è¶³å¤Ÿä¿¡æ¯æ—¶å†ä½œå‡ºå†³ç­–**ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬èƒ½é€šè¿‡æ³›å‹æ¥æ¨è¿Ÿå†³ç­–ï¼Œç³»ç»Ÿçš„æ¶æ„å°±å¯ä»¥è¶³å¤Ÿçµæ´»ï¼Œå¯ä»¥æ›´å¥½åœ°é¢å¯¹æœªæ¥çš„å˜æ›´ã€‚

ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥è®²è®²å¦‚ä½•åœ¨å®æˆ˜ä¸­ä½¿ç”¨æ³›å‹ç¼–ç¨‹ï¼Œæ¥å»¶è¿Ÿå†³ç­–ã€‚å¦‚æœä½ å¯¹ Rust çš„æ³›å‹ç¼–ç¨‹æŒæ¡åœ°è¿˜ä¸å¤Ÿç‰¢é ï¼Œå»ºè®®å†æ¸©ä¹ ä¸€ä¸‹ç¬¬ [12](https://time.geekbang.org/column/article/420021) å’Œ [13](https://time.geekbang.org/column/article/420028) è®²ï¼Œä¹Ÿå¯ä»¥é˜…è¯» The Rust Programming Language [ç¬¬ 10 ç« ](https://doc.rust-lang.org/book/ch10-00-generics.html)ä½œä¸ºè¾…åŠ©ã€‚

## æ³›å‹æ•°æ®ç»“æ„çš„é€æ­¥çº¦æŸ
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ9ï¼‰</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/14/26/27/eba94899.jpg" width="30px"><span>ç½—æ°</span> ğŸ‘ï¼ˆ15ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>impl Iterator for Equation&lt;Quadratic&gt; åˆ¤æ–­è¿”å› None çš„åœ°æ–¹æ˜¯ä¸æ˜¯åº”è¯¥å†™æˆ `if self.current &gt;= u16::MAX as u32`ï¼Œä¸ç„¶ä¼šæœ‰é€»è¾‘é”™è¯¯ã€‚</div>2021-10-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f7/1b/db7a0edc.jpg" width="30px"><span>Marvichov</span> ğŸ‘ï¼ˆ8ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>å’Œè€å¸ˆçš„å¯¹åº”ä¸‹...

1. ä½¿ç”¨æ³›å‹å‚æ•°å»¶è¿Ÿæ•°æ®ç»“æ„çš„ç»‘å®šï¼›
2. ä½¿ç”¨æ³›å‹å‚æ•°å’Œ PhantomDataï¼Œå£°æ˜æ•°æ®ç»“æ„ä¸­ä¸ç›´æ¥ä½¿ç”¨ï¼Œä½†åœ¨å®ç°è¿‡ç¨‹ä¸­éœ€è¦ç”¨åˆ°çš„ç±»å‹
3. ä½¿ç”¨æ³›å‹å‚æ•°è®©åŒä¸€ä¸ªæ•°æ®ç»“æ„å¯¹åŒä¸€ä¸ª trait å¯ä»¥æ‹¥æœ‰ä¸åŒçš„å®ç°ã€‚

1. é¢å‘interfaceç¼–ç¨‹; åªä¸è¿‡é™æ€å¤šæ€
2. å¼•å…¥è‡ªç”±å‚æ•° -&gt; å¤§éƒ¨åˆ†implå…±äº«; å‰©ä¸‹çš„, æ ¹æ®è‡ªç”±å‚æ•°ç±»å‹çš„ä¸åŒåštemplate specialization -&gt; æ¯”å¦‚tag struct -&gt; æœ¬è´¨è¿˜æ˜¯ä»£ç å…±äº«
3. NewTypePattern; ä¸€å¥—ä»£ç ç»™å¤šä¸ªä¸åŒçš„typeå…±ç”¨; è¿™ä¸ªblogé‡Œé¢çš„ä¾‹å­æ¯”è¾ƒç”ŸåŠ¨: https:&#47;&#47;www.greyblake.com&#47;blog&#47;2021-10-11-phantom-types-in-rust&#47;; golangé‡Œé¢ä¹Ÿç»å¸¸ç”¨kilometer, mileæ¥åšä¾‹å­, ç±»ä¼¼äº`type mile i32`;</div>2021-10-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f7/1b/db7a0edc.jpg" width="30px"><span>Marvichov</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>Cppé‡Œé¢ç”¨tagå’Œå¤šgeneric paramçš„ä¾‹å­ä¹Ÿå¾ˆå¤šâ€¦

æ¯”å¦‚Cppçš„iterator, å¤šä¸ªæ³›å‹åšå‚æ•°, ä¸éœ€è¦PhantomData; 

    template&lt;
        class Category,  &#47;&#47; tag data, ç±»ä¼¼äº AsyncProstReader D
        class T,
        class Distance = std::ptrdiff_t,
        class Pointer = T*,
        class Reference = T&amp;
    &gt; struct iterator;

æ‰€ä»¥, æ„Ÿè§‰PhantomDataçš„ä¸»è¦ç”¨é€”æ˜¯compile time ownership check;

æˆ‘çš„ç–‘é—®ä¹Ÿå°±ä¸»è¦é›†ä¸­åœ¨ownership...

é—®é¢˜1:

from PhantomData doc:
&gt; Adding a PhantomData field to your type tells the compiler that your type acts as though it stores a value of type T, even though it doesnâ€™t really. 

ä¸å¤ªæ˜ç™½, ä¸ºå•¥éœ€è¦ownership. æ¯”å¦‚AsyncProstReaderçš„Tæ˜¯çº¦æŸRçš„return typeçš„, æŒ‰ç†è¯´ä¸ç”¨own T;  è€Œä¸”intoå’Œdest memberå…¨ç¨‹æ²¡è¢«è°ƒç”¨è¿‡


    &#47;&#47;&#47; A wrapper around an async reader that produces an asynchronous stream of prost-decoded values
    #[derive(Debug)]
    pub struct AsyncProstReader&lt;R, T, D&gt; {
        reader: R,
        pub(crate) buffer: BytesMut,
        into: PhantomData&lt;T&gt;,
        dest: PhantomData&lt;D&gt;,
    }

å¦‚æœä¸éœ€è¦å¯¹T, Dçš„ownership, ä¸ºå•¥ä¸æ¥ä¸ª`PhantomDataNotOwned`æ¥æ»¡è¶³è¿™æ ·çš„åœºæ™¯: ä¸éœ€è¦ownership, ä½†æ˜¯è¿™ä¸ªgeneric type Tä¸æ˜¯å¤šä½™çš„å‘¢?

----

é—®é¢˜2:

&gt; This information is used when computing certain safety properties.

è¿™å¥ç›®å‰ç†è§£ä¸äº†â€¦å‡è®¾å¯¹Tæœ‰ownership, æ²¡çœ‹å‡ºæœ‰å•¥ç‰¹æ®Šçš„safetyéœ€æ±‚
</div>2021-10-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/93/96/81c8cc33.jpg" width="30px"><span>Quincy</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>1. å‚æ•° F æ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œæ¥æ”¶ Self::Item,è¿”å› Fut ç±»å‹ï¼›
2. å‚æ•° Fut æ˜¯ä¸€ä¸ª Future&lt;Output=()&gt;;

æ‰€ä»¥ f æ˜¯ä¸€ä¸ªé—­åŒ…æ¥æ”¶ Self::Item é—­åŒ…çš„è¿”å›å€¼æ˜¯ Future&lt;Output=()&gt;

ä½¿ç”¨å‚è€ƒæºä»£ç ï¼š

```rust
.for_each_concurrent(
    &#47;* limit *&#47; 2,
    |rx| async move {
        rx.await.unwrap();
    }
)
```
</div>2021-10-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/02/78/4d40b4b2.jpg" width="30px"><span>æ¸¡é¸¦10086</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>å…³äºæ€è€ƒé¢˜ï¼š
f æ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œä»¥ `Self::Item` ç±»å‹ä½œä¸ºè¾“å…¥ï¼Œä»¥ä¸€ä¸ªå®ç°äº† `Future` trait çš„ç±»å‹ Fut ä½œä¸ºè¾“å‡ºï¼Œå…¶ä¸­`Future` çš„å…³è”ç±»å‹ `Output` æ˜¯ unit ç±»å‹</div>2022-01-16</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ8aLz0tWdsZuMiaNUAd0dicSD9M6A77seMGFdHgvsQwOzN8ztYPiaJSo53DcbjQWUQpw4pf4rI2f7vg/132" width="30px"><span>Geek_7c0961</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>è€å¸ˆç°åœ¨implement trait ç”¨åœ¨è¿”å›å€¼çš„ç±»å‹äº†,é‚£ä¹ˆ trait obejctè¿˜æœ‰ä»€ä¹ˆç”¨å¤„ä¹ˆ?å®ƒçš„æ€§èƒ½é‚£ä¹ˆå·®.
https:&#47;&#47;doc.rust-lang.org&#47;rust-by-example&#47;trait&#47;impl_trait.html</div>2022-05-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1e/f8/15/2724d7ec.jpg" width="30px"><span>A.Y.</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>å…³äºç¬¬ä¸‰ç‚¹ä½¿ç”¨åœºæ™¯ï¼Œä¼¼ä¹å¯ä»¥ç”¨äºæ›¿ä»£å…¶ä»–é¢å‘å¯¹è±¡è¯­è¨€ä¸­æœ‰è€Œrustä¸æ”¯æŒçš„ç±»ç»§æ‰¿ã€‚</div>2022-05-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/80/c4/1c0e3b84.jpg" width="30px"><span>ğŸ²ç¤sir</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>ç»ˆäºæ˜ç™½substrateçš„frame&#47;executiv&#47;src&#47;lib.rsé‡Œé¢è¿™æ®µä»£ç çš„ç”¨æ„ï¼š</div>2022-09-11</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIofiaCAziajdQnbvrfpEkpCKVFgO62y6zicamhjF1BAWZSRcCVaTBXLIerLsGeZCic7XS7KOEkTN4fRg/132" width="30px"><span>zahi</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>phantom type çš„ä¾‹å­ï¼Œæ„Ÿè§‰åƒjavaä¸­çš„ç»§æ‰¿ã€‚</div>2022-08-14</li><br/>
</ul>