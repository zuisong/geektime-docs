ä½ å¥½ï¼Œæˆ‘æ˜¯é™ˆå¤©ã€‚

Traitï¼Œtraitï¼Œtraitï¼Œæ€ä¹ˆåˆæ˜¯ traitï¼Ÿhow old are you?

å¸Œæœ›ä½ è¿˜æ²¡æœ‰åŒå€¦æˆ‘ä»¬æ²¡å®Œæ²¡äº†åœ°èŠå…³äº trait çš„è¯é¢˜ã€‚å› ä¸º trait åœ¨ Rust å¼€å‘ä¸­çš„åœ°ä½ï¼Œæ€ä¹ˆå¹éƒ½ä¸ä¸ºè¿‡ã€‚

å…¶å®ä¸å…‰æ˜¯ Rust ä¸­çš„ traitï¼Œä»»ä½•ä¸€é—¨è¯­è¨€ï¼Œå’Œæ¥å£å¤„ç†ç›¸å…³çš„æ¦‚å¿µï¼Œéƒ½æ˜¯é‚£é—¨è¯­è¨€åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­æœ€é‡è¦çš„æ¦‚å¿µã€‚**è½¯ä»¶å¼€å‘çš„æ•´ä¸ªè¡Œä¸ºï¼ŒåŸºæœ¬ä¸Šå¯ä»¥è¯´æ˜¯ä¸æ–­åˆ›å»ºå’Œè¿­ä»£æ¥å£ï¼Œç„¶ååœ¨è¿™äº›æ¥å£ä¸Šè¿›è¡Œå®ç°çš„è¿‡ç¨‹**ã€‚

åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæœ‰äº›æ¥å£æ˜¯æ ‡å‡†åŒ–çš„ï¼Œé›·æ‰“ä¸åŠ¨ï¼Œå°±åƒé’¢ç­‹ã€ç –ç“¦ã€èºä¸ã€é’‰å­ã€æ’åº§ç­‰è¿™äº›ææ–™ä¸€æ ·ï¼Œæ— è®ºè¦æ„ç­‘çš„æˆ¿å­æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œè¿™äº›æ ‡å‡†ç»„ä»¶çš„æ¥å£åœ¨ç¡®å®šä¸‹æ¥åï¼Œéƒ½ä¸ä¼šæ”¹å˜ï¼Œå®ƒä»¬å°±åƒ Rust è¯­è¨€æ ‡å‡†åº“ä¸­çš„æ ‡å‡† trait ä¸€æ ·ã€‚

è€Œæœ‰äº›æ¥å£æ˜¯è·Ÿæ„é€ çš„æˆ¿å­æ¯æ¯ç›¸å…³çš„ï¼Œæ¯”å¦‚é—¨çª—ã€ç”µå™¨ã€å®¶å…·ç­‰ï¼Œå®ƒä»¬å°±åƒä½ è¦è®¾è®¡çš„ç³»ç»Ÿä¸­çš„ trait ä¸€æ ·ï¼Œå¯ä»¥æŠŠç³»ç»Ÿçš„å„ä¸ªéƒ¨åˆ†è”ç»“èµ·æ¥ï¼Œæœ€ç»ˆå‘ˆç°ç»™ç”¨æˆ·ä¸€ä¸ªå®Œæ•´çš„ä½¿ç”¨ä½“éªŒã€‚

ä¹‹å‰è®²äº†trait çš„åŸºç¡€çŸ¥è¯†ï¼Œä¹Ÿä»‹ç»äº†å¦‚ä½•åœ¨å®æˆ˜ä¸­ä½¿ç”¨ trait å’Œ trait objectã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å†èŠ±ä¸€è®²çš„æ—¶é—´ï¼Œæ¥çœ‹çœ‹å¦‚ä½•å›´ç»•ç€ trait æ¥è®¾è®¡å’Œæ¶æ„ç³»ç»Ÿã€‚

ç”±äºåœ¨è®²æ¶æ„å’Œè®¾è®¡æ—¶ï¼Œä¸å…è¦å¼•å…¥éœ€æ±‚ï¼Œç„¶åæˆ‘éœ€è¦è§£é‡Šè¿™éœ€æ±‚çš„æ¥é¾™å»è„‰ï¼Œå†æä¾›è®¾è®¡æ€è·¯ï¼Œå†ä»‹ç» trait åœ¨å…¶ä¸­çš„ä½œç”¨ï¼Œä½†è¿™æ ·ä¸‹æ¥ï¼Œä¸€å ‚è¯¾çš„å†…å®¹èƒ½è®²å¥½ä¸€ä¸ªç³»ç»Ÿè®¾è®¡å°±ä¸é”™äº†ã€‚æ‰€ä»¥æˆ‘ä»¬æ¢ä¸ªæ–¹å¼ï¼ŒæŠŠä¹‹å‰è®¾è®¡è¿‡çš„ç³»ç»Ÿæ‹ä¸€ä¸‹ï¼Œé‡æ¸©å®ƒä»¬çš„ trait è®¾è®¡ï¼Œçœ‹çœ‹å…¶ä¸­çš„æ€è·¯ä»¥åŠå–èˆã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ8ï¼‰</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/13/35/6d/07a42f81.jpg" width="30px"><span>éƒ‘æ™”</span> ğŸ‘ï¼ˆ7ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<div>è€å¸ˆå¯¹å•ä¸€èŒè´£çš„ç†è§£æ˜¯é”™çš„ï¼Œè¿™ä¸€ç‚¹æ˜¯æˆ‘ç‰¹æ„åœ¨ã€Šè½¯ä»¶è®¾è®¡ä¹‹ç¾ã€‹ä¸­çº æ­£çš„ï¼Œå› ä¸ºå•ä¸€åŠŸèƒ½æ˜¯ä¸€ä¸ªæ°¸è¿œä¸ºçœŸçš„è¯´æ³•ï¼Œå•ä¸€èŒè´£æ˜¯è¦æŠŠå˜åŒ–çº³å…¥è€ƒé‡ã€‚å…·ä½“çš„å¯ä»¥å‚è€ƒã€Šè½¯ä»¶è®¾è®¡ä¹‹ç¾ã€‹å’Œã€Šæ¶æ„æ•´æ´ä¹‹é“ã€‹ä¸­å…³äºå•ä¸€èŒè´£çš„è®²è§£ã€‚</div>2021-10-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f7/1b/db7a0edc.jpg" width="30px"><span>Marvichov</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>doc: https:&#47;&#47;github.com&#47;yewstack&#47;yew&#47;blob&#47;master&#47;packages&#47;yew&#47;src&#47;html&#47;component&#47;mod.rs#L42

1. ä¸èƒ½, è¿”å›ç±»å‹æœ‰Self; è¿è¡Œæ—¶typeè¢«eraseæ‰äº†, ä¸çŸ¥é“Selfå…·ä½“æ˜¯ä»€ä¹ˆç±»å‹.
2. Messageæ„Ÿè§‰æœ‰ç‚¹åƒactoré‡Œé¢çš„message: op to change component state. åº”è¯¥æ˜¯ç”¨äºå®šä¹‰äº¤äº’çš„æ—¶å€™, dynamic change componentçš„. Propertiesåº”è¯¥æ˜¯DOMçš„property, ç”¨äºrender viewçš„â€¦

æ¯”å¦‚impl Component for List https:&#47;&#47;github.com&#47;yewstack&#47;yew&#47;blob&#47;master&#47;packages&#47;yew&#47;src&#47;virtual_dom&#47;vlist.rs#L495
```
    #[derive(Clone, Properties, PartialEq)]
    pub struct ListProps {
        pub children: Children,
    }

impl Component for List {
      fn view(&amp;self, ctx: &amp;Context&lt;Self&gt;) -&gt; Html {
          html! { &lt;&gt;{ for ctx.props().children.iter() }&lt;&#47;&gt; }
      }
```
3. https:&#47;&#47;docs.rs&#47;yew&#47;0.18.0&#47;yew&#47;#example; é‡ç‚¹æ˜¯`Sized` `+ &#39;Static` bound`. å®ç°çš„ç±»å‹å¿…é¡»æ˜¯Sized. åŒæ—¶å¦‚æœæœ‰reference element, å…¶lifetimeå¿…é¡»æ˜¯staticçš„.

æ„Ÿè§‰virtual domæœ‰å¿…è¦äº†è§£äº†è§£...</div>2021-10-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/22/f4/9fd6f8f0.jpg" width="30px"><span>æ ¸æ¡ƒ</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>ä»Šå¤©å†™äº†ä¸€æ®µå…¨å±€å•ä¾‹çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤º.

```
pub struct Monitor {
    sender: UnsafeCell&lt;Option&lt;mpsc::TxUnbounded&lt;Vec&lt;xxx&gt;&gt;&gt;&gt;,
}

impl Monitor {
    pub fn set_sender(&amp;self, sender: mpsc::TxUnbounded&lt;Vec&lt;xxx&gt;&gt;) {
        let self_sender_option: &amp;mut Option&lt;mpsc::TxUnbounded&lt;Vec&lt;xxx&gt;&gt;&gt; =
            unsafe { transmute(self.sender.get()) };
        self_sender_option.replace(sender);
    }

    pub fn send_monitor(&amp;self, info_vec: Vec&lt;xxx&gt;) {
        let self_sender: &amp;mut Option&lt;mpsc::TxUnbounded&lt;Vec&lt;xxx&gt;&gt;&gt; =
            unsafe { transmute(self.sender.get()) };
        ...
    }
}

unsafe impl Send for Monitor {}
unsafe impl Sync for Monitor {}

&#47;&#47;why we use Arc to contain Monitor is that lazy_static seems a const value.
&#47;&#47;rust can&#39;t change the const value unless new at first.
&#47;&#47;but Arc can share to use the value.
lazy_static! {
    pub static ref GLOBAL_MONITOR: Arc&lt;Monitor&gt; =
        Arc::new(Monitor { sender: UnsafeCell::new(None) });
}
```

è¿™é‡Œä½¿ç”¨lazy_staticè¿›è¡Œå…¨å±€å®ç°é™æ€å˜é‡ï¼Œä½†æ˜¯å› ä¸ºåˆå§‹åŒ–çš„æ—¶å€™å¹¶æ²¡æœ‰åŠæ³•æŒ‡å‘ä¸€ä¸ªå…¶ä»–çš„å˜é‡ï¼Œå› æ­¤è¿™é‡Œè€ƒè™‘ä½¿ç”¨äº†Arcå¤„ç†ï¼Œä½†æ˜¯è¿™æ®µä»£ç å…¶å®è¿˜æ˜¯æœ‰ç‚¹é—®é¢˜çš„ï¼Œå› ä¸ºå¹¶æ²¡æœ‰è€ƒè™‘åˆ°ç«äº‰å¹¶å‘çš„æƒ…å†µï¼Œä½†æ˜¯è¿™é‡Œä¼¼ä¹æ›´åŠ é€‚åˆä½¿ç”¨once cellã€‚ruståœ¨è¿™éƒ¨åˆ†çš„å®ç°ï¼Œæ„Ÿè§‰è¿˜æ˜¯æœ‰ç‚¹æ¬ ç¼ºçš„ã€‚</div>2021-11-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/a3/87/eb923eb3.jpg" width="30px"><span>0@1</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆï¼Œæƒ³é—®ä¸‹å…³äºtraitçš„ä¸€äº›é—®é¢˜, ä¸‹é¢æ˜¯ä¸ªä»£ç ä¾‹å­ï¼Œ
struct MyStruct;
trait MyTrait{
    fn test(&amp;self);
}

impl MyTrait for MyStruct{
    fn test(&amp;self) {
        println!(&quot;MyStruct&quot;)
    }
}
impl MyTrait for &amp;MyStruct{
    fn test(&amp;self) {
        println!(&quot;&amp;MyStruct&quot;)
    }
}
impl MyTrait for *const MyStruct{
    fn test(&amp;self) {
        println!(&quot;*const MyStruct&quot;)
    }
}
fn main() {
   let my_struct = MyStruct;
    my_struct.test();
    &amp;my_struct.test();
    let my_struct_ptr = &amp;my_struct as *const MyStruct;
    my_struct_ptr.test();
}

1. impl MyTrait for &amp;MyStruct å’Œ impl MyTrait for MyStruct è¿™2ä¸ªæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä»€ä¹ˆæƒ…å†µä¸‹é€‚åˆ
ä¸ºå¼•ç”¨å®ç°trait, impl MyTrait for &amp;MyStruct

2. impl MyTrait for *const MyStruct 
è¿™ç§æ–¹å¼ï¼Œç»™è£¸æŒ‡é’ˆå®ç°trait, æœ‰ä»€ä¹ˆä½¿ç”¨åœºæ™¯ä¹ˆ



</div>2021-10-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/26/27/eba94899.jpg" width="30px"><span>ç½—æ°</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>æ¥å£çš„è®¾è®¡è¦æ³¨é‡ç”¨æˆ·ä½“éªŒï¼Œè¿™å¤ªé‡è¦äº†ã€‚</div>2021-10-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/39/08/2b/7a1fb4ff.jpg" width="30px"><span>David.Du</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>Trait å¯¹Tçš„ä¸€äº›çº¦æŸï¼ŒåŒæ—¶ä¹Ÿæé†’äº†Tçš„å®ç°è€…ï¼Œè¦æŒ‰ç…§è¿™ä¸ªå»åšï¼ŒFnçš„å‡½æ•°åŠŸèƒ½ï¼ŒåŒæ—¶ä¹Ÿçº¦æŸäº†è‡ªèº«ï¼Œæˆ‘æ„Ÿè§‰ä¸€å¥—ç³»ç»Ÿå®šä¹‰å®Œä¸€äº›åˆ—çš„Trait+æ•°æ®ç»“æ„åï¼Œå‰©ä¸‹çš„å°±æ˜¯å®ç°äº†ã€‚</div>2023-11-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/27/fb/f7/88ab6f83.jpg" width="30px"><span>è¿›å‡»çš„Lancelot</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>æ€è€ƒé¢˜ï¼š

Component trait å¯ä»¥åš trait object ä¹ˆï¼Ÿ
åšä¸äº† trait objectï¼Œå› ä¸ºå…¶ä¸­çš„æ–¹æ³•å¹¶ä¸ç¬¦åˆå¯¹è±¡å®‰å…¨åŸåˆ™ï¼Œè¦ä¹ˆè¿”å›  Self å¯¹è±¡ï¼Œè¦ä¹ˆå¸¦æœ‰æ³›å‹å‚æ•°

å…³è”ç±»å‹ Message å’Œ Properties çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ
Message çš„ä½œç”¨æ˜¯ç”¨æ¥å’Œ Component è¿›è¡Œäº¤äº’ï¼Œä½¿å…¶è·å¾—åŠ¨æ€èƒ½åŠ›çš„ã€‚ properties åˆ™è¡¨è¾¾äº† Component çš„å±æ€§ï¼Œå½“ Component çš„çˆ¶ç»„ä»¶è¢«é‡æ–°æ¸²æŸ“æ—¶ï¼Œå­ç»„ä»¶è¦ä¹ˆé‡æ–°ç”Ÿæˆï¼Œè¦ä¹ˆä»ä¼ é€’ç»™ changed æ–¹æ³•ä¸­çš„ä¸Šä¸‹æ–‡æ¥å—æ–°çš„ properties

åšä¸ºä½¿ç”¨è€…ï¼Œè¯¥å¦‚ä½•ç”¨ Component traitï¼Ÿå®ƒçš„ lifecycle æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿ
ä¸ºè‡ªå®šä¹‰ç±»å‹å®ç° Component trait éœ€è¦æŒ‡å®šå…³è”ç±»å‹ Message å’Œ Propertiesï¼Œå¹¶æä¾› create å’Œ view ä¸¤ä¸ªæ–¹æ³•çš„è‡ªå®šä¹‰å®ç°å³å¯ã€‚å®ƒçš„ lifecycle æ˜¯é™æ€ç”Ÿå‘½å‘¨æœŸï¼Œè´¯ç©¿ç¨‹åºçš„å§‹ç»ˆ</div>2022-09-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/02/78/4d40b4b2.jpg" width="30px"><span>æ¸¡é¸¦10086</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>æ€è€ƒé¢˜ï¼š
1. Component trait çš„ create æ–¹æ³•ä¼šè¿”å› Selfï¼Œæ‰€ä»¥ä¸èƒ½åš trait Object
2. å…³è”ç±»å‹ Message ç”¨äºè®© Components ç±»å‹åŠ¨æ€åŒ–åŠå¯äº¤äº’åŒ–ï¼ŒComponent å¯ä»¥ä½¿ç”¨ enum æˆ– () æ¥å£°æ˜ã€‚ Properties å°±æ˜¯ Component çš„å±æ€§ï¼Œå½“ Component çš„çˆ¶ç»„ä»¶è¢«é‡æ–°æ¸²æŸ“æ—¶æ—¶ï¼Œå®ƒå°†è¢«é‡æ–°åˆ›å»ºï¼Œæˆ–è€…åœ¨ä¼ é€’ç»™è¢«æ”¹å˜çš„ life cycle æ–¹æ³•çš„ä¸Šä¸‹æ–‡ä¸­æ¥æ”¶æ–°çš„å±æ€§ã€‚
3. YEWçš„å®˜æ–¹å®ä¾‹ï¼šhttps:&#47;&#47;docs.rs&#47;yew&#47;0.18.0&#47;yew&#47;#exampleã€‚life cycle ï¼š `&#39;static` ä»£è¡¨é™æ€ç”Ÿå‘½å‘¨æœŸ
4. æ²¡æœ‰å‰ç«¯ç»éªŒã€‚ã€‚
</div>2022-01-17</li><br/>
</ul>