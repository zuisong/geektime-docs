ä½ å¥½ï¼Œæˆ‘æ˜¯æœ±æ™”ã€‚

ä»Šå¤©ï¼Œæˆ‘ä»¬ç»§ç»­ä¸€èµ·åˆ†æè¿™é—¨è¯¾ç¬¬7~12è®²çš„è¯¾åæ€è€ƒé¢˜ã€‚è¿™äº›é¢˜ç›®æ¶‰åŠäº†æ•°æ®åº“ç´¢å¼•ã€åˆ¤ç­‰é—®é¢˜ã€æ•°å€¼è®¡ç®—ã€é›†åˆç±»ã€ç©ºå€¼å¤„ç†å’Œå¼‚å¸¸å¤„ç†çš„12é“é—®é¢˜ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä¸€ä¸€å…·ä½“åˆ†æå§ã€‚

### [07 | æ•°æ®åº“ç´¢å¼•ï¼šç´¢å¼•å¹¶ä¸æ˜¯ä¸‡èƒ½è¯](https://time.geekbang.org/column/article/213342)

**é—®é¢˜1ï¼š**åœ¨ä»‹ç»äºŒçº§ç´¢å¼•ä»£ä»·æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡EXPLAINå‘½ä»¤çœ‹åˆ°äº†ç´¢å¼•è¦†ç›–å’Œå›è¡¨çš„ä¸¤ç§æƒ…å†µã€‚ä½ èƒ½ç”¨optimizer traceæ¥åˆ†æä¸€ä¸‹è¿™ä¸¤ç§æƒ…å†µçš„æˆæœ¬å·®å¼‚å—ï¼Ÿ

ç­”ï¼šå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼Œæ‰“å¼€optimizer\_traceåï¼Œå†æ‰§è¡ŒSQLå°±å¯ä»¥æŸ¥è¯¢information\_schema.OPTIMIZER\_TRACEè¡¨æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’äº†ï¼Œæœ€åå¯ä»¥å…³é—­optimizer\_traceåŠŸèƒ½ï¼š

```
SET optimizer_trace="enabled=on";
SELECT * FROM person WHERE NAME >'name84059' AND create_time>'2020-01-24 05:00:00';
SELECT * FROM information_schema.OPTIMIZER_TRACE;
SET optimizer_trace="enabled=off";
```

å‡è®¾æˆ‘ä»¬ä¸ºè¡¨personçš„NAMEå’ŒSCOREåˆ—å»ºäº†è”åˆç´¢å¼•ï¼Œé‚£ä¹ˆä¸‹é¢ç¬¬äºŒæ¡è¯­å¥åº”è¯¥å¯ä»¥èµ°ç´¢å¼•è¦†ç›–ï¼Œè€Œç¬¬ä¸€æ¡è¯­å¥éœ€è¦å›è¡¨ï¼š

```
explain select * from person where NAME='name1';
explain select NAME,SCORE from person where NAME='name1';
```

é€šè¿‡è§‚å¯ŸOPTIMIZER\_TRACEçš„è¾“å‡ºå¯ä»¥çœ‹åˆ°ï¼Œç´¢å¼•è¦†ç›–ï¼ˆindex\_only=trueï¼‰çš„æˆæœ¬æ˜¯1.21è€Œå›è¡¨æŸ¥è¯¢ï¼ˆindex\_only=falseï¼‰çš„æ˜¯2.21ï¼Œä¹Ÿå°±æ˜¯ç´¢å¼•è¦†ç›–èŠ‚çœäº†å›è¡¨çš„æˆæœ¬1ã€‚

ç´¢å¼•è¦†ç›–ï¼š

```
analyzing_range_alternatives": {
  "range_scan_alternatives": [
  {
    "index": "name_score",
    "ranges": [
      "name1 <= name <= name1"
    ] /* ranges */,
    "index_dives_for_eq_ranges": true,
    "rowid_ordered": false,
    "using_mrr": false,
    "index_only": true,
    "rows": 1,
    "cost": 1.21,
    "chosen": true
  }
]
```

å›è¡¨ï¼š

```
"range_scan_alternatives": [
  {
    "index": "name_score",
    "ranges": [
      "name1 <= name <= name1"
    ] /* ranges */,
    "index_dives_for_eq_ranges": true,
    "rowid_ordered": false,
    "using_mrr": false,
    "index_only": false,
    "rows": 1,
    "cost": 2.21,
    "chosen": true
  }
]
```

**é—®é¢˜2ï¼š**ç´¢å¼•é™¤äº†å¯ä»¥ç”¨äºåŠ é€Ÿæœç´¢å¤–ï¼Œè¿˜å¯ä»¥åœ¨æ’åºæ—¶å‘æŒ¥ä½œç”¨ï¼Œä½ èƒ½é€šè¿‡EXPLAINæ¥è¯æ˜å—ï¼Ÿä½ çŸ¥é“ï¼Œé’ˆå¯¹æ’åºåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ï¼Œç´¢å¼•ä¼šå¤±æ•ˆå—ï¼Ÿ

ç­”ï¼šæ’åºä½¿ç”¨åˆ°ç´¢å¼•ï¼Œåœ¨æ‰§è¡Œè®¡åˆ’ä¸­çš„ä½“ç°å°±æ˜¯keyè¿™ä¸€åˆ—ã€‚å¦‚æœæ²¡æœ‰ç”¨åˆ°ç´¢å¼•ï¼Œä¼šåœ¨Extraä¸­çœ‹åˆ°Using filesortï¼Œä»£è¡¨ä½¿ç”¨äº†å†…å­˜æˆ–ç£ç›˜è¿›è¡Œæ’åºã€‚è€Œå…·ä½“èµ°å†…å­˜è¿˜æ˜¯ç£ç›˜ï¼Œæ˜¯ç”±sort\_buffer\_sizeå’Œæ’åºæ•°æ®å¤§å°å†³å®šçš„ã€‚

æ’åºæ— æ³•ä½¿ç”¨åˆ°ç´¢å¼•çš„æƒ…å†µæœ‰ï¼š

- å¯¹äºä½¿ç”¨è”åˆç´¢å¼•è¿›è¡Œæ’åºçš„åœºæ™¯ï¼Œå¤šä¸ªå­—æ®µæ’åºASCå’ŒDESCæ··ç”¨ï¼›
- a+bä½œä¸ºè”åˆç´¢å¼•ï¼ŒæŒ‰ç…§aèŒƒå›´æŸ¥è¯¢åæŒ‰ç…§bæ’åºï¼›
- æ’åºåˆ—æ¶‰åŠåˆ°çš„å¤šä¸ªå­—æ®µä¸å±äºåŒä¸€ä¸ªè”åˆç´¢å¼•ï¼›
- æ’åºåˆ—ä½¿ç”¨äº†è¡¨è¾¾å¼ã€‚

å…¶å®ï¼Œè¿™äº›åŸå› éƒ½å’Œç´¢å¼•çš„ç»“æ„æœ‰å…³ã€‚ä½ å¯ä»¥å†æœ‰é’ˆå¯¹æ€§åœ°å¤ä¹ ä¸‹[ç¬¬07è®²](https://time.geekbang.org/column/article/213342)çš„èšç°‡ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•éƒ¨åˆ†ã€‚

### [08 | åˆ¤ç­‰é—®é¢˜ï¼šç¨‹åºé‡Œå¦‚ä½•ç¡®å®šä½ å°±æ˜¯ä½ ï¼Ÿ](https://time.geekbang.org/column/article/213604)

**é—®é¢˜1ï¼š**åœ¨å®ç°equalsæ—¶ï¼Œæˆ‘æ˜¯å…ˆé€šè¿‡getClassæ–¹æ³•åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡çš„ç±»å‹ï¼Œä½ å¯èƒ½ä¼šæƒ³åˆ°è¿˜å¯ä»¥ä½¿ç”¨instanceofæ¥åˆ¤æ–­ã€‚ä½ èƒ½è¯´è¯´è¿™ä¸¤ç§å®ç°æ–¹å¼çš„åŒºåˆ«å—ï¼Ÿ

ç­”ï¼šäº‹å®ä¸Šï¼Œä½¿ç”¨getClasså’Œinstanceofè¿™ä¸¤ç§æ–¹æ¡ˆéƒ½æ˜¯å¯ä»¥åˆ¤æ–­å¯¹è±¡ç±»å‹çš„ã€‚å®ƒä»¬çš„åŒºåˆ«å°±æ˜¯ï¼ŒgetClassé™åˆ¶äº†è¿™ä¸¤ä¸ªå¯¹è±¡åªèƒ½å±äºåŒä¸€ä¸ªç±»ï¼Œè€Œinstanceofå´å…è®¸ä¸¤ä¸ªå¯¹è±¡æ˜¯åŒä¸€ä¸ªç±»æˆ–å…¶å­ç±»ã€‚

æ­£æ˜¯å› ä¸ºè¿™ç§åŒºåˆ«ï¼Œä¸åŒçš„äººå¯¹è¿™ä¸¤ç§æ–¹æ¡ˆæœ‰ä¸åŒçš„å–œå¥½ï¼Œäº‰è®ºä¹Ÿå¾ˆå¤šã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œä½ åªéœ€è¦æ ¹æ®è‡ªå·±çš„è¦æ±‚å»é€‰æ‹©ã€‚è¡¥å……è¯´æ˜ä¸€ä¸‹ï¼ŒLombokä½¿ç”¨çš„æ˜¯instanceofçš„æ–¹æ¡ˆã€‚

**é—®é¢˜2ï¼š**åœ¨â€œhashCode å’Œ equals è¦é…å¯¹å®ç°â€è¿™ä¸€èŠ‚çš„ä¾‹å­ä¸­ï¼Œæˆ‘æ¼”ç¤ºäº†å¯ä»¥é€šè¿‡HashSetçš„containsæ–¹æ³•åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨HashSetä¸­ã€‚é‚£åŒæ ·æ˜¯Setçš„TreeSetï¼Œå…¶containsæ–¹æ³•å’ŒHashSetçš„containsæ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿ

ç­”ï¼šHashSetåŸºäºHashMapï¼Œæ•°æ®ç»“æ„æ˜¯å“ˆå¸Œè¡¨ã€‚æ‰€ä»¥ï¼ŒHashSetçš„containsæ–¹æ³•ï¼Œå…¶å®å°±æ˜¯æ ¹æ®hashcodeå’Œequalså»åˆ¤æ–­ç›¸ç­‰çš„ã€‚

TreeSetåŸºäºTreeMapï¼Œæ•°æ®ç»“æ„æ˜¯çº¢é»‘æ ‘ã€‚æ‰€ä»¥ï¼ŒTreeSetçš„containsæ–¹æ³•ï¼Œå…¶å®å°±æ˜¯æ ¹æ®compareToå»åˆ¤æ–­ç›¸ç­‰çš„ã€‚

### [09 | æ•°å€¼è®¡ç®—ï¼šæ³¨æ„ç²¾åº¦ã€èˆå…¥å’Œæº¢å‡ºé—®é¢˜](https://time.geekbang.org/column/article/213796)

**é—®é¢˜1ï¼š**[BigDecimal](https://docs.oracle.com/javase/8/docs/api/java/math/BigDecimal.html)æä¾›äº†8ç§èˆå…¥æ¨¡å¼ï¼Œä½ èƒ½é€šè¿‡ä¸€äº›ä¾‹å­è¯´è¯´å®ƒä»¬çš„åŒºåˆ«å—ï¼Ÿ

ç­”ï¼š@DarrenåŒå­¦çš„ç•™è¨€éå¸¸å…¨é¢ï¼Œæ¢³ç†å¾—ä¹Ÿéå¸¸æ¸…æ¥šäº†ã€‚è¿™é‡Œï¼Œæˆ‘å¯¹ä»–çš„ç•™è¨€ç¨åŠ ä¿®æ”¹ï¼Œå°±æ˜¯è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆäº†ã€‚

ç¬¬ä¸€ç§ï¼ŒROUND\_UPï¼Œèˆå…¥è¿œç¦»é›¶çš„èˆå…¥æ¨¡å¼ï¼Œåœ¨ä¸¢å¼ƒéé›¶éƒ¨åˆ†ä¹‹å‰å§‹ç»ˆå¢åŠ æ•°å­—ï¼ˆå§‹ç»ˆå¯¹éé›¶èˆå¼ƒéƒ¨åˆ†å‰é¢çš„æ•°å­—åŠ 1ï¼‰ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤èˆå…¥æ¨¡å¼å§‹ç»ˆä¸ä¼šå‡å°‘åŸå§‹å€¼ã€‚

ç¬¬äºŒç§ï¼ŒROUND\_DOWNï¼Œæ¥è¿‘é›¶çš„èˆå…¥æ¨¡å¼ï¼Œåœ¨ä¸¢å¼ƒæŸéƒ¨åˆ†ä¹‹å‰å§‹ç»ˆä¸å¢åŠ æ•°å­—ï¼ˆä»ä¸å¯¹èˆå¼ƒéƒ¨åˆ†å‰é¢çš„æ•°å­—åŠ 1ï¼Œå³æˆªæ–­ï¼‰ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤èˆå…¥æ¨¡å¼å§‹ç»ˆä¸ä¼šå¢åŠ åŸå§‹å€¼ã€‚

ç¬¬ä¸‰ç§ï¼ŒROUND\_CEILINGï¼Œæ¥è¿‘æ­£æ— ç©·å¤§çš„èˆå…¥æ¨¡å¼ã€‚ å¦‚æœ BigDecimal ä¸ºæ­£ï¼Œåˆ™èˆå…¥è¡Œä¸ºä¸ ROUND\_UP ç›¸åŒï¼› å¦‚æœä¸ºè´Ÿï¼Œåˆ™èˆå…¥è¡Œä¸ºä¸ ROUND\_DOWN ç›¸åŒã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤èˆå…¥æ¨¡å¼å§‹ç»ˆä¸ä¼šå‡å°‘åŸå§‹å€¼ã€‚

ç¬¬å››ç§ï¼ŒROUND\_FLOORï¼Œæ¥è¿‘è´Ÿæ— ç©·å¤§çš„èˆå…¥æ¨¡å¼ã€‚ å¦‚æœ BigDecimal ä¸ºæ­£ï¼Œåˆ™èˆå…¥è¡Œä¸ºä¸ ROUND\_DOWN ç›¸åŒï¼› å¦‚æœä¸ºè´Ÿï¼Œåˆ™èˆå…¥è¡Œä¸ºä¸ ROUND\_UP ç›¸åŒã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤èˆå…¥æ¨¡å¼å§‹ç»ˆä¸ä¼šå¢åŠ åŸå§‹å€¼ã€‚

ç¬¬äº”ç§ï¼ŒROUND\_HALF\_UPï¼Œå‘â€œæœ€æ¥è¿‘çš„â€æ•°å­—èˆå…¥ã€‚å¦‚æœèˆå¼ƒéƒ¨åˆ† &gt;= 0.5ï¼Œåˆ™èˆå…¥è¡Œä¸ºä¸ ROUND\_UP ç›¸åŒï¼›å¦åˆ™ï¼Œèˆå…¥è¡Œä¸ºä¸ ROUND\_DOWN ç›¸åŒã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™æ˜¯æˆ‘ä»¬å¤§å¤šæ•°äººåœ¨å°å­¦æ—¶å°±å­¦è¿‡çš„èˆå…¥æ¨¡å¼ï¼ˆå››èˆäº”å…¥ï¼‰ã€‚

ç¬¬å…­ç§ï¼ŒROUND\_HALF\_DOWNï¼Œå‘â€œæœ€æ¥è¿‘çš„â€æ•°å­—èˆå…¥ã€‚å¦‚æœèˆå¼ƒéƒ¨åˆ† &gt; 0.5ï¼Œåˆ™èˆå…¥è¡Œä¸ºä¸ ROUND\_UP ç›¸åŒï¼›å¦åˆ™ï¼Œèˆå…¥è¡Œä¸ºä¸ ROUND\_DOWN ç›¸åŒï¼ˆäº”èˆå…­å…¥ï¼‰ã€‚

ç¬¬ä¸ƒç§ï¼ŒROUND\_HALF\_EVENï¼Œå‘â€œæœ€æ¥è¿‘çš„â€æ•°å­—èˆå…¥ã€‚è¿™ç§ç®—æ³•å«åšé“¶è¡Œå®¶ç®—æ³•ï¼Œå…·ä½“è§„åˆ™æ˜¯ï¼Œå››èˆå…­å…¥ï¼Œäº”åˆ™çœ‹å‰ä¸€ä½ï¼Œå¦‚æœæ˜¯å¶æ•°èˆå…¥ï¼Œå¦‚æœæ˜¯å¥‡æ•°è¿›ä½ï¼Œæ¯”å¦‚5.5 -&gt; 6ï¼Œ2.5 -&gt; 2ã€‚

ç¬¬å…«ç§ï¼ŒROUND\_UNNECESSARYï¼Œå‡è®¾è¯·æ±‚çš„æ“ä½œå…·æœ‰ç²¾ç¡®çš„ç»“æœï¼Œä¹Ÿå°±æ˜¯ä¸éœ€è¦è¿›è¡Œèˆå…¥ã€‚å¦‚æœè®¡ç®—ç»“æœäº§ç”Ÿä¸ç²¾ç¡®çš„ç»“æœï¼Œåˆ™æŠ›å‡ºArithmeticExceptionã€‚

**é—®é¢˜2ï¼š**æ•°æ®åº“ï¼ˆæ¯”å¦‚MySQLï¼‰ä¸­çš„æµ®ç‚¹æ•°å’Œæ•´å‹æ•°å­—ï¼Œä½ çŸ¥é“åº”è¯¥æ€æ ·å®šä¹‰å—ï¼Ÿåˆå¦‚ä½•å®ç°æµ®ç‚¹æ•°çš„å‡†ç¡®è®¡ç®—å‘¢ï¼Ÿ

ç­”ï¼šMySQLä¸­çš„æ•´æ•°æ ¹æ®èƒ½è¡¨ç¤ºçš„èŒƒå›´æœ‰TINYINTã€SMALLINTã€MEDIUMINTã€INTEGERã€BIGINTç­‰ç±»å‹ï¼Œæµ®ç‚¹æ•°åŒ…æ‹¬å•ç²¾åº¦æµ®ç‚¹æ•°FLOATå’ŒåŒç²¾åº¦æµ®ç‚¹æ•°DOUBLEå’ŒJavaä¸­çš„float/doubleä¸€æ ·ï¼ŒåŒæ ·æœ‰ç²¾åº¦é—®é¢˜ã€‚

è¦è§£å†³ç²¾åº¦é—®é¢˜ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªåŠæ³•ï¼š

- ç¬¬ä¸€ï¼Œä½¿ç”¨DECIMALç±»å‹ï¼ˆå’Œé‚£äº›INTç±»å‹ä¸€æ ·ï¼Œéƒ½å±äºä¸¥æ ¼æ•°å€¼æ•°æ®ç±»å‹ï¼‰ï¼Œæ¯”å¦‚DECIMAL(13, 2)æˆ–DECIMAL(13, 4)ã€‚
- ç¬¬äºŒï¼Œä½¿ç”¨æ•´æ•°ä¿å­˜åˆ°åˆ†ï¼Œè¿™ç§æ–¹å¼å®¹æ˜“å‡ºé”™ï¼Œä¸‡ä¸€è¯»çš„æ—¶å€™å¿˜è®°/100æˆ–è€…æ˜¯å­˜çš„æ—¶å€™å¿˜è®°\*100ï¼Œå¯èƒ½ä¼šå¼•èµ·é‡å¤§é—®é¢˜ã€‚å½“ç„¶äº†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è€ƒè™‘å°†æ•´æ•°å’Œå°æ•°åˆ†å¼€ä¿å­˜åˆ°ä¸¤ä¸ªæ•´æ•°å­—æ®µã€‚

### [10 | é›†åˆç±»ï¼šå‘æ»¡åœ°çš„Liståˆ—è¡¨æ“ä½œ](https://time.geekbang.org/column/article/216778)

**é—®é¢˜1ï¼š**è°ƒç”¨ç±»å‹æ˜¯Integerçš„ArrayListçš„removeæ–¹æ³•åˆ é™¤å…ƒç´ ï¼Œä¼ å…¥ä¸€ä¸ªIntegeråŒ…è£…ç±»çš„æ•°å­—å’Œä¼ å…¥ä¸€ä¸ªintåŸºæœ¬ç±»å‹çš„æ•°å­—ï¼Œç»“æœä¸€æ ·å—ï¼Ÿ

ç­”ï¼šä¼ intåŸºæœ¬ç±»å‹çš„removeæ–¹æ³•æ˜¯æŒ‰ç´¢å¼•å€¼ç§»é™¤ï¼Œè¿”å›ç§»é™¤çš„å€¼ï¼›ä¼ IntegeråŒ…è£…ç±»çš„removeæ–¹æ³•æ˜¯æŒ‰å€¼ç§»é™¤ï¼Œè¿”å›åˆ—è¡¨ç§»é™¤é¡¹ç›®ä¹‹å‰æ˜¯å¦åŒ…å«è¿™ä¸ªå€¼ï¼ˆæ˜¯å¦ç§»é™¤æˆåŠŸï¼‰ã€‚

ä¸ºäº†éªŒè¯ä¸¤ä¸ªremoveæ–¹æ³•é‡è½½çš„åŒºåˆ«ï¼Œæˆ‘ä»¬å†™ä¸€æ®µæµ‹è¯•ä»£ç æ¯”è¾ƒä¸€ä¸‹ï¼š

```
private static void removeByIndex(int index) {
    List<Integer> list =
            IntStream.rangeClosed(1, 10).boxed().collect(Collectors.toCollection(ArrayList::new));
    System.out.println(list.remove(index));
    System.out.println(list);
}
private static void removeByValue(Integer index) {
    List<Integer> list =
            IntStream.rangeClosed(1, 10).boxed().collect(Collectors.toCollection(ArrayList::new));
    System.out.println(list.remove(index));
    System.out.println(list);
}
```

æµ‹è¯•ä¸€ä¸‹removeByIndex(4)ï¼Œé€šè¿‡è¾“å‡ºå¯ä»¥çœ‹åˆ°ç¬¬äº”é¡¹è¢«ç§»é™¤äº†ï¼Œè¿”å›5ï¼š

```
5
[1, 2, 3, 4, 6, 7, 8, 9, 10]
```

è€Œè°ƒç”¨removeByValue(Integer.valueOf(4))ï¼Œé€šè¿‡è¾“å‡ºå¯ä»¥çœ‹åˆ°å€¼4è¢«ç§»é™¤äº†ï¼Œè¿”å›trueï¼š

```
true
[1, 2, 3, 5, 6, 7, 8, 9, 10]
```

**é—®é¢˜2ï¼š**å¾ªç¯éå†Listï¼Œè°ƒç”¨removeæ–¹æ³•åˆ é™¤å…ƒç´ ï¼Œå¾€å¾€ä¼šé‡åˆ°ConcurrentModificationExceptionï¼ŒåŸå› æ˜¯ä»€ä¹ˆï¼Œä¿®å¤æ–¹å¼åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

ç­”ï¼šåŸå› æ˜¯ï¼Œremoveçš„æ—¶å€™ä¼šæ”¹å˜modCountï¼Œé€šè¿‡è¿­ä»£å™¨éå†å°±ä¼šè§¦å‘ConcurrentModificationExceptionã€‚æˆ‘ä»¬çœ‹ä¸‹ArrayListç±»å†…éƒ¨è¿­ä»£å™¨çš„ç›¸å…³æºç ï¼š

```
public E next() {
    checkForComodification();
    int i = cursor;
    if (i >= size)
        throw new NoSuchElementException();
    Object[] elementData = ArrayList.this.elementData;
    if (i >= elementData.length)
        throw new ConcurrentModificationException();
    cursor = i + 1;
    return (E) elementData[lastRet = i];
}

final void checkForComodification() {
    if (modCount != expectedModCount)
        throw new ConcurrentModificationException();
}
```

è¦ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§è§£å†³æ–¹æ¡ˆã€‚

ç¬¬ä¸€ç§ï¼Œé€šè¿‡ArrayListçš„è¿­ä»£å™¨removeã€‚è¿­ä»£å™¨çš„removeæ–¹æ³•ä¼šç»´æŠ¤ä¸€ä¸ªexpectedModCountï¼Œä½¿å…¶ä¸ ArrayList çš„modCountä¿æŒä¸€è‡´ï¼š

```
List<String> list =
        IntStream.rangeClosed(1, 10).mapToObj(String::valueOf).collect(Collectors.toCollection(ArrayList::new));
for (Iterator<String> iterator = list.iterator(); iterator.hasNext(); ) {
    String next = iterator.next();
    if ("2".equals(next)) {
        iterator.remove();
    }
}
System.out.println(list);
```

ç¬¬äºŒç§ï¼Œç›´æ¥ä½¿ç”¨removeIfæ–¹æ³•ï¼Œå…¶å†…éƒ¨ä½¿ç”¨äº†è¿­ä»£å™¨çš„removeæ–¹æ³•ï¼š

```
List<String> list =
        IntStream.rangeClosed(1, 10).mapToObj(String::valueOf).collect(Collectors.toCollection(ArrayList::new));
list.removeIf(item -> item.equals("2"));
System.out.println(list);
```

### [11 | ç©ºå€¼å¤„ç†ï¼šåˆ†ä¸æ¸…æ¥šçš„nullå’Œæ¼äººçš„ç©ºæŒ‡é’ˆ](https://time.geekbang.org/column/article/216830)

**é—®é¢˜1ï¼š**ConcurrentHashMapçš„Keyå’ŒValueéƒ½ä¸èƒ½ä¸ºnullï¼Œè€ŒHashMapå´å¯ä»¥ï¼Œä½ çŸ¥é“è¿™ä¹ˆè®¾è®¡çš„åŸå› æ˜¯ä»€ä¹ˆå—ï¼ŸTreeMapã€Hashtableç­‰Mapçš„Keyå’ŒValueæ˜¯å¦æ”¯æŒnullå‘¢ï¼Ÿ

ç­”ï¼šåŸå› æ­£å¦‚ConcurrentHashMapçš„ä½œè€…æ‰€è¯´ï¼š

> The main reason that nulls arenâ€™t allowed in ConcurrentMaps (ConcurrentHashMaps, ConcurrentSkipListMaps) is that ambiguities that may be just barely tolerable in non-concurrent maps canâ€™t be accommodated. The main one is that if map.get(key) returns null, you canâ€™t detect whether the key explicitly maps to null vs the key isnâ€™t mapped. In a non-concurrent map, you can check this via map.contains(key), but in a concurrent one, the map might have changed between calls.

å¦‚æœValueä¸ºnullä¼šå¢åŠ äºŒä¹‰æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´å¤šçº¿ç¨‹æƒ…å†µä¸‹map.get(key)è¿”å›nullï¼Œæˆ‘ä»¬æ— æ³•åŒºåˆ†ValueåŸæœ¬å°±æ˜¯nullè¿˜æ˜¯Keyæ²¡æœ‰æ˜ å°„ï¼ŒKeyä¹Ÿæ˜¯ç±»ä¼¼çš„åŸå› ã€‚æ­¤å¤–ï¼Œæˆ‘ä¹Ÿæ›´åŒæ„ä»–çš„è§‚ç‚¹ï¼Œå°±æ˜¯æ™®é€šçš„Mapå…è®¸nullæ˜¯å¦æ˜¯ä¸€ä¸ªæ­£ç¡®çš„åšæ³•ï¼Œä¹Ÿå€¼å¾—å•†æ¦·ï¼Œå› ä¸ºè¿™ä¼šå¢åŠ çŠ¯é”™çš„å¯èƒ½æ€§ã€‚

Hashtableä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥Keyå’ŒValueä¸å¯ä»¥æ˜¯nullã€‚

TreeMapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œä½†æ˜¯å› ä¸ºéœ€è¦æ’åºï¼Œéœ€è¦è¿›è¡Œkeyçš„compareToæ–¹æ³•ï¼Œæ‰€ä»¥Keyä¸èƒ½æ˜¯nullï¼Œè€ŒValueå¯ä»¥æ˜¯nullã€‚

**é—®é¢˜2ï¼š**å¯¹äºHibernateæ¡†æ¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@DynamicUpdateæ³¨è§£å®ç°å­—æ®µçš„åŠ¨æ€æ›´æ–°ã€‚é‚£ä¹ˆï¼Œå¯¹äºMyBatisæ¡†æ¶æ¥è¯´ï¼Œè¦å¦‚ä½•å®ç°ç±»ä¼¼çš„åŠ¨æ€SQLåŠŸèƒ½ï¼Œå®ç°æ’å…¥å’Œä¿®æ”¹SQLåªåŒ…å«POJOä¸­çš„éç©ºå­—æ®µå‘¢ï¼Ÿ

ç­”ï¼šMyBatiså¯ä»¥é€šè¿‡åŠ¨æ€SQLå®ç°ï¼š

```
<select id="findUser" resultType="User">
  SELECT * FROM USER
  WHERE 1=1
  <if test="name != null">
    AND name like #{name}
  </if>
  <if test="email != null">
    AND email = #{email}
  </if>
</select>
```

å¦‚æœä½¿ç”¨MyBatisPlusçš„è¯ï¼Œå®ç°ç±»ä¼¼çš„åŠ¨æ€SQLåŠŸèƒ½ä¼šæ›´æ–¹ä¾¿ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨å­—æ®µä¸ŠåŠ @TableFieldæ³¨è§£æ¥å®ç°ï¼Œå¯ä»¥è®¾ç½®insertStrategyã€updateStrategyã€whereStrategyå±æ€§ã€‚å…³äºè¿™ä¸‰ä¸ªå±æ€§çš„ä½¿ç”¨æ–¹å¼ï¼Œä½ å¯ä»¥å‚è€ƒå¦‚ä¸‹æºç ï¼Œæˆ–æ˜¯[è¿™é‡Œ](https://mp.baomidou.com/guide/annotation.html#tablefield)çš„å®˜æ–¹æ–‡æ¡£ï¼š

```
/**
	     * å­—æ®µéªŒè¯ç­–ç•¥ä¹‹ insert: å½“insertæ“ä½œæ—¶ï¼Œè¯¥å­—æ®µæ‹¼æ¥insertè¯­å¥æ—¶çš„ç­–ç•¥
	     * IGNORED: ç›´æ¥æ‹¼æ¥ insert into table_a(column) values (#{columnProperty});
	     * NOT_NULL: insert into table_a(<if test="columnProperty != null">column</if>) values (<if test="columnProperty != null">#{columnProperty}</if>)
	     * NOT_EMPTY: insert into table_a(<if test="columnProperty != null and columnProperty!=''">column</if>) values (<if test="columnProperty != null and columnProperty!=''">#{columnProperty}</if>)
	     *
	     * @since 3.1.2
	     */
	    FieldStrategy insertStrategy() default FieldStrategy.DEFAULT;
	

	    /**
	     * å­—æ®µéªŒè¯ç­–ç•¥ä¹‹ update: å½“æ›´æ–°æ“ä½œæ—¶ï¼Œè¯¥å­—æ®µæ‹¼æ¥setè¯­å¥æ—¶çš„ç­–ç•¥
	     * IGNORED: ç›´æ¥æ‹¼æ¥ update table_a set column=#{columnProperty}, å±æ€§ä¸ºnull/ç©ºstringéƒ½ä¼šè¢«setè¿›å»
	     * NOT_NULL: update table_a set <if test="columnProperty != null">column=#{columnProperty}</if>
	     * NOT_EMPTY: update table_a set <if test="columnProperty != null and columnProperty!=''">column=#{columnProperty}</if>
	     *
	     * @since 3.1.2
	     */
	    FieldStrategy updateStrategy() default FieldStrategy.DEFAULT;
	

	    /**
	     * å­—æ®µéªŒè¯ç­–ç•¥ä¹‹ where: è¡¨ç¤ºè¯¥å­—æ®µåœ¨æ‹¼æ¥whereæ¡ä»¶æ—¶çš„ç­–ç•¥
	     * IGNORED: ç›´æ¥æ‹¼æ¥ column=#{columnProperty}
	     * NOT_NULL: <if test="columnProperty != null">column=#{columnProperty}</if>
	     * NOT_EMPTY: <if test="columnProperty != null and columnProperty!=''">column=#{columnProperty}</if>
	     *
	     * @since 3.1.2
	     */
	    FieldStrategy whereStrategy() default FieldStrategy.DEFAULT;
```

### [12 | å¼‚å¸¸å¤„ç†ï¼šåˆ«è®©è‡ªå·±åœ¨å‡ºé—®é¢˜çš„æ—¶å€™å˜ä¸ºçå­](https://time.geekbang.org/column/article/220230)

**é—®é¢˜1ï¼š**å…³äºåœ¨finallyä»£ç å—ä¸­æŠ›å‡ºå¼‚å¸¸çš„å‘ï¼Œå¦‚æœåœ¨finallyä»£ç å—ä¸­è¿”å›å€¼ï¼Œä½ è§‰å¾—ç¨‹åºä¼šä»¥tryæˆ–catchä¸­çš„è¿”å›å€¼ä¸ºå‡†ï¼Œè¿˜æ˜¯ä»¥finallyä¸­çš„è¿”å›å€¼ä¸ºå‡†å‘¢ï¼Ÿ

ç­”ï¼šä»¥finallyä¸­çš„è¿”å›å€¼ä¸ºå‡†ã€‚

ä»è¯­ä¹‰ä¸Šæ¥è¯´ï¼Œfinallyæ˜¯åšæ–¹æ³•æ”¶å°¾èµ„æºé‡Šæ”¾å¤„ç†çš„ï¼Œæˆ‘ä»¬ä¸å»ºè®®åœ¨finallyä¸­æœ‰returnï¼Œè¿™æ ·é€»è¾‘ä¼šå¾ˆæ··ä¹±ã€‚è¿™æ˜¯å› ä¸ºï¼Œå®ç°ä¸Šfinallyä¸­çš„ä»£ç å—ä¼šè¢«å¤åˆ¶å¤šä»½ï¼Œåˆ†åˆ«æ”¾åˆ°tryå’Œcatchè°ƒç”¨returnå’Œthrowå¼‚å¸¸ä¹‹å‰ï¼Œæ‰€ä»¥finallyä¸­å¦‚æœæœ‰è¿”å›å€¼ï¼Œä¼šè¦†ç›–tryä¸­çš„è¿”å›å€¼ã€‚

**é—®é¢˜2ï¼š**å¯¹äºæ‰‹åŠ¨æŠ›å‡ºçš„å¼‚å¸¸ï¼Œä¸å»ºè®®ç›´æ¥ä½¿ç”¨Exceptionæˆ–RuntimeExceptionï¼Œé€šå¸¸å»ºè®®å¤ç”¨JDKä¸­çš„ä¸€äº›æ ‡å‡†å¼‚å¸¸ï¼Œæ¯”å¦‚[IllegalArgumentException](https://docs.oracle.com/javase/8/docs/api/java/lang/IllegalArgumentException.html)ã€[IllegalStateException](https://docs.oracle.com/javase/8/docs/api/java/lang/IllegalStateException.html)ã€[UnsupportedOperationException](https://docs.oracle.com/javase/8/docs/api/java/lang/UnsupportedOperationException.html)ã€‚ä½ èƒ½è¯´è¯´å®ƒä»¬çš„é€‚ç”¨åœºæ™¯ï¼Œå¹¶åˆ—å‡ºæ›´å¤šå¸¸è§çš„å¯é‡ç”¨æ ‡å‡†å¼‚å¸¸å—ï¼Ÿ

ç­”ï¼šæˆ‘ä»¬å…ˆåˆ†åˆ«çœ‹çœ‹IllegalArgumentExceptionã€IllegalStateExceptionã€UnsupportedOperationExceptionè¿™ä¸‰ç§å¼‚å¸¸çš„é€‚ç”¨åœºæ™¯ã€‚

- IllegalArgumentExceptionï¼šå‚æ•°ä¸åˆæ³•å¼‚å¸¸ï¼Œé€‚ç”¨äºä¼ å…¥çš„å‚æ•°ä¸ç¬¦åˆæ–¹æ³•è¦æ±‚çš„åœºæ™¯ã€‚
- IllegalStateExceptionï¼šçŠ¶æ€ä¸åˆæ³•å¼‚å¸¸ï¼Œé€‚ç”¨äºçŠ¶æ€æœºçš„çŠ¶æ€çš„æ— æ•ˆè½¬æ¢ï¼Œå½“å‰é€»è¾‘çš„æ‰§è¡ŒçŠ¶æ€ä¸é€‚åˆè¿›è¡Œç›¸åº”æ“ä½œç­‰åœºæ™¯ã€‚
- UnsupportedOperationExceptionï¼šæ“ä½œä¸æ”¯æŒå¼‚å¸¸ï¼Œé€‚ç”¨äºæŸä¸ªæ“ä½œåœ¨å®ç°æˆ–ç¯å¢ƒä¸‹ä¸æ”¯æŒçš„åœºæ™¯ã€‚

è¿˜å¯ä»¥é‡ç”¨çš„å¼‚å¸¸æœ‰IndexOutOfBoundsExceptionã€NullPointerExceptionã€ConcurrentModificationExceptionç­‰ã€‚

ä»¥ä¸Šï¼Œå°±æ˜¯å’±ä»¬è¿™é—¨è¯¾ç¬¬7~12è®²çš„æ€è€ƒé¢˜ç­”æ¡ˆäº†ã€‚

å…³äºè¿™äº›é¢˜ç›®ï¼Œä»¥åŠèƒŒåæ¶‰åŠçš„çŸ¥è¯†ç‚¹ï¼Œå¦‚æœä½ è¿˜æœ‰å“ªé‡Œæ„Ÿè§‰ä¸æ¸…æ¥šçš„ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºä¸æˆ‘ç•™è¨€ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠä»Šå¤©çš„å†…å®¹åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–åŒäº‹ï¼Œä¸€èµ·äº¤æµã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ2ï¼‰</strong></div><ul>
<li><span>é•ç ºæ‹¬ç¾½</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>æˆ‘æœ‰ä¸ªé—®é¢˜æƒ³é—®  where  1=1  æ˜¯ä¸æ˜¯æ¢æˆ&lt;where&gt;æ›´å¥½ä¸€äº›</p>2022-05-11</li><br/><li><span>fusion</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>è€å¸ˆä¸ºä»€ä¹ˆæˆ‘æŸ¥è¯¢çš„ç»“æœæ˜¯
SET SQL_SELECT_LIMIT=1000	{
  &quot;steps&quot;: [
  ]
}	0	false

è¯­å¥æ˜¯ï¼š
SET optimizer_trace=&quot;enabled=on&quot;;
SELECT name,score FROM person WHERE NAME=&#39;name1&#39;
 SELECT * FROM information_schema.OPTIMIZER_TRACE;
SET optimizer_trace=&quot;enabled=off&quot;;</p>2024-01-17</li><br/>
</ul>