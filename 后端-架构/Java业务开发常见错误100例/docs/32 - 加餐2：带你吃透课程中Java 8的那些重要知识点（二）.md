ä½ å¥½ï¼Œæˆ‘æ˜¯æœ±æ™”ã€‚

ä¸Šä¸€è®²çš„å‡ ä¸ªä¾‹å­ä¸­ï¼Œå…¶å®éƒ½æ¶‰åŠäº†Stream APIçš„æœ€åŸºæœ¬ä½¿ç”¨æ–¹æ³•ã€‚ä»Šå¤©ï¼Œæˆ‘ä¼šä¸ä½ è¯¦ç»†ä»‹ç»å¤æ‚ã€åŠŸèƒ½å¼ºå¤§çš„Stream APIã€‚

Streamæµå¼æ“ä½œï¼Œç”¨äºå¯¹é›†åˆè¿›è¡ŒæŠ•å½±ã€è½¬æ¢ã€è¿‡æ»¤ã€æ’åºç­‰ï¼Œæ›´è¿›ä¸€æ­¥åœ°ï¼Œè¿™äº›æ“ä½œèƒ½é“¾å¼ä¸²è”åœ¨ä¸€èµ·ä½¿ç”¨ï¼Œç±»ä¼¼äºSQLè¯­å¥ï¼Œå¯ä»¥å¤§å¤§ç®€åŒ–ä»£ç ã€‚å¯ä»¥è¯´ï¼ŒStreamæ“ä½œæ˜¯Java 8ä¸­æœ€é‡è¦çš„å†…å®¹ï¼Œä¹Ÿæ˜¯è¿™ä¸ªè¯¾ç¨‹å¤§éƒ¨åˆ†ä»£ç éƒ½ä¼šç”¨åˆ°çš„æ“ä½œã€‚

æˆ‘å…ˆè¯´æ˜ä¸‹ï¼Œæœ‰äº›æ¡ˆä¾‹å¯èƒ½ä¸å¤ªå¥½ç†è§£ï¼Œå»ºè®®ä½ å¯¹ç€ä»£ç é€ä¸€åˆ°æºç ä¸­æŸ¥çœ‹Streamæ“ä½œçš„æ–¹æ³•å®šä¹‰ï¼Œä»¥åŠJDKä¸­çš„ä»£ç æ³¨é‡Šã€‚

## Streamæ“ä½œè¯¦è§£

ä¸ºäº†æ–¹ä¾¿ä½ ç†è§£Streamçš„å„ç§æ“ä½œï¼Œä»¥åŠåé¢çš„æ¡ˆä¾‹ï¼Œæˆ‘å…ˆæŠŠè¿™èŠ‚è¯¾æ¶‰åŠçš„Streamæ“ä½œæ±‡æ€»åˆ°äº†ä¸€å¼ å›¾ä¸­ã€‚ä½ å¯ä»¥å…ˆç†Ÿæ‚‰ä¸€ä¸‹ã€‚

![](https://static001.geekbang.org/resource/image/44/04/44a6f4cb8b413ef62c40a272cb474104.jpg?wh=3521%2A2617)

åœ¨æ¥ä¸‹æ¥çš„è®²è¿°ä¸­ï¼Œæˆ‘ä¼šå›´ç»•è®¢å•åœºæ™¯ï¼Œç»™å‡ºå¦‚ä½•ä½¿ç”¨Streamçš„å„ç§APIå®Œæˆè®¢å•çš„ç»Ÿè®¡ã€æœç´¢ã€æŸ¥è¯¢ç­‰åŠŸèƒ½ï¼Œå’Œä½ ä¸€èµ·å­¦ä¹ Streamæµå¼æ“ä½œçš„å„ç§æ–¹æ³•ã€‚ä½ å¯ä»¥ç»“åˆä»£ç ä¸­çš„æ³¨é‡Šç†è§£æ¡ˆä¾‹ï¼Œä¹Ÿå¯ä»¥è‡ªå·±è¿è¡Œæºç è§‚å¯Ÿè¾“å‡ºã€‚

æˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ªè®¢å•ç±»ã€ä¸€ä¸ªè®¢å•å•†å“ç±»å’Œä¸€ä¸ªé¡¾å®¢ç±»ï¼Œç”¨ä½œåç»­Demoä»£ç çš„æ•°æ®ç»“æ„ï¼š

```
//è®¢å•ç±»
@Data
public class Order {
    private Long id;
    private Long customerId;//é¡¾å®¢ID
    private String customerName;//é¡¾å®¢å§“å
    private List<OrderItem> orderItemList;//è®¢å•å•†å“æ˜ç»†
    private Double totalPrice;//æ€»ä»·æ ¼
    private LocalDateTime placedAt;//ä¸‹å•æ—¶é—´
}
//è®¢å•å•†å“ç±»
@Data
@AllArgsConstructor
@NoArgsConstructor
public class OrderItem {
    private Long productId;//å•†å“ID
    private String productName;//å•†å“åç§°
    private Double productPrice;//å•†å“ä»·æ ¼
    private Integer productQuantity;//å•†å“æ•°é‡
}
//é¡¾å®¢ç±»
@Data
@AllArgsConstructor
public class Customer {
    private Long id;
    private String name;//é¡¾å®¢å§“å
}
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªorderså­—æ®µä¿å­˜äº†ä¸€äº›æ¨¡æ‹Ÿæ•°æ®ï¼Œç±»å‹æ˜¯Listã€‚è¿™é‡Œï¼Œæˆ‘å°±ä¸è´´å‡ºç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®çš„ä»£ç äº†ã€‚è¿™ä¸ä¼šå½±å“ä½ ç†è§£åé¢çš„ä»£ç ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±ä¸‹è½½æºç é˜…è¯»ã€‚

### åˆ›å»ºæµ

è¦ä½¿ç”¨æµï¼Œå°±è¦å…ˆåˆ›å»ºæµã€‚åˆ›å»ºæµä¸€èˆ¬æœ‰äº”ç§æ–¹å¼ï¼š

- é€šè¿‡streamæ–¹æ³•æŠŠListæˆ–æ•°ç»„è½¬æ¢ä¸ºæµï¼›
- é€šè¿‡Stream.ofæ–¹æ³•ç›´æ¥ä¼ å…¥å¤šä¸ªå…ƒç´ æ„æˆä¸€ä¸ªæµï¼›
- é€šè¿‡Stream.iterateæ–¹æ³•ä½¿ç”¨è¿­ä»£çš„æ–¹å¼æ„é€ ä¸€ä¸ªæ— é™æµï¼Œç„¶åä½¿ç”¨limité™åˆ¶æµå…ƒç´ ä¸ªæ•°ï¼›
- é€šè¿‡Stream.generateæ–¹æ³•ä»å¤–éƒ¨ä¼ å…¥ä¸€ä¸ªæä¾›å…ƒç´ çš„Supplieræ¥æ„é€ æ— é™æµï¼Œç„¶åä½¿ç”¨limité™åˆ¶æµå…ƒç´ ä¸ªæ•°ï¼›
- é€šè¿‡IntStreamæˆ–DoubleStreamæ„é€ åŸºæœ¬ç±»å‹çš„æµã€‚

```
//é€šè¿‡streamæ–¹æ³•æŠŠListæˆ–æ•°ç»„è½¬æ¢ä¸ºæµ
@Test
public void stream()
{
    Arrays.asList("a1", "a2", "a3").stream().forEach(System.out::println);
    Arrays.stream(new int[]{1, 2, 3}).forEach(System.out::println);
}

//é€šè¿‡Stream.ofæ–¹æ³•ç›´æ¥ä¼ å…¥å¤šä¸ªå…ƒç´ æ„æˆä¸€ä¸ªæµ
@Test
public void of()
{
    String[] arr = {"a", "b", "c"};
    Stream.of(arr).forEach(System.out::println);
    Stream.of("a", "b", "c").forEach(System.out::println);
    Stream.of(1, 2, "a").map(item -> item.getClass().getName()).forEach(System.out::println);
}

//é€šè¿‡Stream.iterateæ–¹æ³•ä½¿ç”¨è¿­ä»£çš„æ–¹å¼æ„é€ ä¸€ä¸ªæ— é™æµï¼Œç„¶åä½¿ç”¨limité™åˆ¶æµå…ƒç´ ä¸ªæ•°
@Test
public void iterate()
{
    Stream.iterate(2, item -> item * 2).limit(10).forEach(System.out::println);
    Stream.iterate(BigInteger.ZERO, n -> n.add(BigInteger.TEN)).limit(10).forEach(System.out::println);
}

//é€šè¿‡Stream.generateæ–¹æ³•ä»å¤–éƒ¨ä¼ å…¥ä¸€ä¸ªæä¾›å…ƒç´ çš„Supplieræ¥æ„é€ æ— é™æµï¼Œç„¶åä½¿ç”¨limité™åˆ¶æµå…ƒç´ ä¸ªæ•°
@Test
public void generate()
{
    Stream.generate(() -> "test").limit(3).forEach(System.out::println);
    Stream.generate(Math::random).limit(10).forEach(System.out::println);
}

//é€šè¿‡IntStreamæˆ–DoubleStreamæ„é€ åŸºæœ¬ç±»å‹çš„æµ
@Test
public void primitive()
{
    //æ¼”ç¤ºIntStreamå’ŒDoubleStream
    IntStream.range(1, 3).forEach(System.out::println);
    IntStream.range(0, 3).mapToObj(i -> "x").forEach(System.out::println);

    IntStream.rangeClosed(1, 3).forEach(System.out::println);
    DoubleStream.of(1.1, 2.2, 3.3).forEach(System.out::println);

    //å„ç§è½¬æ¢ï¼Œåé¢æ³¨é‡Šä»£è¡¨äº†è¾“å‡ºç»“æœ
    System.out.println(IntStream.of(1, 2).toArray().getClass()); //class [I
    System.out.println(Stream.of(1, 2).mapToInt(Integer::intValue).toArray().getClass()); //class [I
    System.out.println(IntStream.of(1, 2).boxed().toArray().getClass()); //class [Ljava.lang.Object;
    System.out.println(IntStream.of(1, 2).asDoubleStream().toArray().getClass()); //class [D
    System.out.println(IntStream.of(1, 2).asLongStream().toArray().getClass()); //class [J

    //æ³¨æ„åŸºæœ¬ç±»å‹æµå’Œè£…ç®±åçš„æµçš„åŒºåˆ«
    Arrays.asList("a", "b", "c").stream()   // Stream<String>
            .mapToInt(String::length)       // IntStream
            .asLongStream()                 // LongStream
            .mapToDouble(x -> x / 10.0)     // DoubleStream
            .boxed()                        // Stream<Double>
            .mapToLong(x -> 1L)             // LongStream
            .mapToObj(x -> "")              // Stream<String>
            .collect(Collectors.toList());
}
```

### filter

filteræ–¹æ³•å¯ä»¥å®ç°è¿‡æ»¤æ“ä½œï¼Œç±»ä¼¼SQLä¸­çš„whereã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€è¡Œä»£ç ï¼Œé€šè¿‡filteræ–¹æ³•å®ç°æŸ¥è¯¢æ‰€æœ‰è®¢å•ä¸­æœ€è¿‘åŠå¹´é‡‘é¢å¤§äº40çš„è®¢å•ï¼Œé€šè¿‡è¿ç»­å åŠ filteræ–¹æ³•è¿›è¡Œå¤šæ¬¡æ¡ä»¶è¿‡æ»¤ï¼š

```
//æœ€è¿‘åŠå¹´çš„é‡‘é¢å¤§äº40çš„è®¢å•
orders.stream()
        .filter(Objects::nonNull) //è¿‡æ»¤nullå€¼
        .filter(order -> order.getPlacedAt().isAfter(LocalDateTime.now().minusMonths(6))) //æœ€è¿‘åŠå¹´çš„è®¢å•
        .filter(order -> order.getTotalPrice() > 40) //é‡‘é¢å¤§äº40çš„è®¢å•
        .forEach(System.out::println);	
```

å¦‚æœä¸ä½¿ç”¨Streamçš„è¯ï¼Œå¿…ç„¶éœ€è¦ä¸€ä¸ªä¸­é—´é›†åˆæ¥æ”¶é›†è¿‡æ»¤åçš„ç»“æœï¼Œè€Œä¸”æ‰€æœ‰çš„è¿‡æ»¤æ¡ä»¶ä¼šå †ç§¯åœ¨ä¸€èµ·ï¼Œä»£ç å†—é•¿ä¸”ä¸æ˜“è¯»ã€‚

### map

mapæ“ä½œå¯ä»¥åšè½¬æ¢ï¼ˆæˆ–è€…è¯´æŠ•å½±ï¼‰ï¼Œç±»ä¼¼SQLä¸­çš„selectã€‚ä¸ºäº†å¯¹æ¯”ï¼Œæˆ‘ç”¨ä¸¤ç§æ–¹å¼ç»Ÿè®¡è®¢å•ä¸­æ‰€æœ‰å•†å“çš„æ•°é‡ï¼Œå‰ä¸€ç§æ˜¯é€šè¿‡ä¸¤æ¬¡éå†å®ç°ï¼Œåä¸€ç§æ˜¯é€šè¿‡ä¸¤æ¬¡mapToLong+sumæ–¹æ³•å®ç°ï¼š

```
//è®¡ç®—æ‰€æœ‰è®¢å•å•†å“æ•°é‡
//é€šè¿‡ä¸¤æ¬¡éå†å®ç°
LongAdder longAdder = new LongAdder();
orders.stream().forEach(order ->
        order.getOrderItemList().forEach(orderItem -> longAdder.add(orderItem.getProductQuantity())));

//ä½¿ç”¨ä¸¤æ¬¡mapToLong+sumæ–¹æ³•å®ç°
assertThat(longAdder.longValue(), is(orders.stream().mapToLong(order ->
        order.getOrderItemList().stream()
                .mapToLong(OrderItem::getProductQuantity).sum()).sum()));
```

æ˜¾ç„¶ï¼Œåä¸€ç§æ–¹å¼æ— éœ€ä¸­é—´å˜é‡longAdderï¼Œæ›´ç›´è§‚ã€‚

è¿™é‡Œå†è¡¥å……ä¸€ä¸‹ï¼Œä½¿ç”¨forå¾ªç¯ç”Ÿæˆæ•°æ®ï¼Œæ˜¯æˆ‘ä»¬å¹³æ—¶å¸¸ç”¨çš„æ“ä½œï¼Œä¹Ÿæ˜¯è¿™ä¸ªè¯¾ç¨‹ä¼šå¤§é‡ç”¨åˆ°çš„ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€è¡Œä»£ç ä½¿ç”¨IntStreamé…åˆmapToObjæ›¿ä»£forå¾ªç¯æ¥ç”Ÿæˆæ•°æ®ï¼Œæ¯”å¦‚ç”Ÿæˆ10ä¸ªProductå…ƒç´ æ„æˆListï¼š

```
//æŠŠIntStreamé€šè¿‡è½¬æ¢Stream<Project>
System.out.println(IntStream.rangeClosed(1,10)
        .mapToObj(i->new Product((long)i, "product"+i, i*100.0))
        .collect(toList()));
```

### flatMap

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹flatMapå±•å¼€æˆ–è€…å«æ‰å¹³åŒ–æ“ä½œï¼Œç›¸å½“äºmap+flatï¼Œé€šè¿‡mapæŠŠæ¯ä¸€ä¸ªå…ƒç´ æ›¿æ¢ä¸ºä¸€ä¸ªæµï¼Œç„¶åå±•å¼€è¿™ä¸ªæµã€‚

æ¯”å¦‚ï¼Œæˆ‘ä»¬è¦ç»Ÿè®¡æ‰€æœ‰è®¢å•çš„æ€»ä»·æ ¼ï¼Œå¯ä»¥æœ‰ä¸¤ç§æ–¹å¼ï¼š

- ç›´æ¥é€šè¿‡åŸå§‹å•†å“åˆ—è¡¨çš„å•†å“ä¸ªæ•°\*å•†å“å•ä»·ç»Ÿè®¡çš„è¯ï¼Œå¯ä»¥å…ˆæŠŠè®¢å•é€šè¿‡flatMapå±•å¼€æˆå•†å“æ¸…å•ï¼Œä¹Ÿå°±æ˜¯æŠŠOrderæ›¿æ¢ä¸ºStreamï¼Œç„¶åå¯¹æ¯ä¸€ä¸ªOrderItemç”¨mapToDoubleè½¬æ¢è·å¾—å•†å“æ€»ä»·ï¼Œæœ€åè¿›è¡Œä¸€æ¬¡sumæ±‚å’Œï¼›
- åˆ©ç”¨flatMapToDoubleæ–¹æ³•æŠŠåˆ—è¡¨ä¸­æ¯ä¸€é¡¹å±•å¼€æ›¿æ¢ä¸ºä¸€ä¸ªDoubleStreamï¼Œä¹Ÿå°±æ˜¯ç›´æ¥æŠŠæ¯ä¸€ä¸ªè®¢å•è½¬æ¢ä¸ºæ¯ä¸€ä¸ªå•†å“çš„æ€»ä»·ï¼Œç„¶åæ±‚å’Œã€‚

```
//ç›´æ¥å±•å¼€è®¢å•å•†å“è¿›è¡Œä»·æ ¼ç»Ÿè®¡
System.out.println(orders.stream()
        .flatMap(order -> order.getOrderItemList().stream())
        .mapToDouble(item -> item.getProductQuantity() * item.getProductPrice()).sum());

//å¦ä¸€ç§æ–¹å¼flatMap+mapToDouble=flatMapToDouble
System.out.println(orders.stream()
        .flatMapToDouble(order ->
                order.getOrderItemList()
                        .stream().mapToDouble(item -> item.getProductQuantity() * item.getProductPrice()))
        .sum());
```

è¿™ä¸¤ç§æ–¹å¼å¯ä»¥å¾—åˆ°ç›¸åŒçš„ç»“æœï¼Œå¹¶æ— æœ¬è´¨åŒºåˆ«ã€‚

### sorted

sortedæ“ä½œå¯ä»¥ç”¨äºè¡Œå†…æ’åºçš„åœºæ™¯ï¼Œç±»ä¼¼SQLä¸­çš„order byã€‚æ¯”å¦‚ï¼Œè¦å®ç°å¤§äº50å…ƒè®¢å•çš„æŒ‰ä»·æ ¼å€’åºå–å‰5ï¼Œå¯ä»¥é€šè¿‡Order::getTotalPriceæ–¹æ³•å¼•ç”¨ç›´æ¥æŒ‡å®šéœ€è¦æ’åºçš„ä¾æ®å­—æ®µï¼Œé€šè¿‡reversed()å®ç°å€’åºï¼š

```
//å¤§äº50çš„è®¢å•,æŒ‰ç…§è®¢å•ä»·æ ¼å€’åºå‰5
orders.stream().filter(order -> order.getTotalPrice() > 50)
        .sorted(comparing(Order::getTotalPrice).reversed())
        .limit(5)
        .forEach(System.out::println);	
```

### distinct

distinctæ“ä½œçš„ä½œç”¨æ˜¯å»é‡ï¼Œç±»ä¼¼SQLä¸­çš„distinctã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç å®ç°ï¼š

- æŸ¥è¯¢å»é‡åçš„ä¸‹å•ç”¨æˆ·ã€‚ä½¿ç”¨mapä»è®¢å•æå–å‡ºè´­ä¹°ç”¨æˆ·ï¼Œç„¶åä½¿ç”¨distinctå»é‡ã€‚
- æŸ¥è¯¢è´­ä¹°è¿‡çš„å•†å“åã€‚ä½¿ç”¨flatMap+mapæå–å‡ºè®¢å•ä¸­æ‰€æœ‰çš„å•†å“åï¼Œç„¶åä½¿ç”¨distinctå»é‡ã€‚

```
//å»é‡çš„ä¸‹å•ç”¨æˆ·
System.out.println(orders.stream().map(order -> order.getCustomerName()).distinct().collect(joining(",")));

//æ‰€æœ‰è´­ä¹°è¿‡çš„å•†å“
System.out.println(orders.stream()
        .flatMap(order -> order.getOrderItemList().stream())
        .map(OrderItem::getProductName)
        .distinct().collect(joining(",")));
```

### skip &amp; limit

skipå’Œlimitæ“ä½œç”¨äºåˆ†é¡µï¼Œç±»ä¼¼MySQLä¸­çš„limitã€‚å…¶ä¸­ï¼Œskipå®ç°è·³è¿‡ä¸€å®šçš„é¡¹ï¼Œlimitç”¨äºé™åˆ¶é¡¹æ€»æ•°ã€‚æ¯”å¦‚ä¸‹é¢çš„ä¸¤æ®µä»£ç ï¼š

- æŒ‰ç…§ä¸‹å•æ—¶é—´æ’åºï¼ŒæŸ¥è¯¢å‰2ä¸ªè®¢å•çš„é¡¾å®¢å§“åå’Œä¸‹å•æ—¶é—´ï¼›
- æŒ‰ç…§ä¸‹å•æ—¶é—´æ’åºï¼ŒæŸ¥è¯¢ç¬¬3å’Œç¬¬4ä¸ªè®¢å•çš„é¡¾å®¢å§“åå’Œä¸‹å•æ—¶é—´ã€‚

```
//æŒ‰ç…§ä¸‹å•æ—¶é—´æ’åºï¼ŒæŸ¥è¯¢å‰2ä¸ªè®¢å•çš„é¡¾å®¢å§“åå’Œä¸‹å•æ—¶é—´
orders.stream()
        .sorted(comparing(Order::getPlacedAt))
        .map(order -> order.getCustomerName() + "@" + order.getPlacedAt())
        .limit(2).forEach(System.out::println);
//æŒ‰ç…§ä¸‹å•æ—¶é—´æ’åºï¼ŒæŸ¥è¯¢ç¬¬3å’Œç¬¬4ä¸ªè®¢å•çš„é¡¾å®¢å§“åå’Œä¸‹å•æ—¶é—´
orders.stream()
        .sorted(comparing(Order::getPlacedAt))
        .map(order -> order.getCustomerName() + "@" + order.getPlacedAt())
        .skip(2).limit(2).forEach(System.out::println);
```

### collect

collectæ˜¯æ”¶é›†æ“ä½œï¼Œå¯¹æµè¿›è¡Œç»ˆç»“ï¼ˆç»ˆæ­¢ï¼‰æ“ä½œï¼ŒæŠŠæµå¯¼å‡ºä¸ºæˆ‘ä»¬éœ€è¦çš„æ•°æ®ç»“æ„ã€‚â€œç»ˆç»“â€æ˜¯æŒ‡ï¼Œå¯¼å‡ºåï¼Œæ— æ³•å†ä¸²è”ä½¿ç”¨å…¶ä»–ä¸­é—´æ“ä½œï¼Œæ¯”å¦‚filterã€mapã€flatmapã€sortedã€distinctã€limitã€skipã€‚

åœ¨Streamæ“ä½œä¸­ï¼Œcollectæ˜¯æœ€å¤æ‚çš„ç»ˆç»“æ“ä½œï¼Œæ¯”è¾ƒç®€å•çš„ç»ˆç»“æ“ä½œè¿˜æœ‰forEachã€toArrayã€minã€maxã€countã€anyMatchç­‰ï¼Œæˆ‘å°±ä¸å†å±•å¼€äº†ï¼Œä½ å¯ä»¥æŸ¥è¯¢[JDKæ–‡æ¡£](https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html)ï¼Œæœç´¢terminal operationæˆ–intermediate operationã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘é€šè¿‡6ä¸ªæ¡ˆä¾‹ï¼Œæ¥æ¼”ç¤ºä¸‹å‡ ç§æ¯”è¾ƒå¸¸ç”¨çš„collectæ“ä½œï¼š

- ç¬¬ä¸€ä¸ªæ¡ˆä¾‹ï¼Œå®ç°äº†å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œï¼Œç”Ÿæˆä¸€å®šä½æ•°çš„éšæœºå­—ç¬¦ä¸²ã€‚
- ç¬¬äºŒä¸ªæ¡ˆä¾‹ï¼Œé€šè¿‡Collectors.toSeté™æ€æ–¹æ³•æ”¶é›†ä¸ºSetå»é‡ï¼Œå¾—åˆ°å»é‡åçš„ä¸‹å•ç”¨æˆ·ï¼Œå†é€šè¿‡Collectors.joiningé™æ€æ–¹æ³•å®ç°å­—ç¬¦ä¸²æ‹¼æ¥ã€‚
- ç¬¬ä¸‰ä¸ªæ¡ˆä¾‹ï¼Œé€šè¿‡Collectors.toCollectioné™æ€æ–¹æ³•è·å¾—æŒ‡å®šç±»å‹çš„é›†åˆï¼Œæ¯”å¦‚æŠŠListè½¬æ¢ä¸ºLinkedListã€‚
- ç¬¬å››ä¸ªæ¡ˆä¾‹ï¼Œé€šè¿‡Collectors.toMapé™æ€æ–¹æ³•å°†å¯¹è±¡å¿«é€Ÿè½¬æ¢ä¸ºMapï¼ŒKeyæ˜¯è®¢å•IDã€Valueæ˜¯ä¸‹å•ç”¨æˆ·åã€‚
- ç¬¬äº”ä¸ªæ¡ˆä¾‹ï¼Œé€šè¿‡Collectors.toMapé™æ€æ–¹æ³•å°†å¯¹è±¡è½¬æ¢ä¸ºMapã€‚Keyæ˜¯ä¸‹å•ç”¨æˆ·åï¼ŒValueæ˜¯ä¸‹å•æ—¶é—´ï¼Œä¸€ä¸ªç”¨æˆ·å¯èƒ½å¤šæ¬¡ä¸‹å•ï¼Œæ‰€ä»¥ç›´æ¥åœ¨è¿™é‡Œè¿›è¡Œäº†åˆå¹¶ï¼Œåªè·å–æœ€è¿‘ä¸€æ¬¡çš„ä¸‹å•æ—¶é—´ã€‚
- ç¬¬å…­ä¸ªæ¡ˆä¾‹ï¼Œä½¿ç”¨Collectors.summingIntæ–¹æ³•å¯¹å•†å“æ•°é‡æ±‚å’Œï¼Œå†ä½¿ç”¨Collectors.averagingIntæ–¹æ³•å¯¹ç»“æœæ±‚å¹³å‡å€¼ï¼Œä»¥ç»Ÿè®¡æ‰€æœ‰è®¢å•å¹³å‡è´­ä¹°çš„å•†å“æ•°é‡ã€‚

```
//ç”Ÿæˆä¸€å®šä½æ•°çš„éšæœºå­—ç¬¦ä¸²
System.out.println(random.ints(48, 122)
    .filter(i -> (i < 57 || i > 65) && (i < 90 || i > 97))
    .mapToObj(i -> (char) i)
    .limit(20)
    .collect(StringBuilder::new, StringBuilder::append, StringBuilder::append)
    .toString());

//æ‰€æœ‰ä¸‹å•çš„ç”¨æˆ·ï¼Œä½¿ç”¨toSetå»é‡åå®ç°å­—ç¬¦ä¸²æ‹¼æ¥
System.out.println(orders.stream()
    .map(order -> order.getCustomerName()).collect(toSet())
    .stream().collect(joining(",", "[", "]")));

//ç”¨toCollectionæ”¶é›†å™¨æŒ‡å®šé›†åˆç±»å‹
System.out.println(orders.stream().limit(2).collect(toCollection(LinkedList::new)).getClass());

//ä½¿ç”¨toMapè·å–è®¢å•ID+ä¸‹å•ç”¨æˆ·åçš„Map
orders.stream()
    .collect(toMap(Order::getId, Order::getCustomerName))
    .entrySet().forEach(System.out::println);

//ä½¿ç”¨toMapè·å–ä¸‹å•ç”¨æˆ·å+æœ€è¿‘ä¸€æ¬¡ä¸‹å•æ—¶é—´çš„Map
orders.stream()
    .collect(toMap(Order::getCustomerName, Order::getPlacedAt, (x, y) -> x.isAfter(y) ? x : y))
    .entrySet().forEach(System.out::println);

//è®¢å•å¹³å‡è´­ä¹°çš„å•†å“æ•°é‡
System.out.println(orders.stream().collect(averagingInt(order ->
    order.getOrderItemList().stream()
            .collect(summingInt(OrderItem::getProductQuantity)))));
```

å¯ä»¥çœ‹åˆ°ï¼Œè¿™6ä¸ªæ“ä½œä½¿ç”¨Streamæ–¹å¼ä¸€è¡Œä»£ç å°±å¯ä»¥å®ç°ï¼Œä½†ä½¿ç”¨éStreamæ–¹å¼å®ç°çš„è¯ï¼Œéƒ½éœ€è¦å‡ è¡Œç”šè‡³åå‡ è¡Œä»£ç ã€‚

æœ‰å…³Collectorsç±»çš„ä¸€äº›å¸¸ç”¨é™æ€æ–¹æ³•ï¼Œæˆ‘æ€»ç»“åˆ°äº†ä¸€å¼ å›¾ä¸­ï¼Œä½ å¯ä»¥å†æ•´ç†ä¸€ä¸‹æ€è·¯ï¼š

![](https://static001.geekbang.org/resource/image/5a/de/5af5ba60d7af2c8780b69bc6c71cf3de.png?wh=2923%2A2375)

å…¶ä¸­ï¼ŒgroupByå’ŒpartitionByæ¯”è¾ƒå¤æ‚ï¼Œæˆ‘å’Œä½ ä¸¾ä¾‹ä»‹ç»ã€‚

### groupBy

groupByæ˜¯åˆ†ç»„ç»Ÿè®¡æ“ä½œï¼Œç±»ä¼¼SQLä¸­çš„group byå­å¥ã€‚å®ƒå’Œåé¢ä»‹ç»çš„partitioningByéƒ½æ˜¯ç‰¹æ®Šçš„æ”¶é›†å™¨ï¼ŒåŒæ ·ä¹Ÿæ˜¯ç»ˆç»“æ“ä½œã€‚åˆ†ç»„æ“ä½œæ¯”è¾ƒå¤æ‚ï¼Œä¸ºå¸®ä½ ç†è§£å¾—æ›´é€å½»ï¼Œæˆ‘å‡†å¤‡äº†8ä¸ªæ¡ˆä¾‹ï¼š

- ç¬¬ä¸€ä¸ªæ¡ˆä¾‹ï¼ŒæŒ‰ç…§ç”¨æˆ·ååˆ†ç»„ï¼Œä½¿ç”¨Collectors.countingæ–¹æ³•ç»Ÿè®¡æ¯ä¸ªäººçš„ä¸‹å•æ•°é‡ï¼Œå†æŒ‰ç…§ä¸‹å•æ•°é‡å€’åºè¾“å‡ºã€‚
- ç¬¬äºŒä¸ªæ¡ˆä¾‹ï¼ŒæŒ‰ç…§ç”¨æˆ·ååˆ†ç»„ï¼Œä½¿ç”¨Collectors.summingDoubleæ–¹æ³•ç»Ÿè®¡è®¢å•æ€»é‡‘é¢ï¼Œå†æŒ‰æ€»é‡‘é¢å€’åºè¾“å‡ºã€‚
- ç¬¬ä¸‰ä¸ªæ¡ˆä¾‹ï¼ŒæŒ‰ç…§ç”¨æˆ·ååˆ†ç»„ï¼Œä½¿ç”¨ä¸¤æ¬¡Collectors.summingIntæ–¹æ³•ç»Ÿè®¡å•†å“é‡‡è´­æ•°é‡ï¼Œå†æŒ‰æ€»æ•°é‡å€’åºè¾“å‡ºã€‚
- ç¬¬å››ä¸ªæ¡ˆä¾‹ï¼Œç»Ÿè®¡è¢«é‡‡è´­æœ€å¤šçš„å•†å“ã€‚å…ˆé€šè¿‡flatMapæŠŠè®¢å•è½¬æ¢ä¸ºå•†å“ï¼Œç„¶åæŠŠå•†å“åä½œä¸ºKeyã€Collectors.summingIntä½œä¸ºValueåˆ†ç»„ç»Ÿè®¡é‡‡è´­æ•°é‡ï¼Œå†æŒ‰Valueå€’åºè·å–ç¬¬ä¸€ä¸ªEntryï¼Œæœ€åæŸ¥è¯¢Keyå°±å¾—åˆ°äº†å”®å‡ºæœ€å¤šçš„å•†å“ã€‚
- ç¬¬äº”ä¸ªæ¡ˆä¾‹ï¼ŒåŒæ ·ç»Ÿè®¡é‡‡è´­æœ€å¤šçš„å•†å“ã€‚ç›¸æ¯”ç¬¬å››ä¸ªæ¡ˆä¾‹æ’åºMapçš„æ–¹å¼ï¼Œè¿™æ¬¡ç›´æ¥ä½¿ç”¨Collectors.maxByæ”¶é›†å™¨è·å¾—æœ€å¤§çš„Entryã€‚
- ç¬¬å…­ä¸ªæ¡ˆä¾‹ï¼ŒæŒ‰ç…§ç”¨æˆ·ååˆ†ç»„ï¼Œç»Ÿè®¡ç”¨æˆ·ä¸‹çš„é‡‘é¢æœ€é«˜çš„è®¢å•ã€‚Keyæ˜¯ç”¨æˆ·åï¼ŒValueæ˜¯Orderï¼Œç›´æ¥é€šè¿‡Collectors.maxByæ–¹æ³•æ‹¿åˆ°é‡‘é¢æœ€é«˜çš„è®¢å•ï¼Œç„¶åé€šè¿‡collectingAndThenå®ç°Optional.getçš„å†…å®¹æå–ï¼Œæœ€åéå†Key/Valueå³å¯ã€‚
- ç¬¬ä¸ƒä¸ªæ¡ˆä¾‹ï¼Œæ ¹æ®ä¸‹å•å¹´æœˆåˆ†ç»„ç»Ÿè®¡è®¢å•IDåˆ—è¡¨ã€‚Keyæ˜¯æ ¼å¼åŒ–æˆå¹´æœˆåçš„ä¸‹å•æ—¶é—´ï¼ŒValueç›´æ¥é€šè¿‡Collectors.mappingæ–¹æ³•è¿›è¡Œäº†è½¬æ¢ï¼ŒæŠŠè®¢å•åˆ—è¡¨è½¬æ¢ä¸ºè®¢å•IDæ„æˆçš„Listã€‚
- ç¬¬å…«ä¸ªæ¡ˆä¾‹ï¼Œæ ¹æ®ä¸‹å•å¹´æœˆ+ç”¨æˆ·åä¸¤æ¬¡åˆ†ç»„ç»Ÿè®¡è®¢å•IDåˆ—è¡¨ï¼Œç›¸æ¯”ä¸Šä¸€ä¸ªæ¡ˆä¾‹å¤šäº†ä¸€æ¬¡åˆ†ç»„æ“ä½œï¼Œç¬¬äºŒæ¬¡åˆ†ç»„æ˜¯æŒ‰ç…§ç”¨æˆ·åè¿›è¡Œåˆ†ç»„ã€‚

```
//æŒ‰ç…§ç”¨æˆ·ååˆ†ç»„ï¼Œç»Ÿè®¡ä¸‹å•æ•°é‡
System.out.println(orders.stream().collect(groupingBy(Order::getCustomerName, counting()))
        .entrySet().stream().sorted(Map.Entry.<String, Long>comparingByValue().reversed()).collect(toList()));

//æŒ‰ç…§ç”¨æˆ·ååˆ†ç»„ï¼Œç»Ÿè®¡è®¢å•æ€»é‡‘é¢
System.out.println(orders.stream().collect(groupingBy(Order::getCustomerName, summingDouble(Order::getTotalPrice)))
        .entrySet().stream().sorted(Map.Entry.<String, Double>comparingByValue().reversed()).collect(toList()));

//æŒ‰ç…§ç”¨æˆ·ååˆ†ç»„ï¼Œç»Ÿè®¡å•†å“é‡‡è´­æ•°é‡
System.out.println(orders.stream().collect(groupingBy(Order::getCustomerName,
        summingInt(order -> order.getOrderItemList().stream()
                .collect(summingInt(OrderItem::getProductQuantity)))))
        .entrySet().stream().sorted(Map.Entry.<String, Integer>comparingByValue().reversed()).collect(toList()));

//ç»Ÿè®¡æœ€å—æ¬¢è¿çš„å•†å“ï¼Œå€’åºåå–ç¬¬ä¸€ä¸ª
orders.stream()
        .flatMap(order -> order.getOrderItemList().stream())
        .collect(groupingBy(OrderItem::getProductName, summingInt(OrderItem::getProductQuantity)))
        .entrySet().stream()
        .sorted(Map.Entry.<String, Integer>comparingByValue().reversed())
        .map(Map.Entry::getKey)
        .findFirst()
        .ifPresent(System.out::println);

//ç»Ÿè®¡æœ€å—æ¬¢è¿çš„å•†å“çš„å¦ä¸€ç§æ–¹å¼ï¼Œç›´æ¥åˆ©ç”¨maxBy
orders.stream()
        .flatMap(order -> order.getOrderItemList().stream())
        .collect(groupingBy(OrderItem::getProductName, summingInt(OrderItem::getProductQuantity)))
        .entrySet().stream()
        .collect(maxBy(Map.Entry.comparingByValue()))
        .map(Map.Entry::getKey)
        .ifPresent(System.out::println);

//æŒ‰ç…§ç”¨æˆ·ååˆ†ç»„ï¼Œé€‰ç”¨æˆ·ä¸‹çš„æ€»é‡‘é¢æœ€å¤§çš„è®¢å•
orders.stream().collect(groupingBy(Order::getCustomerName, collectingAndThen(maxBy(comparingDouble(Order::getTotalPrice)), Optional::get)))
        .forEach((k, v) -> System.out.println(k + "#" + v.getTotalPrice() + "@" + v.getPlacedAt()));

//æ ¹æ®ä¸‹å•å¹´æœˆåˆ†ç»„ï¼Œç»Ÿè®¡è®¢å•IDåˆ—è¡¨
System.out.println(orders.stream().collect
        (groupingBy(order -> order.getPlacedAt().format(DateTimeFormatter.ofPattern("yyyyMM")),
                mapping(order -> order.getId(), toList()))));

//æ ¹æ®ä¸‹å•å¹´æœˆ+ç”¨æˆ·åä¸¤æ¬¡åˆ†ç»„ï¼Œç»Ÿè®¡è®¢å•IDåˆ—è¡¨
System.out.println(orders.stream().collect
        (groupingBy(order -> order.getPlacedAt().format(DateTimeFormatter.ofPattern("yyyyMM")),
                groupingBy(order -> order.getCustomerName(),
                        mapping(order -> order.getId(), toList())))));
```

å¦‚æœä¸å€ŸåŠ©Streamè½¬æ¢ä¸ºæ™®é€šçš„Javaä»£ç ï¼Œå®ç°è¿™äº›å¤æ‚çš„æ“ä½œå¯èƒ½éœ€è¦å‡ åè¡Œä»£ç ã€‚

### partitionBy

partitioningByç”¨äºåˆ†åŒºï¼Œåˆ†åŒºæ˜¯ç‰¹æ®Šçš„åˆ†ç»„ï¼Œåªæœ‰trueå’Œfalseä¸¤ç»„ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬æŠŠç”¨æˆ·æŒ‰ç…§æ˜¯å¦ä¸‹å•è¿›è¡Œåˆ†åŒºï¼Œç»™partitioningByæ–¹æ³•ä¼ å…¥ä¸€ä¸ªPredicateä½œä¸ºæ•°æ®åˆ†åŒºçš„åŒºåˆ†ï¼Œè¾“å‡ºæ˜¯Map&lt;Boolean, List&lt;T&gt;&gt;ï¼š

```
public static <T>
Collector<T, ?, Map<Boolean, List<T>>> partitioningBy(Predicate<? super T> predicate) {
    return partitioningBy(predicate, toList());
}
```

æµ‹è¯•ä¸€ä¸‹ï¼ŒpartitioningByé…åˆanyMatchï¼Œå¯ä»¥æŠŠç”¨æˆ·åˆ†ä¸ºä¸‹è¿‡è®¢å•å’Œæ²¡ä¸‹è¿‡è®¢å•ä¸¤ç»„ï¼š

```
//æ ¹æ®æ˜¯å¦æœ‰ä¸‹å•è®°å½•è¿›è¡Œåˆ†åŒº
System.out.println(Customer.getData().stream().collect(
        partitioningBy(customer -> orders.stream().mapToLong(Order::getCustomerId)
                .anyMatch(id -> id == customer.getId()))));
```

## é‡ç‚¹å›é¡¾

ä»Šå¤©ï¼Œæˆ‘ç”¨äº†å¤§é‡çš„ç¯‡å¹…å’Œæ¡ˆä¾‹ï¼Œå’Œä½ å±•å¼€ä»‹ç»äº†Streamä¸­å¾ˆå¤šå…·ä½“çš„æµå¼æ“ä½œæ–¹æ³•ã€‚æœ‰äº›æ¡ˆä¾‹å¯èƒ½ä¸å¤ªå¥½ç†è§£ï¼Œæˆ‘å»ºè®®ä½ å¯¹ç€ä»£ç é€ä¸€åˆ°æºç ä¸­æŸ¥çœ‹è¿™äº›æ“ä½œçš„æ–¹æ³•å®šä¹‰ï¼Œä»¥åŠJDKä¸­çš„ä»£ç æ³¨é‡Šã€‚

æœ€åï¼Œæˆ‘å»ºè®®ä½ æ€è€ƒä¸‹ï¼Œåœ¨æ—¥å¸¸å·¥ä½œä¸­è¿˜ä¼šä½¿ç”¨SQLç»Ÿè®¡å“ªäº›ä¿¡æ¯ï¼Œè¿™äº›SQLæ˜¯å¦ä¹Ÿå¯ä»¥ç”¨Streamæ¥æ”¹å†™å‘¢ï¼ŸStreamçš„APIåšå¤§ç²¾æ·±ï¼Œä½†å…¶ä¸­åˆæœ‰è§„å¾‹å¯å¾ªã€‚è¿™å…¶ä¸­çš„è§„å¾‹ä¸»è¦å°±æ˜¯ï¼Œç†æ¸…æ¥šè¿™äº›APIä¼ å‚çš„å‡½æ•°å¼æ¥å£å®šä¹‰ï¼Œå°±èƒ½ææ˜ç™½åˆ°åº•æ˜¯éœ€è¦æˆ‘ä»¬æä¾›æ•°æ®ã€æ¶ˆè´¹æ•°æ®ã€è¿˜æ˜¯è½¬æ¢æ•°æ®ç­‰ã€‚é‚£ï¼ŒæŒæ¡Streamçš„æ–¹æ³•ä¾¿æ˜¯ï¼Œå¤šæµ‹è¯•å¤šç»ƒä¹ ï¼Œä»¥å¼ºåŒ–è®°å¿†ã€åŠ æ·±ç†è§£ã€‚

ä»Šå¤©ç”¨åˆ°çš„ä»£ç ï¼Œæˆ‘éƒ½æ”¾åœ¨äº†GitHubä¸Šï¼Œä½ å¯ä»¥ç‚¹å‡»[è¿™ä¸ªé“¾æ¥](https://github.com/JosephZhu1983/java-common-mistakes)æŸ¥çœ‹ã€‚

## æ€è€ƒä¸è®¨è®º

1. ä½¿ç”¨Streamå¯ä»¥éå¸¸æ–¹ä¾¿åœ°å¯¹Liståšå„ç§æ“ä½œï¼Œé‚£æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥å®ç°åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­è§‚å¯Ÿæ•°æ®å˜åŒ–å‘¢ï¼Ÿæ¯”å¦‚ï¼Œæˆ‘ä»¬è¿›è¡Œfilter+mapæ“ä½œï¼Œå¦‚ä½•è§‚å¯Ÿfilteråmapçš„åŸå§‹æ•°æ®å‘¢ï¼Ÿ
2. Collectorsç±»æä¾›äº†å¾ˆå¤šç°æˆçš„æ”¶é›†å™¨ï¼Œé‚£æˆ‘ä»¬æœ‰æ²¡æœ‰åŠæ³•å®ç°è‡ªå®šä¹‰çš„æ”¶é›†å™¨å‘¢ï¼Ÿæ¯”å¦‚ï¼Œå®ç°ä¸€ä¸ªMostPopularCollectorï¼Œæ¥å¾—åˆ°Listä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„å…ƒç´ ï¼Œæ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼š

```
assertThat(Stream.of(1, 1, 2, 2, 2, 3, 4, 5, 5).collect(new MostPopularCollector<>()).get(), is(2));
assertThat(Stream.of('a', 'b', 'c', 'c', 'c', 'd').collect(new MostPopularCollector<>()).get(), is('c'));
```

å…³äºJava 8ï¼Œä½ è¿˜æœ‰ä»€ä¹ˆä½¿ç”¨å¿ƒå¾—å—ï¼Ÿæˆ‘æ˜¯æœ±æ™”ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºä¸æˆ‘ç•™è¨€åˆ†äº«ä½ çš„æƒ³æ³•ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–åŒäº‹ï¼Œä¸€èµ·äº¤æµã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ15ï¼‰</strong></div><ul>
<li><span>æ±æ—å¤–å²</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>private List&lt;Map&gt; getNoRoomList(List&lt;Map&gt; inspectRooms, List&lt;Map&gt; items) {
    boolean flag = false;
    List&lt;Map&gt; noInspectRoom = new ArrayList&lt;&gt;();
    for (Map item: items) {
        for (Map inspectRoom: inspectRooms) {
            if (inspectRoom.get(&quot;project&quot;).equals(item.get(&quot;checkItem&quot;))) {
                flag = true;
                break;
            }
        }
        if (!flag) {
            noInspectRoom.add(item);
        }else {
            flag = false;
        }
    }
    return noInspectRoom;
}

æˆ‘ç›´æ¥è´´æˆ‘å†™çš„å¤„ç†ä»£ç å§ï¼Œåº”è¯¥å¯ä»¥ç†è§£æˆ‘çš„æƒ³æ³•ï¼Œè¿™æµ‹è¯•ç”¨ä¾‹è¿˜çœŸä¸å¥½å†™ã€‚</p>2020-03-20</li><br/><li><span>æµ·æ‹‰é²</span> ğŸ‘ï¼ˆ12ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>ä¸ºäº†å†™ä½œä¸šåˆå»ç¿»äº†ã€ŠJava 8 å®æˆ˜ã€‹ï¼Œæµ‹è¯•ç»ˆäºé€šè¿‡äº†
public class MostPopularCollector
        implements Collector&lt;Object,   &#47;&#47; æ”¶é›†Stringæµ
        Map&lt;Object, Integer&gt;,         &#47;&#47; ç´¯åŠ å™¨æ˜¯ä¸€ä¸ªMapï¼Œkeyä¸ºå­—ç¬¦ï¼Œvalueä¸ºå‡ºç°çš„æ¬¡æ•°
        Optional&gt;                     &#47;&#47; è¿”å›çš„æ˜¯å‡ºç°æ¬¡æ•°æœ€å¤šçš„å­—ç¬¦
{

    &#47;**
     * è¿”å›ä¸€ä¸ªåœ¨è°ƒç”¨æ—¶åˆ›å»ºçš„ç´¯åŠ å™¨
     * @return
     *&#47;
    public Supplier&lt;Map&lt;Object, Integer&gt;&gt; supplier() {
        return () -&gt; new HashMap&lt;&gt;();
    }

    &#47;**
     * å®šä¹‰æ”¶é›†æµä¸­æ•°æ®é€»è¾‘
     * @return
     *&#47;
    public BiConsumer&lt;Map&lt;Object, Integer&gt;, Object&gt; accumulator() {
        return (Map&lt;Object, Integer&gt; acc, Object chart) -&gt;
            acc.compute(chart, (key, val) -&gt; val == null ? 1 : val + 1); &#47;&#47; å¦‚æœå½“å‰å­—ç¬¦æœªç»Ÿè®¡åˆ™ç»Ÿè®¡ä¸º1ï¼Œå¦åˆ™+1
    }

    &#47;**
     * å¤„ç†å¹¶è¡Œæ“ä½œï¼Œå…¶å®å°±æ˜¯å°†ä¸¤ä¸ªmapåˆæˆä¸€ä¸ªï¼ŒæŠŠvalueåŠ èµ·æ¥
     * @return
     *&#47;
    public BinaryOperator&lt;Map&lt;Object, Integer&gt;&gt; combiner() {
        return (Map&lt;Object, Integer&gt; m1,
                Map&lt;Object, Integer&gt; m2) -&gt; {
            Map&lt;Object, Integer&gt; all = new HashMap&lt;&gt;(m1);
            m2.forEach((chart, count) -&gt; all.merge(chart, count, Integer::sum));
            return all;
        };
    }

    public Function&lt;Map&lt;Object, Integer&gt;, Optional&gt; finisher() {
        return (Map&lt;Object, Integer&gt; acc) -&gt; Optional.ofNullable(acc.entrySet()
                .stream()
                .max(Map.Entry.comparingByValue())
                .get().getKey());
    }


    public Set&lt;Characteristics&gt; characteristics() {
        return Collections.unmodifiableSet(EnumSet.of(Characteristics.CONCURRENT));
    }
}
</p>2020-03-17</li><br/><li><span>Wiggle Wiggle</span> ğŸ‘ï¼ˆ8ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>Stream API æœ‰ä¸ª peek æ–¹æ³•å¯ä»¥æ¥æ”¶ä¸€ä¸ª consumer æ¥æ‰“å°æ•°æ®ï¼Œå¯ä»¥æ¥åœ¨ä»»æ„ transformation æ“ä½œåé¢æŸ¥çœ‹æ•°æ®</p>2020-03-17</li><br/><li><span>Darren</span> ğŸ‘ï¼ˆ8ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>ä»¥å‰çœŸæ²¡æœ‰ç‰¹æ„å»å…³æ³¨æ”¶é›†å™¨ï¼Œçœ‹äº†åšäº†ï¼Œå‚è€ƒäº†2ç‰‡æ–‡ç« ï¼š
https:&#47;&#47;www.cnblogs.com&#47;yw0219&#47;p&#47;9589124.html
https:&#47;&#47;my.oschina.net&#47;piorcn&#47;blog&#47;424375
æœ€ç»ˆæå®šï¼Œè¯·è€å¸ˆæŒ‡ç‚¹

https:&#47;&#47;github.com&#47;y645194203&#47;geektime-java-100&#47;blob&#47;master&#47;MostPopularCollector.java</p>2020-03-17</li><br/><li><span>pedro</span> ğŸ‘ï¼ˆ6ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>æˆ‘ç›®å‰æƒ³åˆ°çš„æ•°æ®è§‚å¯Ÿçš„æ–¹å¼æ¯”è¾ƒåŸå§‹ï¼Œä¸€ç§æ˜¯é€šè¿‡logæ‰“å°ï¼Œä¸€ç§æ˜¯debugã€‚ä½†æˆ‘è‚¯å®šè¿™éƒ½ä¸æ˜¯å•¥å¥½åŠæ³•ï¼Œå¸Œæœ›è€å¸ˆå‘ŠçŸ¥è§£æ”¾ç”Ÿäº§åŠ›çš„æ–¹æ³•ã€‚</p>2020-03-17</li><br/><li><span>Demon.Lee</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>æ¯å¤©æ™šä¸Šå›å»æ•²ä¸€ç‚¹ï¼ŒèŠ±äº†å¥½å‡ ä¸ªæ™šä¸Šï¼Œç»ˆäºæŠŠè¿™ä¸¤èŠ‚ä¸­çš„æ‰€æœ‰ä»£ç è¿è¡Œäº†ä¸€éï¼Œåªä¸è¿‡ä¼¼æ‡‚éæ‡‚ï¼Œè¿˜è¦ç»§ç»­ç»ƒä¹ ã€‚å·²ç»å¼€å§‹åœ¨å·¥ä½œä¸­è¿ç”¨ä¸€äº›ç®€å•çš„äº†ï¼Œè¯»å®Œè¿™ç¯‡æ–‡ç« å¯èƒ½åªéœ€è¦20åˆ†é’Ÿï¼Œä½†æŠŠæ‰€æœ‰ä»£ç éƒ½ç»ƒä¹ ä¸€éï¼Œå°±ä¸æ˜¯20åˆ†é’Ÿçš„äº‹äº†ï¼Œè¦æŒç»­å­¦ä¹ æ‰è¡Œã€‚ğŸ’ªğŸ½</p>2020-04-24</li><br/><li><span>æ±æ—å¤–å²</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>List&lt;Map&gt; l1ï¼ŒList&lt;Map&gt; l2ï¼Œä¸¤ä¸ªlistï¼Œl1ä¸­æœ‰å››ä¸ªmapï¼Œå…¶ä¸­æœ‰keyåˆ†åˆ«ä¸º1ã€2ã€3ã€4çš„å››ä¸ªå­—æ®µï¼Œl2æœ‰ä¸¤ä¸ªmapï¼Œå…¶ä¸­æœ‰keyåˆ†åˆ«ä¸º1ï¼Œ2çš„l1ä¸­ä¸€æ ·çš„å­—æ®µï¼Œæ€ä¹ˆç­›é€‰æœ€ç»ˆå¾—åˆ°ä¸€ä¸ªlistï¼Œåªæœ‰keyä¸º3ã€4å¯¹åº”çš„ä¸¤ä¸ªmapï¼Ÿå†™çš„æ¯”è¾ƒä¹±ï¼Œè¿˜è¯·è€å¸ˆè§è°…ï¼Œæˆ‘æƒ³äº†ä¸‹æ²¡æƒ³å‡ºæ¥ï¼Œæœ€åforå¾ªç¯åšçš„ã€‚</p>2020-03-19</li><br/><li><span>insight</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p> &#47;&#47;å„ç§è½¬æ¢ï¼Œåé¢æ³¨é‡Šä»£è¡¨äº†è¾“å‡ºç»“æœ    
System.out.println(IntStream.of(1, 2).toArray().getClass()); &#47;&#47;class [I    
System.out.println(Stream.of(1, 2).mapToInt(Integer::intValue).toArray().getClass()); &#47;&#47;class [I    System.out.println(IntStream.of(1, 2).boxed().toArray().getClass()); &#47;&#47;class [Ljava.lang.Object;    System.out.println(IntStream.of(1, 2).asDoubleStream().toArray().getClass()); &#47;&#47;class [D    System.out.println(IntStream.of(1, 2).asLongStream().toArray().getClass()); &#47;&#47;class [J

è€å¸ˆï¼Œè¿™ä¸€æ®µä»£ç çš„è¾“å‡ºç»“æœä¸ºä»€ä¹ˆæ˜¯è¿™æ ·çš„å‘€ï¼Ÿæ²¡çœ‹æ‡‚ï¼Œæ±‚æŒ‡æ•™ï¼</p>2020-03-18</li><br/><li><span>é²é¸£</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>åœ¨å®é™…ä¸­ï¼Œå‘ç°distinctéœ€è¦æ ¹æ®å…ƒç´ ç±»å‹çš„å±æ€§è¿›è¡Œåˆ¤æ–­ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ«çš„æ–¹å¼äº†</p>2020-09-27</li><br/><li><span>å¤§èƒ–å­å‘€ã€</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<p>å·¥ä½œä¸­é‡åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œè®¡ç®—è¿è´¹ï¼šå…ˆä»è¿è´¹é›†åˆä¸­æ‰¾å‡ºåŒä¸€ä¸ªå®¢æˆ·çš„æ•°æ®ï¼Œç„¶åç±»ä¼¼äºç´¯åŠ æ•°é‡ï¼ˆè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„é€»è¾‘ï¼‰è®¡ç®—å‡ºè¿è´¹ï¼ˆå› ä¸ºç›¸åŒçš„å®¢æˆ·æ•°é‡è¶…è¿‡ä¸€å®šæ•°å€¼ä¼šæœ‰ä¼˜æƒ ï¼‰ã€‚æœ€åæŠŠè®¡ç®—å‡ºæ¥çš„è¿è´¹æ•°æ®æ’å…¥åˆ°æ•°æ®åº“é‡Œã€‚

æˆ‘çš„åšæ³•æ˜¯ï¼šä»¥ç¬¬ä¸€æ¡æ•°æ®çš„å®¢æˆ·ä¸ºåŸºå‡†ï¼Œå¾ªç¯æ‰¾å‡ºç›¸åŒå®¢æˆ·çš„æ•°æ®ï¼Œä¿å­˜åˆ°ä¸€ä¸ªæ–°çš„é›†åˆä¸­ï¼ŒåŒæ—¶ä»åŸæ•°æ®é›†åˆé‡Œç§»é™¤è¿™æ¡æ•°æ®ï¼Œæœ€åè®¡ç®—å‡ºæ–°é›†åˆé‡Œçš„è¿è´¹å°±å¯ä»¥äº†ã€‚

æ„Ÿè§‰è¿™ç§éœ€æ±‚çš„è¯ï¼Œå¥½åƒå°±æ²¡åŠæ³•ç”¨è€å¸ˆä»‹ç»çš„æµæ–¹æ³•æ¥éå†è®¡ç®—äº†ï¼Œå› ä¸ºä¸èƒ½åˆ é™¤æ•°æ®ï¼Œä¸çŸ¥é“æˆ‘è®¤ä¸ºçš„æ˜¯ä¸æ˜¯å¯¹çš„ã€‚

å¦å¤–å°±æˆ‘çš„å®ç°æ¥è¯´ï¼Œä¼šä¸ä¼šå‡ºç°é—®é¢˜ï¼Ÿæœ‰æ²¡æœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼Ÿ</p>2020-05-20</li><br/><li><span>203ã€‚</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆ æˆ‘è¿™é‡Œæœ‰ä¸ªé—®é¢˜ å…³äºStreamçš„ï¼Œä¸šåŠ¡éœ€æ±‚é‡Œéœ€è¦æŒ‰æŸå‡ ä¸ªå­—æ®µå»é‡(acctId,billingCycleId,prodInstId,offerId)
æˆ‘è¿™é‡Œæƒ³åˆ°äº†éå†é›†åˆareaDatas åç”¨containsæ–¹æ³•åˆ¤æ–­ é‡å†™AcctItemYzfBeanå®ä½“ç±»çš„equalsæ–¹æ³•å®ç°ï¼Œ
è¯·é—®æœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Ÿ ä»£ç å¦‚ä¸‹

List&lt;AcctItemYzfBean&gt; newList = new CopyOnWriteArrayList&lt;&gt;();
&#47;&#47;å¾ªç¯è¿‡æ»¤ã€å¢å¼ºç¿¼æ”¯ä»˜æ•°æ®
Optional.ofNullable(areaDatas)&#47;&#47;é›†åˆåˆ¤ç©º
		.orElse(new ArrayList&lt;&gt;())
		.stream()&#47;&#47;è½¬åŒ–ä¸ºæµ ä¾¿äºä¸‹é¢è¿‡æ»¤å’Œå¢å¼ºæ•°æ®
		.filter(Objects::nonNull)&#47;&#47;å…ƒç´ åˆ¤ç©º
		.filter(yzfBean -&gt; this.judgeIfOfferId(yzfBean))&#47;&#47;åˆ¤æ–­é”€å”®å“IDæ˜¯å¦ç›¸åŒ
		.filter(yzfBean -&gt; this.enhanceYzfBean(yzfBean))&#47;&#47;å¢å¼ºè¿‡æ»¤accNbrå’ŒacctId
		.filter(yzfBean -&gt; this.judgeIfArrears(yzfBean))&#47;&#47;åˆ¤æ–­æ˜¯å¦ä¸æ¬ è´¹
		.filter(yzfBean -&gt; this.judgeIfCancel(yzfBean))&#47;&#47;åˆ¤æ–­æ˜¯å¦é”€è´¦é‡‘é¢å¤§äº0
		.filter(yzfBean -&gt; this.judgeIfReturn(yzfBean))&#47;&#47;åˆ¤æ–­æ˜¯å¦ä¸Šæœˆæœªè¿”è¿˜
		.forEach(yzfBean -&gt; {
			&#47;&#47;å»é‡ é‡å†™AcctItemYzfBean.equalsæ–¹æ³•
			if(!newList.contains(yzfBean)) {
				&#47;&#47;å¢å¼ºlatnName
				yzfBean.setLatnName(commonRegionMap.get(yzfBean.getRegionId()));
				&#47;&#47;å¢å¼ºareaCode
				yzfBean.setAreaCode(areaCode);
				&#47;&#47;æ•°æ®å°è£…
				newList.add(yzfBean);
			}
		});

é‡å†™çš„equalsæ–¹æ³•		
@Override
public boolean equals(Object yzfBeanObj) {
	if(yzfBeanObj instanceof AcctItemYzfBean) {
		AcctItemYzfBean yzfBean = (AcctItemYzfBean) yzfBeanObj;
		if(Tools.isEmpty(yzfBean.getAcctId(), yzfBean.getBillingCycleId(), yzfBean.getProdInstId(),  yzfBean.getOfferId())) {
			return false;
		}
		if(yzfBean.getAcctId().equals(this.acctId) &amp;&amp; yzfBean.getBillingCycleId().equals(this.billingCycleId)
				&amp;&amp; yzfBean.getProdInstId().equals(this.prodInstId) &amp;&amp; yzfBean.getOfferId().equals(this.offerId)) {
			return true;
		}
	}
	return super.equals(yzfBeanObj);
}</p>2020-05-12</li><br/><li><span>é˜¿æ€ª</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>æ¯å¤©ä¸Šä¸‹ç­é˜…è¯»ï¼Œæ”¶è·æ»¡æ»¡</p>2020-03-25</li><br/><li><span>é™ˆå¤©æŸ±</span> ğŸ‘ï¼ˆ9ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>è€å¸ˆæŠŠstreamçš„å¸¸ç”¨apiä¸sqlæ“ä½œè”ç³»èµ·æ¥ï¼Œç®€ç›´æ˜¯å¤ªâ€œäº²æ°‘â€äº†ï¼</p>2020-03-20</li><br/><li><span>QQæ€ª</span> ğŸ‘ï¼ˆ8ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>Idea åœ¨debugæ¨¡å¼æœ‰ä¸ªTrace Current Stream ChainåŠŸèƒ½ï¼Œå¯ä»¥å¾ˆå¥½çš„æŸ¥çœ‹æ•°æ®å˜åŒ–</p>2020-04-12</li><br/><li><span>ğŸ‘½</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>ä¸ªäººè®¤ä¸ºï¼Œå®¢æˆ·ç«¯ä¸å®‰å…¨çš„ä¸»è¦åŸå› æ˜¯ï¼Œè®¡ç®—æœºç½‘ç»œåè®®ã€‚
ç½‘ç»œç¯å¢ƒä¸­ä¸€åˆ‡éƒ½æ˜¯ä¸å¯é¢„çŸ¥ï¼Œåˆ‡ä¸å®‰å…¨çš„ã€‚
æ— æ³•ä¿è¯ä½ å‘å‡ºå»çš„æ•°æ®ï¼Œå°±æ˜¯æœåŠ¡å™¨è¦çš„æ•°æ®ï¼›ä¹Ÿæ— æ³•ä¿è¯ä½ å‘çš„æ•°æ®é¡ºåºæ˜¯1ï¼Œ2ï¼Œ3æœåŠ¡å™¨æ”¶åˆ°çš„å°±æ˜¯1ï¼Œ2ï¼Œ3.æœ‰å¯èƒ½æœåŠ¡å™¨æ”¶åˆ°çš„æ˜¯ã€3ï¼Œ2ï¼Œ1ã€‘  ã€ 2ï¼Œ1ï¼Œ3ã€‘ ã€ 3ï¼Œ1ï¼Œ2ã€‘ï¼Œç”šè‡³æœ‰å¯èƒ½ã€111ã€‘æˆ–è€…å‹æ ¹æ”¶ä¸åˆ°ã€‚
åœ¨ç½‘ç»œä¸­ï¼Œä¼ è¾“æ•°æ®çš„æ–¹å¼ï¼Œæ–¹å¼æ˜¯å¹¿æ’­ï¼Œæ— æ¡ä»¶è½¬å‘ï¼Œå°±æ˜¯ä»»ä½•äººéƒ½æœ‰å¯èƒ½æ”¶åˆ°ï¼Œæ‰€ä»¥å¿…è¦çš„å°±æ˜¯åŠ å¯†ã€‚é˜²æ­¢å¯¹æ–¹çŸ¥é“ã€‚
ä»»ä½•äººéƒ½èƒ½æ”¶åˆ°ï¼Œä»»ä½•äººä¹Ÿéƒ½æœ‰æƒåŠ›ç»§ç»­è½¬å‘ï¼Œè°éƒ½ä¸æ•¢ä¿è¯ï¼Œè½¬å‘çš„æ—¶å€™ä¼šä¸ä¼šç»™ä½ å¢åŠ äº›ä¸å®‰å…¨çš„ä¿¡æ¯ã€‚è¿™ä¹Ÿå°±æ˜¯æœåŠ¡ç«¯éœ€è¦æ ¡éªŒã€‚</p>2020-05-20</li><br/>
</ul>