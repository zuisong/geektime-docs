ä½ å¥½ï¼Œæˆ‘æ˜¯æœ±æ™”ã€‚ä»Šå¤©ï¼Œæˆ‘æ¥å’Œä½ èŠèŠç¨‹åºé‡Œçš„åˆ¤ç­‰é—®é¢˜ã€‚

ä½ å¯èƒ½ä¼šè¯´ï¼Œåˆ¤ç­‰ä¸å°±æ˜¯ä¸€è¡Œä»£ç çš„äº‹æƒ…å—ï¼Œæœ‰ä»€ä¹ˆå¥½è¯´çš„ã€‚ä½†ï¼Œè¿™ä¸€è¡Œä»£ç å¦‚æœå¤„ç†ä¸å½“ï¼Œä¸ä»…ä¼šå‡ºç°Bugï¼Œè¿˜å¯èƒ½ä¼šå¼•èµ·å†…å­˜æ³„éœ²ç­‰é—®é¢˜ã€‚æ¶‰åŠåˆ¤ç­‰çš„Bugï¼Œå³ä½¿æ˜¯ä½¿ç”¨==è¿™ç§é”™è¯¯çš„åˆ¤ç­‰æ–¹å¼ï¼Œä¹Ÿä¸æ˜¯æ‰€æœ‰æ—¶å€™éƒ½ä¼šå‡ºé—®é¢˜ã€‚æ‰€ä»¥ç±»ä¼¼çš„åˆ¤ç­‰é—®é¢˜ä¸å¤ªå®¹æ˜“å‘ç°ï¼Œå¯èƒ½ä¼šè¢«éšè—å¾ˆä¹…ã€‚

ä»Šå¤©ï¼Œæˆ‘å°±equalsã€compareToå’ŒJavaçš„æ•°å€¼ç¼“å­˜ã€å­—ç¬¦ä¸²é©»ç•™ç­‰é—®é¢˜å±•å¼€è®¨è®ºï¼Œå¸Œæœ›ä½ å¯ä»¥ç†è§£å…¶åŸç†ï¼Œå½»åº•æ¶ˆé™¤ä¸šåŠ¡ä»£ç ä¸­çš„ç›¸å…³Bugã€‚

## æ³¨æ„equalså’Œ==çš„åŒºåˆ«

åœ¨ä¸šåŠ¡ä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨equalsæˆ–== è¿›è¡Œåˆ¤ç­‰æ“ä½œã€‚equalsæ˜¯æ–¹æ³•è€Œ==æ˜¯æ“ä½œç¬¦ï¼Œå®ƒä»¬çš„ä½¿ç”¨æ˜¯æœ‰åŒºåˆ«çš„ï¼š

- å¯¹åŸºæœ¬ç±»å‹ï¼Œæ¯”å¦‚intã€longï¼Œè¿›è¡Œåˆ¤ç­‰ï¼Œåªèƒ½ä½¿ç”¨==ï¼Œæ¯”è¾ƒçš„æ˜¯ç›´æ¥å€¼ã€‚å› ä¸ºåŸºæœ¬ç±»å‹çš„å€¼å°±æ˜¯å…¶æ•°å€¼ã€‚
- å¯¹å¼•ç”¨ç±»å‹ï¼Œæ¯”å¦‚Integerã€Longå’ŒStringï¼Œè¿›è¡Œåˆ¤ç­‰ï¼Œéœ€è¦ä½¿ç”¨equalsè¿›è¡Œå†…å®¹åˆ¤ç­‰ã€‚å› ä¸ºå¼•ç”¨ç±»å‹çš„ç›´æ¥å€¼æ˜¯æŒ‡é’ˆï¼Œä½¿ç”¨==çš„è¯ï¼Œæ¯”è¾ƒçš„æ˜¯æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªå¯¹è±¡åœ¨å†…å­˜ä¸­çš„åœ°å€ï¼Œå³æ¯”è¾ƒå®ƒä»¬æ˜¯ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä¸æ˜¯æ¯”è¾ƒå¯¹è±¡çš„å†…å®¹ã€‚

è¿™å°±å¼•å‡ºäº†æˆ‘ä»¬å¿…é¡»å¿…é¡»è¦çŸ¥é“çš„ç¬¬ä¸€ä¸ªç»“è®ºï¼š**æ¯”è¾ƒå€¼çš„å†…å®¹ï¼Œé™¤äº†åŸºæœ¬ç±»å‹åªèƒ½ä½¿ç”¨==å¤–ï¼Œå…¶ä»–ç±»å‹éƒ½éœ€è¦ä½¿ç”¨equals**ã€‚

åœ¨å¼€ç¯‡æˆ‘æåˆ°äº†ï¼Œå³ä½¿ä½¿ç”¨==å¯¹Integeræˆ–Stringè¿›è¡Œåˆ¤ç­‰ï¼Œæœ‰äº›æ—¶å€™ä¹Ÿèƒ½å¾—åˆ°æ­£ç¡®ç»“æœã€‚è¿™åˆæ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

æˆ‘ä»¬ç”¨ä¸‹é¢çš„æµ‹è¯•ç”¨ä¾‹æ·±å…¥ç ”ç©¶ä¸‹ï¼š

- ä½¿ç”¨==å¯¹ä¸¤ä¸ªå€¼ä¸º127çš„ç›´æ¥èµ‹å€¼çš„Integerå¯¹è±¡åˆ¤ç­‰ï¼›
- ä½¿ç”¨==å¯¹ä¸¤ä¸ªå€¼ä¸º128çš„ç›´æ¥èµ‹å€¼çš„Integerå¯¹è±¡åˆ¤ç­‰ï¼›
- ä½¿ç”¨==å¯¹ä¸€ä¸ªå€¼ä¸º127çš„ç›´æ¥èµ‹å€¼çš„Integerå’Œå¦ä¸€ä¸ªé€šè¿‡new Integerå£°æ˜çš„å€¼ä¸º127çš„å¯¹è±¡åˆ¤ç­‰ï¼›
- ä½¿ç”¨==å¯¹ä¸¤ä¸ªé€šè¿‡new Integerå£°æ˜çš„å€¼ä¸º127çš„å¯¹è±¡åˆ¤ç­‰ï¼›
- ä½¿ç”¨==å¯¹ä¸€ä¸ªå€¼ä¸º128çš„ç›´æ¥èµ‹å€¼çš„Integerå¯¹è±¡å’Œå¦ä¸€ä¸ªå€¼ä¸º128çš„intåŸºæœ¬ç±»å‹åˆ¤ç­‰ã€‚

```
Integer a = 127; //Integer.valueOf(127)
Integer b = 127; //Integer.valueOf(127)
log.info("\nInteger a = 127;\n" +
        "Integer b = 127;\n" +
        "a == b ? {}",a == b);    // true

Integer c = 128; //Integer.valueOf(128)
Integer d = 128; //Integer.valueOf(128)
log.info("\nInteger c = 128;\n" +
        "Integer d = 128;\n" +
        "c == d ? {}", c == d);   //false

Integer e = 127; //Integer.valueOf(127)
Integer f = new Integer(127); //new instance
log.info("\nInteger e = 127;\n" +
        "Integer f = new Integer(127);\n" +
        "e == f ? {}", e == f);   //false

Integer g = new Integer(127); //new instance
Integer h = new Integer(127); //new instance
log.info("\nInteger g = new Integer(127);\n" +
        "Integer h = new Integer(127);\n" +
        "g == h ? {}", g == h);  //false

Integer i = 128; //unbox
int j = 128;
log.info("\nInteger i = 128;\n" +
        "int j = 128;\n" +
        "i == j ? {}", i == j); //true
```

é€šè¿‡è¿è¡Œç»“æœå¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶çœ‹èµ·æ¥æ°¸è¿œæ˜¯åœ¨å¯¹127å’Œ127ã€128å’Œ128åˆ¤ç­‰ï¼Œä½†==å´æ²¡æœ‰æ°¸è¿œç»™æˆ‘ä»¬trueçš„ç­”å¤ã€‚åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

ç¬¬ä¸€ä¸ªæ¡ˆä¾‹ä¸­ï¼Œç¼–è¯‘å™¨ä¼šæŠŠInteger a = 127è½¬æ¢ä¸ºInteger.valueOf(127)ã€‚æŸ¥çœ‹æºç å¯ä»¥å‘ç°ï¼Œè¿™ä¸ª**è½¬æ¢åœ¨å†…éƒ¨å…¶å®åšäº†ç¼“å­˜ï¼Œä½¿å¾—ä¸¤ä¸ªIntegeræŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡**ï¼Œæ‰€ä»¥==è¿”å›trueã€‚

```
public static Integer valueOf(int i) {
    if (i >= IntegerCache.low && i <= IntegerCache.high)
        return IntegerCache.cache[i + (-IntegerCache.low)];
    return new Integer(i);
}
```

ç¬¬äºŒä¸ªæ¡ˆä¾‹ä¸­ï¼Œä¹‹æ‰€ä»¥åŒæ ·çš„ä»£ç 128å°±è¿”å›falseçš„åŸå› æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šç¼“å­˜\[-128, 127]çš„æ•°å€¼ï¼Œè€Œ128å¤„äºè¿™ä¸ªåŒºé—´ä¹‹å¤–ã€‚è®¾ç½®JVMå‚æ•°åŠ ä¸Š-XX:AutoBoxCacheMax=1000å†è¯•è¯•ï¼Œæ˜¯ä¸æ˜¯å°±è¿”å›trueäº†å‘¢ï¼Ÿ

```
private static class IntegerCache {
    static final int low = -128;
    static final int high;


    static {
        // high value may be configured by property
        int h = 127;
        String integerCacheHighPropValue =
            sun.misc.VM.getSavedProperty("java.lang.Integer.IntegerCache.high");
        if (integerCacheHighPropValue != null) {
            try {
                int i = parseInt(integerCacheHighPropValue);
                i = Math.max(i, 127);
                // Maximum array size is Integer.MAX_VALUE
                h = Math.min(i, Integer.MAX_VALUE - (-low) -1);
            } catch( NumberFormatException nfe) {
                // If the property cannot be parsed into an int, ignore it.
            }
        }
        high = h;


        cache = new Integer[(high - low) + 1];
        int j = low;
        for(int k = 0; k < cache.length; k++)
            cache[k] = new Integer(j++);


        // range [-128, 127] must be interned (JLS7 5.1.7)
        assert IntegerCache.high >= 127;
    }
}
```

ç¬¬ä¸‰å’Œç¬¬å››ä¸ªæ¡ˆä¾‹ä¸­ï¼ŒNewå‡ºæ¥çš„Integerå§‹ç»ˆæ˜¯ä¸èµ°ç¼“å­˜çš„æ–°å¯¹è±¡ã€‚æ¯”è¾ƒä¸¤ä¸ªæ–°å¯¹è±¡ï¼Œæˆ–è€…æ¯”è¾ƒä¸€ä¸ªæ–°å¯¹è±¡å’Œä¸€ä¸ªæ¥è‡ªç¼“å­˜çš„å¯¹è±¡ï¼Œç»“æœè‚¯å®šä¸æ˜¯ç›¸åŒçš„å¯¹è±¡ï¼Œå› æ­¤è¿”å›falseã€‚

ç¬¬äº”ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬æŠŠè£…ç®±çš„Integerå’ŒåŸºæœ¬ç±»å‹intæ¯”è¾ƒï¼Œå‰è€…ä¼šå…ˆæ‹†ç®±å†æ¯”è¾ƒï¼Œæ¯”è¾ƒçš„è‚¯å®šæ˜¯æ•°å€¼è€Œä¸æ˜¯å¼•ç”¨ï¼Œå› æ­¤è¿”å›trueã€‚

çœ‹åˆ°è¿™é‡Œï¼Œå¯¹äºIntegerä»€ä¹ˆæ—¶å€™æ˜¯ç›¸åŒå¯¹è±¡ä»€ä¹ˆæ—¶å€™æ˜¯ä¸åŒå¯¹è±¡ï¼Œå°±å¾ˆæ¸…æ¥šäº†å§ã€‚ä½†çŸ¥é“è¿™äº›å…¶å®æ„ä¹‰ä¸å¤§ï¼Œå› ä¸ºåœ¨å¤§å¤šæ•°æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸å…³å¿ƒIntegerå¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªï¼Œ**åªéœ€è¦è®°å¾—æ¯”è¾ƒIntegerçš„å€¼è¯·ä½¿ç”¨equalsï¼Œè€Œä¸æ˜¯==**ï¼ˆå¯¹äºåŸºæœ¬ç±»å‹intçš„æ¯”è¾ƒå½“ç„¶åªèƒ½ä½¿ç”¨==ï¼‰ã€‚

å…¶å®ï¼Œæˆ‘ä»¬åº”è¯¥éƒ½çŸ¥é“è¿™ä¸ªåŸåˆ™ï¼Œåªæ˜¯æœ‰çš„æ—¶å€™ç‰¹åˆ«å®¹æ˜“å¿½ç•¥ã€‚ä»¥æˆ‘ä¹‹å‰é‡åˆ°è¿‡çš„ä¸€ä¸ªç”Ÿäº§äº‹æ•…ä¸ºä¾‹ï¼Œæœ‰è¿™ä¹ˆä¸€ä¸ªæšä¸¾å®šä¹‰äº†è®¢å•çŠ¶æ€å’Œå¯¹äºçŠ¶æ€çš„æè¿°ï¼š

```
enum StatusEnum {
    CREATED(1000, "å·²åˆ›å»º"),
    PAID(1001, "å·²æ”¯ä»˜"),
    DELIVERED(1002, "å·²é€åˆ°"),
    FINISHED(1003, "å·²å®Œæˆ");

    private final Integer status; //æ³¨æ„è¿™é‡Œçš„Integer
    private final String desc;

    StatusEnum(Integer status, String desc) {
        this.status = status;
        this.desc = desc;
    }
}
```

åœ¨ä¸šåŠ¡ä»£ç ä¸­ï¼Œå¼€å‘åŒå­¦ä½¿ç”¨äº†==å¯¹æšä¸¾å’Œå…¥å‚OrderQueryä¸­çš„statuså±æ€§è¿›è¡Œåˆ¤ç­‰ï¼š

```
@Data
public class OrderQuery {
    private Integer status;
    private String name;
}

@PostMapping("enumcompare")
public void enumcompare(@RequestBody OrderQuery orderQuery){
    StatusEnum statusEnum = StatusEnum.DELIVERED;
    log.info("orderQuery:{} statusEnum:{} result:{}", orderQuery, statusEnum, statusEnum.status == orderQuery.getStatus());
}
```

**å› ä¸ºæšä¸¾å’Œå…¥å‚OrderQueryä¸­çš„statuséƒ½æ˜¯åŒ…è£…ç±»å‹ï¼Œæ‰€ä»¥é€šè¿‡==åˆ¤ç­‰è‚¯å®šæ˜¯æœ‰é—®é¢˜çš„ã€‚åªæ˜¯è¿™ä¸ªé—®é¢˜æ¯”è¾ƒéšæ™¦**ï¼Œç©¶å…¶åŸå› åœ¨äºï¼š

- åªçœ‹æšä¸¾çš„å®šä¹‰CREATED(1000, â€œå·²åˆ›å»ºâ€)ï¼Œå®¹æ˜“è®©äººè¯¯è§£statuså€¼æ˜¯åŸºæœ¬ç±»å‹ï¼›
- å› ä¸ºæœ‰Integerç¼“å­˜æœºåˆ¶çš„å­˜åœ¨ï¼Œæ‰€ä»¥ä½¿ç”¨==åˆ¤ç­‰å¹¶ä¸æ˜¯æ‰€æœ‰æƒ…å†µä¸‹éƒ½æœ‰é—®é¢˜ã€‚åœ¨è¿™æ¬¡äº‹æ•…ä¸­ï¼Œè®¢å•çŠ¶æ€çš„å€¼ä»100å¼€å§‹å¢é•¿ï¼Œç¨‹åºä¸€å¼€å§‹ä¸å‡ºé—®é¢˜ï¼Œç›´åˆ°è®¢å•çŠ¶æ€è¶…è¿‡127åæ‰å‡ºç°Bugã€‚

åœ¨äº†è§£æ¸…æ¥šä¸ºä»€ä¹ˆIntegerä½¿ç”¨==åˆ¤ç­‰æœ‰æ—¶å€™ä¹Ÿæœ‰æ•ˆçš„åŸå› ä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆStringä¹Ÿæœ‰è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬ä½¿ç”¨å‡ ä¸ªç”¨ä¾‹æ¥æµ‹è¯•ä¸‹ï¼š

- å¯¹ä¸¤ä¸ªç›´æ¥å£°æ˜çš„å€¼éƒ½ä¸º1çš„Stringä½¿ç”¨==åˆ¤ç­‰ï¼›
- å¯¹ä¸¤ä¸ªnewå‡ºæ¥çš„å€¼éƒ½ä¸º2çš„Stringä½¿ç”¨==åˆ¤ç­‰ï¼›
- å¯¹ä¸¤ä¸ªnewå‡ºæ¥çš„å€¼éƒ½ä¸º3çš„Stringå…ˆè¿›è¡Œinternæ“ä½œï¼Œå†ä½¿ç”¨==åˆ¤ç­‰ï¼›
- å¯¹ä¸¤ä¸ªnewå‡ºæ¥çš„å€¼éƒ½ä¸º4çš„Stringé€šè¿‡equalsåˆ¤ç­‰ã€‚

```
String a = "1";
String b = "1";
log.info("\nString a = \"1\";\n" +
        "String b = \"1\";\n" +
        "a == b ? {}", a == b); //true

String c = new String("2");
String d = new String("2");
log.info("\nString c = new String(\"2\");\n" +
        "String d = new String(\"2\");" +
        "c == d ? {}", c == d); //false

String e = new String("3").intern();
String f = new String("3").intern();
log.info("\nString e = new String(\"3\").intern();\n" +
        "String f = new String(\"3\").intern();\n" +
        "e == f ? {}", e == f); //true

String g = new String("4");
String h = new String("4");
log.info("\nString g = new String(\"4\");\n" +
        "String h = new String(\"4\");\n" +
        "g == h ? {}", g.equals(h)); //true
```

åœ¨åˆ†æè¿™ä¸ªç»“æœä¹‹å‰ï¼Œæˆ‘å…ˆå’Œä½ è¯´è¯´Javaçš„å­—ç¬¦ä¸²å¸¸é‡æ± æœºåˆ¶ã€‚é¦–å…ˆè¦æ˜ç¡®çš„æ˜¯å…¶è®¾è®¡åˆè¡·æ˜¯èŠ‚çœå†…å­˜ã€‚å½“ä»£ç ä¸­å‡ºç°åŒå¼•å·å½¢å¼åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡æ—¶ï¼ŒJVMä¼šå…ˆå¯¹è¿™ä¸ªå­—ç¬¦ä¸²è¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å­˜åœ¨ç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ï¼Œåˆ™å°†è¿™ä¸ªå¼•ç”¨è¿”å›ï¼›å¦åˆ™ï¼Œåˆ›å»ºæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œç„¶åå°†è¿™ä¸ªå¼•ç”¨æ”¾å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œå¹¶è¿”å›è¯¥å¼•ç”¨ã€‚è¿™ç§æœºåˆ¶ï¼Œå°±æ˜¯å­—ç¬¦ä¸²é©»ç•™æˆ–æ± åŒ–ã€‚

å†å›åˆ°åˆšæ‰çš„ä¾‹å­ï¼Œå†æ¥åˆ†æä¸€ä¸‹è¿è¡Œç»“æœï¼š

- ç¬¬ä¸€ä¸ªæ¡ˆä¾‹è¿”å›trueï¼Œå› ä¸ºJavaçš„å­—ç¬¦ä¸²é©»ç•™æœºåˆ¶ï¼Œç›´æ¥ä½¿ç”¨åŒå¼•å·å£°æ˜å‡ºæ¥çš„ä¸¤ä¸ªStringå¯¹è±¡æŒ‡å‘å¸¸é‡æ± ä¸­çš„ç›¸åŒå­—ç¬¦ä¸²ã€‚
- ç¬¬äºŒä¸ªæ¡ˆä¾‹ï¼Œnewå‡ºæ¥çš„ä¸¤ä¸ªStringæ˜¯ä¸åŒå¯¹è±¡ï¼Œå¼•ç”¨å½“ç„¶ä¸åŒï¼Œæ‰€ä»¥å¾—åˆ°falseçš„ç»“æœã€‚
- ç¬¬ä¸‰ä¸ªæ¡ˆä¾‹ï¼Œä½¿ç”¨Stringæä¾›çš„internæ–¹æ³•ä¹Ÿä¼šèµ°å¸¸é‡æ± æœºåˆ¶ï¼Œæ‰€ä»¥åŒæ ·èƒ½å¾—åˆ°trueã€‚
- ç¬¬å››ä¸ªæ¡ˆä¾‹ï¼Œé€šè¿‡equalså¯¹å€¼å†…å®¹åˆ¤ç­‰ï¼Œæ˜¯æ­£ç¡®çš„å¤„ç†æ–¹å¼ï¼Œå½“ç„¶ä¼šå¾—åˆ°trueã€‚

**è™½ç„¶ä½¿ç”¨newå£°æ˜çš„å­—ç¬¦ä¸²è°ƒç”¨internæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥è®©å­—ç¬¦ä¸²è¿›è¡Œé©»ç•™ï¼Œä½†åœ¨ä¸šåŠ¡ä»£ç ä¸­æ»¥ç”¨internï¼Œå¯èƒ½ä¼šäº§ç”Ÿæ€§èƒ½é—®é¢˜**ã€‚

å†™ä»£ç æµ‹è¯•ä¸€ä¸‹ï¼Œé€šè¿‡å¾ªç¯æŠŠ1åˆ°1000ä¸‡ä¹‹é—´çš„æ•°å­—ä»¥å­—ç¬¦ä¸²å½¢å¼internåï¼Œå­˜å…¥ä¸€ä¸ªListï¼š

```
List<String> list = new ArrayList<>();

@GetMapping("internperformance")
public int internperformance(@RequestParam(value = "size", defaultValue = "10000000")int size) {
    //-XX:+PrintStringTableStatistics
    //-XX:StringTableSize=10000000
    long begin = System.currentTimeMillis();
    list = IntStream.rangeClosed(1, size)
            .mapToObj(i-> String.valueOf(i).intern())
            .collect(Collectors.toList());
    log.info("size:{} took:{}", size, System.currentTimeMillis() - begin);
    return list.size();
}
```

åœ¨å¯åŠ¨ç¨‹åºæ—¶è®¾ç½®JVMå‚æ•°-XX:+PrintStringTableStatisticï¼Œç¨‹åºé€€å‡ºæ—¶å¯ä»¥æ‰“å°å‡ºå­—ç¬¦ä¸²å¸¸é‡è¡¨çš„ç»Ÿè®¡ä¿¡æ¯ã€‚è°ƒç”¨æ¥å£åå…³é—­ç¨‹åºï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š

```
[11:01:57.770] [http-nio-45678-exec-2] [INFO ] [.t.c.e.d.IntAndStringEqualController:54  ] - size:10000000 took:44907
StringTable statistics:
Number of buckets       :     60013 =    480104 bytes, avg   8.000
Number of entries       :  10030230 = 240725520 bytes, avg  24.000
Number of literals      :  10030230 = 563005568 bytes, avg  56.131
Total footprint         :           = 804211192 bytes
Average bucket size     :   167.134
Variance of bucket size :    55.808
Std. dev. of bucket size:     7.471
Maximum bucket size     :       198
```

å¯ä»¥çœ‹åˆ°ï¼Œ1000ä¸‡æ¬¡internæ“ä½œè€—æ—¶å±…ç„¶è¶…è¿‡äº†44ç§’ã€‚

å…¶å®ï¼ŒåŸå› åœ¨äºå­—ç¬¦ä¸²å¸¸é‡æ± æ˜¯ä¸€ä¸ªå›ºå®šå®¹é‡çš„Mapã€‚å¦‚æœå®¹é‡å¤ªå°ï¼ˆNumber of buckets=60013ï¼‰ã€å­—ç¬¦ä¸²å¤ªå¤šï¼ˆ1000ä¸‡ä¸ªå­—ç¬¦ä¸²ï¼‰ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªæ¡¶ä¸­çš„å­—ç¬¦ä¸²æ•°é‡ä¼šéå¸¸å¤šï¼Œæ‰€ä»¥æœç´¢èµ·æ¥å°±å¾ˆæ…¢ã€‚è¾“å‡ºç»“æœä¸­çš„Average bucket size=167ï¼Œä»£è¡¨äº†Mapä¸­æ¡¶çš„å¹³å‡é•¿åº¦æ˜¯167ã€‚

è§£å†³æ–¹å¼æ˜¯ï¼Œè®¾ç½®JVMå‚æ•°-XX:StringTableSizeï¼ŒæŒ‡å®šæ›´å¤šçš„æ¡¶ã€‚è®¾ç½®-XX:StringTableSize=10000000åï¼Œé‡å¯åº”ç”¨ï¼š

```
[11:09:04.475] [http-nio-45678-exec-1] [INFO ] [.t.c.e.d.IntAndStringEqualController:54  ] - size:10000000 took:5557
StringTable statistics:
Number of buckets       :  10000000 =  80000000 bytes, avg   8.000
Number of entries       :  10030156 = 240723744 bytes, avg  24.000
Number of literals      :  10030156 = 562999472 bytes, avg  56.131
Total footprint         :           = 883723216 bytes
Average bucket size     :     1.003
Variance of bucket size :     1.587
Std. dev. of bucket size:     1.260
Maximum bucket size     :        10
```

å¯ä»¥çœ‹åˆ°ï¼Œ1000ä¸‡æ¬¡è°ƒç”¨è€—æ—¶åªæœ‰5.5ç§’ï¼ŒAverage bucket sizeé™åˆ°äº†1ï¼Œæ•ˆæœæ˜æ˜¾ã€‚

å¥½äº†ï¼Œæ˜¯æ—¶å€™ç»™å‡ºç¬¬äºŒåŸåˆ™äº†ï¼š**æ²¡äº‹åˆ«è½»æ˜“ç”¨internï¼Œå¦‚æœè¦ç”¨ä¸€å®šè¦æ³¨æ„æ§åˆ¶é©»ç•™çš„å­—ç¬¦ä¸²çš„æ•°é‡ï¼Œå¹¶ç•™æ„å¸¸é‡è¡¨çš„å„é¡¹æŒ‡æ ‡**ã€‚

## å®ç°ä¸€ä¸ªequalsæ²¡æœ‰è¿™ä¹ˆç®€å•

å¦‚æœçœ‹è¿‡Objectç±»æºç ï¼Œä½ å¯èƒ½å°±çŸ¥é“ï¼Œequalsçš„å®ç°å…¶å®æ˜¯æ¯”è¾ƒå¯¹è±¡å¼•ç”¨ï¼š

```
public boolean equals(Object obj) {
    return (this == obj);
}
```

ä¹‹æ‰€ä»¥Integeræˆ–Stringèƒ½é€šè¿‡equalså®ç°å†…å®¹åˆ¤ç­‰ï¼Œæ˜¯å› ä¸ºå®ƒä»¬éƒ½é‡å†™äº†è¿™ä¸ªæ–¹æ³•ã€‚æ¯”å¦‚ï¼ŒStringçš„equalsçš„å®ç°ï¼š

```
public boolean equals(Object anObject) {
    if (this == anObject) {
        return true;
    }
    if (anObject instanceof String) {
        String anotherString = (String)anObject;
        int n = value.length;
        if (n == anotherString.value.length) {
            char v1[] = value;
            char v2[] = anotherString.value;
            int i = 0;
            while (n-- != 0) {
                if (v1[i] != v2[i])
                    return false;
                i++;
            }
            return true;
        }
    }
    return false;
}
```

å¯¹äºè‡ªå®šä¹‰ç±»å‹ï¼Œå¦‚æœä¸é‡å†™equalsçš„è¯ï¼Œé»˜è®¤å°±æ˜¯ä½¿ç”¨ObjectåŸºç±»çš„æŒ‰å¼•ç”¨çš„æ¯”è¾ƒæ–¹å¼ã€‚æˆ‘ä»¬å†™ä¸€ä¸ªè‡ªå®šä¹‰ç±»æµ‹è¯•ä¸€ä¸‹ã€‚

å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªæè¿°ç‚¹çš„ç±»Pointï¼Œæœ‰xã€yå’Œæè¿°ä¸‰ä¸ªå±æ€§ï¼š

```
class Point {
    private int x;
    private int y;
    private final String desc;

    public Point(int x, int y, String desc) {
        this.x = x;
        this.y = y;
        this.desc = desc;
    }
}
```

å®šä¹‰ä¸‰ä¸ªç‚¹p1ã€p2å’Œp3ï¼Œå…¶ä¸­p1å’Œp2çš„æè¿°å±æ€§ä¸åŒï¼Œp1å’Œp3çš„ä¸‰ä¸ªå±æ€§å®Œå…¨ç›¸åŒï¼Œå¹¶å†™ä¸€æ®µä»£ç æµ‹è¯•ä¸€ä¸‹é»˜è®¤è¡Œä¸ºï¼š

```
Point p1 = new Point(1, 2, "a");
Point p2 = new Point(1, 2, "b");
Point p3 = new Point(1, 2, "a");
log.info("p1.equals(p2) ? {}", p1.equals(p2));
log.info("p1.equals(p3) ? {}", p1.equals(p3));
```

é€šè¿‡equalsæ–¹æ³•æ¯”è¾ƒp1å’Œp2ã€p1å’Œp3å‡å¾—åˆ°falseï¼ŒåŸå› æ­£å¦‚åˆšæ‰æ‰€è¯´ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ä¸ºPointç±»å®ç°è‡ªå®šä¹‰çš„equalsæ–¹æ³•ï¼ŒObjectè¶…ç±»ä¸­çš„equalsé»˜è®¤ä½¿ç”¨==åˆ¤ç­‰ï¼Œæ¯”è¾ƒçš„æ˜¯å¯¹è±¡çš„å¼•ç”¨ã€‚

æˆ‘ä»¬æœŸæœ›çš„é€»è¾‘æ˜¯ï¼Œåªè¦xå’Œyè¿™2ä¸ªå±æ€§ä¸€è‡´å°±ä»£è¡¨æ˜¯åŒä¸€ä¸ªç‚¹ï¼Œæ‰€ä»¥å†™å‡ºäº†å¦‚ä¸‹çš„æ”¹è¿›ä»£ç ï¼Œé‡å†™equalsæ–¹æ³•ï¼ŒæŠŠå‚æ•°ä¸­çš„Objectè½¬æ¢ä¸ºPointæ¯”è¾ƒå…¶xå’Œyå±æ€§ï¼š

```
class PointWrong {
    private int x;
    private int y;
    private final String desc;

    public PointWrong(int x, int y, String desc) {
        this.x = x;
        this.y = y;
        this.desc = desc;
    }

    @Override
    public boolean equals(Object o) {
        PointWrong that = (PointWrong) o;
        return x == that.x && y == that.y;
    }
}
```

ä¸ºæµ‹è¯•æ”¹è¿›åçš„Pointæ˜¯å¦å¯ä»¥æ»¡è¶³éœ€æ±‚ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸‰ä¸ªç”¨ä¾‹ï¼š

- æ¯”è¾ƒä¸€ä¸ªPointå¯¹è±¡å’Œnullï¼›
- æ¯”è¾ƒä¸€ä¸ªObjectå¯¹è±¡å’Œä¸€ä¸ªPointå¯¹è±¡ï¼›
- æ¯”è¾ƒä¸¤ä¸ªxå’Œyå±æ€§å€¼ç›¸åŒçš„Pointå¯¹è±¡ã€‚

```
PointWrong p1 = new PointWrong(1, 2, "a");
try {
    log.info("p1.equals(null) ? {}", p1.equals(null));
} catch (Exception ex) {
    log.error(ex.getMessage());
}

Object o = new Object();
try {
    log.info("p1.equals(expression) ? {}", p1.equals(o));
} catch (Exception ex) {
    log.error(ex.getMessage());
}

PointWrong p2 = new PointWrong(1, 2, "b");
log.info("p1.equals(p2) ? {}", p1.equals(p2));
```

é€šè¿‡æ—¥å¿—ä¸­çš„ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€æ¬¡æ¯”è¾ƒå‡ºç°äº†ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œç¬¬äºŒæ¬¡æ¯”è¾ƒå‡ºç°äº†ç±»å‹è½¬æ¢å¼‚å¸¸ï¼Œç¬¬ä¸‰æ¬¡æ¯”è¾ƒç¬¦åˆé¢„æœŸè¾“å‡ºäº†trueã€‚

```
[17:54:39.120] [http-nio-45678-exec-1] [ERROR] [t.c.e.demo1.EqualityMethodController:32  ] - java.lang.NullPointerException
[17:54:39.120] [http-nio-45678-exec-1] [ERROR] [t.c.e.demo1.EqualityMethodController:39  ] - java.lang.ClassCastException: java.lang.Object cannot be cast to org.geekbang.time.commonmistakes.equals.demo1.EqualityMethodController$PointWrong
[17:54:39.120] [http-nio-45678-exec-1] [INFO ] [t.c.e.demo1.EqualityMethodController:43  ] - p1.equals(p2) ? true
```

**é€šè¿‡è¿™äº›å¤±æ•ˆçš„ç”¨ä¾‹ï¼Œæˆ‘ä»¬å¤§æ¦‚å¯ä»¥æ€»ç»“å‡ºå®ç°ä¸€ä¸ªæ›´å¥½çš„equalsåº”è¯¥æ³¨æ„çš„ç‚¹ï¼š**

- è€ƒè™‘åˆ°æ€§èƒ½ï¼Œå¯ä»¥å…ˆè¿›è¡ŒæŒ‡é’ˆåˆ¤ç­‰ï¼Œå¦‚æœå¯¹è±¡æ˜¯åŒä¸€ä¸ªé‚£ä¹ˆç›´æ¥è¿”å›trueï¼›
- éœ€è¦å¯¹å¦ä¸€æ–¹è¿›è¡Œåˆ¤ç©ºï¼Œç©ºå¯¹è±¡å’Œè‡ªèº«è¿›è¡Œæ¯”è¾ƒï¼Œç»“æœä¸€å®šæ˜¯fasleï¼›
- éœ€è¦åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡çš„ç±»å‹ï¼Œå¦‚æœç±»å‹éƒ½ä¸åŒï¼Œé‚£ä¹ˆç›´æ¥è¿”å›falseï¼›
- ç¡®ä¿ç±»å‹ç›¸åŒçš„æƒ…å†µä¸‹å†è¿›è¡Œç±»å‹å¼ºåˆ¶è½¬æ¢ï¼Œç„¶åé€ä¸€åˆ¤æ–­æ‰€æœ‰å­—æ®µã€‚

ä¿®å¤å’Œæ”¹è¿›åçš„equalsæ–¹æ³•å¦‚ä¸‹ï¼š

```
@Override
public boolean equals(Object o) {
    if (this == o) return true;
    if (o == null || getClass() != o.getClass()) return false;
    PointRight that = (PointRight) o;
    return x == that.x && y == that.y;
}		
```

æ”¹è¿›åçš„equalsçœ‹èµ·æ¥å®Œç¾äº†ï¼Œä½†è¿˜æ²¡å®Œã€‚æˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ã€‚

## hashCodeå’Œequalsè¦é…å¯¹å®ç°

æˆ‘ä»¬æ¥è¯•è¯•ä¸‹é¢è¿™ä¸ªç”¨ä¾‹ï¼Œå®šä¹‰ä¸¤ä¸ªxå’Œyå±æ€§å€¼å®Œå…¨ä¸€è‡´çš„Pointå¯¹è±¡p1å’Œp2ï¼ŒæŠŠp1åŠ å…¥HashSetï¼Œç„¶ååˆ¤æ–­è¿™ä¸ªSetä¸­æ˜¯å¦å­˜åœ¨p2ï¼š

```
PointWrong p1 = new PointWrong(1, 2, "a");
PointWrong p2 = new PointWrong(1, 2, "b");

HashSet<PointWrong> points = new HashSet<>();
points.add(p1);
log.info("points.contains(p2) ? {}", points.contains(p2));
```

æŒ‰ç…§æ”¹è¿›åçš„equalsæ–¹æ³•ï¼Œè¿™2ä¸ªå¯¹è±¡å¯ä»¥è®¤ä¸ºæ˜¯åŒä¸€ä¸ªï¼ŒSetä¸­å·²ç»å­˜åœ¨äº†p1å°±åº”è¯¥åŒ…å«p2ï¼Œä½†ç»“æœå´æ˜¯falseã€‚

å‡ºç°è¿™ä¸ªBugçš„åŸå› æ˜¯ï¼Œæ•£åˆ—è¡¨éœ€è¦ä½¿ç”¨hashCodeæ¥å®šä½å…ƒç´ æ”¾åˆ°å“ªä¸ªæ¡¶ã€‚å¦‚æœè‡ªå®šä¹‰å¯¹è±¡æ²¡æœ‰å®ç°è‡ªå®šä¹‰çš„hashCodeæ–¹æ³•ï¼Œå°±ä¼šä½¿ç”¨Objectè¶…ç±»çš„é»˜è®¤å®ç°ï¼Œ**å¾—åˆ°çš„ä¸¤ä¸ªhashCodeæ˜¯ä¸åŒçš„ï¼Œå¯¼è‡´æ— æ³•æ»¡è¶³éœ€æ±‚**ã€‚

è¦è‡ªå®šä¹‰hashCodeï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨Objects.hashæ–¹æ³•æ¥å®ç°ï¼Œæ”¹è¿›åçš„Pointç±»å¦‚ä¸‹ï¼š

```
class PointRight {
    private final int x;
    private final int y;
    private final String desc;
    ...
    @Override
    public boolean equals(Object o) {
        ...
    }

    @Override
    public int hashCode() {
        return Objects.hash(x, y);
    }
}
```

æ”¹è¿›equalså’ŒhashCodeåï¼Œå†æµ‹è¯•ä¸‹ä¹‹å‰çš„å››ä¸ªç”¨ä¾‹ï¼Œç»“æœå…¨éƒ¨ç¬¦åˆé¢„æœŸã€‚

```
[18:25:23.091] [http-nio-45678-exec-4] [INFO ] [t.c.e.demo1.EqualityMethodController:54  ] - p1.equals(null) ? false
[18:25:23.093] [http-nio-45678-exec-4] [INFO ] [t.c.e.demo1.EqualityMethodController:61  ] - p1.equals(expression) ? false
[18:25:23.094] [http-nio-45678-exec-4] [INFO ] [t.c.e.demo1.EqualityMethodController:67  ] - p1.equals(p2) ? true
[18:25:23.094] [http-nio-45678-exec-4] [INFO ] [t.c.e.demo1.EqualityMethodController:71  ] - points.contains(p2) ? true
```

çœ‹åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½ä¼šè§‰å¾—è‡ªå·±å®ç°equalså’ŒhashCodeå¾ˆéº»çƒ¦ï¼Œå®ç°equalsæœ‰å¾ˆå¤šæ³¨æ„ç‚¹è€Œä¸”ä»£ç é‡å¾ˆå¤§ã€‚ä¸è¿‡ï¼Œå®ç°è¿™ä¸¤ä¸ªæ–¹æ³•ä¹Ÿæœ‰ç®€å•çš„æ–¹å¼ï¼Œä¸€æ˜¯åé¢è¦è®²åˆ°çš„Lombokæ–¹æ³•ï¼ŒäºŒæ˜¯ä½¿ç”¨IDEçš„ä»£ç ç”ŸæˆåŠŸèƒ½ã€‚IDEAçš„ç±»ä»£ç å¿«æ·ç”Ÿæˆèœå•æ”¯æŒçš„åŠŸèƒ½å¦‚ä¸‹ï¼š

![](https://static001.geekbang.org/resource/image/94/36/944fe3549e4c24936e9837d0bf1e3936.jpg?wh=2284%2A2014)

## æ³¨æ„compareToå’Œequalsçš„é€»è¾‘ä¸€è‡´æ€§

é™¤äº†è‡ªå®šä¹‰ç±»å‹éœ€è¦ç¡®ä¿equalså’ŒhashCodeè¦é€»è¾‘ä¸€è‡´å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæ›´å®¹æ˜“è¢«å¿½ç•¥çš„é—®é¢˜ï¼Œå³compareToåŒæ ·éœ€è¦å’Œequalsç¡®ä¿é€»è¾‘ä¸€è‡´æ€§ã€‚

æˆ‘ä¹‹å‰é‡åˆ°è¿‡è¿™ä¹ˆä¸€ä¸ªé—®é¢˜ï¼Œä»£ç é‡Œæœ¬æ¥ä½¿ç”¨äº†ArrayListçš„indexOfæ–¹æ³•è¿›è¡Œå…ƒç´ æœç´¢ï¼Œä½†æ˜¯ä¸€ä½å¥½å¿ƒçš„å¼€å‘åŒå­¦è§‰å¾—é€ä¸€æ¯”è¾ƒçš„æ—¶é—´å¤æ‚åº¦æ˜¯O(n)ï¼Œæ•ˆç‡å¤ªä½äº†ï¼Œäºæ˜¯æ”¹ä¸ºäº†æ’åºåé€šè¿‡Collections.binarySearchæ–¹æ³•è¿›è¡Œæœç´¢ï¼Œå®ç°äº†O(log n)çš„æ—¶é—´å¤æ‚åº¦ã€‚æ²¡æƒ³åˆ°ï¼Œè¿™ä¹ˆä¸€æ”¹å´å‡ºç°äº†Bugã€‚

æˆ‘ä»¬æ¥é‡ç°ä¸‹è¿™ä¸ªé—®é¢˜ã€‚é¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸ªStudentç±»ï¼Œæœ‰idå’Œnameä¸¤ä¸ªå±æ€§ï¼Œå¹¶å®ç°äº†ä¸€ä¸ªComparableæ¥å£æ¥è¿”å›ä¸¤ä¸ªidçš„å€¼ï¼š

```
@Data
@AllArgsConstructor
class Student implements Comparable<Student>{
    private int id;
    private String name;

    @Override
    public int compareTo(Student other) {
        int result = Integer.compare(other.id, id);
        if (result==0)
            log.info("this {} == other {}", this, other);
        return result;
    }
}
```

ç„¶åï¼Œå†™ä¸€æ®µæµ‹è¯•ä»£ç åˆ†åˆ«é€šè¿‡indexOfæ–¹æ³•å’ŒCollections.binarySearchæ–¹æ³•è¿›è¡Œæœç´¢ã€‚åˆ—è¡¨ä¸­æˆ‘ä»¬å­˜æ”¾äº†ä¸¤ä¸ªå­¦ç”Ÿï¼Œç¬¬ä¸€ä¸ªå­¦ç”Ÿidæ˜¯1å«zhangï¼Œç¬¬äºŒä¸ªå­¦ç”Ÿidæ˜¯2å«wangï¼Œæœç´¢è¿™ä¸ªåˆ—è¡¨æ˜¯å¦å­˜åœ¨ä¸€ä¸ªidæ˜¯2å«liçš„å­¦ç”Ÿï¼š

```
@GetMapping("wrong")
public void wrong(){

    List<Student> list = new ArrayList<>();
    list.add(new Student(1, "zhang"));
    list.add(new Student(2, "wang"));
    Student student = new Student(2, "li");

    log.info("ArrayList.indexOf");
    int index1 = list.indexOf(student);
    Collections.sort(list);
    log.info("Collections.binarySearch");
    int index2 = Collections.binarySearch(list, student);

    log.info("index1 = " + index1);
    log.info("index2 = " + index2);
}
```

ä»£ç è¾“å‡ºçš„æ—¥å¿—å¦‚ä¸‹ï¼š

```
[18:46:50.226] [http-nio-45678-exec-1] [INFO ] [t.c.equals.demo2.CompareToController:28  ] - ArrayList.indexOf
[18:46:50.226] [http-nio-45678-exec-1] [INFO ] [t.c.equals.demo2.CompareToController:31  ] - Collections.binarySearch
[18:46:50.227] [http-nio-45678-exec-1] [INFO ] [t.c.equals.demo2.CompareToController:67  ] - this CompareToController.Student(id=2, name=wang) == other CompareToController.Student(id=2, name=li)
[18:46:50.227] [http-nio-45678-exec-1] [INFO ] [t.c.equals.demo2.CompareToController:34  ] - index1 = -1
[18:46:50.227] [http-nio-45678-exec-1] [INFO ] [t.c.equals.demo2.CompareToController:35  ] - index2 = 1
```

æˆ‘ä»¬æ³¨æ„åˆ°å¦‚ä¸‹å‡ ç‚¹ï¼š

- **binarySearchæ–¹æ³•å†…éƒ¨è°ƒç”¨äº†å…ƒç´ çš„compareToæ–¹æ³•è¿›è¡Œæ¯”è¾ƒ**ï¼›
- indexOfçš„ç»“æœæ²¡é—®é¢˜ï¼Œåˆ—è¡¨ä¸­æœç´¢ä¸åˆ°idä¸º2ã€nameæ˜¯liçš„å­¦ç”Ÿï¼›
- binarySearchè¿”å›äº†ç´¢å¼•1ï¼Œä»£è¡¨æœç´¢åˆ°çš„ç»“æœæ˜¯idä¸º2ï¼Œnameæ˜¯wangçš„å­¦ç”Ÿã€‚

ä¿®å¤æ–¹å¼å¾ˆç®€å•ï¼Œç¡®ä¿compareToçš„æ¯”è¾ƒé€»è¾‘å’Œequalsçš„å®ç°ä¸€è‡´å³å¯ã€‚é‡æ–°å®ç°ä¸€ä¸‹Studentç±»ï¼Œé€šè¿‡Comparator.comparingè¿™ä¸ªä¾¿æ·çš„æ–¹æ³•æ¥å®ç°ä¸¤ä¸ªå­—æ®µçš„æ¯”è¾ƒï¼š

```
@Data
@AllArgsConstructor
class StudentRight implements Comparable<StudentRight>{
    private int id;
    private String name;

    @Override
    public int compareTo(StudentRight other) {
        return Comparator.comparing(StudentRight::getName)
                .thenComparingInt(StudentRight::getId)
                .compare(this, other);
    }
}
```

å…¶å®ï¼Œè¿™ä¸ªé—®é¢˜å®¹æ˜“è¢«å¿½ç•¥çš„åŸå› åœ¨äºä¸¤æ–¹é¢ï¼š

- ä¸€æ˜¯ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†Lombokçš„@Dataæ ‡è®°äº†Studentï¼Œ@Dataæ³¨è§£ï¼ˆè¯¦è§[è¿™é‡Œ](https://projectlombok.org/features/Data)ï¼‰å…¶å®åŒ…å«äº†@EqualsAndHashCodeæ³¨è§£ï¼ˆè¯¦è§[è¿™é‡Œ](https://projectlombok.org/features/EqualsAndHashCode)ï¼‰çš„ä½œç”¨ï¼Œä¹Ÿå°±æ˜¯é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨ç±»å‹æ‰€æœ‰çš„å­—æ®µï¼ˆä¸åŒ…æ‹¬staticå’Œtransientå­—æ®µï¼‰å‚ä¸åˆ°equalså’ŒhashCodeæ–¹æ³•çš„å®ç°ä¸­ã€‚å› ä¸ºè¿™ä¸¤ä¸ªæ–¹æ³•çš„å®ç°ä¸æ˜¯æˆ‘ä»¬è‡ªå·±å®ç°çš„ï¼Œæ‰€ä»¥å®¹æ˜“å¿½ç•¥å…¶é€»è¾‘ã€‚
- äºŒæ˜¯ï¼ŒcompareToæ–¹æ³•éœ€è¦è¿”å›æ•°å€¼ï¼Œä½œä¸ºæ’åºçš„ä¾æ®ï¼Œå®¹æ˜“è®©äººä½¿ç”¨æ•°å€¼ç±»å‹çš„å­—æ®µéšæ„å®ç°ã€‚

æˆ‘å†å¼ºè°ƒä¸‹ï¼Œ**å¯¹äºè‡ªå®šä¹‰çš„ç±»å‹ï¼Œå¦‚æœè¦å®ç°Comparableï¼Œè¯·è®°å¾—equalsã€hashCodeã€compareToä¸‰è€…é€»è¾‘ä¸€è‡´**ã€‚

## å°å¿ƒLombokç”Ÿæˆä»£ç çš„â€œå‘â€

Lombokçš„@Dataæ³¨è§£ä¼šå¸®æˆ‘ä»¬å®ç°equalså’Œhashcodeæ–¹æ³•ï¼Œä½†æ˜¯æœ‰ç»§æ‰¿å…³ç³»æ—¶ï¼ŒLombokè‡ªåŠ¨ç”Ÿæˆçš„æ–¹æ³•å¯èƒ½å°±ä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„äº†ã€‚

æˆ‘ä»¬å…ˆæ¥ç ”ç©¶ä¸€ä¸‹å…¶å®ç°ï¼šå®šä¹‰ä¸€ä¸ªPersonç±»å‹ï¼ŒåŒ…å«å§“åå’Œèº«ä»½è¯ä¸¤ä¸ªå­—æ®µï¼š

```
@Data
class Person {
    private String name;
    private String identity;

    public Person(String name, String identity) {
        this.name = name;
        this.identity = identity;
    }
}
```

å¯¹äºèº«ä»½è¯ç›¸åŒã€å§“åä¸åŒçš„ä¸¤ä¸ªPersonå¯¹è±¡ï¼š

```
Person person1 = new Person("zhuye","001");
Person person2 = new Person("Joseph","001");
log.info("person1.equals(person2) ? {}", person1.equals(person2));
```

ä½¿ç”¨equalsåˆ¤ç­‰ä¼šå¾—åˆ°falseã€‚å¦‚æœä½ å¸Œæœ›åªè¦èº«ä»½è¯ä¸€è‡´å°±è®¤ä¸ºæ˜¯åŒä¸€ä¸ªäººçš„è¯ï¼Œå¯ä»¥ä½¿ç”¨@EqualsAndHashCode.Excludeæ³¨è§£æ¥ä¿®é¥°nameå­—æ®µï¼Œä»equalså’ŒhashCodeçš„å®ç°ä¸­æ’é™¤nameå­—æ®µï¼š

```
@EqualsAndHashCode.Exclude
private String name;
```

ä¿®æ”¹åå¾—åˆ°trueã€‚æ‰“å¼€ç¼–è¯‘åçš„ä»£ç å¯ä»¥çœ‹åˆ°ï¼ŒLombokä¸ºPersonç”Ÿæˆçš„equalsæ–¹æ³•çš„å®ç°ï¼Œç¡®å®åªåŒ…å«äº†identityå±æ€§ï¼š

```
public boolean equals(final Object o) {
    if (o == this) {
        return true;
    } else if (!(o instanceof LombokEquealsController.Person)) {
        return false;
    } else {
        LombokEquealsController.Person other = (LombokEquealsController.Person)o;
        if (!other.canEqual(this)) {
            return false;
        } else {
            Object this$identity = this.getIdentity();
            Object other$identity = other.getIdentity();
            if (this$identity == null) {
                if (other$identity != null) {
                    return false;
                }
            } else if (!this$identity.equals(other$identity)) {
                return false;
            }

            return true;
        }
    }
}
```

ä½†åˆ°è¿™é‡Œè¿˜æ²¡å®Œï¼Œå¦‚æœç±»å‹ä¹‹é—´æœ‰ç»§æ‰¿ï¼ŒLombokä¼šæ€ä¹ˆå¤„ç†å­ç±»çš„equalså’ŒhashCodeå‘¢ï¼Ÿæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œå†™ä¸€ä¸ªEmployeeç±»ç»§æ‰¿Personï¼Œå¹¶æ–°å®šä¹‰ä¸€ä¸ªå…¬å¸å±æ€§ï¼š

```
@Data
class Employee extends Person {

    private String company;
    public Employee(String name, String identity, String company) {
        super(name, identity);
        this.company = company;
    }
}
```

åœ¨å¦‚ä¸‹çš„æµ‹è¯•ä»£ç ä¸­ï¼Œå£°æ˜ä¸¤ä¸ªEmployeeå®ä¾‹ï¼Œå®ƒä»¬å…·æœ‰ç›¸åŒçš„å…¬å¸åç§°ï¼Œä½†å§“åå’Œèº«ä»½è¯å‡ä¸åŒï¼š

```
Employee employee1 = new Employee("zhuye","001", "bkjk.com");
Employee employee2 = new Employee("Joseph","002", "bkjk.com");
log.info("employee1.equals(employee2) ? {}", employee1.equals(employee2));	
```

å¾ˆé—æ†¾ï¼Œç»“æœæ˜¯trueï¼Œæ˜¾ç„¶æ˜¯æ²¡æœ‰è€ƒè™‘çˆ¶ç±»çš„å±æ€§ï¼Œè€Œè®¤ä¸ºè¿™ä¸¤ä¸ªå‘˜å·¥æ˜¯åŒä¸€äººï¼Œ**è¯´æ˜@EqualsAndHashCodeé»˜è®¤å®ç°æ²¡æœ‰ä½¿ç”¨çˆ¶ç±»å±æ€§ã€‚**

ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è®¾ç½®callSuperå¼€å…³ä¸ºtrueï¼Œæ¥è¦†ç›–è¿™ç§é»˜è®¤è¡Œä¸ºï¼š

```
@Data
@EqualsAndHashCode(callSuper = true)
class Employee extends Person {
```

ä¿®æ”¹åçš„ä»£ç ï¼Œå®ç°äº†åŒæ—¶ä»¥å­ç±»çš„å±æ€§companyåŠ ä¸Šçˆ¶ç±»ä¸­çš„å±æ€§identityï¼Œä½œä¸ºequalså’ŒhashCodeæ–¹æ³•çš„å®ç°æ¡ä»¶ï¼ˆå®ç°ä¸Šå…¶å®æ˜¯è°ƒç”¨äº†çˆ¶ç±»çš„equalså’ŒhashCodeï¼‰ã€‚

## é‡ç‚¹å›é¡¾

ç°åœ¨ï¼Œæˆ‘ä»¬æ¥å›é¡¾ä¸‹å¯¹è±¡åˆ¤ç­‰å’Œæ¯”è¾ƒçš„é‡ç‚¹å†…å®¹å§ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬è¦æ³¨æ„equalså’Œ== çš„åŒºåˆ«ã€‚ä¸šåŠ¡ä»£ç ä¸­è¿›è¡Œå†…å®¹çš„æ¯”è¾ƒï¼Œé’ˆå¯¹åŸºæœ¬ç±»å‹åªèƒ½ä½¿ç”¨==ï¼Œé’ˆå¯¹Integerã€Stringåœ¨å†…çš„å¼•ç”¨ç±»å‹ï¼Œéœ€è¦ä½¿ç”¨equalsã€‚Integerå’ŒStringçš„å‘åœ¨äºï¼Œä½¿ç”¨==åˆ¤ç­‰æœ‰æ—¶ä¹Ÿèƒ½è·å¾—æ­£ç¡®ç»“æœã€‚

å…¶æ¬¡ï¼Œå¯¹äºè‡ªå®šä¹‰ç±»å‹ï¼Œå¦‚æœç±»å‹éœ€è¦å‚ä¸åˆ¤ç­‰ï¼Œé‚£ä¹ˆåŠ¡å¿…åŒæ—¶å®ç°equalså’ŒhashCodeæ–¹æ³•ï¼Œå¹¶ç¡®ä¿é€»è¾‘ä¸€è‡´ã€‚å¦‚æœå¸Œæœ›å¿«é€Ÿå®ç°equalsã€hashCodeæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©IDEçš„ä»£ç ç”ŸæˆåŠŸèƒ½ï¼Œæˆ–ä½¿ç”¨Lombokæ¥ç”Ÿæˆã€‚å¦‚æœç±»å‹ä¹Ÿè¦å‚ä¸æ¯”è¾ƒï¼Œé‚£ä¹ˆcompareToæ–¹æ³•çš„é€»è¾‘åŒæ ·éœ€è¦å’Œequalsã€hashCodeæ–¹æ³•ä¸€è‡´ã€‚

æœ€åï¼ŒLombokçš„@EqualsAndHashCodeæ³¨è§£å®ç°equalså’ŒhashCodeçš„æ—¶å€™ï¼Œé»˜è®¤ä½¿ç”¨ç±»å‹æ‰€æœ‰éstaticã€étransientçš„å­—æ®µï¼Œä¸”ä¸è€ƒè™‘çˆ¶ç±»ã€‚å¦‚æœå¸Œæœ›æ”¹å˜è¿™ç§é»˜è®¤è¡Œä¸ºï¼Œå¯ä»¥ä½¿ç”¨@EqualsAndHashCode.Excludeæ’é™¤ä¸€äº›å­—æ®µï¼Œå¹¶è®¾ç½®callSuper = trueæ¥è®©å­ç±»çš„equalså’ŒhashCodeè°ƒç”¨çˆ¶ç±»çš„ç›¸åº”æ–¹æ³•ã€‚

åœ¨æ¯”è¾ƒæšä¸¾å€¼å’ŒPOJOå‚æ•°å€¼çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ³¨æ„åˆ°ï¼Œä½¿ç”¨==æ¥åˆ¤æ–­ä¸¤ä¸ªåŒ…è£…ç±»å‹çš„ä½çº§é”™è¯¯ï¼Œç¡®å®å®¹æ˜“è¢«å¿½ç•¥ã€‚æ‰€ä»¥ï¼Œ**æˆ‘å»ºè®®ä½ åœ¨IDEä¸­å®‰è£…é˜¿é‡Œå·´å·´çš„Javaè§„çº¦æ’ä»¶**ï¼ˆè¯¦è§[è¿™é‡Œ](https://github.com/alibaba/p3c)ï¼‰ï¼Œæ¥åŠæ—¶æç¤ºæˆ‘ä»¬è¿™ç±»ä½çº§é”™è¯¯ï¼š

![](https://static001.geekbang.org/resource/image/fe/c3/fe020d747a35cec23e5d92c1277d02c3.png?wh=2688%2A406)

ä»Šå¤©ç”¨åˆ°çš„ä»£ç ï¼Œæˆ‘éƒ½æ”¾åœ¨äº†GitHubä¸Šï¼Œä½ å¯ä»¥ç‚¹å‡»[è¿™ä¸ªé“¾æ¥](https://github.com/JosephZhu1983/java-common-mistakes)æŸ¥çœ‹ã€‚

## æ€è€ƒä¸è®¨è®º

1. åœ¨å®ç°equalsæ—¶ï¼Œæˆ‘æ˜¯å…ˆé€šè¿‡getClassæ–¹æ³•åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡çš„ç±»å‹ï¼Œä½ å¯èƒ½ä¼šæƒ³åˆ°è¿˜å¯ä»¥ä½¿ç”¨instanceofæ¥åˆ¤æ–­ã€‚ä½ èƒ½è¯´è¯´è¿™ä¸¤ç§å®ç°æ–¹å¼çš„åŒºåˆ«å—ï¼Ÿ
2. åœ¨ç¬¬ä¸‰èŠ‚çš„ä¾‹å­ä¸­ï¼Œæˆ‘æ¼”ç¤ºäº†å¯ä»¥é€šè¿‡HashSetçš„containsæ–¹æ³•åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨HashSetä¸­ï¼ŒåŒæ ·æ˜¯Setçš„TreeSetå…¶containsæ–¹æ³•å’ŒHashSetæœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿ

æœ‰å…³å¯¹è±¡åˆ¤ç­‰ã€æ¯”è¾ƒï¼Œä½ è¿˜é‡åˆ°è¿‡å…¶ä»–å‘å—ï¼Ÿæˆ‘æ˜¯æœ±æ™”ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºä¸æˆ‘ç•™è¨€åˆ†äº«ä½ çš„æƒ³æ³•ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–åŒäº‹ï¼Œä¸€èµ·äº¤æµã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ15ï¼‰</strong></div><ul>
<li><span>Darren</span> ğŸ‘ï¼ˆ308ï¼‰ ğŸ’¬ï¼ˆ27ï¼‰<p>ç¨å¾®è¡¥å……ä¸€ç‚¹ï¼Œå¯èƒ½å› ä¸ºç¯‡å¹…çš„åŸå› ï¼Œè€å¸ˆæ²¡æåˆ°ï¼Œå…³äºequalså…¶å®è¿˜æœ‰ä¸€ä¸ªå¤§å‘ï¼Œequalsæ¯”è¾ƒçš„å¯¹è±¡é™¤äº†æ‰€è°“çš„ç›¸ç­‰å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„å› ç´ ï¼Œå°±æ˜¯è¯¥å¯¹è±¡çš„ç±»åŠ è½½å™¨ä¹Ÿå¿…é¡»æ˜¯åŒä¸€ä¸ªï¼Œä¸ç„¶equalsè¿”å›çš„è‚¯å®šæ˜¯falseï¼›ä¹‹å‰é‡åˆ°è¿‡ä¸€ä¸ªå‘ï¼šé‡å¯åï¼Œä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œç»“æœæ˜¯trueï¼Œä½†æ˜¯ä¿®æ”¹äº†æŸäº›ä¸œè¥¿åï¼Œçƒ­åŠ è½½ï¼ˆä¸ç”¨é‡å¯å³å¯ç”Ÿæ•ˆï¼‰åï¼Œå†æ¬¡æ‰§è¡Œequalsï¼Œè¿”å›å°±æ˜¯falseï¼Œå› ä¸ºçƒ­åŠ è½½ä½¿ç”¨çš„ç±»åŠ è½½å™¨å’Œç¨‹åºæ­£å¸¸å¯åŠ¨çš„ç±»åŠ è½½å™¨ä¸åŒã€‚å…³äºç±»åŠ è½½å™¨éƒ¨åˆ†ï¼ŒJDK 9 ä¹‹å‰çš„ Java åº”ç”¨éƒ½æ˜¯ç”±ã€Œå¯åŠ¨ç±»åŠ è½½å™¨ã€ã€ã€Œæ‰©å±•ç±»åŠ è½½å™¨ã€ã€ã€Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ã€è¿™ä¸‰ç§ç±»åŠ è½½å™¨äº’ç›¸é…åˆæ¥å®ŒæˆåŠ è½½çš„ï¼Œå¦‚æœæœ‰éœ€è¦è¿˜å¯ä»¥åŠ å…¥è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨æ¥è¿›è¡Œæ‹“å±•ï¼›JDK 9 ä¸ºäº†æ¨¡å—åŒ–çš„æ”¯æŒï¼Œå¯¹åŒäº²å§”æ´¾æ¨¡å¼åšäº†ä¸€äº›æ”¹åŠ¨ï¼šæ‰©å±•ç±»åŠ è½½å™¨è¢«å¹³å°ç±»åŠ è½½å™¨ï¼ˆPlatform ClassLoaderï¼‰å–ä»£ã€‚å¹³å°ç±»åŠ è½½å™¨å’Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨éƒ½ä¸å†ç»§æ‰¿è‡ª java.net.URLClassLoaderï¼Œè€Œæ˜¯ç»§æ‰¿äº jdk.internal.loader.BuiltinClassLoaderã€‚å…·ä½“ç»†èŠ‚å¯ä»¥è‡ªè¡Œæœç´¢ã€‚

ç°åœ¨å›ç­”ä¸‹é—®é¢˜ï¼š
ç¬¬ä¸€ä¸ªé—®é¢˜ï¼š
instanceofè¿›è¡Œç±»å‹æ£€æŸ¥è§„åˆ™æ˜¯:ä½ æ˜¯è¯¥ç±»æˆ–è€…æ˜¯è¯¥ç±»çš„å­ç±»ï¼›
getClassè·å¾—ç±»å‹ä¿¡æ¯é‡‡ç”¨==æ¥è¿›è¡Œæ£€æŸ¥æ˜¯å¦ç›¸ç­‰çš„æ“ä½œæ˜¯ä¸¥æ ¼çš„åˆ¤æ–­ã€‚ä¸ä¼šå­˜åœ¨ç»§æ‰¿æ–¹é¢çš„è€ƒè™‘ï¼›

ç¬¬äºŒä¸ªé—®é¢˜ï¼š
HashSetæœ¬è´¨ä¸Šå°±æ˜¯HashMapçš„keyç»„æˆçš„ä¸é‡å¤çš„å…ƒç´ é›†åˆï¼Œcontainsæ–¹æ³•å…¶å®å°±æ˜¯æ ¹æ®hashcodeå’Œequalså»åˆ¤æ–­ç›¸ç­‰çš„
TreeSetæœ¬è´¨TreeMapçš„keyç»„æˆçš„ï¼Œæ•°æ®ç»“æ„æ˜¯çº¢é»‘æ ‘ï¼Œæ˜¯è‡ªå¸¦æ’åºåŠŸèƒ½çš„ï¼Œå¯ä»¥åœ¨æ”¾å…¥å…ƒç´ çš„æ—¶å€™æŒ‡å®šcomparatorï¼ˆæ¯”è¾ƒå™¨ï¼‰ï¼Œæˆ–è€…æ˜¯æ”¾å…¥çš„å…ƒç´ è¦å®ç°Comparableæ¥å£åå…ƒç´ è‡ªå·±å®ç°compareToæ–¹æ³•ï¼Œcontainsæ–¹æ³•æ˜¯æ ¹æ®æ¯”è¾ƒå™¨æˆ–è€…compareToå»åˆ¤æ–­ç›¸ç­‰</p>2020-03-26</li><br/><li><span>ğŸ‘½</span> ğŸ‘ï¼ˆ24ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>2 . HashSet åº•å†Œæ˜¯HashMapã€‚TreeSetåº•å±‚æ˜¯TreeMap
HashSetå°±æ˜¯ä½¿ç”¨HashMapè°ƒç”¨equalsï¼Œåˆ¤æ–­ä¸¤å¯¹è±¡çš„HashCodeæ˜¯å¦ç›¸ç­‰ã€‚
TreeSetå› ä¸ºæ˜¯ä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼Œåˆ™éœ€è¦è€ƒè™‘æ•°çš„å·¦å³ã€‚åˆ™éœ€è¦é€šè¿‡compareToè®¡ç®—æ­£è´Ÿå€¼ï¼Œçœ‹æœ€åèƒ½å¦æ‰¾åˆ°compareToä¸º0çš„å€¼ï¼Œæ‰¾åˆ°åˆ™è¿”å›trueã€‚

ç®€å•æ¥è¯´ï¼ŒTreeSetåº•å±‚ä½¿ç”¨compareToæ–¹æ³•æ¯”è¾ƒï¼ŒHashSetåº•å±‚ä½¿ç”¨hashå€¼æ¯”è¾ƒã€‚</p>2020-03-26</li><br/><li><span>Sun</span> ğŸ‘ï¼ˆ12ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆçš„è¯¾ç¨‹ï¼ŒçœŸçš„æ˜¯å¹²è´§ï¼Œæ¯å¤©å‡Œæ™¨æ›´æ–°å®Œçœ‹ä¸€éï¼Œæ—©ä¸Šä¸Šç­å‰åœ¨çœ‹ä¸€éï¼Œæ„Ÿå—éƒ½ä¸ä¸€æ ·ï¼ŒæœŸå¾…å‡ºæ›´å¤šå¹²è´§ï¼Œå…±åŒè¿›æ­¥</p>2020-03-26</li><br/><li><span>ä¸œæ–¹å¥‡éª¥</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>çœ‹åˆ°è¿™èŠ‚ï¼Œè¯´èµ·Lombokï¼Œè€å¸ˆè§‰å¾—Lombok é€‚åˆç”¨äºç”Ÿäº§ç¯å¢ƒå—ï¼Ÿä¹‹å‰ä¸€ç›´éƒ½æ˜¯è‡ªå·±ä¸šä½™ç»ƒä¹ ä½¿ç”¨ï¼Œä½†æ˜¯å·¥ä½œä¸­é¡¹ç›®éƒ½è¿˜æ˜¯æ²¡æœ‰ä½¿ç”¨ã€‚</p>2020-03-26</li><br/><li><span>pedro</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ4ï¼‰<p>1æ¥¼çš„å›ç­”å·²ç»è¶‹äºå®Œç¾ï¼Œæˆ‘ä¹Ÿç¿»äº†ä¸€ä¸‹ JDK æºç ï¼ŒHashSet çš„æœ¬è´¨æ˜¯ HashMapï¼Œä¼šé€šè¿‡ hash å‡½æ•°æ¥æ¯”è¾ƒå€¼ï¼ŒTreeSet çš„æœ¬è´¨æ˜¯ TreeMap ä¼šé€šè¿‡ compareTo æ¯”è¾ƒã€‚
è‡³äºç±»åŠ è½½å™¨çš„é—®é¢˜ï¼Œæˆ‘æƒ³è¿™ä¸ªä¸å¥½å¤ç°ï¼Œæœ‰æ²¡æœ‰æ¥¼ä¸‹çš„å°ä¼™ä¼´è¡¥å……ä¸€ä¸‹çš„ã€‚</p>2020-03-26</li><br/><li><span>é˜¿éƒ‘</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆçš„æ¯ä¸€ç¯‡æ–‡ç« éƒ½æ˜¯æ»¡æ»¡çš„å¹²è´§å‘€ï¼Œæ‰‹åŠ¨ç‚¹èµğŸ‘ğŸ‘ğŸ‘</p>2020-03-26</li><br/><li><span>James</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>æ¯ä¸€ä¸ªæ¡ˆä¾‹éƒ½æ˜¯ç‹¬ç«‹çš„SpringBootæˆ–Javaå‘½ä»¤è¡Œåº”ç”¨ç¨‹åºï¼Œå¯ä»¥å•ç‹¬å¯åŠ¨ï¼Œé¿å…ç›¸äº’å¹²æ‰°
è¯·é—®ä¸‹,ä¸ºå•¥æˆ‘å¯åŠ¨çš„æ˜¯ç‹¬ç«‹mainç±»ä¸ºå•¥è¿˜ä¼šå¯åŠ¨å…¶ä»–æ— å…³è¿™ä¸ªåŒ…çš„ç±».æ¯”å¦‚è¿æ¥redis</p>2020-07-11</li><br/><li><span>Huodefa_0426</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>è€å¸ˆï¼Œæ–‡ä¸­ä½ è¯´ï¼šåœ¨å¯åŠ¨ç¨‹åºæ—¶è®¾ç½® JVM å‚æ•° -XX:+PrintStringTableStatisticsï¼Œç¨‹åºé€€å‡ºæ—¶å¯ä»¥æ‰“å°å‡ºå­—ç¬¦ä¸²å¸¸é‡è¡¨çš„ç»Ÿè®¡ä¿¡æ¯ã€‚è°ƒç”¨æ¥å£åå…³é—­ç¨‹åºï¼Œè¾“å‡ºå¦‚ä¸‹ã€‚æˆ‘è®¾ç½®äº†å…³é—­ç¨‹åºæ€ä¹ˆæ²¡çœ‹è§è¾“å‡ºçš„ä¿¡æ¯ï¼Œæ˜¯è¾“å‡ºåœ¨æ§åˆ¶å°è¿˜æ˜¯åœ¨æ—¥å¿—æ–‡ä»¶ä¸­ï¼Ÿå¦‚æœæ˜¯æ–‡ä»¶ æ˜¯å“ªä¸ªæ–‡ä»¶ï¼Ÿ</p>2020-03-26</li><br/><li><span>yihang</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è¡¥å……ä¸€ç‚¹ï¼Œæµ®ç‚¹æ•°çš„==æ¯”è¾ƒä¹Ÿæœ‰å‘ï¼Œè·Ÿæµ®ç‚¹æ•°å°æ•°ç²¾åº¦æœ‰å…³</p>2020-03-28</li><br/><li><span>justin</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆæ‚¨å¥½ï¼Œå°±æ˜¯å…³äºè¿™ä¸ªä¾‹å­ï¼ŒåŠ äº†intern()ä¼šåœ¨å¸¸é‡æ± é©»ç•™ï¼Œå¯¼è‡´æ¯ä¸ªbucket sizeå˜å¾—å¾ˆå¤§ã€‚å¦‚æœæ²¡æœ‰åŠ intern()æ–¹æ³•çš„æ—¶å€™ï¼ŒAverage bucket sizeå°±å˜å¾—å¾ˆä½ï¼Œæµ‹è¯•çš„æ˜¯0.276ï¼Œè¿™ä¸ªå¸®å¿™è§£é‡Šä¸‹
@GetMapping(&quot;internperformance&quot;)
public int internperformance(@RequestParam(value = &quot;size&quot;, defaultValue = &quot;10000000&quot;)int size) {
    &#47;&#47;-XX:+PrintStringTableStatistics
    &#47;&#47;-XX:StringTableSize=10000000
    long begin = System.currentTimeMillis();
    list = IntStream.rangeClosed(1, size)
            .mapToObj(i-&gt; String.valueOf(i).intern())
            .collect(Collectors.toList());
    log.info(&quot;size:{} took:{}&quot;, size, System.currentTimeMillis() - begin);
    return list.size();
}
</p>2020-04-02</li><br/><li><span>ğŸ‘½</span> ğŸ‘ï¼ˆ9ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>é—®é¢˜1ï¼š
Father father = new Father();
    Son son = new Son();
    System.out.println(son.getClass()==father.getClass());
    System.out.println(son instanceof Father);
æ‰“å°ç»“æœ
false
true

åŒºåˆ«åœ¨æ­¤ï¼ŒgetClassæ›´åŠ ä¸¥æ ¼ï¼Œè€Œinstanceof  å­ç±»instanceof  çˆ¶ç±»ï¼Œä¹Ÿæ˜¯true</p>2020-03-26</li><br/><li><span>yihang</span> ğŸ‘ï¼ˆ7ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>å¦å¤–å¯¹äº intern ä¹Ÿæœ‰å®ƒçš„ç”¨æ­¦ä¹‹å¤„ï¼Œæ®è¯´ twitter ä½¿ç”¨å®ƒå‡å°‘é‡å¤åœ°å€ï¼ˆå­—ç¬¦ä¸²ï¼‰å¤§é‡èŠ‚çº¦äº†å†…å­˜</p>2020-03-28</li><br/><li><span>æèµ·æ¥</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>è€å¸ˆçš„è¯¾ç¨‹ç‰¹åˆ«å¥½</p>2020-08-05</li><br/><li><span>å¤±ç«çš„å¤å¤©</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>hashsetå’ŒtreeSetä»æ ¹æœ¬ä¸Šæ¥è¯´ï¼Œæ²¡ä»€ä¹ˆå…³ç³»ï¼Œåªæ˜¯æœ‰ä¸ªNä»£ä»¥å‰çš„ç¥–å®—äº†ï¼Œå“ˆå“ˆï¼Œä¸€ä¸ªç©hashï¼Œä¸€ä¸ªç©comparatorã€‚ä¸€ä¸ªåº•å±‚æ˜¯æ•£åˆ—è¡¨ï¼Œä¸€ä¸ªåº•å±‚æ˜¯çº¢é»‘æ ‘ã€‚</p>2020-03-28</li><br/><li><span>Geek_3b1096</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>ä¸Šç­å‰çœ‹ä¸€é+1</p>2020-03-27</li><br/>
</ul>