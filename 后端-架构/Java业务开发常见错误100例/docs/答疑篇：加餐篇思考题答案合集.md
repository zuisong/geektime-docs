ä½ å¥½ï¼Œæˆ‘æ˜¯æœ±æ™”ã€‚

ä»Šå¤©ï¼Œæˆ‘ä»¬ç»§ç»­ä¸€èµ·åˆ†æè¿™é—¨è¯¾çš„â€œä¸å®šæœŸåŠ é¤â€ç¯‡ä¸­5è®²çš„è¯¾åæ€è€ƒé¢˜ã€‚è¿™äº›é¢˜ç›®æ¶‰åŠäº†Java 8åŸºç¡€çŸ¥è¯†ã€å®šä½å’Œåˆ†æåº”ç”¨é—®é¢˜ç›¸å…³çš„å‡ å¤§çŸ¥è¯†ç‚¹ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä¸€ä¸€å…·ä½“åˆ†æå§ã€‚

### [åŠ é¤1 | å¸¦ä½ åƒé€è¯¾ç¨‹ä¸­Java 8çš„é‚£äº›é‡è¦çŸ¥è¯†ç‚¹ï¼ˆä¸€ï¼‰](https://time.geekbang.org/column/article/212374)

**é—®é¢˜ï¼š**å¯¹äºå¹¶è¡Œæµéƒ¨åˆ†çš„å¹¶è¡Œæ¶ˆè´¹å¤„ç†1åˆ°100çš„ä¾‹å­ï¼Œå¦‚æœæŠŠforEachæ›¿æ¢ä¸ºforEachOrderedï¼Œä½ è§‰å¾—ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ

ç­”ï¼šforEachOrdered ä¼šè®©parallelStreamä¸§å¤±éƒ¨åˆ†çš„å¹¶è¡Œèƒ½åŠ›ï¼Œä¸»è¦åŸå› æ˜¯forEachéå†çš„é€»è¾‘æ— æ³•å¹¶è¡Œèµ·æ¥ï¼ˆéœ€è¦æŒ‰ç…§å¾ªåºéå†ï¼Œæ— æ³•å¹¶è¡Œï¼‰ã€‚

æˆ‘ä»¬æ¥æ¯”è¾ƒä¸‹é¢çš„ä¸‰ç§å†™æ³•ï¼š

```
//æ¨¡æ‹Ÿæ¶ˆæ¯æ•°æ®éœ€è¦1ç§’æ—¶é—´
private static void consume(int i) {
    try {
        TimeUnit.SECONDS.sleep(1);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
    System.out.print(i);
}
//æ¨¡æ‹Ÿè¿‡æ»¤æ•°æ®éœ€è¦1ç§’æ—¶é—´
private static boolean filter(int i) {
    try {
        TimeUnit.SECONDS.sleep(1);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
    return i % 2 == 0;
}
@Test
public void test() {
    System.setProperty("java.util.concurrent.ForkJoinPool.common.parallelism", String.valueOf(10));

    StopWatch stopWatch = new StopWatch();
    stopWatch.start("stream");
    stream();
    stopWatch.stop();
    stopWatch.start("parallelStream");
    parallelStream();
    stopWatch.stop();
    stopWatch.start("parallelStreamForEachOrdered");
    parallelStreamForEachOrdered();
    stopWatch.stop();
    System.out.println(stopWatch.prettyPrint());
}
//filtreå’ŒforEachä¸²è¡Œ
private void stream() {
    IntStream.rangeClosed(1, 10)
            .filter(ForEachOrderedTest::filter)
            .forEach(ForEachOrderedTest::consume);
}
//filterå’ŒforEachå¹¶è¡Œ
private void parallelStream() {
    IntStream.rangeClosed(1, 10).parallel()
            .filter(ForEachOrderedTest::filter)
            .forEach(ForEachOrderedTest::consume);
}
//filterå¹¶è¡Œè€ŒforEachä¸²è¡Œ
private void parallelStreamForEachOrdered() {
    IntStream.rangeClosed(1, 10).parallel()
            .filter(ForEachOrderedTest::filter)
            .forEachOrdered(ForEachOrderedTest::consume);
}
```

å¾—åˆ°è¾“å‡ºï¼š

```
---------------------------------------------
ns         %     Task name
---------------------------------------------
15119607359  065%  stream
2011398298  009%  parallelStream
6033800802  026%  parallelStreamForEachOrdered
```

ä»è¾“å‡ºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š

- streamæ–¹æ³•çš„è¿‡æ»¤å’Œéå†å…¨éƒ¨ä¸²è¡Œæ‰§è¡Œï¼Œæ€»æ—¶é—´æ˜¯10ç§’+5ç§’=15ç§’ï¼›
- parallelStreamæ–¹æ³•çš„è¿‡æ»¤å’Œéå†å…¨éƒ¨å¹¶è¡Œæ‰§è¡Œï¼Œæ€»æ—¶é—´æ˜¯1ç§’+1ç§’=2ç§’ï¼›
- parallelStreamForEachOrderedæ–¹æ³•çš„è¿‡æ»¤å¹¶è¡Œæ‰§è¡Œï¼Œéå†ä¸²è¡Œæ‰§è¡Œï¼Œæ€»æ—¶é—´æ˜¯1ç§’+5ç§’=6ç§’ã€‚

### [åŠ é¤2 | å¸¦ä½ åƒé€è¯¾ç¨‹ä¸­Java 8çš„é‚£äº›é‡è¦çŸ¥è¯†ç‚¹ï¼ˆäºŒï¼‰](https://time.geekbang.org/column/article/212398)

**é—®é¢˜1ï¼š**ä½¿ç”¨Streamå¯ä»¥éå¸¸æ–¹ä¾¿åœ°å¯¹Liståšå„ç§æ“ä½œï¼Œé‚£æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥å®ç°åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­è§‚å¯Ÿæ•°æ®å˜åŒ–å‘¢ï¼Ÿæ¯”å¦‚ï¼Œæˆ‘ä»¬è¿›è¡Œfilter+mapæ“ä½œï¼Œå¦‚ä½•è§‚å¯Ÿfilteråmapçš„åŸå§‹æ•°æ®å‘¢ï¼Ÿ

ç­”ï¼šè¦æƒ³è§‚å¯Ÿä½¿ç”¨Streamå¯¹Listçš„å„ç§æ“ä½œçš„è¿‡ç¨‹ä¸­çš„æ•°æ®å˜åŒ–ï¼Œä¸»è¦æœ‰ä¸‹é¢ä¸¤ä¸ªåŠæ³•ã€‚

ç¬¬ä¸€ï¼Œ**ä½¿ç”¨peekæ–¹æ³•**ã€‚æ¯”å¦‚å¦‚ä¸‹ä»£ç ï¼Œæˆ‘ä»¬å¯¹æ•°å­—1~10è¿›è¡Œäº†ä¸¤æ¬¡è¿‡æ»¤ï¼Œåˆ†åˆ«æ˜¯æ‰¾å‡ºå¤§äº5çš„æ•°å­—å’Œæ‰¾å‡ºå¶æ•°ï¼Œæˆ‘ä»¬é€šè¿‡peekæ–¹æ³•æŠŠä¸¤æ¬¡è¿‡æ»¤æ“ä½œä¹‹å‰çš„åŸå§‹æ•°æ®ä¿å­˜äº†ä¸‹æ¥ï¼š

```
List<Integer> firstPeek = new ArrayList<>();
List<Integer> secondPeek = new ArrayList<>();
List<Integer> result = IntStream.rangeClosed(1, 10)
        .boxed()
        .peek(i -> firstPeek.add(i))
        .filter(i -> i > 5)
        .peek(i -> secondPeek.add(i))
        .filter(i -> i % 2 == 0)
        .collect(Collectors.toList());
System.out.println("firstPeekï¼š" + firstPeek);
System.out.println("secondPeekï¼š" + secondPeek);
System.out.println("resultï¼š" + result);
```

æœ€åå¾—åˆ°è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°ç¬¬ä¸€æ¬¡è¿‡æ»¤ä¹‹å‰æ˜¯æ•°å­—1~10ï¼Œä¸€æ¬¡è¿‡æ»¤åå˜ä¸º6~10ï¼Œæœ€ç»ˆè¾“å‡º6ã€8ã€10ä¸‰ä¸ªæ•°å­—ï¼š

```
firstPeekï¼š[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
secondPeekï¼š[6, 7, 8, 9, 10]
resultï¼š[6, 8, 10]
```

ç¬¬äºŒï¼Œ**å€ŸåŠ©IDEAçš„Streamçš„è°ƒè¯•åŠŸèƒ½**ã€‚è¯¦è§[è¿™é‡Œ](https://www.jetbrains.com/help/idea/analyze-java-stream-operations.html)ï¼Œæ•ˆæœç±»ä¼¼ä¸‹å›¾ï¼š

![](https://static001.geekbang.org/resource/image/3e/5e/3ee49c0589286bba37dd66032530d65e.png?wh=3261%2A1649)

**é—®é¢˜2ï¼š**Collectorsç±»æä¾›äº†å¾ˆå¤šç°æˆçš„æ”¶é›†å™¨ï¼Œé‚£æˆ‘ä»¬æœ‰æ²¡æœ‰åŠæ³•å®ç°è‡ªå®šä¹‰çš„æ”¶é›†å™¨å‘¢ï¼Ÿæ¯”å¦‚ï¼Œå®ç°ä¸€ä¸ªMostPopularCollectorï¼Œæ¥å¾—åˆ°Listä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„å…ƒç´ ï¼Œæ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼š

```
assertThat(Stream.of(1, 1, 2, 2, 2, 3, 4, 5, 5).collect(new MostPopularCollector<>()).get(), is(2));
assertThat(Stream.of('a', 'b', 'c', 'c', 'c', 'd').collect(new MostPopularCollector<>()).get(), is('c'));
```

ç­”ï¼šæˆ‘æ¥è¯´ä¸‹æˆ‘çš„å®ç°æ€è·¯å’Œæ–¹å¼ï¼šé€šè¿‡ä¸€ä¸ªHashMapæ¥ä¿å­˜å…ƒç´ çš„å‡ºç°æ¬¡æ•°ï¼Œæœ€ååœ¨æ”¶é›†çš„æ—¶å€™æ‰¾å‡ºMapä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„å…ƒç´ ï¼š

```
public class MostPopularCollector<T> implements Collector<T, Map<T, Integer>, Optional<T>> {
    //ä½¿ç”¨HashMapä¿å­˜ä¸­é—´æ•°æ®
    @Override
    public Supplier<Map<T, Integer>> supplier() {
        return HashMap::new;
    }
    //æ¯æ¬¡ç´¯ç§¯æ•°æ®åˆ™ç´¯åŠ Value
    @Override
    public BiConsumer<Map<T, Integer>, T> accumulator() {
        return (acc, elem) -> acc.merge(elem, 1, (old, value) -> old + value);
    }
    //åˆå¹¶å¤šä¸ªMapå°±æ˜¯åˆå¹¶å…¶Value
    @Override
    public BinaryOperator<Map<T, Integer>> combiner() {
        return (a, b) -> Stream.concat(a.entrySet().stream(), b.entrySet().stream())
                .collect(Collectors.groupingBy(Map.Entry::getKey, summingInt(Map.Entry::getValue)));
    }
    //æ‰¾å‡ºMapä¸­Valueæœ€å¤§çš„Key
    @Override
    public Function<Map<T, Integer>, Optional<T>> finisher() {
        return (acc) -> acc.entrySet().stream()
                .reduce(BinaryOperator.maxBy(Map.Entry.comparingByValue()))
                .map(Map.Entry::getKey);
    }

    @Override
    public Set<Characteristics> characteristics() {
        return Collections.emptySet();
    }
}
```

### [åŠ é¤3 | å®šä½åº”ç”¨é—®é¢˜ï¼Œæ’é”™å¥—è·¯å¾ˆé‡è¦](https://time.geekbang.org/column/article/221982)

**é—®é¢˜ï¼š**å¦‚æœä½ ç°åœ¨æ‰“å¼€ä¸€ä¸ªAppåå‘ç°é¦–é¡µå±•ç¤ºäº†ä¸€ç‰‡ç©ºç™½ï¼Œé‚£è¿™åˆ°åº•æ˜¯å®¢æˆ·ç«¯å…¼å®¹æ€§çš„é—®é¢˜ï¼Œè¿˜æ˜¯æœåŠ¡ç«¯çš„é—®é¢˜å‘¢ï¼Ÿå¦‚æœæ˜¯æœåŠ¡ç«¯çš„é—®é¢˜ï¼Œåˆå¦‚ä½•è¿›ä¸€æ­¥ç»†åŒ–å®šä½å‘¢ï¼Ÿä½ æœ‰ä»€ä¹ˆåˆ†ææ€è·¯å—ï¼Ÿ

ç­”ï¼šé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åŒºåˆ†å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡ç«¯é”™è¯¯ã€‚æˆ‘ä»¬å¯ä»¥å…ˆä»å®¢æˆ·ç«¯ä¸‹æ‰‹ï¼Œæ’æŸ¥çœ‹çœ‹æ˜¯å¦æ˜¯æœåŠ¡ç«¯é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡æŠ“åŒ…æ¥çœ‹æœåŠ¡ç«¯çš„è¿”å›ï¼ˆä¸€èˆ¬è€Œè¨€å®¢æˆ·ç«¯å‘å¸ƒä¹‹å‰ä¼šç»è¿‡æµ‹è¯•ï¼Œè€Œä¸”æ— æ³•éšæ—¶å˜æ›´ï¼Œæ‰€ä»¥æœåŠ¡ç«¯å‡ºé”™çš„å¯èƒ½æ€§ä¼šæ›´å¤§ä¸€ç‚¹ï¼‰ã€‚å› ä¸ºä¸€ä¸ªå®¢æˆ·ç«¯ç¨‹åºå¯èƒ½å¯¹åº”å‡ ç™¾ä¸ªæœåŠ¡ç«¯æ¥å£ï¼Œå…ˆä»å®¢æˆ·ç«¯ï¼ˆå‘å‡ºè¯·æ±‚çš„æ ¹æºï¼‰å¼€å§‹æ’æŸ¥é—®é¢˜ï¼Œæ›´å®¹æ˜“æ‰¾åˆ°æ–¹å‘ã€‚

æœåŠ¡ç«¯æ²¡æœ‰è¿”å›æ­£ç¡®çš„è¾“å‡ºï¼Œé‚£ä¹ˆå°±éœ€è¦ç»§ç»­æ’æŸ¥æœåŠ¡ç«¯æ¥å£æˆ–æ˜¯ä¸Šå±‚çš„è´Ÿè½½å‡è¡¡äº†ï¼Œæ’æŸ¥æ–¹å¼ä¸ºï¼š

- æŸ¥çœ‹è´Ÿè½½å‡è¡¡ï¼ˆæ¯”å¦‚Nginxï¼‰çš„æ—¥å¿—ï¼›
- æŸ¥çœ‹æœåŠ¡ç«¯æ—¥å¿—ï¼›
- æŸ¥çœ‹æœåŠ¡ç«¯ç›‘æ§ã€‚

å¦‚æœæœåŠ¡ç«¯è¿”å›äº†æ­£ç¡®çš„è¾“å‡ºï¼Œé‚£ä¹ˆè¦ä¹ˆæ˜¯ç”±äºå®¢æˆ·ç«¯çš„Bugï¼Œè¦ä¹ˆå°±æ˜¯å¤–éƒ¨é…ç½®ç­‰é—®é¢˜äº†ï¼Œæ’æŸ¥æ–¹å¼ä¸ºï¼š

- æŸ¥çœ‹å®¢æˆ·ç«¯æŠ¥é”™ï¼ˆä¸€èˆ¬è€Œè¨€ï¼Œå®¢æˆ·ç«¯éƒ½ä¼šå¯¹æ¥SAASçš„å¼‚å¸¸æœåŠ¡ï¼‰ï¼›
- ç›´æ¥æœ¬åœ°å¯åŠ¨å®¢æˆ·ç«¯è°ƒè¯•ã€‚

### [åŠ é¤4 | åˆ†æå®šä½Javaé—®é¢˜ï¼Œä¸€å®šè¦ç”¨å¥½è¿™äº›å·¥å…·ï¼ˆä¸€ï¼‰](https://time.geekbang.org/column/article/224816)

**é—®é¢˜1ï¼š**JDKä¸­è¿˜æœ‰ä¸€ä¸ªjmapå·¥å…·ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨jmap -dumpå‘½ä»¤æ¥è¿›è¡Œå †è½¬å‚¨ã€‚é‚£ä¹ˆï¼Œè¿™æ¡å‘½ä»¤å’Œjmap -dump:liveæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿä½ èƒ½å¦è®¾è®¡ä¸€ä¸ªå®éªŒï¼Œæ¥è¯æ˜ä¸‹å®ƒä»¬çš„åŒºåˆ«å‘¢ï¼Ÿ

ç­”ï¼šjmap -dumpå‘½ä»¤æ˜¯è½¬å‚¨å †ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œè€Œjmap -dump:liveæ˜¯è½¬å‚¨å †ä¸­æ‰€æœ‰æ´»ç€çš„å¯¹è±¡ã€‚å› ä¸ºï¼Œjmap -dump:liveä¼šè§¦å‘ä¸€æ¬¡FullGCã€‚

å†™ä¸€ä¸ªç¨‹åºæµ‹è¯•ä¸€ä¸‹ï¼š

```
@SpringBootApplication
@Slf4j
public class JMapApplication implements CommandLineRunner {

    //-Xmx512m -Xms512m
    public static void main(String[] args) {
        SpringApplication.run(JMapApplication.class, args);
    }
    @Override
    public void run(String... args) throws Exception {
        while (true) {
            //æ¨¡æ‹Ÿäº§ç”Ÿå­—ç¬¦ä¸²ï¼Œæ¯æ¬¡å¾ªç¯åè¿™ä¸ªå­—ç¬¦ä¸²å°±ä¼šå¤±å»å¼•ç”¨å¯ä»¥GC
            String payload = IntStream.rangeClosed(1, 1000000)
                    .mapToObj(__ -> "a")
                    .collect(Collectors.joining("")) + UUID.randomUUID().toString();
            log.debug(payload);
            TimeUnit.MILLISECONDS.sleep(1);
        }
    }
}
```

ç„¶åï¼Œä½¿ç”¨jmapä¸å¸¦å’Œå¸¦liveåˆ†åˆ«ç”Ÿæˆä¸¤ä¸ªè½¬å‚¨ï¼š

```
jmap -dump:format=b,file=nolive.hprof 57323
jmap -dump:live,format=b,file=live.hprof 5732
```

å¯ä»¥çœ‹åˆ°ï¼Œnoliveè¿™ä¸ªè½¬å‚¨çš„ä¸å¯åˆ°è¾¾å¯¹è±¡åŒ…å«äº†164MB char\[]ï¼ˆå¯ä»¥è®¤ä¸ºåŸºæœ¬æ˜¯å­—ç¬¦ä¸²ï¼‰ï¼š

![](https://static001.geekbang.org/resource/image/8e/9b/8e4f3eea80edfe6d867cab754967589b.png?wh=1330%2A540)

è€Œliveè¿™ä¸ªè½¬å‚¨åªæœ‰1.3MBçš„char\[]ï¼Œè¯´æ˜ç¨‹åºå¾ªç¯ä¸­çš„è¿™äº›å­—ç¬¦ä¸²éƒ½è¢«GCäº†ï¼š

![](https://static001.geekbang.org/resource/image/18/87/18403a0b683c3b726700d5624f968287.png?wh=1242%2A510)

**é—®é¢˜2ï¼š**ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œå®¢æˆ·ç«¯æ˜¯å¦‚ä½•å’ŒMySQLè¿›è¡Œè®¤è¯çš„å‘¢ï¼Ÿä½ èƒ½å¦å¯¹ç…§[MySQLçš„æ–‡æ¡£](https://dev.mysql.com/doc/internals/en/connection-phase-packets.html#packet-Protocol::Handshake)ï¼Œä½¿ç”¨Wiresharkè§‚å¯Ÿåˆ†æè¿™ä¸€è¿‡ç¨‹å‘¢ï¼Ÿ

ç­”ï¼šä¸€èˆ¬è€Œè¨€ï¼Œè®¤è¯ï¼ˆæ¡æ‰‹ï¼‰è¿‡ç¨‹åˆ†ä¸ºä¸‰æ­¥ã€‚

é¦–å…ˆï¼ŒæœåŠ¡ç«¯ç»™å®¢æˆ·ç«¯ä¸»åŠ¨å‘é€æ¡æ‰‹æ¶ˆæ¯ï¼š

![](https://static001.geekbang.org/resource/image/29/b2/29f5e4a9056b7b6aeb9d9ac2yy5e97b2.png?wh=2642%2A1820)

Wiresharkå·²ç»æŠŠæ¶ˆæ¯çš„å­—æ®µåšäº†è§£æï¼Œä½ å¯ä»¥å¯¹æ¯”[å®˜æ–¹æ–‡æ¡£](https://dev.mysql.com/doc/internals/en/connection-phase-packets.html#packet-Protocol::Handshake)çš„åè®®æ ¼å¼ä¸€èµ·æŸ¥çœ‹ã€‚HandshakeV10æ¶ˆæ¯ä½“çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯æ¶ˆæ¯ç‰ˆæœ¬0aï¼Œè§å›¾ä¸­çº¢è‰²æ¡†æ ‡æ³¨çš„éƒ¨åˆ†ã€‚å‰é¢å››ä¸ªå­—èŠ‚æ˜¯MySQLçš„æ¶ˆæ¯å¤´ï¼Œå…¶ä¸­å‰ä¸‰ä¸ªå­—èŠ‚æ˜¯æ¶ˆæ¯ä½“é•¿åº¦ï¼ˆ16è¿›åˆ¶4a=74å­—èŠ‚ï¼‰ï¼Œæœ€åä¸€ä¸ªå­—èŠ‚æ˜¯æ¶ˆæ¯åºåˆ—å·ã€‚

ç„¶åï¼Œå®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯å›å¤çš„HandshakeResponse41æ¶ˆæ¯ä½“ï¼ŒåŒ…å«äº†ç™»å½•çš„ç”¨æˆ·åå’Œå¯†ç ï¼š

![](https://static001.geekbang.org/resource/image/a0/96/a0b37df4f3e92f7e8602409a7ca0f696.png?wh=2905%2A1811)

å¯ä»¥çœ‹åˆ°ï¼Œç”¨æˆ·åæ˜¯string\[NUL]ç±»å‹çš„ï¼Œè¯´æ˜å­—ç¬¦ä¸²ä»¥00ç»“å°¾ä»£è¡¨å­—ç¬¦ä¸²ç»“æŸã€‚å…³äºMySQLåè®®ä¸­çš„å­—æ®µç±»å‹ï¼Œä½ å¯ä»¥å‚è€ƒ[è¿™é‡Œ](https://dev.mysql.com/doc/internals/en/string.html)ã€‚

æœ€åï¼ŒæœåŠ¡ç«¯å›å¤çš„OKæ¶ˆæ¯ï¼Œä»£è¡¨æ¡æ‰‹æˆåŠŸï¼š

![](https://static001.geekbang.org/resource/image/d7/e7/d746f34df74cfedb4d294db1e2b771e7.png?wh=2940%2A1772)

è¿™æ ·åˆ†æä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ä½¿ç”¨Wiresharkè§‚å¯Ÿå®¢æˆ·ç«¯å’ŒMySQLçš„è®¤è¯è¿‡ç¨‹ï¼Œéå¸¸æ–¹ä¾¿ã€‚è€Œå¦‚æœä¸å€ŸåŠ©Wiresharkå·¥å…·ï¼Œæˆ‘ä»¬åªèƒ½ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚åœ°å¯¹ç…§åè®®æ–‡æ¡£åˆ†æå†…å®¹ã€‚

å…¶å®ï¼Œå„ç§CSç³»ç»Ÿå®šä¹‰çš„é€šè®¯åè®®æœ¬èº«å¹¶ä¸æ·±å¥¥ï¼Œç”šè‡³å¯ä»¥è¯´å¯¹ç€åè®®æ–‡æ¡£å†™é€šè®¯å®¢æˆ·ç«¯æ˜¯ä½“åŠ›æ´»ã€‚ä½ å¯ä»¥ç»§ç»­æŒ‰ç…§è¿™é‡Œæˆ‘è¯´çš„æ–¹å¼ï¼Œç»“åˆæŠ“åŒ…å’Œæ–‡æ¡£ï¼Œåˆ†æä¸€ä¸‹MySQLçš„æŸ¥è¯¢åè®®ã€‚

### [åŠ é¤5 | åˆ†æå®šä½Javaé—®é¢˜ï¼Œä¸€å®šè¦ç”¨å¥½è¿™äº›å·¥å…·ï¼ˆäºŒï¼‰](https://time.geekbang.org/column/article/230534)

**é—®é¢˜ï¼š**Arthasè¿˜æœ‰ä¸€ä¸ªå¼ºå¤§çš„çƒ­ä¿®å¤åŠŸèƒ½ã€‚æ¯”å¦‚ï¼Œé‡åˆ°é«˜CPUé—®é¢˜æ—¶ï¼Œæˆ‘ä»¬å®šä½å‡ºæ˜¯ç®¡ç†å‘˜ç”¨æˆ·ä¼šæ‰§è¡Œå¾ˆå¤šæ¬¡MD5ï¼Œæ¶ˆè€—å¤§é‡CPUèµ„æºã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šè¿›è¡Œçƒ­ä¿®å¤ï¼Œæ­¥éª¤æ˜¯ï¼šjadå‘½ä»¤åç¼–è¯‘ä»£ç -&gt;ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆæ¯”å¦‚Vimï¼‰ç›´æ¥ä¿®æ”¹ä»£ç -&gt;ä½¿ç”¨scå‘½ä»¤æŸ¥æ‰¾ä»£ç æ‰€åœ¨ç±»çš„ClassLoader-&gt;ä½¿ç”¨redefineå‘½ä»¤çƒ­æ›´æ–°ä»£ç ã€‚ä½ å¯ä»¥å°è¯•ä½¿ç”¨è¿™ä¸ªæµç¨‹ï¼Œç›´æ¥ä¿®å¤ç¨‹åºï¼ˆæ³¨é‡ŠdoTaskæ–¹æ³•ä¸­çš„ç›¸å…³ä»£ç ï¼‰å—ï¼Ÿ

ç­”ï¼šArthasçš„å®˜æ–¹æ–‡æ¡£æœ‰[è¯¦ç»†çš„æ“ä½œæ­¥éª¤](https://alibaba.github.io/arthas/redefine.html)ï¼Œå®ç°jad-&gt;sc-&gt;redefineçš„æ•´ä¸ªæµç¨‹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼š

- redefineå‘½ä»¤å’Œjad/watch/trace/monitor/ttç­‰å‘½ä»¤ä¼šå†²çªã€‚æ‰§è¡Œå®Œredefineä¹‹åï¼Œå¦‚æœå†æ‰§è¡Œä¸Šé¢æåˆ°çš„å‘½ä»¤ï¼Œåˆ™ä¼šæŠŠredefineçš„å­—èŠ‚ç é‡ç½®ã€‚ åŸå› æ˜¯ï¼ŒJDKæœ¬èº«redefineå’ŒRetransformæ˜¯ä¸åŒçš„æœºåˆ¶ï¼ŒåŒæ—¶ä½¿ç”¨ä¸¤ç§æœºåˆ¶æ¥æ›´æ–°å­—èŠ‚ç ï¼Œåªæœ‰æœ€åçš„ä¿®æ”¹ä¼šç”Ÿæ•ˆã€‚
- ä½¿ç”¨redefineä¸å…è®¸æ–°å¢æˆ–è€…åˆ é™¤field/methodï¼Œå¹¶ä¸”è¿è¡Œä¸­çš„æ–¹æ³•ä¸ä¼šç«‹å³ç”Ÿæ•ˆï¼Œéœ€è¦ç­‰ä¸‹æ¬¡è¿è¡Œæ‰èƒ½ç”Ÿæ•ˆã€‚

ä»¥ä¸Šï¼Œå°±æ˜¯å’±ä»¬è¿™é—¨è¯¾é‡Œé¢5ç¯‡åŠ é¤æ–‡ç« çš„æ€è€ƒé¢˜ç­”æ¡ˆäº†ã€‚è‡³æ­¤ï¼Œå’±ä»¬è¿™ä¸ªè¯¾ç¨‹çš„â€œç­”ç–‘ç¯‡â€æ¨¡å—ä¹Ÿå°±ç»“æŸäº†ã€‚

å…³äºè¿™äº›é¢˜ç›®ï¼Œä»¥åŠèƒŒåæ¶‰åŠçš„çŸ¥è¯†ç‚¹ï¼Œå¦‚æœä½ è¿˜æœ‰å“ªé‡Œæ„Ÿè§‰ä¸æ¸…æ¥šçš„ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºä¸æˆ‘ç•™è¨€ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠä»Šå¤©çš„å†…å®¹åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–åŒäº‹ï¼Œä¸€èµ·äº¤æµã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ1ï¼‰</strong></div><ul>
<li><span>å¾€äº‹éšé£ï¼Œé¡ºå…¶è‡ªç„¶</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>windowså¹³å°ä¸‹jmapä½¿ç”¨æ–¹ä¾¿ï¼Ÿæ‰§è¡Œä¸Šé¢æ¡ˆä¾‹</p>2020-08-29</li><br/>
</ul>