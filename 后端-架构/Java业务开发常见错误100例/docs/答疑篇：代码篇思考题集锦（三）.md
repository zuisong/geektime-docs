ä½ å¥½ï¼Œæˆ‘æ˜¯æœ±æ™”ã€‚

ä»Šå¤©ï¼Œæˆ‘ä»¬ç»§ç»­ä¸€èµ·åˆ†æè¿™é—¨è¯¾ç¬¬13~20è®²çš„è¯¾åæ€è€ƒé¢˜ã€‚è¿™äº›é¢˜ç›®æ¶‰åŠäº†æ—¥å¿—ã€æ–‡ä»¶IOã€åºåˆ—åŒ–ã€Java 8æ—¥æœŸæ—¶é—´ç±»ã€OOMã€Javaé«˜çº§ç‰¹æ€§ï¼ˆåå°„ã€æ³¨è§£å’Œæ³›å‹ï¼‰å’ŒSpringæ¡†æ¶çš„16é“é—®é¢˜ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä¸€ä¸€å…·ä½“åˆ†æå§ã€‚

### [13 | æ—¥å¿—ï¼šæ—¥å¿—è®°å½•çœŸæ²¡ä½ æƒ³è±¡çš„é‚£ä¹ˆç®€å•](https://time.geekbang.org/column/article/220307)

**é—®é¢˜1ï¼š**åœ¨è®²â€œä¸ºä»€ä¹ˆæˆ‘çš„æ—¥å¿—ä¼šé‡å¤è®°å½•ï¼Ÿâ€çš„æ¡ˆä¾‹æ—¶ï¼Œæˆ‘ä»¬æŠŠINFOçº§åˆ«çš„æ—¥å¿—å­˜æ”¾åˆ°\_info.logä¸­ï¼ŒæŠŠWARNå’ŒERRORçº§åˆ«çš„æ—¥å¿—å­˜æ”¾åˆ°\_error.logä¸­ã€‚å¦‚æœç°åœ¨è¦æŠŠINFOå’ŒWARNçº§åˆ«çš„æ—¥å¿—å­˜æ”¾åˆ°\_info.logä¸­ï¼ŒæŠŠERRORæ—¥å¿—å­˜æ”¾åˆ°\_error.logä¸­ï¼Œåº”è¯¥å¦‚ä½•é…ç½®Logbackå‘¢ï¼Ÿ

ç­”ï¼šè¦å®ç°è¿™ä¸ªé…ç½®æœ‰ä¸¤ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ï¼šç›´æ¥ä½¿ç”¨EvaluatorFilterå’Œè‡ªå®šä¹‰ä¸€ä¸ªFilterã€‚æˆ‘ä»¬åˆ†åˆ«çœ‹ä¸€ä¸‹ã€‚

ç¬¬ä¸€ç§æ–¹å¼æ˜¯ï¼Œç›´æ¥ä½¿ç”¨logbackè‡ªå¸¦çš„EvaluatorFilterï¼š

```
<filter class="ch.qos.logback.core.filter.EvaluatorFilter">
    <evaluator class="ch.qos.logback.classic.boolex.GEventEvaluator">
        <expression>
            e.level.toInt() == WARN.toInt() || e.level.toInt() == INFO.toInt()
        </expression>
    </evaluator>
    <OnMismatch>DENY</OnMismatch>
    <OnMatch>NEUTRAL</OnMatch>
</filter>
```

ç¬¬äºŒç§æ–¹å¼æ˜¯ï¼Œè‡ªå®šä¹‰ä¸€ä¸ªFilterï¼Œå®ç°è§£æé…ç½®ä¸­çš„â€œ|â€å­—ç¬¦åˆ†å‰²çš„å¤šä¸ªLevelï¼š

```
public class MultipleLevelsFilter extends Filter<ILoggingEvent> {

    @Getter
    @Setter
    private String levels;
    private List<Integer> levelList;

    @Override
    public FilterReply decide(ILoggingEvent event) {

        if (levelList == null && !StringUtils.isEmpty(levels)) {
            //æŠŠç”±|åˆ†å‰²çš„å¤šä¸ªLevelè½¬æ¢ä¸ºList<Integer>
            levelList = Arrays.asList(levels.split("\\|")).stream()
                    .map(item -> Level.valueOf(item))
                    .map(level -> level.toInt())
                    .collect(Collectors.toList());
        }
        //å¦‚æœlevelListåŒ…å«å½“å‰æ—¥å¿—çš„çº§åˆ«ï¼Œåˆ™æ¥æ”¶å¦åˆ™æ‹’ç»
        if (levelList.contains(event.getLevel().toInt()))
            return FilterReply.ACCEPT;
        else
            return FilterReply.DENY;
    }
}
```

ç„¶åï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨è¿™ä¸ªMultipleLevelsFilterå°±å¯ä»¥äº†ï¼ˆå®Œæ•´çš„é…ç½®ä»£ç å‚è€ƒ[è¿™é‡Œ](https://github.com/JosephZhu1983/java-common-mistakes/blob/master/src/main/java/org/geekbang/time/commonmistakes/logging/duplicate/multiplelevelsfilter.xml)ï¼‰ï¼š
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ4ï¼‰</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/1d/08/fd/be34dd79.jpg" width="30px"><span>å°±æ˜¯è¿™æ ·</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>ç‰¹åˆ«èµï¼Œå—ç›Šè‰¯å¤š</div>2020-07-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/56/ea/32608c44.jpg" width="30px"><span>giteebravo</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>
åœ¨ä½¿ç”¨ @Autowired æ—¶ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ä¼šä½¿ç”¨ required = false å…è®¸æ³¨å…¥ null å‘¢ï¼Ÿ</div>2021-07-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1f/7e/5a/da39f489.jpg" width="30px"><span>Ethan New</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>èµèµèµ</div>2023-01-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/80/45/d719f7df.jpg" width="30px"><span>æå’Œæ¡ƒ</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>èµ</div>2021-02-18</li><br/>
</ul>