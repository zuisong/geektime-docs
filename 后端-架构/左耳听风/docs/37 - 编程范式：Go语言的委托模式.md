ä½ å¥½ï¼Œæˆ‘æ˜¯é™ˆçš“ï¼Œç½‘åå·¦è€³æœµè€—å­ã€‚

æˆ‘ä»¬å†æ¥çœ‹Goè¯­è¨€è¿™ä¸ªæ¨¡å¼ï¼ŒGoè¯­è¨€çš„è¿™ä¸ªæ¨¡å¼æŒºå¥½ç©å„¿çš„ã€‚å£°æ˜ä¸€ä¸ªstructï¼Œè·ŸCå¾ˆä¸€æ ·ï¼Œç„¶åç›´æ¥æŠŠè¿™ä¸ªstructç±»å‹æ”¾åˆ°å¦ä¸€ä¸ªstructé‡Œã€‚

# å§”æ‰˜çš„ç®€å•ç¤ºä¾‹

æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªç¤ºä¾‹ï¼š

```
type Widget struct {
    X, Y int
}

type Label struct {
    Widget        // Embedding (delegation)
    Text   string // Aggregation
    X int         // Override 
}

func (label Label) Paint() {
	// [0xc4200141e0] - Label.Paint("State")
    fmt.Printf("[%p] - Label.Paint(%q)\n", 
    	&label, label.Text)
}
```

ç”±ä¸Šé¢å¯çŸ¥ï¼š

- æˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ª `Widget`ï¼Œå…¶æœ‰ `X`å’Œ`Y`ï¼›
- ç„¶åç”¨å®ƒæ¥å£°æ˜ä¸€ä¸ª `Label`ï¼Œç›´æ¥æŠŠ `Widget` å§”æ‰˜è¿›å»ï¼›
- ç„¶åå†ç»™ `Label` å£°æ˜å¹¶å®ç°äº†ä¸€ä¸ª `Paint()` æ–¹æ³•ã€‚

äºæ˜¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿™æ ·ç¼–ç¨‹äº†ï¼š

```
label := Label{Widget{10, 10}, "State", 100}

// X=100, Y=10, Text=State, Widget.X=10
fmt.Printf("X=%d, Y=%d, Text=%s Widget.X=%d\n", 
	label.X, label.Y, label.Text, 
	label.Widget.X)
fmt.Println()
// {Widget:{X:10 Y:10} Text:State X:100} 
// {{10 10} State 100}
fmt.Printf("%+v\n%v\n", label, label)

label.Paint()
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæœ‰æˆå‘˜å˜é‡é‡åï¼Œåˆ™éœ€è¦æ‰‹åŠ¨åœ°è§£å†³å†²çªã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ18ï¼‰</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/46/d7/00e99ebb.jpg" width="30px"><span>milley</span> ğŸ‘ï¼ˆ39ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>è¿™æ ·çš„ä»£ç å’Œæ€ç»´åªèƒ½è¯´èµå¿ƒæ‚¦ç›®ï¼</div>2018-02-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/49/a5/e4c1c2d4.jpg" width="30px"><span>å°æ–‡åŒå­¦</span> ğŸ‘ï¼ˆ11ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>1ã€æ–‡ç« è¯´äº†ä»€ä¹ˆï¼Ÿ
æ–‡ç« åˆ†äº†ä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†å…ˆç®€å•è¯´äº† Golang çš„å§”æ‰˜ç”¨æ³•ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯è®²ä¸€ä¸ª structA åµŒå¥—åˆ°å¦å¤–ä¸€ä¸ª structB ä¸­ï¼ŒstructB ä¼šè‡ªåŠ¨ç»§æ‰¿ structA çš„å­—æ®µã€‚å…¶åï¼Œé€šè¿‡ä¸€ä¸ªæ›´åŠ å¤æ‚çš„ä¾‹å­è¯´æ˜å§”æ‰˜çš„ç”¨æ³•ã€‚ï¼ˆä½œä¸ºä¸€ä¸ª Java ç¨‹åºå‘˜ï¼ŒGolang ä¸º struct å¢åŠ æ–¹æ³•ï¼Œå’Œå®šä¹‰æ¥å£çš„æ–¹æ³•è®©äººå°è±¡æ·±åˆ»ï¼‰

å¦ä¸€éƒ¨åˆ†ï¼Œä½œè€…ä¸¾äº†ä¸€ä¸ªæ›´åŠ å¤æ‚çš„ä¾‹å­è¯´æ˜ Go ä¸­å§”æ‰˜å’Œæ¥å£å¤šæ€æ˜¯å¦‚ä½•å®ç°ä¸€ä¸ªæ•°æ®å®¹å™¨çš„ Undo å®ç°çš„ã€‚ä¸ºäº†è¯´æ˜è¿™éƒ¨åˆ†ï¼Œä½œè€…é€šè¿‡ä»¥ä¸‹æ­¥éª¤ä¸€è¯´è¯´è¿›é˜¶è¯´æ˜ï¼š
1ã€æœ€ç®€å•çš„ä¸€ä¸ª IntSetï¼Œå¹¶å®šä¹‰äº† Add ï¼ŒDelete æ–¹æ³•ï¼›
2ã€é€šè¿‡ä¸€ä¸ªå§”æ‰˜çš„æ–¹æ³•ï¼Œå°† IntSet å§”æ‰˜ç»™ä¸€ä¸ªæ–°çš„ structï¼Œæ–° struct å†é‡å†™ä¸€æ¬¡ Addï¼ŒDelete æ–¹æ³•ä»¥è®°å½•æ­¥éª¤ï¼ˆä¿å­˜Undoå‡½æ•°å¯¹è±¡ï¼‰ï¼Œå®Œæˆ Undo åŠŸèƒ½ï¼›
3ã€æœ€åä½œè€…å¸Œæœ›å¯ä»¥è¿›ä¸€æ­¥æ”¹å†™ï¼Œç¼–å†™ä¸€ä¸ª Undo æ ˆï¼Œå§”æ‰˜ç»™ IntSet ï¼Œå¹¶åœ¨ IntSet ç¼–å†™ Addï¼ŒDelete çš„æ–¹æ³•ä¸­å°±å®Œæˆ Undo å‡½æ•°å¯¹è±¡çš„ä¿å­˜ã€‚è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå®ç°æ–¹æ³•ã€‚</div>2020-11-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/f2/56/c39046c0.jpg" width="30px"><span>Jie</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>æ±‚æ•™ï¼Œæœ€åé‚£æ®µä»£ç æ‰§è¡Œundoçš„æ—¶å€™ä¼šç»§ç»­æ·»åŠ undoå‡½æ•°ï¼Œé‚£æ ·ä¸å°±å›ä¸åˆ°æœ€åˆçš„çŠ¶æ€äº†ï¼Ÿåç»­ä¸€ç›´åœ¨æ’¤é”€undoâ€”æ’¤é”€æ’¤é”€undoâ€¦â€¦</div>2020-11-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/8d/c5/898b13b4.jpg" width="30px"><span>äº¢ï¼ˆçŸ¥è¡Œåˆä¸€çš„è·¯ä¸Šï¼‰</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>ä¾èµ–çš„ä¸œè¥¿è¦å¯é ã€ç¨³å®šï¼Œä¹Ÿå°±æ˜¯æ¥å£ã€‚
ä¸šåŠ¡ä¸æ§åˆ¶åˆ†ç¦»ï¼Œæ§åˆ¶å°±å¯ä»¥å¤ç”¨ã€‚
æŠŠå˜åŒ–é¢‘ç‡ä¸åŒçš„äº‹ç‰©åˆ†å¼€ã€‚</div>2019-02-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/69/4d/81c44f45.jpg" width="30px"><span>æ‹‰æ¬§</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>goé‡Œé¢è¿™ä¸ªundoåŠŸèƒ½çš„å®ç°ç±»ä¼¼scalaé‡Œé¢çš„trait,ä¹Ÿæ˜¯æŠŠä¸€äº›åŠŸèƒ½æ¨¡å—ï¼ˆä»¥åŠå®ç°ï¼‰å•ç‹¬å°è£…èµ·æ¥ï¼Œç„¶åä»¥å§”æ‰˜æˆ–è€…ç»§æ‰¿çš„å½¢å¼ç»„è£…åˆ°ç±»é‡Œé¢ï¼Œè¿™ç§çµæ´»ç»„è£…çš„æ–¹å¼ç¡®å®æ¯”javaçš„interfaceè¦æ›´æ–¹ä¾¿ä½¿ç”¨ï¼Œä¸åŒè¯­è¨€ä¹‹é—´æ˜¯æœ‰å…±åŒç‚¹çš„</div>2019-05-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/bd/dc/1ea396d2.jpg" width="30px"><span>å¯»æ‰¾çš„äººcs</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>webç«¯åŠŸèƒ½å¤šä¸€ç‚¹å°±å¥½äº†ï¼Œæ¯”å¦‚æ˜¾ç¤ºæ–‡ç« åˆ—è¡¨çš„æ—¶å€™æ„Ÿè§‰ä¸å¦‚appç«¯é‚£ä¹ˆæ¸…çˆ½</div>2019-02-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/54/ad/6ee2b7cb.jpg" width="30px"><span>Jacob.C</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>å†åœ¨undoé‡ŒåŠ ä¸ªåæ’¤é”€çš„åŠŸèƒ½ï¼Œå°±æ›´ç§€äº†</div>2021-03-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/f1/12/7dac30d6.jpg" width="30px"><span>ä½ ä¸ºå•¥é‚£ä¹ˆç‰›</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>å†™äº†åŠå¹´çš„goè¯­è¨€äº†ï¼Œç»ˆäºä½“ä¼šåˆ°goè¯­è¨€çš„ç¾æ„Ÿäº†ã€‚é‚£ç§åªè¦ä¼šå˜å˜å«çš„ï¼Œæˆ‘å°±è®¤ä¸ºæ˜¯ä¸€åªğŸ¦†çš„å¢ƒç•Œã€‚ğŸ˜ƒ</div>2020-09-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/42/45/cdfe6842.jpg" width="30px"><span>Z3</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>sort.Ints(ints) parts := make([]string, 0, len(ints)) for _, i := range ints {


è¿™å—è¦sortå—ï¼Ÿ  èƒ½å¦ç›´æ¥for ï¼ˆi=0ï¼›i&lt;lenï¼‰print ints[i]</div>2018-02-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/57/d8/425e1b0a.jpg" width="30px"><span>å°è™¾ç±³</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>è¿™æ ·å†™çš„undoåœ¨ç¬¬ä¸€æ¬¡æ’å…¥è¿‡åï¼Œå¯ä»¥æ— é™æ’¤é”€äº†å§</div>2018-02-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/02/f5/3aaae06f.jpg" width="30px"><span>å°ç ´</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>å‡ ä¸ªæœˆå‰å¬åˆ°ä»£ç æ—¶é—´åšèŠ‚ç›®ï¼Œé™ˆè€å¸ˆè®²çš„å†…å®¹è®©æˆ‘æ„Ÿè§‰å¾ˆå®åœ¨ï¼Œä»Šå¤©ç»ˆäºè·Ÿè¿‡æ¥äº†ğŸ˜ƒ</div>2018-02-06</li><br/><li><img src="" width="30px"><span>qiushye</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>æ²¡æœ‰ç†è§£çš„å¯ä»¥ç›´æ¥æ‹·è´ä»£ç å»æ‰§è¡Œï¼Œä¸æ‡‚çš„åœ°æ–¹æ‰“æ—¥å¿—è¾“å‡ºæŒ‡é’ˆä¹‹ç±»çš„æ¥å¸®åŠ©ç†è§£ï¼Œå¯ä»¥æ€è€ƒä¸‹after undoçš„ç›¸åŒè¾“å‡ºå¦‚ä½•æ¥çš„ã€‚
package main

import (
	&quot;errors&quot;
	&quot;fmt&quot;
	&quot;sort&quot;
	&quot;strings&quot;
)

func main() {
	ints := NewIntSet()
	for _, i := range []int{1, 3, 5} {
		ints.Add(i)
		fmt.Println(&quot;after add:&quot;, ints.String())
	}
	for _, i := range []int{1, 2, 3, 4, 5} {
		fmt.Println(&quot;want delete:&quot;, i, ints.Contains(i), &quot; &quot;)
		ints.Delete(i)
		fmt.Println(&quot;after delete:&quot;, ints.String())
	}
	fmt.Println(&quot;------- undo result ---------&quot;)
	for {
		if err := ints.Undo(); err != nil {
			fmt.Println(err)
			break
		}
		fmt.Println(&quot;after undo:&quot;, ints.String())
	}
}
type IntSet struct {
	data map[int]bool
	undo Undo
}
func NewIntSet() IntSet {
	return IntSet{data: make(map[int]bool)}
}

func (set *IntSet) Add(x int) {
	if !set.Contains(x) {
		set.data[x] = true
		set.undo.Add(func() { set.Delete(x) })
	} else {
		set.undo.Add(nil)
	}
}

func (set *IntSet) Delete(x int) {
	if set.Contains(x) {
		delete(set.data, x)
		set.undo.Add(func() { set.Add(x) })
	} else {
		set.undo.Add(nil)
	}
}

func (set *IntSet) Undo() error {
	return set.undo.Undo()
}

func (set *IntSet) Contains(x int) bool {
	return set.data[x]
}

func (set *IntSet) String() string { 
	if len(set.data) == 0 {
		return &quot;{}&quot;
	}
	ints := make([]int, 0, len(set.data))
	for i := range set.data {
		ints = append(ints, i)
	}
	sort.Ints(ints)
	parts := make([]string, 0, len(ints))
	for _, i := range ints {
		parts = append(parts, fmt.Sprint(i))
	}
	return &quot;{&quot; + strings.Join(parts, &quot;,&quot;) + &quot;}&quot;
}

type Undo []func()

func (undo *Undo) Add(function func()) {
	*undo = append(*undo, function)
}

func (undo *Undo) Undo() error {
	functions := *undo
	if len(functions) == 0 {
		return errors.New(&quot;No functions to undo&quot;)
	}
	index := len(functions) - 1
	if function := functions[index]; function != nil {
		function()
		functions[index] = nil &#47;&#47; Free closure for garbage collection
	}
	*undo = functions[:index]
	return nil
}
</div>2023-09-15</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er4IPqj4H3jQHq4C1lgKh6ZroK3CVmGLiadic7S1rxbuy09JM9x8Aib6VkozPkO4lrUTHAhicX1z9Cg2w/132" width="30px"><span>seedjyh</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>å§”æ‰˜æ¨¡å¼å…¶å®å°±æ˜¯åˆ©ç”¨äº†goçš„ç»„åˆåŠŸèƒ½å®ç°äº†ç±»ä¼¼C++çš„ç»§æ‰¿åŠŸèƒ½ã€‚å°±undoæ•°ç»„è€Œè¨€ï¼Œç»§æ‰¿äº†åŸºç±»çš„æ ˆã€æ³¨å†Œundoçš„æ–¹æ³•å’Œæ‰§è¡Œundoçš„æ–¹æ³•ã€‚</div>2021-10-20</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er4IPqj4H3jQHq4C1lgKh6ZroK3CVmGLiadic7S1rxbuy09JM9x8Aib6VkozPkO4lrUTHAhicX1z9Cg2w/132" width="30px"><span>seedjyh</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>æœ€åçš„undoæ•°ç»„å¾ˆæœ‰æ„æ€ã€‚
åœ¨C++é‡Œï¼Œä¸€èˆ¬æ˜¯åŸºç±»Undoableæœ‰ä¸€ä¸ªpublicçš„å®ä½“å‡½æ•°Undoå’Œä¸€ä¸ªprivateçš„çº¯è™šå‡½æ•°undoï¼Œå‰è€…è°ƒç”¨åæœ€åï¼›å„ä¸ªéœ€è¦undoçš„å­ç±»å®ç°è¿™ä¸ªçº¯è™šå‡½æ•°ã€‚ä½†è¿™æ ·å°±å¼•å…¥äº†å¼ºè€¦åˆï¼ˆç»§æ‰¿ï¼‰ã€‚
åœ¨goé‡Œæ˜¯æ³¨å†Œä¸€ä¸ªé—­åŒ…ï¼Œè®©Undoæ•°ç»„å›è°ƒã€‚</div>2021-10-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/18/80/741d9e98.jpg" width="30px"><span>Geek_bc461b</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>å•ä»undoåŠŸèƒ½æ¥è¯´ç”¨è£…é¥°å™¨æ¨¡å¼æ˜¯ä¸æ˜¯æ›´å¥½</div>2020-12-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/e6/70/b9907b0e.jpg" width="30px"><span>é«˜ç§‘</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>ä¸ä¹…å‰åˆšåˆšæŠŠgoçš„ç¯å¢ƒæ­å¥½ï¼Œéƒ¨ç½²äº†ä¸€ä¸ªå¼€æºåº”ç”¨ï¼Œå‡†å¤‡å­¦ä¹ èµ·æ¥</div>2020-04-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/04/2b/68d6ac0d.jpg" width="30px"><span>whiledoing</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<div>æœ‰ç‚¹ä¸ç†è§£ï¼Œä¸ºä»€ä¹ˆ Undo çš„å‡½æ•°ä¸æ˜¯ç›´æ¥ delete(set.data, x)ï¼Œè€Œæ˜¯ set.Delete(x)ï¼Œè¿™æ ·å­ä¼šä¸ä¼šå¯¼è‡´undo çš„é˜Ÿåˆ—ä¸€ç›´åœ¨é€’å½’</div>2020-02-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/a9/71/78796fd5.jpg" width="30px"><span>xiaoè±ª</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>å£°æ˜ä¸ºtype Inset map[int]boolå°±ä¸ç”¨å†™æˆset.data[x]=trueè¿™æ ·äº†ï¼Œç›´æ¥set[x]=trueå°±å¯ä»¥äº†ã€‚</div>2018-02-08</li><br/>
</ul>