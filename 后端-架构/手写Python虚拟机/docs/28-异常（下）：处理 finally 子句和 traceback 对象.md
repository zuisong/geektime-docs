ä½ å¥½ï¼Œæˆ‘æ˜¯æµ·çº³ã€‚

ä¸Šä¸€èŠ‚è¯¾ï¼Œæˆ‘ä»¬ä½¿ç”¨ Python æºç å®ç°äº† Exception ç±»ï¼Œä»è€Œæ„å»ºèµ·äº†å¼‚å¸¸å¯¹è±¡çš„ç»§æ‰¿ä½“ç³»ï¼ŒåŒæ—¶ä¹Ÿå®ç°äº†å¼‚å¸¸å¯¹è±¡çš„åŒ¹é…åŠŸèƒ½ã€‚åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥å®ç°äº†ç”¨äºå¤„ç†å¼‚å¸¸æ§åˆ¶æµçš„å‡ æ¡å­—èŠ‚ç ã€‚

ç¬¬ä¸€æ¡é‡è¦çš„å­—èŠ‚ç æ˜¯ SETUP\_FINALLYï¼Œå®ƒçš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ª Blockï¼ŒæŒ‡å®šäº†å¦‚æœåœ¨æ‰§è¡Œ try è¯­å¥çš„è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸åº”è¯¥è·³è½¬åˆ°å“ªé‡Œæ‰§è¡Œã€‚ç¬¬äºŒæ¡æ˜¯ CALL\_FINALLYï¼Œå®ƒçš„ä½œç”¨æ˜¯å¦‚æœ try è¯­å¥æ­£å¸¸ç»“æŸäº†ï¼Œå°±è·³è½¬è¿› finally å­å¥æ‰§è¡Œã€‚è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°±æ¥å®ç°æ•´ä¸ªå¼‚å¸¸æ§åˆ¶æµçš„æœ€åä¸€æ¡é‡è¦çš„æŒ‡ä»¤ï¼Œå°±æ˜¯ **END\_FINALLY**ï¼Œæˆ‘ä»¬è¦åœ¨ END\_FINALLY ä¸­å¢åŠ æ¢å¤å¼‚å¸¸çš„é€»è¾‘ã€‚ä»è€Œè®©è§£é‡Šå™¨å¯ä»¥åœ¨é€€å‡ºå‡½æ•°æ ˆå¸§çš„æ—¶å€™è¿˜èƒ½æ­£ç¡®åœ°ç»´æŠ¤å¼‚å¸¸å¯¹è±¡ã€‚

## å®ç° END\_FINALLY

å°±åƒä¹‹å‰åˆ†æçš„ï¼ŒEND\_FINALLY çš„ä¸»è¦ä½œç”¨æ˜¯ç»“æŸ finally å­å¥çš„æ‰§è¡Œã€‚æ ¹æ®ä¸ŠèŠ‚è¯¾è¯´çš„è¿›å…¥ finally å­å¥çš„ä¸‰ç§æƒ…å†µï¼Œæˆ‘ä»¬è¿™é‡Œåˆ†åˆ«åšäº†å¤„ç†ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹å…·ä½“å®ç°ã€‚

```c++
void Interpreter::eval_frame() {
Â  Â  ...
Â  Â  while (_frame->has_more_codes()) {
	Â  Â  unsigned char op_code = _frame->get_op_code();
Â  Â  Â  Â  ...
Â  Â  Â  Â  switch (op_code) {
		...
Â  Â  Â  Â      case ByteCode::END_FINALLY: {
                v = POP();
                long long t = (long long)v();
                if (t == 0) {
                    // do nothing.
                }
                else if (t & 0x1) {
                    _frame->set_pc(t >> 1);
                }
                else {
                    _exception_class = v;
                    _pending_exception = POP();
                    _trace_back = POP();
                    _int_status = IS_EXCEPTION;
                }
                break;
            }
Â  Â  Â  Â  ...
Â  Â  Â  Â  }
Â  Â  }
}
```
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ1ï¼‰</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>å­¦ä¹ æ‰“å¡</div>2024-11-12</li><br/>
</ul>