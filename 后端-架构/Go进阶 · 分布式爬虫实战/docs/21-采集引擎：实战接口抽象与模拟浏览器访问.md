ä½ å¥½ï¼Œæˆ‘æ˜¯éƒ‘å»ºå‹‹ã€‚

æˆ‘ä»¬çŸ¥é“ï¼Œæ¥å£æ˜¯å®ç°åŠŸèƒ½æ¨¡å—åŒ–ã€æ„å»ºå¤æ‚ç¨‹åºå¼ºæœ‰åŠ›çš„æ‰‹æ®µã€‚åœ¨ä¸Šä¸€èŠ‚è¯¾ï¼Œæˆ‘ä»‹ç»äº†æ¥å£çš„æœ€ä½³å®è·µå’ŒåŸç†ã€‚è¿™ä¸€èŠ‚è¯¾ï¼Œè®©æˆ‘ä»¬åœ¨çˆ¬è™«ç¨‹åºä¸­å®æˆ˜æ¥å£ï¼Œå¯¹é‡‡é›†å¼•æ“å®Œæˆæ¥å£æŠ½è±¡ã€‚

## æ¥å£æŠ½è±¡

åœ¨[ç¬¬19è®²](https://time.geekbang.org/column/article/606005)ï¼Œæˆ‘ä»¬å·²ç»å°†çˆ¬å–ç½‘ç«™ä¿¡æ¯çš„ä»£ç å°è£…ä¸ºäº†fetchå‡½æ•°ï¼Œå®Œæˆäº†ç¬¬ä¸€è½®çš„åŠŸèƒ½æŠ½è±¡ã€‚ä½†æ˜¯éšç€çˆ¬å–çš„ç½‘ç«™è¶Šæ¥è¶Šå¤æ‚ï¼ŒåŠ ä¸ŠæœåŠ¡å™¨æœ¬èº«çš„åçˆ¬æœºåˆ¶ç­‰åŸå› ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸åŒçš„çˆ¬å–æŠ€æœ¯ã€‚ä¾‹å¦‚åé¢ä¼šè®²åˆ°çš„æ¨¡æ‹Ÿæµè§ˆå™¨è®¿é—®ã€ä»£ç†è®¿é—®ç­‰ã€‚è¦æƒ³æ¯”è¾ƒå®¹æ˜“åœ°åˆ‡æ¢ä¸åŒçš„çˆ¬å–æ–¹æ³•ï¼Œç”¨æ¨¡å—åŒ–çš„æ–¹å¼å¯¹åŠŸèƒ½è¿›è¡Œç»„åˆã€æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°æƒ³åˆ°å¯ä»¥å¯¹çˆ¬å–ç½‘ç«™æ•°æ®çš„ä»£ç æ¨¡å—è¿›è¡Œæ¥å£æŠ½è±¡ã€‚

### å®æˆ˜æ¥å£

å…·ä½“çš„åšæ³•ï¼Œæˆ‘ä»¬é¦–å…ˆè¦åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ï¼Œå°†packageå‘½åä¸ºcollectï¼ŒæŠŠå®ƒä½œä¸ºæˆ‘ä»¬çš„é‡‡å–å¼•æ“ã€‚ä¹‹åæ‰€æœ‰å’Œçˆ¬å–ç›¸å…³çš„ä»£ç éƒ½ä¼šæ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ã€‚

```plain
mkdir collect
touch collect/collect.go
```

æ¥ç€æˆ‘ä»¬è¦å®šä¹‰ä¸€ä¸ªFetcheræ¥å£ï¼Œå†…éƒ¨æœ‰ä¸€ä¸ªæ–¹æ³•ç­¾åGetï¼Œå‚æ•°ä¸ºç½‘ç«™çš„URLã€‚åé¢æˆ‘ä»¬è¿˜å°†å¯¹å‡½æ•°çš„æ–¹æ³•ç­¾åè¿›è¡Œæ”¹å˜ï¼Œä¹Ÿä¼šæ·»åŠ å…¶ä»–æ–¹æ³•ç­¾åï¼Œæ¯”å¦‚ç”¨äºæ§åˆ¶è¶…æ—¶çš„Contextå‚æ•°ç­‰ã€‚ä¸è¿‡è¦çŸ¥é“çš„æ˜¯ï¼Œåœ¨Goè¯­è¨€ä¸­ï¼Œå¯¹æ¥å£çš„å˜æ›´æ˜¯éå¸¸è½»é‡çš„ï¼Œæˆ‘ä»¬ä¸ç”¨æå‰è´¹åŠ²å»è®¾è®¡ã€‚

```plain
type Fetcher interface {
	Get(url string) ([]byte, error)
}
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦å®šä¹‰ä¸€ä¸ªç»“æ„ä½“BaseFetchï¼Œç”¨æœ€åŸºæœ¬çš„çˆ¬å–é€»è¾‘å®ç°Fetcheræ¥å£ï¼š

```plain
func (BaseFetch) Get(url string) ([]byte, error) {
	resp, err := http.Get(url)

	if err != nil {
		fmt.Println(err)
		return nil, err
	}

	defer resp.Body.Close()

	if resp.StatusCode != http.StatusOK {
		fmt.Printf("Error status code:%d", resp.StatusCode)
	}
	bodyReader := bufio.NewReader(resp.Body)
	e := DeterminEncoding(bodyReader)
	utf8Reader := transform.NewReader(bodyReader, e.NewDecoder())
	return ioutil.ReadAll(utf8Reader)
}
```

åœ¨main.goä¸­å®šä¹‰ä¸€ä¸ªç±»å‹ä¸ºBaseFetchçš„ç»“æ„ä½“ï¼Œç”¨æ¥å£Fetcheræ¥æ”¶å¹¶è°ƒç”¨Getæ–¹æ³•ï¼Œè¿™æ ·å°±å®Œæˆäº†ä½¿ç”¨æ¥å£æ¥å®ç°åŸºæœ¬çˆ¬å–çš„é€»è¾‘ã€‚

```plain
var f collect.Fetcher = collect.BaseFetch{}
body, err := f.Get(url)
```

### æ¨¡æ‹Ÿæµè§ˆå™¨è®¿é—®

ä¸Šé¢BaseFetchçš„Getå‡½æ•°æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œä½†æœ‰æ—¶æˆ‘ä»¬éœ€è¦å¯¹çˆ¬å–è¿›è¡Œæ›´å¤æ‚çš„å¤„ç†ã€‚ä¾‹å¦‚æˆ‘ä»¬ç”¨ä¸Šé¢çš„ä»£ç å»çˆ¬å–è±†ç“£è¯»ä¹¦ç½‘ç«™ä¸Šçš„é¡µé¢ï¼Œåˆ™ä¼šå¤±è´¥ã€‚

```plain
url := "https://book.douban.com/subject/1007305/"
var f collect.Fetcher= collect.BaseFetch{}
body, err := f.Get(url)
```

æŠ¥é”™ä¸º`Error status code:418` ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ªä¸æ­£å¸¸çš„çŠ¶æ€ç ï¼Œå¹¶ä¸”æ²¡æœ‰æ­£å¸¸çš„HTMLå†…å®¹ã€‚

ä¸ºä»€ä¹ˆè¿™ä¸ªç½‘ç«™å¯ä»¥é€šè¿‡æµè§ˆå™¨æ­£å¸¸è®¿é—®ï¼Œä½†æ˜¯é€šè¿‡ç¨‹åºå´ä¸è¡Œå‘¢ï¼Ÿè¿™äºŒè€…çš„åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿ

æ˜¾ç„¶ï¼Œè±†ç“£ç°åœ¨æœ‰ä¸€äº›åçˆ¬æœºåˆ¶é˜»æ­¢äº†æˆ‘ä»¬å¯¹æœåŠ¡å™¨çš„è®¿é—®ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨æµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·ï¼ˆä¸€èˆ¬åœ¨windowsä¸‹ä¸ºF12å¿«æ·é”®ï¼‰ï¼Œæˆ–è€…é€šè¿‡wiresharkç­‰æŠ“åŒ…å·¥å…·æŸ¥çœ‹æ•°æ®åŒ…ï¼Œä¼šçœ‹åˆ°æµè§ˆå™¨è‡ªåŠ¨åœ¨HTTP Headerä¸­è®¾ç½®äº†å¾ˆå¤šå†…å®¹ï¼Œå…¶ä¸­æ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªå°±æ˜¯**User-Agentå­—æ®µï¼Œå®ƒå¯ä»¥è¡¨æ˜å½“å‰æ­£åœ¨ä½¿ç”¨çš„åº”ç”¨ç¨‹åºã€è®¾å¤‡ç±»å‹å’Œæ“ä½œç³»ç»Ÿçš„ç±»å‹ä¸ç‰ˆæœ¬ã€‚**

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/61/80/61f4c891a54b3fe453e343505bda0780.png?wh=1920x967)

å¤§å¤šæ•°æµè§ˆå™¨ä½¿ç”¨[ä»¥ä¸‹æ ¼å¼](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/User-Agent)å‘é€**User-Agentï¼š**

```plain
Mozilla/5.0 (æ“ä½œç³»ç»Ÿä¿¡æ¯) è¿è¡Œå¹³å°(è¿è¡Œå¹³å°ç»†èŠ‚) <æ‰©å±•ä¿¡æ¯>
```

æˆ‘å½“å‰çš„Chromeï¼ˆè°·æ­Œæµè§ˆå™¨ï¼‰å‘é€çš„ä¿¡æ¯å¦‚ä¸‹ï¼š

```plain
Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36
```

å…¶ä¸­ï¼ŒMozilla/5.0ç”±äºå†å²åŸå› ï¼Œæ˜¯ç°åœ¨çš„ä¸»æµæµè§ˆå™¨éƒ½ä¼šå‘é€çš„ã€‚

`Macintosh; Intel Mac OS X 10_15_7` ä»£è¡¨å½“å‰æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬å·ã€‚

`AppleWebKit/537.36` æ˜¯åœ¨ Apple è®¾å¤‡ä¸Šä½¿ç”¨çš„ Web æ¸²æŸ“å¼•æ“æ ‡è¯†ç¬¦ã€‚

`KHTML`æ˜¯åœ¨ Safari å’Œ Chrome ä¸Šä½¿ç”¨çš„å¼•æ“ã€‚

`Chrome/103.0.0.0 Safari/537.36` æŒ‡ä»£æµè§ˆå™¨çš„åå­—å’Œç‰ˆæœ¬å·ã€‚

**ä½¿ç”¨ä¸åŒçš„æµè§ˆå™¨ã€è®¾å¤‡ï¼ŒUser-Agentéƒ½ä¼šç•¥æœ‰ä¸åŒã€‚**ä¸åŒåº”ç”¨ç¨‹åºçš„User-Agentå‚è€ƒå¦‚ä¸‹ï¼š

```plain
Lynx: Lynx/2.8.8pre.4 libwww-FM/2.14 SSL-MM/1.4.1 GNUTLS/2.12.23

Wget: Wget/1.15 (linux-gnu)

Curl: curl/7.35.0

Samsung Galaxy Note 4: Mozilla/5.0 (Linux; Android 6.0.1; SAMSUNG SM-N910F Build/MMB29M) AppleWebKit/537.36 (KHTML, like Gecko) SamsungBrowser/4.0 Chrome/44.0.2403.133 Mobile Safari/537.36

Apple iPhone: Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Version/10.0 Mobile/14E304 Safari/602.1

Apple iPad: Mozilla/5.0 (iPad; CPU OS 8_4_1 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Version/8.0 Mobile/12H321 Safari/600.1.4

Microsoft Internet Explorer 11 / IE 11: Mozilla/5.0 (compatible, MSIE 11, Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko
```

**æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬çš„çˆ¬è™«æœåŠ¡éœ€è¦åŠ¨æ€ç”Ÿæˆ User-Agent åˆ—è¡¨ï¼Œæ–¹ä¾¿åœ¨æµ‹è¯•ã€æˆ–è€…åœ¨ä½¿ç”¨ä»£ç†å¤§é‡è¯·æ±‚å•ä¸€ç½‘ç«™æ—¶ï¼ŒåŠ¨æ€è®¾ç½®ä¸åŒçš„User-Agentï¼ˆæˆ‘ä¼šåœ¨åé¢çš„è¯¾ç¨‹ä¸­ç»™å‡ºç›¸å…³çš„ä»£ç ï¼‰ã€‚**

å› ä¸ºæœ‰äº›æœåŠ¡å™¨ä¼šæ£€æµ‹User-Agentï¼Œä»¥æ­¤è¯†åˆ«è¯·æ±‚æ˜¯å¦æ˜¯ç‰¹å®šçš„åº”ç”¨ç¨‹åºå‘å‡ºçš„ï¼Œé˜»æ­¢çˆ¬è™«æœºå™¨äººè®¿é—®æœåŠ¡å™¨ã€‚è€Œä½¿ç”¨æ­£ç¡®çš„User-Agentä¼šè®©æˆ‘ä»¬çš„è¯·æ±‚çœ‹èµ·æ¥æ›´æœ‰â€œäººæ€§â€ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿæ›´è‡ªç”±åœ°ä»ç›®æ ‡ç½‘ç«™æ”¶é›†æ•°æ®ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥å®éªŒä¸€ä¸‹ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ç»“æ„ä½“BrowserFetchå¹¶è®©å…¶å®ç°Fetcheræ¥å£ã€‚ä¸ºäº†èƒ½å¤Ÿè®¾ç½® HTTP è¯·æ±‚å¤´ï¼Œæˆ‘ä»¬ä¸èƒ½å¤Ÿå†ä½¿ç”¨ç®€å•çš„http.Getæ–¹æ³•äº†ã€‚

æˆ‘ä»¬é¦–å…ˆè¦åˆ›å»ºä¸€ä¸ªHTTPå®¢æˆ·ç«¯http.Clientï¼Œç„¶åé€šè¿‡http.NewRequeståˆ›å»ºä¸€ä¸ªè¯·æ±‚ã€‚åœ¨è¯·æ±‚ä¸­è°ƒç”¨req.Header.Setè®¾ç½®User-Agentè¯·æ±‚å¤´ã€‚æœ€åè°ƒç”¨client.Doå®ŒæˆHTTPè¯·æ±‚ã€‚

```plain
type BrowserFetch struct {
}

//æ¨¡æ‹Ÿæµè§ˆå™¨è®¿é—®
func (BrowserFetch) Get(url string) ([]byte, error) {
	client := &http.Client{}

	req, err := http.NewRequest("GET", url, nil)
	if err != nil {
		return nil, fmt.Errorf("get url failed:%v", err)
	}

	req.Header.Set("User-Agent", "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36")

	resp, err := client.Do(req)
	if err != nil {
		return nil, err
	}

	bodyReader := bufio.NewReader(resp.Body)
	e := DeterminEncoding(bodyReader)
	utf8Reader := transform.NewReader(bodyReader, e.NewDecoder())
	return ioutil.ReadAll(utf8Reader)
}
```

å…¶å®http.Getæ–¹æ³•ä¹‹æ‰€ä»¥ç®€å•ï¼Œåªæ˜¯å¯¹ä¸Šé¢è¿™äº›æ­¥éª¤å®Œæˆäº†å°è£…ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œhttp.Getä¼šé»˜è®¤ç”Ÿæˆå†…ç½®çš„http.Clientï¼Œåˆ›å»ºè¯·æ±‚NewRequestï¼Œå¹¶è°ƒç”¨client.Doå‡½æ•°ï¼Œclient.Doæœ€ç»ˆä¼šè°ƒç”¨Transport.roundTripå‡½æ•°å‘é€è¯·æ±‚ã€‚

```plain
var DefaultClient = &Client{}
func Get(url string) (resp *Response, err error) {
	return DefaultClient.Get(url)
}

func (c *Client) Get(url string) (resp *Response, err error) {
	req, err := NewRequest("GET", url, nil)
	if err != nil {
		return nil, err
	}
	return c.Do(req)
}

```

ç°åœ¨æˆ‘ä»¬åªè¦åœ¨mainå‡½æ•°ä¸­å°†é‡‡é›†å¼•æ“æ›¿æ¢ä¸ºcollect.BrowserFetchï¼Œå°±å¯ä»¥è½»æ¾è·å–åˆ°è±†ç“£ç½‘ç«™ä¸­çš„å†…å®¹äº†ã€‚

```plain
func main() {
	url := "https://book.douban.com/subject/1007305/"
	var f collect.Fetcher = collect.BrowserFetch{}
	body, err := f.Get(url)
	if err != nil {
		fmt.Println("read content failed:%v", err)
		return
	}
	fmt.Println(string(body))
}
```

### è¿œç¨‹è®¿é—®æµè§ˆå™¨

ä»…ä»…åœ¨è¯·æ±‚å¤´ä¸­ä¼ é€’User-Agentæ˜¯ä¸å¤Ÿçš„ã€‚æ­£å¦‚æˆ‘ä»¬ä¹‹å‰æåˆ°è¿‡çš„ï¼Œæµè§ˆå™¨å¼•æ“ä¼šå¯¹HTMLä¸CSSæ–‡ä»¶è¿›è¡Œæ¸²æŸ“ï¼Œå¹¶ä¸”æ‰§è¡ŒJavaScriptè„šæœ¬ï¼Œè¿˜å¯èƒ½ä¼šå®Œæˆä¸€äº›å®æ—¶æ¨é€ã€å¼‚æ­¥è°ƒç”¨å·¥ä½œã€‚è¿™å¯¼è‡´å†…å®¹ä¼šè¢«å»¶è¿Ÿå±•ç¤ºï¼Œæ— æ³•ç›´æ¥é€šè¿‡ç®€å•çš„http.Getæ–¹æ³•è·å–åˆ°æ•°æ®ã€‚

æ›´è¿›ä¸€æ­¥çš„ï¼Œæœ‰äº›æ•°æ®éœ€è¦è¿›è¡Œç”¨æˆ·äº¤äº’ï¼Œä¾‹å¦‚æˆ‘ä»¬éœ€è¦ç‚¹å‡»æŸäº›æŒ‰é’®æ‰èƒ½è·å¾—è¿™äº›ä¿¡æ¯ã€‚è¿™å°±è¿«åˆ‡åœ°éœ€è¦æˆ‘ä»¬å…·æœ‰æ¨¡æ‹Ÿæµè§ˆå™¨çš„èƒ½åŠ›ï¼Œæˆ–è€…æ›´ç®€å•ä¸€ç‚¹ï¼šç›´æ¥æ“ä½œæµè§ˆå™¨ï¼Œè®©æµè§ˆå™¨æ¥å¸®åŠ©æˆ‘ä»¬çˆ¬å–æ•°æ®ã€‚

è¦å€ŸåŠ©æµè§ˆå™¨çš„èƒ½åŠ›å®ç°è‡ªåŠ¨åŒ–çˆ¬å–ï¼Œç›®å‰ä¾é çš„æŠ€æœ¯æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š

- å€ŸåŠ©æµè§ˆå™¨é©±åŠ¨åè®®ï¼ˆWebDriver protocolï¼‰è¿œç¨‹ä¸æµè§ˆå™¨äº¤äº’ï¼›
- å€ŸåŠ©è°·æ­Œå¼€å‘è€…å·¥å…·åè®®ï¼ˆCDPï¼ŒChrome DevTools Protocolï¼‰è¿œç¨‹ä¸æµè§ˆå™¨äº¤äº’ï¼›
- åœ¨æµè§ˆå™¨åº”ç”¨ç¨‹åºä¸­æ³¨å…¥è¦æ‰§è¡Œçš„JavaScriptï¼Œå…¸å‹çš„å·¥å…·æœ‰Cypressï¼Œ TestCafeã€‚

ç”±äºç¬¬ä¸‰ç§æŠ€æœ¯é€šå¸¸åªç”¨äºæµ‹è¯•ï¼Œæ‰€ä»¥ä¸‹é¢æˆ‘ä»¬å°±é‡ç‚¹æ¥è¯´è¯´å‰é¢ä¸¤ç§æŠ€æœ¯ã€‚

#### **Webdriver Protocol**

Webdriveråè®®æ˜¯æ“ä½œæµè§ˆå™¨çš„ä¸€ç§è¿œç¨‹æ§åˆ¶åè®®ã€‚å€ŸåŠ©Webdriveråè®®å®Œæˆçˆ¬è™«çš„æ¡†æ¶æˆ–åº“æœ‰Seleniumï¼ŒWebdriverIOï¼ŒNightwatchï¼Œå…¶ä¸­æœ€çŸ¥åçš„å°±æ˜¯Seleniumã€‚[Selenium](https://www.selenium.dev/documentation/webdriver/getting_started/install_library/) ä¸ºæ¯ä¸€ç§è¯­è¨€ï¼ˆä¾‹å¦‚Javaã€Pythonã€Rubyç­‰ï¼‰éƒ½å‡†å¤‡äº†ä¸€ä¸ªå¯¹åº”çš„clinetåº“ï¼Œå®ƒæ•´åˆäº†ä¸åŒæµè§ˆå™¨çš„é©±åŠ¨ï¼ˆè¿™äº›é©±åŠ¨ç”±æµè§ˆå™¨å‚å•†æä¾›ï¼Œä¾‹å¦‚è°·æ­Œæµè§ˆå™¨çš„é©±åŠ¨å’Œç«ç‹æµè§ˆå™¨çš„é©±åŠ¨ï¼‰ã€‚

Seleniumé€šè¿‡ [W3C çº¦å®šçš„ WebDriver åè®®](https://www.w3.org/TR/webdriver1/)ä¸æŒ‡å®šçš„æµè§ˆå™¨é©±åŠ¨è¿›è¡Œé€šä¿¡ï¼Œä¹‹åæµè§ˆå™¨é©±åŠ¨æ“ä½œç‰¹å®šæµè§ˆå™¨ï¼Œä»è€Œå®ç°å¼€å‘è€…æ“ä½œæµè§ˆå™¨çš„ç›®çš„ã€‚ç”±äº Selenium æ•´åˆäº†ä¸åŒçš„æµè§ˆå™¨é©±åŠ¨ï¼Œå› æ­¤å®ƒå¯¹äºä¸åŒçš„æµè§ˆå™¨éƒ½å…·æœ‰è‰¯å¥½çš„å…¼å®¹æ€§ã€‚

#### Chrome DevTools Protocol

ç¬¬äºŒç§è¿œç¨‹ä¸æµè§ˆå™¨äº¤äº’çš„åè®®å«åš[Chrome DevTools Protocol](https://chromedevtools.github.io/devtools-protocol/)ï¼ˆè°·æ­Œå¼€å‘è€…å·¥å…·åè®®ï¼‰ã€‚é¡¾åæ€ä¹‰ï¼Œè¯¥åè®®æœ€åˆæ˜¯ç”±è°·æ­Œå¼€å‘è€…å·¥å…·å›¢é˜Ÿç»´æŠ¤çš„ï¼Œè´Ÿè´£è°ƒè¯•ã€æ“ä½œæµè§ˆå™¨çš„åè®®ã€‚ç›®å‰ï¼Œç°ä»£å¤§å¤šæ•°æµè§ˆå™¨éƒ½æ”¯æŒè°·æ­Œå¼€å‘è€…å·¥å…·åè®®ã€‚æˆ‘ä»¬ç»å¸¸ä½¿ç”¨åˆ°çš„è°·æ­Œæµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·ï¼ˆå¿«æ·é”®CTRL + SHIFT + I æˆ–è€… F12ï¼‰å°±æ˜¯ä½¿ç”¨è¿™ä¸ªåè®®æ¥æ“ä½œæµè§ˆå™¨çš„ã€‚

æŸ¥çœ‹è°·æ­Œå¼€å‘è€…å·¥å…·ä¸æµè§ˆå™¨äº¤äº’çš„åè®®çš„æ–¹å¼æ˜¯ï¼Œæ‰“å¼€è°·æ­Œæµè§ˆå™¨ï¼Œåœ¨å¼€å‘è€…å·¥å…· â†’è®¾ç½®â†’ å®éªŒä¸­å‹¾é€‰ Protocol Monitorï¼ˆåè®®ç›‘è§†å™¨ï¼‰ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/fd/4b/fddcc0df96472974ee9db23b29d3d64b.png?wh=1920x998)

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦é‡å¯å¼€å‘è€…å·¥å…·ï¼Œåœ¨å³ä¾§ç‚¹å‡»æ›´å¤šå·¥å…·ï¼Œè¿™æ ·å°±å¯ä»¥çœ‹åˆ°åè®®ç›‘è§†å™¨é¢æ¿äº†ã€‚é¢æ¿ä¸­æœ‰å¼€å‘è€…å·¥å…·é€šè¿‡åè®®ä¸æµè§ˆå™¨äº¤äº’çš„ç»†èŠ‚ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/ed/44/ed222cd2ef88af365dcae3d14c631d44.png?wh=1920x1197)

ä¸Seleniuméœ€è¦ä¸æµè§ˆå™¨é©±åŠ¨è¿›è¡Œäº¤äº’ä¸åŒçš„æ˜¯ï¼ŒChrome DevToolsåè®®ç›´æ¥é€šè¿‡Web Socketåè®®ä¸æµè§ˆå™¨æš´éœ²çš„APIè¿›è¡Œé€šä¿¡ï¼Œè¿™ä½¿å¾— Chrome DevTools åè®®æ“ä½œæµè§ˆå™¨å˜å¾—æ›´å¿«ã€‚

æ‰€ä»¥ï¼Œç›¸æ¯”Seleniumï¼Œæˆ‘æ›´æ¨èä½¿ç”¨Chrome DevToolsåè®®æ¥è®¿é—®æµè§ˆå™¨ã€‚Selenium 4è™½ç„¶å·²ç»æä¾›äº†å¯¹äºChrome DevToolsåè®®çš„æ”¯æŒï¼Œä½†æ˜¯å®ƒç›®å‰è¿˜æ²¡æœ‰å¯¹Goçš„å®˜æ–¹çš„Clientåº“ã€‚

åœ¨Goä¸­å®ç°äº†Chrome DevToolsåè®®çš„çŸ¥åç¬¬ä¸‰æ–¹åº“æ˜¯[chromedp](https://github.com/chromedp/chromedp)ã€‚å®ƒçš„æ“ä½œç®€å•ï¼Œä¹Ÿä¸éœ€è¦é¢å¤–çš„ä¾èµ–ã€‚å€ŸåŠ©[chromedp](https://github.com/chromedp/chromedp) æä¾›çš„èƒ½åŠ›ä¸æµè§ˆå™¨äº¤äº’ï¼Œæˆ‘ä»¬å°±å…·æœ‰äº†è®¸å¤šçµæ´»çš„èƒ½åŠ›ï¼Œä¾‹å¦‚æˆªå±ã€æ¨¡æ‹Ÿé¼ æ ‡ç‚¹å‡»ã€æäº¤è¡¨å•ã€ä¸‹è½½/ä¸Šä¼ æ–‡ä»¶ç­‰ã€‚[chromedp](https://github.com/chromedp/chromedp) çš„ä¸€äº›æ“ä½œæ ·ä¾‹ä½ å¯ä»¥å‚è€ƒ[exampleä»£ç åº“](https://github.com/chromedp/examples)ã€‚

è¿™é‡Œæˆ‘æ¨¡æ‹Ÿé¼ æ ‡ç‚¹å‡»äº‹ä»¶ï¼Œç»™ä½ åšä¸€ä¸ªæ¼”ç¤ºã€‚å‡è®¾æˆ‘ä»¬è®¿é—®[Go time åŒ…çš„è¯´æ˜æ–‡æ¡£](https://pkg.go.dev/time)ï¼Œä¾‹å¦‚Afterå‡½æ•°ï¼Œä¼šå‘ç°ä¸‹å›¾çš„å‚è€ƒä»£ç æ˜¯æŠ˜å çš„ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/8e/dc/8eba17f2288ac4f75b707a0dd63e1bdc.png?wh=1920x1199)

é€šè¿‡é¼ æ ‡ç‚¹å‡»ï¼ŒæŠ˜å çš„ä»£ç å¯ä»¥å±•ç¤ºå‡ºtime.Afterå‡½æ•°çš„å‚è€ƒä»£ç ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/54/9b/54cd4cf8e5a0fa819579654bd93fb59b.png?wh=1920x1171)

æˆ‘ä»¬ç»å¸¸é¢ä¸´è¿™ç§æƒ…å†µï¼Œå³éœ€è¦å®Œæˆä¸€äº›äº¤äº’æ‰èƒ½è·å–åˆ°å¯¹åº”çš„æ•°æ®ã€‚è¦æ¨¡æ‹Ÿä¸Šé¢çš„å®Œæ•´æ“ä½œï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

```plain
package main

import (
	"context"
	"log"
	"time"

	"github.com/chromedp/chromedp"
)

func main() {
	// 1ã€åˆ›å»ºè°·æ­Œæµè§ˆå™¨å®ä¾‹
	ctx, cancel := chromedp.NewContext(
		context.Background(),
	)
	defer cancel()

	// 2ã€è®¾ç½®contextè¶…æ—¶æ—¶é—´
	ctx, cancel = context.WithTimeout(ctx, 15*time.Second)
	defer cancel()

	// 3ã€çˆ¬å–é¡µé¢ï¼Œç­‰å¾…æŸä¸€ä¸ªå…ƒç´ å‡ºç°,æ¥ç€æ¨¡æ‹Ÿé¼ æ ‡ç‚¹å‡»ï¼Œæœ€åè·å–æ•°æ®
	var example string
	err := chromedp.Run(ctx,
		chromedp.Navigate(`https://pkg.go.dev/time`),
		chromedp.WaitVisible(`body > footer`),
		chromedp.Click(`#example-After`, chromedp.NodeVisible),
		chromedp.Value(`#example-After textarea`, &example),
	)
	if err != nil {
		log.Fatal(err)
	}
	log.Printf("Go's time.After example:\\n%s", example)
}
```

è§£é‡Šä¸€ä¸‹ã€‚**é¦–å…ˆæˆ‘ä»¬å¯¼å…¥äº†chromedpåº“ï¼Œå¹¶è°ƒç”¨chromedp.NewContextä¸ºæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæµè§ˆå™¨çš„å®ä¾‹ã€‚**å®ƒçš„å®ç°åŸç†éå¸¸ç®€å•ï¼Œå³æŸ¥æ‰¾å½“å‰ç³»ç»ŸæŒ‡å®šè·¯å¾„ä¸‹æŒ‡å®šçš„è°·æ­Œåº”ç”¨ç¨‹åºï¼Œå¹¶é»˜è®¤ç”¨æ— å¤´æ¨¡å¼ï¼ˆHeadlessæ¨¡å¼ï¼‰å¯åŠ¨è°·æ­Œæµè§ˆå™¨å®ä¾‹ã€‚é€šè¿‡æ— å¤´æ¨¡å¼ï¼Œæˆ‘ä»¬è‚‰çœ¼ä¸ä¼šçœ‹åˆ°è°·æ­Œæµè§ˆå™¨çª—å£çš„æ‰“å¼€è¿‡ç¨‹ï¼Œä½†å®ƒç¡®å®å·²ç»åœ¨åå°è¿è¡Œäº†ã€‚

```plain
func findExecPath() string {
	var locations []string
	switch runtime.GOOS {
	case "darwin":
		locations = []string{
			// Mac
			"/Applications/Chromium.app/Contents/MacOS/Chromium",
			"/Applications/Google Chrome.app/Contents/MacOS/Google Chrome",
		}
	case "windows":
		locations = []string{
			// Windows
			"chrome",
			"chrome.exe", // in case PATHEXT is misconfigured
			`C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe`,
			`C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe`,
			filepath.Join(os.Getenv("USERPROFILE"), `AppData\\Local\\Google\\Chrome\\Application\\chrome.exe`),
			filepath.Join(os.Getenv("USERPROFILE"), `AppData\\Local\\Chromium\\Application\\chrome.exe`),
		}
	default:
		locations = []string{
			// Unix-like
			"headless_shell",
			...
		}
	}
```

æ‰€ä»¥è¯´ï¼Œå½“å‰ç¨‹åºèƒ½å¤Ÿè¿è¡Œçš„é‡è¦å‰ææ˜¯åœ¨æŒ‡å®šè·¯å¾„ä¸­å­˜åœ¨è°·æ­Œæµè§ˆå™¨ç¨‹åºã€‚å½“ç„¶ï¼Œä¸€èˆ¬æˆ‘ä»¬ç³»ç»Ÿä¸­å¯æµè§ˆçš„è°·æ­Œæµè§ˆå™¨çš„å¤§å°éƒ½æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œæ‰€ä»¥chromedpè¿˜å¥½å¿ƒåœ°ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªåŒ…å«äº†æ— å¤´è°·æ­Œæµè§ˆå™¨çš„åº”ç”¨ç¨‹åºçš„é•œåƒï¼š[headless-shell](https://hub.docker.com/r/chromedp/headless-shell/)ã€‚

**ç¬¬äºŒæ­¥ï¼Œç”¨ context.WithTimeout è®¾ç½®å½“å‰çˆ¬å–æ•°æ®çš„è¶…æ—¶æ—¶é—´ï¼Œè¿™é‡Œæˆ‘ä»¬è®¾ç½®æˆäº†15sã€‚**

**ç¬¬ä¸‰æ­¥ï¼Œchromedp.Runæ‰§è¡Œå¤šä¸ªactionï¼Œchromedpä¸­æŠ½è±¡äº†actionå’Œtaskä¸¤ç§è¡Œä¸ºã€‚**å…¶ä¸­ï¼ŒactionæŒ‡çš„æ˜¯çˆ¬å–ã€ç­‰å¾…ã€ç‚¹å‡»ã€è·å–æ•°æ®è¿™æ ·çš„è¡Œä¸ºã€‚è€ŒtaskæŒ‡çš„æ˜¯ä¸€ä¸ªä»»åŠ¡ï¼Œtaskæ˜¯å¤šä¸ªactionçš„é›†åˆã€‚å› æ­¤ï¼Œchromedp.Runä¼šå°†å¤šä¸ªactionå°è£…ä¸ºä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶ä¾æ¬¡æ‰§è¡Œã€‚

```plain
func Run(ctx context.Context, actions ...Action) error {
	...
	return Tasks(actions).Do(cdp.WithExecutor(ctx, c.Target))
}
```

- chromedp.NavigateæŒ‡çš„æ˜¯çˆ¬å–æŒ‡å®šçš„ç½‘å€ï¼š[https://pkg.go.dev/time](https://pkg.go.dev/time)ã€‚
- chromedp.WaitVisibleæŒ‡çš„æ˜¯â€œç­‰å¾…å½“å‰æ ‡ç­¾å¯è§â€ï¼Œå…¶å‚æ•°ä½¿ç”¨çš„æ˜¯CSSé€‰æ‹©å™¨çš„å½¢å¼ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œbody &gt; footeræ ‡ç­¾å¯è§ï¼Œä»£è¡¨æ­£æ–‡å·²ç»åŠ è½½å®Œæ¯•ã€‚
- chromedp.ClickæŒ‡çš„æ˜¯â€œæ¨¡æ‹Ÿå¯¹æŸä¸€ä¸ªæ ‡ç­¾çš„ç‚¹å‡»äº‹ä»¶â€ã€‚
- chromedp.Valueç”¨äºè·å–æŒ‡å®šæ ‡ç­¾çš„æ•°æ®ã€‚  
  æœ€ç»ˆä»£ç æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼Œè¿™æ ·æˆ‘ä»¬å°±æˆåŠŸè·å–åˆ°äº†time.Afterçš„ä»£ç ç¤ºä¾‹ã€‚

```plain
2022/10/24 17:26:46 Go's time.After example:
package main

import (
        "fmt"
        "time"
)

var c chan int

func handle(int) {}

func main() {
        select {
        case m := <-c:
                handle(m)
        case <-time.After(10 * time.Second):
                fmt.Println("timed out")
        }
}
```

åœ¨åé¢çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¿˜ä¼šå¯¹[chromedp](https://github.com/chromedp/chromedp)è¿›è¡Œå°è£…ï¼Œå®ç°æˆ‘ä»¬å®šä¹‰çš„é‡‡é›†å¼•æ“çš„æ¥å£ã€‚ä½ ä¹Ÿå¯ä»¥å…ˆè¯•ç€ä½¿ç”¨[chromedp](https://github.com/chromedp/chromedp)æ¥æ„å»ºä¸€ä¸‹è‡ªå·±çš„é‡‡é›†å¼•æ“ã€‚  
å¯ä»¥çœ‹åˆ°ï¼Œæ¥å£åœ¨è¿™é‡Œå†æ¬¡å‘æŒ¥äº†å·¨å¤§ä½œç”¨ã€‚åªè¦åˆç†åœ°ç»„åˆè®¾è®¡ï¼Œæˆ‘ä»¬çš„ç¨‹åºå°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åˆ‡æ¢ä»»ä½•çš„é‡‡é›†å¼•æ“ã€‚ä¸ç®¡æ˜¯ç”¨åŸç”Ÿè¿˜æ˜¯æ¨¡æ‹Ÿæµè§ˆå™¨æ–¹å¼ï¼Œä¸ç®¡æ˜¯ä½¿ç”¨Seleniumã€chromedpçš„æ–¹å¼ï¼Œäº¦æˆ–æ˜¯æœªæ¥æ–°çš„é‡‡é›†æ–¹å¼ï¼Œéƒ½ä¸ä¼šç ´åæˆ‘ä»¬å…¶ä»–æ¨¡å—çš„ä»£ç ã€‚

## ç©ºæ¥å£

å¥½äº†ï¼Œå‰é¢æˆ‘ä»¬ä»‹ç»çš„æ¥å£éƒ½æ˜¯å¸¦æœ‰æ–¹æ³•ç­¾åçš„ã€‚å…¶å®è¿˜æœ‰ä¸€ç±»ç‰¹æ®Šçš„æ¥å£ä¸å¸¦ä»»ä½•çš„æ–¹æ³•ç­¾åï¼Œè¢«ç§°ä¸ºç©ºæ¥å£ã€‚æˆ‘ä»¬åœ¨åé¢çš„é¡¹ç›®ä¸­è¿˜ä¼šé¢‘ç¹ä½¿ç”¨åˆ°å®ƒã€‚

ä»»ä½•ç±»å‹éƒ½éšå¼å®ç°äº†ç©ºæ¥å£ã€‚æ­£å¦‚Goçš„åˆ›å§‹äººRob Pikeæ‰€è¯´ï¼šâ€œEmpty interface say nothingâ€ï¼Œç©ºæ¥å£å¹¶æ²¡æœ‰ä»»ä½•çš„å«ä¹‰ï¼Œæ—¢ç„¶å¦‚æ­¤ï¼Œç©ºæ¥å£æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ

ç”±äºGoæ˜¯å¼ºç±»å‹çš„è¯­è¨€ï¼Œä½¿ç”¨ç©ºæ¥å£å¯ä»¥ä¸ºå¤–ç•Œæä¾›ä¸€ä¸ªæ›´åŠ é€šç”¨çš„èƒ½åŠ›ã€‚ç„¶è€Œåœ¨å¤„ç†æ¥å£çš„è¿‡ç¨‹ä¸­å´éœ€è¦é»˜é»˜æ‰¿å—è§£æç©ºæ¥å£å¸¦æ¥çš„ç—›è‹¦ã€‚é€šè¿‡ä½¿ç”¨ç©ºæ¥å£ï¼Œå¸¸è§çš„fmt.Printlnå‡½æ•°æä¾›äº†æ‰“å°ä»»ä½•ç±»å‹çš„åŠŸèƒ½ã€‚

```plain
func Println(a ...interface{}) (n int, err error) {
	return Fprintln(os.Stdout, a...)
}
```

å¦‚æœä¸ä½¿ç”¨ç©ºæ¥å£ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªç±»å‹éƒ½éœ€è¦å®ç°ä¸€ä¸ªå¯¹åº”çš„Printlnå‡½æ•°ï¼Œæ˜¯éå¸¸ä¸æ–¹ä¾¿çš„ã€‚

**ä¸è¿‡ï¼Œç©ºæ¥å£å¸¦æ¥ä¾¿åˆ©çš„åŒæ—¶ï¼Œä¹Ÿæ„å‘³ç€æˆ‘ä»¬å¿…é¡»åœ¨å†…éƒ¨è§£ææ¥å£çš„ç±»å‹ï¼Œå¹¶å¯¹ä¸åŒçš„ç±»å‹è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚**ä»¥fmt.Printlnä¸ºä¾‹ï¼ŒPrintlnå‡½æ•°å†…éƒ¨é€šè¿‡æ£€æµ‹æ¥å£çš„å…·ä½“ç±»å‹æ¥è°ƒç”¨ä¸åŒçš„å¤„ç†å‡½æ•°ã€‚å¦‚æœæ˜¯è‡ªå®šä¹‰ç±»å‹ï¼Œè¿˜éœ€è¦ä½¿ç”¨åå°„ã€é€’å½’ç­‰æ‰‹æ®µå®Œæˆå¤æ‚ç±»å‹çš„æ‰“å°åŠŸèƒ½ã€‚

```plain
func (p *pp) printArg(arg interface{}, verb rune) {
		switch f := arg.(type) {
			case bool:
				p.fmtBool(f, verb)
			case float32:
				p.fmtFloat(float64(f), 32, verb)
			case float64:
				p.fmtFloat(f, 64, verb)
			case complex64:
				p.fmtComplex(complex128(f), 64, verb)
			....
}
```

ç±»ä¼¼çš„APIè®¾è®¡è¿˜æœ‰ç”¨äºåºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„JSONæ ‡å‡†åº“ç­‰ã€‚

```plain
func Marshal(v interface{}) ([]byte, error) {
	e := newEncodeState()

	err := e.marshal(v, encOpts{escapeHTML: true})
	if err != nil {
		return nil, err
	}
	buf := append([]byte(nil), e.Bytes()...)

	encodeStatePool.Put(e)

	return buf, nil
}
```

JSONæ ‡å‡†åº“å†…éƒ¨ä½¿ç”¨äº†åå°„æ¥åˆ¤æ–­æ¥å£ä¸­å­˜å‚¨çš„å®é™…ç±»å‹ï¼Œä»¥æ­¤åˆ†é…ä¸åŒçš„åºåˆ—åŒ–å™¨ã€‚

```plain
func newTypeEncoder(t reflect.Type, allowAddr bool) encoderFunc {
	...	
	switch t.Kind() {
		case reflect.Bool:
			return boolEncoder
		case reflect.Int, reflect.Int8, reflect.Int16, reflect.Int32, reflect.Int64:
			return intEncoder
		case reflect.Uint, reflect.Uint8, reflect.Uint16, reflect.Uint32, reflect.Uint64, reflect.Uintptr:
			return uintEncoder
			...

}
```

**é™¤æ­¤ä¹‹å¤–ï¼Œå¯¹äºè·¨æœåŠ¡è°ƒç”¨çš„APIï¼Œä½¿ç”¨ç©ºæ¥å£å¯ä»¥æé«˜å®ƒä»¬çš„æ‰©å±•æ€§ã€‚å› ä¸ºåœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œä¿®æ”¹APIçš„æˆæœ¬é€šå¸¸æ¯”è¾ƒé«˜ï¼ŒæœåŠ¡å™¨éœ€è¦æ”¹é€ å¹¶å‘å¸ƒæ–°çš„SDKï¼Œå®¢æœç«¯è¿˜éœ€è¦é€‚é…æ–°çš„SDKå¹¶è”è°ƒæµ‹è¯•ã€‚**

å¦‚ä¸‹æ‰€ç¤ºï¼Œåœ¨Infoç»“æ„ä½“ä¸­å¢åŠ æ‰©å±•ç±»å‹ `map[string]interface{}`ï¼Œæ–°çš„åŠŸèƒ½å¦‚æœéœ€è¦ä¼ é€’æ–°çš„ä¿¡æ¯ï¼Œå½“å‰æœåŠ¡ç”šè‡³å¯ä»¥ä¸ç”¨ä¿®æ”¹APIã€‚

```plain
type info struct{
  ExtraData               map[string]interface{}        `json:"extra_data"` 
  ...
}
```

åœ¨åé¢çš„è¯¾ç¨‹ä¸­æˆ‘ä»¬è¿˜ä¼šçœ‹åˆ°ï¼Œç”±äºçˆ¬è™«çˆ¬å–çš„æ•°æ®æ˜¯å¤šç§å¤šæ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿä¼šç”¨ç©ºæ¥å£æ¥å®ç°æ•°æ®å­˜å‚¨çš„æ‹“å±•æ€§ã€‚

å¯ä»¥çœ‹å‡ºï¼Œç©ºæ¥å£ä¸ºAPIå¸¦æ¥äº†æ‰©å±•æ€§å’Œçµæ´»æ€§ï¼Œä½†æ˜¯ä¹Ÿä¸ºæ¨¡å—çš„å†…éƒ¨å¤„ç†å¢åŠ äº†é¢å¤–çš„æˆæœ¬ã€‚å› ä¸ºAPIå†…éƒ¨å¤„ç†ç©ºæ¥å£æ—¶ä½¿ç”¨äº†å¤§é‡çš„åå°„ï¼Œè€Œåå°„é€šå¸¸æ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå½“æˆ‘ä»¬JSONåºåˆ—åŒ–ä¸€ä¸ªå¤æ‚çš„ç»“æ„ä½“æ—¶ï¼Œæœ‰æ—¶å€™ä¼šæœ‰ä¸Šç™¾æ¯«ç§’çš„è€—æ—¶ã€‚

### ç©ºæ¥å£ä¸åå°„

ç©ºæ¥å£æ˜¯å®ç°åå°„çš„åŸºç¡€ï¼Œå› ä¸ºç©ºæ¥å£ä¸­ä¼šå­˜å‚¨åŠ¨æ€ç±»å‹çš„ä¿¡æ¯ï¼Œè¿™ä¸ºæˆ‘ä»¬æä¾›äº†å¤æ‚ã€æ„æƒ³ä¸åˆ°çš„å¤„ç†èƒ½åŠ›å’Œçµæ´»æ€§ã€‚æˆ‘ä»¬å¯ä»¥è·å–ç»“æ„ä½“å˜é‡å†…éƒ¨çš„æ–¹æ³•åã€å±æ€§åï¼Œèƒ½å¤ŸåŠ¨æ€åœ°æ£€æŸ¥å‡½æ•°æˆ–æ–¹æ³•çš„å‚æ•°ä¸ªæ•°å’Œè¿”å›å€¼ä¸ªæ•°ï¼Œä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡å‡½æ•°ååŠ¨æ€è°ƒç”¨å‡½æ•°ã€‚è¿™äº›èƒ½åŠ›ä¸ä½¿ç”¨åå°„éƒ½æ— æ³•åšåˆ°ã€‚

ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå‡å¦‚ç°åœ¨æœ‰ä¸€ä¸ª Student ç»“æ„ä½“ï¼š

```plain
type Student struct {
	Age int
	Name string
}
```

å¦‚æœæˆ‘ä»¬å¸Œæœ›å†™ä¸€ä¸ªå¯ä»¥å°†è¯¥ç»“æ„ä½“è½¬æ¢ä¸ºSQLè¯­å¥çš„å‡½æ•°ï¼ŒæŒ‰ç…§è¿‡å»çš„å®ç°æ–¹å¼ï¼Œå¯ä»¥ä¸ºè¿™ä¸ªç»“æ„ä½“æ·»åŠ ä¸€ä¸ªCreateSQLæ–¹æ³•ï¼š

```plain
func (s*Student) CreateSQL() string{
	sql := fmt.Sprintf("insert into student values(%d, %s)", s.Age, s.Name)
	return sql
}
```

è¿™æ ·å½“è°ƒç”¨CreateSQLæ–¹æ³•æ—¶ï¼Œå¯ä»¥ç”Ÿæˆä¸€æ¡SQLè¯­å¥ï¼š

```plain
func main() {
	o := Student{
		Age: 20,
		Name: "jonson",
	}
	fmt.Println(o.CreateSQL())
}
```

ç»“æœæ‰“å°ä¸ºï¼š

```plain
insert into student values(20, jonson)
```

ä½†æ˜¯ï¼Œå‡å¦‚æˆ‘ä»¬çš„å…¶ä»–ç»“æ„ä½“ä¹Ÿæœ‰ç›¸åŒçš„éœ€æ±‚å‘¢ï¼Ÿå¾ˆæ˜¾ç„¶ï¼ŒæŒ‰ç…§ä¹‹å‰å­¦è¿‡çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªç±»å‹éƒ½æ·»åŠ ä¸€ä¸ªCreateSQLæ–¹æ³•ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæ¥å£ï¼š

```plain
type SQL interface{
	func CreateSQL() string
}
```

è¿™ç§æ–¹æ³•åœ¨é¡¹ç›®åˆæœŸï¼Œä»¥åŠç»“æ„ä½“ç±»å‹ç®€å•çš„æ—¶å€™æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„ã€‚ä½†æ˜¯å¦‚æœé¡¹ç›®ä¸­å®šä¹‰çš„ç±»å‹éå¸¸å¤šï¼Œè€Œä¸”å¯èƒ½å½“å‰ç±»å‹è¿˜æ²¡æœ‰è¢«åˆ›å»ºå‡ºæ¥ï¼ˆéœ€è¦è¿è¡Œæ—¶åˆ›å»ºï¼Œæˆ–è€…é€šè¿‡è¿œç¨‹è¿‡ç¨‹è°ƒç”¨è§¦å‘ï¼‰ï¼Œæˆ‘ä»¬å°±è¦ä¹¦å†™å¾ˆå¤šé€»è¾‘ç›¸åŒçš„é‡å¤ä»£ç ã€‚æœ‰æ²¡æœ‰ä¸€ç§æ›´åŠ ç®€å•é€šç”¨çš„åŠæ³•å¯ä»¥è§£å†³è¿™ä¸€ç±»é—®é¢˜å‘¢ï¼Ÿå¦‚æœå¯ä»¥åœ¨è¿è¡Œæ—¶æ¢æµ‹åˆ°ç»“æ„ä½“å˜é‡ä¸­çš„æ–¹æ³•åå°±å¥½äº†ã€‚

è¿™æ°æ°å°±æ˜¯åå°„ä¸ºæˆ‘ä»¬æä¾›çš„ä¾¿åˆ©ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢çš„åœºæ™¯æ”¹é€ æˆåå°„çš„å½¢å¼ã€‚åœ¨createQueryå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ é€’ä»»ä½•çš„ç»“æ„ä½“ç±»å‹ï¼Œè¯¥å‡½æ•°ä¼šéå†ç»“æ„ä½“ä¸­æ‰€æœ‰çš„å­—æ®µï¼Œå¹¶æ„é€ Queryå­—ç¬¦ä¸²ã€‚

```plain
func createQuery(q interface{}) string{
	// åˆ¤æ–­ç±»å‹ä¸ºç»“æ„ä½“
	if reflect.ValueOf(q).Kind() == reflect.Struct {
		// è·å–ç»“æ„ä½“åå­—
		t := reflect.TypeOf(q).Name()
		// æŸ¥è¯¢è¯­å¥
		query := fmt.Sprintf("insert into %s values(", t)
		v := reflect.ValueOf(q)
		// éå†ç»“æ„ä½“å­—æ®µ
		for i := 0; i < v.NumField(); i++ {
			// åˆ¤æ–­ç»“æ„ä½“ç±»å‹
			switch v.Field(i).Kind() {
			case reflect.Int:
				if i == 0 {
					query = fmt.Sprintf("%s%d", query, v.Field(i).Int())
				} else {
					query = fmt.Sprintf("%s, %d", query, v.Field(i).Int())
				}
			case reflect.String:
				if i == 0 {
					query = fmt.Sprintf("%s\\"%s\\"", query, v.Field(i).String())
				} else {
					query = fmt.Sprintf("%s, \\"%s\\"", query, v.Field(i).String())
				}
				...
			}
		}
		query = fmt.Sprintf("%s)", query)
		fmt.Println(query)
		return query
	}
}
```

ç°åœ¨ï¼Œå‡è®¾æˆ‘ä»¬æ–°å»ºäº†ä¸€ä¸ªTradeç»“æ„ä½“ï¼Œä»»æ„ç»“æ„ä½“éƒ½å¯ä»¥é€šè¿‡createQueryæ–¹æ³•å®Œæˆæ„å»ºè¿‡ç¨‹ã€‚

```plain
type Trade struct {
	tradeId int
	Price int
}

func main(){
	createQuery(Student{Age: 20, Name: "jonson",})
	createQuery(Trade{tradeId: 123, Price: 456,})
}
```

ç»“æœè¾“å‡ºä¸ºï¼š

```plain
insert into Student values(20, "jonson")
insert into Trade values(123, 456)
```

é€šè¿‡åå°„ï¼Œæˆ‘ä»¬åŠ¨æ€è·å–åˆ°äº†ç»“æ„ä½“ä¸­å­—æ®µçš„åå­—ï¼Œè¿™æ ·å°±å¯ä»¥çµæ´»ç”ŸæˆSQLè¯­å¥äº†ã€‚  
å¦‚æœæˆ‘ä»¬æŠŠä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­çš„å‡½æ•°æ”¹é€ ä¸ºé€’å½’ï¼Œç„¶åå¤„ç†æ›´å¤šçš„ç±»å‹ï¼Œè¿™ä¸ªå‡½æ•°å°†æ›´åŠ å…·å¤‡é€šç”¨æ€§ï¼Œç”šè‡³å¯ä»¥ä½œä¸ºä¸€ä¸ªå¥½ç”¨çš„ç¬¬ä¸‰æ–¹åº“äº†ã€‚

## æ¥å£çš„é™·é˜±

åˆšæ‰æˆ‘ä»¬è¯´äº†æ¥å£çš„å¾ˆå¤šå¥½å¤„ï¼Œä½†æ˜¯ç”±äºæ¥å£çš„ç‰¹æ€§å’Œå†…éƒ¨å®ç°ï¼Œä½¿ç”¨æ¥å£æ—¶ä¹Ÿå®¹æ˜“å‡ºç°å‡ ç±»ç»å…¸çš„é”™è¯¯ã€‚

**ç¬¬ä¸€ç±»é”™è¯¯æ˜¯ï¼Œå½“æ¥å£ä¸­å­˜å‚¨çš„æ˜¯å€¼ï¼Œä½†æ˜¯ç»“æ„ä½“æ˜¯æŒ‡é’ˆæ—¶ï¼Œæ¥å£åŠ¨æ€è°ƒç”¨æ— æ³•ç¼–è¯‘é€šè¿‡ã€‚**å¦‚ä¸‹æ‰€ç¤ºï¼š

```plain
type Binary struct {
	uint64
}
type Stringer interface {
	String() string
}
func (i *Binary) String() string {
	return "hello world"
}
func main(){
	a:= Binary{54}
	b := Stringer(a)
	b.String()
}
```

Go è¯­è¨€åœ¨ç¼–è¯‘æ—¶é˜»æ­¢äº†è¿™æ ·çš„å†™æ³•ï¼ŒåŸå› åœ¨äºè¿™ç§å†™æ³•ä¼šè®©äººäº§ç”Ÿå›°æƒ‘ã€‚å¦‚æœè½¬æ¢ä¸ºæ¥å£çš„æ˜¯å€¼ï¼Œ é‚£ä¹ˆç”±äºå†…å­˜é€ƒé€¸ï¼Œåœ¨è½¬æ¢ä¸ºæ¥å£æ—¶å¿…å®šå·²ç»æŠŠå€¼æ‹·è´åˆ°äº†å †åŒºã€‚å› æ­¤å¦‚æœå…è®¸è¿™ç§å†™æ³•å­˜åœ¨ï¼Œé‚£ä¹ˆå³ä¾¿çœ‹èµ·æ¥åœ¨æ–¹æ³•ä¸­ä¿®æ”¹äº†æ¥å£ä¸­çš„å€¼ï¼Œå´æ— æ³•ä¿®æ”¹åŸå§‹å€¼ï¼Œè¿™éå¸¸å®¹æ˜“å¼•èµ·è¯¯è§£ã€‚

**ç¬¬äºŒç±»é”™è¯¯æ˜¯å°†ç±»å‹åˆ‡ç‰‡è½¬æ¢ä¸ºæ¥å£åˆ‡ç‰‡ã€‚**å¦‚ä¸‹æ‰€ç¤ºï¼š

```plain
func foo() []interface{} {
	return []int{1,2,3}
}
```

è¿™ç§æƒ…å†µä»ç„¶ä¼šåœ¨ç¼–è¯‘æ—¶æŠ¥é”™ï¼š

```plain
cannot use []int literal (type []int) as type []interface {} in return argument
```

Go è¯­è¨€ç¦æ­¢äº†è¿™ç§å†™æ³•ï¼Œå°±åƒå‰é¢æ‰€è¯´çš„ï¼Œæ‰¹é‡è½¬æ¢ä¸ºæ¥å£æ˜¯æ•ˆç‡éå¸¸ä½çš„æ“ä½œã€‚å› ä¸ºæ¯ä¸ªå…ƒç´ éƒ½éœ€è¦å®Œæˆå†…å­˜é€ƒé€¸çš„é¢å¤–å¼€é”€ã€‚

**æ¥å£çš„ç¬¬ä¸‰ç±»é™·é˜±æ¶‰åŠæ¥å£ä¸nilä¹‹é—´çš„å…³ç³»ã€‚å½“æ¥å£ä¸ºnilæ—¶ï¼Œæ¥å£ä¸­çš„åŠ¨æ€ç±»å‹itabå’ŒåŠ¨æ€ç±»å‹å€¼dataå¿…é¡»éƒ½ä¸ºnilï¼Œåˆå­¦è€…å¸¸å¸¸ä¼šåœ¨è¿™ä¸ªé—®é¢˜ä¸ŠçŠ¯é”™ã€‚**ä¾‹å¦‚åœ¨ä¸‹é¢çš„fooå‡½æ•°ä¸­ï¼Œç”±äºè¿”å›çš„erræ²¡æœ‰ä»»ä½•åŠ¨æ€ç±»å‹å’ŒåŠ¨æ€å€¼ï¼Œå› æ­¤errç­‰äºnilã€‚

```plain
func foo() error {
	var err error // nil
	return err
}
func main() {
	err := foo()
	fmt.Println(err == nil) // true
}
```

ç„¶è€Œï¼Œå¦‚æœåœ¨fooå‡½æ•°ä¸­å°†é”™è¯¯ç±»å‹å®šä¹‰ä¸ºè‡ªå®šä¹‰ç±»å‹ï¼Œä¾‹å¦‚\*os.PathError ï¼Œæˆ‘ä»¬ä¼šå‘ç°errä¸ç­‰äºnilã€‚

```plain
func foo() error {
	var err *os.PathError 
	return err
}
func main() {
	err := foo()
	fmt.Println(err != nil) // true
}
```

è¿™æ˜¯å› ä¸ºå½“æ¥å£ä¸ºnilæ—¶ï¼Œä»£è¡¨æ¥å£ä¸­çš„åŠ¨æ€ç±»å‹å’ŒåŠ¨æ€ç±»å‹å€¼éƒ½ä¸ºnilï¼Œè€Œå½“å‰ç”±äºæ¥å£errorå…·æœ‰åŠ¨æ€ç±»å‹\*os.PathErrorï¼Œæ¥å£çš„å†…éƒ¨ç»“æ„ä½“itabä¸ä¸ºç©ºã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/2f/91/2fb59aa910354e519df6070080cf3d91.jpg?wh=1920x752)

é¿å…è¿™ä¸€é—®é¢˜éœ€è¦è°¨æ…åœ°ä½¿ç”¨è‡ªå®šä¹‰çš„Errorä½œä¸ºå®šä¹‰ï¼Œè€Œæ›´å¤šçš„ä½¿ç”¨å†…ç½®çš„errors.Newæˆ–fmt.Errorfæ¥ç”Ÿæˆå’ŒåŒ…è£¹é”™è¯¯ã€‚æˆ‘åœ¨ä¹‹åçš„è¯¾ç¨‹è¿˜ä¼šè¯¦ç»†ä»‹ç»é”™è¯¯å¤„ç†çš„æœ€ä½³å®è·µã€‚

## æ€»ç»“

è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæ¨¡æ‹Ÿæµè§ˆå™¨è®¿é—®çš„æ¡ˆä¾‹å®æˆ˜äº†é‡‡é›†å¼•æ“çš„æŠ½è±¡ã€‚**ç”±äºUser-Agentæ ‡è¯†äº†åº”ç”¨ç¨‹åºçš„ç±»å‹å’Œç‰ˆæœ¬ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†User-Agentè®¾ç½®æˆäº†çœŸå®æµè§ˆå™¨çš„å€¼ï¼Œç»•è¿‡äº†è¿™ä¸ªä¾‹å­ä¸­æœåŠ¡å™¨çš„åçˆ¬æœºåˆ¶ã€‚**ä¸è¿‡è¿™åªæ˜¯ä¼—å¤šåçˆ¬æœºåˆ¶ä¸­æœ€ç®€å•çš„ä¸€ç§ï¼Œé€šè¿‡å¯¹é‡‡é›†å¼•æ“æ¥å£çš„æŠ½è±¡ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ¯”è¾ƒè½»æ¾åœ°å®ç°é‡‡é›†å¼•æ“çš„åˆ‡æ¢ï¼Œå¹¶è¿›è¡Œæ¨¡å—åŒ–çš„æµ‹è¯•ã€‚

å¸¦æ–¹æ³•çš„æ¥å£å¸®åŠ©æˆ‘ä»¬å®Œæˆäº†åŠŸèƒ½çš„æ¨¡å—åŒ–ï¼Œè€Œä¸å¸¦æ–¹æ³•çš„ç©ºæ¥å£åˆ™å¢åŠ äº†APIçš„æ‰©å±•æ€§ã€‚åŒæ—¶ï¼Œç©ºæ¥å£æ˜¯åå°„å®ç°çš„åŸºç¡€ï¼Œæœ‰äº†å®ƒæˆ‘ä»¬æ‰èƒ½æœ‰â€œè·å–å­—æ®µåâ€ã€â€œé€šè¿‡å‡½æ•°ååŠ¨æ€è°ƒç”¨æ–¹æ³•â€è¿™æ ·å¤æ‚çµæ´»çš„èƒ½åŠ›ï¼Œå› æ­¤ç©ºæ¥å£åœ¨ä¸€äº›åŸºç¡€åº“ã€RPCæ¡†æ¶ä¸­çš„åº”ç”¨ä¹Ÿéå¸¸å¹¿æ³›ã€‚

ä¸è¿‡ç©ºæ¥å£å¸¦ç»™æˆ‘ä»¬çš„æ‰©å±•æ€§ä¹Ÿæœ‰ä¸€å®šçš„ä»£ä»·ï¼Œé‚£å°±æ˜¯å®ƒçš„å†…éƒ¨éœ€è¦è§£æç¹ççš„å¤šç§ç±»å‹ï¼Œä½¿ç”¨åå°„å¯¼è‡´æ•ˆç‡å˜ä½ã€‚

## è¯¾åé¢˜

æœ€åï¼Œæˆ‘ä¹Ÿç»™ä½ ç•™ä¸€é“æ€è€ƒé¢˜ã€‚

å¦‚æœä¸€ä¸ªç½‘ç«™éœ€è¦ç™»å½•æ‰å¯ä»¥è®¿é—®ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•å®ç°è‡ªåŠ¨ç™»å½•çš„èƒ½åŠ›ï¼Ÿ

æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºä¸æˆ‘äº¤æµè®¨è®ºï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ15ï¼‰</strong></div><ul>
<li><span>å“ˆå“ˆå“ˆå“ˆå“ˆ</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>éº»çƒ¦å‘ä¸ªå…¨éƒ¨ä»£ç é“¾æ¥ã€‚å°ç™½ï¼Œä¸€æ®µä¸€æ®µä»£ç çœ‹ç€ä¸æ˜¯å¾ˆæ‡‚</p>2022-11-27</li><br/><li><span>Realm</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ4ï¼‰<p>&quot;ç¬¬ä¸€ç±»é”™è¯¯æ˜¯ï¼Œå½“æ¥å£ä¸­å­˜å‚¨çš„æ˜¯å€¼ï¼Œä½†æ˜¯ç»“æ„ä½“æ˜¯æŒ‡é’ˆæ—¶ï¼Œæ¥å£åŠ¨æ€è°ƒç”¨æ— æ³•ç¼–è¯‘é€šè¿‡ã€‚&quot; æ¥å£ä¸­å­˜å‚¨çš„æ˜¯å€¼ï¼Œç»“æ„ä½“æ˜¯æŒ‡é’ˆï¼Œè¿™å¥èƒ½å±•å¼€è¯´è¯´å—ï¼Ÿä¸æ˜¯ç‰¹åˆ«æ˜ç™½ã€‚</p>2022-11-29</li><br/><li><span>shuff1e</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å“¥ï¼Œæ›´æ–°é€Ÿåº¦èƒ½ä¸èƒ½å¿«äº›ï¼Ÿ</p>2022-11-28</li><br/><li><span>å¶ç»˜è½</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>
æ–‡ä¸­æœ‰ä¸€æ®µä»£ç 

func findExecPath() string
...

çœ‹èµ·æ¥ä¸æ–‡ç« å†…å®¹æ¯«æ— å…³è”ï¼Œä¸çŸ¥é“ä¸ºä½•è´´ä¸Šæ¥ã€‚
</p>2022-12-16</li><br/><li><span>å¹å£å“¨yu</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>ä¸ºå•¥ BaseFetch çš„ Get å†™æˆ  func (BaseFetch) Get(...)ï¼Œ
è€Œä¸å†™æˆ func (b *BaseFetch) Get(...) ?
</p>2022-12-03</li><br/><li><span>Calabash</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>ä»£ç åœ¨å“ªé‡Œ</p>2022-11-28</li><br/><li><span>å“ˆå“ˆå“ˆå“ˆå“ˆ</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<p>utf8Reader := transform.NewReader(bodyReader, e.NewDecoder())ï¼Œâ€transform.NewReaderâ€œè¿™æ˜¯ä»å“ªå†’å‡ºæ¥çš„ã€‚æœ¬äººåˆšå­¦ï¼ŒåŸæ–‡ä¸­ä¸æ–¹ä¾¿è´´å‡ºå…¨éƒ¨ä»£ç ï¼Œéº»çƒ¦è´´ä¸ªé“¾æ¥æˆ‘æ…¢æ…¢çœ‹ã€‚</p>2022-11-27</li><br/><li><span>èŒƒé£æ‰¬</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>tagæ˜¯å¤šå°‘ï¼Ÿ</p>2022-11-27</li><br/><li><span>å¥•</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>ä½¿ç”¨ chromedp å¿…é¡»è¦å•ç‹¬å®‰è£… Chrome æµè§ˆå™¨å—ï¼Ÿå†…éƒ¨èƒ½ä¸èƒ½ç›´æ¥é›†æˆï¼Ÿåœ¨æœåŠ¡å™¨ä¸Šæ˜¯ä¸èƒ½ç›´æ¥å®‰è£…çš„</p>2022-11-26</li><br/><li><span>å¾æµ·æµª</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>å¦‚æœä¸€ä¸ªç½‘ç«™éœ€è¦ç™»å½•æ‰å¯ä»¥è®¿é—®ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•å®ç°è‡ªåŠ¨ç™»å½•çš„èƒ½åŠ›ï¼Ÿ
1ã€é€šå¸¸éƒ½æœ‰éªŒè¯ç ï¼Œå…ˆè·å–éªŒè¯ç å›¾ç‰‡ï¼Œç„¶åè¯†åˆ«ä¸ºæ–‡å­—ï¼Œç„¶åå¸¦ç”¨æˆ·åå¯†ç åŠéªŒè¯ç è¯·æ±‚ç™»å½•æ¥å£ã€‚
2ã€æœ‰çš„æ˜¯æ»‘å—ï¼Œå¯ä»¥ä½¿ç”¨webdriverè°ƒç”¨æµè§ˆå™¨æ¥å®Œæˆ; å…¶ä»–ç”Ÿç‰©è¯†åˆ«çš„ï¼Œå¯ä»¥ç”¨å¼¹å‡ºæµè§ˆå™¨ç„¶åäººå·¥ç™»å½•åç»§ç»­ã€‚
ç™»å½•æˆåŠŸåä¿å­˜cookieç»™åç»­çš„æµè§ˆå™¨ä½¿ç”¨ã€‚</p>2022-11-28</li><br/><li><span>0mfg</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>æ•²ä¸€éè·‘ä¸€éåŸºæœ¬å­¦ä¼šåå°„äº†ï¼ŒcreateQueryè¿›æœ¬äººè°ƒè¯•å¯æ­£å¸¸è¿è¡Œç‰ˆæœ¬

package main

import (
	&quot;fmt&quot;
	&quot;reflect&quot;
)

type Student struct {
	Name string
	Age  int
}

type Trade struct {
	tradeId int
	Price   int
}

func createQuery(q interface{}) string {
	var query string
	if reflect.TypeOf(q).Kind() == reflect.Struct { &#47;&#47;å¦‚æœqæ˜¯ç»“æ„ä½“
		t := reflect.TypeOf(q).Name()
		query = fmt.Sprintf(&quot;insert into %s values(&quot;, t) &#47;&#47;æ‹¼æ¥å‡ºinsert into student values(
		v := reflect.ValueOf(q)

		for i := 0; i &lt; v.NumField(); i++ {
			switch v.Field(i).Kind() {
			case reflect.Int:
				if i == 0 {
					query = fmt.Sprintf(&quot;%s%d&quot;, query, v.Field(i).Int()) &#47;&#47;æ‹¼æ¥å‡ºinsert into student values(20
				} else {
					query = fmt.Sprintf(&quot;%s, %d&quot;, query, v.Field(i).Int()) &#47;&#47;æ‹¼æ¥å‡ºinsert into student values(jonson, 20)
				}
			case reflect.String:
				if i == 0 {
					query = fmt.Sprintf(&quot;%s%s&quot;, query, v.Field(i).String()) &#47;&#47;æ‹¼æ¥å‡ºinsert into student values(jonson
				} else {
					query = fmt.Sprintf(&quot;%s, %s&quot;, query, v.Field(i).String()) &#47;&#47;æ‹¼æ¥å‡ºinsert into student values(20, jonson
				}
			}
		}
		query = fmt.Sprintf(&quot;%s)&quot;, query)
		fmt.Println(query)
	}
	return query
}

func main() {
	createQuery(Student{Name: &quot;jonson&quot;, Age: 20})
	createQuery(Trade{tradeId: 123, Price: 456})
}
</p>2022-11-28</li><br/><li><span>æ–¯è’‚èŠ¬.èµµ</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>ä½¿ç”¨chromedpæ¨¡æ‹Ÿæµè§ˆå™¨è¡Œä¸ºï¼Œæ˜¯ä¸æ˜¯å¾ˆè€—cpuï¼Œå‡è®¾æœ‰10ä¸ªé“¾æ¥ï¼Œé€šè¿‡æºç¨‹å¹¶å‘å»çˆ¬ï¼Œcpuä¸€ä¸‹å°±æ‰“æ»¡äº†ï¼Œè¿™ç§å’‹è§£å†³
</p>2024-05-31</li><br/><li><span>Bengå“å’”å•¦å’”</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>æ–‡ä¸­å“ªæœ‰æ³¨æ˜tagåˆ†æ”¯ï¼Œæ‰¾äº†å‡ éæ²¡æœ‰çœ‹åˆ°</p>2023-05-24</li><br/><li><span>Geek_c16d38</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>é€™ä¸€ç¯€æœ‰ä»£ç¢¼å—ï¼Ÿåœ¨é‚£ä¸€å€‹åˆ†æ”¯ï¼Ÿ</p>2022-12-20</li><br/><li><span>Geek_992417</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>chromedpå¯¹æ¯”playwrightå¦‚ä½•å‘¢ï¼Œè¿˜æœ‰å“ªäº›ç±»ä¼¼çš„å¥½ç”¨çš„åº“å‘¢</p>2024-06-03</li><br/>
</ul>