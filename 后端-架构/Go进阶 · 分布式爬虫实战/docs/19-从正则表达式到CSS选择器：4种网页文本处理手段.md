ä½ å¥½ï¼Œæˆ‘æ˜¯éƒ‘å»ºå‹‹ã€‚

åœ¨ä¸Šä¸€èŠ‚è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†Go Modulesä¾èµ–ç®¡ç†çš„ä½¿ç”¨æ–¹æ³•å’ŒåŸç†ï¼Œè¿™æœ‰åŠ©äºæˆ‘ä»¬åœ¨åæœŸç®¡ç†é¡¹ç›®çš„å¤æ‚ä¾èµ–ã€‚æˆ‘ä¹‹æ‰€ä»¥æå‰ä»‹ç»ä¾èµ–ç®¡ç†ï¼Œæ˜¯å› ä¸ºæ–°é¡¹ç›®ä¸€å¼€å§‹ä¸€èˆ¬å°±ä¼šé€šè¿‡go mod initåˆå§‹åŒ–å½“å‰é¡¹ç›®çš„moduleåã€‚

æˆ‘ä»¬ä¹‹å‰ä¹Ÿçœ‹åˆ°äº†å¦‚ä½•åœ¨Goä¸­é€šè¿‡ç®€å•çš„å‡½æ•°è°ƒç”¨è·å–ç½‘é¡µä¸­çš„æ•°æ®ã€‚ç„¶è€Œå•å•è·å–æœåŠ¡å™¨è¿”å›çš„æ–‡æœ¬æ•°æ®æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œä¿¡æ¯å’ŒçŸ¥è¯†å°±éšè—åœ¨è¿™äº›æ‚ä¹±çš„æ•°æ®ä¹‹ä¸­ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æœ‰æ¯”è¾ƒå¼ºçš„æ–‡æœ¬è§£æèƒ½åŠ›ï¼Œå°†æœ‰ç”¨çš„ä¿¡æ¯æå–å‡ºæ¥ã€‚è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹å¦‚ä½•é€šè¿‡Goæ ‡å‡†åº“ã€æ­£åˆ™è¡¨è¾¾å¼ã€XPathä»¥åŠCSSé€‰æ‹©å™¨å¯¹å¤æ‚æ–‡æœ¬è¿›è¡Œè§£æã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨ä»»æ„ä½ç½®æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼š

```plain
>  mkdir crawler
```

å†æ–°å»ºä¸€ä¸ªå…¥å£æ–‡ä»¶ï¼š

```plain
> cd crawler
> touch main.go
```

## **åˆå§‹åŒ–Gitä»“åº“**

æˆ‘å…ˆåœ¨GitHubä¸Šåˆ›å»ºäº†ä¸€ä¸ªGitä»“åº“ï¼Œåå­—å«crawlerã€‚æ¥ç€ï¼Œæˆ‘åœ¨æœ¬åœ°æ–°å»ºäº†ä¸€ä¸ªREADMEæ–‡ä»¶ï¼Œå¹¶å»ºç«‹äº†æœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“ä¹‹é—´çš„å…³è”ï¼ˆä½ éœ€è¦å°†ä¸‹é¢çš„ä»“åº“åœ°å€æ›¿æ¢ä¸ºè‡ªå·±çš„ï¼‰ï¼š

```plain
echo "# crawler" >> README.md
git init
git add README.md
git commit -m "first commit"
git branch -M 'main'
git remote add origin git@github.com:dreamerjackson/crawler.git
git push -u origin 'main'
```
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ13ï¼‰</strong></div><ul>
<li><img src="" width="30px"><span>0mfg</span> ğŸ‘ï¼ˆ5ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<div>æ¾æ¹ƒæ–°é—»é¦–é¡µåº”è¯¥æ˜¯æ”¹ç‰ˆäº†ï¼ŒåŸæ¥çš„ä¾‹å­æŠ“ä¸åˆ°å†…å®¹ï¼ŒæŒ‰ç…§è€å¸ˆçš„æ€è·¯æŠ“åˆ°ç°åœ¨æ¨èå¡ç‰‡é‡Œçš„æ–°é—»æ ‡é¢˜ï¼Œäº¤ä½œä¸šäº†
package main

import (
	&quot;bufio&quot;
	&quot;fmt&quot;
	&quot;io&#47;ioutil&quot;
	&quot;net&#47;http&quot;
	&quot;regexp&quot;

	&quot;golang.org&#47;x&#47;net&#47;html&#47;charset&quot;
	&quot;golang.org&#47;x&#47;text&#47;encoding&quot;
	&quot;golang.org&#47;x&#47;text&#47;encoding&#47;unicode&quot;
	&quot;golang.org&#47;x&#47;text&#47;transform&quot;
)
var headerRe = regexp.MustCompile(`&lt;div class=&quot;small_cardcontent__BTALp&quot;[\s\S]*?&lt;h2&gt;([\s\S]*?)&lt;&#47;h2&gt;`)

func main() {
	url := &quot;https:&#47;&#47;www.thepaper.cn&#47;&quot;

	pageBytes, err:= Fetch(url)

	if err!= nil {
		fmt.Printf(&quot;read content failed %v&quot;, err)
		return
	}

	matches := headerRe.FindAllSubmatch(pageBytes, -1)

	for _, m := range matches {
		fmt.Println(&quot;fetch card news:&quot;, string(m[1]))
	}
}

func Fetch(url string) ([]byte, error) {
	resp, err := http.Get(url)
	if err != nil {
		panic(err)
	}
	defer resp.Body.Close()

	if resp.StatusCode != http.StatusOK {
		fmt.Printf(&quot;Error status code: %v&quot;, resp.StatusCode)
	}
	bodyReader := bufio.NewReader(resp.Body)
	e := DerterminEncoding(bodyReader)   &#47;&#47;utf-8
	utf8Reader := transform.NewReader(bodyReader, e.NewDecoder())
	return ioutil.ReadAll(utf8Reader)
}

func DerterminEncoding(r *bufio.Reader) encoding.Encoding {
	bytes, err := r.Peek(1024)

	if err != nil {
		fmt.Printf(&quot;fetch error: %v&quot;, err)
		return unicode.UTF8
	}

	e, _, _ := charset.DetermineEncoding(bytes, &quot;&quot;)
	return  e
}

è¿è¡Œç»“æœï¼Œfetch card news: é•¿äºŒä¸ç«ç®­70æ¬¡å‘å°„å‘å‘æˆåŠŸï¼Œå°†171é¢—å«æ˜Ÿé€å…¥é¢„å®šè½¨é“
fetch card news: æ—¥æœ¬ä¸»å¸…æ£®ä¿ä¸€é“æ­‰ï¼šå¯¹ä¸èµ·æ”¯æŒæˆ‘ä»¬çš„çƒè¿·ï¼Œå…¨åŠ›å¤‡æˆ˜è¥¿ç­ç‰™
fetch card news: è±ªå®…æ•°ä¸‡â€œå¤©ä»·ç”µè´¹â€ä½•æ¥ï¼Ÿå°æ¹¾åœ°åŒºç”µä»·è°ƒæ¶¨èƒŒåçš„èƒ½æºå›°å±€
fetch card news: å› ç™½ä¿„ç½—æ–¯å¤–é•¿é©¬å…‹ä¼Šå»ä¸–ï¼Œä¿„å¤–é•¿æ¨è¿Ÿè®¿é—®ç™½ä¿„ç½—æ–¯
</div>2022-11-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/75/00/618b20da.jpg" width="30px"><span>å¾æµ·æµª</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>grep -oP &#39;order_id=\d+&#39;|grep -oP &#39;\d+&#39;</div>2022-11-22</li><br/><li><img src="" width="30px"><span>0mfg</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>æ€è€ƒé¢˜ï¼Œmacä¸Šé€šè¿‡grep -oE &#39;order_id=\d+&#39; | grep -oE &#39;\d+&#39;  å¯ä»¥æå–orderid</div>2022-11-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2b/28/22/ebc770dc.jpg" width="30px"><span>å“ˆå“ˆå“ˆå“ˆå“ˆ</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<div>é¡¹ç›®ä»£ç æ”¾å“ªé‡Œäº†ï¼Ÿä¹‹å‰ç•™çš„æ‰¾ä¸ç€äº†</div>2022-11-26</li><br/><li><img src="" width="30px"><span>0mfg</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>å‹˜è¯¯ï¼Œ fmt.Println(&quot;fetch url error:%v&quot;, err)  åº”è¯¥ä¸ºfmt.Printf(&quot;fetch url err:%v\n&quot;, err)å§</div>2022-11-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/27/ed/86/6923277b.jpg" width="30px"><span>çƒŸæ¶ˆäº‘æ•£</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>ç›®å‰ï¼ŒLinux å’Œ Mac åœ¨åŸç”Ÿé›†æˆ GUN å¥—ä»¶ã€‚åº”è¯¥æ˜¯GNUå§</div>2022-11-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg" width="30px"><span>lesserror</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆï¼Œæ¾æ¹ƒæ–°é—»çš„é¦–é¡µæ”¹ç‰ˆäº†ï¼Œä»£ç éœ€è¦è°ƒæ•´äº†ã€‚ä¸ç„¶è¿è¡Œåæ²¡ç»“æœã€‚</div>2022-11-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/9a/0a/6c74e932.jpg" width="30px"><span>å…‰</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>é—®ä¸‹æœ€åè¿™å•ä¸ª return å«ä¹‰æ˜¯å•¥ã€‚
if err != nil {   
 fmt.Println(&quot;fetch url error:%v&quot;, err)    
 return  
}</div>2022-11-25</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIlnTfD7ZMqT6vC6a7NCMySyrO5M2znWDFUYWrA3OeHmuNiaDjpcia4hutyauX74U9UqicT3IV2jo4ew/132" width="30px"><span>Geek_d09597</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>æ›´æ–°ä¹‹åçš„ï¼š

æ­£åˆ™ï¼švar headerRe = regexp.MustCompile(`&lt;div class=&quot;small_cardcontent__BTALp&quot;[\s\S]*?&lt;h2&gt;([\s\S]*?)&lt;&#47;h2&gt;`)

Xpath: nodes := htmlquery.Find(doc, `&#47;&#47;div[@class=&quot;small_cardcontent__BTALp&quot;]&#47;&#47;h2`)

CSSé€‰æ‹©å™¨:  doc.Find(&quot;div.small_cardcontent__BTALp h2&quot;)
</div>2022-12-17</li><br/><li><img src="" width="30px"><span>0mfg</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>å‹˜è¯¯ï¼Œâ€œä¸‹é¢è¿™æ®µä½¿ç”¨ bytes æ ‡å‡†åº“çš„ä»£ç å’Œä¸Šé¢ä½¿ç”¨ strings åº“çš„ä»£ç åœ¨åŠŸèƒ½ä¸Šæ˜¯ç­‰ä»·çš„â€ï¼Œè¯¥å¤„å®ä¾‹ä»£ç åº”è¯¥æ˜¯è¿™æ ·å§
numLinks := bytes.Count(body, []byte(&quot;&lt;a&quot;))
fmt.Printf(&quot;homepage has %d links&quot;, numLinks)

exist := bytes.Contains(body, []byte(&quot;ç–«æƒ…&quot;))
fmt.Println(exist)</div>2022-11-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ce/6d/530df0dd.jpg" width="30px"><span>å¾çŸ³å¤´</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>ç¬¬ä¸€ååº”æ˜¯
arr := strings.Split(data,&quot;||&quot;)
fmtPrintln(arr[1][9:])
</div>2022-11-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/0c/e1/f663213e.jpg" width="30px"><span>æ‹¾æ‡æ‹¾æ‡</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>wowï¼Œç­‰åˆ°äº†ä»£ç é˜¶æ®µäº†ã€‚ã€‚ã€‚å“ˆå“ˆ</div>2022-11-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/55/e7/86ae89f0.jpg" width="30px"><span>Jack</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥å®‰æ’èµ·æ¥äº†</div>2022-11-22</li><br/>
</ul>