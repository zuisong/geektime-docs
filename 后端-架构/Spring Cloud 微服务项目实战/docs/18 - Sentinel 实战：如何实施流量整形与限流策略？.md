ä½ å¥½ï¼Œæˆ‘æ˜¯å§šç§‹è¾°ã€‚

ä»Šå¤©æˆ‘ä»¬æ¥å­¦ä¹ Sentinelç»„ä»¶æœ€ä¸ºæ ¸å¿ƒçš„åŠŸèƒ½ï¼šæµé‡æ•´å½¢ï¼ˆä¹Ÿå¯ä»¥å«æµæ§ï¼‰ã€‚

åœ¨è¿™èŠ‚è¯¾ï¼Œæˆ‘ä¼šé€šè¿‡é¡¹ç›®å®æˆ˜å°†ä¼˜æƒ åˆ¸ç³»ç»Ÿé›†æˆåˆ°Sentinelä¸­ï¼Œå¯¹ç”¨æˆ·é¢†åˆ¸å’ŒæŸ¥æ‰¾ä¼˜æƒ åˆ¸ä¸¤ä¸ªåœºæ™¯æ·»åŠ æµæ§è§„åˆ™ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¼šå¸¦ä½ äº†è§£Sentinelçš„ä¸‰ç§æµæ§æ¨¡å¼ï¼Œä»¥åŠå¯¹åº”çš„æµæ§æ•ˆæœã€‚æ­¤å¤–ï¼Œæˆ‘è¿˜ä¼šé’ˆå¯¹Sentinelæ¡†æ¶åšä¸€ä¸ªå°æ‰©å±•ï¼Œå¯¹ç‰¹å®šçš„è°ƒç”¨æ¥æºåšæµæ§ã€‚æŒæ¡äº†è¿™äº›å†…å®¹ä¹‹åï¼Œä½ å°±å¯ä»¥æ¸…æ¥šå¦‚ä½•ç”¨æµæ§æ‰‹æ®µæ¥é™ä½é«˜å¹¶å‘åœºæ™¯ä¸‹çš„ç³»ç»Ÿå‹åŠ›ã€‚

åœ¨è¿›è¡Œå®æˆ˜é¡¹ç›®ä¹‹å‰ï¼Œæˆ‘éœ€è¦å¸¦ä½ æ­å»ºSentinelæ§åˆ¶å°ã€‚ä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œä¸€ä¸ªä¸­å¿ƒåŒ–çš„æ§åˆ¶ä¸­å¿ƒï¼Œæ‰€æœ‰çš„åº”ç”¨ç¨‹åºéƒ½ä¼šæ¥å…¥è¿™ä¸ªæ§åˆ¶å°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œè®¾ç½®å„ç§æµæ§è§„åˆ™ï¼Œè¿™äº›è§„åˆ™ä¹Ÿä¼šåœ¨åº”ç”¨ç¨‹åºä¸­å®æ—¶ç”Ÿæ•ˆã€‚

## è¿è¡ŒSentinelæ§åˆ¶å°

æˆ‘ä»¬å¯ä»¥ä»[Sentinelå®˜æ–¹GitHub](https://github.com/alibaba/Sentinel/releases)çš„Releaseé¡µé¢ä¸‹è½½å¯ä¾›æœ¬åœ°æ‰§è¡Œçš„jaræ–‡ä»¶ï¼Œä¸ºäº†é¿å…ç‰ˆæœ¬ä¸ä¸€è‡´å¯¼è‡´çš„å…¼å®¹æ€§é—®é¢˜ï¼Œæˆ‘æ¨èä½ ä¸‹è½½1.8.2.Releaseç‰ˆæœ¬ã€‚åœ¨è¯¥ç‰ˆæœ¬ä¸‹çš„Assetséƒ¨åˆ†ï¼Œä½ å¯ä»¥ç›´æ¥ä¸‹è½½sentinel-dashboard-1.8.2.jarè¿™ä¸ªæ–‡ä»¶ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/e6/41/e6d555a468cb66cb0c753c84457ee641.png?wh=911x229)

ä¸‹è½½å¥½æ–‡ä»¶ä¹‹åï¼Œä½ å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œè¿›å…¥åˆ°è¿™ä¸ªjaråŒ…æ‰€åœ¨çš„ç›®å½•ï¼Œç„¶åå°±å¯ä»¥ç›´æ¥æ‰§è¡Œä¸‹é¢è¿™è¡Œå‘½ä»¤å¯åŠ¨Sentinelæ§åˆ¶å°äº†ã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ16ï¼‰</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/c0/ff/9355810e.jpg" width="30px"><span>æµ·å¸ƒé‡Œç‹åŠ›å®</span> ğŸ‘ï¼ˆ5ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>â€œç¬¬äºŒç§æµæ§æ•ˆæœ Warm Up åˆ™å®ç°äº†â€œé¢„çƒ­æ¨¡å¼çš„æµæ§æ•ˆæœâ€ï¼Œè¿™ç§æ–¹å¼å¯ä»¥å¹³ç¼“æ‹‰é«˜ç³»ç»Ÿæ°´ä½ï¼Œé¿å…çªå‘æµé‡å¯¹å½“å‰å¤„äºä½æ°´ä½çš„ç³»ç»Ÿçš„å¯ç”¨æ€§é€ æˆç ´åã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®çš„ç³»ç»Ÿé˜ˆå€¼æ˜¯ QPS=10ï¼Œé¢„çƒ­æ—¶é—´ =5ï¼Œé‚£ä¹ˆ Sentinel ä¼šåœ¨è¿™ 5 ç§’çš„é¢„çƒ­æ—¶é—´å†…ï¼Œå°†é™æµé˜ˆå€¼ä» 3 ç¼“æ…¢æ‹‰é«˜åˆ° 10ã€‚ä¸ºä»€ä¹ˆèµ·å§‹é˜ˆå€¼æ˜¯ 3 å‘¢ï¼Ÿå› ä¸º Sentinel å†…éƒ¨æœ‰ä¸€ä¸ªå†·åŠ è½½å› å­ï¼Œå®ƒçš„å€¼æ˜¯ 3ï¼Œåœ¨é¢„çƒ­æ¨¡å¼ä¸‹ï¼Œèµ·å§‹é˜ˆå€¼çš„è®¡ç®—å…¬å¼æ˜¯å•æœºé˜ˆå€¼ &#47; å†·åŠ è½½å› å­ï¼Œä¹Ÿå°±æ˜¯ 10&#47;3=3ã€‚æˆ‘æˆªäº†ä¸€å¼ å›¾ï¼Œä½ å¯ä»¥å‚è€ƒä¸€ä¸‹ï¼Œçœ‹çœ‹ Warm Up é…ç½®é¡¹æ˜¯å¦‚ä½•å¡«å†™çš„ã€‚â€

æ–°å¹´å¿«ä¹ï¼Œå¯¹é¢„çƒ­è¿˜æ˜¯ä¸ç†è§£ï¼Œå¦‚æœè®¾ç½®äº†é¢„çƒ­ï¼Œæ˜¯ä¸æ˜¯æ„å‘³ç€QPSè¾¾åˆ°é˜ˆå€¼çš„æ—¶å€™ï¼Œä¼šé™ä¸º1&#47;3çš„QPSï¼Œç„¶åå†æ‹‰å‡ã€‚è¿˜æ˜¯è¿™ä¸ªé¢„çƒ­åªæ˜¯é’ˆå¯¹ç³»ç»Ÿçš„å¯åŠ¨é˜¶æ®µï¼Ÿ

</div>2022-02-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/a8/9c/643646b9.jpg" width="30px"><span>wake</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>é…ç½®åº”è¯¥æ˜¯ï¼š

spring:
  cloud:
    sentinel:
      transport:
        # sentinel apiç«¯å£ï¼Œé»˜è®¤8719
        port: 8719
        # dashboardåœ°å€
        dashboard: localhost:8080</div>2022-01-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/2e/74/88c613e0.jpg" width="30px"><span>æ‰¶å¹½</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆè¯·æ•™ä¸‹ï¼Œåœ¨warm-upçš„æ¨¡å¼ä¸‹ï¼Œé˜ˆå€¼åœ¨ä¸æ–­çš„æ”€å‡è¿‡ç¨‹ä¸­ï¼Œå…¶å®ƒè¶…è¿‡å½“å‰æ—¶é—´èŠ‚ç‚¹çš„è¯·æ±‚æ˜¯é€šè¿‡å¿«é€Ÿå¤±è´¥çš„æ–¹å¼è¢«æ‹’ç»äº†å—ï¼Ÿè¿˜æ˜¯è¿›å…¥é˜Ÿåˆ—äº†å‘¢ï¼Ÿ</div>2023-06-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/22/d2/40/2abbda81.jpg" width="30px"><span>Dean</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆå¥½ï¼Œæƒ³å’¨è¯¢ä¸€ä¸‹ç†”æ–­é™æµçš„é˜ˆå€¼å¦‚ä½•ç¡®å®šå…·ä½“çš„å€¼ï¼Œæ˜¯æ‹è„‘è¢‹æƒ³çš„å—ï¼Ÿè¿˜æ˜¯æœ‰ä¸€å®šçš„ç­–ç•¥å»å®šä¹‰</div>2023-06-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/28/d9/31/22fc55ea.jpg" width="30px"><span>Believe</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>å…³è”æµæ§è§„åˆ™ä¸å¾—è¡Œï¼Œä¹Ÿä¸æŠ¥é”™ï¼Œåœ¨ç›´æ¥æµæ§è§„åˆ™ç”Ÿæ•ˆçš„å‰æä¸‹ï¼Œç›´æ¥ä¿®æ”¹ä¸ºå…³è”æµæ§ï¼Œæ·»åŠ å…³è”èµ„æºéƒ½ä¸è¡Œ</div>2023-05-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/79/27/7ac85e6f.jpg" width="30px"><span>ç‹å¿—æˆ</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>æˆ‘åœ¨coupon-calculation-serv é¡¹ç›®ä¸­é›†æˆSentinel çš„æ—¶å€™ï¼ŒæŠ¥äº†Could not bind properties to &#39;SentinelProperties&#39; ã€‚
è¯´æ˜¯ è®©æˆ‘Add an implementation, such as Hibernate Validator, to the classpah

ä¸ºä»€ä¹ˆ Sentinel ä¼šéœ€è¦æ·»åŠ  Hibernate å‘¢ï¼Œå®¢æˆ·ç«¯åœ¨ä½¿ç”¨ Sentinelè¿˜éœ€è¦æŒä¹…åŒ–æ•°æ®å—ï¼Ÿ</div>2022-11-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/7a/5f/c05cd5dc.jpg" width="30px"><span>Ronnie</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>çƒ­ç‚¹è§„åˆ™é…ç½®æ€ä¹ˆå­˜å‚¨å‘¢ï¼Œæ¯”å¦‚ç”¨æˆ·id=1çš„é™æµ20ï¼Œç”¨æˆ·id=2çš„é™æµ30ï¼Œè¿™äº›é…ç½®ä¸å¯èƒ½ä¸€ä¸ªä¸€ä¸ªå»æ§åˆ¶å°é…ç½®å§</div>2022-08-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/b8/71/552e4afb.jpg" width="30px"><span>next station</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>å§šè€å¸ˆï¼Œè¯·æ•™ä¸ªé—®é¢˜ï¼šæµæ§è§„åˆ™--é“¾è·¯æµæ§ï¼Œæ— æ•ˆï¼›ä¹Ÿç™¾åº¦äº†ä¸€ä¸‹ï¼Œé…ç½®spring.cloud.sentinel.web-context-unify=falseæ— æ•ˆã€‚éº»çƒ¦è€å¸ˆæŒ‡å¯¼ä¸€ä¸‹

ä»£ç å¦‚ä¸‹ï¼š

```
    &#47;&#47; è¯»å–ä¼˜æƒ åˆ¸
    @GetMapping(&quot;&#47;getTemplate&quot;)
&#47;&#47;    @SentinelResource(value = &quot;getTemplate&quot;)
    public CouponTemplateInfo getTemplate(@RequestParam(&quot;id&quot;) Long id){
        log.info(&quot;Load template, id={}&quot;, id);
        return couponTemplateService.loadTemplateInfo(id);
    }

    @GetMapping(&quot;&#47;getTemplate1&quot;)
&#47;&#47;    @SentinelResource(value = &quot;getTemplate1&quot;)
    public CouponTemplateInfo getTemplate1(@RequestParam(&quot;id&quot;) Long id){
        log.info(&quot;Load template, id={}&quot;, id);
        return couponTemplateService.loadTemplateInfo(id);
    }


èµ„æº
public interface CouponTemplateService {
    &#47;&#47; é€šè¿‡æ¨¡æ¿IDæŸ¥è¯¢ä¼˜æƒ åˆ¸æ¨¡æ¿
    @SentinelResource(value = &quot;loadTemplateInfo&quot;)
    CouponTemplateInfo loadTemplateInfo(Long id);
}

```</div>2022-06-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1b/71/f0/07c72ca6.jpg" width="30px"><span>å‹¤å¥‹çš„æ¨‚</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è¯·é—®æ·»åŠ æµæ§è§„åˆ™ï¼Œsentinelæ§åˆ¶å°ç›´æ¥å¼¹çª—æ˜¾ç¤ºå¤±è´¥ï¼ŒæŠ¥é”™æ—¥å¿—å¦‚ä¸‹ï¼Œæ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ
2022-05-06 15:37:21.357 ERROR 61049 --- [nio-8081-exec-1] c.a.c.s.d.controller.FlowControllerV1    : Failed to add new flow rule, app=coupon-template-serv, ip=localhost

com.alibaba.csp.sentinel.dashboard.client.CommandFailedException: 

2022-05-06 15:37:22.724 ERROR 61049 --- [Worker-thread-6] c.a.c.s.dashboard.metric.MetricFetcher   : fetch metric http:&#47;&#47;localhost:8081:8719&#47;metric?startTime=1651822634000&amp;endTime=1651822640000&amp;refetch=false error

org.apache.http.client.ClientProtocolException: URI does not specify a valid host name: http:&#47;&#47;localhost:8081:8719&#47;metric?startTime=1651822634000&amp;endTime=1651822640000&amp;refetch=false
	at org.apache.http.impl.nio.client.CloseableHttpAsyncClient.determineTarget(CloseableHttpAsyncClient.java:121) [httpasyncclient-4.1.3.jar!&#47;:4.1.3]
	at org.apache.http.impl.nio.client.CloseableHttpAsyncClient.execute(CloseableHttpAsyncClient.java:102) [httpasyncclient-4.1.3.jar!&#47;:4.1.3]
	at org.apache.http.impl.nio.client.CloseableHttpAsyncClient.execute(CloseableHttpAsyncClient.java:92) [httpasyncclient-4.1.3.jar!&#47;:4.1.3]
	at com.alibaba.csp.sentinel.dashboard.metric.MetricFetcher.fetchOnce(MetricFetcher.java:214) [classes!&#47;:na]
	at com.alibaba.csp.sentinel.dashboard.metric.MetricFetcher.lambda$doFetchAppMetric$3(MetricFetcher.java:282) [classes!&#47;:na]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[na:1.8.0_312]
	at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[na:1.8.0_312]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[na:1.8.0_312]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[na:1.8.0_312]
	at java.lang.Thread.run(Thread.java:748) ~[na:1.8.0_312]

</div>2022-05-06</li><br/><li><img src="" width="30px"><span>Geek_e93c48</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>å§šè€å¸ˆè¯·æ•™ä¸ªé—®é¢˜ï¼ŒSentinelé™æµçš„æ’é˜Ÿæ¨¡å¼ä¸‹ï¼Œä¼šå°†æ‰€æœ‰QOSéƒ½æ’é˜Ÿå—ï¼Ÿè¿˜æ˜¯åªæ˜¯åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„é˜Ÿåˆ—å­˜å‚¨å›ºå®šçš„QPSï¼Œè¶…è¿‡éƒ¨åˆ†ç›´æ¥æŠ›å¼ƒã€‚</div>2022-02-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/34/cf/0a316b48.jpg" width="30px"><span>è´è¶</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>ç°åœ¨å¤©å¤©åŠ ç­ï¼Œæ²¡æ³•å­¦å®è·µï¼Œæˆ‘å…ˆçœ‹å®Œ</div>2022-01-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/d9/4d/4b95a228.jpg" width="30px"><span>ä¸€å¿µä¹‹é—´</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<div>è€å¸ˆ,ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨æ—¶æ‚¨å»ºè®®æ˜¯ç”¨æ³¨è§£æ–¹å¼,è¿˜æ˜¯ç»Ÿä¸€å°è£…åŸºäºsentinelçš„starter</div>2022-01-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/23/96/fb/af39abb1.jpg" width="30px"><span>é»„å¶</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆï¼Œé…ç½®çš„åœ°å€åº”è¯¥æ˜¯spring.cloudä¸‹å§ï¼Œæ–‡ç« æ˜¯åœ¨applicationä¸‹</div>2022-01-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/06/7e/735968e2.jpg" width="30px"><span>è¥¿é—¨å¹ç‰›</span> ğŸ‘ï¼ˆ33ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>é™æµç®—æ³•ï¼šæ»‘åŠ¨çª—å£ï¼Œä»¤ç‰Œæ¡¶ï¼Œæ¼æ¡¶
Sentinel çš„æµé‡æ§åˆ¶æœ‰ä¸‰ç§ï¼š
å¿«é€Ÿå¤±è´¥ï¼šåº”è¯¥é‡‡ç”¨æ»‘åŠ¨çª—å£ç®—æ³•ï¼Œå½“æ»‘åŠ¨æ—¶é—´çª—å£å†…çš„QPSè¶…è¿‡ä¸€å®šçš„é˜€å€¼ï¼ŒSentinel ç›´æ¥æŠ›å‡ºå¼‚å¸¸
æ’é˜Ÿç­‰å¾…ï¼šé‡‡ç”¨æ¼æ¡¶ç®—æ³•ï¼Œæ‰€æœ‰è¯·æ±‚æ•°æ®åŒ…è¿›å…¥æ¼æ¡¶è¿›å…¥æ’é˜Ÿç­‰å¾…ï¼Œæ¼æ¡¶ä»¥ä¸€å®šçš„é€Ÿç‡æ”¾è¡Œï¼Œè¾¾åˆ°åŒ€é€Ÿçš„æ•ˆæœçš„
Warm Upï¼šé‡‡ç”¨ä»¤ç‰Œæ¡¶ç®—æ³•ï¼ŒåŠ¨æ€çš„è°ƒæ•´ä»¤ç‰Œæ¡¶çš„å®¹é‡å¤§å°ï¼Œè¾¾åˆ°é¢„çƒ­çš„æ•ˆæœ
</div>2022-01-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1b/71/f0/07c72ca6.jpg" width="30px"><span>å‹¤å¥‹çš„æ¨‚</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è®°ä¸€ä¸ªå‘ï¼Œæˆ‘æœ¬åœ°å¯åŠ¨sentinelåï¼Œæ§åˆ¶å°æ¥å£ç»‘å®šåœ¨8081ç«¯å£ï¼Œtemplateæ¨¡å—æ¥å£æ³¨è§£@SentinelResource(value=&quot;getTemplate&quot;)åï¼Œè°ƒç”¨æ¥å£ï¼Œsentinelæ§åˆ¶å°ä¸æ˜¾ç¤ºæœåŠ¡ï¼Œéœ€è¦é…ç½®clientIpåsentinelæ‰èƒ½æ­£ç¡®æ˜¾ç¤ºåˆšåˆšé…ç½®çš„æœåŠ¡ï¼š
sentinel:
      transport:
        # sentinel apiç«¯å£ï¼Œé»˜è®¤8719
        port: 8719
        # dashboardåœ°å€
        dashboard: localhost:8081
        clientIp: localhost:8081</div>2022-05-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1c/f4/c7/037235c9.jpg" width="30px"><span>kimoti</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>åº•å±‚åº”è¯¥æ˜¯ä»¤ç‰Œæ¡¶ç®—æ³•</div>2022-01-21</li><br/>
</ul>