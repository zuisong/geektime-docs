ä½ å¥½ï¼Œæˆ‘æ˜¯éƒ­å±¹ã€‚ä»Šå¤©æˆ‘ä»¬ç»§ç»­æ‰‹å†™MiniSpringï¼Œè¿™èŠ‚è¯¾æˆ‘ä»¬è®¨è®ºä¼ å…¥å‚æ•°çš„è½¬æ¢é—®é¢˜ã€‚

ä¸ŠèŠ‚è¯¾ï¼Œæˆ‘ä»¬å·²ç»åŸºæœ¬å®Œæˆäº†å¯¹Dispatcherçš„æ‰©å±•ï¼Œç”¨HanderMappingæ¥å¤„ç†æ˜ å°„å…³ç³»ï¼Œç”¨HandlerAdapteræ¥å¤„ç†æ˜ å°„åå…·ä½“æ–¹æ³•çš„è°ƒç”¨ã€‚

åœ¨å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç”¨ServletRequestæ¥æ”¶è¯·æ±‚å‚æ•°ï¼Œè€Œè·å–å‚æ•°ç”¨çš„æ˜¯getParameter()æ–¹æ³•ï¼Œå®ƒçš„è¿”å›å€¼æ˜¯Stringå­—ç¬¦ä¸²ï¼Œè¿™ä¹Ÿæ„å‘³ç€æ— è®ºæ˜¯è·å–å­—ç¬¦ä¸²å‚æ•°ã€æ•°å­—å‚æ•°ï¼Œè¿˜æ˜¯å¸ƒå°”å‹å‚æ•°ï¼Œå®ƒè·å–åˆ°çš„è¿”å›å€¼éƒ½æ˜¯å­—ç¬¦ä¸²ã€‚è€Œå¦‚æœè¦æŠŠè¯·æ±‚å‚æ•°è½¬æ¢æˆJavaå¯¹è±¡ï¼Œå°±éœ€è¦å†å¤„ç†ï¼Œé‚£ä¹ˆæ¯ä¸€æ¬¡è·å–å‚æ•°åï¼Œéƒ½éœ€è¦æ˜¾å¼åœ°ç¼–å†™å¤§é‡é‡å¤ä»£ç ï¼ŒæŠŠStringç±»å‹çš„å‚æ•°è½¬æ¢æˆå…¶ä»–ç±»å‹ã€‚æ˜¾ç„¶è¿™ä¸ç¬¦åˆæˆ‘ä»¬å¯¹æ¡†æ¶çš„æœŸæœ›ï¼Œæˆ‘ä»¬å¸Œæœ›æ¡†æ¶èƒ½å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨å¤„ç†è¿™äº›å¸¸è§„æ•°æ®æ ¼å¼çš„è½¬æ¢ã€‚

å†æ‰©å¤§åˆ°æ•´ä¸ªè®¿é—®è¿‡ç¨‹ï¼Œåç«¯å¤„ç†å®Œæ¯•åï¼Œè¿”å›ç»™å‰ç«¯çš„æ•°æ®å†åšè¿”å›ï¼Œä¹Ÿå­˜åœ¨æ ¼å¼è½¬æ¢çš„é—®é¢˜ï¼Œä¼ å…¥ä¼ å‡ºä¸¤ä¸ªæ–¹å‘æˆ‘ä»¬éƒ½è¦å¤„ç†ã€‚è€Œè¿™èŠ‚è¯¾æˆ‘ä»¬è®¨è®ºçš„é‡ç‚¹æ˜¯â€œä¼ å…¥â€æ–¹å‘ã€‚

## ä¼ å…¥å‚æ•°çš„ç»‘å®š

æˆ‘ä»¬å…ˆè€ƒè™‘ä¼ å…¥æ–¹å‘çš„é—®é¢˜ï¼šè¯·æ±‚å‚æ•°æ€ä¹ˆå’ŒJavaå¯¹è±¡é‡Œçš„å±æ€§è¿›è¡Œè‡ªåŠ¨æ˜ å°„ï¼Ÿ

è¿™é‡Œï¼Œæˆ‘ä»¬å¼•å…¥WebDataBinderæ¥å¤„ç†ã€‚è¿™ä¸ªç±»ä»£è¡¨çš„æ˜¯ä¸€ä¸ªå†…éƒ¨çš„ç›®æ ‡å¯¹è±¡ï¼Œç”¨äºå°†Requestè¯·æ±‚å†…çš„å­—ç¬¦ä¸²å‚æ•°è½¬æ¢æˆä¸åŒç±»å‹çš„å‚æ•°ï¼Œæ¥è¿›è¡Œé€‚é…ã€‚æ‰€ä»¥æ¯”è¾ƒè‡ªç„¶çš„æƒ³æ³•æ˜¯è¿™ä¸ªç±»é‡Œé¢è¦æŒæœ‰ä¸€ä¸ªç›®æ ‡å¯¹è±¡targetï¼Œç„¶åè¿˜è¦å®šä¹‰ä¸€ä¸ªbind()æ–¹æ³•ï¼Œé€šè¿‡æ¥ç»‘å®šå‚æ•°å’Œç›®æ ‡å¯¹è±¡ï¼Œè¿™æ˜¯WebDataBinderé‡Œçš„æ ¸å¿ƒã€‚

```java
Â  Â  public void bind(HttpServletRequest request) {
Â  Â  Â  Â  PropertyValues mpvs = assignParameters(request);Â  Â  Â  Â  Â 
        addBindValues(mpvs, request);
Â  Â  Â  Â  doBind(mpvs);
Â  Â  }
```

é€šè¿‡bindæ–¹æ³•çš„å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå®ƒä¸»è¦åšäº†ä¸‰ä»¶äº‹ã€‚

1. æŠŠRequesté‡Œçš„å‚æ•°è§£ææˆPropertyValuesã€‚
2. æŠŠRequesté‡Œçš„å‚æ•°å€¼æ·»åŠ åˆ°ç»‘å®šå‚æ•°ä¸­ã€‚
3. æŠŠä¸¤è€…ç»‘å®šåœ¨ä¸€èµ·ã€‚

ä½ å¯ä»¥çœ‹ä¸€ä¸‹WebDataBinderçš„è¯¦ç»†å®ç°ã€‚

```java
package com.minis.web;

import java.util.Map;
import javax.servlet.http.HttpServletRequest;
import com.minis.beans.PropertyValues;
import com.minis.util.WebUtils;

public class WebDataBinder {     
    private Object target;
    private Class<?> clz;
    private String objectName;
    public WebDataBinder(Object target) {         
        this(target, "");
    }
    public WebDataBinder(Object target, String targetName) {         
        this.target = target;
        this.objectName = targetName;
        this.clz = this.target.getClass();     
    }
    //æ ¸å¿ƒç»‘å®šæ–¹æ³•ï¼Œå°†requesté‡Œé¢çš„å‚æ•°å€¼ç»‘å®šåˆ°ç›®æ ‡å¯¹è±¡çš„å±æ€§ä¸Š
Â  Â  public void bind(HttpServletRequest request) {
Â  Â  Â  Â  PropertyValues mpvs = assignParameters(request);Â  Â  Â  Â  Â 
        addBindValues(mpvs, request);
Â  Â  Â  Â  doBind(mpvs);
Â  Â  }
Â  Â  private void doBind(PropertyValues mpvs) {Â  Â  Â  Â  Â 
        applyPropertyValues(mpvs);
Â  Â  }
    //å®é™…å°†å‚æ•°å€¼ä¸å¯¹è±¡å±æ€§è¿›è¡Œç»‘å®šçš„æ–¹æ³•
Â  Â  protected void applyPropertyValues(PropertyValues mpvs) {Â  Â  Â  Â  Â 
        getPropertyAccessor().setPropertyValues(mpvs);
Â  Â  }
    //è®¾ç½®å±æ€§å€¼çš„å·¥å…·
Â  Â  protected BeanWrapperImpl getPropertyAccessor() {Â  Â  Â  Â  Â 
        return new BeanWrapperImpl(this.target);
Â  Â  }
    //å°†Requestå‚æ•°è§£ææˆPropertyValues
Â  Â  private PropertyValues assignParameters(HttpServletRequest request) {
Â  Â  Â  Â  Map<String, Object> map = WebUtils.getParametersStartingWith(request, "");
Â  Â  Â  Â  return new PropertyValues(map);
Â  Â  }
Â  Â  protected void addBindValues(PropertyValues mpvs, HttpServletRequest request) {
Â  Â  } 
}
```

ä»è¿™ä¸ªå®ç°æ–¹æ³•é‡Œå¯ä»¥çœ‹å‡ºï¼Œå…ˆæ˜¯è°ƒç”¨äº†assignParameters()ï¼ŒæŠŠRequesté‡Œçš„å‚æ•°æ¢æˆå†…å­˜é‡Œçš„ä¸€ä¸ªmapå¯¹è±¡ï¼Œè¿™ä¸€æ­¥ç”¨åˆ°äº†åº•å±‚çš„WebUtilså·¥å…·ç±»ï¼Œè¿™ä¸ªè½¬æ¢å¯¹æˆ‘ä»¬æ¥è¯´æ¯”è¾ƒç®€å•ã€‚è€Œæœ€æ ¸å¿ƒçš„æ–¹æ³•æ˜¯getPropertyAccessor().setPropertyValues(mpvs);ï¼Œè¿™ä¸ªgetPropertyAccessoråˆ™æ˜¯å†…ç½®äº†ä¸€ä¸ªBeanWrapperImplå¯¹è±¡ï¼Œå†…éƒ¨åŒ…å«äº†targetã€‚ç”±åå­—å¯ä»¥çœ‹å‡ºå®ƒæ˜¯Beançš„åŒ…è£…å®ç°ç±»ï¼ŒæŠŠå±æ€§mapç»‘å®šåˆ°ç›®æ ‡å¯¹è±¡ä¸Šå»ã€‚

æœ‰äº†è¿™ä¸ªå¤§æµç¨‹ï¼Œæˆ‘ä»¬å†æ¥æ¢ç©¶ä¸€ä¸‹ä¸€ä¸ªå…·ä½“çš„å‚æ•°æ˜¯å¦‚ä½•è½¬æ¢çš„ï¼Œæˆ‘ä»¬çŸ¥é“Requestçš„è½¬æ¢éƒ½æ˜¯ä»å­—ç¬¦ä¸²è½¬ä¸ºå…¶ä»–ç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªé€šç”¨æ¥å£ï¼Œåå«PropertyEditorï¼Œå†…éƒ¨æä¾›ä¸€äº›æ–¹æ³•å¯ä»¥è®©å­—ç¬¦ä¸²å’ŒObejctä¹‹é—´è¿›è¡ŒåŒå‘çµæ´»è½¬æ¢ã€‚

```java
package com.minis.beans;

public interface PropertyEditor {Â  Â  Â 
    void setAsText(String text);Â  Â  Â 
    void setValue(Object value);Â  Â  Â 
    Object getValue();
Â  Â  Object getAsText();
}
```

ç°åœ¨æˆ‘ä»¬æ¥å®šä¹‰ä¸¤ä¸ªPropertyEditorçš„å®ç°ç±»ï¼šCustomNumberEditorå’ŒStringEditorï¼Œåˆ†åˆ«å¤„ç†Numberç±»å‹å’Œå…¶ä»–ç±»å‹ï¼Œå¹¶è¿›è¡Œç±»å‹è½¬æ¢ã€‚ä½ å¯ä»¥çœ‹ä¸€ä¸‹CustomNumberEditorçš„ç›¸å…³æºç ã€‚

```java
package com.minis.beans;

import java.text.NumberFormat;
import com.minis.util.NumberUtils;
import com.minis.util.StringUtils;

public class CustomNumberEditor implements PropertyEditor{Â  Â  Â 
    private Class<? extends Number> numberClass; //æ•°æ®ç±»å‹
Â  Â  private NumberFormat numberFormat; //æŒ‡å®šæ ¼å¼
Â  Â  private boolean allowEmpty;
Â  Â  private Object value;
Â  Â  public CustomNumberEditor(Class<? extends Number> numberClass, boolean allowEmpty) throws IllegalArgumentException {
Â  Â  Â  Â  this(numberClass, null, allowEmpty);
Â  Â  }
Â  Â  public CustomNumberEditor(Class<? extends Number> numberClass, NumberFormat numberFormat, boolean allowEmpty) throws IllegalArgumentException {
Â  Â  Â  Â  this.numberClass = numberClass;
Â  Â  Â  Â  this.numberFormat = numberFormat;
Â  Â  Â  Â  this.allowEmpty = allowEmpty;
Â  Â  }
Â  Â  //å°†ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢æˆnumberèµ‹å€¼
Â  Â  public void setAsText(String text) {
		if (this.allowEmpty && !StringUtils.hasText(text)) {
			setValue(null);
		}
		else if (this.numberFormat != null) {
			// ç»™å®šæ ¼å¼
			setValue(NumberUtils.parseNumber(text, this.numberClass, this.numberFormat));
		}
		else {
			setValue(NumberUtils.parseNumber(text, this.numberClass));
		}
Â  Â  }
Â  Â  //æ¥æ”¶Objectä½œä¸ºå‚æ•°
Â  Â  public void setValue(Object value) {
Â  Â  Â  Â  if (value instanceof Number) {
Â  Â  Â  Â  Â  Â  this.value = (NumberUtils.convertNumberToTargetClass((Number) value, this.numberClass));
Â  Â  Â  Â  }
Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  this.value = value;
Â  Â  Â  Â  }
    }
Â  Â  public Object getValue() {Â  Â  Â  Â  Â 
        return this.value;
Â  Â  }
Â  Â  //å°†numberè¡¨ç¤ºæˆæ ¼å¼åŒ–ä¸²
Â  Â  public Object getAsText() {
Â  Â  Â  Â  Object value = this.value;
		if (value == null) {
			return "";
		}
		if (this.numberFormat != null) {
			// ç»™å®šæ ¼å¼.
			return this.numberFormat.format(value);
		}
		else {
			return value.toString();
		}
Â  Â  }
}
```

æ•´ä½“å®ç°ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåœ¨å†…éƒ¨å®šä¹‰ä¸€ä¸ªåä¸ºvalueçš„åŸŸï¼Œæ¥æ”¶ä¼ å…¥çš„æ ¼å¼åŒ–textæˆ–è€…valueå€¼ã€‚å¦‚æœé‡åˆ°çš„å€¼æ˜¯Numberç±»å‹çš„å­ç±»ï¼Œæ¯”è¾ƒç®€å•ï¼Œå°±è¿›è¡Œå¼ºåˆ¶è½¬æ¢ã€‚è¿™é‡Œæˆ‘ä»¬ç”¨åˆ°äº†ä¸€ä¸ªåº•å±‚å·¥å…·ç±»NumberUtilsï¼Œå®ƒæä¾›äº†ä¸€ä¸ªNumberUtils.parseNumber(text, this.numberClass, this.numberFormat)æ–¹æ³•ï¼Œæ–¹ä¾¿æˆ‘ä»¬åœ¨æ•°å€¼å’Œæ–‡æœ¬ä¹‹é—´è½¬æ¢ã€‚

ä½ å¯ä»¥çœ‹ä¸‹StringEditorå®ç°çš„ç›¸å…³æºä»£ç ã€‚

```java
package com.minis.beans;

import java.text.NumberFormat;
import com.minis.util.NumberUtils;
import com.minis.util.StringUtils;

public class StringEditor implements PropertyEditor{
 Â  Â private Class<String> strClass;
Â  Â  private String strFormat;
Â  Â  private boolean allowEmpty;
Â  Â  private Object value;
Â  Â  public StringEditor(Class<String> strClass,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  boolean allowEmpty) throws IllegalArgumentException {
Â  Â  Â  Â  Â this(strClass, "", allowEmpty);
Â  Â  }
Â  Â  public StringEditor(Class<String> strClass,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  String strFormat, boolean allowEmpty) throws IllegalArgumentException {
Â  Â  Â  Â  this.strClass = strClass;
Â  Â  Â  Â  this.strFormat = strFormat;
Â  Â  Â  Â  this.allowEmpty = allowEmpty;
Â  Â  }
Â  Â  public void setAsText(String text) {Â  Â  Â  Â  Â 
        setValue(text);
Â  Â  }
Â  Â  public void setValue(Object value) {Â  Â  Â  Â  Â 
        this.value = value;
    }
Â  Â  public String getAsText() {Â  Â  Â  Â  Â 
        return value.toString();Â  Â  Â 
    }
Â  Â  public Object getValue() {Â  Â  Â  Â  Â 
        return this.value;
Â  Â  }
}
```

StringEditorçš„å®ç°ç±»å°±æ›´åŠ ç®€å•äº†ï¼Œå› ä¸ºå®ƒæ˜¯å­—ç¬¦ä¸²æœ¬èº«çš„å¤„ç†ï¼Œä½†å®ƒçš„æ„é€ å‡½æ•°æœ‰äº›ä¸ä¸€æ ·ï¼Œæ”¯æŒä¼ å…¥å­—ç¬¦ä¸²æ ¼å¼strFormatï¼Œè¿™ä¹Ÿæ˜¯ä¸ºåç»­ç±»å‹è½¬æ¢æ ¼å¼ç•™äº†ä¸€ä¸ªâ€œå£å­â€ã€‚

æœ‰äº†ä¸¤ä¸ªåŸºæœ¬ç±»å‹çš„Editorä½œä¸ºå·¥å…·ï¼Œç°åœ¨æˆ‘ä»¬å†æ¥çœ‹å…³é”®çš„ç±»BeanWapperImplçš„å®ç°ã€‚

```java
package com.minis.web;

import java.lang.reflect.Field;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import com.minis.beans.PropertyEditor;
import com.minis.beans.PropertyEditorRegistrySupport;
import com.minis.beans.PropertyValue;
import com.minis.beans.PropertyValues;

public class BeanWrapperImpl extends PropertyEditorRegistrySupport {
Â  Â  Object wrappedObject; //ç›®æ ‡å¯¹è±¡
Â  Â  Class<?> clz;
Â  Â  PropertyValues pvs; //å‚æ•°å€¼
Â  Â  public BeanWrapperImpl(Object object) {Â  Â  Â  Â  Â 
        registerDefaultEditors(); //ä¸åŒæ•°æ®ç±»å‹çš„å‚æ•°è½¬æ¢å™¨editor
Â  Â  Â  Â  this.wrappedObject = object;
Â  Â  Â  Â  this.clz = object.getClass();
Â  Â  }
Â  Â  public void setBeanInstance(Object object) {Â  Â  Â  Â  Â 
        this.wrappedObject = object;
Â  Â  }
    public Object getBeanInstance() {Â  Â  Â  Â  Â 
        return wrappedObject;
Â  Â  }
    //ç»‘å®šå‚æ•°å€¼
Â  Â  public void setPropertyValues(PropertyValues pvs) {
Â  Â  Â  Â  this.pvs = pvs;
Â  Â  Â  Â  for (PropertyValue pv : this.pvs.getPropertyValues()) {Â  Â  Â  Â  
     Â  Â  Â setPropertyValue(pv);
Â  Â  Â  Â  }
Â  Â  }
    //ç»‘å®šå…·ä½“æŸä¸ªå‚æ•°
Â  Â  public void setPropertyValue(PropertyValue pv) {
        //æ‹¿åˆ°å‚æ•°å¤„ç†å™¨
Â  Â  Â  Â  BeanPropertyHandler propertyHandler = newÂ BeanPropertyHandler(pv.getName());
        //æ‰¾åˆ°å¯¹è¯¥å‚æ•°ç±»å‹çš„editor
Â  Â  Â  Â  PropertyEditor pe =Â this.getDefaultEditor(propertyHandler.getPropertyClz());Â  Â  Â  Â  Â 
        //è®¾ç½®å‚æ•°å€¼
        pe.setAsText((String) pv.getValue());
Â  Â  Â  Â  propertyHandler.setValue(pe.getValue());
    }
    //ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œç”¨äºå¤„ç†å‚æ•°ï¼Œé€šè¿‡getter()å’Œsetter()æ“ä½œå±æ€§
Â  Â  class BeanPropertyHandler {
Â  Â  Â  Â  Method writeMethod = null;Â  Â  Â  Â  Â 
        Method readMethod = null;Â  Â  Â  Â  Â 
        Class<?> propertyClz = null;
Â  Â  Â  Â  public Class<?> getPropertyClz() {Â  Â  Â  Â  Â  Â  Â 
            return propertyClz;
Â  Â  Â  Â  }
Â  Â  Â  Â  public BeanPropertyHandler(String propertyName) {
			try {
                //è·å–å‚æ•°å¯¹åº”çš„å±æ€§åŠç±»å‹
    Â  Â  Â  Â  Â  Â  Field field = clz.getDeclaredField(propertyName);
    Â  Â  Â  Â  Â  Â  propertyClz = field.getType();
                //è·å–è®¾ç½®å±æ€§çš„æ–¹æ³•ï¼ŒæŒ‰ç…§çº¦å®šä¸ºsetXxxxï¼ˆï¼‰
    Â  Â  Â  Â  Â  Â  this.writeMethod = clz.getDeclaredMethod("set" +Â 
    propertyName.substring(0, 1).toUpperCase() + propertyName.substring(1), propertyClz);
                //è·å–è¯»å±æ€§çš„æ–¹æ³•ï¼ŒæŒ‰ç…§çº¦å®šä¸ºgetXxxxï¼ˆï¼‰
                this.readMethod = clz.getDeclaredMethod("get" +Â 
    propertyName.substring(0, 1).toUpperCase() + propertyName.substring(1), propertyClz);
            } catch (Exception e) {
				e.printStackTrace();
			}Â  Â  Â  Â  }
        //è°ƒç”¨getterè¯»å±æ€§å€¼
Â  Â  Â  Â  public Object getValue() {
Â  Â  Â  Â  Â  Â  Object result = null;
Â  Â  Â  Â  Â  Â  writeMethod.setAccessible(true);
			try {
    Â  Â  Â  Â  Â  Â  result = readMethod.invoke(wrappedObject);Â 
			} catch (Exception e) {
				e.printStackTrace();
			}
Â  Â  Â  Â  Â  Â  return result;
Â  Â  Â  Â  }
        //è°ƒç”¨setterè®¾ç½®å±æ€§å€¼
Â  Â  Â  Â  public void setValue(Object value) {
Â  Â  Â  Â  Â  Â  writeMethod.setAccessible(true);
			try {
    Â  Â  Â  Â  Â  Â  writeMethod.invoke(wrappedObject, value);
			} catch (Exception e) {
				e.printStackTrace();
			}
Â  Â  Â  Â  }
Â  Â  }
}
```

è¿™ä¸ªç±»çš„æ ¸å¿ƒåœ¨äºåˆ©ç”¨åå°„å¯¹Beanå±æ€§å€¼è¿›è¡Œè¯»å†™ï¼Œå…·ä½“æ˜¯é€šè¿‡setterå’Œgetteræ–¹æ³•ã€‚ä½†å…·ä½“çš„å®ç°ï¼Œåˆ™æœ‰èµ–äºç»§æ‰¿çš„PropertyEditorRegistrySupportè¿™ä¸ªç±»ã€‚æˆ‘ä»¬å†æ¥çœ‹çœ‹PropertyEditorRegistrySupportæ˜¯å¦‚ä½•å®ç°çš„ã€‚

```java
package com.minis.beans;

import java.math.BigDecimal;
import java.math.BigInteger;
import java.util.HashMap;
import java.util.LinkedHashMap;
import java.util.Map;

public class PropertyEditorRegistrySupport {
    private Map<Class<?>, PropertyEditor> defaultEditors;
    private Map<Class<?>, PropertyEditor> customEditors;
    //æ³¨å†Œé»˜è®¤çš„è½¬æ¢å™¨editor
    protected void registerDefaultEditors() {
        createDefaultEditors();
    }
    //è·å–é»˜è®¤çš„è½¬æ¢å™¨editor
    public PropertyEditor getDefaultEditor(Class<?> requiredType) {
        return this.defaultEditors.get(requiredType);
    }
    //åˆ›å»ºé»˜è®¤çš„è½¬æ¢å™¨editorï¼Œå¯¹æ¯ä¸€ç§æ•°æ®ç±»å‹è§„å®šä¸€ä¸ªé»˜è®¤çš„è½¬æ¢å™¨
    private void createDefaultEditors() {
        this.defaultEditors = new HashMap<>(64);
        // Default instances of collection editors.
        this.defaultEditors.put(int.class, new CustomNumberEditor(Integer.class, false));
        this.defaultEditors.put(Integer.class, new CustomNumberEditor(Integer.class, true));
        this.defaultEditors.put(long.class, new CustomNumberEditor(Long.class, false));
        this.defaultEditors.put(Long.class, new CustomNumberEditor(Long.class, true));
        this.defaultEditors.put(float.class, new CustomNumberEditor(Float.class, false));
        this.defaultEditors.put(Float.class, new CustomNumberEditor(Float.class, true));
        this.defaultEditors.put(double.class, new CustomNumberEditor(Double.class, false));
        this.defaultEditors.put(Double.class, new CustomNumberEditor(Double.class, true));
        this.defaultEditors.put(BigDecimal.class, new CustomNumberEditor(BigDecimal.class, true));
        this.defaultEditors.put(BigInteger.class, new CustomNumberEditor(BigInteger.class, true));
        this.defaultEditors.put(String.class, new StringEditor(String.class, true));
    }
    //æ³¨å†Œå®¢æˆ·åŒ–è½¬æ¢å™¨
    public void registerCustomEditor(Class<?> requiredType, PropertyEditor propertyEditor) {
        if (this.customEditors == null) {
            this.customEditors = new LinkedHashMap<>(16);
        }
        this.customEditors.put(requiredType, propertyEditor);
    }
    //æŸ¥æ‰¾å®¢æˆ·åŒ–è½¬æ¢å™¨
    public PropertyEditor findCustomEditor(Class<?> requiredType) {
        Class<?> requiredTypeToUse = requiredType;
        return getCustomEditor(requiredTypeToUse);
    }
    public boolean hasCustomEditorForElement(Class<?> elementType) {
        return (elementType != null && this.customEditors != null && this.customEditors.containsKey(elementType));
    }
    //è·å–å®¢æˆ·åŒ–è½¬æ¢å™¨
    private PropertyEditor getCustomEditor(Class<?> requiredType) {
        if (requiredType == null || this.customEditors == null) {
            return null;
        }
        PropertyEditor editor = this.customEditors.get(requiredType);
        return editor;
    }
}

```

ä»è¿™æ®µæºç é‡Œå¯ä»¥çœ‹åˆ°ï¼ŒPropertyEditorRegistrySupport çš„æ ¸å¿ƒå®ç°æ˜¯createDefaultEditorsæ–¹æ³•ï¼Œå®ƒé‡Œé¢å†…ç½®äº†å¤§é‡åŸºæœ¬ç±»å‹æˆ–åŒ…è£…ç±»å‹çš„è½¬æ¢å™¨Editorï¼Œè¿˜å®šä¹‰äº†å¯ä»¥å®šåˆ¶åŒ–çš„è½¬æ¢å™¨Editorï¼Œè¿™ä¹Ÿæ˜¯WebDataBinderèƒ½åšä¸åŒç±»å‹è½¬æ¢çš„åŸå› ã€‚ä¸è¿‡æˆ‘ä»¬ç›®å‰çš„å®ç°ï¼Œåªæ”¯æŒæ•°å­—å’Œå­—ç¬¦ä¸²å‡ ä¸ªåŸºæœ¬ç±»å‹çš„è½¬æ¢ï¼Œæš‚æ—¶ä¸æ”¯æŒæ•°ç»„ã€åˆ—è¡¨ã€mapç­‰æ ¼å¼ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„WebDataBinderï¼Œç”¨æ¥ç»‘å®šæ•°æ®ã€‚æˆ‘ä»¬æ¥ä¸‹æ¥å°†æä¾›ä¸€ä¸ªWebDataBinderFactoryï¼Œèƒ½å¤Ÿæ›´æ–¹ä¾¿ã€çµæ´»åœ°æ“ä½œWebDataBinderã€‚

```java
package com.minis.web;

import javax.servlet.http.HttpServletRequest;

public class WebDataBinderFactory {
Â  Â  public WebDataBinder createBinder(HttpServletRequest request, Object target, String objectName) {
Â  Â  Â  Â  WebDataBinder wbd = new WebDataBinder(target, objectName);
Â  Â  Â  Â  initBinder(wbd, request);
Â  Â  Â  Â  return wbd;
Â  Â  }
Â  Â  protected void initBinder(WebDataBinder dataBinder, HttpServletRequest request) {
Â  Â  } 
}
```

æœ‰äº†ä¸Šé¢ä¸€ç³»åˆ—å·¥å…·ä¹‹åï¼Œæˆ‘ä»¬çœ‹æ€ä¹ˆä½¿ç”¨å®ƒä»¬è¿›è¡Œæ•°æ®ç»‘å®šã€‚ä»å‰é¢çš„è®²è§£ä¸­æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œè¿™ä¸ª HTTP Requestè¯·æ±‚æœ€åä¼šæ‰¾åˆ°æ˜ å°„çš„æ–¹æ³•ä¸Šï¼Œä¹Ÿå°±æ˜¯é€šè¿‡RequestMappingHandlerAdapteré‡Œæä¾›çš„handleInternal æ–¹æ³•ï¼Œæ¥è°ƒç”¨invokeHandlerMethod æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»è¿™ä¸ªåœ°æ–¹åˆ‡å…¥ï¼Œæ”¹é€  invokeHandlerMethod æ–¹æ³•ï¼Œå®ç°å‚æ•°ç»‘å®šã€‚

```java
Â  Â  protected void invokeHandlerMethod(HttpServletRequest request,Â 
HttpServletResponse response, HandlerMethod handlerMethod) throws Exception {Â  Â  Â  Â  Â 
        WebDataBinderFactory binderFactory = new WebDataBinderFactory();
Â  Â  Â  Â  Parameter[] methodParameters =Â 
handlerMethod.getMethod().getParameters();
Â  Â  Â  Â  Object[] methodParamObjs = new Object[methodParameters.length];
Â  Â  Â  Â  int i = 0;
        //å¯¹è°ƒç”¨æ–¹æ³•é‡Œçš„æ¯ä¸€ä¸ªå‚æ•°ï¼Œå¤„ç†ç»‘å®š
Â  Â  Â  Â  for (Parameter methodParameter : methodParameters) {
Â  Â  Â  Â  Â  Â  Object methodParamObj = methodParameter.getType().newInstance();Â  Â  Â  Â  Â  Â  Â 
            //ç»™è¿™ä¸ªå‚æ•°åˆ›å»ºWebDataBinder
            WebDataBinder wdb = binderFactory.createBinder(request,Â 
methodParamObj, methodParameter.getName());
Â  Â  Â  Â  Â  Â  wdb.bind(request);
Â  Â  Â  Â  Â  Â  methodParamObjs[i] = methodParamObj;
Â  Â  Â  Â  Â  Â  i++;
Â  Â  Â  Â  }
Â  Â  Â  Â  Method invocableMethod = handlerMethod.getMethod();
Â  Â  Â  Â  Object returnObj = invocableMethod.invoke(handlerMethod.getBean(), methodParamObjs);
Â  Â  Â  Â  response.getWriter().append(returnObj.toString());
Â  Â  }
```

åœ¨invokeHandlerMethod æ–¹æ³•çš„å®ç°ä»£ç ä¸­ï¼ŒmethodParameters å˜é‡ç”¨æ¥å­˜å‚¨è°ƒç”¨æ–¹æ³•çš„æ‰€æœ‰å‚æ•°ï¼Œé’ˆå¯¹å®ƒä»¬è¿›è¡Œå¾ªç¯ï¼Œè¿˜æœ‰ä¸€ä¸ªå˜é‡methodParamObjï¼Œæ˜¯ä¸€ä¸ªæ–°åˆ›å»ºçš„ç©ºå¯¹è±¡ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬éœ€è¦è¿›è¡Œç»‘å®šæ“ä½œçš„ç›®æ ‡ï¼ŒbinderFactory.createBinderåˆ™æ˜¯åˆ›å»ºäº†WebDtaBinderï¼Œå¯¹ç›®æ ‡å¯¹è±¡è¿›è¡Œç»‘å®šã€‚æ•´ä¸ªå¾ªç¯ç»“æŸä¹‹åï¼ŒRequesté‡Œé¢çš„å‚æ•°å°±ç»‘å®šäº†è°ƒç”¨æ–¹æ³•é‡Œçš„å‚æ•°ï¼Œä¹‹åå°±å¯ä»¥è¢«è°ƒç”¨ã€‚

æˆ‘ä»¬ä»è¿™ä¸ªç»‘å®šè¿‡ç¨‹ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå¾ªç¯è¿‡ç¨‹å°±æ˜¯æŒ‰ç…§å‚æ•°åœ¨æ–¹æ³•ä¸­å‡ºç°çš„æ¬¡åºé€ä¸ªç»‘å®šçš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ¬¡åºæ˜¯å¾ˆé‡è¦çš„ã€‚

## å®¢æˆ·åŒ–è½¬æ¢å™¨

ç°åœ¨æˆ‘ä»¬å·²ç»å®ç°äº†Requestæ•°æ®ç»‘å®šè¿‡ç¨‹ï¼Œä¹Ÿæä¾›äº†é»˜è®¤çš„CustomNumberEditorå’ŒStringEditorï¼Œæ¥è¿›è¡Œæ•°å­—å’Œå­—ç¬¦ä¸²ä¸¤ç§ç±»å‹çš„è½¬æ¢ï¼Œä»è€ŒæŠŠServletRequesté‡Œçš„è¯·æ±‚å‚æ•°è½¬æ¢æˆJavaå¯¹è±¡é‡Œçš„æ•°æ®ç±»å‹ã€‚ä½†è¿™ç§é»˜è®¤çš„æ–¹å¼æ¯”è¾ƒå›ºå®šï¼Œå¦‚æœä½ å¸Œæœ›è½¬æ¢æˆè‡ªå®šä¹‰çš„ç±»å‹ï¼Œé‚£ä¹ˆåŸæœ‰çš„ä¸¤ä¸ªEditorå°±æ²¡åŠæ³•å¾ˆå¥½åœ°æ»¡è¶³éœ€æ±‚äº†ã€‚

å› æ­¤æˆ‘ä»¬è¦ç»§ç»­æ¢è®¨ï¼Œå¦‚ä½•æ”¯æŒè‡ªå®šä¹‰çš„Editorï¼Œè®©æˆ‘ä»¬çš„æ¡†æ¶å…·æœ‰è‰¯å¥½çš„æ‰©å±•æ€§ã€‚å…¶å®ä¸Šé¢æˆ‘ä»¬çœ‹åˆ°PropertyEditorRegistrySupporté‡Œï¼Œå·²ç»æå‰å‡†å¤‡å¥½äº†å®¢æˆ·åŒ–è½¬æ¢å™¨çš„åœ°æ–¹ï¼Œä½ å¯ä»¥çœ‹ä¸‹ä»£ç ã€‚

```java
public class PropertyEditorRegistrySupport {
    private Map<Class<?>, PropertyEditor> defaultEditors;
    private Map<Class<?>, PropertyEditor> customEditors;
```

æˆ‘ä»¬åˆ©ç”¨å®¢æˆ·åŒ–Editorè¿™ä¸ªâ€œå£å­â€ï¼Œæ–°å»ºä¸€ä¸ªéƒ¨ä»¶ï¼ŒæŠŠå®¢æˆ·è‡ªå®šä¹‰çš„Editoræ³¨å†Œè¿›æ¥å°±å¯ä»¥äº†ã€‚

æˆ‘ä»¬å…ˆåœ¨åŸæœ‰çš„WebDataBinder ç±»é‡Œï¼Œå¢åŠ registerCustomEditoræ–¹æ³•ï¼Œç”¨æ¥æ³¨å†Œè‡ªå®šä¹‰çš„Editorï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹ç›¸å…³ä»£ç ã€‚

```java
public void registerCustomEditor(Class<?> requiredType, PropertyEditorÂ propertyEditor) {
Â  Â    getPropertyAccessor().registerCustomEditor(requiredType, propertyEditor); Â 
}
```

åœ¨è¿™é‡Œï¼Œå¯ä»¥è‡ªå®šä¹‰å±äºæˆ‘ä»¬è‡ªå·±çš„CustomEditor ï¼Œæ¯”å¦‚åœ¨com.test åŒ…è·¯å¾„ä¸‹ï¼Œè‡ªå®šä¹‰CustomDateEditorï¼Œè¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„æ—¥æœŸæ ¼å¼å¤„ç†å™¨ï¼Œæ¥é…åˆæˆ‘ä»¬çš„æµ‹è¯•ã€‚

```java
package com.test;

import java.text.NumberFormat;
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.time.ZoneId;
import java.time.format.DateTimeFormatter;
import java.util.Date;
import com.minis.beans.PropertyEditor;
import com.minis.util.NumberUtils;
import com.minis.util.StringUtils;

public class CustomDateEditor implements PropertyEditor {Â  Â  Â 
    private Class<Date> dateClass;
Â  Â  private DateTimeFormatter datetimeFormatter;
Â  Â  private boolean allowEmpty;
Â  Â  private Date value;
	public CustomDateEditor() throws IllegalArgumentException {
		this(Date.class, "yyyy-MM-dd", true);
	}		
	public CustomDateEditor(Class<Date> dateClass) throws IllegalArgumentException {
		this(dateClass, "yyyy-MM-dd", true);
	}		
	public CustomDateEditor(Class<Date> dateClass,
				Â  boolean allowEmpty) throws IllegalArgumentException {
		this(dateClass, "yyyy-MM-dd", allowEmpty);
	}	
	public CustomDateEditor(Class<Date> dateClass,
				String pattern, boolean allowEmpty) throws IllegalArgumentException {
		this.dateClass = dateClass;
		this.datetimeFormatter = DateTimeFormatter.ofPattern(pattern);
		this.allowEmpty = allowEmpty;
	}
Â  Â  public void setAsText(String text) {
		if (this.allowEmpty && !StringUtils.hasText(text)) {
			setValue(null);
		}			
		else {
			LocalDate localdate = LocalDate.parse(text, datetimeFormatter);
			setValue(Date.from(localdate.atStartOfDay(ZoneId.systemDefault()).toInstant()));
		}
Â  Â  }
Â  Â  public void setValue(Object value) {Â  Â  Â  Â  Â 
            this.value = (Date) value;
Â  Â  }
Â  Â  public String getAsText() {
Â  Â  Â  Â  Date value = this.value;
		if (value == null) {
			return "";
		}
		else {
			LocalDate localDate = value.toInstant().atZone(ZoneId.systemDefault()).toLocalDate();
			return localDate.format(datetimeFormatter);
		}
Â  Â  }
Â  Â  public Object getValue() {Â  Â  Â  Â  Â 
        return this.value;
Â  Â  }
}
```

ç¨‹åºä¹Ÿæ¯”è¾ƒç®€å•ï¼Œç”¨DateTimeFormatteræ¥è½¬æ¢å­—ç¬¦ä¸²å’Œæ—¥æœŸå°±å¯ä»¥äº†ã€‚  
æ¥ä¸‹æ¥æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªWebBindingInitializerï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªinitBinderå®ç°æ–¹æ³•ï¼Œä¸ºè‡ªå®šä¹‰çš„CustomEditoræ³¨å†Œåšå‡†å¤‡ã€‚

```java
public interface WebBindingInitializer {Â  Â  Â 
    void initBinder(WebDataBinder binder); 
}
```

ä¸‹é¢ï¼Œæˆ‘ä»¬å†å®ç°WebBindingInitializeræ¥å£ï¼Œåœ¨å®ç°æ–¹æ³•initBinderé‡Œï¼Œæ³¨å†Œè‡ªå®šä¹‰çš„CustomDateEditorï¼Œä½ å¯ä»¥çœ‹ä¸‹ç›¸å…³ä»£ç ã€‚

```java
package com.test;

import java.util.Date;
import com.minis.web.WebBindingInitializer;
import com.minis.web.WebDataBinder;

public class DateInitializer implements WebBindingInitializer{
	public void initBinder(WebDataBinder binder) {
		binder.registerCustomEditor(Date.class, new CustomDateEditor(Date.class,"yyyy-MM-dd", false));
	}
}

```

é€šè¿‡ä¸Šè¿°å®ç°å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰äº†â€œyyyy-MM-ddâ€è¿™æ ·ä¸€ç§æ—¥æœŸæ ¼å¼ï¼Œä¹Ÿå¯ä»¥æ ¹æ®å…·ä½“ä¸šåŠ¡éœ€è¦ï¼Œè‡ªå®šä¹‰å…¶ä»–æ—¥æœŸæ ¼å¼ã€‚

ç„¶åï¼Œæˆ‘ä»¬è¦ä½¿ç”¨å®ƒä»¬ï¼Œå›åˆ°RequestMappingHandlerAdapter è¿™ä¸ªç±»é‡Œï¼Œæ–°å¢WebBindingInitializer çš„å±æ€§å®šä¹‰ï¼Œè°ƒæ•´åŸæœ‰çš„RequestMappingHandlerAdapter(WebApplicationContext wac)è¿™ä¸ªæ„é€ æ–¹æ³•çš„å…·ä½“å®ç°ï¼Œä½ å¯ä»¥çœ‹ä¸‹è°ƒæ•´åçš„ä»£ç ã€‚

```java
Â  Â  public RequestMappingHandlerAdapter(WebApplicationContext wac) {Â  Â  Â  Â  Â this.wac = wac;
 Â  Â  Â  this.webBindingInitializer = (WebBindingInitializer)Â 
this.wac.getBean("webBindingInitializer");
Â  Â  }
```

å…¶å®ä¹Ÿå°±æ˜¯å¢åŠ äº†webBindingInitializerå±æ€§çš„è®¾ç½®ã€‚

ç„¶åå†åˆ©ç”¨IoCå®¹å™¨ï¼Œè®©è¿™ä¸ªæ„é€ æ–¹æ³•ï¼Œæ”¯æŒç”¨æˆ·é€šè¿‡applicationContext.xml é…ç½®webBindingInitializerï¼Œæˆ‘ä»¬å¯ä»¥åœ¨applicationContext.xmlé‡Œæ–°å¢ä¸‹é¢è¿™ä¸ªé…ç½®ã€‚

```xml
<bean id="webBindingInitializer" class="com.test.DateInitializer">Â  Â  </bean>
```

æœ€åæˆ‘ä»¬åªéœ€è¦åœ¨BeanWrapperImpl å®ç°ç±»é‡Œï¼Œä¿®æ”¹setPropertyValue(PropertyValue pv)è¿™ä¸ªæ–¹æ³•çš„å…·ä½“å®ç°ï¼ŒæŠŠæœ€åˆæˆ‘ä»¬ç›´æ¥è·å–DefaultEditorçš„ä»£ç ï¼Œæ”¹ä¸ºå…ˆè·å–CustomEditor ï¼Œå¦‚æœå®ƒä¸å­˜åœ¨ï¼Œå†è·å–DefaultEditorï¼Œä½ å¯ä»¥çœ‹ä¸‹ç›¸å…³å®ç°ã€‚

```java
Â  Â  public void setPropertyValue(PropertyValue pv) {
Â  Â  Â  Â  BeanPropertyHandler propertyHandler = new BeanPropertyHandler(pv.getName());Â  Â  Â  Â  Â 
        PropertyEditor pe = this.getCustomEditor(propertyHandler.getPropertyClz());Â  Â  Â  Â  Â 
        if (pe == null) {
Â  Â  Â  Â  Â  Â  pe = this.getDefaultEditor(propertyHandler.getPropertyClz());Â Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  pe.setAsText((String) pv.getValue());
Â  Â  Â  Â  propertyHandler.setValue(pe.getValue());
}
```

æ”¹é€ åï¼Œå°±èƒ½æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰çš„CustomEditor ï¼Œå¢å¼ºäº†æ‰©å±•æ€§ã€‚åŒæ ·çš„ç±»å‹ï¼Œå¦‚æœæ—¢æœ‰ç”¨æˆ·è‡ªå®šä¹‰çš„å®ç°ï¼Œåˆæœ‰æ¡†æ¶é»˜è®¤çš„å®ç°ï¼Œé‚£ç”¨æˆ·è‡ªå®šä¹‰çš„ä¼˜å…ˆã€‚

åˆ°è¿™é‡Œï¼Œä¼ å…¥å‚æ•°çš„å¤„ç†é—®é¢˜æˆ‘ä»¬å°±æ¢è®¨å®Œäº†ã€‚

## å°ç»“

è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬é‡ç‚¹æ¢è®¨äº†MVCé‡Œå‰åç«¯å‚æ•°çš„è‡ªåŠ¨è½¬æ¢ï¼ŒæŠŠRequesté‡Œçš„å‚æ•°ä¸²è‡ªåŠ¨è½¬æ¢æˆè°ƒç”¨æ–¹æ³•é‡Œçš„å‚æ•°å¯¹è±¡ã€‚

ä¸ºäº†å®Œæˆä¼ å…¥å‚æ•°çš„è‡ªåŠ¨ç»‘å®šï¼Œæˆ‘ä»¬ä½¿ç”¨äº†WebDataBinderï¼Œå®ƒå†…éƒ¨ç”¨BeanWrapperImplå¯¹è±¡ï¼ŒæŠŠå±æ€§å€¼çš„mapç»‘å®šåˆ°ç›®æ ‡å¯¹è±¡ä¸Šã€‚ç»‘å®šçš„è¿‡ç¨‹ä¸­ï¼Œè¦å¯¹æ¯ä¸€ç§æ•°æ®ç±»å‹åˆ†åˆ«è¿›è¡Œæ ¼å¼è½¬æ¢ï¼Œå¯¹åŸºæœ¬çš„æ ‡å‡†æ•°æ®ç±»å‹ï¼Œç”±æ¡†æ¶ç»™å®šé»˜è®¤çš„è½¬æ¢å™¨ï¼Œä½†æ˜¯å¯¹äºåˆ«çš„æ•°æ®ç±»å‹æˆ–è€…æ˜¯æ–‡åŒ–å·®å¼‚å¾ˆå¤§çš„æ•°æ®ç±»å‹ï¼Œå¦‚æ—¥æœŸå‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡CustomEditoræœºåˆ¶è®©ç”¨æˆ·è‡ªå®šä¹‰ã€‚

é€šè¿‡æ•°æ®çš„è‡ªåŠ¨ç»‘å®šï¼Œæˆ‘ä»¬ä¸ç”¨å†é€šè¿‡request.getParameter()æ–¹æ³•æ‰‹åŠ¨è·å–å‚æ•°å€¼ï¼Œå†æ‰‹åŠ¨è½¬æˆå¯¹è±¡äº†ï¼Œè¿™äº›HTTPè¯·æ±‚é‡Œçš„å‚æ•°å€¼å°±è‡ªåŠ¨å˜æˆäº†åç«¯æ–¹æ³•é‡Œçš„å‚æ•°å¯¹è±¡å€¼ï¼Œéå¸¸ä¾¿åˆ©ã€‚å®é™…ä¸Šåé¢æˆ‘ä»¬ä¼šçœ‹åˆ°ï¼Œè¿™ç§ä¸¤å±‚ä¹‹é—´çš„æ•°æ®è‡ªåŠ¨ç»‘å®šå’Œè½¬æ¢ï¼Œåœ¨è®¸å¤šåœºæ™¯ä¸­éƒ½éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚Jdbc Templateã€‚æ‰€ä»¥è¿™èŠ‚è¯¾çš„å†…å®¹éœ€è¦ä½ å¥½å¥½æ¶ˆåŒ–ï¼Œçµæ´»è¿ç”¨ã€‚

å®Œæ•´æºä»£ç å‚è§ [https://github.com/YaleGuo/minis](https://github.com/YaleGuo/minis)

## è¯¾åé¢˜

å­¦å®Œè¿™èŠ‚è¯¾çš„å†…å®¹ï¼Œæˆ‘ä¹Ÿç»™ä½ ç•™ä¸€é“æ€è€ƒé¢˜ã€‚æˆ‘ä»¬ç°åœ¨çš„å®ç°æ˜¯æŠŠRequesté‡Œé¢çš„å‚æ•°å€¼ï¼ŒæŒ‰ç…§å†…éƒ¨çš„æ¬¡åºéšå«åœ°è‡ªåŠ¨è½¬æˆåå°è°ƒç”¨æ–¹æ³•å‚æ•°å¯¹è±¡ä¸­çš„æŸä¸ªå±æ€§å€¼ï¼Œé‚£ä¹ˆå¯ä¸å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ‰‹æ®µï¼Œè®©ç¨‹åºå‘˜æ‰‹åŠ¨æŒ‡å®šæŸä¸ªè°ƒç”¨æ–¹æ³•çš„å‚æ•°è·Ÿå“ªä¸ªRequestå‚æ•°è¿›è¡Œç»‘å®šå‘¢ï¼Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºå’Œæˆ‘äº¤æµè®¨è®ºï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™éœ€è¦çš„æœ‹å‹ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ï¼
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ11ï¼‰</strong></div><ul>
<li><span>æ¢¦æŸäºº</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>ç›®å‰è¿™ä¸ªä¼¼ä¹å¹¶ä¸èƒ½å®Œæˆå¯¹åŸºæœ¬ç±»å‹çš„è½¬æ¢ï¼Œåè€Œä¼¼ä¹è¦å¤„ç†çš„æ˜¯å¤åˆç±»å‹çš„è½¬æ¢ï¼Ÿå½“ç„¶ä¹Ÿå¯èƒ½æ˜¯æˆ‘ä»£ç å’Œç†è§£å­˜åœ¨é—®é¢˜ã€‚
ç›®å‰é€»è¾‘ä¸Šæ˜¯ï¼š Adapter ä¸­å¯¹å‚æ•°è¿›è¡Œå¤„ç†ï¼Œå¯¹äºæ¯ä¸ªå‚æ•°éƒ½æœ‰ä¸€ä¸ª WebDataBinder è¿›è¡Œå¤„ç†ï¼Œè€Œè¿™ä¸ªç±»åœ¨åšç±»å‹ç»‘å®šçš„æ—¶å€™ï¼Œä¸»è¦æ˜¯é€šè¿‡ BeanWrapperImpl ç±»æ¥è¿›è¡Œå¤„ç†ï¼Œæ­¤æ—¶ï¼Œæ¯ä¸ª WebDataBinder å’Œ BeanWrapperImpl å†…çš„ clazz æŒ‡å‘çš„éƒ½æ˜¯è¿™ä¸ªå‚æ•°çš„ç±»ï¼ŒåŸºæœ¬ç±»å‹åœ¨è¿™é‡Œä¼šæ˜¯ä¸€ä¸ª Stringã€Long ä¹‹ç±»çš„ã€‚ åœ¨ BeanWrapperImpl çš„ setPropertyValue æ–¹æ³•ä¸­ï¼Œä¸»è¦æ˜¯å€ŸåŠ©äºç”±è¯·æ±‚è½¬æ¢è€Œæ¥çš„ PropertyValue ç±»ï¼Œè¿™ä¸ªPropertyValue ä¸»è¦æœ‰ name å’Œvalue æ˜¯è¯·æ±‚ä¸­çš„è¯·æ±‚åå’Œå‚æ•°ï¼Œå¹¶è°ƒç”¨äº† BeanPropertyHandler ä»¥ PropertyValue çš„ name å€¼è¿›è¡Œå¤„ç†ã€‚ BeanPropertyHandler é¦–å…ˆ æ ¹æ®è¯·æ±‚åæ‰¾åˆ°è¿™ä¸ªè¯·æ±‚å‚æ•°çš„ç±»é‡Œé¢å¯¹åº”åç§°çš„ Fieldï¼Œå†æ ¹æ® Field è·å–å¯¹åº”çš„ clazzï¼Œç„¶åä½¿ç”¨ Editor çš„ getValue æ¥è¿›è¡Œç±»å‹è½¬æ¢ï¼Œ ä½¿ç”¨ set æ–¹æ³•è¿›è¡Œèµ‹å€¼ï¼Œç„¶åä½¿ç”¨å¯¹åº”å±æ€§çš„  get è¿›è¡Œå–å€¼æ“ä½œã€‚
ä½†æ˜¯åŸºæœ¬ç±»å‹æ²¡æœ‰ setString å’Œ getString ä¹‹ç±»çš„æƒ…å†µã€‚ã€‚ã€‚ã€‚ã€‚æ‰€ä»¥ä»–åè€Œæ²¡åŠæ³•å¤„ç†ç›¸å¯¹åŸºç¡€çš„ç±»å‹ã€‚
è§£å†³æ–¹æ¡ˆåº”è¯¥æ˜¯è€ƒè™‘é…ç½®é»˜è®¤ç±»å‹çš„ writemethod å’Œ readmethodï¼Œï¼Œä¼˜åŒ– BeanPropertyHandler ç±»ã€‚

ç°åœ¨ç»™æˆ‘çš„æ„Ÿè§‰å°±æ˜¯ å¡åœ¨äº†ä¸¤å¤´ä¸­é—´ï¼Œç±»å‹è½¬æ¢å¯ä»¥å®Œæˆï¼Œä¹Ÿèƒ½ä»è¯·æ±‚ä¸­å–åˆ°å€¼ï¼Œå¯ä»¥æ ¹æ®æ–¹æ³•çš„å‚æ•°åˆ—è¡¨æ„å»ºå¯¹åº”çš„ç±»å‹ï¼Œä½†æ˜¯ä¸­é—´åŸºç¡€ç±»å‹çš„ç»‘å®šçš„è¿™ä¸€å—æ˜¯å¡ä½æ— æ³•å¤„ç†çš„ï¼Œå°±æ˜¯åŸºæœ¬ç±»å‹æ˜¯æœ‰é—®é¢˜çš„ã€‚

æœ€åæ˜¯æ€è€ƒé¢˜ï¼Œå¦‚æœè¦å¤„ç†é¡ºåºé—®é¢˜ï¼Œé‚£ä¹ˆåº”è¯¥æ˜¯åœ¨ apaterä¸­å¤„ç†æ–¹æ³•å‚æ•°ä¸Šçš„æ ‡è®°ï¼Œæ ¹æ®æ³¨è§£æˆ–è€…æ ‡è®°æ¥è°ƒæ•´é¡ºåºã€‚æ¯”å¦‚è®¾ç½®ä¸€ä¸ªæ³¨è§£ï¼ŒæŒ‡å®šåŒä¸€ç±»å‹çš„ä¸åŒå‚æ•°çš„åç§°ï¼Œæˆ–è€…æ˜¯æŒ‡å®šé¡ºåºã€‚ç„¶ååœ¨ adapter ä¸­æ‹¿åˆ°æ–¹æ³•åï¼Œæ ¹æ®æ³¨è§£é‡æ’è¿™ä¸ªæ–¹æ³•çš„å‚æ•°åˆ—è¡¨é¡ºåºã€‚
</p>2023-04-07</li><br/><li><span>C.</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<p>this.webBindingInitializer = (WebBindingInitializer) this.webApplicationContext.getBean(&quot;webBindingInitializer&quot;);
è¿™æ®µä»£ç é”™è¯¯çš„åŸå› æ˜¯ä¸Šä¸€ç« èŠ‚çš„DispatcherServletæ–‡ä»¶
  protected void refresh() {
        &#47;&#47; åˆå§‹åŒ– controller
        initController();

        initHandlerMappings(this.webApplicationContext);
        initHandlerAdapters(this.parentApplicationContext);
    }
è¿™ä¸ªåœ°æ–¹ä¼ é€’çš„å®¹å™¨ä¸æ­£ç¡®å¯¼è‡´çš„ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªå®¹å™¨ä¸€ä¸ªæ˜¯é…ç½®æ–‡ä»¶applicationContext.xmlè§£æbeanå®¹å™¨ï¼Œä¸€ä¸ªæ˜¯åŒ…æ‰«æcontrollerçš„beanå®¹å™¨ã€‚è€ŒwebBindingInitializerè¿™ä¸ªbeançš„å®šä¹‰åœ¨applicationContext.xmlé…ç½®æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥ä¼ å…¥webApplicationContextè¿™ä¸ªå®¹å™¨å¯¹è±¡æ˜¯è·å–ä¸åˆ°çš„ã€‚æ”¹ä¸ºparentApplicationContextå°±å¯ä»¥æ­£ç¡®æ‰§è¡Œä¸‹å»ã€‚å¯èƒ½åé¢ç« èŠ‚è¿˜ä¼šæ”¹ï¼Œä½†æ˜¯æœ¬ç« èŠ‚çš„å†…å®¹ç»“æŸå‡ºç°äº†è¿™ä¸ªé—®é¢˜ã€‚</p>2023-04-04</li><br/><li><span>lmnsds</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>WebDataBinderç±»å†³å®šäº†æœ¬æ–‡çš„æ•ˆæœï¼š
    - controllerå‡½æ•°åªèƒ½æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰å¯¹è±¡ç±»å‹ï¼Œä¸”åªèƒ½æœ‰ä¸€ä¸ªå‚æ•°
    - requestä¸­çš„å‚æ•°ä¸èƒ½åä¸èƒ½æ˜¯å‚æ•°å¯¹è±¡ä¸­æ²¡æœ‰çš„æˆå‘˜åç§°ï¼Œå¦åˆ™ä¼šæŠ¥é”™</p>2023-05-16</li><br/><li><span>é£è½»æ‰¬</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>è¿™ä¸€è®²ï¼Œå­¦åˆ°äº†ä»¥ä¸‹çŸ¥è¯†ç‚¹ï¼š
1)ã€å¦‚ä½•å°†è¯·æ±‚å‚æ•°å°è£…åˆ°å®ä½“ç±»çš„å­—æ®µä¸Š
2)ã€ç”¨æ¥å£ï¼Œä¸è¦ç”¨å®ç°ç±»ï¼Œå¢åŠ æ‰©å±•æ€§
Springæ¡†æ¶çœŸæ˜¯åº”äº†ç°åœ¨å¾ˆæµè¡Œçš„ä¸€å¥æœåŠ¡æ ‡è¯­ï¼šæŠŠå›°éš¾ç•™ç»™è‡ªå·±ï¼ŒæŠŠæ–¹ä¾¿å¸¦ç»™å®¢æˆ·ã€‚
å¦å¤–ï¼Œæœ‰2ä¸ªé—®é¢˜ï¼Œè¯·æ•™è€å¸ˆï¼š
1)ã€ä¸ºä»€ä¹ˆè¦ç¿»è¯‘æˆå®¢æˆ·åŒ–è½¬æ¢å™¨å‘¢?ç¿»è¯‘æˆè‡ªå®šä¹‰è½¬æ¢å™¨æ˜¯ä¸æ˜¯æ›´å®¹æ˜“ç†è§£ä¸€ç‚¹?
2)ã€BeanWrapperImplä¸­çš„getValueæ–¹æ³•ä¸­,æ˜¯ä¸€ä¸ªç¬”è¯¯å—?åº”è¯¥æ˜¯readMethod.setAccessibleå§?å¦å¤–,æ­£å¸¸æƒ…å†µä¸‹,å¯¹å¤–æä¾›çš„setã€getæ–¹æ³•éƒ½æ˜¯publicçš„,ä¸éœ€è¦setAccessibleä¸ºtrueäº†å§?</p>2023-04-15</li><br/><li><span>è¢å¸…</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>@RequestMapping(&quot;&#47;test3&quot;)
	public String doTest3(Integer a) {}
å‚æ•°æ˜¯Integer  methodParameter.getType().newInstance();  è¿™è¡Œä¼šæŠ¥é”™å•Š
java.lang.NoSuchMethodException: java.lang.Integer.&lt;init&gt;()</p>2023-04-10</li><br/><li><span>ä¸æ˜¯æ—©æ™¨ï¼Œå°±æ˜¯é»„æ˜</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>æ‰€ä»¥æˆ‘ä»¬åº”è¯¥æ€ä¹ˆæµ‹è¯•å‘¢ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥çš„åœ°å€ä¸­å‚æ•°åº”è¯¥æ˜¯ä»€ä¹ˆï¼Œåº”è¯¥ç»™ä»¥ä¸‹æµ‹è¯•ç¨‹åºï¼Œæ¥æ¢³ç†æ•´ä¸ªæµç¨‹ï¼Œå¦åˆ™å¾ˆä¹±</p>2023-04-09</li><br/><li><span>é©¬å„¿</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>æ„Ÿè§‰è¿™èŠ‚è¯¾çš„å†…å®¹è¿˜æ˜¯æœ‰ç‚¹éš¾æ‡‚.ç›®å‰è‡ªå·±æ¢³ç†äº†ä¸€ä¸‹é€»è¾‘ã€‚å¤§æ¦‚æœ‰ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼Œå¸Œæœ›è€å¸ˆèƒ½æŠ½ç©ºè§£ç­”ä¸€ä¸‹
1.ç°åœ¨çš„ä»£ç ä¼¼ä¹ä¸èƒ½å¤Ÿè§£æåŸºæœ¬ç±»å‹ï¼Œåªèƒ½è§£æå¤æ‚ç±»å‹ã€‚æŒ‰ç…§ä»£ç é€»è¾‘åº”è¯¥æ˜¯å°†æ‰€æœ‰å±æ€§ç»‘å®šåˆ°ä¸€ä¸ªå¤æ‚ç±»å‹ä¸­å»ï¼Œå¦‚æœæ–¹æ³•å‚æ•°æ˜¯åŸºæœ¬ç±»å‹å°±ä¼šæŠ¥é”™NoSuchField
2.å¦‚æœæ˜¯å¤æ‚ç±»å‹controllerä¸­æ¯ä¸ªå‚æ•°éƒ½é€šè¿‡createbinderåˆ›å»ºäº†WebDataBinderï¼Œä½†æ˜¯WebDataBinder#BeanWrapperImplæ¯æ¬¡éƒ½é‡æ–°åˆ›å»ºäº†BeanWrapperImplå¯¹è±¡ï¼Œå¯¼è‡´åˆå§‹æ³¨å†Œçš„CustomEditoråœ¨åç»­æ³¨å†Œçš„æ—¶å€™å¹¶æ²¡æœ‰ç”Ÿæ•ˆã€‚</p>2023-04-04</li><br/><li><span>Geek_xbye50</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>å¢åŠ ä¸€ä¸ªç±»ä¼¼requestParamçš„æ³¨è§£</p>2023-04-03</li><br/><li><span>lmnsds</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>http:&#47;&#47;localhost:8080&#47;test4?name=yourname&amp;id=2&amp;birthday=2023-05-16
å¯ä»¥ä½¿ç”¨å¦‚ä¸Šurlè¿›è¡Œæµ‹è¯•
â€œ&#47;test4â€å¯¹åº”çš„controller method è¦ä»¥Userä¸ºå‚æ•°ã€‚Useræ˜¯å®šä¹‰åœ¨test.entityä¸‹çš„ç±»ã€‚</p>2023-05-16</li><br/><li><span>äº‘ä»</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>è‡ªå®šä¹‰CustomEditoræ—¶ï¼Œè®°å¾—åœ¨RequestMappingHandlerAdapterçš„invokeHandlerMethodï¼ˆï¼‰ æ–¹æ³•é‡Œé¢åˆå§‹åŒ–ä¸€ä¸‹
&#47;&#47;æ³¨å†Œbinderä¸­çš„editor-- è‡ªå®šä¹‰editer
            webBindingInitializer.initBinder(wdb);</p>2023-06-14</li><br/><li><span>C.</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>this.webBindingInitializer = (WebBindingInitializer) this.wac.getBean(&quot;webBindingInitializer&quot;);è¿™æ®µä»£ç åœ¨è¿™ä¸ªç« èŠ‚ç»“æŸæ‰§è¡ŒæŠ¥é”™ï¼ŒNo bean,è€Œä¸”å‡ºç°äº†è¿™ä¸ªæƒ…å†µgetBeanäº†å¥½å¤šæ¬¡HelloWorldBeanã€‚

webBindingInitializer bean created. com.minis.test.DateInitializer : com.minis.test.DateInitializer@305bb0d
handle properties for bean: webBindingInitializer
 bean registerded............. webBindingInitializer
Context Refreshed...
com.minis.test.controller.HelloWorldBean bean created. com.minis.test.controller.HelloWorldBean : com.minis.test.controller.HelloWorldBean@4852cf8d
handle properties for bean: com.minis.test.controller.HelloWorldBean
 bean registerded............. com.minis.test.controller.HelloWorldBean
[2023-04-04 02:29:06,605] å·¥ä»¶ mini-spring:war: å·¥ä»¶å·²æˆåŠŸéƒ¨ç½²
[2023-04-04 02:29:06,605] å·¥ä»¶ mini-spring:war: éƒ¨ç½²å·²èŠ±è´¹ 553 æ¯«ç§’
com.minis.test.controller.HelloWorldBean bean created. com.minis.test.controller.HelloWorldBean : com.minis.test.controller.HelloWorldBean@71e1b60b
handle properties for bean: com.minis.test.controller.HelloWorldBean
 bean registerded............. com.minis.test.controller.HelloWorldBean
com.minis.test.controller.HelloWorldBean bean created. com.minis.test.controller.HelloWorldBean : com.minis.test.controller.HelloWorldBean@4ab383d7
handle properties for bean: com.minis.test.controller.HelloWorldBean
 bean registerded............. com.minis.test.controller.HelloWorldBean
com.minis.test.controller.HelloWorldBean bean created. com.minis.test.controller.HelloWorldBean : com.minis.test.controller.HelloWorldBean@6962cf89
handle properties for bean: com.minis.test.controller.HelloWorldBean
 bean registerded............. com.minis.test.controller.HelloWorldBean
com.minis.test.controller.HelloWorldBean bean created. com.minis.test.controller.HelloWorldBean : com.minis.test.controller.HelloWorldBean@1256dc01
handle properties for bean: com.minis.test.controller.HelloWorldBean
 bean registerded............. com.minis.test.controller.HelloWorldBean</p>2023-04-04</li><br/>
</ul>