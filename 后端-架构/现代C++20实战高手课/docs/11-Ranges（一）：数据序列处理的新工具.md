ä½ å¥½ï¼Œæˆ‘æ˜¯å¢èª‰å£°ã€‚

ç¬¬ä¸€ç« ï¼Œæˆ‘ä»¬è¯¦ç»†äº†è§£äº†C++20æ”¯æŒçš„ä¸‰å¤§æ ¸å¿ƒè¯­è¨€ç‰¹æ€§å˜æ›´â€”â€”Modulesã€Conceptså’ŒCoroutinesã€‚ä½†æ˜¯é€šå¸¸æ„ä¹‰ä¸Šæ‰€è®²çš„C++ï¼Œå…¶å®æ˜¯ç”±æ ¸å¿ƒè¯­è¨€ç‰¹æ€§å’Œæ ‡å‡†åº“ï¼ˆC++ Standard Libraryï¼‰å…±åŒæ„æˆçš„ã€‚

å¯¹æ ‡å‡†åº“æ¥è¯´ï¼Œæ ‡å‡†æ¨¡æ¿åº“STLï¼ˆStandard Template Libraryï¼‰ä½œä¸ºæ ‡å‡†åº“çš„å­é›†ï¼Œæ˜¯æ ‡å‡†åº“çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œæ˜¯C++ä¸­å­˜å‚¨æ•°æ®ã€è®¿é—®æ•°æ®å’Œæ‰§è¡Œè®¡ç®—çš„é‡è¦åŸºç¡€è®¾æ–½ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒç®€åŒ–ä»£ç ç¼–å†™ï¼Œé¿å…é‡æ–°é€ è½®å­ã€‚

ä¸è¿‡æ ‡å‡†æ¨¡æ¿åº“ä¸æ˜¯å®Œç¾çš„ï¼Œå®ƒä¹Ÿåœ¨ä¸æ–­æ¼”è¿›ã€‚åŸæœ¬çš„æ ‡å‡†æ¨¡æ¿åº“ï¼Œå¹¶æ²¡æœ‰ç»™å¤§è§„æ¨¡ã€å¤æ‚æ•°æ®çš„å¤„ç†æ–¹é¢æä¾›å¾ˆå¥½çš„æ”¯æŒã€‚è¿™æ˜¯å› ä¸ºï¼ŒC++åœ¨è¯­è¨€å’Œåº“çš„è®¾è®¡ä¸Šï¼Œè®©C++å‡½æ•°å¼ç¼–ç¨‹å˜å¾—å¤æ‚ä¸”å†—é•¿ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä»C++20å¼€å§‹æ”¯æŒäº†Rangesâ€”â€”è¿™æ˜¯C++æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹çš„ä¸€ä¸ªå·¨å¤§é£è·ƒã€‚

ç‰¹åˆ«æ˜¯C++åœ¨è¿è¡Œæ—¶æ€§èƒ½æ–¹é¢çš„ç»å¯¹ä¼˜åŠ¿ï¼ŒRangesè®©C++é€æ¸æˆä¸ºäº†å¤„ç†å¤§è§„æ¨¡å¤æ‚æ•°æ®çš„æ–°è´µã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬æ›´æœ‰å¿…è¦æŒæ¡å®ƒï¼Œæˆ‘ç›¸ä¿¡åœ¨å­¦å®ŒRangesåï¼Œä½ ä¼šçˆ±ä¸Šè¿™ç§ä¾¿åˆ©çš„æ•°æ®å¤„ç†æ–¹å¼ï¼

å¥½äº†ï¼Œè¯ä¸å¤šè¯´ï¼Œå°±è®©æˆ‘ä»¬ä»C++å‡½æ•°å¼ç¼–ç¨‹å¼€å§‹ä»Šå¤©çš„å­¦ä¹ å§ï¼ˆé¡¹ç›®çš„å®Œæ•´ä»£ç ï¼Œä½ å¯ä»¥[è¿™é‡Œ](https://github.com/samblg/cpp20-plus-indepth)è·å–ï¼‰ã€‚

## å‰ç½®çŸ¥è¯†

å¦‚æœä½ å¯¹å‡½æ•°å¼ç¼–ç¨‹å¹¶æ²¡æœ‰æ¸…æ™°çš„æ¦‚å¿µï¼Œå»ºè®®å…ˆç®€å•äº†è§£ä¸€ä¸‹åé¢çš„å‰ç½®çŸ¥è¯†ï¼Œå¦‚æœå·²ç»æ¸…æ¥šäº†ï¼Œå¯ä»¥ç›´æ¥è·³è¿‡ï¼Œä»â€œå‡½æ•°å¼ç¼–ç¨‹ä¹‹å›°â€å¼€å§‹çœ‹ã€‚

æˆ‘ä»¬å…ˆè¯´è¯´å‡½æ•°å¼ç¼–ç¨‹çš„ä¸»è¦æ€è·¯â€”â€”æŠŠæ‰€æœ‰çš„è¿ç®—è¿‡ç¨‹å°½é‡å†™æˆz=f(g(x))è¿™ç§åµŒå¥—å‡½æ•°çš„å½¢å¼ï¼Œè€Œæœ€ç®€åŒ–çš„å½¢å¼è‡ªç„¶å°±æ˜¯y=f(x)ã€‚è¿™é‡Œå‡½æ•°åµŒå¥—å¯ä»¥ä¸åªæœ‰ä¸€å±‚ï¼Œæ¯ä¸ªå‡½æ•°çš„å‚æ•°æ•°é‡ä¹Ÿèƒ½çµæ´»è°ƒæ•´ï¼Œç”šè‡³å¯ä»¥å®Œå…¨ä½¿ç”¨â€œæ•°å­¦å‡½æ•°â€æ¥æè¿°æ•´ä¸ªè®¡ç®—è¿‡ç¨‹ã€‚

å‡½æ•°å¼ç¼–ç¨‹ä¼—å¤šç‰¹æ€§ä¸­ï¼Œæœ€é‡è¦çš„å°±æ˜¯â€œæ•°æ®ä¸å¯å˜æ€§â€ä¸â€œé«˜é˜¶å‡½æ•°â€ã€‚

æ•°æ®ä¸å¯å˜æ€§ä¹Ÿå«â€œæ— å‰¯ä½œç”¨â€ï¼Œä¹Ÿå°±æ˜¯åœ¨è®¡ç®—è¿‡ç¨‹ä¸­æ°¸è¿œä¸ä¼šä¿®æ”¹å‚æ•°ï¼Œä¹Ÿä¸ä¼šäº§ç”Ÿä¸å¿…è¦çš„å¤–éƒ¨çŠ¶æ€å˜åŒ–ã€‚æˆ‘ä»¬éƒ½çŸ¥é“æ•°å­¦ä¸­å‡½æ•°å‚æ•°ä¸å¯ä¿®æ”¹ï¼Œä¸”å…·æœ‰å¹‚ç­‰æ€§ï¼Œå‡½æ•°å¼ç¼–ç¨‹è‡ªç„¶ä¹Ÿå°±è¦ä¿æŒè¿™äº›æ€§è´¨ã€‚

å¹¶è¡Œè®¡ç®—çš„æ€§èƒ½ç“¶é¢ˆå¾€å¾€åœ¨äºâ€œç«äº‰â€ï¼Œè€Œç«äº‰çš„åŸå› å°±æ˜¯ç¨‹åºæ‰§è¡Œä¸­äº§ç”Ÿçš„â€œå‰¯ä½œç”¨â€ï¼Œæ— å‰¯ä½œç”¨çš„ç¨‹åºå¾€å¾€æ‰èƒ½å°†å¹¶è¡Œè®¡ç®—çš„ä¼˜åŠ¿æœ€å¤§åŒ–ã€‚æˆ‘ä»¬ç†ŸçŸ¥çš„MapReduceï¼Œæ­£æ˜¯å‡½æ•°å¼ç¼–ç¨‹æ€è·¯åœ¨åˆ†å¸ƒå¼è®¡ç®—ä¸­çš„ä¸€ç§å®ç°ã€‚

å†æ¥è¯´è¯´â€œé«˜é˜¶å‡½æ•°â€çš„æ„æ€ã€‚å‡½æ•°å¼ç¼–ç¨‹çš„å‚æ•°å¯ä»¥æ˜¯å¦ä¸€ä¸ªå‡½æ•°è¡¨è¾¾å¼ï¼Œåœ¨å‡½æ•°çš„å®ç°ä¸­å¯ä»¥é€šè¿‡è°ƒç”¨å‚æ•°æ¥è°ƒç”¨å‡½æ•°ï¼Œå‡è®¾f(x,g)çš„å®šä¹‰ä¸ºg(x)ï¼Œé‚£ä¹ˆgå°±æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ã€‚å‡½æ•°å¼ç¼–ç¨‹ä¸­å°†å‡½æ•°ä½œä¸ºâ€œä¸€ç­‰å…¬æ°‘â€ï¼Œæ‰€ä»¥è¿™ç§ç‰¹æ€§è‡ªç„¶ä¹Ÿå°±ä¸è¶³ä¸ºå¥‡ã€‚

## å‡½æ•°å¼ç¼–ç¨‹ä¹‹å›°

äº†è§£äº†å‡½æ•°å¼ç¼–ç¨‹çš„å«ä¹‰ï¼Œæˆ‘ä»¬è®¨è®ºä¸€ä¸‹åœ¨C++20ä¹‹å‰ï¼Œåœ¨C++ä¸­å®ç°å‡½æ•°å¼ç¼–ç¨‹åˆ°åº•é‡åˆ°äº†ä»€ä¹ˆå›°å¢ƒï¼Ÿ

äº‹å®ä¸Šï¼ŒSTLä»ä¸€å¼€å§‹å°±ä¸ºå‡½æ•°å¼ç¼–ç¨‹æä¾›äº†æ”¯æŒã€‚é¦–å…ˆï¼ŒSTLä¸­æœ€é‡è¦çš„ä¸‰ä¸ªæ¦‚å¿µæ˜¯å®¹å™¨ã€è¿­ä»£å™¨å’Œç®—æ³•ï¼Œåˆ†åˆ«ç”¨äºè§£å†³æ•°æ®å­˜å‚¨ã€è®¿é—®å’Œè®¡ç®—é—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ¨¡æ¿å‚æ•°æ¥æŒ‡å®šå®ƒä»¬çš„æ•°æ®å…ƒç´ ç±»å‹ã€‚

STLè¦æ±‚æ•°æ®å…ƒç´ ç±»å‹å…·å¤‡â€œå¯æ‹·è´â€æ€§ï¼ˆcopyableï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒSTLä¸­çš„æ‰€æœ‰æ“ä½œï¼ˆåŒ…æ‹¬æ•°æ®çš„èµ‹å€¼å’Œè®¡ç®—ï¼‰éƒ½éœ€è¦æ•°æ®ç±»å‹æ”¯æŒæ‹·è´ï¼Œè¿™ç§å¯æ‹·è´æ€§è‡ªç„¶ä¹Ÿå°±ä»è®¾è®¡ä¸Šä¿è¯äº†å‡½æ•°å¼ç¼–ç¨‹çš„â€œä¸å¯å˜æ€§â€ã€‚

STLçš„ç®—æ³•å‡½æ•°éƒ½å¯ä»¥ä½¿ç”¨å‡½æ•°æŒ‡é’ˆæˆ–ä»¿å‡½æ•°ï¼ˆfunctorï¼‰æ¥å¤„ç†è¿­ä»£å™¨æŒ‡å‘çš„æ•°æ®å…ƒç´ ï¼Œå…¶æœ¬è´¨ä¹Ÿå°±æ˜¯å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„é«˜é˜¶å‡½æ•°ã€‚åŒæ—¶ï¼Œåœ¨C++11å¼•å…¥Lambdaè¡¨è¾¾å¼ä¹‹åï¼Œä½¿ç”¨é«˜é˜¶å‡½æ•°å˜å¾—æ–¹ä¾¿ä¸€äº›ã€‚

ä¸è¿‡ï¼Œä½¿ç”¨STLè¿›è¡Œå‡½æ•°å¼ç¼–ç¨‹ä»ç„¶éå¸¸ç—›è‹¦ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å°†æ•°æ®çš„å¤„ç†æµç¨‹æ‹†åˆ†æˆå¤šä¸ªè®¡ç®—æ­¥éª¤ï¼Œè€Œè¿™äº›è®¡ç®—æ­¥éª¤ä¹‹é—´æ˜¯ç›¸äº’ä¾èµ–çš„ï¼ˆä¹Ÿå°±æ˜¯å‰ä¸€æ­¥çš„è¾“å‡ºéƒ½æ˜¯åä¸€æ­¥çš„è¾“å…¥ï¼‰ã€‚

ä¸ºäº†è®©ä½ æ›´ç›´è§‚åœ°æ„Ÿå—è¿™ç‚¹ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªé‡‡ç”¨C++ STLçš„ä¼ ç»Ÿå‡½æ•°å¼ç¼–ç¨‹æ¡ˆä¾‹ã€‚

```c++
#include <iostream>
#include <vector>
#include <algorithm>
#include <cstdint>

int main() {
Â Â Â  std::vector<int32_t> numbers{
Â Â Â Â Â Â Â  1, 2, 3, 4, 5
Â Â Â  };

Â Â Â  std::vector<int32_t> doubledNumbers;
Â Â Â  std::transform(
Â Â Â Â Â Â Â  numbers.begin(), numbers.end(), std::back_inserter(doubledNumbers),
Â Â Â Â Â Â Â  [](int32_t number) { return number * 2; }
Â Â Â  );

Â Â Â  std::vector<int32_t> filteredNumbers;
Â Â Â  std::copy_if(
Â Â Â Â Â Â Â  doubledNumbers.begin(), doubledNumbers.end(), std::back_inserter(filteredNumbers),
Â Â Â Â Â Â Â  [](int32_t number) { return number < 5; }
Â Â Â  );

Â Â Â  std::for_each(filteredNumbers.begin(), filteredNumbers.end(), [](int32_t number) {
Â Â Â Â Â Â Â  std::cout << number << std::endl;
Â Â Â  });

Â Â Â  return 0;
}
```

çœ‹è¿‡ä»£ç æˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œåœ¨C++ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰å¤§é‡å˜é‡ï¼Œæ¥å­˜å‚¨æ¯ä¸€æ­¥çš„è®¡ç®—ç»“æœï¼Œç„¶åå°†å…¶ä½œä¸ºä¸‹ä¸€æ­¥è®¡ç®—çš„è¾“å…¥ã€‚è€Œä¸”C++ç®—æ³•å‡½æ•°éœ€è¦ä½¿ç”¨â€œè¿­ä»£å™¨â€ä½œä¸ºå‚æ•°ï¼Œæ¯æ¬¡è°ƒç”¨C++ç®—æ³•æ—¶ï¼Œéƒ½éœ€è¦æŒ‡å®šå®¹å™¨çš„beginå’Œendã€‚STLä¹Ÿä¸ä¼šæ£€æŸ¥è¿­ä»£å™¨çš„åˆæ³•æ€§ï¼Œæˆ‘ä»¬ä¸å¾—ä¸ç¼–å†™å¾ˆå¤šé”™è¯¯å¤„ç†ä»£ç ï¼Œæ‰€ä»¥ä½¿ç”¨STLçš„ä»£ç å˜å¾—æ›´åŠ å¤æ‚å†—é•¿ã€‚

ä¸ºäº†å½»åº•è§£å†³C++ä¸­å‡½æ•°å¼ç¼–ç¨‹çš„éšœç¢ï¼Œä»C++20å¼€å§‹æå‡ºäº†Rangesâ€”â€”è¿™æ˜¯ä¸€å¥—å¯æ‰©å±•ä¸”æ³›ç”¨çš„ç®—æ³•ä¸è¿­ä»£æ¥å£ï¼Œå¼€å‘è€…å¯ä»¥æ›´æ–¹ä¾¿åœ°ç»„åˆè¿™äº›æ¥å£ã€‚ç›¸æ¯”ä¼ ç»ŸSTLç®—æ³•ï¼ŒRangesæ›´å¥å£®ï¼Œä¸æ˜“å¼•å‘é”™è¯¯ã€‚

æˆ‘ä»¬ç”¨RangesæŠŠä¸Šé¢çš„æ¡ˆä¾‹æ”¹å†™ä¸€ä¸‹ã€‚

```c++
#include <iostream>
#include <vector>
#include <algorithm>
#include <cstdint>
#include <ranges>

int main() {
Â Â Â  namespace ranges = std::ranges;
Â Â Â  namespace views = std::views;

Â Â Â  std::vector<int32_t> numbers{
Â Â Â Â Â Â Â  1, 2, 3, 4, 5
Â Â Â  };

Â Â Â  ranges::for_each(numbers |
Â Â Â Â Â Â Â  views::transform([](int32_t number) { return number * 2; }) |
Â Â Â Â Â Â Â  views::filter([](int32_t number) { return number < 5; }),
Â Â Â Â Â Â Â  [](int32_t number) {
Â Â Â Â Â Â Â Â Â Â Â  std::cout << number << std::endl;
Â Â Â Â Â Â Â  }
Â Â Â  );

Â Â Â  return 0;
}
```

è¿™æ®µä»£ç çš„å…·ä½“å«ä¹‰æˆ‘å…ˆå–ä¸ªå…³å­ï¼Œç­‰åé¢å­¦ä¹ å®ŒRangesåï¼Œä½ å¯ä»¥å›é¡¾ä¸€ä¸‹è¿™æ®µä»£ç ï¼Œåˆ°æ—¶å€™å°±èƒ½ç†è§£äº†ã€‚ä½†æ— è®ºå¦‚ä½•ï¼Œä½ éƒ½èƒ½å‘ç°é‡‡ç”¨Rangesæ”¹å†™åä»£ç æ˜æ˜¾å˜å¾—ç®€æ´æ¸…æ™°äº†ã€‚

æ¥ä¸‹æ¥ï¼Œå°±è®©æˆ‘ä»¬ç»§ç»­æ¢ç´¢ï¼Œçœ‹çœ‹Rangesæ˜¯å¦‚ä½•å®ç°è¿™ç§å˜åŒ–çš„å§ï¼

## Ranges

Rangesçš„æ ¸å¿ƒæ¦‚å¿µå°±æ˜¯rangeã€‚Rangesåº“å°†rangeå®šä¹‰ä¸ºä¸€ä¸ªconceptï¼Œä½ å¯ä»¥æŠŠrangeç®€å•ç†è§£æˆä¸€ä¸ªå…·å¤‡beginè¿­ä»£å™¨å’Œendè¿­ä»£å™¨çš„å¯¹è±¡ï¼Œç›¸å½“äºæ˜¯ä¼ ç»ŸSTLå®¹å™¨å¯¹è±¡çš„ä¸€ç§æ³›åŒ–ã€‚

Rangesæä¾›äº†ä¸€äº›å·¥å…·å‡½æ•°ï¼Œç”¨äºè®¿é—®ä¼ ç»ŸSTLå®¹å™¨å’ŒRangesè§†å›¾çš„æ•°æ®ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥è¯¦ç»†ä»‹ç»Rangesçš„è¿™äº›å·¥å…·å‡½æ•°ã€‚

### è·å–è¿­ä»£å™¨

é¦–å…ˆï¼Œrangeæœ¬èº«æ˜¯ä¸€ä¸ªconceptã€‚å› æ­¤ï¼ŒRangesæä¾›äº†é€šç”¨å‡½æ•°ï¼Œæ¥è·å–rangeå¯¹è±¡çš„è¿­ä»£å™¨ï¼ŒåŒ…æ‹¬æ‰€æœ‰æ»¡è¶³rangeçº¦æŸçš„å¯¹è±¡çš„è¿­ä»£å™¨ã€‚ä¸ºäº†å¸®ä½ æ›´å¥½åœ°ç†è§£ï¼Œæˆ‘ä»¬ç»“åˆä¸€æ®µç¤ºä¾‹ä»£ç çœ‹ä¸€çœ‹ã€‚

```c++
#include <vector>
#include <algorithm>
#include <ranges>
#include <iostream>
 
int main() {
    namespace ranges = std::ranges;
 
    // é¦–å…ˆï¼Œè°ƒç”¨ranges::beginå’Œranges::endå‡½æ•°è·å–å®¹å™¨çš„è¿­ä»£å™¨
    // æ¥ç€ï¼Œé€šè¿‡è¿­ä»£å™¨è®¿é—®æ•°æ®ä¸­çš„å…ƒç´ 
    std::vector<int> v = { 3, 1, 4, 1, 5, 9, 2, 6 };
    auto start = ranges::begin(v);
    std::cout << "[0]: " << *start << std::endl;
 
    auto curr = start;
    curr++;
    std::cout << "[1]: " << *curr << std::endl;
 
    std::cout << "[4]: " << *(curr + 3) << std::endl;
 
    auto stop = ranges::end(v);
    std::sort(start, stop);
 
    // æœ€åï¼Œè°ƒç”¨ranges::cbeginå’Œranges::cendå¾ªç¯è¾“å‡ºæ’åºåçš„æ•°æ®
    for (auto it = ranges::cbegin(v);
        it != ranges::cend(v);
        ++it
    ) {
        std::cout << *it << " ";
    }
    std::cout << std::endl;
 
    return 0;
}
```

ä»è¿™æ®µä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œrangesè¿­ä»£å™¨çš„æ“ä½œå’ŒSTLçš„æ ‡å‡†è¿­ä»£å™¨æ“ä½œæ˜¯ä¸€æ ·çš„ã€‚æˆ‘åœ¨è¿™é‡Œåˆ—å‡ºRangesä¸­çš„æ‰€æœ‰è¿­ä»£å™¨å‡½æ•°ã€‚ä½ å¯ä»¥å‘ç°ï¼Œè¿™äº›è¿­ä»£å™¨è·Ÿä¼ ç»ŸSTLä¸­çš„è¿­ä»£å™¨å¹¶æ— äºŒè‡´ã€‚

![](https://static001.geekbang.org/resource/image/a4/13/a49b2bb66958a588a3632784148dcc13.jpg?wh=3500x1520)

### è·å–é•¿åº¦

Rangesä¹Ÿæä¾›äº†è·å–rangeé•¿åº¦çš„å‡½æ•°â€”â€”ranges::sizeå’Œranges::ssizeã€‚å®ƒä»¬éƒ½å¯ä»¥è·å–æŸä¸ªrangeçš„é•¿åº¦ï¼Œä¸è¿‡å‰è€…è¿”å›å€¼æ˜¯æ— ç¬¦å·æ•´æ•°ï¼Œåè€…è¿”å›å€¼æ˜¯æœ‰ç¬¦å·æ•´æ•°ã€‚

æˆ‘å†™äº†ä¸€æ®µç®€å•çš„ç¤ºä¾‹ä»£ç ï¼Œä¾›ä½ å‚è€ƒã€‚

```c++
#include <vector>
#include <ranges>
#include <iostream>
Â 
int main() {
Â Â Â  namespace ranges = std::ranges;
Â 
Â Â Â  std::vector<int> v = { 3, 1, 4, 1, 5, 9, 2, 6 };
Â Â Â  std::cout << ranges::size(v) << std::endl;
Â Â Â  std::cout << ranges::ssize(v) << std::endl;
Â 
Â Â Â  return 0;
}
```

### è·å–æ•°æ®æŒ‡é’ˆ

äº‹å®ä¸Šï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨rangeæ—¶ä¼šå‘ç°ï¼Œæœ‰äº›rangeæ˜¯æ”¯æŒè·å–å†…éƒ¨æ•°æ®ç¼“å†²åŒºçš„ï¼Œè¿™åœ¨æ“çºµstd::vectorè¿™æ ·çš„å®¹å™¨æ—¶éå¸¸æœ‰å¸®åŠ©ã€‚é’ˆå¯¹è¿™ç±»rangeï¼ŒRangesæä¾›äº†ä¸‹åˆ—å‡½æ•°ç”¨äºè·å–å…¶å†…éƒ¨æ•°æ®ç¼“å†²åŒºæŒ‡é’ˆã€‚

- ranges::dataï¼šè·å–æŸä¸ªrangeçš„è¿ç»­æ•°æ®ç¼“å†²åŒºã€‚
- ranges::cdataï¼šä¸Šè¿°å‡½æ•°çš„åªè¯»ç‰ˆæœ¬ã€‚

æˆ‘åŒæ ·é™„ä¸Šäº†ç¤ºä¾‹ä»£ç ã€‚

```c++
#include <vector>
#include <ranges>
#include <iostream>
Â 
int main() {
Â Â Â  namespace ranges = std::ranges;
Â 
Â Â Â  std::vector<int> v = { 3, 1, 4, 1, 5, 9, 2, 6 };
Â 
Â Â Â  auto data = ranges::data(v);
Â Â Â  std::cout << "[1]" << data[1] << std::endl;
Â Â Â  data[2] = 10;
Â 
Â Â Â  auto cdata = ranges::cdata(v);
Â Â Â  std::cout << "[2]" << cdata[2] << std::endl;
Â 
Â Â Â  return 0;
}
```

åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ranges::dataè·å–äº†å†…éƒ¨ç¼“å†²åŒºï¼Œå¹¶é€šè¿‡dataä¿®æ”¹äº†æ•°æ®ã€‚æœ€åï¼Œé€šè¿‡cdataè·å–åªè¯»ç¼“å†²åŒºå¹¶è¾“å‡ºäº†ä¿®æ”¹åçš„æ•°æ®ã€‚

### æ‚¬ç©ºè¿­ä»£å™¨

ä¸åŒäºä¼ ç»ŸSTLï¼Œrangesä¸ºäº†ä¿è¯ä»£ç çš„å¥å£®æ€§ï¼Œç‰¹æ„æä¾›äº†ç¼–è¯‘æ—¶å¯¹æ‚¬ç©ºè¿­ä»£å™¨çš„æ£€æµ‹ï¼Œä¸»è¦çš„å·¥å…·å°±æ˜¯ranges::danglingè¿™ä¸€ç±»å‹ã€‚

é‚£ä¹ˆä»€ä¹ˆæ˜¯æ‚¬ç©ºè¿­ä»£å™¨å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™æ®µä»£ç ã€‚ä½ å¯ä»¥æš‚åœä¸€ä¸‹ï¼Œè‡ªå·±æ¨æµ‹ä¸€ä¸‹è¿™æ®µä»£ç èƒ½ä¸èƒ½æˆåŠŸç¼–è¯‘ã€‚

```c++
#include <vector>
#include <algorithm>
#include <ranges>
#include <iostream>
Â 
int main() {
Â Â Â  namespace ranges = std::ranges;
Â 
Â Â Â  auto getArray = [] { return std::vector{ 0, 1, 0, 1 }; };
Â 
Â Â Â  // ç¼–è¯‘æˆåŠŸ
Â Â Â  auto start = std::find(getArray().begin(), getArray().end(), 1);
Â Â Â  std::cout << *start << std::endl;
Â 
Â Â Â  // ç¼–è¯‘å¤±è´¥
Â Â Â  auto rangeStart = ranges::find(getArray(), 1);
Â Â Â  std::cout << *rangeStart << std::endl;
Â 
Â Â Â  return 0;
}
```

è¿™æ®µä»£ç æœ€ç»ˆä¼šç¼–è¯‘å¤±è´¥ã€‚åŸå› æ˜¯è°ƒç”¨getArray()è¿”å›çš„vectorå¯¹è±¡æ˜¯å‡½æ•°è°ƒç”¨è¿”å›çš„å³å€¼ï¼ˆrvalueï¼‰ï¼Œæˆ‘ä»¬æ²¡æœ‰å°†å®ƒèµ‹å€¼ç»™ä»»ä½•ä¸€ä¸ªå˜é‡ï¼Œä¹Ÿæ²¡æœ‰é€šè¿‡å¼•ç”¨æ¥å»¶é•¿å®ƒçš„ç”Ÿå‘½å‘¨æœŸã€‚

å› æ­¤ï¼Œvectorå¯¹è±¡åœ¨ranges::findå‡½æ•°æ‰§è¡Œåï¼Œç”Ÿå‘½å‘¨æœŸå°±å·²ç»ç»“æŸäº†ã€‚æ­¤æ—¶findå‡½æ•°è¿”å›çš„è¿­ä»£å™¨æŒ‡å‘çš„æ•°æ®åŒºåŸŸå…¶å®å·²ç»è¢«é‡Šæ”¾ï¼Œå¯¼è‡´è¿­ä»£å™¨å˜æˆäº†â€œæ‚¬ç©ºâ€çŠ¶æ€â€”â€”ç±»ä¼¼äºæŒ‡å‘è¢«é‡Šæ”¾ç¼“å†²åŒºçš„æ‚¬ç©ºæŒ‡é’ˆã€‚

ä½†æ˜¯ï¼Œé€šè¿‡ä¼ ç»Ÿçš„findç®—æ³•è®¿é—®è¿­ä»£å™¨æ˜¯ä¸ä¼šæŠ¥ç¼–è¯‘é”™è¯¯çš„ã€‚ä¸è¿‡è¿è¡Œæ—¶ä¼šå‡ºé—®é¢˜ï¼Œæ¯•ç«Ÿæ•°æ®å·²ç»è¢«é‡Šæ”¾äº†ã€‚

è¿™å°±æ˜¯Rangesçš„ç‹¬ç‰¹ä¹‹å¤„ï¼Œ**å¯ä»¥åœ¨ç¼–è¯‘æ—¶æå‰æ£€æŸ¥å¯èƒ½å‡ºç°æ‚¬ç©ºå¼•ç”¨çš„é—®é¢˜ï¼Œæé«˜ä»£ç çš„å¥å£®æ€§**ã€‚

é‚£ä¹ˆï¼Œ**é”™è¯¯æ£€æµ‹çš„åŸç†åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ**

è¿™å¾—ç›Šäºä»C++20å¼€å§‹æ”¯æŒçš„conceptsã€‚æ‰€æœ‰Rangesçš„ç®—æ³•é’ˆå¯¹ä¸æ»¡è¶³borrowed\_rangeçº¦æŸçš„å¯¹è±¡ï¼Œä¼šç›´æ¥è¿”å›ranges::danglingâ€”â€”è¯¥ç±»å‹æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œè¡¨ç¤ºæ‚¬ç©ºè¿­ä»£å™¨ã€‚

æ‰€ä»¥è¯´ï¼Œä¸‹é¢çš„ä»£ç å¯ä»¥ç”¨äºä¸»åŠ¨æ£€æµ‹rangeçš„æ‚¬ç©ºè¿­ä»£å™¨ã€‚

```c++
#include <vector>
#include <ranges>
#include <iostream>
#include <type_traits>
Â 
int main() {
Â Â Â  namespace ranges = std::ranges;
Â 
Â Â Â  auto getArray = [] { return std::vector{ 0, 1, 0, 1 }; };
Â 
Â Â Â  auto rangeStart = ranges::find(getArray(), 1);
Â Â Â  // é€šè¿‡type_traitsåœ¨è¿è¡Œæ—¶æ£€æµ‹è¿”å›çš„è¿­ä»£å™¨æ˜¯å¦ä¸ºæ‚¬ç©ºè¿­ä»£å™¨ï¼ˆä¸ä¼šå¼•å‘ç¼–è¯‘é”™è¯¯ï¼‰
Â Â Â  std::cout << std::is_same_v<ranges::dangling, decltype(rangeStart)> << std::endl;

Â Â Â  // é€šè¿‡static_assertä¸»åŠ¨æä¾›å®¹æ˜“ç†è§£çš„ç¼–è¯‘æœŸé”™è¯¯ï¼ˆä¼šå¼•å‘ç¼–è¯‘é”™è¯¯ï¼ï¼ï¼ï¼‰
Â Â Â  static_assert(!std::is_same_v<ranges::dangling, decltype(rangeStart)>, "rangeStart is dangling!!!!");
Â 
Â Â Â  return 0;
}
```

åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡is\_same\_væ¥æ£€æµ‹è¿”å›è¿­ä»£å™¨çš„ç±»å‹ï¼ŒæŸ¥çœ‹å®ƒæ˜¯å¦ä¸ºæ‚¬ç©ºè¿­ä»£å™¨ã€‚åŒæ—¶ï¼Œè¿™æ®µä»£ç è¿˜æ¼”ç¤ºäº†æ€ä¹ˆä½¿ç”¨static\_assertæ¥å®ç°ç¼–è¯‘æ—¶é”™è¯¯æ£€æµ‹ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©äºå®ƒæ¥æä¾›æ˜“äºç†è§£çš„ç¼–è¯‘æ—¶é”™è¯¯ä¿¡æ¯ã€‚

## æ€»ç»“

åœ¨Rangeså‡ºç°ä¹‹å‰ï¼ŒC++é‡Œç”¨STLè¿›è¡Œå‡½æ•°å¼ç¼–ç¨‹éå¸¸ç—›è‹¦ï¼Œä¸»è¦åŸå› æ˜¯ä»£ç å¤æ‚å†—é•¿ã€‚ä¸ºäº†å½»åº•è§£å†³è¿™ç§éšœç¢ï¼Œä»C++20å¼€å§‹æå‡ºäº†Rangesã€‚

Rangesåº“æä¾›äº†rangeè¿™ä¸ªæ–°çš„conceptï¼Œä½œä¸ºä¼ ç»Ÿå®¹å™¨çš„ä¸€ç§æ³›åŒ–ã€‚åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼ŒRangesåº“ä¸ºrangeæä¾›äº†ä¼ ç»Ÿè¿­ä»£å™¨å’Œç®—æ³•çš„æ”¯æŒï¼Œè®©å¼€å‘è€…å¯ä»¥åƒä¼ ç»Ÿå®¹å™¨ä¸€æ ·ä½¿ç”¨rangeï¼Œç”šè‡³åœ¨ä½¿ç”¨ä¸ºrangeæä¾›çš„constraint algorithmæ—¶ï¼Œæ¯”ä¼ ç»Ÿç®—æ³•æ›´åŠ æ–¹ä¾¿ã€‚

Rangesæœ¬è´¨ä¸Šæ˜¯ä¸€å¥—å¯æ‰©å±•ä¸”æ³›ç”¨çš„ç®—æ³•ä¸è¿­ä»£æ¥å£ï¼Œå®ƒæ›´åŠ å¥å£®ï¼Œä¸å®¹æ˜“å¼•å‘é”™è¯¯ã€‚Rangesåº“å……åˆ†åˆ©ç”¨äº†C++20æä¾›çš„conceptsï¼Œç”¨äºæè¿°ä¸åŒç±»å‹çš„rangeçš„çº¦æŸã€‚ä½ å¯ä»¥å‚è€ƒåé¢çš„è¡¨æ ¼è¯¦ç»†äº†è§£ã€‚

![](https://static001.geekbang.org/resource/image/35/e0/35dcc8ec3258f406a3b1d4058e6621e0.jpg?wh=3500x2773)

è¿™äº›conceptså¯¹æˆ‘ä»¬çš„åç»­è®¨è®ºéå¸¸é‡è¦ã€‚ä¸‹ä¸€è®²ï¼Œæˆ‘ä»¬è¿˜ä¼šè®¨è®ºå…·ä½“çº¦æŸï¼Œåˆ°æ—¶ä½ ä¸å¦¨å†çœ‹çœ‹è¿™ä»½è¡¨æ ¼ï¼Œå›é¡¾ä¸€ä¸‹é‡Œé¢å¯¹å„ç§çº¦æŸè¡¨è¾¾å¼çš„è§£é‡Šï¼ŒåŠ æ·±è®°å¿†å’Œç†è§£ã€‚

## æ€è€ƒé¢˜

Rangesæä¾›äº†ä»¥å¾€C++ä¸­ä¸å­˜åœ¨çš„æ•°æ®è¿­ä»£ç‰¹æ€§ï¼Œç‰¹åˆ«æ˜¯è¶Šç•Œè¿™ç§é”™è¯¯æ£€æµ‹ã€‚é‚£ä¹ˆåœ¨ä½ å¹³æ—¶çš„å·¥ä½œä¸­ä½¿ç”¨C++æ—¶ï¼Œä¼šé‡‡ç”¨å“ªäº›å®è·µæ–¹æ³•æ¥é¿å…è¶Šç•Œï¼Ÿ

å¦å¤–ï¼Œæˆ‘ä»¬æåˆ°äº†rangeæ˜¯ä¸€ä¸ªconceptï¼Œé‚£ä¹ˆè¿™ä¸ªconceptè¦å¦‚ä½•å®šä¹‰å‘¢ï¼Ÿä½ å¯ä»¥å‚è€ƒä»¥ä¸‹æç¤ºï¼Œæ ¹æ®æˆ‘ä»¬ä¹‹å‰æ‰€è®²çš„C++ Conceptsæ¥å®ç°ä¸€ä¸‹ä½ çš„ç‰ˆæœ¬ã€‚

1.å¯ä»¥é€šè¿‡std::ranges::beginè·å–åˆ°è¯¥ç±»å‹å¯¹è±¡çš„beginè¿­ä»£å™¨ã€‚

2.å¯ä»¥é€šè¿‡std::ranges::endè·å–åˆ°è¯¥ç±»å‹å¯¹è±¡çš„endè¿­ä»£å™¨ã€‚

æ¬¢è¿è¯´å‡ºä½ çš„çœ‹æ³•ï¼Œä¸å¤§å®¶ä¸€èµ·åˆ†äº«ã€‚æˆ‘ä»¬ä¸€åŒäº¤æµã€‚ä¸‹ä¸€è®²è§ï¼
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ4ï¼‰</strong></div><ul>
<li><span>æäº‘é¾™</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>å·¥ä½œä¸­é˜²æ­¢è¶Šç•Œè®¿é—®ä¸€èˆ¬æ˜¯åœ¨è®¿é—®å‰è¿›è¡Œifæ¡ä»¶åˆ¤æ–­ï¼Œå¦‚æœæ²¡æœ‰è¶Šç•Œæ‰ä¼šè¿›è¡Œè®¿é—®æ“ä½œã€‚è€Œä¸”åœ¨ä»£ç ä¸­ä¹Ÿä¼šå¢åŠ æ•è·è¶Šç•Œè®¿é—®å¼‚å¸¸çš„ä»£ç ã€‚
ä¸‹é¢æ˜¯æˆ‘æ ¹æ®è€å¸ˆçš„æç¤ºå†™çš„ä¸€ä¸ªRangeæ¦‚å¿µï¼štemplate &lt;typename T&gt;
concept Range = requires(T container){
    {std::ranges::begin(container)};
    {std::ranges::end(container)};
};
</p>2024-01-06</li><br/><li><span>peter</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è¯·æ•™è€å¸ˆå‡ ä¸ªé—®é¢˜ï¼š
Q1ï¼šâ€œå‡è®¾ f(x,g) çš„å®šä¹‰ä¸º g(x)â€ï¼Œè¿™å¥è¯è¡¨é¢ä¸Šç†è§£æ˜¯ï¼šg(x)=f(x,g)ã€‚ä½†å¥½åƒè¯´ä¸é€šå•Šã€‚f(x,g)çš„å‚æ•°gçš„å®šä¹‰ä¸ºg(x)ï¼Œæ˜¯ä¸æ˜¯è¿™æ ·å•Šã€‚
Q2ï¼šautoæ˜¯ç”±ç¼–è¯‘å™¨æ¥è‡ªåŠ¨åˆ¤æ–­ç±»å‹å—ï¼Ÿï¼ˆç±»ä¼¼äºå¼±ç±»å‹è¯­è¨€äº†ï¼‰
Q3ï¼šè¿­ä»£å™¨ä¸åªè¯»è¿­ä»£å™¨æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿéš¾é“è¿­ä»£å™¨é™¤äº†â€œè¯»â€è¿˜å¯ä»¥â€œå†™â€å—ï¼Ÿ å¦å¤–ï¼Œé€†å‘è¿­ä»£å™¨ï¼Œæ¯”å¦‚beginï¼Œæ­£å¸¸æ˜¯ä»ç¬¬ä¸€ä¸ªå‘åé¢éå†ï¼Œé‚£â€œé€†å‘â€éš¾é“ä¼šå‘å‰éå†ï¼Ÿï¼ˆå·²ç»æ˜¯ç¬¬ä¸€ä¸ªï¼Œä¸å¯èƒ½å‘å‰éå†å•Šï¼‰
Q3ï¼šä»£ç çš„è¿è¡Œç¯å¢ƒæ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ
å¯¹äºå®ä¾‹ä»£ç ï¼Œæƒ³è¿è¡Œä¸€ä¸‹çœ‹çœ‹ï¼ŒIDEæ˜¯ä»€ä¹ˆå•Šï¼ŒåŒ…æ‹¬è®¾ç½®ç¼–è¯‘å™¨ç‰ˆæœ¬ä¸ºc++20ç­‰ã€‚
Q4ï¼šâ€œstart = std::find(getArray().begin(), getArray().end(), 1);â€è°ƒç”¨åä¸ºä»€ä¹ˆä¼šå˜æˆæ‚¬ç©ºæŒ‡é’ˆï¼Ÿèƒ½å¦å†è¯¦ç»†è¯´æ˜ä¸€ä¸‹ï¼Ÿ</p>2023-02-09</li><br/><li><span>Family mission</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>#include &lt;vector&gt;
#include &lt;algorithm&gt;
#include &lt;ranges&gt;
#include &lt;iostream&gt;
 
int main() {
    namespace ranges = std::ranges;
 
    auto getArray = [] { return std::vector{ 0, 1, 0, 1 }; };
 
    &#47;&#47; ç¼–è¯‘æˆåŠŸ
    auto start = std::find(getArray().begin(), getArray().end(), 1);
    std::cout &lt;&lt; *start &lt;&lt; std::endl;
 
    &#47;&#47; ç¼–è¯‘å¤±è´¥
    auto rangeStart = ranges::find(getArray(), 1);
    std::cout &lt;&lt; *rangeStart &lt;&lt; std::endl;
 
    return 0;
}
è¿™ä¸ªä»£ç å—ä¸­auto getArray = [] { return std::vector{ 0, 1, 0, 1 }; };ç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼Œéœ€è¦æ”¹æˆ auto getArray = [] { 
        
        return std::vector&lt;int&gt;{ 0, 1, 0, 1 };
        
    };æ‰å¯ä»¥</p>2023-12-13</li><br/><li><span>åŠªåŠ›å­¦ä¹ ä¸å‡†æ‡ˆæ€ </span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>
#include &lt;vector&gt;
#include &lt;algorithm&gt;
#include &lt;ranges&gt;
#include &lt;iostream&gt;
 
int main() {
    namespace ranges = std::ranges;
 
    &#47;&#47; é¦–å…ˆï¼Œè°ƒç”¨ranges::beginå’Œranges::endå‡½æ•°è·å–å®¹å™¨çš„è¿­ä»£å™¨
    &#47;&#47; æ¥ç€ï¼Œé€šè¿‡è¿­ä»£å™¨è®¿é—®æ•°æ®ä¸­çš„å…ƒç´ 
    std::vector&lt;int&gt; v = { 3, 1, 4, 1, 5, 9, 2, 6 };
    auto start = ranges::begin(v);
    std::cout &lt;&lt; &quot;[0]: &quot; &lt;&lt; *start &lt;&lt; std::endl;
 
    auto curr = start;
    curr++;
    std::cout &lt;&lt; &quot;[1]: &quot; &lt;&lt; *curr &lt;&lt; std::endl;
 
    std::cout &lt;&lt; &quot;[5]: &quot; &lt;&lt; *(curr + 3) &lt;&lt; std::endl;
 
    auto stop = ranges::end(v);
    std::sort(start, stop);
 
    &#47;&#47; æœ€åï¼Œè°ƒç”¨ranges::cbeginå’Œranges::cendå¾ªç¯è¾“å‡ºæ’åºåçš„æ•°æ®
    for (auto it = ranges::cbegin(v);
        it != ranges::cend(v);
        ++it
    ) {
        std::cout &lt;&lt; *it &lt;&lt; &quot; &quot;;
    }
    std::cout &lt;&lt; std::endl;
 
    return 0;
}
è¿™æ®µä»£ç ç¬¬19è¡Œåº”è¯¥æ˜¯std::cout &lt;&lt; &quot;[4]: &quot; &lt;&lt; *(curr + 3) &lt;&lt; std::endl;</p>2023-02-22</li><br/>
</ul>