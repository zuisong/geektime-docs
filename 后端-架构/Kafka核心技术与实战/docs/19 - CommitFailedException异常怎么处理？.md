ä½ å¥½ï¼Œæˆ‘æ˜¯èƒ¡å¤•ã€‚ä»Šå¤©æˆ‘æ¥è·Ÿä½ èŠèŠCommitFailedExceptionå¼‚å¸¸çš„å¤„ç†ã€‚

è¯´èµ·è¿™ä¸ªå¼‚å¸¸ï¼Œæˆ‘ç›¸ä¿¡ç”¨è¿‡Kafka Java Consumerå®¢æˆ·ç«¯APIçš„ä½ ä¸€å®šä¸ä¼šæ„Ÿåˆ°é™Œç”Ÿã€‚**æ‰€è°“CommitFailedExceptionï¼Œé¡¾åæ€ä¹‰å°±æ˜¯Consumerå®¢æˆ·ç«¯åœ¨æäº¤ä½ç§»æ—¶å‡ºç°äº†é”™è¯¯æˆ–å¼‚å¸¸ï¼Œè€Œä¸”è¿˜æ˜¯é‚£ç§ä¸å¯æ¢å¤çš„ä¸¥é‡å¼‚å¸¸**ã€‚å¦‚æœå¼‚å¸¸æ˜¯å¯æ¢å¤çš„ç¬æ—¶é”™è¯¯ï¼Œæäº¤ä½ç§»çš„APIè‡ªå·±å°±èƒ½è§„é¿å®ƒä»¬äº†ï¼Œå› ä¸ºå¾ˆå¤šæäº¤ä½ç§»çš„APIæ–¹æ³•æ˜¯æ”¯æŒè‡ªåŠ¨é”™è¯¯é‡è¯•çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨ä¸Šä¸€æœŸä¸­æåˆ°çš„**commitSyncæ–¹æ³•**ã€‚

æ¯æ¬¡å’ŒCommitFailedExceptionä¸€èµ·å‡ºç°çš„ï¼Œè¿˜æœ‰ä¸€æ®µéå¸¸è‘—åçš„æ³¨é‡Šã€‚ä¸ºä»€ä¹ˆè¯´å®ƒå¾ˆâ€œè‘—åâ€å‘¢ï¼Ÿç¬¬ä¸€ï¼Œæˆ‘æƒ³ä¸å‡ºåœ¨è¿‘50ä¸‡è¡Œçš„Kafkaæºä»£ç ä¸­ï¼Œè¿˜æœ‰å“ªä¸ªå¼‚å¸¸ç±»èƒ½æœ‰è¿™ç§å¾…é‡ï¼Œå¯ä»¥äº«æœ‰è¿™ä¹ˆå¤§æ®µçš„æ³¨é‡Šï¼Œæ¥é˜è¿°å…¶å¼‚å¸¸çš„å«ä¹‰ï¼›ç¬¬äºŒï¼Œçºµç„¶æœ‰è¿™ä¹ˆé•¿çš„æ–‡å­—è§£é‡Šï¼Œå´ä¾ç„¶æœ‰å¾ˆå¤šäººå¯¹è¯¥å¼‚å¸¸æƒ³è¡¨è¾¾çš„å«ä¹‰æ„Ÿåˆ°å›°æƒ‘ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬ä¸€èµ·é¢†ç•¥ä¸‹è¿™æ®µæ–‡å­—çš„é£é‡‡ï¼Œçœ‹çœ‹ç¤¾åŒºå¯¹è¿™ä¸ªå¼‚å¸¸çš„æœ€æ–°è§£é‡Šï¼š

> Commit cannot be completed since the group has already rebalanced and assigned the partitions to another member. This means that the time between subsequent calls to poll() was longer than the configured max.poll.interval.ms, which typically implies that the poll loop is spending too much time message processing. You can address this either by increasing max.poll.interval.ms or by reducing the maximum size of batches returned in poll() with max.poll.records.
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ30ï¼‰</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/c7/dc/9408c8c2.jpg" width="30px"><span>ban</span> ğŸ‘ï¼ˆ43ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆï¼Œ1ã€è¯·é—®Standalone Consumer çš„ç‹¬ç«‹æ¶ˆè´¹è€…ä¸€èˆ¬ä»€ä¹ˆæƒ…å†µä¼šç”¨åˆ°
2ã€Standalone Consumer çš„ç‹¬ç«‹æ¶ˆè´¹è€… ä½¿ç”¨è·Ÿæ™®é€šæ¶ˆè´¹è€…ç»„æœ‰ä»€ä¹ˆåŒºåˆ«çš„ã€‚</div>2019-07-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/47/1b/64262861.jpg" width="30px"><span>èƒ¡å°ç¦¾</span> ğŸ‘ï¼ˆ34ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>â€œå½“æ¶ˆæ¯å¤„ç†çš„æ€»æ—¶é—´è¶…è¿‡é¢„è®¾çš„ max.poll.interval.ms å‚æ•°å€¼æ—¶ï¼ŒKafka Consumer ç«¯ä¼šæŠ›å‡º CommitFailedException å¼‚å¸¸â€ã€‚


å…¶å®é€»è¾‘æ˜¯è¿™æ ·ï¼šæ¶ˆæ¯å¤„ç†çš„æ€»æ—¶é—´è¶…è¿‡é¢„è®¾çš„ max.poll.interval.ms å‚æ•°å€¼  å¯¼è‡´äº† Rebalanceâ€˜ï¼›
rebalanceå¯¼è‡´äº† partition assgined çš„consumer memberå˜äº†ï¼›
å¯¼è‡´åŸæ¥çš„consumer æƒ³è¦commitéƒ½æ²¡æ³•commit ã€‚ï¼ˆå› ä¸ºå…ƒä¿¡æ¯,æ¯”å¦‚è¿çš„brokeréƒ½å˜äº†ï¼‰.

è¯·è€å¸ˆæŒ‡æ­£ä¸‹</div>2020-05-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/47/1b/64262861.jpg" width="30px"><span>èƒ¡å°ç¦¾</span> ğŸ‘ï¼ˆ24ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>ä¸ºå•¥è‡ªåŠ¨commit ä¸ä¼šæŠ› CommitFailedExceptionï¼Ÿ</div>2020-05-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/fd/59/4416b40f.jpg" width="30px"><span>å¾·æƒ å…ˆç”Ÿ</span> ğŸ‘ï¼ˆ22ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<div>å¸Œæœ›è€å¸ˆå¯ä»¥æ›´åŠ å…·ä½“çš„è¯´è¯´ï¼Œrebalanceçš„ç»†èŠ‚ï¼Œæ¯”å¦‚æŸä¸ªconsumerå‘ç”Ÿfull gcçš„åœºæ™¯ï¼Œå®ƒçš„partitionæ˜¯æ€ä¹ˆè¢«åˆ†é…èµ°çš„ï¼Œé‡è¿ä¹‹åæäº¤ä¼šå‘ç”Ÿä»€ä¹ˆ</div>2019-07-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/c7/dc/9408c8c2.jpg" width="30px"><span>ban</span> ğŸ‘ï¼ˆ11ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>è€å¸ˆï¼Œæˆ‘æƒ³é—®ä¸‹max.poll.interval.msä¸¤è€…session.timeout.msæœ‰ä»€ä¹ˆè”ç³»ï¼Œå¯ä»¥è¯´0.10.1.0 ä¹‹å‰çš„å®¢æˆ·ç«¯ APIï¼Œç›¸å½“äºsession.timeout.msä»£æ›¿äº†max.poll.interval.mså—ï¼Ÿ
æ¯”å¦‚è¯´session.timeout.msæ˜¯5ç§’ï¼Œå¦‚æœæ¶ˆæ¯å¤„ç†è¶…è¿‡5ç§’ï¼Œä¹Ÿç®—æ˜¯è¶…æ—¶å—ï¼Ÿ</div>2019-07-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/1a/ad/faf1bf19.jpg" width="30px"><span>windcaller</span> ğŸ‘ï¼ˆ9ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>To use this mode, instead of subscribing to the topic using subscribe, you just call assign(Collection) with the full list of partitions that you want to consume.

     String topic = &quot;foo&quot;;
     TopicPartition partition0 = new TopicPartition(topic, 0);
     TopicPartition partition1 = new TopicPartition(topic, 1);
     consumer.assign(Arrays.asList(partition0, partition1));
 
Once assigned, you can call poll in a loop, just as in the preceding examples to consume records. The group that the consumer specifies is still used for committing offsets, but now the set of partitions will only change with another call to assign. Manual partition assignment does not use group coordination, so consumer failures will not cause assigned partitions to be rebalanced. Each consumer acts independently even if it shares a groupId with another consumer. To avoid offset commit conflicts, you should usually ensure that the groupId is unique for each consumer instance.

è€å¸ˆ standalone mode æ˜¯ä¸Šé¢è¿™æ®µå†…å®¹å—ï¼Ÿ</div>2019-07-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/a8/e2/f8e51df2.jpg" width="30px"><span>Li Shunduo</span> ğŸ‘ï¼ˆ9ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>å‡å¦‚brokeré›†ç¾¤æ•´ä¸ªæŒ‚æ‰äº†ï¼Œè¿‡æ®µæ—¶é—´é›†ç¾¤æ¢å¤åï¼Œconsumer groupä¼šè‡ªåŠ¨æ¢å¤æ¶ˆè´¹å—ï¼Ÿè¿˜æ˜¯éœ€è¦æ‰‹åŠ¨é‡å¯consumeræœºå™¨ï¼Ÿ</div>2019-07-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/05/db/1bd78419.jpg" width="30px"><span>æœ‰æ—¶ä¹Ÿï¼Œå‘½ä¹Ÿï¼Œè¿ä¹Ÿï¼Œå¦‚ä¹‹å¥ˆä½•ï¼Ÿ</span> ğŸ‘ï¼ˆ6ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆkafkaæ­»ä¿¡è¯¥æ€ä¹ˆå»å®ç°çš„ï¼Ÿ
2.0ä¹‹åå¢åŠ äº†å¦‚ä¸‹é…ç½®ï¼š
errors.tolerance = all
errors.deadletterqueue.topic.name = &quot;&quot;ï¼Ÿ</div>2019-07-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/1a/ad/faf1bf19.jpg" width="30px"><span>windcaller</span> ğŸ‘ï¼ˆ6ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>æˆ‘æ²¡åœ¨kafkaå®˜ç½‘ã€stackoverflow ã€google æ‰¾åˆ°ä»»ä½•å…³äº standalone kafka consumerçš„ ä¾‹å­ï¼Œè¿˜æœ›è€å¸ˆç»™ä¸ªé“¾æ¥å­¦ä¹ å­¦ä¹ </div>2019-07-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/15/d5/6d66288b.jpg" width="30px"><span>ææ</span> ğŸ‘ï¼ˆ5ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<div>è€å¸ˆæ‚¨å¥½ï¼Œè¿™è¾¹é‡åˆ°ä¸ªå¾ˆå¥‡æ€ªçš„é—®é¢˜

å¼€å¯ç¬¬ä¸€ä¸ªæ¶ˆè´¹è€…çš„æ—¶å€™ï¼Œæ­£å¸¸æ¶ˆè´¹

ä½†æ˜¯å¼€å¯å¦ä¸€ä¸ªåï¼Œè§¦å‘äº† rebalanced

è¿™æ—¶å€™ç¬¬ä¸€ä¸ªæ¶ˆè´¹è€…ä¼šæŠ¥å‡ºå¦‚ä¸‹é”™è¯¯ï¼š
The provided member is not known in the current generation

æ˜¯å› ä¸ºç¬¬ä¸€ä¸ªæ¶ˆè´¹è€…è¢«è¸¢å‡ºäº† generationï¼Œä½†æ˜¯å®ƒä¸çŸ¥é“ï¼Œè¿˜åœ¨ç»§ç»­æ¶ˆè´¹æäº¤ä½ç§»ï¼Œæˆ–è€…åšç€å…¶ä»–äº‹æƒ…ï¼Ÿè¿™ä¸ªå…¶ä»–äº‹æƒ…å¯èƒ½æ˜¯ä»€ä¹ˆï¼Ÿ

è¿˜æœ‰å°±æ˜¯ rebalanceå‘ç”Ÿçš„æ—¶å€™ï¼Œæ¶ˆè´¹è€…æ˜¯ç«‹å³æš‚åœï¼Œè¿˜æ˜¯ä¼šæ¶ˆè´¹å®Œæ•´ä¸ªpollï¼Ÿè¿™æ—¶å€™coordinatorä¼šç­‰ä»–å—ï¼Ÿè¿˜æ˜¯ç›´æ¥è¸¢å‡ºå»ï¼Ÿ
</div>2020-02-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/04/0d/3dc5683a.jpg" width="30px"><span>æŸ¯å¯Ÿé‡‘</span> ğŸ‘ï¼ˆ5ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆï¼Œæ²¡æœ‰è®¾ç½® group.id è¯ï¼Œä¼šæ€ä¹ˆæ ·ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆå”¯ä¸€çš„ä¸€ä¸ªå€¼å—</div>2019-11-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/48/f3/65c7e3ef.jpg" width="30px"><span>cricket1981</span> ğŸ‘ï¼ˆ5ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>&quot;ä¸å¹¸çš„æ˜¯ï¼Œsession.timeout.ms å‚æ•°è¿˜æœ‰å…¶ä»–çš„å«ä¹‰ï¼Œå› æ­¤å¢åŠ è¯¥å‚æ•°çš„å€¼å¯èƒ½ä¼šæœ‰å…¶ä»–æ–¹é¢çš„â€œä¸è‰¯å½±å“â€ï¼Œè¿™ä¹Ÿæ˜¯ç¤¾åŒºåœ¨ 0.10.1.0 ç‰ˆæœ¬å¼•å…¥ max.poll.interval.ms å‚æ•°ï¼Œå°†è¿™éƒ¨åˆ†å«ä¹‰ä» session.timeout.ms ä¸­å‰¥ç¦»å‡ºæ¥çš„åŸå› ä¹‹ä¸€ã€‚&quot;---&gt;èƒ½ç»†è¿°ä¸€ä¸‹ä¸è‰¯å½±å“å—ï¼Ÿ</div>2019-07-16</li><br/><li><img src="" width="30px"><span>crud~boy</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>è€å¸ˆpollä¸€æ‰¹æ¶ˆæ¯ï¼Œå¤šçº¿ç¨‹å¤„ç†å¹¶ä¸”æ˜¯æ‰‹åŠ¨å¤„ç†ï¼Œä¼šä¸ä¼šæ¯ä¸ªçº¿ç¨‹é€Ÿåº¦ä¸ä¸€è‡´ï¼Œä¼šå¯¼è‡´æäº¤ä½ç§»æ—¶ï¼Œoffsetå°å¾—åæäº¤ï¼Œä¼šæœ‰ä»€ä¹ˆå½±å“å—</div>2020-08-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/d5/7b/c512da6a.jpg" width="30px"><span>çŸ³æ –</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<div>å…³äºè¿™ä¸ªé”™è¯¯ï¼Œæˆ‘è¿™è¾¹å¾ˆå¥‡æ€ªï¼Œconsumerç”¨çš„æ˜¯è‡ªåŠ¨æäº¤çš„é…ç½®ï¼Œä½†æ˜¯ä¹Ÿå‡ºç°äº†è¿™ä¸ªé”™è¯¯ã€‚çœ‹é”™è¯¯åº”è¯¥æ˜¯broker-2æŒ‚æ‰äº†ï¼Œç„¶årediscoveryã€‚ä½†æ˜¯åé¢æ—¥å¿—åˆè¯´The coordinator is not aware of this member.å†åé¢å°±æ˜¯Commit cannot be completed çš„é”™è¯¯äº†ã€‚æˆ‘è¿™é‡Œæ˜¯æœ‰å¤šä¸ªbrokerï¼Œç„¶åé‡‡ç”¨çš„åŸŸåçš„æ–¹å¼ï¼Œipå¯èƒ½ä¼šå˜ã€‚è€å¸ˆé€šè¿‡è¿™äº›æ—¥å¿—ï¼Œèƒ½ç»™ç‚¹å»ºè®®å—ï¼Ÿ
é”™è¯¯æ—¥å¿—ï¼š
2020-05-04 18:49:56.592  INFO 6 --- [ntainer#0-0-C-1] o.a.k.c.c.internals.AbstractCoordinator  : [Consumer clientId=consumer-2, groupId=test-group] Discovered group coordinator broker-2-lhfm0slmx1v4nyfz.kafka.svc01.local:9093 (id: 2147483645 rack: null)
2020-05-04 18:49:56.592  INFO 6 --- [ntainer#0-0-C-1] o.a.k.c.c.internals.AbstractCoordinator  : [Consumer clientId=consumer-2, groupId=test-group] Group coordinator broker-2-lhfm0slmx1v4nyfz.kafka.svc01.local:9093 (id: 2147483645 rack: null) is unavailable or invalid, will attempt rediscovery
2020-05-04 18:49:56.694  INFO 6 --- [ntainer#0-0-C-1] o.a.k.c.c.internals.AbstractCoordinator  : [Consumer clientId=consumer-2, groupId=test-group] Discovered group coordinator broker-2-lhfm0slmx1v4nyfz.kafka.svc01.local:9093 (id: 2147483645 rack: null)
2020-05-04 18:49:56.735 ERROR 6 --- [ntainer#0-0-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-2, groupId=test-group] Offset commit failed on partition test.topic-0 at offset 0: The coordinator is not aware of this member.
2020-05-04 18:49:56.735  WARN 6 --- [ntainer#0-0-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-2, groupId=test-group] Asynchronous auto-commit of offsets {test.topic-0=OffsetAndMetadata{offset=0, metadata=&#39;&#39;}} failed: Commit cannot be completed since the group has already rebalanced and assigned the partitions to another member. This means that the time between subsequent calls to poll() was longer than the configured max.poll.interval.ms, which typically implies that the poll loop is spending too much time message processing. You can address this either by increasing the session timeout or by reducing the maximum size of batches returned in poll() with max.poll.records.</div>2020-05-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/0c/c2/bad34a50.jpg" width="30px"><span>å¼ æ´‹</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆæœ‰ä¸¤ä¸ªç–‘é—®ï¼š

1.ç›¸åŒçš„GroupIdçš„Consumer ä¸åº”è¯¥å°±æ˜¯åŒä¸€ä¸ªConsumer Group ç»„ä¸‹çš„å—ï¼Œæˆ–è€…æœ‰å…¶ä»–çš„åŒºåˆ†æ¡ä»¶ï¼Œæ¯”å¦‚è®¢é˜…çš„Topicä¸åŒï¼Ÿ

2.å¦‚æœè¿™ä¸ªstandalone Consumer å†ç»™ä»–æ·»åŠ ä¸€ä¸ªåŒç»„çš„standalone Conusmerï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</div>2019-11-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>å¥½åƒåªè¯´äº†å¦‚ä½•é¿å…å‡ºç°å¼‚å¸¸ï¼Œä½†æ˜¯å¼‚å¸¸å‡ºç°äº†æ€ä¹ˆå¤„ç†å‘¢ï¼Œæœ‰ç±»ä¼¼å›æ»šä»€ä¹ˆçš„å—ï¼Ÿä¼šé‡å¤æ¶ˆè´¹å—ï¼Ÿ</div>2021-08-01</li><br/><li><img src="" width="30px"><span>æ¾é¼ é±¼</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>è€å¸ˆï¼Œæˆ‘çš„ç¨‹åºä½¿ç”¨çš„æ˜¯è‡ªåŠ¨æäº¤offsetï¼Œå…¶ä»–intervalç­‰ç›¸å…³å‚æ•°ï¼ˆmax poll, session timeoutç­‰ï¼‰éƒ½æ˜¯é»˜è®¤çš„ã€‚æ¶ˆæ¯æ¶ˆè´¹çš„é€Ÿåº¦ä¹Ÿç®—å¿«ï¼Œ500æ¡åº”è¯¥å°±æ˜¯ä¸€ç§’çš„äº‹å„¿ã€‚å¯æ˜¯è¿™æ ·ä¹Ÿè¿˜æ˜¯å¶å°”ä¼šå‘ç”ŸOffset commit failedå¼‚å¸¸ï¼Œé€šå¸¸æ˜¯åœ¨ç¨‹åºè·‘äº†ä¸€é˜µä¹‹åï¼Œè¯·é—®æ‚¨æœ‰æ²¡æœ‰é‡åˆ°è¿‡ç±»ä¼¼çš„æƒ…å†µï¼Ÿè¿™æ˜¯ä¸æ˜¯å’Œå•ä¸€ä¸€ä¸ªconsumeråŒæ—¶æ¶ˆè´¹å¤šä¸ªpartitionæœ‰å…³ï¼Ÿ</div>2020-06-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/52/d8/123a4981.jpg" width="30px"><span>ç»¿ç®­ä¾ </span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>åœºæ™¯äºŒï¼Œä¸ºä»€ä¹ˆåªå¼ºè°ƒstandalone å’Œ groupä¹‹é—´å¯èƒ½ä¼šå‘ç”Ÿgroupidç›¸åŒï¼Œé‚£groupä¹‹é—´ç›¸åŒæ€ä¹ˆæ ·å‘¢ï¼Ÿ æ˜¯ä¸æ˜¯ä¼šåœ¨coordinatoræ³¨å†Œgroupæ—¶å°±èƒ½å‘ç°ç»„ä¹‹é—´é‡å¤äº†groupid ?!!!</div>2021-07-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/8b/4b/15ab499a.jpg" width="30px"><span>é£è½»æ‰¬</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>
è€å¸ˆã€‚åœ¨å­¦ä¹ è¿™ä¸€ç« çš„æ—¶å€™ã€‚ä»Šå¤©æ­£å¥½ç¢°åˆ°ä¸€ä¸ªcommitFailedExceptionçš„é—®é¢˜ã€‚kafkaæ˜¯windowsç‰ˆæœ¬ï¼Œ0.10.0.0ã€‚kafkaçš„æŒä¹…åŒ–ç›®å½•ç”¨çš„å°±æ˜¯é»˜è®¤çš„&#47;tmpç›®å½•ã€‚ç”¨Ideaå¼€å‘é¡¹ç›®æ—¶ï¼Œä¼šç»å¸¸å¯åœè¯¥kafkaã€‚ä»Šå¤©æˆ‘å¯åŠ¨äº†ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ç«‹é©¬å°±æŠ¥å‡ºäº†commitFailedExceptionå¼‚å¸¸ã€‚æç¤ºçš„å°±æ˜¯poll loopçš„å¤„ç†æ—¶é—´è¿‡é•¿ï¼Œæç¤ºæˆ‘ä¿®æ”¹session.timeout.msçš„å€¼ã€‚
æˆ‘çš„ç–‘é—®ç‚¹ï¼šæˆ‘åœæ­¢äº†æ¶ˆè´¹è€…ç¨‹åºï¼Œæ­¤æ—¶å°±ä¼šå‘ç”Ÿreblanceã€‚ç„¶åï¼Œæˆ‘åˆå¯åŠ¨æ¶ˆè´¹è€…ã€‚æ­¤æ—¶å†æ¬¡å‘ç”Ÿreblanceã€‚åº”è¯¥æ˜¯é‡æ–°è¿›è¡Œåˆ†åŒºåˆ†é…ï¼Œä¸åº”è¯¥æŠ¥å‡ºè¿™ä¸ªé”™è¯¯å•Šã€‚æˆ‘è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œè¿™ä¸ªé”™è¯¯å‘ç”Ÿçš„æ ¹æœ¬åŸå› æ˜¯ä»€ä¹ˆï¼Ÿæœ›è€å¸ˆè§£æƒ‘ (æˆ‘æœ€åçš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼šæŠŠtmpç›®å½•å…¨éƒ¨åˆ é™¤ï¼Œç„¶åå†å¯åŠ¨æ¶ˆè´¹è€…å°±å¯ä»¥äº†ã€‚)

æå®¢æ²¡æœ‰è¿½è¯„çš„åŠŸèƒ½ã€‚åªèƒ½å†é‡å¤ä¸€éé—®é¢˜ã€‚è€å¸ˆï¼Œæˆ‘æ˜¯è‡ªåŠ¨æäº¤ï¼Œä»€ä¹ˆåŸå› ä¼šå‡ºç°ä»¥ä¸Šçš„åœºæ™¯å‘¢ï¼Ÿå¿˜äº†è¡¥å……ä¸€å¥ï¼Œæˆ‘ç”¨çš„æ˜¯ï¼šspringbootï¼Œå¼•å…¥çš„æ˜¯springbootæ•´åˆkafka çš„ä¾èµ–</div>2020-05-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/b5/89/9a1b4dee.jpg" width="30px"><span>è›‹ç‚’ç•ªèŒ„</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ4ï¼‰<div> Synchronous auto-commit of offsets {=OffsetAndMetadata{offset=6236, leaderEpoch=null, metadata=&#39;&#39;}} failed: Commit cannot be completed since the group has already rebalanced and assigned the partitions to another member. This means that the time between subsequent calls to poll() was longer than the configured max.poll.interval.ms, which typically implies that the poll loop is spending too much time message processing. You can address this either by increasing max.poll.interval.ms or by reducing the maximum size of batches returned in poll() with max.poll.records.
æˆ‘ä»¬è¿™è¾¹æœ‰å‡ ä¸ªé¡¹ç›®ï¼Œå½“ç”¨åŸç”Ÿçš„kafkaå®¢æˆ·ç«¯ç»å¸¸å‡ºç°è¿™ä¸ªæŠ¥é”™ï¼Œmax.poll.interval.msæ˜¯é»˜è®¤å€¼300000ï¼Œmax.poll.records.æ˜¯2000ï¼Œä½†æ˜¯å®é™…ä¸Šæ•°æ®å¾ˆå°‘ï¼Œæ¯æ¡æ•°æ®å¤„ç†çš„æ—¶é—´ä¹Ÿå¾ˆçŸ­ã€‚heartbeat.interval.msæ˜¯2000ï¼Œsession.timeout.msæ˜¯12000ã€‚ä¸ºä»€ä¹ˆç»å¸¸å‡ºç°è¿™ä¸ªé”™è¯¯ã€‚
é‡ç‚¹æ˜¯ï¼Œå¦å¤–å‡ ä¸ªé¡¹ç›®ç”¨çš„æ˜¯spring-kafkaå´é‡æ¥æ²¡æœ‰å‡ºç°è¿‡è¿™æ ·çš„æŠ¥é”™ï¼Œç›¸å…³é…ç½®å·®ä¸å¤šï¼Œä¸šåŠ¡åœºæ™¯å·®ä¸å¤šã€‚æ±‚æŒ‡ç‚¹ï¼Ÿæ€ä¹ˆæ ·é¿å…è¿™æ ·çš„é—®é¢˜</div>2019-09-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/a5/56/d6732e61.jpg" width="30px"><span>å°åˆ€</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>èƒ¡è€å¸ˆï¼Œæ‰‹åŠ¨æäº¤æ—¶ï¼Œå½“å‰åä¸¤æ¬¡pollæ—¶é—´è¶…è¿‡æœŸæœ›çš„max.poll.interval.msæ—¶ï¼Œä¼šè§¦å‘Rebalanceã€‚ é‚£ä¹ˆå‡å¦‚æ˜¯è‡ªåŠ¨æäº¤æ—¶ï¼Œä¼šè§¦å‘Rebalanceå—ï¼Ÿ
å‡å¦‚ï¼Œæ‰‹åŠ¨æäº¤åœºæ™¯ï¼Œconsumeræ¶ˆè´¹ç«¯å¤„ç†ä¸šåŠ¡æ—¶é—´è¿‡é•¿ï¼ˆç‰¹æ®Šcaseå¯¼è‡´çš„ï¼‰ï¼Œå‘ç”Ÿäº†Rebalanceï¼Œé‚£ä¹ˆè¯¥consumerå®ä¾‹è¢«è¸¢å‡ºäº†ï¼Œé‚£ä¹ˆå®ƒæ°¸è¿œâ€˜æ­»æ‰â€™äº†å—ï¼Œè¿˜æ˜¯ä¼šå†æ¬¡é€šè¿‡heartbeatæ£€æµ‹è®©å®ƒå¤æ´»ï¼Ÿ</div>2019-07-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/20/08/bc06bc69.jpg" width="30px"><span>Dovelol</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ4ï¼‰<div>è€å¸ˆå¥½ï¼Œæˆ‘ä¸Šä¸€ä¸ªé—®é¢˜çš„å…·ä½“æè¿°æ˜¯è¿™æ ·çš„ï¼Œä»Šå¤©è®²CommitFailedExceptionçš„ä¾‹å­æ˜¯è°ƒç”¨consumer.commitSync();æ‰‹åŠ¨æäº¤offsetï¼Œç¡®å®å½“æ¶ˆæ¯å¤„ç†çš„æ€»æ—¶é—´è¶…è¿‡é¢„è®¾çš„max.poll.interval.msæ—¶ä¼šæŠ¥è¿™ä¸ªå¼‚å¸¸ï¼Œä½†æ˜¯å¦‚æœæ˜¯è‡ªåŠ¨æäº¤offsetçš„æƒ…å†µä¸‹ï¼Œä¹Ÿå°±æ˜¯æŠŠenable.auto.commit=trueï¼Œç„¶ååˆ é™¤consumer.commitSync();ä»£ç ï¼Œå…¶å®ƒä»£ç ä¸å˜ï¼Œä¹Ÿæ˜¯max.poll.interval.ms=5sï¼Œç„¶åå¾ªç¯ä¸­sleep(6s)ï¼Œå‘ç°ä¸ä¼šæŠ¥å¼‚å¸¸å¹¶ä¸”ä¼šä¸€ç›´é‡å¤æ¶ˆè´¹ï¼Œæƒ³é—®ä¸‹è¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ</div>2019-07-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d5/68/2201b6b9.jpg" width="30px"><span>å½’é›¶</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆï¼Œåœºæ™¯äºŒå‡ºç°çš„åŸå› æ˜¯å¦‚æœä½ çš„åº”ç”¨ä¸­åŒæ—¶å‡ºç°äº†è®¾ç½®ç›¸åŒ group.id å€¼çš„ã€æ¶ˆè´¹è€…ç»„ç¨‹åºã€‘å’Œã€ç‹¬ç«‹æ¶ˆè´¹è€…ç¨‹åºã€‘ï¼Œè¿˜æ˜¯è¯´åªè¦å‡ºç°äº†è®¾ç½®ç›¸åŒçš„group.idå°±ä¼šå‡ºç°å‘¢ï¼Ÿ</div>2021-01-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/71/f6/5bcefe24.jpg" width="30px"><span>å¾å®</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>æˆ‘åœ¨ spark-sql-kafka-0-10_2.11-2.4.0-cdh6.2.0 çœ‹åˆ°å¦‚ä¸‹ä»£ç ï¼š
  private def strategy(caseInsensitiveParams: Map[String, String]) =
      caseInsensitiveParams.find(x =&gt; STRATEGY_OPTION_KEYS.contains(x._1)).get match {
    case (&quot;assign&quot;, value) =&gt;
      AssignStrategy(JsonUtils.partitions(value))
    case (&quot;subscribe&quot;, value) =&gt;
      SubscribeStrategy(value.split(&quot;,&quot;).map(_.trim()).filter(_.nonEmpty))
    case (&quot;subscribepattern&quot;, value) =&gt;
      SubscribePatternStrategy(value.trim())
    case _ =&gt;
      &#47;&#47; Should never reach here as we are already matching on
      &#47;&#47; matched strategy names
      throw new IllegalArgumentException(&quot;Unknown option&quot;)
  }
æ˜¯ä¸æ˜¯è¯´ï¼ŒSpark ä¸­çš„kafkaDataSource å®ç°æ˜¯æ¥è‡ªäºè°ƒç”¨çš„ option å‚æ•°å‘¢ï¼Ÿ</div>2020-07-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/8b/4b/15ab499a.jpg" width="30px"><span>é£è½»æ‰¬</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆã€‚åœ¨å­¦ä¹ è¿™ä¸€ç« çš„æ—¶å€™ã€‚ä»Šå¤©æ­£å¥½ç¢°åˆ°ä¸€ä¸ªcommitFailedExceptionçš„é—®é¢˜ã€‚kafkaæ˜¯windowsç‰ˆæœ¬ï¼Œ0.10.0.0ã€‚kafkaçš„æŒä¹…åŒ–ç›®å½•ç”¨çš„å°±æ˜¯é»˜è®¤çš„&#47;tmpç›®å½•ã€‚ç”¨Ideaå¼€å‘é¡¹ç›®æ—¶ï¼Œä¼šç»å¸¸å¯åœè¯¥kafkaã€‚ä»Šå¤©æˆ‘å¯åŠ¨äº†ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ç«‹é©¬å°±æŠ¥å‡ºäº†commitFailedExceptionå¼‚å¸¸ã€‚æç¤ºçš„å°±æ˜¯poll loopçš„å¤„ç†æ—¶é—´è¿‡é•¿ï¼Œæç¤ºæˆ‘ä¿®æ”¹session.timeout.msçš„å€¼ã€‚
æˆ‘çš„ç–‘é—®ç‚¹ï¼šæˆ‘åœæ­¢äº†æ¶ˆè´¹è€…ç¨‹åºï¼Œæ­¤æ—¶å°±ä¼šå‘ç”Ÿreblanceã€‚ç„¶åï¼Œæˆ‘åˆå¯åŠ¨æ¶ˆè´¹è€…ã€‚æ­¤æ—¶å†æ¬¡å‘ç”Ÿreblanceã€‚åº”è¯¥æ˜¯é‡æ–°è¿›è¡Œåˆ†åŒºåˆ†é…ï¼Œä¸åº”è¯¥æŠ¥å‡ºè¿™ä¸ªé”™è¯¯å•Šã€‚æˆ‘è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œè¿™ä¸ªé”™è¯¯å‘ç”Ÿçš„æ ¹æœ¬åŸå› æ˜¯ä»€ä¹ˆï¼Ÿæœ›è€å¸ˆè§£æƒ‘    (æˆ‘æœ€åçš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼šæŠŠtmpç›®å½•å…¨éƒ¨åˆ é™¤ï¼Œç„¶åå†å¯åŠ¨æ¶ˆè´¹è€…å°±å¯ä»¥äº†ã€‚)</div>2020-05-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/a7/e4/5a4515e9.jpg" width="30px"><span>æˆç«‹-Charlie</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>è€å¸ˆå¯¹äºå¤šçº¿ç¨‹æ¶ˆè´¹çš„åœºæ™¯ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºå‘¢ã€‚</div>2020-03-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/40/5e/b8fada94.jpg" width="30px"><span>Ryoma</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š
1ï¼šè¯·é—®æ¶ˆè´¹è€…æ˜¯ä¸æ˜¯åªæœ‰ï¼šConsumer Group åŠ Standalone Consumer ä¸¤ç±»ï¼Ÿ
2ï¼šæˆ‘åœ¨ Node ä¸­ï¼Œä½¿ç”¨ç‹¬ç«‹æ¶ˆè´¹è€…é…ç½®ç›¸åŒçš„ groupIdï¼Œå¯åŠ¨äº†ä¸¤ä¸ªå®ä¾‹ã€‚ä½¿ç”¨ç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯æ—¶ï¼Œä¸¤ä¸ªæ¶ˆè´¹è€…å®ä¾‹éƒ½å¯ä»¥æ­£å¸¸å¤„ç†ï¼Œè·Ÿè€å¸ˆä¸Šé¢è¯´çš„æœ‰ç‚¹ä¸å¤ªä¸€æ ·å‘€ï¼Ÿè¿™ä¸ªæ˜¯ç”±äºå®¢æˆ·ç«¯çš„ä¸åŒå¯¼è‡´çš„ä¹ˆï¼Ÿ</div>2020-02-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/df/e5/65e37812.jpg" width="30px"><span>å¿«è·‘</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆä½ å¥½ï¼Œæˆ‘åœ¨ä½¿ç”¨spark streamingæ¶ˆè´¹kafkaæ¶ˆæ¯ä¼šé‡åˆ°æŸä¸ªbatchæ¶ˆè´¹è€—æ—¶é•¿ã€‚è¯·è€å¸ˆå¸®å¿™åˆ†æä¸€ä¸‹è¿™ä¸ªæ˜¯ä»€ä¹ˆåŸå› ï¼Œåº”è¯¥æ€ä¹ˆå»ä¼˜åŒ–ã€‚è°¢è°¢è€å¸ˆã€‚æ—¥å¿—å¤§ä½“å¦‚ä¸‹ï¼š
20&#47;02&#47;06 21:13:18 INFO KafkaRDD: Computing topic test_topic, partition 0 offsets 470985316 -&gt; 470988502
20&#47;02&#47;06 21:13:18 DEBUG NetworkClient: Disconnecting from node 1 due to request timeout.
20&#47;02&#47;06 21:13:18 DEBUG ConsumerNetworkClient: Cancelled FETCH request ClientRequest(expectResponse=true, callback=org.apache.kafka.clients.consumer.internals.ConsumerNetworkClient$RequestFutureCompletionHandler@bf99562, request=RequestSend(header={api_key=1,api_version=2,correlation_id=32,client_id=consumer-2}, body={replica_id=-1,max_wait_time=3000,min_bytes=1,topics=[{topic=test_topic,partitions=[{partition=0,fetch_offset=470986525,max_bytes=10485760}]}]}), createdTimeMs=1580994741183, sendTimeMs=1580994741183) with correlation id 32 due to node 1 being disconnected
20&#47;02&#47;06 21:13:18 DEBUG Fetcher: Fetch failed
org.apache.kafka.common.errors.DisconnectException
20&#47;02&#47;06 21:13:18 DEBUG NetworkClient: Initialize connection to node 2 for sending metadata request
20&#47;02&#47;06 21:13:18 DEBUG NetworkClient: Initiating connection to node 2 at host1:9092.</div>2020-02-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/3d/03/b2d9a084.jpg" width="30px"><span>Hale</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>2019-12-23 16:43:56,367 consumer.py[line:792] WARNING Auto offset commit failed for group aff74e1e254e11ea9f47b827eb16d0ae: NodeNotReadyError: coordinator-1
2019-12-23 16:43:56,471 client_async.py[line:695] WARNING &lt;BrokerConnection node_id=coordinator-1 host=39.104.137.50:9093 &lt;connected&gt; [IPv4 (&#39;39.104.137.50&#39;, 9093)]&gt; timed out after 305000 ms. Closing connection.
2019-12-23 16:43:56,473 client_async.py[line:327] WARNING Node coordinator-1 connection failed -- refreshing metadata
2019-12-23 16:43:56,478 base.py[line:493] ERROR Error sending HeartbeatRequest_v1 to node coordinator-1 [[Error 7] RequestTimedOutError: Request timed out after 305000 ms]
2019-12-23 16:43:56,479 base.py[line:714] WARNING Marking the coordinator dead (node coordinator-1) for group aff74e1e254e11ea9f47b827eb16d0ae: [Error 7] RequestTimedOutError: Request timed out after 305000 ms.
å‡ºç°ä¸Šé¢çš„æŠ¥é”™consumerå°±å¡ä¸»äº†ï¼Œä¸èƒ½æ¥æ”¶æ•°æ®äº†ï¼Œæ˜¯æäº¤å¤±è´¥å§</div>2019-12-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/5f/b2/c4780c10.jpg" width="30px"><span>æ›¹ä¼Ÿé›„</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆï¼Œè¯·æ•™2ä¸ªé—®é¢˜ï¼Œè°¢è°¢!
æˆ‘æƒ³é—®ä¸‹0.10.1.0ä¹‹åçš„session.timeout.msè¿˜æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ
standalone consumerå’Œgroup consumeråœ¨é…ç½®ä¸Šå¦‚ä½•åŒºåˆ†?</div>2019-07-19</li><br/>
</ul>