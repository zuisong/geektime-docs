ä¸Šä¸€èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†Springæ¡†æ¶èƒŒåè•´è—çš„ä¸€äº›ç»å…¸è®¾è®¡æ€æƒ³ï¼Œæ¯”å¦‚çº¦å®šä¼˜äºé…ç½®ã€ä½ä¾µå…¥æ¾è€¦åˆã€æ¨¡å—åŒ–è½»é‡çº§ç­‰ç­‰ã€‚æˆ‘ä»¬å¯ä»¥å°†è¿™äº›è®¾è®¡æ€æƒ³å€Ÿé‰´åˆ°å…¶ä»–æ¡†æ¶å¼€å‘ä¸­ï¼Œåœ¨å¤§çš„è®¾è®¡å±‚é¢æé«˜æ¡†æ¶çš„ä»£ç è´¨é‡ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨ä¸“æ ä¸­è®²è§£è¿™éƒ¨åˆ†å†…å®¹çš„åŸå› ã€‚

é™¤äº†ä¸Šä¸€èŠ‚è¯¾ä¸­è®²åˆ°çš„è®¾è®¡æ€æƒ³ï¼Œå®é™…ä¸Šï¼Œå¯æ‰©å±•ä¹Ÿæ˜¯å¤§éƒ¨åˆ†æ¡†æ¶åº”è¯¥å…·å¤‡çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ã€‚æ‰€è°“çš„æ¡†æ¶å¯æ‰©å±•ï¼Œæˆ‘ä»¬ä¹‹å‰ä¹Ÿæåˆ°è¿‡ï¼Œæ„æ€å°±æ˜¯ï¼Œæ¡†æ¶ä½¿ç”¨è€…åœ¨ä¸ä¿®æ”¹æ¡†æ¶æºç çš„æƒ…å†µä¸‹ï¼ŒåŸºäºæ‰©å±•ç‚¹å®šåˆ¶æ‰©å±•æ–°çš„åŠŸèƒ½ã€‚

å‰é¢åœ¨ç†è®ºéƒ¨åˆ†ï¼Œæˆ‘ä»¬ä¹Ÿè®²åˆ°ï¼Œå¸¸ç”¨æ¥å®ç°æ‰©å±•ç‰¹æ€§çš„è®¾è®¡æ¨¡å¼æœ‰ï¼šè§‚å¯Ÿè€…æ¨¡å¼ã€æ¨¡æ¿æ¨¡å¼ã€èŒè´£é“¾æ¨¡å¼ã€ç­–ç•¥æ¨¡å¼ç­‰ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å†å‰–æSpringæ¡†æ¶ä¸ºäº†æ”¯æŒå¯æ‰©å±•ç‰¹æ€§ç”¨çš„2ç§è®¾è®¡æ¨¡å¼ï¼šè§‚å¯Ÿè€…æ¨¡å¼å’Œæ¨¡æ¿æ¨¡å¼ã€‚

è¯ä¸å¤šè¯´ï¼Œè®©æˆ‘ä»¬æ­£å¼å¼€å§‹ä»Šå¤©çš„å­¦ä¹ å§ï¼

## è§‚å¯Ÿè€…æ¨¡å¼åœ¨Springä¸­çš„åº”ç”¨

åœ¨å‰é¢æˆ‘ä»¬è®²åˆ°ï¼ŒJavaã€Google Guavaéƒ½æä¾›äº†è§‚å¯Ÿè€…æ¨¡å¼çš„å®ç°æ¡†æ¶ã€‚Javaæä¾›çš„æ¡†æ¶æ¯”è¾ƒç®€å•ï¼ŒåªåŒ…å«java.util.Observableå’Œjava.util.Observerä¸¤ä¸ªç±»ã€‚Google Guavaæä¾›çš„æ¡†æ¶åŠŸèƒ½æ¯”è¾ƒå®Œå–„å’Œå¼ºå¤§ï¼šé€šè¿‡EventBusäº‹ä»¶æ€»çº¿æ¥å®ç°è§‚å¯Ÿè€…æ¨¡å¼ã€‚å®é™…ä¸Šï¼ŒSpringä¹Ÿæä¾›äº†è§‚å¯Ÿè€…æ¨¡å¼çš„å®ç°æ¡†æ¶ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±å†æ¥è®²ä¸€è®²å®ƒã€‚

Springä¸­å®ç°çš„è§‚å¯Ÿè€…æ¨¡å¼åŒ…å«ä¸‰éƒ¨åˆ†ï¼šEventäº‹ä»¶ï¼ˆç›¸å½“äºæ¶ˆæ¯ï¼‰ã€Listenerç›‘å¬è€…ï¼ˆç›¸å½“äºè§‚å¯Ÿè€…ï¼‰ã€Publisherå‘é€è€…ï¼ˆç›¸å½“äºè¢«è§‚å¯Ÿè€…ï¼‰ã€‚æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥çœ‹ä¸‹ï¼ŒSpringæä¾›çš„è§‚å¯Ÿè€…æ¨¡å¼æ˜¯æ€ä¹ˆä½¿ç”¨çš„ã€‚ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

```
// Eventäº‹ä»¶
public class DemoEvent extends ApplicationEvent {
  private String message;

  public DemoEvent(Object source, String message) {
    super(source);
  }

  public String getMessage() {
    return this.message;
  }
}

// Listenerç›‘å¬è€…
@Component
public class DemoListener implements ApplicationListener<DemoEvent> {
  @Override
  public void onApplicationEvent(DemoEvent demoEvent) {
    String message = demoEvent.getMessage();
    System.out.println(message);
  }
}

// Publisherå‘é€è€…
@Component
public class DemoPublisher {
  @Autowired
  private ApplicationContext applicationContext;

  public void publishEvent(DemoEvent demoEvent) {
    this.applicationContext.publishEvent(demoEvent);
  }
}
```

ä»ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæ¡†æ¶ä½¿ç”¨èµ·æ¥å¹¶ä¸å¤æ‚ï¼Œä¸»è¦åŒ…å«ä¸‰éƒ¨åˆ†å·¥ä½œï¼šå®šä¹‰ä¸€ä¸ªç»§æ‰¿ApplicationEventçš„äº‹ä»¶ï¼ˆDemoEventï¼‰ï¼›å®šä¹‰ä¸€ä¸ªå®ç°äº†ApplicationListenerçš„ç›‘å¬å™¨ï¼ˆDemoListenerï¼‰ï¼›å®šä¹‰ä¸€ä¸ªå‘é€è€…ï¼ˆDemoPublisherï¼‰ï¼Œå‘é€è€…è°ƒç”¨ApplicationContextæ¥å‘é€äº‹ä»¶æ¶ˆæ¯ã€‚

å…¶ä¸­ï¼ŒApplicationEventå’ŒApplicationListenerçš„ä»£ç å®ç°éƒ½éå¸¸ç®€å•ï¼Œå†…éƒ¨å¹¶ä¸åŒ…å«å¤ªå¤šå±æ€§å’Œæ–¹æ³•ã€‚å®é™…ä¸Šï¼Œå®ƒä»¬æœ€å¤§çš„ä½œç”¨æ˜¯åšç±»å‹æ ‡è¯†ä¹‹ç”¨ï¼ˆç»§æ‰¿è‡ªApplicationEventçš„ç±»æ˜¯äº‹ä»¶ï¼Œå®ç°ApplicationListenerçš„ç±»æ˜¯ç›‘å¬å™¨ï¼‰ã€‚

```
public abstract class ApplicationEvent extends EventObject {
  private static final long serialVersionUID = 7099057708183571937L;
  private final long timestamp = System.currentTimeMillis();

  public ApplicationEvent(Object source) {
    super(source);
  }

  public final long getTimestamp() {
    return this.timestamp;
  }
}

public class EventObject implements java.io.Serializable {
    private static final long serialVersionUID = 5516075349620653480L;
    protected transient Object  source;

    public EventObject(Object source) {
        if (source == null)
            throw new IllegalArgumentException("null source");
        this.source = source;
    }

    public Object getSource() {
        return source;
    }

    public String toString() {
        return getClass().getName() + "[source=" + source + "]";
    }
}

public interface ApplicationListener<E extends ApplicationEvent> extends EventListener {
  void onApplicationEvent(E var1);
}
```

åœ¨å‰é¢è®²åˆ°è§‚å¯Ÿè€…æ¨¡å¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬æåˆ°ï¼Œè§‚å¯Ÿè€…éœ€è¦äº‹å…ˆæ³¨å†Œåˆ°è¢«è§‚å¯Ÿè€…ï¼ˆJDKçš„å®ç°æ–¹å¼ï¼‰æˆ–è€…äº‹ä»¶æ€»çº¿ï¼ˆEventBusçš„å®ç°æ–¹å¼ï¼‰ä¸­ã€‚é‚£åœ¨Springçš„å®ç°ä¸­ï¼Œè§‚å¯Ÿè€…æ³¨å†Œåˆ°äº†å“ªé‡Œå‘¢ï¼Ÿåˆæ˜¯å¦‚ä½•æ³¨å†Œçš„å‘¢ï¼Ÿ

æˆ‘æƒ³ä½ åº”è¯¥çŒœåˆ°äº†ï¼Œæˆ‘ä»¬æŠŠè§‚å¯Ÿè€…æ³¨å†Œåˆ°äº†ApplicationContextå¯¹è±¡ä¸­ã€‚è¿™é‡Œçš„ApplicationContextå°±ç›¸å½“äºGoogle EventBusæ¡†æ¶ä¸­çš„â€œäº‹ä»¶æ€»çº¿â€ã€‚ä¸è¿‡ï¼Œç¨å¾®æé†’ä¸€ä¸‹ï¼ŒApplicationContextè¿™ä¸ªç±»å¹¶ä¸åªæ˜¯ä¸ºè§‚å¯Ÿè€…æ¨¡å¼æœåŠ¡çš„ã€‚å®ƒåº•å±‚ä¾èµ–BeanFactoryï¼ˆIOCçš„ä¸»è¦å®ç°ç±»ï¼‰ï¼Œæä¾›åº”ç”¨å¯åŠ¨ã€è¿è¡Œæ—¶çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ˜¯è®¿é—®è¿™äº›ä¿¡æ¯çš„æœ€é¡¶å±‚æ¥å£ã€‚

å®é™…ä¸Šï¼Œå…·ä½“åˆ°æºç æ¥è¯´ï¼ŒApplicationContextåªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå…·ä½“çš„ä»£ç å®ç°åŒ…å«åœ¨å®ƒçš„å®ç°ç±»AbstractApplicationContextä¸­ã€‚æˆ‘æŠŠè·Ÿè§‚å¯Ÿè€…æ¨¡å¼ç›¸å…³çš„ä»£ç ï¼Œæ‘˜æŠ„åˆ°äº†ä¸‹é¢ã€‚ä½ åªéœ€è¦å…³æ³¨å®ƒæ˜¯å¦‚ä½•å‘é€äº‹ä»¶å’Œæ³¨å†Œç›‘å¬è€…å°±å¥½ï¼Œå…¶ä»–ç»†èŠ‚ä¸éœ€è¦ç»†ç©¶ã€‚

```
public abstract class AbstractApplicationContext extends ... {
  private final Set<ApplicationListener<?>> applicationListeners;
  
  public AbstractApplicationContext() {
    this.applicationListeners = new LinkedHashSet();
    //...
  }
  
  public void publishEvent(ApplicationEvent event) {
    this.publishEvent(event, (ResolvableType)null);
  }

  public void publishEvent(Object event) {
    this.publishEvent(event, (ResolvableType)null);
  }

  protected void publishEvent(Object event, ResolvableType eventType) {
    //...
    Object applicationEvent;
    if (event instanceof ApplicationEvent) {
      applicationEvent = (ApplicationEvent)event;
    } else {
      applicationEvent = new PayloadApplicationEvent(this, event);
      if (eventType == null) {
        eventType = ((PayloadApplicationEvent)applicationEvent).getResolvableType();
      }
    }

    if (this.earlyApplicationEvents != null) {
      this.earlyApplicationEvents.add(applicationEvent);
    } else {
      this.getApplicationEventMulticaster().multicastEvent(
            (ApplicationEvent)applicationEvent, eventType);
    }

    if (this.parent != null) {
      if (this.parent instanceof AbstractApplicationContext) {
        ((AbstractApplicationContext)this.parent).publishEvent(event, eventType);
      } else {
        this.parent.publishEvent(event);
      }
    }
  }
  
  public void addApplicationListener(ApplicationListener<?> listener) {
    Assert.notNull(listener, "ApplicationListener must not be null");
    if (this.applicationEventMulticaster != null) {
    this.applicationEventMulticaster.addApplicationListener(listener);
    } else {
      this.applicationListeners.add(listener);
    }  
  }
  
  public Collection<ApplicationListener<?>> getApplicationListeners() {
    return this.applicationListeners;
  }
  
  protected void registerListeners() {
    Iterator var1 = this.getApplicationListeners().iterator();

    while(var1.hasNext()) {
      ApplicationListener<?> listener = (ApplicationListener)var1.next();     this.getApplicationEventMulticaster().addApplicationListener(listener);
    }

    String[] listenerBeanNames = this.getBeanNamesForType(ApplicationListener.class, true, false);
    String[] var7 = listenerBeanNames;
    int var3 = listenerBeanNames.length;

    for(int var4 = 0; var4 < var3; ++var4) {
      String listenerBeanName = var7[var4];
      this.getApplicationEventMulticaster().addApplicationListenerBean(listenerBeanName);
    }

    Set<ApplicationEvent> earlyEventsToProcess = this.earlyApplicationEvents;
    this.earlyApplicationEvents = null;
    if (earlyEventsToProcess != null) {
      Iterator var9 = earlyEventsToProcess.iterator();

      while(var9.hasNext()) {
        ApplicationEvent earlyEvent = (ApplicationEvent)var9.next();
        this.getApplicationEventMulticaster().multicastEvent(earlyEvent);
      }
    }
  }
}
```

ä»ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å‘ç°ï¼ŒçœŸæ­£çš„æ¶ˆæ¯å‘é€ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡ApplicationEventMulticasterè¿™ä¸ªç±»æ¥å®Œæˆçš„ã€‚è¿™ä¸ªç±»çš„æºç æˆ‘åªæ‘˜æŠ„äº†æœ€å…³é”®çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯multicastEvent()è¿™ä¸ªæ¶ˆæ¯å‘é€å‡½æ•°ã€‚ä¸è¿‡ï¼Œå®ƒçš„ä»£ç ä¹Ÿå¹¶ä¸å¤æ‚ï¼Œæˆ‘å°±ä¸å¤šè§£é‡Šäº†ã€‚è¿™é‡Œæˆ‘ç¨å¾®æç¤ºä¸€ä¸‹ï¼Œå®ƒé€šè¿‡çº¿ç¨‹æ± ï¼Œæ”¯æŒå¼‚æ­¥éé˜»å¡ã€åŒæ­¥é˜»å¡è¿™ä¸¤ç§ç±»å‹çš„è§‚å¯Ÿè€…æ¨¡å¼ã€‚

```
public void multicastEvent(ApplicationEvent event) {
  this.multicastEvent(event, this.resolveDefaultEventType(event));
}

public void multicastEvent(final ApplicationEvent event, ResolvableType eventType) {
  ResolvableType type = eventType != null ? eventType : this.resolveDefaultEventType(event);
  Iterator var4 = this.getApplicationListeners(event, type).iterator();

  while(var4.hasNext()) {
    final ApplicationListener<?> listener = (ApplicationListener)var4.next();
    Executor executor = this.getTaskExecutor();
    if (executor != null) {
      executor.execute(new Runnable() {
        public void run() {
          SimpleApplicationEventMulticaster.this.invokeListener(listener, event);
        }
      });
    } else {
      this.invokeListener(listener, event);
    }
  }

}
```

å€ŸåŠ©Springæä¾›çš„è§‚å¯Ÿè€…æ¨¡å¼çš„éª¨æ¶ä»£ç ï¼Œå¦‚æœæˆ‘ä»¬è¦åœ¨Springä¸‹å®ç°æŸä¸ªäº‹ä»¶çš„å‘é€å’Œç›‘å¬ï¼Œåªéœ€è¦åšå¾ˆå°‘çš„å·¥ä½œï¼Œå®šä¹‰äº‹ä»¶ã€å®šä¹‰ç›‘å¬å™¨ã€å¾€ApplicationContextä¸­å‘é€äº‹ä»¶å°±å¯ä»¥äº†ï¼Œå‰©ä¸‹çš„å·¥ä½œéƒ½ç”±Springæ¡†æ¶æ¥å®Œæˆã€‚å®é™…ä¸Šï¼Œè¿™ä¹Ÿä½“ç°äº†Springæ¡†æ¶çš„æ‰©å±•æ€§ï¼Œä¹Ÿå°±æ˜¯åœ¨ä¸éœ€è¦ä¿®æ”¹ä»»ä½•ä»£ç çš„æƒ…å†µä¸‹ï¼Œæ‰©å±•æ–°çš„äº‹ä»¶å’Œç›‘å¬ã€‚

## æ¨¡æ¿æ¨¡å¼åœ¨Springä¸­çš„åº”ç”¨

åˆšåˆšè®²çš„æ˜¯è§‚å¯Ÿè€…æ¨¡å¼åœ¨Springä¸­çš„åº”ç”¨ï¼Œç°åœ¨æˆ‘ä»¬å†è®²ä¸‹æ¨¡æ¿æ¨¡å¼ã€‚

æˆ‘ä»¬æ¥çœ‹ä¸‹ä¸€ä¸‹ç»å¸¸åœ¨é¢è¯•ä¸­è¢«é—®åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼šè¯·ä½ è¯´ä¸‹Spring Beançš„åˆ›å»ºè¿‡ç¨‹åŒ…å«å“ªäº›ä¸»è¦çš„æ­¥éª¤ã€‚è¿™å…¶ä¸­å°±æ¶‰åŠæ¨¡æ¿æ¨¡å¼ã€‚å®ƒä¹Ÿä½“ç°äº†Springçš„æ‰©å±•æ€§ã€‚åˆ©ç”¨æ¨¡æ¿æ¨¡å¼ï¼ŒSpringèƒ½è®©ç”¨æˆ·å®šåˆ¶Beançš„åˆ›å»ºè¿‡ç¨‹ã€‚

Spring Beançš„åˆ›å»ºè¿‡ç¨‹ï¼Œå¯ä»¥å¤§è‡´åˆ†ä¸ºä¸¤å¤§æ­¥ï¼šå¯¹è±¡çš„åˆ›å»ºå’Œå¯¹è±¡çš„åˆå§‹åŒ–ã€‚

å¯¹è±¡çš„åˆ›å»ºæ˜¯é€šè¿‡åå°„æ¥åŠ¨æ€ç”Ÿæˆå¯¹è±¡ï¼Œè€Œä¸æ˜¯newæ–¹æ³•ã€‚ä¸ç®¡æ˜¯å“ªç§æ–¹å¼ï¼Œè¯´ç™½äº†ï¼Œæ€»å½’è¿˜æ˜¯è°ƒç”¨æ„é€ å‡½æ•°æ¥ç”Ÿæˆå¯¹è±¡ï¼Œæ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„ã€‚å¯¹è±¡çš„åˆå§‹åŒ–æœ‰ä¸¤ç§å®ç°æ–¹å¼ã€‚ä¸€ç§æ˜¯åœ¨ç±»ä¸­è‡ªå®šä¹‰ä¸€ä¸ªåˆå§‹åŒ–å‡½æ•°ï¼Œå¹¶ä¸”é€šè¿‡é…ç½®æ–‡ä»¶ï¼Œæ˜¾å¼åœ°å‘ŠçŸ¥Springï¼Œå“ªä¸ªå‡½æ•°æ˜¯åˆå§‹åŒ–å‡½æ•°ã€‚æˆ‘ä¸¾äº†ä¸€ä¸ªä¾‹å­è§£é‡Šä¸€ä¸‹ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡init-methodå±æ€§æ¥æŒ‡å®šåˆå§‹åŒ–å‡½æ•°ã€‚

```
public class DemoClass {
  //...
  
  public void initDemo() {
    //...åˆå§‹åŒ–..
  }
}

// é…ç½®ï¼šéœ€è¦é€šè¿‡init-methodæ˜¾å¼åœ°æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•
<bean id="demoBean" class="com.xzg.cd.DemoClass" init-method="initDemo"></bean>
```

è¿™ç§åˆå§‹åŒ–æ–¹å¼æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œåˆå§‹åŒ–å‡½æ•°å¹¶ä¸å›ºå®šï¼Œç”±ç”¨æˆ·éšæ„å®šä¹‰ï¼Œè¿™å°±éœ€è¦Springé€šè¿‡åå°„ï¼Œåœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°è°ƒç”¨è¿™ä¸ªåˆå§‹åŒ–å‡½æ•°ã€‚è€Œåå°„åˆä¼šå½±å“ä»£ç æ‰§è¡Œçš„æ€§èƒ½ï¼Œé‚£æœ‰æ²¡æœ‰æ›¿ä»£æ–¹æ¡ˆå‘¢ï¼Ÿ

Springæä¾›äº†å¦å¤–ä¸€ä¸ªå®šä¹‰åˆå§‹åŒ–å‡½æ•°çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯è®©ç±»å®ç°Initializingbeanæ¥å£ã€‚è¿™ä¸ªæ¥å£åŒ…å«ä¸€ä¸ªå›ºå®šçš„åˆå§‹åŒ–å‡½æ•°å®šä¹‰ï¼ˆafterPropertiesSet()å‡½æ•°ï¼‰ã€‚Springåœ¨åˆå§‹åŒ–Beançš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡bean.afterPropertiesSet()çš„æ–¹å¼ï¼Œè°ƒç”¨Beanå¯¹è±¡ä¸Šçš„è¿™ä¸ªå‡½æ•°ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨åå°„æ¥è°ƒç”¨äº†ã€‚æˆ‘ä¸¾ä¸ªä¾‹å­è§£é‡Šä¸€ä¸‹ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚

```
public class DemoClass implements InitializingBean{
  @Override
  public void afterPropertiesSet() throws Exception {
    //...åˆå§‹åŒ–...      
  }
}

// é…ç½®ï¼šä¸éœ€è¦æ˜¾å¼åœ°æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•
<bean id="demoBean" class="com.xzg.cd.DemoClass"></bean>
```

å°½ç®¡è¿™ç§å®ç°æ–¹å¼ä¸ä¼šç”¨åˆ°åå°„ï¼Œæ‰§è¡Œæ•ˆç‡æé«˜äº†ï¼Œä½†ä¸šåŠ¡ä»£ç ï¼ˆDemoClassï¼‰è·Ÿæ¡†æ¶ä»£ç ï¼ˆInitializingBeanï¼‰è€¦åˆåœ¨äº†ä¸€èµ·ã€‚æ¡†æ¶ä»£ç ä¾µå…¥åˆ°äº†ä¸šåŠ¡ä»£ç ä¸­ï¼Œæ›¿æ¢æ¡†æ¶çš„æˆæœ¬å°±å˜é«˜äº†ã€‚æ‰€ä»¥ï¼Œæˆ‘å¹¶ä¸æ˜¯å¤ªæ¨èè¿™ç§å†™æ³•ã€‚

å®é™…ä¸Šï¼Œåœ¨Springå¯¹Beanæ•´ä¸ªç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªè·Ÿåˆå§‹åŒ–ç›¸å¯¹åº”çš„è¿‡ç¨‹ï¼Œé‚£å°±æ˜¯Beançš„é”€æ¯è¿‡ç¨‹ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨Javaä¸­ï¼Œå¯¹è±¡çš„å›æ”¶æ˜¯é€šè¿‡JVMæ¥è‡ªåŠ¨å®Œæˆçš„ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å°†Beanæ­£å¼äº¤ç»™JVMåƒåœ¾å›æ”¶å‰ï¼Œæ‰§è¡Œä¸€äº›é”€æ¯æ“ä½œï¼ˆæ¯”å¦‚å…³é—­æ–‡ä»¶å¥æŸ„ç­‰ç­‰ï¼‰ã€‚

é”€æ¯è¿‡ç¨‹è·Ÿåˆå§‹åŒ–è¿‡ç¨‹éå¸¸ç›¸ä¼¼ï¼Œä¹Ÿæœ‰ä¸¤ç§å®ç°æ–¹å¼ã€‚ä¸€ç§æ˜¯é€šè¿‡é…ç½®destroy-methodæŒ‡å®šç±»ä¸­çš„é”€æ¯å‡½æ•°ï¼Œå¦ä¸€ç§æ˜¯è®©ç±»å®ç°DisposableBeanæ¥å£ã€‚å› ä¸ºdestroy-methodã€DisposableBeanè·Ÿinit-methodã€InitializingBeanéå¸¸ç›¸ä¼¼ï¼Œæ‰€ä»¥ï¼Œè¿™éƒ¨åˆ†æˆ‘ä»¬å°±ä¸è¯¦ç»†è®²è§£äº†ï¼Œä½ å¯ä»¥è‡ªè¡Œç ”ç©¶ä¸‹ã€‚

å®é™…ä¸Šï¼ŒSpringé’ˆå¯¹å¯¹è±¡çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œè¿˜åšäº†è¿›ä¸€æ­¥çš„ç»†åŒ–ï¼Œå°†å®ƒæ‹†åˆ†æˆäº†ä¸‰ä¸ªå°æ­¥éª¤ï¼šåˆå§‹åŒ–å‰ç½®æ“ä½œã€åˆå§‹åŒ–ã€åˆå§‹åŒ–åç½®æ“ä½œã€‚å…¶ä¸­ï¼Œä¸­é—´çš„åˆå§‹åŒ–æ“ä½œå°±æ˜¯æˆ‘ä»¬åˆšåˆšè®²çš„é‚£éƒ¨åˆ†ï¼Œåˆå§‹åŒ–çš„å‰ç½®å’Œåç½®æ“ä½œï¼Œå®šä¹‰åœ¨æ¥å£BeanPostProcessorä¸­ã€‚BeanPostProcessorçš„æ¥å£å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š

```
public interface BeanPostProcessor {
  Object postProcessBeforeInitialization(Object var1, String var2) throws BeansException;

  Object postProcessAfterInitialization(Object var1, String var2) throws BeansException;
}
```

æˆ‘ä»¬å†æ¥çœ‹ä¸‹ï¼Œå¦‚ä½•é€šè¿‡BeanPostProcessoræ¥å®šä¹‰åˆå§‹åŒ–å‰ç½®å’Œåç½®æ“ä½œï¼Ÿ

æˆ‘ä»¬åªéœ€è¦å®šä¹‰ä¸€ä¸ªå®ç°äº†BeanPostProcessoræ¥å£çš„å¤„ç†å™¨ç±»ï¼Œå¹¶åœ¨é…ç½®æ–‡ä»¶ä¸­åƒé…ç½®æ™®é€šBeanä¸€æ ·å»é…ç½®å°±å¯ä»¥äº†ã€‚Springä¸­çš„ApplicationContextä¼šè‡ªåŠ¨æ£€æµ‹åœ¨é…ç½®æ–‡ä»¶ä¸­å®ç°äº†BeanPostProcessoræ¥å£çš„æ‰€æœ‰Beanï¼Œå¹¶æŠŠå®ƒä»¬æ³¨å†Œåˆ°BeanPostProcessorå¤„ç†å™¨åˆ—è¡¨ä¸­ã€‚åœ¨Springå®¹å™¨åˆ›å»ºBeançš„è¿‡ç¨‹ä¸­ï¼ŒSpringä¼šé€ä¸€å»è°ƒç”¨è¿™äº›å¤„ç†å™¨ã€‚

é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šå¼„æ¸…æ¥šäº†Spring Beançš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼ˆåˆ›å»ºåŠ é”€æ¯ï¼‰ã€‚é’ˆå¯¹è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ç”»äº†ä¸€å¼ å›¾ï¼Œä½ å¯ä»¥ç»“åˆç€åˆšåˆšè®²è§£ä¸€å—çœ‹ä¸‹ã€‚

![](https://static001.geekbang.org/resource/image/ca/4d/cacaf86b03a9432a4885385d2869264d.jpg?wh=2693%2A1352)

ä¸è¿‡ï¼Œä½ å¯èƒ½ä¼šè¯´ï¼Œè¿™é‡Œå“ªé‡Œç”¨åˆ°äº†æ¨¡æ¿æ¨¡å¼å•Šï¼Ÿæ¨¡æ¿æ¨¡å¼ä¸æ˜¯éœ€è¦å®šä¹‰ä¸€ä¸ªåŒ…å«æ¨¡æ¿æ–¹æ³•çš„æŠ½è±¡æ¨¡æ¿ç±»ï¼Œä»¥åŠå®šä¹‰å­ç±»å®ç°æ¨¡æ¿æ–¹æ³•å—ï¼Ÿ

å®é™…ä¸Šï¼Œè¿™é‡Œçš„æ¨¡æ¿æ¨¡å¼çš„å®ç°ï¼Œå¹¶ä¸æ˜¯æ ‡å‡†çš„æŠ½è±¡ç±»çš„å®ç°æ–¹å¼ï¼Œè€Œæ˜¯æœ‰ç‚¹ç±»ä¼¼æˆ‘ä»¬å‰é¢è®²åˆ°çš„Callbackå›è°ƒçš„å®ç°æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯å°†è¦æ‰§è¡Œçš„å‡½æ•°å°è£…æˆå¯¹è±¡ï¼ˆæ¯”å¦‚ï¼Œåˆå§‹åŒ–æ–¹æ³•å°è£…æˆInitializingBeanå¯¹è±¡ï¼‰ï¼Œä¼ é€’ç»™æ¨¡æ¿ï¼ˆBeanFactoryï¼‰æ¥æ‰§è¡Œã€‚

## é‡ç‚¹å›é¡¾

å¥½äº†ï¼Œä»Šå¤©çš„å†…å®¹åˆ°æ­¤å°±è®²å®Œäº†ã€‚æˆ‘ä»¬ä¸€å—æ¥æ€»ç»“å›é¡¾ä¸€ä¸‹ï¼Œä½ éœ€è¦é‡ç‚¹æŒæ¡çš„å†…å®¹ã€‚

ä»Šå¤©æˆ‘è®²åˆ°äº†Springä¸­ç”¨åˆ°çš„ä¸¤ç§æ”¯æŒæ‰©å±•çš„è®¾è®¡æ¨¡å¼ï¼Œè§‚å¯Ÿè€…æ¨¡å¼å’Œæ¨¡æ¿æ¨¡å¼ã€‚

å…¶ä¸­ï¼Œè§‚å¯Ÿè€…æ¨¡å¼åœ¨Javaã€Google Guavaã€Springä¸­éƒ½æœ‰æä¾›ç›¸åº”çš„å®ç°ä»£ç ã€‚åœ¨å¹³æ—¶çš„é¡¹ç›®å¼€å‘ä¸­ï¼ŒåŸºäºè¿™äº›å®ç°ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°å®ç°ä¸€ä¸ªè§‚å¯Ÿè€…æ¨¡å¼ã€‚

Javaæä¾›çš„æ¡†æ¶æ¯”è¾ƒç®€å•ï¼ŒåªåŒ…å«java.util.Observableå’Œjava.util.Observerä¸¤ä¸ªç±»ã€‚Google Guavaæä¾›çš„æ¡†æ¶åŠŸèƒ½æ¯”è¾ƒå®Œå–„å’Œå¼ºå¤§ï¼Œå¯ä»¥é€šè¿‡EventBusäº‹ä»¶æ€»çº¿æ¥å®ç°è§‚å¯Ÿè€…æ¨¡å¼ã€‚Springæä¾›äº†è§‚å¯Ÿè€…æ¨¡å¼åŒ…å«Eventäº‹ä»¶ã€Listenerç›‘å¬è€…ã€Publisherå‘é€è€…ä¸‰éƒ¨åˆ†ã€‚äº‹ä»¶å‘é€åˆ°ApplicationContextä¸­ï¼Œç„¶åï¼ŒApplicationConextå°†æ¶ˆæ¯å‘é€ç»™äº‹å…ˆæ³¨å†Œå¥½çš„ç›‘å¬è€…ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜è®²åˆ°æ¨¡æ¿æ¨¡å¼åœ¨Springä¸­çš„ä¸€ä¸ªå…¸å‹åº”ç”¨ï¼Œé‚£å°±æ˜¯Beançš„åˆ›å»ºè¿‡ç¨‹ã€‚Beançš„åˆ›å»ºåŒ…å«ä¸¤ä¸ªå¤§çš„æ­¥éª¤ï¼Œå¯¹è±¡çš„åˆ›å»ºå’Œå¯¹è±¡çš„åˆå§‹åŒ–ã€‚å…¶ä¸­ï¼Œå¯¹è±¡çš„åˆå§‹åŒ–åˆå¯ä»¥åˆ†è§£ä¸º3ä¸ªå°çš„æ­¥éª¤ï¼šåˆå§‹åŒ–å‰ç½®æ“ä½œã€åˆå§‹åŒ–ã€åˆå§‹åŒ–åç½®æ“ä½œã€‚

## è¯¾å ‚è®¨è®º

åœ¨Google Guavaçš„EventBuså®ç°ä¸­ï¼Œè¢«è§‚å¯Ÿè€…å‘é€æ¶ˆæ¯åˆ°äº‹ä»¶æ€»çº¿ï¼Œäº‹ä»¶æ€»çº¿æ ¹æ®æ¶ˆæ¯çš„ç±»å‹ï¼Œå°†æ¶ˆæ¯å‘é€ç»™å¯åŒ¹é…çš„è§‚å¯Ÿè€…ã€‚é‚£åœ¨Springæä¾›çš„è§‚å¯Ÿè€…æ¨¡å¼çš„å®ç°ä¸­ï¼Œæ˜¯å¦ä¹Ÿæ”¯æŒæŒ‰ç…§æ¶ˆæ¯ç±»å‹åŒ¹é…è§‚å¯Ÿè€…å‘¢ï¼Ÿå¦‚æœèƒ½ï¼Œå®ƒæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿå¦‚æœä¸èƒ½ï¼Œä½ æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥è®©å®ƒæ”¯æŒå—ï¼Ÿ

æ¬¢è¿ç•™è¨€å’Œæˆ‘åˆ†äº«ä½ çš„æƒ³æ³•ã€‚å¦‚æœæœ‰æ”¶è·ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ14ï¼‰</strong></div><ul>
<li><span>zz</span> ğŸ‘ï¼ˆ36ï¼‰ ğŸ’¬ï¼ˆ7ï¼‰<p>çœ‹åˆ°æºç ä¸­æœ‰è¿™ä¹ˆå¤šçš„if elseï¼Œç¬é—´ç»™äº†è‡ªå·±ä¸€äº›ä¿¡å¿ƒã€‚</p>2020-06-05</li><br/><li><span>æ‚Ÿå…‰</span> ğŸ‘ï¼ˆ11ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>æ”¯æŒæŒ‰ç…§æ¶ˆæ¯ç±»å‹åŒ¹é…è§‚å¯Ÿè€…ï¼Œæœ€ç»ˆè°ƒç”¨ SimpleApplicationEventMulticaster ç±»çš„multicastEventæ–¹æ³•é€šè¿‡åå°„åŒ¹é…ç±»å‹ã€‚æ ¹æ®é…ç½®é‡‡ç”¨å¼‚æ­¥è¿˜æ˜¯åŒæ­¥çš„ç›‘å¬æ–¹å¼ã€‚
	public void multicastEvent(final ApplicationEvent event, @Nullable ResolvableType eventType) {
		ResolvableType type = (eventType != null ? eventType : resolveDefaultEventType(event));
		Executor executor = getTaskExecutor();
		for (ApplicationListener&lt;?&gt; listener : getApplicationListeners(event, type)) {
			if (executor != null) {
				executor.execute(() -&gt; invokeListener(listener, event));
			}
			else {
				invokeListener(listener, event);
			}
		}
	}
</p>2020-05-18</li><br/><li><span>Heaven</span> ğŸ‘ï¼ˆ10ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>çœ‹äº†ä¸‹æºç ,å…¶æµç¨‹å¯ä»¥ä»
å›¾ç‰‡: https:&#47;&#47;uploader.shimo.im&#47;f&#47;fZuIVWFIlWQnnRFq.png
æ¨é€Eventæ—¶å€™,å»å‘é€Eventå¼€å§‹èµ°
ä¸»è¦å°±æ˜¯è¿™ä¸ª
åœ¨æ­¤æ–¹æ³•ä¸­,ä¼šè°ƒç”¨getApplicationListeners(event,eventType)å‡½æ•°
å›¾ç‰‡: https:&#47;&#47;uploader.shimo.im&#47;f&#47;3mZZvSBhmc8CXLnx.png
åœ¨è¿™ä¸ªæ–¹æ³•ä¸­,ä¼šè·å–åˆ°å¯¹åº”çš„æ‰€æœ‰ç›‘å¬è€…,å¦‚ä½•è·å–åˆ°çš„,ä¼šå…ˆé€šè¿‡ä¸€ä¸ªé”æ¥ä»ä¸€ä¸ªåä¸ºretrieverCacheçš„mapä¸­å°è¯•è·å–åˆ°å¯¹åº”çš„ç›‘å¬è€…
å¦‚æœæ‹¿ä¸åˆ°,ä¼šè¿›å…¥åˆ°retrieveApplicationListeners()è¿™ä¸ªå‡½æ•°ä¹‹ä¸­
å›¾ç‰‡: https:&#47;&#47;uploader.shimo.im&#47;f&#47;GFvS2QEKGlMctZrc.png
åœ¨è¿™ä¸ªæ–¹æ³•ä¸­,ä¼šåœ¨addè¿”å›çš„ç»“æœçš„æ—¶å€™,ä¼šè°ƒç”¨ä¸€ä¸ªæ–¹æ³•supportsEvent(),
è¿™æ‰æ˜¯çœŸæ­£è¿›è¡ŒåŒ¹é…çš„æ–¹æ³•
å›¾ç‰‡: https:&#47;&#47;uploader.shimo.im&#47;f&#47;102Ia9ToqIw5ZOyq.png
åŒ¹é…äº‹ä»¶å’Œæºç±»å‹æ˜¯å¦ä¸€è‡´,ä¸€è‡´æ‰ç®—åšå¯ä»¥å‘é€</p>2020-05-18</li><br/><li><span>test</span> ğŸ‘ï¼ˆ8ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>ç”¨åå°„è·å–çš„type</p>2020-05-18</li><br/><li><span>Monday</span> ğŸ‘ï¼ˆ7ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>å®šä¹‰äº†ä¸€ä¸ªbeanåŒæ—¶å®ç°äº†InitializingBean, BeanPostProcessor, DisposableBeanï¼Œå‘ç°æ–¹æ³•è·Ÿè€å¸ˆæœ€åä¸€å¼ å›¾çš„ä¸ä¸€è‡´ï¼š
1ã€é¡ºåºæ˜¯æ„é€ å™¨ã€afterPropertiesSetã€postProcessBeforeInitializationã€postProcessAfterInitializationã€destroy
2ã€postProcessBeforeInitializationã€postProcessAfterInitializationè¿™ä¸¤ä¸ªæ–¹æ³•äº¤æ›¿æ‰§è¡Œäº†Næ¬¡</p>2020-05-20</li><br/><li><span>æ¾å°é¼ </span> ğŸ‘ï¼ˆ6ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<p>æ˜¨å¤©åˆšå¥½åœ¨éš”å£å°é©¬å“¥é‚£é‡Œçœ‹åˆ°äº†ï¼Œä¸¤ä¸ªè¯¾ä¸€èµ·å¬ï¼Œä¾§é‡ç‚¹ä¸åŒï¼Œéƒ½å¾ˆé‡è¦å•Š</p>2020-05-18</li><br/><li><span>Tobias</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>Spring æä¾›çš„è§‚å¯Ÿè€…æ¨¡å¼æ˜¯æ”¯æŒæŒ‰ç…§æ¶ˆæ¯ç±»å‹åŒ¹é…è§‚å¯Ÿè€…ã€‚getApplicationListeners(event, type) æ–¹æ³•ä¼šæ ¹æ®eventtype æ‰¾åˆ°å¯¹åº”çš„çš„listeners. getApplicationListeners(event, type) é€šè¿‡åå°„æ‰¾åˆ° event ä»¥åŠeventçš„å­ç±» å¯¹åº”çš„listeners.</p>2020-07-27</li><br/><li><span>tonyli</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>ä½¿ç”¨æ¨¡æ¿æ¨¡å¼å®šä¹‰äº†ä¸€ç³»åˆ—æ­¥éª¤çš„éª¨æ¶ï¼Œæ˜¯å„ç±»æ¡†æ¶çš„æ ¹æœ¬è®¾è®¡æ¨¡å¼ã€‚</p>2022-09-19</li><br/><li><span>æ¡äº†ä¸ªå¤§èš‚èš±</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>1.å®ç°InitializingBeançš„åˆå§‹åŒ–æ–¹æ³•ï¼Œä¹Ÿæ˜¯çº¦å®šä¼˜äºé…ç½®çš„ä¸€ä¸ªä½“ç°ï¼Œåªä¸è¿‡ä¸æ˜¯è¦†ç›–é»˜è®¤å€¼è€Œæ˜¯å®ç°init-methodçš„ä¸€ä¸ªå‰ç½®æ–¹æ³•afterPropertiesSetã€‚
2.å®ç°InitializingBeançš„åˆå§‹åŒ–æ–¹æ³•å’Œè‡ªå·±æŒ‡å®šinit-methodç›¸æ¯”ï¼Œä¾µå…¥æ€§æ›´é«˜ï¼Œæ‰€ä»¥ä¸å¤ªæ¨èã€‚å¯ä»¥ç”¨æ³¨è§£ç‰ˆçš„@Bean(initMethod = &quot;xx&quot;)æ¥æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ï¼Œæˆ–è€…ä½¿ç”¨JSR250ä¸­çš„@PostConstructæ ‡æ³¨åœ¨åˆå§‹åŒ–æ–¹æ³•ä¸Šæ¥è®©ç¨‹åºå›è°ƒã€‚</p>2020-10-12</li><br/><li><span>å‰‘å…«</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>springä¸­çš„refreshæ˜¯ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ï¼š
å¤§è‡´æœ‰ï¼šæ³¨å†ŒbeanFactoryPostProcessorï¼ŒbeanPostProcessorï¼Œè¯»å–bean definitionï¼Œåˆ›å»ºå¹¶åˆå§‹åŒ–bean,ç­‰</p>2020-07-05</li><br/><li><span>æé‡‘é¹</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>è‡ªå®šä¹‰æ³¨è§£åŠ AOPå¯ä»¥å®ç°æ”¯æŒæŒ‰ç…§æ¶ˆæ¯ç±»å‹åŒ¹é…è§‚å¯Ÿè€…</p>2022-01-24</li><br/><li><span>é¹¤æ¶µ</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>ç­–è®ºæ¨¡å¼ ç¼“å­˜å¯¹è±¡ç±»å‹å’Œå¤„ç†å™¨çš„å…³ç³»</p>2021-02-25</li><br/><li><span>å­æˆ¿</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>spring ä¸­é€šè¿‡ simple å®ç°ç±»å‘é€äº‹ä»¶ï¼Œå¹¶ç»´æŠ¤äº†äº‹ä»¶å’Œç›‘å¬è€…çš„æ˜ å°„å…³ç³»ï¼Œå½“éœ€è¦å‘é€ä¸€ä¸ªäº‹ä»¶æ—¶ä¼šæŠŠè¯¥äº‹ä»¶å¯¹åº”çš„ç›‘å¬è€…å–å‡ºï¼Œå¹¶æ‰§è¡Œã€‚</p>2021-02-04</li><br/><li><span>o0oi1i</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>æ‰“å¡85</p>2020-11-02</li><br/>
</ul>