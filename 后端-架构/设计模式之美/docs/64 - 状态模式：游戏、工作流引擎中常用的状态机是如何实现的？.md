ä»ä»Šå¤©èµ·ï¼Œæˆ‘ä»¬å¼€å§‹å­¦ä¹ çŠ¶æ€æ¨¡å¼ã€‚åœ¨å®é™…çš„è½¯ä»¶å¼€å‘ä¸­ï¼ŒçŠ¶æ€æ¨¡å¼å¹¶ä¸æ˜¯å¾ˆå¸¸ç”¨ï¼Œä½†æ˜¯åœ¨èƒ½å¤Ÿç”¨åˆ°çš„åœºæ™¯é‡Œï¼Œå®ƒå¯ä»¥å‘æŒ¥å¾ˆå¤§çš„ä½œç”¨ã€‚ä»è¿™ä¸€ç‚¹ä¸Šæ¥çœ‹ï¼Œå®ƒæœ‰ç‚¹åƒæˆ‘ä»¬ä¹‹å‰è®²åˆ°çš„ç»„åˆæ¨¡å¼ã€‚

çŠ¶æ€æ¨¡å¼ä¸€èˆ¬ç”¨æ¥å®ç°çŠ¶æ€æœºï¼Œè€ŒçŠ¶æ€æœºå¸¸ç”¨åœ¨æ¸¸æˆã€å·¥ä½œæµå¼•æ“ç­‰ç³»ç»Ÿå¼€å‘ä¸­ã€‚ä¸è¿‡ï¼ŒçŠ¶æ€æœºçš„å®ç°æ–¹å¼æœ‰å¤šç§ï¼Œé™¤äº†çŠ¶æ€æ¨¡å¼ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„è¿˜æœ‰åˆ†æ”¯é€»è¾‘æ³•å’ŒæŸ¥è¡¨æ³•ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±è¯¦ç»†è®²è®²è¿™å‡ ç§å®ç°æ–¹å¼ï¼Œå¹¶ä¸”å¯¹æ¯”ä¸€ä¸‹å®ƒä»¬çš„ä¼˜åŠ£å’Œåº”ç”¨åœºæ™¯ã€‚

è¯ä¸å¤šè¯´ï¼Œè®©æˆ‘ä»¬æ­£å¼å¼€å§‹ä»Šå¤©çš„å­¦ä¹ å§ï¼

## ä»€ä¹ˆæ˜¯æœ‰é™çŠ¶æ€æœºï¼Ÿ

æœ‰é™çŠ¶æ€æœºï¼Œè‹±æ–‡ç¿»è¯‘æ˜¯Finite State Machineï¼Œç¼©å†™ä¸ºFSMï¼Œç®€ç§°ä¸ºçŠ¶æ€æœºã€‚çŠ¶æ€æœºæœ‰3ä¸ªç»„æˆéƒ¨åˆ†ï¼šçŠ¶æ€ï¼ˆStateï¼‰ã€äº‹ä»¶ï¼ˆEventï¼‰ã€åŠ¨ä½œï¼ˆActionï¼‰ã€‚å…¶ä¸­ï¼Œäº‹ä»¶ä¹Ÿç§°ä¸ºè½¬ç§»æ¡ä»¶ï¼ˆTransition Conditionï¼‰ã€‚äº‹ä»¶è§¦å‘çŠ¶æ€çš„è½¬ç§»åŠåŠ¨ä½œçš„æ‰§è¡Œã€‚ä¸è¿‡ï¼ŒåŠ¨ä½œä¸æ˜¯å¿…é¡»çš„ï¼Œä¹Ÿå¯èƒ½åªè½¬ç§»çŠ¶æ€ï¼Œä¸æ‰§è¡Œä»»ä½•åŠ¨ä½œã€‚

å¯¹äºåˆšåˆšç»™å‡ºçš„çŠ¶æ€æœºçš„å®šä¹‰ï¼Œæˆ‘ç»“åˆä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œæ¥è¿›ä¸€æ­¥è§£é‡Šä¸€ä¸‹ã€‚

â€œè¶…çº§é©¬é‡Œå¥¥â€æ¸¸æˆä¸çŸ¥é“ä½ ç©è¿‡æ²¡æœ‰ï¼Ÿåœ¨æ¸¸æˆä¸­ï¼Œé©¬é‡Œå¥¥å¯ä»¥å˜èº«ä¸ºå¤šç§å½¢æ€ï¼Œæ¯”å¦‚å°é©¬é‡Œå¥¥ï¼ˆSmall Marioï¼‰ã€è¶…çº§é©¬é‡Œå¥¥ï¼ˆSuper Marioï¼‰ã€ç«ç„°é©¬é‡Œå¥¥ï¼ˆFire Marioï¼‰ã€æ–—ç¯·é©¬é‡Œå¥¥ï¼ˆCape Marioï¼‰ç­‰ç­‰ã€‚åœ¨ä¸åŒçš„æ¸¸æˆæƒ…èŠ‚ä¸‹ï¼Œå„ä¸ªå½¢æ€ä¼šäº’ç›¸è½¬åŒ–ï¼Œå¹¶ç›¸åº”çš„å¢å‡ç§¯åˆ†ã€‚æ¯”å¦‚ï¼Œåˆå§‹å½¢æ€æ˜¯å°é©¬é‡Œå¥¥ï¼Œåƒäº†è˜‘è‡ä¹‹åå°±ä¼šå˜æˆè¶…çº§é©¬é‡Œå¥¥ï¼Œå¹¶ä¸”å¢åŠ 100ç§¯åˆ†ã€‚

å®é™…ä¸Šï¼Œé©¬é‡Œå¥¥å½¢æ€çš„è½¬å˜å°±æ˜¯ä¸€ä¸ªçŠ¶æ€æœºã€‚å…¶ä¸­ï¼Œé©¬é‡Œå¥¥çš„ä¸åŒå½¢æ€å°±æ˜¯çŠ¶æ€æœºä¸­çš„â€œçŠ¶æ€â€ï¼Œæ¸¸æˆæƒ…èŠ‚ï¼ˆæ¯”å¦‚åƒäº†è˜‘è‡ï¼‰å°±æ˜¯çŠ¶æ€æœºä¸­çš„â€œäº‹ä»¶â€ï¼ŒåŠ å‡ç§¯åˆ†å°±æ˜¯çŠ¶æ€æœºä¸­çš„â€œåŠ¨ä½œâ€ã€‚æ¯”å¦‚ï¼Œåƒè˜‘è‡è¿™ä¸ªäº‹ä»¶ï¼Œä¼šè§¦å‘çŠ¶æ€çš„è½¬ç§»ï¼šä»å°é©¬é‡Œå¥¥è½¬ç§»åˆ°è¶…çº§é©¬é‡Œå¥¥ï¼Œä»¥åŠè§¦å‘åŠ¨ä½œçš„æ‰§è¡Œï¼ˆå¢åŠ 100ç§¯åˆ†ï¼‰ã€‚

ä¸ºäº†æ–¹ä¾¿æ¥ä¸‹æ¥çš„è®²è§£ï¼Œæˆ‘å¯¹æ¸¸æˆèƒŒæ™¯åšäº†ç®€åŒ–ï¼Œåªä¿ç•™äº†éƒ¨åˆ†çŠ¶æ€å’Œäº‹ä»¶ã€‚ç®€åŒ–ä¹‹åçš„çŠ¶æ€è½¬ç§»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://static001.geekbang.org/resource/image/5a/6c/5aa0310b9b3ea08794cfc2f376c8f96c.jpg?wh=1704%2A1563)

æˆ‘ä»¬å¦‚ä½•ç¼–ç¨‹æ¥å®ç°ä¸Šé¢çš„çŠ¶æ€æœºå‘¢ï¼Ÿæ¢å¥è¯è¯´ï¼Œå¦‚ä½•å°†ä¸Šé¢çš„çŠ¶æ€è½¬ç§»å›¾ç¿»è¯‘æˆä»£ç å‘¢ï¼Ÿ

æˆ‘å†™äº†ä¸€ä¸ªéª¨æ¶ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚å…¶ä¸­ï¼ŒobtainMushRoom()ã€obtainCape()ã€obtainFireFlower()ã€meetMonster()è¿™å‡ ä¸ªå‡½æ•°ï¼Œèƒ½å¤Ÿæ ¹æ®å½“å‰çš„çŠ¶æ€å’Œäº‹ä»¶ï¼Œæ›´æ–°çŠ¶æ€å’Œå¢å‡ç§¯åˆ†ã€‚ä¸è¿‡ï¼Œå…·ä½“çš„ä»£ç å®ç°æˆ‘æš‚æ—¶å¹¶æ²¡æœ‰ç»™å‡ºã€‚ä½ å¯ä»¥æŠŠå®ƒå½“åšé¢è¯•é¢˜ï¼Œè¯•ç€è¡¥å…¨ä¸€ä¸‹ï¼Œç„¶åå†æ¥çœ‹æˆ‘ä¸‹é¢çš„è®²è§£ï¼Œè¿™æ ·ä½ çš„æ”¶è·ä¼šæ›´å¤§ã€‚

```
public enum State {
  SMALL(0),
  SUPER(1),
  FIRE(2),
  CAPE(3);

  private int value;

  private State(int value) {
    this.value = value;
  }

  public int getValue() {
    return this.value;
  }
}

public class MarioStateMachine {
  private int score;
  private State currentState;

  public MarioStateMachine() {
    this.score = 0;
    this.currentState = State.SMALL;
  }

  public void obtainMushRoom() {
    //TODO
  }

  public void obtainCape() {
    //TODO
  }

  public void obtainFireFlower() {
    //TODO
  }

  public void meetMonster() {
    //TODO
  }

  public int getScore() {
    return this.score;
  }

  public State getCurrentState() {
    return this.currentState;
  }
}

public class ApplicationDemo {
  public static void main(String[] args) {
    MarioStateMachine mario = new MarioStateMachine();
    mario.obtainMushRoom();
    int score = mario.getScore();
    State state = mario.getCurrentState();
    System.out.println("mario score: " + score + "; state: " + state);
  }
}
```

## çŠ¶æ€æœºå®ç°æ–¹å¼ä¸€ï¼šåˆ†æ”¯é€»è¾‘æ³•

å¯¹äºå¦‚ä½•å®ç°çŠ¶æ€æœºï¼Œæˆ‘æ€»ç»“äº†ä¸‰ç§æ–¹å¼ã€‚å…¶ä¸­ï¼Œæœ€ç®€å•ç›´æ¥çš„å®ç°æ–¹å¼æ˜¯ï¼Œå‚ç…§çŠ¶æ€è½¬ç§»å›¾ï¼Œå°†æ¯ä¸€ä¸ªçŠ¶æ€è½¬ç§»ï¼ŒåŸæ¨¡åŸæ ·åœ°ç›´è¯‘æˆä»£ç ã€‚è¿™æ ·ç¼–å†™çš„ä»£ç ä¼šåŒ…å«å¤§é‡çš„if-elseæˆ–switch-caseåˆ†æ”¯åˆ¤æ–­é€»è¾‘ï¼Œç”šè‡³æ˜¯åµŒå¥—çš„åˆ†æ”¯åˆ¤æ–­é€»è¾‘ï¼Œæ‰€ä»¥ï¼Œæˆ‘æŠŠè¿™ç§æ–¹æ³•æš‚ä¸”å‘½åä¸ºåˆ†æ”¯é€»è¾‘æ³•ã€‚

æŒ‰ç…§è¿™ä¸ªå®ç°æ€è·¯ï¼Œæˆ‘å°†ä¸Šé¢çš„éª¨æ¶ä»£ç è¡¥å…¨ä¸€ä¸‹ã€‚è¡¥å…¨ä¹‹åçš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

```
public class MarioStateMachine {
  private int score;
  private State currentState;

  public MarioStateMachine() {
    this.score = 0;
    this.currentState = State.SMALL;
  }

  public void obtainMushRoom() {
    if (currentState.equals(State.SMALL)) {
      this.currentState = State.SUPER;
      this.score += 100;
    }
  }

  public void obtainCape() {
    if (currentState.equals(State.SMALL) || currentState.equals(State.SUPER) ) {
      this.currentState = State.CAPE;
      this.score += 200;
    }
  }

  public void obtainFireFlower() {
    if (currentState.equals(State.SMALL) || currentState.equals(State.SUPER) ) {
      this.currentState = State.FIRE;
      this.score += 300;
    }
  }

  public void meetMonster() {
    if (currentState.equals(State.SUPER)) {
      this.currentState = State.SMALL;
      this.score -= 100;
      return;
    }

    if (currentState.equals(State.CAPE)) {
      this.currentState = State.SMALL;
      this.score -= 200;
      return;
    }

    if (currentState.equals(State.FIRE)) {
      this.currentState = State.SMALL;
      this.score -= 300;
      return;
    }
  }

  public int getScore() {
    return this.score;
  }

  public State getCurrentState() {
    return this.currentState;
  }
}
```

å¯¹äºç®€å•çš„çŠ¶æ€æœºæ¥è¯´ï¼Œåˆ†æ”¯é€»è¾‘è¿™ç§å®ç°æ–¹å¼æ˜¯å¯ä»¥æ¥å—çš„ã€‚ä½†æ˜¯ï¼Œå¯¹äºå¤æ‚çš„çŠ¶æ€æœºæ¥è¯´ï¼Œè¿™ç§å®ç°æ–¹å¼ææ˜“æ¼å†™æˆ–è€…é”™å†™æŸä¸ªçŠ¶æ€è½¬ç§»ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä»£ç ä¸­å……æ–¥ç€å¤§é‡çš„if-elseæˆ–è€…switch-caseåˆ†æ”¯åˆ¤æ–­é€»è¾‘ï¼Œå¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§éƒ½å¾ˆå·®ã€‚å¦‚æœå“ªå¤©ä¿®æ”¹äº†çŠ¶æ€æœºä¸­çš„æŸä¸ªçŠ¶æ€è½¬ç§»ï¼Œæˆ‘ä»¬è¦åœ¨å†—é•¿çš„åˆ†æ”¯é€»è¾‘ä¸­æ‰¾åˆ°å¯¹åº”çš„ä»£ç è¿›è¡Œä¿®æ”¹ï¼Œå¾ˆå®¹æ˜“æ”¹é”™ï¼Œå¼•å…¥bugã€‚

## çŠ¶æ€æœºå®ç°æ–¹å¼äºŒï¼šæŸ¥è¡¨æ³•

å®é™…ä¸Šï¼Œä¸Šé¢è¿™ç§å®ç°æ–¹æ³•æœ‰ç‚¹ç±»ä¼¼hard codeï¼Œå¯¹äºå¤æ‚çš„çŠ¶æ€æœºæ¥è¯´ä¸é€‚ç”¨ï¼Œè€ŒçŠ¶æ€æœºçš„ç¬¬äºŒç§å®ç°æ–¹å¼æŸ¥è¡¨æ³•ï¼Œå°±æ›´åŠ åˆé€‚äº†ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä¸€å—å„¿æ¥çœ‹ä¸‹ï¼Œå¦‚ä½•åˆ©ç”¨æŸ¥è¡¨æ³•æ¥è¡¥å…¨éª¨æ¶ä»£ç ã€‚

å®é™…ä¸Šï¼Œé™¤äº†ç”¨çŠ¶æ€è½¬ç§»å›¾æ¥è¡¨ç¤ºä¹‹å¤–ï¼ŒçŠ¶æ€æœºè¿˜å¯ä»¥ç”¨äºŒç»´è¡¨æ¥è¡¨ç¤ºï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚åœ¨è¿™ä¸ªäºŒç»´è¡¨ä¸­ï¼Œç¬¬ä¸€ç»´è¡¨ç¤ºå½“å‰çŠ¶æ€ï¼Œç¬¬äºŒç»´è¡¨ç¤ºäº‹ä»¶ï¼Œå€¼è¡¨ç¤ºå½“å‰çŠ¶æ€ç»è¿‡äº‹ä»¶ä¹‹åï¼Œè½¬ç§»åˆ°çš„æ–°çŠ¶æ€åŠå…¶æ‰§è¡Œçš„åŠ¨ä½œã€‚

![](https://static001.geekbang.org/resource/image/4f/91/4f4ea3787bd955918578181e18173491.jpg?wh=2263%2A913)

ç›¸å¯¹äºåˆ†æ”¯é€»è¾‘çš„å®ç°æ–¹å¼ï¼ŒæŸ¥è¡¨æ³•çš„ä»£ç å®ç°æ›´åŠ æ¸…æ™°ï¼Œå¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§æ›´å¥½ã€‚å½“ä¿®æ”¹çŠ¶æ€æœºæ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹transitionTableå’ŒactionTableä¸¤ä¸ªäºŒç»´æ•°ç»„å³å¯ã€‚å®é™…ä¸Šï¼Œå¦‚æœæˆ‘ä»¬æŠŠè¿™ä¸¤ä¸ªäºŒç»´æ•°ç»„å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå½“éœ€è¦ä¿®æ”¹çŠ¶æ€æœºæ—¶ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥ä¸ä¿®æ”¹ä»»ä½•ä»£ç ï¼Œåªéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶å°±å¯ä»¥äº†ã€‚å…·ä½“çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

```
public enum Event {
  GOT_MUSHROOM(0),
  GOT_CAPE(1),
  GOT_FIRE(2),
  MET_MONSTER(3);

  private int value;

  private Event(int value) {
    this.value = value;
  }

  public int getValue() {
    return this.value;
  }
}

public class MarioStateMachine {
  private int score;
  private State currentState;

  private static final State[][] transitionTable = {
          {SUPER, CAPE, FIRE, SMALL},
          {SUPER, CAPE, FIRE, SMALL},
          {CAPE, CAPE, CAPE, SMALL},
          {FIRE, FIRE, FIRE, SMALL}
  };

  private static final int[][] actionTable = {
          {+100, +200, +300, +0},
          {+0, +200, +300, -100},
          {+0, +0, +0, -200},
          {+0, +0, +0, -300}
  };

  public MarioStateMachine() {
    this.score = 0;
    this.currentState = State.SMALL;
  }

  public void obtainMushRoom() {
    executeEvent(Event.GOT_MUSHROOM);
  }

  public void obtainCape() {
    executeEvent(Event.GOT_CAPE);
  }

  public void obtainFireFlower() {
    executeEvent(Event.GOT_FIRE);
  }

  public void meetMonster() {
    executeEvent(Event.MET_MONSTER);
  }

  private void executeEvent(Event event) {
    int stateValue = currentState.getValue();
    int eventValue = event.getValue();
    this.currentState = transitionTable[stateValue][eventValue];
    this.score += actionTable[stateValue][eventValue];
  }

  public int getScore() {
    return this.score;
  }

  public State getCurrentState() {
    return this.currentState;
  }

}
```

## çŠ¶æ€æœºå®ç°æ–¹å¼ä¸‰ï¼šçŠ¶æ€æ¨¡å¼

åœ¨æŸ¥è¡¨æ³•çš„ä»£ç å®ç°ä¸­ï¼Œäº‹ä»¶è§¦å‘çš„åŠ¨ä½œåªæ˜¯ç®€å•çš„ç§¯åˆ†åŠ å‡ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªintç±»å‹çš„äºŒç»´æ•°ç»„actionTableå°±èƒ½è¡¨ç¤ºï¼ŒäºŒç»´æ•°ç»„ä¸­çš„å€¼è¡¨ç¤ºç§¯åˆ†çš„åŠ å‡å€¼ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¦æ‰§è¡Œçš„åŠ¨ä½œå¹¶éè¿™ä¹ˆç®€å•ï¼Œè€Œæ˜¯ä¸€ç³»åˆ—å¤æ‚çš„é€»è¾‘æ“ä½œï¼ˆæ¯”å¦‚åŠ å‡ç§¯åˆ†ã€å†™æ•°æ®åº“ï¼Œè¿˜æœ‰å¯èƒ½å‘é€æ¶ˆæ¯é€šçŸ¥ç­‰ç­‰ï¼‰ï¼Œæˆ‘ä»¬å°±æ²¡æ³•ç”¨å¦‚æ­¤ç®€å•çš„äºŒç»´æ•°ç»„æ¥è¡¨ç¤ºäº†ã€‚è¿™ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŸ¥è¡¨æ³•çš„å®ç°æ–¹å¼æœ‰ä¸€å®šå±€é™æ€§ã€‚

è™½ç„¶åˆ†æ”¯é€»è¾‘çš„å®ç°æ–¹å¼ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œä½†å®ƒåˆå­˜åœ¨å‰é¢è®²åˆ°çš„å…¶ä»–é—®é¢˜ï¼Œæ¯”å¦‚åˆ†æ”¯åˆ¤æ–­é€»è¾‘è¾ƒå¤šï¼Œå¯¼è‡´ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ä¸å¥½ç­‰ã€‚å®é™…ä¸Šï¼Œé’ˆå¯¹åˆ†æ”¯é€»è¾‘æ³•å­˜åœ¨çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨çŠ¶æ€æ¨¡å¼æ¥è§£å†³ã€‚

çŠ¶æ€æ¨¡å¼é€šè¿‡å°†äº‹ä»¶è§¦å‘çš„çŠ¶æ€è½¬ç§»å’ŒåŠ¨ä½œæ‰§è¡Œï¼Œæ‹†åˆ†åˆ°ä¸åŒçš„çŠ¶æ€ç±»ä¸­ï¼Œæ¥é¿å…åˆ†æ”¯åˆ¤æ–­é€»è¾‘ã€‚æˆ‘ä»¬è¿˜æ˜¯ç»“åˆä»£ç æ¥ç†è§£è¿™å¥è¯ã€‚

åˆ©ç”¨çŠ¶æ€æ¨¡å¼ï¼Œæˆ‘ä»¬æ¥è¡¥å…¨MarioStateMachineç±»ï¼Œè¡¥å…¨åçš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚

å…¶ä¸­ï¼ŒIMarioæ˜¯çŠ¶æ€çš„æ¥å£ï¼Œå®šä¹‰äº†æ‰€æœ‰çš„äº‹ä»¶ã€‚SmallMarioã€SuperMarioã€CapeMarioã€FireMarioæ˜¯IMarioæ¥å£çš„å®ç°ç±»ï¼Œåˆ†åˆ«å¯¹åº”çŠ¶æ€æœºä¸­çš„4ä¸ªçŠ¶æ€ã€‚åŸæ¥æ‰€æœ‰çš„çŠ¶æ€è½¬ç§»å’ŒåŠ¨ä½œæ‰§è¡Œçš„ä»£ç é€»è¾‘ï¼Œéƒ½é›†ä¸­åœ¨MarioStateMachineç±»ä¸­ï¼Œç°åœ¨ï¼Œè¿™äº›ä»£ç é€»è¾‘è¢«åˆ†æ•£åˆ°äº†è¿™4ä¸ªçŠ¶æ€ç±»ä¸­ã€‚

```
public interface IMario { //æ‰€æœ‰çŠ¶æ€ç±»çš„æ¥å£
  State getName();
  //ä»¥ä¸‹æ˜¯å®šä¹‰çš„äº‹ä»¶
  void obtainMushRoom();
  void obtainCape();
  void obtainFireFlower();
  void meetMonster();
}

public class SmallMario implements IMario {
  private MarioStateMachine stateMachine;

  public SmallMario(MarioStateMachine stateMachine) {
    this.stateMachine = stateMachine;
  }

  @Override
  public State getName() {
    return State.SMALL;
  }

  @Override
  public void obtainMushRoom() {
    stateMachine.setCurrentState(new SuperMario(stateMachine));
    stateMachine.setScore(stateMachine.getScore() + 100);
  }

  @Override
  public void obtainCape() {
    stateMachine.setCurrentState(new CapeMario(stateMachine));
    stateMachine.setScore(stateMachine.getScore() + 200);
  }

  @Override
  public void obtainFireFlower() {
    stateMachine.setCurrentState(new FireMario(stateMachine));
    stateMachine.setScore(stateMachine.getScore() + 300);
  }

  @Override
  public void meetMonster() {
    // do nothing...
  }
}

public class SuperMario implements IMario {
  private MarioStateMachine stateMachine;

  public SuperMario(MarioStateMachine stateMachine) {
    this.stateMachine = stateMachine;
  }

  @Override
  public State getName() {
    return State.SUPER;
  }

  @Override
  public void obtainMushRoom() {
    // do nothing...
  }

  @Override
  public void obtainCape() {
    stateMachine.setCurrentState(new CapeMario(stateMachine));
    stateMachine.setScore(stateMachine.getScore() + 200);
  }

  @Override
  public void obtainFireFlower() {
    stateMachine.setCurrentState(new FireMario(stateMachine));
    stateMachine.setScore(stateMachine.getScore() + 300);
  }

  @Override
  public void meetMonster() {
    stateMachine.setCurrentState(new SmallMario(stateMachine));
    stateMachine.setScore(stateMachine.getScore() - 100);
  }
}

// çœç•¥CapeMarioã€FireMarioç±»...

public class MarioStateMachine {
  private int score;
  private IMario currentState; // ä¸å†ä½¿ç”¨æšä¸¾æ¥è¡¨ç¤ºçŠ¶æ€

  public MarioStateMachine() {
    this.score = 0;
    this.currentState = new SmallMario(this);
  }

  public void obtainMushRoom() {
    this.currentState.obtainMushRoom();
  }

  public void obtainCape() {
    this.currentState.obtainCape();
  }

  public void obtainFireFlower() {
    this.currentState.obtainFireFlower();
  }

  public void meetMonster() {
    this.currentState.meetMonster();
  }

  public int getScore() {
    return this.score;
  }

  public State getCurrentState() {
    return this.currentState.getName();
  }

  public void setScore(int score) {
    this.score = score;
  }

  public void setCurrentState(IMario currentState) {
    this.currentState = currentState;
  }
}
```

ä¸Šé¢çš„ä»£ç å®ç°ä¸éš¾çœ‹æ‡‚ï¼Œæˆ‘åªå¼ºè°ƒå…¶ä¸­çš„ä¸€ç‚¹ï¼Œå³MarioStateMachineå’Œå„ä¸ªçŠ¶æ€ç±»ä¹‹é—´æ˜¯åŒå‘ä¾èµ–å…³ç³»ã€‚MarioStateMachineä¾èµ–å„ä¸ªçŠ¶æ€ç±»æ˜¯ç†æ‰€å½“ç„¶çš„ï¼Œä½†æ˜¯ï¼Œåè¿‡æ¥ï¼Œå„ä¸ªçŠ¶æ€ç±»ä¸ºä»€ä¹ˆè¦ä¾èµ–MarioStateMachineå‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºï¼Œå„ä¸ªçŠ¶æ€ç±»éœ€è¦æ›´æ–°MarioStateMachineä¸­çš„ä¸¤ä¸ªå˜é‡ï¼Œscoreå’ŒcurrentStateã€‚

å®é™…ä¸Šï¼Œä¸Šé¢çš„ä»£ç è¿˜å¯ä»¥ç»§ç»­ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å°†çŠ¶æ€ç±»è®¾è®¡æˆå•ä¾‹ï¼Œæ¯•ç«ŸçŠ¶æ€ç±»ä¸­ä¸åŒ…å«ä»»ä½•æˆå‘˜å˜é‡ã€‚ä½†æ˜¯ï¼Œå½“å°†çŠ¶æ€ç±»è®¾è®¡æˆå•ä¾‹ä¹‹åï¼Œæˆ‘ä»¬å°±æ— æ³•é€šè¿‡æ„é€ å‡½æ•°æ¥ä¼ é€’MarioStateMachineäº†ï¼Œè€ŒçŠ¶æ€ç±»åˆè¦ä¾èµ–MarioStateMachineï¼Œé‚£è¯¥å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ

å®é™…ä¸Šï¼Œåœ¨[ç¬¬42è®²](https://time.geekbang.org/column/article/194068)å•ä¾‹æ¨¡å¼çš„è®²è§£ä¸­ï¼Œæˆ‘ä»¬æåˆ°è¿‡å‡ ç§è§£å†³æ–¹æ³•ï¼Œä½ å¯ä»¥å›è¿‡å¤´å»å†æŸ¥çœ‹ä¸€ä¸‹ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‡½æ•°å‚æ•°å°†MarioStateMachineä¼ é€’è¿›çŠ¶æ€ç±»ã€‚æ ¹æ®è¿™ä¸ªè®¾è®¡æ€è·¯ï¼Œæˆ‘ä»¬å¯¹ä¸Šé¢çš„ä»£ç è¿›è¡Œé‡æ„ã€‚é‡æ„ä¹‹åçš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

```
public interface IMario {
  State getName();
  void obtainMushRoom(MarioStateMachine stateMachine);
  void obtainCape(MarioStateMachine stateMachine);
  void obtainFireFlower(MarioStateMachine stateMachine);
  void meetMonster(MarioStateMachine stateMachine);
}

public class SmallMario implements IMario {
  private static final SmallMario instance = new SmallMario();
  private SmallMario() {}
  public static SmallMario getInstance() {
    return instance;
  }

  @Override
  public State getName() {
    return State.SMALL;
  }

  @Override
  public void obtainMushRoom(MarioStateMachine stateMachine) {
    stateMachine.setCurrentState(SuperMario.getInstance());
    stateMachine.setScore(stateMachine.getScore() + 100);
  }

  @Override
  public void obtainCape(MarioStateMachine stateMachine) {
    stateMachine.setCurrentState(CapeMario.getInstance());
    stateMachine.setScore(stateMachine.getScore() + 200);
  }

  @Override
  public void obtainFireFlower(MarioStateMachine stateMachine) {
    stateMachine.setCurrentState(FireMario.getInstance());
    stateMachine.setScore(stateMachine.getScore() + 300);
  }

  @Override
  public void meetMonster(MarioStateMachine stateMachine) {
    // do nothing...
  }
}

// çœç•¥SuperMarioã€CapeMarioã€FireMarioç±»...

public class MarioStateMachine {
  private int score;
  private IMario currentState;

  public MarioStateMachine() {
    this.score = 0;
    this.currentState = SmallMario.getInstance();
  }

  public void obtainMushRoom() {
    this.currentState.obtainMushRoom(this);
  }

  public void obtainCape() {
    this.currentState.obtainCape(this);
  }

  public void obtainFireFlower() {
    this.currentState.obtainFireFlower(this);
  }

  public void meetMonster() {
    this.currentState.meetMonster(this);
  }

  public int getScore() {
    return this.score;
  }

  public State getCurrentState() {
    return this.currentState.getName();
  }

  public void setScore(int score) {
    this.score = score;
  }

  public void setCurrentState(IMario currentState) {
    this.currentState = currentState;
  }
}
```

å®é™…ä¸Šï¼Œåƒæ¸¸æˆè¿™ç§æ¯”è¾ƒå¤æ‚çš„çŠ¶æ€æœºï¼ŒåŒ…å«çš„çŠ¶æ€æ¯”è¾ƒå¤šï¼Œæˆ‘ä¼˜å…ˆæ¨èä½¿ç”¨æŸ¥è¡¨æ³•ï¼Œè€ŒçŠ¶æ€æ¨¡å¼ä¼šå¼•å…¥éå¸¸å¤šçš„çŠ¶æ€ç±»ï¼Œä¼šå¯¼è‡´ä»£ç æ¯”è¾ƒéš¾ç»´æŠ¤ã€‚ç›¸åï¼Œåƒç”µå•†ä¸‹å•ã€å¤–å–ä¸‹å•è¿™ç§ç±»å‹çš„çŠ¶æ€æœºï¼Œå®ƒä»¬çš„çŠ¶æ€å¹¶ä¸å¤šï¼ŒçŠ¶æ€è½¬ç§»ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä½†äº‹ä»¶è§¦å‘æ‰§è¡Œçš„åŠ¨ä½œåŒ…å«çš„ä¸šåŠ¡é€»è¾‘å¯èƒ½ä¼šæ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥ï¼Œæ›´åŠ æ¨èä½¿ç”¨çŠ¶æ€æ¨¡å¼æ¥å®ç°ã€‚

## é‡ç‚¹å›é¡¾

å¥½äº†ï¼Œä»Šå¤©çš„å†…å®¹åˆ°æ­¤å°±è®²å®Œäº†ã€‚æˆ‘ä»¬ä¸€å—æ¥æ€»ç»“å›é¡¾ä¸€ä¸‹ï¼Œä½ éœ€è¦é‡ç‚¹æŒæ¡çš„å†…å®¹ã€‚

ä»Šå¤©æˆ‘ä»¬è®²è§£äº†çŠ¶æ€æ¨¡å¼ã€‚è™½ç„¶ç½‘ä¸Šæœ‰å„ç§çŠ¶æ€æ¨¡å¼çš„å®šä¹‰ï¼Œä½†æ˜¯ä½ åªè¦è®°ä½çŠ¶æ€æ¨¡å¼æ˜¯çŠ¶æ€æœºçš„ä¸€ç§å®ç°æ–¹å¼å³å¯ã€‚çŠ¶æ€æœºåˆå«æœ‰é™çŠ¶æ€æœºï¼Œå®ƒæœ‰3ä¸ªéƒ¨åˆ†ç»„æˆï¼šçŠ¶æ€ã€äº‹ä»¶ã€åŠ¨ä½œã€‚å…¶ä¸­ï¼Œäº‹ä»¶ä¹Ÿç§°ä¸ºè½¬ç§»æ¡ä»¶ã€‚äº‹ä»¶è§¦å‘çŠ¶æ€çš„è½¬ç§»åŠåŠ¨ä½œçš„æ‰§è¡Œã€‚ä¸è¿‡ï¼ŒåŠ¨ä½œä¸æ˜¯å¿…é¡»çš„ï¼Œä¹Ÿå¯èƒ½åªè½¬ç§»çŠ¶æ€ï¼Œä¸æ‰§è¡Œä»»ä½•åŠ¨ä½œã€‚

é’ˆå¯¹çŠ¶æ€æœºï¼Œä»Šå¤©æˆ‘ä»¬æ€»ç»“äº†ä¸‰ç§å®ç°æ–¹å¼ã€‚

ç¬¬ä¸€ç§å®ç°æ–¹å¼å«åˆ†æ”¯é€»è¾‘æ³•ã€‚åˆ©ç”¨if-elseæˆ–è€…switch-caseåˆ†æ”¯é€»è¾‘ï¼Œå‚ç…§çŠ¶æ€è½¬ç§»å›¾ï¼Œå°†æ¯ä¸€ä¸ªçŠ¶æ€è½¬ç§»åŸæ¨¡åŸæ ·åœ°ç›´è¯‘æˆä»£ç ã€‚å¯¹äºç®€å•çš„çŠ¶æ€æœºæ¥è¯´ï¼Œè¿™ç§å®ç°æ–¹å¼æœ€ç®€å•ã€æœ€ç›´æ¥ï¼Œæ˜¯é¦–é€‰ã€‚

ç¬¬äºŒç§å®ç°æ–¹å¼å«æŸ¥è¡¨æ³•ã€‚å¯¹äºçŠ¶æ€å¾ˆå¤šã€çŠ¶æ€è½¬ç§»æ¯”è¾ƒå¤æ‚çš„çŠ¶æ€æœºæ¥è¯´ï¼ŒæŸ¥è¡¨æ³•æ¯”è¾ƒåˆé€‚ã€‚é€šè¿‡äºŒç»´æ•°ç»„æ¥è¡¨ç¤ºçŠ¶æ€è½¬ç§»å›¾ï¼Œèƒ½æå¤§åœ°æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

ç¬¬ä¸‰ç§å®ç°æ–¹å¼å«çŠ¶æ€æ¨¡å¼ã€‚å¯¹äºçŠ¶æ€å¹¶ä¸å¤šã€çŠ¶æ€è½¬ç§»ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä½†äº‹ä»¶è§¦å‘æ‰§è¡Œçš„åŠ¨ä½œåŒ…å«çš„ä¸šåŠ¡é€»è¾‘å¯èƒ½æ¯”è¾ƒå¤æ‚çš„çŠ¶æ€æœºæ¥è¯´ï¼Œæˆ‘ä»¬é¦–é€‰è¿™ç§å®ç°æ–¹å¼ã€‚

## è¯¾å ‚è®¨è®º

çŠ¶æ€æ¨¡å¼çš„ä»£ç å®ç°è¿˜å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ï¼ŒçŠ¶æ€æ¥å£ä¸­å®šä¹‰äº†æ‰€æœ‰çš„äº‹ä»¶å‡½æ•°ï¼Œè¿™å°±å¯¼è‡´ï¼Œå³ä¾¿æŸä¸ªçŠ¶æ€ç±»å¹¶ä¸éœ€è¦æ”¯æŒå…¶ä¸­çš„æŸä¸ªæˆ–è€…æŸäº›äº‹ä»¶ï¼Œä½†ä¹Ÿè¦å®ç°æ‰€æœ‰çš„äº‹ä»¶å‡½æ•°ã€‚ä¸ä»…å¦‚æ­¤ï¼Œæ·»åŠ ä¸€ä¸ªäº‹ä»¶åˆ°çŠ¶æ€æ¥å£ï¼Œæ‰€æœ‰çš„çŠ¶æ€ç±»éƒ½è¦åšç›¸åº”çš„ä¿®æ”¹ã€‚é’ˆå¯¹è¿™äº›é—®é¢˜ï¼Œä½ æœ‰ä»€ä¹ˆè§£å†³æ–¹æ³•å—ï¼Ÿ

æ¬¢è¿ç•™è¨€å’Œæˆ‘åˆ†äº«ä½ çš„æƒ³æ³•ã€‚å¦‚æœæœ‰æ”¶è·ï¼Œæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ15ï¼‰</strong></div><ul>
<li><span>DFighting</span> ğŸ‘ï¼ˆ30ï¼‰ ğŸ’¬ï¼ˆ5ï¼‰<p>ä¸å¤ªèµåŒè€å¸ˆçš„è¿™ç§æŠ½è±¡æ–¹å¼ï¼ŒçŠ¶æ€æœºä¸­çš„æ¯ä¸ªçŠ¶æ€åº”è¯¥å…·æœ‰äº‹ä»¶ã€è§¦å‘æ¡ä»¶ã€è½¬ç§»ï¼ˆæ–¹æ³•ï¼‰åˆ—è¡¨ï¼Œæ¯ä¸€ä¸ªåº”è¯¥éƒ½å¯ä»¥æŠ½è±¡ä¸ºä¸€ä¸ªæ¥å£æˆ–è€…æ³›å‹ç±»ï¼ŒçŠ¶æ€æœºä½œä¸ºä¸€ä¸ªå•ä¾‹è¿™ä¸ªæ²¡é—®é¢˜ï¼Œä½†æ˜¯çŠ¶æ€æœºåº”è¯¥åªæ˜¯ä½œä¸ºä¸€ä¸ªçŠ¶æ€çš„æ³¨å†Œå·¥å‚ï¼Œé‡Œé¢å…·æœ‰çš„åº”è¯¥æ˜¯å¤šç§çŠ¶æ€ï¼ŒçŠ¶æ€é—´çš„æµè½¬æ‰æ˜¯çŠ¶æ€æœºæœ€é‡è¦çš„åŠŸèƒ½æŠ½è±¡ã€‚scoreæ”¾åœ¨çŠ¶æ€å’ŒçŠ¶æ€æœºä¸­éƒ½ä¸åˆé€‚ï¼Œè¿™åº”è¯¥æ˜¯çŠ¶æ€æœºæ“çºµçš„ä¸€ä¸ªå¯¹è±¡&#47;èµ„æºï¼Œåº”è¯¥å•ç‹¬æŠ½è±¡å‡ºæ¥ï¼Œåœ¨çŠ¶æ€é—´æµè½¬</p>2020-11-21</li><br/><li><span>è¿›å‡»çš„å·¨äºº</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>æ„Ÿè§‰çŠ¶æ€æ¨¡å¼å°±æ˜¯ä¸€ä¸ªç­–ç•¥æ¨¡å¼</p>2020-11-27</li><br/><li><span>åƒé¥­ç¡è§‰æ‰“é…±æ²¹</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆï¼Œåœ¨ä½¿ç”¨çŠ¶æ€æœºçš„æ—¶å€™ï¼Œåˆå§‹çŠ¶æ€åº”è¯¥æ˜¯å¯ä»¥æ”¯æŒåˆå§‹åŒ–çš„å§ã€‚</p>2020-06-20</li><br/><li><span>Geek_78eadb</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>è¯¾åé¢˜ï¼š
1. ä½¿ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼å®ç° Action ç±»ï¼šå³æ ¹æ®ä¸åŒçš„çŠ¶æ€å®ç° ObtainMushRoom ç­‰åŠ¨ä½œç±»ï¼Œæ¯”å¦‚ ObtainMushRoom çš„åˆå§‹åŒ–éœ€è¦ä¼ å…¥ç›®å‰çŠ¶æ€å’Œç›®å‰åˆ†æ•°ï¼Œ ObtainMushRoom å¯ä»¥åˆ©ç”¨çŠ¶æ€æœºçš„æŸ¥è¡¨æ³•è¿›è¡ŒçŠ¶æ€è½¬ç§»å’Œå…¶å®ƒåŠ¨ä½œ
</p>2020-11-28</li><br/><li><span>æ‰“å·¥äºº233å·</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>å¦‚æœä¸€ç§çŠ¶æ€è½¬ç§»å¯¹åº”å¤šç§çŠ¶æ€å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ</p>2020-11-13</li><br/><li><span>æ…•æ«æŠ€æœ¯ç¬”è®°</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<p>æŸ¥è¡¨æ³•åœ¨çŠ¶æ€æ–°å¢çš„æƒ…å†µä¸‹æ€ä¹ˆåšåˆ°ä¸ä¿®æ”¹ä»£ç çš„ï¼Ÿ</p>2020-07-29</li><br/><li><span>pippin</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>æŸ¥è¡¨æ³•çš„è¿™ä¸ªæ•°ç»„æœ‰é—®é¢˜å§ï¼ŒtransitionTable[0][0]åº”è¯¥æ˜¯SMALLå§ã€‚è¿™é‡Œåº”è¯¥æ˜¯å†™é”™äº†å§ã€‚private static final State[][] transitionTable = {
          {SUPER, CAPE, FIRE, SMALL},
          {SUPER, CAPE, FIRE, SMALL},
          {CAPE, CAPE, CAPE, SMALL},
          {FIRE, FIRE, FIRE, SMALL}
  };</p>2020-04-13</li><br/><li><span>å¼ å…ˆç”Ÿä¸¶</span> ğŸ‘ï¼ˆ153ï¼‰ ğŸ’¬ï¼ˆ6ï¼‰<p>å…³äºè¯¾å ‚è®¨è®ºï¼Œå¯ä»¥åœ¨æ¥å£å’Œå®ç°ç±»ä¸­é—´åŠ ä¸€å±‚æŠ½è±¡ç±»è§£å†³æ­¤é—®é¢˜ï¼ŒæŠ½è±¡ç±»å®ç°çŠ¶æ€æ¥å£ï¼ŒçŠ¶æ€ç±»ç»§æ‰¿æŠ½è±¡ç±»ï¼Œåªéœ€è¦é‡å†™éœ€è¦çš„æ–¹æ³•å³å¯</p>2020-03-30</li><br/><li><span>Darren</span> ğŸ‘ï¼ˆ58ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>Javaä¸­Springä¹Ÿæœ‰æœ‰é™çŠ¶æ€æœºçš„æ¡†æ¶ ï¼šhttps:&#47;&#47;github.com&#47;spring-projects&#47;spring-statemachine</p>2020-04-14</li><br/><li><span>ä¸‹é›¨å¤©</span> ğŸ‘ï¼ˆ34ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>è¯¾åé¢˜
æœ€å°æ¥å£åŸåˆ™

å…·ä½“åšæ³•:çŠ¶æ€ç±»åªå…³å¿ƒä¸è‡ªå·±ç›¸å…³çš„æ¥å£ï¼Œå°†çŠ¶æ€æ¥å£ä¸­å®šä¹‰çš„äº‹ä»¶å‡½æ•°æŒ‰äº‹ä»¶åˆ†ç±»ï¼Œæ‹†åˆ†åˆ°ä¸åŒæ¥å£ä¸­ï¼Œé€šè¿‡è¿™äº›æ–°æ¥å£çš„ç»„åˆé‡æ–°å®ç°çŠ¶æ€ç±»å³å¯ï¼</p>2020-03-30</li><br/><li><span>å°æ™å­</span> ğŸ‘ï¼ˆ25ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>è¯¾åæ€è€ƒï¼šè¦è§£å†³è¿™ä¸ªé—®é¢˜å¯ä»¥æœ‰ä¸¤ç§æ–¹å¼1. ç›´æ¥ä½¿ç”¨æŠ½è±¡ç±»æ›¿ä»£æ¥å£ï¼ŒæŠ½è±¡ç±»ä¸­å¯¹æ¯ä¸ªæ—¶é—´æœ‰ä¸ªé»˜è®¤çš„å®ç°ï¼Œæ¯”å¦‚æŠ›å‡ºunimplemented exceptionï¼Œè¿™æ ·å­ç±»è¦ä½¿ç”¨çš„è¯å¿…é¡»è‡ªå·±å®ç°ã€‚2. å°±æ˜¯è¿˜æ˜¯ä½¿ç”¨æ¥å£å®šä¹‰äº‹ä»¶ï¼Œä½†æ˜¯é¢å¤–åˆ›å»ºä¸€ä¸ªæŠ½è±¡ç±»å®ç°è¿™ä¸ªæ¥å£ï¼Œç„¶åå…·ä½“çš„çŠ¶æ€å®ç°ç±»ç»§æ‰¿è¿™ä¸ªæŠ½è±¡ç±»ï¼Œè¿™ç§æ–¹å¼å¥½å¤„åœ¨äºå¯æ‰©å±•æ€§å¼ºï¼Œå¯ä»¥å¤„ç†å°†æ¥æœ‰ä¸ç›¸å…³çš„äº‹ä»¶ç­–ç•¥åŠ å…¥è¿›æ¥çš„æƒ…å†µã€‚</p>2020-03-30</li><br/><li><span>Amon Tin</span> ğŸ‘ï¼ˆ18ï¼‰ ğŸ’¬ï¼ˆ5ï¼‰<p>çŠ¶æ€å’Œäº‹ä»¶éƒ½å¯èƒ½éšéœ€æ±‚å¢åŠ ï¼Œå¯ä»¥åˆ©ç”¨callbackçš„æ–¹å¼ï¼Œå°†è¿™ç±»ç»„åˆé€»è¾‘æ³¨å†Œåˆ°å¯¹åº”çŠ¶æ€ç±»ã€‚ä»£ç å®ç°å¦‚ä¸‹ï¼š
&#47;**
 * äº‹ä»¶æšä¸¾
 *&#47;
public enum Event {
    A,B,C
}

&#47;**
 * äº‹ä»¶å›è°ƒ
 * Created on 2021-06-24
 *&#47;
public interface IEventCallback {

    void onEvent(StateMachine sm);

}

&#47;**
 * çŠ¶æ€æŠ½è±¡ç±»
 *&#47;
public abstract class State {

    protected String name;

    protected Map&lt;Event, IEventCallback&gt; events = new HashMap&lt;&gt;();

    public final void triggerEvent(Event e, StateMachine sm) {
        IEventCallback call = events.get(e);
        if (call != null) {
            call.onEvent(sm);
        }
    }
}

&#47;&#47;S1çŠ¶æ€ç±»
public class S1State extends State {
    private static final S1State instance = new S1State();

    Map&lt;Event, IEventCallback&gt; events = new HashMap&lt;&gt;();

    public static S1State getInstance() {
        return instance;
    }

    &#47;&#47;S1çŠ¶æ€åªå…³å¿ƒAã€Bäº‹ä»¶
    private S1State() {
        name = &quot;S1&quot;;
        events.put(Event.A, sm -&gt; {
            sm.currentState = S2State.getInstance();
            sm.score++;
        });
        events.put(Event.B, sm -&gt; {
            sm.score *= 10;
        });
    }

}

&#47;&#47;S2çŠ¶æ€ç±»
public class S2State extends State {
    private static final S2State instance = new S2State();

    public static S2State getInstance() {
        return instance;
    }

    &#47;&#47;S2çŠ¶æ€åªå…³å¿ƒBã€Cäº‹ä»¶
    private S2State() {
        name = &quot;S2&quot;;
        events.put(Event.B, sm -&gt; {
            sm.score = 0;
        });
        events.put(Event.C, sm -&gt; {
            sm.score--;
            sm.currentState = S1State.getInstance();
        });
    }

}

&#47;**
 * çŠ¶æ€æœºæ ¸å¿ƒç±»ï¼ŒçŠ¶æ€æµè½¬çš„å…¥å£
 *&#47;
public class StateMachine {
    int score;
    State currentState;

    public StateMachine() {
        score = 0;
        currentState = S1State.getInstance();
    }

    public void triggerAB() {
        currentState.triggerEvent(Event.A, this);
        currentState.triggerEvent(Event.B, this);
    }

    public void triggerBC() {
        currentState.triggerEvent(Event.B, this);
        currentState.triggerEvent(Event.C, this);
    }
}

</p>2021-06-24</li><br/><li><span>æå°å››</span> ğŸ‘ï¼ˆ13ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>è®¾è®¡æ¨¡å¼_63:
# ä½œä¸š
ç»„åˆä¼˜äºç»§æ‰¿
- å³ä½¿ä¸éœ€è¦ï¼Œä¹Ÿå¿…é¡»å®ç°æ‰€æœ‰çš„å‡½æ•°
&gt;&gt;&gt; æœ€å°æ¥å£åŸåˆ™ï¼Œæ¯ä¸ªå‡½æ•°æ‹†åˆ†åˆ°å•ç‹¬çš„æ¥å£ä¸­

- æ–°å¢äº‹ä»¶è¦ä¿®æ”¹æ‰€æœ‰çŠ¶æ€å®ç°
&gt;&gt;&gt; è§‚å¯Ÿè€…æ¨¡å¼ï¼Œç”¨æ³¨è§£åŠ¨æ€åœ°æŠŠäº‹ä»¶å‡½æ•°æ³¨å†Œåˆ°è§‚å¯Ÿé˜Ÿåˆ—ä¸­ã€‚

# æ„Ÿæƒ³
çœ‹åˆ°çŠ¶æ€æ¥å£ç±»ä¸­ç›´æ¥ä½¿ç”¨äº†`obtainMushRoom()`è¿™æ ·å…·ä½“çš„äº‹ä»¶å‡½æ•°ï¼Œæ„Ÿè§‰å¾ˆä¸èˆ’æœã€‚å°±åƒç»“å°¾çš„è®¨è®ºï¼Œæ‰€æœ‰çš„çŠ¶æ€ç±»å¿…é¡»å®ç°æ‰€æœ‰äº‹ä»¶å‡½æ•°ï¼Œæ–°å¢ä¸€ç§äº‹ä»¶çŠ¶æ€æ¥å£å’Œå®ç°éƒ½è¦æ”¹ã€‚ã€‚ã€‚</p>2020-03-30</li><br/><li><span>è¿›å‡»çš„å‰ç«¯er</span> ğŸ‘ï¼ˆ12ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>æˆ‘æœ‰ä¸ªå‰ç«¯ç»„ä»¶ï¼Œå¾ˆé€‚åˆè¿™ä¸ªæ¨¡å¼ï¼Œæˆ‘æ­£åœ¨å°è¯•é‡æ„ï¼Œå‘ç°ä»£ç ç¼©å‡é‡å¯èƒ½è¾¾åˆ°50%ä»¥ä¸Šï¼Œè€Œä¸”æ›´å®¹æ˜“ç†è§£</p>2020-04-03</li><br/><li><span>J.D.Chi</span> ğŸ‘ï¼ˆ12ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>Flutteré‡Œå¼•å…¥äº†Blocæ¡†æ¶åï¼Œå°±æ˜¯éå¸¸å…¸å‹çš„çŠ¶æ€æ¨¡å¼ï¼ˆæˆ–æ˜¯æœ‰é™çŠ¶æ€æœºï¼‰ã€‚https:&#47;&#47;bloclibrary.dev&#47;#&#47;coreconcepts</p>2020-03-30</li><br/>
</ul>