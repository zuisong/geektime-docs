ä½ å¥½ï¼Œæˆ‘æ˜¯è½©è„‰åˆƒã€‚

ä¸Šä¸€èŠ‚è¯¾æˆ‘ä»¬è®¾è®¡å¥½ç”¨æˆ·æ¨¡å—çš„éœ€æ±‚åï¼Œå¼€å§‹äº†åç«¯å¼€å‘ã€‚åœ¨åç«¯å¼€å‘ä¸­æˆ‘ä»¬æ˜ç¡®äº†å¼€å‘æµç¨‹çš„å››ä¸ªæ­¥éª¤ï¼Œå…ˆå°†æ¥å£swagggeråŒ–ï¼Œå†å®šä¹‰ç”¨æˆ·æœåŠ¡åè®®ï¼Œæ¥ç€å¼€å‘æ¨¡å—æ¥å£ï¼Œæœ€åå®ç°ç”¨æˆ·æœåŠ¡åè®®ã€‚è€Œä¸”ä¸ŠèŠ‚è¯¾å·²ç»å®Œæˆäº†æ¥å£swaggeråŒ–ï¼Œä»¥åŠç”¨æˆ·æœåŠ¡åè®®è®¾è®¡çš„æ¨¡å‹éƒ¨åˆ†ã€‚

è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°±ç»§ç»­å®Œæˆç”¨æˆ·æœåŠ¡åè®®çš„å®šä¹‰ï¼Œå†å¼€å‘æ¨¡å—æ¥å£å’Œå®ç°ç”¨æˆ·æœåŠ¡åè®®ã€‚

## ç”¨æˆ·æœåŠ¡åè®®

å‰é¢æˆ‘ä»¬è®¾è®¡å¥½äº†ä¸€ä¸ªæ¨¡å‹Useräº†ï¼Œâ€œæ¥å£ä¼˜äºå®ç°â€ï¼Œæ¥è®¾è®¡è¿™ä¸ªæœåŠ¡çš„æ¥å£ï¼Œçœ‹çœ‹è¦æä¾›å“ªäº›èƒ½åŠ›ã€‚

é¦–å…ˆç”¨æˆ·æœåŠ¡ä¸€å®šè¦æä¾›çš„æ˜¯é¢„æ³¨å†Œèƒ½åŠ›ï¼Œæ‰€ä»¥æä¾›äº†ä¸€ä¸ªRegisteræ–¹æ³•ã€‚é¢„æ³¨å†Œä¹‹åï¼Œæˆ‘ä»¬è¿˜è¦æä¾›å‘é€é‚®ä»¶çš„èƒ½åŠ›ï¼Œå†æä¾›ä¸€ä¸ªå‘é€é‚®ä»¶çš„æ¥å£SendRegisterMailã€‚å½“ç„¶æœ€åè¦æä¾›ä¸€ä¸ªç¡®è®¤æ³¨å†Œç”¨æˆ·çš„æ¥å£VerfityRegisterã€‚

åœ¨ç™»å½•è¿™å—ï¼Œç”¨æˆ·æœåŠ¡ä¸€å®šè¦æä¾›ç™»å½•ã€ç™»å‡ºçš„æ¥å£Loginå’ŒLogoutã€‚åŒæ—¶ç”±äºæ‰€æœ‰ä¸šåŠ¡è¯·æ±‚ï¼Œæ¯”å¦‚åˆ›å»ºé—®é¢˜ç­‰é€»è¾‘ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨tokenæ¥è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿè¦æä¾›éªŒè¯ç™»å½•çš„æ¥å£VerifyLoginã€‚

äºæ˜¯æ•´ä½“çš„æ¥å£è®¾è®¡å¦‚ä¸‹ï¼Œè¯¦ç»†ä¿¡æ¯éƒ½å†™åœ¨æ³¨é‡Šä¸­äº†ï¼š

```go
// Service ç”¨æˆ·ç›¸å…³çš„æœåŠ¡
type Service interface {

    // Register æ³¨å†Œç”¨æˆ·,æ³¨æ„è¿™é‡Œåªæ˜¯å°†ç”¨æˆ·æ³¨å†Œ, å¹¶æ²¡æœ‰æ¿€æ´», éœ€è¦è°ƒç”¨
    // å‚æ•°ï¼šuserå¿…å¡«ï¼Œusernameï¼Œpassword, email
    // è¿”å›å€¼ï¼š user å¸¦ä¸Štoken
    Register(ctx context.Context, user *User) (*User, error)
    // SendRegisterMail å‘é€æ³¨å†Œçš„é‚®ä»¶
    // å‚æ•°ï¼šuserå¿…å¡«ï¼š username, password, email, token
    SendRegisterMail(ctx context.Context, user *User) error
    // VerifyRegister æ³¨å†Œç”¨æˆ·ï¼ŒéªŒè¯æ³¨å†Œä¿¡æ¯, è¿”å›éªŒè¯æ˜¯å¦æˆåŠŸ
    VerifyRegister(ctx context.Context, token string) (bool, error)

    // Login ç™»å½•ç›¸å…³ï¼Œä½¿ç”¨ç”¨æˆ·åå¯†ç ç™»å½•ï¼Œè·å–å®ŒæˆUserä¿¡æ¯
    Login(ctx context.Context, user *User) (*User, error)
    // Logout ç™»å‡º
    Logout(ctx context.Context, user *User) error
    // VerifyLogin ç™»å½•éªŒè¯
    VerifyLogin(ctx context.Context, token string) (*User, error)
}
```

è¿™é‡Œä¹Ÿè¯´æ˜ä¸€ä¸‹ï¼Œè¦æŠ½è±¡è®¾è®¡å‡ºä¸€ä¸ªæœåŠ¡æ¨¡å—çš„åè®®ç¡®å®ä¸æ˜¯ä¸€ä»¶å¾ˆç®€å•çš„äº‹æƒ…ï¼Œä¹Ÿä¸ä¸€å®šèƒ½ä¸€æ¬¡æ€§è®¾è®¡å¥½ã€‚

æˆ‘ä»¬è¯´è¿‡ï¼Œ**ä»â€œæœåŠ¡éœ€è¦æä¾›å“ªäº›å¯¹å¤–èƒ½åŠ›â€çš„è§’åº¦æ¥æ€è€ƒï¼Œä¼šæ¯”è¾ƒå®Œå–„**ã€‚æ¯”å¦‚è¿™é‡Œä¸ºä»€ä¹ˆè¦è®¾è®¡ä¸€ä¸ªVerfityLoginèƒ½åŠ›å‘¢ï¼Ÿç³»ç»Ÿå¯¹å¤–æä¾›çš„æ¥å£å¹¶æ²¡æœ‰è¿™ä¸ªæœåŠ¡ï¼Œä½†æ˜¯åœ¨å†…éƒ¨ï¼Œæˆ‘ä»¬æ¯æ¬¡éªŒè¯tokençš„æ—¶å€™ï¼Œä¼šéœ€è¦ç”¨tokenæ¥éªŒè¯å’Œæ¢å–userçš„ã€‚æ‰€ä»¥è¿™ä¸ªæ¥å£çš„è®¾è®¡æ˜¯æœ‰â€œéœ€è¦â€çš„ã€‚

æœåŠ¡åè®®çš„è®¾è®¡ä»éœ€æ±‚å‡ºå‘ï¼Œå½“é‡åˆ°æ–°çš„éœ€æ±‚ï¼Œä¸æ–­è¿­ä»£å°±å¯ä»¥äº†ã€‚

## ç”¨æˆ·æ¨¡å—æ¥å£å®ç°

è®¾è®¡äº†ç”¨æˆ·æœåŠ¡çš„åè®®ï¼Œä¸‹ä¸€æ­¥æˆ‘ä»¬ä¹Ÿä¸æ˜¯æ€¥äºå®ç°å®ƒï¼Œéœ€è¦å…ˆéªŒè¯ä¸‹è¿™äº›æœåŠ¡åè®®æ˜¯å¦èƒ½æ»¡è¶³æˆ‘ä»¬çš„â€œéœ€æ±‚â€ã€‚å¦‚ä½•éªŒè¯å‘¢ï¼Ÿå¯ä»¥ç›´æ¥å¼€å‘ç”¨æˆ·æ¥å£ï¼Œç¡®è®¤æ˜¯å¦æœ‰æœªæ»¡è¶³çš„éœ€æ±‚ã€‚

ä¸Šä¸€èŠ‚è¯¾æ¢³ç†äº†ï¼Œè¦å®ç°å››ä¸ªæ¥å£ï¼š

- app/http/module/user/api\_register.go
- app/http/module/user/api\_verify.go
- app/http/module/user/api\_login.go
- app/http/module/user/api\_logout.go

æˆ‘ä»¬è¿˜æ˜¯æ‹¿å…¶ä¸­æ¯”è¾ƒå¤æ‚çš„æ³¨å†Œæ¥å£api\_register.goåšä¸€ä¸‹è¯´æ˜ï¼Œå…¶ä»–æ¥å£çš„å®ç°æ²¡ä»€ä¹ˆéš¾ç‚¹ï¼Œä½ å¯ä»¥å‚è€ƒGitHubä¸Šçš„ä»£ç ã€‚

æ³¨å†Œæ¥å£æˆ‘ä»¬è¦åšå‡ ä¸ªäº‹æƒ…ï¼Ÿ**é¦–å…ˆéªŒè¯æ¥å£å‚æ•°ï¼Œå…¶æ¬¡è¦è¿›è¡Œé¢„æ³¨å†Œï¼Œç„¶åå‘é€é¢„æ³¨å†Œçš„éªŒè¯é‚®ä»¶ï¼Œæœ€åè¿”å›æˆåŠŸçŠ¶æ€**ã€‚

éªŒè¯æ¥å£å‚æ•°ä¹‹å‰è®²è¿‡ï¼Œä½¿ç”¨å®šä¹‰å¥½çš„ registerParamç»“æ„å’ŒGinå¸¦æœ‰çš„bindingé€»è¾‘å°±å¯ä»¥åšå‚æ•°çš„è·å–å’ŒéªŒè¯äº†ã€‚é¢„æ³¨å†Œçš„é€»è¾‘ï¼Œæ—¢ç„¶å·²ç»å®šä¹‰å¥½äº†ç”¨æˆ·æœåŠ¡çš„é¢„æ³¨å†Œæ¥å£ï¼Œè¿™é‡Œå¯ä»¥ç›´æ¥è°ƒç”¨è¿™ä¸ªæ¥å£Registerã€‚åŒæ ·ï¼Œå‘é€éªŒè¯é‚®ä»¶çš„æ¥å£æˆ‘ä»¬ä¹Ÿå·²ç»åœ¨ç”¨æˆ·æœåŠ¡ä¸­å®šä¹‰å¥½äº†ï¼Œç›´æ¥è°ƒç”¨SendRegisterMailå³å¯ã€‚æœ€ç»ˆï¼Œè¿”å›æˆåŠŸçŠ¶æ€ï¼Œæˆ‘ä»¬ä½¿ç”¨hadeæ¡†æ¶å¯¹Ginæ‰©å±•çš„IStatusOkã€‚

```go
func (api *UserApi) Register(c *gin.Context)  {
   // éªŒè¯å‚æ•°
   userService := c.MustMake(provider.UserKey).(provider.Service)
   logger := c.MustMake(contract.LogKey).(contract.Log)

   param := &registerParam{}
   if err := c.ShouldBind(param); err != nil {
      c.ISetStatus(400).IText("å‚æ•°é”™è¯¯"); return
   }

   // æ³¨å†Œå¯¹è±¡
   model := &provider.User{
      UserName:  param.UserName,
      Password:  param.Password,
      Email: param.Email,
      CreatedAt: time.Now(),
   }
   // æ³¨å†Œ
   userWithToken, err := userService.Register(c, model)
   if err != nil {
      logger.Error(c, err.Error(), map[string]interface{}{
         "stack": fmt.Sprintf("%+v", err),
      })
      c.ISetStatus(500).IText(err.Error()); return
   }
   if userWithToken == nil {
      c.ISetStatus(500).IText("æ³¨å†Œå¤±è´¥"); return
   }

   if err := userService.SendRegisterMail(c, userWithToken); err != nil {

      c.ISetStatus(500).IText("å‘é€ç”µå­é‚®ä»¶å¤±è´¥"); return
   }

   c.ISetOkStatus().IText("æ³¨å†ŒæˆåŠŸï¼Œè¯·å‰å¾€é‚®ç®±æŸ¥çœ‹é‚®ä»¶"); return
}

```

è¿™é‡Œä½¿ç”¨äº†ä¹‹å‰æˆ‘ä»¬å¯¹Ginæ¡†æ¶æ‰©å±•å®šä¹‰çš„Responseç»“æ„ä¸­çš„é“¾å¼æ–¹æ³•ï¼š

```go
c.ISetOkStatus().IText("æ³¨å†ŒæˆåŠŸï¼Œè¯·å‰å¾€é‚®ç®±æŸ¥çœ‹é‚®ä»¶");
```

å¾ˆæ˜æ˜¾ï¼Œè¿™ç§æ–¹æ³•ç¡®å®æ¯”Ginæ¡†æ¶è‡ªå¸¦çš„Responseæ–¹æ³•æ›´ä¸ºä¼˜é›…è½»ä¾¿äº†ã€‚

å®ç°å¥½Registeræ¥å£ï¼Œæˆ‘ä»¬åŸºæœ¬ç¡®è®¤äº†ä¹‹å‰è®¾è®¡çš„ç”¨æˆ·æœåŠ¡ä¸­æ³¨å†Œéƒ¨åˆ†æ˜¯æ»¡è¶³éœ€æ±‚çš„ã€‚å†ä¸€ä¸ªä¸ªæ¥å£ Verify/Login/Logout éƒ½å®ç°ä¸€ä¸‹ï¼ŒåŸºæœ¬èƒ½ç¡®å®šä¹‹å‰ç”¨æˆ·æœåŠ¡çš„è®¾è®¡æ˜¯å¯ä»¥çš„ã€‚

## å¼€å‘æ¨¡å—æ¥å£

æ—¢ç„¶æˆ‘ä»¬å·²ç»ç¡®å®šäº†ç”¨æˆ·æœåŠ¡è®¾è®¡å¯è¡Œï¼Œè¿›å…¥æœ€åä¸€æ­¥ï¼Œå®ç°è¿™äº›ç”¨æˆ·æœåŠ¡å®šä¹‰çš„åè®®æ–¹æ³•ã€‚åœ¨å®ç°ä¸­ï¼Œä½ èƒ½çœ‹åˆ°å¾ˆå¤šä¹‹å‰å®šä¹‰çš„å„ç§æœåŠ¡çš„å…·ä½“ä½¿ç”¨ã€‚ç”¨æˆ·æ³¨å†Œçš„ä¸‰ä¸ªç›¸å…³åè®®æ¥å£çš„å®ç°ï¼Œæˆ‘ä»¬è¯¦ç»†è¯´ä¸€ä¸‹ï¼Œå…¶ä»–ç™»å½•ç›¸å…³çš„æ¥å£åè®®ï¼Œä½ å¯ä»¥å‚è€ƒGitHubä¸Šçš„ä»£ç ã€‚

### é¢„æ³¨å†Œåè®®æ¥å£

```go
// Register æ³¨å†Œç”¨æˆ·,æ³¨æ„è¿™é‡Œåªæ˜¯å°†ç”¨æˆ·æ³¨å†Œ, å¹¶æ²¡æœ‰æ¿€æ´», éœ€è¦è°ƒç”¨
// å‚æ•°ï¼šuserå¿…å¡«ï¼Œusernameï¼Œpassword, email
// è¿”å›å€¼ï¼š user å¸¦ä¸Štoken
Register(ctx context.Context, user *User) (*User, error)
```

é¢„æ³¨å†Œåè®®æ¥å£çš„å…·ä½“å®ç°è¦åšå‡ ä¸ªäº‹æƒ…ï¼š

1. å»æ•°æ®åº“åˆ¤æ–­é‚®ç®±æ˜¯å¦å·²ç»æ³¨å†Œç”¨æˆ·äº†ï¼Œå¦‚æœé‚®ç®±å·²ç»æ³¨å†Œï¼Œé‚£ä¹ˆè¿™ä¸ªé¢„æ³¨å†Œæ“ä½œæ˜¯ä¸èƒ½æ‰§è¡Œçš„ï¼›
2. å»æ•°æ®åº“åˆ¤æ–­ç”¨æˆ·åæ˜¯å¦å·²ç»è¢«æ³¨å†Œäº†ï¼Œå¦‚æœç”¨æˆ·åå·²ç»è¢«æ³¨å†Œäº†ï¼Œé‚£ä¹ˆé¢„æ³¨å†Œæ“ä½œä¹Ÿæ˜¯ä¸èƒ½æ‰§è¡Œçš„ï¼›
3. ç”Ÿæˆé¢„æ³¨å†Œçš„éªŒè¯tokenï¼›
4. å°†è¦æ³¨å†Œçš„ç”¨æˆ·å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œå­˜å‚¨1å¤©ï¼Œå¾…ç”¨æˆ·æ³¨å†ŒéªŒè¯ã€‚

æˆ‘ä»¬æ³¨æ„åˆ°å››æ­¥æ“ä½œé‡Œ**å‰é¢ä¸¤æ­¥æ˜¯å»æ•°æ®åº“çš„æŸ¥è¯¢æ“ä½œï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨hadeæ¡†æ¶çš„ORMæœåŠ¡**ï¼Œå…ˆä»å®¹å™¨ä¸­è·å–ORMæœåŠ¡ï¼Œä½¿ç”¨GetDBè·å–gorm.DBï¼Œæ¥ç€å°±å¯ä»¥ä½¿ç”¨gormçš„Whereã€First ç­‰æ–¹æ³•äº†ã€‚ç”±äºä¹‹å‰å·²ç»å®šä¹‰å¥½äº†Userç»“æ„ä½œä¸ºæ•°æ®åº“æ¨¡å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥ä½¿ç”¨è¿™ä¸ªæ¨¡å‹ï¼š

```go
// åˆ¤æ–­é‚®ç®±æ˜¯å¦å·²ç»æ³¨å†Œäº†
ormService := u.container.MustMake(contract.ORMKey).(contract.ORMService)
db, err := ormService.GetDB()
if err != nil {
   return nil, err
}
userDB := &User{}
if db.Where(&User{Email: user.Email}).First(userDB).Error != gorm.ErrRecordNotFound {
   return nil, errors.New("é‚®ç®±å·²æ³¨å†Œç”¨æˆ·ï¼Œä¸èƒ½é‡å¤æ³¨å†Œ")
}
if db.Where(&User{UserName: user.UserName}).First(userDB).Error != gorm.ErrRecordNotFound {
   return nil, errors.New("ç”¨æˆ·åå·²ç»è¢«æ³¨å†Œï¼Œè¯·æ¢ä¸€ä¸ªç”¨æˆ·å")
}
```

è€Œç¬¬ä¸‰æ­¥ç”Ÿæˆtokenï¼Œå°±ä½¿ç”¨ä¸€ä¸ªç®€å•çš„éšæœºç”Ÿæˆtokençš„ç®—æ³•ï¼Œç›´æ¥å»ä¸€æ’å­—ç¬¦ä¸²ä¸­éšæœºè·å–ä¸‹æ ‡æ¥ç”Ÿæˆtokenã€‚

```go
const letterBytes = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"

func genToken(n int) string {
   b := make([]byte, n)
   for i := range b {
      // è¿™é‡Œæ˜¯éšæœºè·å–çš„
      b[i] = letterBytes[rand.Intn(len(letterBytes))]
   }
   return string(b)
}
```

æœ€åä¸€æ­¥ï¼Œéœ€è¦å°†Userå¯¹è±¡å­˜å‚¨åˆ°ç¼“å­˜ä¸­ã€‚æˆ‘ä»¬ä½¿ç”¨keyä¸º"user:register:\[token]"æ¥å­˜å‚¨Userå¯¹è±¡ã€‚

```go
// å°†è¯·æ±‚æ³¨å†Œè¿›å…¥redisï¼Œä¿å­˜ä¸€å¤©
cacheService := u.container.MustMake(contract.CacheKey).(contract.CacheService)

key := fmt.Sprintf("user:register:%v", user.Token)
if err := cacheService.SetObj(ctx, key, user, 24*time.Hour); err != nil {
   return nil, err
}
return user, nil
```

ä½†æ˜¯ä½ è¿˜è®°å¾—å—ï¼Œ**åœ¨hadeçš„CacheæœåŠ¡ä¸­ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨SetObjå’ŒGetObjæ“ä½œå¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å¿…é¡»å®ç°BinaryMarshalerå’ŒBinaryUnMarshaler**ã€‚æ‰€ä»¥æˆ‘ä»¬å†ç»™Userå¯¹è±¡å®ç°è¿™ä¸¤ä¸ªæ¥å£ã€‚åœ¨app/provider/user/service.goä¸­ï¼š

```go
// MarshalBinary å®ç°BinaryMarshaler æ¥å£
func (b *User) MarshalBinary() ([]byte, error) {
   return json.Marshal(b)
}

// UnmarshalBinary å®ç° BinaryUnMarshaler æ¥å£
func (b *User) UnmarshalBinary(bt []byte) error {
   return json.Unmarshal(bt, b)
}
```

äºæ˜¯ï¼Œç”¨æˆ·æœåŠ¡çš„Registeræ–¹æ³•å®ç°å°±å†™å¥½äº†ã€‚åœ¨è¿™ä¸ªå°å°çš„æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å·²ç»æ¼”ç¤ºäº†ä¹‹å‰å®šä¹‰çš„ORMæœåŠ¡ã€CacheæœåŠ¡ï¼Œæ‰€æœ‰çš„è¿™äº›æœåŠ¡åœ¨æœåŠ¡å®¹å™¨ä¸­éƒ½å¯ä»¥å¾—åˆ°ã€‚ä½ å¯ä»¥å…·ä½“æ„Ÿå—ä¸€ä¸‹ï¼Œå®¹å™¨åŠ æœåŠ¡åè®®åœ¨å…·ä½“çš„ä¸šåŠ¡ä»£ç ä¸­å¸¦æ¥çš„ä¾¿åˆ©ã€‚

### å‘é€é‚®ä»¶åè®®æ¥å£

```go
// SendRegisterMail å‘é€æ³¨å†Œçš„é‚®ä»¶
// å‚æ•°ï¼šuserå¿…å¡«ï¼š username, password, email, token
SendRegisterMail(ctx context.Context, user *User) error
```

å‘é€é‚®ä»¶åè®®æ¥å£è¦å®ç°çš„å°±æ˜¯ä¸€ä¸ªé‚®ä»¶å‘é€çš„åŠŸèƒ½ã€‚åœ¨Golangä¸­é‚®ä»¶å‘é€åŠŸèƒ½ä¹Ÿæ˜¯æœ‰ç°æˆåº“çš„ï¼Œ[gomail](https://github.com/go-gomail/gomail)ã€‚è¿™ä¸ªåº“ç›®å‰å·²ç»æœ‰3.4k staräº†ï¼ŒåŸºäºé™åˆ¶æ¯”è¾ƒå°‘çš„MITåè®®ã€‚

å‘é€ç”µå­é‚®ä»¶çš„æ–¹å¼å…¶å®æœ‰å¾ˆå¤šç§ï¼Œä½†æ˜¯æˆ‘ä»¬æœ€å¥½ä½¿ç”¨SMTPçš„æ–¹å¼æ¥å‘é€é‚®ä»¶ï¼Œå› ä¸ºSMTPçš„æœåŠ¡æä¾›æ–¹ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨äº’è”ç½‘ä¸Šå·²ç»è®¤è¯çš„æœåŠ¡æä¾›å•†ï¼Œæ¯”å¦‚Gmailã€126ç­‰ã€‚é€šè¿‡è¿™äº›é‚®ä»¶æœåŠ¡æä¾›å•†æ³¨å†Œçš„SMTPè´¦å·å‘é€é‚®ä»¶ï¼ŒåŸºæœ¬ä¸Šä¸ä¼šè¿›å…¥å¯¹æ–¹é‚®ç®±çš„â€œåƒåœ¾ç®±â€ä¸­ã€‚

ä¸è¿‡æ‰€æœ‰é‚®ä»¶æœåŠ¡æä¾›å•†çš„SMTPè´¦å·éƒ½éœ€è¦å•ç‹¬ç”³è¯·ï¼Œä½†æ˜¯åŸºæœ¬éƒ½æ˜¯å…è´¹çš„ã€‚è¿™é‡Œæ˜¯æˆ‘ä½¿ç”¨126æ³¨å†Œçš„é‚®ç®±ç”³è¯·äº†ä¸€ä¸ª126çš„SMTPå‘é€è´¦å·ã€‚

æˆ‘ä»¬æŠŠSMTPçš„è´¦å·ä¿¡æ¯å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶config/development/app.yamlä¸­ï¼š

```yaml
domain: "http://hadecast.funaio.cn"

smtp:
    host: "smtp.126.com"
    port: 25
    from: "jianfengye110@126.com"
    username: "jianfengye110"
    password: "123456"
```

ä¸‹é¢æ¥æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨gomailæ¥é€šè¿‡SMTPè´¦å·å‘é€é‚®ä»¶ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹app/provider/user/service.go çš„å…·ä½“å®ç°ï¼š

```go
func (u *UserService) SendRegisterMail(ctx context.Context, user *User) error {
   logger := u.container.MustMake(contract.LogKey).(contract.Log)
   configer := u.container.MustMake(contract.ConfigKey).(contract.Config)

   // é…ç½®æœåŠ¡ä¸­è·å–å‘é€é‚®ä»¶éœ€è¦çš„å‚æ•°
   host := configer.GetString("app.smtp.host")
   port := configer.GetInt("app.smtp.port")
   username := configer.GetString("app.smtp.username")
   password := configer.GetString("app.smtp.password")
   from := configer.GetString("app.smtp.from")
   domain := configer.GetString("app.domain")

   // å®ä¾‹åŒ–gomail
   d := gomail.NewDialer(host, port, username, password)

   // ç»„è£…message
   m := gomail.NewMessage()
   m.SetHeader("From", from)
   m.SetAddressHeader("To", user.Email, user.UserName)
   m.SetHeader("Subject", "æ„Ÿè°¢æ‚¨æ³¨å†Œæˆ‘ä»¬çš„hadecast")
   link := fmt.Sprintf("%v/user/register/verify?token=%v", domain, user.Token)
   m.SetBody("text/html", fmt.Sprintf("è¯·ç‚¹å‡»ä¸‹é¢çš„é“¾æ¥å®Œæˆæ³¨å†Œï¼š%s", link))

   // å‘é€ç”µå­é‚®ä»¶
   if err := d.DialAndSend(m); err != nil {
      logger.Error(ctx, "send email error", map[string]interface{}{
         "err":     err,
         "message": m,
      })
      return err
   }
   return nil
}
```

é¦–å…ˆé€šè¿‡hadeçš„é…ç½®æœåŠ¡æ¥è·å–SMTPçš„æ‰€æœ‰é…ç½®ï¼Œä½¿ç”¨è¿™äº›é…ç½®å®ä¾‹åŒ–ä¸€ä¸ªgomail.Dialerå¯¹è±¡ï¼›ç„¶ååˆ›å»ºé‚®ä»¶çš„å†…å®¹ï¼Œå†…å®¹çš„Fromå’ŒToåˆ†åˆ«ä»£è¡¨å‘é€æ–¹å’Œæ¥æ”¶æ–¹ï¼Œæ¥æ”¶æ–¹è‡ªç„¶å°±æ˜¯æˆ‘ä»¬çš„é¢„æ³¨å†Œç”¨æˆ·å¡«å†™çš„é‚®ç®±ã€‚å°†é“¾æ¥æ”¾åœ¨é‚®ä»¶çš„Bodyé‡Œé¢ã€‚ç»„è£…å¥½é‚®ä»¶å†…å®¹ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨DailAndSend å°±å¯ä»¥ç›´æ¥å‘é€ä¸€ä¸ªé‚®ä»¶åˆ°é¢„æ³¨å†Œçš„ç”¨æˆ·çš„é‚®ç®±äº†ã€‚

åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ**æˆ‘ä»¬ä¼šå¸Œæœ›å¦‚æœå‘é€é‚®ç®±å¤±è´¥çš„è¯ï¼Œä½¿ç”¨æ—¥å¿—è®°å½•ä¸€ä¸‹å‘é€å¤±è´¥çš„åŸå› å’Œå†…å®¹**ã€‚è¿™ä¸ªæ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œå› ä¸ºåç»­å¦‚æœå¸Œæœ›æœ‰ä¸€äº›è„šæœ¬èƒ½è¡¥å‘é‚®ä»¶ï¼Œè¿™ä¸ªæ—¥å¿—å°±å¾ˆæœ‰å¸®åŠ©äº†ã€‚æ‰€ä»¥ä½¿ç”¨hadeå®šä¹‰çš„æ—¥å¿—æœåŠ¡ï¼Œè¿™é‡Œä½¿ç”¨æ—¥å¿—æœåŠ¡çš„Erroræ–¹æ³•æ¥è®°å½•å‘é€é‚®ä»¶é”™è¯¯ä¿¡æ¯ã€‚

ä¸ç®¡é…ç½®æœåŠ¡è¿˜æ˜¯æ—¥å¿—æœåŠ¡ï¼Œéƒ½æ˜¯ä»æœåŠ¡å®¹å™¨ä¸­å¯ä»¥è·å–åˆ°ã€‚æŒ‰ç…§ä¸Šè¿°é€»è¾‘ï¼Œå‘é€é‚®ä»¶çš„æ¥å£å°±å®Œæˆäº†ã€‚

### æ³¨å†ŒéªŒè¯åè®®æ¥å£

æ³¨å†Œç›¸å…³çš„æœ€åä¸€ä¸ªåè®®æ¥å£æ˜¯éªŒè¯æ³¨å†Œã€‚

```go
// VerifyRegister æ³¨å†Œç”¨æˆ·ï¼ŒéªŒè¯æ³¨å†Œä¿¡æ¯, è¿”å›éªŒè¯æ˜¯å¦æˆåŠŸ
VerifyRegister(ctx context.Context, token string) (bool, error)
```

è¿™ä¸ªåè®®æ¥å£é€»è¾‘ä¼šå¤æ‚ä¸€äº›äº†ã€‚

å®ƒçš„å‚æ•°ä¸ºä¸€ä¸ªtokenï¼Œæˆ‘ä»¬é¦–å…ˆè¦æ‹¿ç€è¿™ä¸ªtokenå»ç¼“å­˜ä¸­ï¼Œè·å–åˆ°è¿™ä¸ªtokenå¯¹åº”çš„é¢„æ³¨å†Œç”¨æˆ·ã€‚ç”±äºä¹‹å‰å·²ç»å°†Userå®ç°äº†BinaryUnmarshaleræ¥å£ï¼Œè¿™é‡Œå°±ä½¿ç”¨ç¼“å­˜æœåŠ¡çš„GetObjæ–¹æ³•ï¼š

```go
//éªŒè¯token
cacheService := u.container.MustMake(contract.CacheKey).(contract.CacheService)
key := fmt.Sprintf("user:register:%v", token)
user := &User{}
if err := cacheService.GetObj(ctx, key, user); err != nil {
   return false, err
}
if user.Token != token {
   return false, nil
}
```

ç„¶åä¸‹ä¸€æ­¥ï¼Œ**ç”±äºé¢„æ³¨å†Œå’Œæ³¨å†ŒéªŒè¯è¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ï¼Œä¸­é—´æ•°æ®åº“æ˜¯æœ‰å¯èƒ½å‘ç”Ÿå˜åŒ–çš„**ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å†æ¬¡éªŒè¯ä¸€ä¸‹è¿™ä¸ªç”¨æˆ·åœ¨æ•°æ®åº“ä¸­æ˜¯å¦å·²ç»å­˜åœ¨äº†ï¼Œä»–çš„ç”¨æˆ·åå’Œé‚®ç®±æ˜¯å¦æ˜¯å”¯ä¸€çš„ã€‚

```go
//éªŒè¯é‚®ç®±ï¼Œç”¨æˆ·åçš„å”¯ä¸€
ormService := u.container.MustMake(contract.ORMKey).(contract.ORMService)
db, err := ormService.GetDB()
if err != nil {
   return false, err
}
userDB := &User{}
if db.Where(&User{Email: user.Email}).First(userDB).Error != gorm.ErrRecordNotFound {
   return false, errors.New("é‚®ç®±å·²æ³¨å†Œç”¨æˆ·ï¼Œä¸èƒ½é‡å¤æ³¨å†Œ")
}
if db.Where(&User{UserName: user.UserName}).First(userDB).Error != gorm.ErrRecordNotFound {
   return false, errors.New("ç”¨æˆ·åå·²ç»è¢«æ³¨å†Œï¼Œè¯·æ¢ä¸€ä¸ªç”¨æˆ·å")
}
```

æœ€åå‡†å¤‡å°†è¿™ä¸ªç¼“å­˜ä¸­çš„ç”¨æˆ·å­˜å‚¨è¿›å…¥æ•°æ®åº“usersè¡¨ã€‚è¿™é‡Œæˆ‘ä»¬çŸ¥é“ï¼Œç¼“å­˜ä¸­é¢„æ³¨å†Œç”¨æˆ·çš„å¯†ç æ˜¯ç”¨æˆ·å¡«å†™çš„çœŸå®å¯†ç ã€‚ä½†æ˜¯å°†çœŸå®å¯†ç ç›´æ¥å­˜å‚¨è¿›å…¥æ•°æ®åº“ï¼Œæ˜¯ä¸€ä¸ªéå¸¸ä¸å®‰å…¨çš„åšæ³•ã€‚å¦‚æœæˆ‘ä»¬çš„æ•°æ®åº“è¢«é»‘å®¢æ”»å‡»æ‹–åº“äº†ï¼Œè¿™å¯¹æˆ‘ä»¬çš„ç½‘ç«™ç”¨æˆ·æ˜¯ä¸ªéå¸¸å¤§çš„å½±å“ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬**æœ‰å¿…è¦å¯¹ç”¨æˆ·çš„å¯†ç åšä¸€æ¬¡åŠ å¯†æ“ä½œ**ã€‚

Golangçš„ [golang.org/x/crypto/bcrypt](https://pkg.go.dev/golang.org/x/crypto/bcrypt) åº“æä¾›äº†å¯¹å¯†ç è¿›è¡ŒåŠ å¯†çš„æ ‡å‡†æ–¹æ³•ã€‚è¿˜è®°å¾—è¿™ç§golang.org/x/ å¼€å¤´çš„åº“ä¹ˆï¼Œå¯ä»¥è¯´æ˜¯Golangæ ‡å‡†åº“çš„é¢„å¤‡åº“ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ”¾å¿ƒä½¿ç”¨ã€‚åœ¨è¿™ä¸ªåº“ä¸­ï¼Œæä¾›äº†åŠ å¯†å¯†ç çš„æ–¹æ³• GenerateFromPassword å’ŒéªŒè¯å¯†ç çš„æ–¹æ³• CompareHashAndPassword ã€‚

åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨åˆ°åŠ å¯†å¯†ç çš„æ–¹æ³•ï¼š

```go
// éªŒè¯æˆåŠŸå°†å¯†ç å­˜å‚¨æ•°æ®åº“ä¹‹å‰éœ€è¦åŠ å¯†ï¼Œä¸èƒ½åŸæ–‡å­˜å‚¨è¿›å…¥æ•°æ®åº“
hash, err := bcrypt.GenerateFromPassword([]byte(user.Password), bcrypt.MinCost)
if err != nil {
   return false, err
}
```

GenerateFromPassword çš„ç¬¬äºŒä¸ªå‚æ•°costï¼Œæ˜¯è¡¨ç¤ºåŠ å¯†å¯†ç çš„å¤æ‚åº¦ï¼Œæœ€å°å¿…é¡»ä¸ºMinCostã€‚

æœ€åä¸€æ­¥ï¼Œå°±æ˜¯å°†ç”¨æˆ·å­˜å‚¨åˆ°æ•°æ®åº“ä¸­äº†ã€‚åŒæ ·ä½¿ç”¨çš„æ˜¯Gormï¼Œå…¶ä¸­æœ‰ä¸ªCreateæ–¹æ³•ï¼Œèƒ½å°†å¯¹è±¡ä¿å­˜è¿›å…¥æ•°æ®åº“ï¼š

```go
user.Password = string(hash)

// å…·ä½“åœ¨æ•°æ®åº“åˆ›å»ºç”¨æˆ·
if err := db.Create(user).Error; err != nil {
   return false, err
}
return true, nil
```

ä»¥ä¸Šï¼Œå°±å®Œæˆäº†æ³¨å†Œå®ç°çš„å…·ä½“æ–¹æ³•äº†ã€‚

## åç«¯è°ƒè¯•

ç°åœ¨ï¼Œæ±‡æ€»ä¸¤èŠ‚è¯¾çš„æˆæœï¼Œæˆ‘ä»¬å®Œæˆäº†ç”¨æˆ·æœåŠ¡ã€ç”¨æˆ·æ¨¡å—æ¥å£ä»¥åŠswaggerçš„æ­å»ºã€‚ä¹‹åå°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä½¿ç”¨swaggeræ¥è°ƒè¯•ç”¨æˆ·æ¨¡å—å’Œç”¨æˆ·æœåŠ¡äº†ã€‚

è®°å¾—å¼€å¯hadeç‰¹æœ‰çš„è°ƒè¯•æ¨¡å¼ï¼š `./bbs dev backend`

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/85/c6/8560931d5c87e56860fa87ca1e1b28c6.png?wh=1084x336)

æ‰“å¼€æµè§ˆå™¨ [http://localhost:8070/swagger/index.html](http://localhost:8070/swagger/index.html) çœ‹åˆ°swagger-UIç•Œé¢ã€‚ç‚¹å‡»è¦è°ƒè¯•æ¥å£çš„ â€œtry it outâ€ æŒ‰é’®è¿›å…¥æ¥å£è°ƒç”¨ï¼Œå¡«å†™è¦è°ƒç”¨çš„æ¥å£å‚æ•°ï¼Œç‚¹å‡»â€œExecuteâ€ è°ƒç”¨æ¥å£ï¼Œå¹¶ä¸”è·å–æ¥å£è¿”å›å€¼ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/76/aa/765346a7f820dbfc8fa61408faffceaa.png?wh=1920x1111)

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/2c/25/2cf2bb0168135e98f02fb84016590a25.png?wh=1920x1068)

å¦‚æœæ¥å£è°ƒç”¨é”™è¯¯ï¼Œæˆ‘ä»¬è¦ä¿®æ”¹æ¥å£ï¼Œåªéœ€è¦ç›´æ¥åœ¨IDEä¸Šä¿®æ”¹ä»£ç ï¼Œå¹¶ä¸”ç›´æ¥ä¿å­˜ï¼Œhadeå°±ä¼šæ£€æµ‹åˆ°æ–‡ä»¶æ›´æ–°ï¼Œå¹¶ä¸”é‡æ–°ç¼–è¯‘é‡å¯æœåŠ¡ï¼Œç«‹åˆ»ç”Ÿæ•ˆã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/9f/b1/9fa0d12a5548781869fd52041e080ab1.png?wh=1078x674)

## å‰ç«¯å¼€å‘

å…³äºç”¨æˆ·æ¥å£çš„å‰ç«¯å¼€å‘éƒ¨åˆ†ï¼Œç”±äºå¹¶ä¸æ˜¯æˆ‘ä»¬è¯¾ç¨‹çš„é‡ç‚¹ï¼Œå°±ç®€è¦æè¿°ä¸€ä¸‹å…³é”®å®ç°ç‚¹ã€‚

å‰ç«¯ä¸€å…±å°±ä¸¤ä¸ªé¡µé¢ï¼Œæ³¨å†Œé¡µé¢å’Œç™»å½•é¡µé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨src/views/ä¸­åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼Œregisterå’Œloginï¼Œåˆ†åˆ«å­˜å‚¨è¿™ä¸¤ä¸ªé¡µé¢ã€‚è¿™é‡Œæˆ‘ä¸»è¦ä¹Ÿæè¿°ä¸€ä¸‹æ³¨å†Œé¡µé¢çš„å…·ä½“å®ç°ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/26/08/2669c8cdbbfd66df207e8b97f06ba508.png?wh=788x848)

åœ¨æ³¨å†Œé¡µé¢ä¸Šï¼Œå®é™…ä¸Šæ˜¯æ­å»ºäº†ä¸€ä¸ªè¡¨å•ï¼Œåœ¨element-UIä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨el-formæ¥æ–¹ä¾¿æ­å»ºä¸€ä¸ªæ¼‚äº®çš„è¡¨å•ï¼Œ è¿™ä¸ªè¡¨å•åŒ…å«ç”¨æˆ·åã€é‚®ç®±ã€å¯†ç ç­‰ä¿¡æ¯ï¼Œå¹¶ä¸”è¿™äº›ä¿¡æ¯éƒ½å¯¹åº”scriptä¸­çš„formæ•°æ®ã€‚åœ¨è¡¨å•çš„æŒ‰é’®ï¼ŒæŒ‰é’®ç‚¹å‡»è¡Œä¸ºæˆ‘ä»¬è®¾ç½®æˆè§¦å‘submitFromæ–¹æ³•ã€‚åœ¨src/views/register/index.vueä¸­ï¼š

```plain
<el-form v-model="form" class="register-form">
  <el-form-item >
    <el-input v-model="form.username" placeholder="ç”¨æˆ·å" ></el-input>
  </el-form-item>
  <el-form-item >
    <el-input v-model="form.email" placeholder="é‚®ç®±"></el-input>
  </el-form-item>
  <el-form-item >
    <el-input
        placeholder="å¯†ç "
        type="password"
        v-model="form.password"
    ></el-input>
  </el-form-item>
  <el-form-item >
    <el-input
        placeholder="ç¡®è®¤å¯†ç "
        type="password"
        v-model="form.repassword"
    ></el-input>
  </el-form-item>
  <el-form-item>
    <el-button
        :loading="loading"
        class="login-button"
        type="primary"
        native-type="submit"
        @click="submitForm"
        block
    >æ³¨å†Œ</el-button>
  </el-form-item>
</el-form>
```

```plain
<script>
export default {
  name: "register",
  data() {
    return {
      form: {
        username: '', // ç”¨æˆ·å
        password: '', // å¯†ç 
        email: '', // é‚®ç®±
        repassword: '' // é‡å¤è¾“å…¥å¯†ç 
      },
      loading: false,
    };
  },
```

å¯¹åº”çš„submitFromæ–¹æ³•ï¼Œå°±è°ƒç”¨ç¬¬30èŠ‚è¯¾ä»‹ç»çš„å°è£…äº†axiosåº“çš„request.jsã€‚æˆ‘ä»¬ä½¿ç”¨requestï¼Œå¹¶ä¸”ä¼ é€’ä¸Šé¢è¾“å…¥çš„formå¯¹è±¡æ•°æ®ç»™åç«¯ï¼Œå¦‚æœè¯·æ±‚è¿”å›æˆåŠŸï¼Œå°±è¿”å›è¿”å›ä½“ä¸­çš„æˆåŠŸä¿¡æ¯ã€‚

```plain
methods: {
  submitForm: function(e) {
    if (this.form.repassword !== this.form.password) {
      this.$message.error("ä¸¤æ¬¡è¾“å…¥å¯†ç ä¸ä¸€è‡´");
      return;
    }
    const that = this;
    request({
      url: '/user/register',
      method: 'post',
      data: this.form
    }).then(function (response) {
      const msg = response.data
      that.$message.success(msg);
    })
  }
}
```

æ³¨å†Œç•Œé¢çš„å¼€å‘å°±å®Œæˆäº†ï¼Œè™½ç„¶é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œä½†ä¹Ÿæ˜¯ä½¿ç”¨äº†å‰é¢ä»‹ç»çš„å‡ ä¸ªå‰ç«¯ç»„ä»¶vueã€element-Uiã€axiosï¼Œæ‰€ä»¥å¦‚æœä½ çœ‹æºç ï¼Œå¯¹è¿™å‡ ä¸ªç»„ä»¶çš„ä½¿ç”¨æœ‰ä¸€äº›ç–‘æƒ‘çš„è¯ï¼Œè¿˜æ˜¯è¦ç ”ç©¶ä¸€ä¸‹æ¯ä¸€ä¸ªå‰ç«¯ç»„ä»¶ã€‚

å†™å®Œå‰ç«¯ä¹‹åï¼Œåˆ«å¿˜è®°æˆ‘ä»¬çš„hadeæ¨¡å—çš„å¼ºå¤§è°ƒè¯•åŠŸèƒ½ä¹‹ä¸€ï¼šå¯ä»¥å‰åç«¯åŒæ—¶è°ƒè¯•ã€‚

ä½¿ç”¨å‘½ä»¤ `./hade dev all` å¼€å¯å‰åç«¯åŒæ—¶è°ƒè¯•æ¨¡å¼ï¼š

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/94/08/9422ea8fc5a9fc0f33d2348cfc340308.png?wh=1015x733)

æ§åˆ¶å°å¯ä»¥çœ‹åˆ°å‰ç«¯å’Œåç«¯éƒ½å·²ç»ç¼–è¯‘è¿è¡Œäº†ã€‚ç„¶åæˆ‘ä»¬é€šè¿‡ [http://localhost:8070/#/register](http://localhost:8070/#/register) ç›´æ¥çœ‹åˆ°å‰ç«¯é¡µé¢ï¼š

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/c1/b4/c1d21d6f0eb943f48a062d294820e4b4.png?wh=536x484)

å¦‚æœæˆ‘ä»¬å‘ç°æ¥å£æˆ–è€…é¡µé¢æœ‰éœ€è¦ä¿®æ”¹çš„åœ°æ–¹ï¼Œç›´æ¥ä¿®æ”¹å‰åç«¯çš„ä»£ç å³å¯é‡æ–°ç¼–è¯‘ï¼Œç›´æ¥è°ƒè¯•ï¼š

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/bd/6a/bd0148ac02be4e707c9086fb6313036a.png?wh=471x244)

è¿™èŠ‚è¯¾æˆ‘ä»¬å®ç°äº†ç”¨æˆ·æ¨¡å—çš„å‰åç«¯çš„å¼€å‘ï¼Œä»£ç æ”¹åŠ¨é‡è¾ƒå¤§ï¼Œå·²ç»æäº¤åˆ° [geekbang/32](https://github.com/gohade/bbs/tree/geekbang/32) åˆ†æ”¯äº†ã€‚æ¬¢è¿æ¯”å¯¹æŸ¥çœ‹ã€‚

## å°ç»“

è¿™èŠ‚è¯¾æˆ‘ä»¬å°±å®Œå®Œæ•´æ•´åšå¥½äº†ç”¨æˆ·æ¨¡å—çš„å¼€å‘ã€‚è¿˜æ˜¯å†å•°å—¦å¼ºè°ƒä¸€ä¸‹ï¼Œåç«¯å¼€å‘çš„å››ä¸ªæ­¥éª¤ï¼šå…ˆå°†æ¥å£swagggeråŒ–ã€å†å®šä¹‰ç”¨æˆ·æœåŠ¡åè®®ã€æ¥ç€å¼€å‘æ¨¡å—æ¥å£ã€æœ€åå®ç°ç”¨æˆ·æœåŠ¡åè®®ã€‚**æœåŠ¡æ¨¡å—çš„åè®®è®¾è®¡ä¸ä¸€å®šèƒ½ä¸€æ¬¡æ€§æŠ½è±¡å¥½ï¼Œå¯ä»¥ä»æœåŠ¡éœ€è¦æä¾›å“ªäº›å¯¹å¤–èƒ½åŠ›â€çš„è§’åº¦æ¥æ€è€ƒï¼Œä»éœ€æ±‚å‡ºå‘ï¼Œé‡åˆ°æ–°çš„éœ€æ±‚ï¼Œä¸æ–­è¿­ä»£ä½ çš„è®¾è®¡å°±å¯ä»¥**ã€‚

åŒæ—¶å…³äºå‰ç«¯å¼€å‘ï¼Œæˆ‘ä»¬é‡ç‚¹è®²äº†ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨element-UIæ¥æ„å»ºé¡µé¢ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨axiosæ¥å‘åç«¯å‘é€è¯·æ±‚ã€‚è¦æŒæ¡å‰åç«¯éƒ½å¼€å‘å®Œæˆä¹‹åçš„è°ƒè¯•æ–¹å¼ï¼Œä½¿ç”¨dev all çš„è°ƒè¯•æ¨¡å¼æ¥åŒæ—¶è°ƒè¯•å‰åç«¯ï¼Œè¿™ä¸ªèƒ½è®©ä½ çš„å¼€å‘é€Ÿåº¦æé«˜ä¸å°‘ã€‚

### æ€è€ƒé¢˜

å¯¹äºç”¨æˆ·æœåŠ¡æ¥è¯´ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªVerifyLoginçš„æ¥å£ï¼Œæ ¹æ®tokenæ¥è·å–å¯¹åº”çš„userä¿¡æ¯ã€‚è¿™ä¸ªä½ è§‰å¾—åº”è¯¥åœ¨å“ªé‡Œä½¿ç”¨ï¼Ÿæ€ä¹ˆä½¿ç”¨å‘¢ï¼Ÿ

æ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„å­¦ä¹ ç¬”è®°ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œå¦‚æœè§‰å¾—ä»Šå¤©çš„å†…å®¹å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œä¹Ÿæ¬¢è¿åˆ†äº«ç»™ä½ èº«è¾¹çš„æœ‹å‹ï¼Œé‚€è¯·ä»–ä¸€èµ·å­¦ä¹ ã€‚ä¸‹èŠ‚è¯¾æˆ‘ä»¬å®æˆ˜ç»§ç»­ã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ1ï¼‰</strong></div><ul>
<li><span>å®™æ–¯</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>if db.Where(&amp;User{Email: user.Email}).First(userDB).Error != gorm.ErrRecordNotFound { return nil, errors.New(&quot;é‚®ç®±å·²æ³¨å†Œç”¨æˆ·ï¼Œä¸èƒ½é‡å¤æ³¨å†Œ&quot;)}if db.Where(&amp;User{UserName: user.UserName}).First(userDB).Error != gorm.ErrRecordNotFound { return nil, errors.New(&quot;ç”¨æˆ·åå·²ç»è¢«æ³¨å†Œï¼Œè¯·æ¢ä¸€ä¸ªç”¨æˆ·å&quot;)}

è¿™é‡Œåˆ¤å®šå†™é”™äº†ï¼Œæ˜¯ ==å‘¢ï¼Ÿ</p>2022-03-14</li><br/>
</ul>