ä½ å¥½ï¼Œæˆ‘æ˜¯è½©è„‰åˆƒã€‚

ä¸Šä¸€èŠ‚è¯¾ï¼Œæˆ‘ä»¬è®¨è®ºäº†è°ƒè¯•æ¨¡å¼çš„æ•´ä½“è®¾è®¡æ€è·¯å’Œå…³é”®çš„æŠ€æœ¯éš¾ç‚¹-åå‘ä»£ç†ï¼Œæœ€åå®šä¹‰äº†å…·ä½“çš„å‘½ä»¤è®¾è®¡ï¼ŒåŒ…æ‹¬ä¸‰ä¸ªäºŒçº§å‘½ä»¤ï¼Œèƒ½è®©æˆ‘ä»¬è°ƒè¯•å‰ç«¯/åç«¯ï¼Œæˆ–è€…åŒæ—¶è°ƒè¯•ã€‚ç°åœ¨ï¼Œå¤§çš„æ¡†æ¶éƒ½å»ºç«‹å¥½äº†ï¼Œä½†æ˜¯å…¶ä¸­çš„ç»†èŠ‚å®ç°è¿˜æ²¡æœ‰è®¨è®ºã€‚æˆè´¥åœ¨äºç»†èŠ‚ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ’¸èµ·è¢–å­å¼€å§‹å®ç°å®ƒä»¬ã€‚

## é…ç½®é¡¹çš„è®¾è®¡

ç®€å•å›é¡¾ä¸€ä¸‹è°ƒè¯•æ¨¡å¼çš„æ¶æ„è®¾è®¡ã€‚æ‰€æœ‰å¤–éƒ¨è¯·æ±‚è¿›å…¥åå“ä»£ç†æœåŠ¡åï¼Œä¼šç”±åå‘ä»£ç†æœåŠ¡è¿›è¡Œåˆ†å‘ï¼Œå‰ç«¯è¯·æ±‚åˆ†å‘åˆ°å‰ç«¯è¿›ç¨‹ï¼Œåç«¯è¯·æ±‚åˆ†å‘åˆ°åç«¯è¿›ç¨‹ã€‚  
![](https://static001.geekbang.org/resource/image/86/16/86d2c8a583a1dafa52ee79fb95f30616.jpg?wh=1920x1080)  
åœ¨è¿™ä¸ªè®¾è®¡ä¸­ï¼Œå‰ç«¯æœåŠ¡å¯åŠ¨çš„æ—¶å€™å ç”¨å“ªä¸ªç«¯å£ï¼Ÿåç«¯æœåŠ¡å¯åŠ¨çš„æ—¶å€™å ç”¨å“ªä¸ªç«¯å£ï¼Ÿåå‘ä»£ç†æœåŠ¡proxyå¯åŠ¨çš„æ—¶å€™å ç”¨å“ªä¸ªç«¯å£å‘¢ï¼Ÿè¿™äº›éƒ½å±äºé…ç½®é¡¹ï¼Œéœ€è¦åœ¨è®¾è®¡ä¹‹åˆå°±è§„åˆ’å¥½ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆè®¾è®¡é…ç½®é¡¹çš„å…·ä½“å®ç°ã€‚

ç”±äºè°ƒè¯•æ¨¡å¼é…ç½®é¡¹æ¯”è¾ƒå¤šï¼Œåœ¨framework/command/dev.go ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰å¦‚ä¸‹çš„é…ç½®ç»“æ„devConfigæ¥è¡¨ç¤ºé…ç½®ä¿¡æ¯ï¼š

```go
// devConfig ä»£è¡¨è°ƒè¯•æ¨¡å¼çš„é…ç½®ä¿¡æ¯
type devConfig struct {

   Port    string   // è°ƒè¯•æ¨¡å¼æœ€ç»ˆç›‘å¬çš„ç«¯å£ï¼Œé»˜è®¤ä¸º8070
   
   Backend struct { // åç«¯è°ƒè¯•æ¨¡å¼é…ç½®
      RefreshTime   int    // è°ƒè¯•æ¨¡å¼åç«¯æ›´æ–°æ—¶é—´ï¼Œå¦‚æœæ–‡ä»¶å˜æ›´ï¼Œç­‰å¾…3sæ‰è¿›è¡Œä¸€æ¬¡æ›´æ–°ï¼Œèƒ½è®©é¢‘ç¹ä¿å­˜å˜æ›´æ›´ä¸ºé¡ºç•…, é»˜è®¤1s
      Port          string // åç«¯ç›‘å¬ç«¯å£ï¼Œ é»˜è®¤ 8072
      MonitorFolder string // ç›‘å¬æ–‡ä»¶å¤¹ï¼Œé»˜è®¤ä¸ºAppFolder
   }
   
   Frontend struct { // å‰ç«¯è°ƒè¯•æ¨¡å¼é…ç½®
      Port string // å‰ç«¯å¯åŠ¨ç«¯å£, é»˜è®¤8071
   }
}
```

è¿™ä¸ªç»“æ„å¯ä»¥è¯´å·²ç»éå¸¸æ¸…æ™°äº†ã€‚ç»“æ„æ ¹ç›®å½•ä¸‹çš„Portä»£è¡¨proxyçš„ç«¯å£ï¼Œè€Œæ ¹ç›®å½•ä¸‹çš„Backend å’Œ Frontend åˆ†åˆ«ä»£è¡¨åç«¯å’Œå‰ç«¯çš„é…ç½®ã€‚

å…¶ä¸­ï¼Œå‰ç«¯åªéœ€è¦é…ç½®ä¸€ä¸ªç«¯å£Portï¼Œ**è€Œåç«¯ï¼Œæˆ‘ä»¬é™¤äº†é…ç½®ç«¯å£Portä¹‹å¤–ï¼Œè¿˜å¦å¤–å¤šäº†ä¸¤ä¸ªé…ç½®ï¼Œä¸€ä¸ªæ˜¯ç›‘å¬çš„æ–‡ä»¶å¤¹MonitorFolderï¼Œå¦å¤–ä¸€ä¸ªæ˜¯ç›‘å¬æ–‡ä»¶å¤¹çš„å˜æ›´æ—¶é—´RefreshTime**ï¼Œè¿™ä¸¤ä¸ªé…ç½®éƒ½æ˜¯å’Œåç«¯ç›‘å¬æ–‡ä»¶å¤¹ç›¸å…³çš„ï¼Œå…·ä½“å¦‚ä½•ä½¿ç”¨ï¼Œæˆ‘ä»¬åœ¨åé¢å†™proxyçš„æ–¹æ³•monitorBackendå†è¯¦ç»†è¯´ã€‚

æœ‰äº†è¿™ä¸ªé…ç½®ç»“æ„è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬è¿˜è¦å®šä¹‰é…ç½®ç»“æ„ä¸­æ¯ä¸ªå€¼çš„èµ‹å€¼å’Œé»˜è®¤å€¼ï¼Œåœ¨é…ç½®æ–‡ä»¶app.yamlä¸­å¯¹åº”å®šä¹‰çš„é…ç½®å­—æ®µå¦‚ä¸‹ï¼š

```yaml
dev: # è°ƒè¯•æ¨¡å¼
  port: 8070 # è°ƒè¯•æ¨¡å¼æœ€ç»ˆç›‘å¬çš„ç«¯å£ï¼Œé»˜è®¤ä¸º8070
  backend: # åç«¯è°ƒè¯•æ¨¡å¼é…ç½®
    refresh_time: 3  # è°ƒè¯•æ¨¡å¼åç«¯æ›´æ–°æ—¶é—´ï¼Œå¦‚æœæ–‡ä»¶å˜æ›´ï¼Œç­‰å¾…3sæ‰è¿›è¡Œä¸€æ¬¡æ›´æ–°ï¼Œèƒ½è®©é¢‘ç¹ä¿å­˜å˜æ›´æ›´ä¸ºé¡ºç•…, é»˜è®¤1s
    port: 8072 # åç«¯ç›‘å¬ç«¯å£ï¼Œé»˜è®¤8072
    monitor_folder: "" # ç›‘å¬æ–‡ä»¶å¤¹åœ°å€ï¼Œä¸ºç©ºæˆ–è€…ä¸å¡«é»˜è®¤ä¸ºAppFolder
  frontend: # å‰ç«¯è°ƒè¯•æ¨¡å¼é…ç½®
    port: 8071 # å‰ç«¯ç›‘å¬ç«¯å£, é»˜è®¤8071
```

ä¹‹åå¦‚æœåœ¨é…ç½®æ–‡ä»¶ä¸­æœ‰é…ç½®è¿™äº›å­—æ®µï¼Œå°±ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„å­—æ®µï¼Œå¦åˆ™çš„è¯ï¼Œåˆ™ä½¿ç”¨é»˜è®¤é…ç½®ã€‚å¯¹åº”åˆ°ä»£ç ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥åœ¨framework/command/dev.goä¸­å®ç°ä¸€ä¸ªinitDevConfigã€‚

å®ç°æ€è·¯ä¹Ÿä¸éš¾ï¼Œå‚æ•°åªéœ€è¦æŠŠæœåŠ¡å®¹å™¨ä¼ é€’è¿›å…¥å°±è¡Œäº†ï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰å¥½é»˜è®¤çš„é…ç½®ï¼Œç„¶åä»å®¹å™¨ä¸­è·å–é…ç½®æœåŠ¡ï¼Œé€šè¿‡é…ç½®æœåŠ¡ï¼Œè·å–å¯¹åº”çš„é…ç½®æ–‡ä»¶çš„è®¾ç½®ï¼Œå¦‚æœé…ç½®æ–‡ä»¶æœ‰å¯¹åº”å­—æ®µçš„è¯ï¼Œå°±è¿›è¡Œå¯¹åº”å­—æ®µçš„é…ç½®ã€‚

```go
// åˆå§‹åŒ–é…ç½®æ–‡ä»¶
func initDevConfig(c framework.Container) *devConfig {
    // è®¾ç½®é»˜è®¤å€¼
    devConfig := &devConfig{
        Port: "8087",
        Backend: struct {
            RefreshTime   int
            Port          string
            MonitorFolder string
        }{
            1,
            "8072",
            "",
        },
        Frontend: struct {
            Port string
        }{
            "8071",
        },
    }
    // å®¹å™¨ä¸­è·å–é…ç½®æœåŠ¡
    configer := c.MustMake(contract.ConfigKey).(contract.Config)
    // æ¯ä¸ªé…ç½®é¡¹è¿›è¡Œæ£€æŸ¥
    if configer.IsExist("app.dev.port") {
        devConfig.Port = configer.GetString("app.dev.port")
    }
    if configer.IsExist("app.dev.backend.refresh_time") {
        devConfig.Backend.RefreshTime = configer.GetInt("app.dev.backend.refresh_time")
    }
    if configer.IsExist("app.dev.backend.port") {
        devConfig.Backend.Port = configer.GetString("app.dev.backend.port")
    }
    
    // monitorFolder é»˜è®¤ä½¿ç”¨ç›®å½•æœåŠ¡çš„AppFolder()
    monitorFolder := configer.GetString("app.dev.backend.monitor_folder")
    if monitorFolder == "" {
        appService := c.MustMake(contract.AppKey).(contract.App)
        devConfig.Backend.MonitorFolder = appService.AppFolder()
    }
    if configer.IsExist("app.dev.frontend.port") {
        devConfig.Frontend.Port = configer.GetString("app.dev.frontend.port")
    }
    return devConfig
}

```

è¿™é‡Œç€é‡è¯´ä¸€ä¸‹monitorFolderè¿™ä¸ªé…ç½®çš„é€»è¾‘ï¼Œå¦‚æœé…ç½®æ–‡ä»¶ä¸­æœ‰å®šä¹‰è¿™ä¸ªé…ç½®çš„è¯ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨é…ç½®æ–‡ä»¶çš„é…ç½®ï¼Œå¦åˆ™æˆ‘ä»¬å°±å»ç›®å½•æœåŠ¡ä¸­è·å–AppFolderã€‚å…¶å®è¿™ç§æœ‰å±‚æ¬¡çš„é…ç½®æ–¹å¼ï¼Œåœ¨é…ç½®æœåŠ¡é‚£ä¸€èŠ‚æˆ‘ä»¬å·²ç»è§è¿‡äº†ï¼Œå¤šä½¿ç”¨è¿™ç§é…ç½®æ–¹å¼èƒ½è®©æ¡†æ¶å¯ç”¨æ€§æ›´é«˜ã€‚

ä½†æ˜¯ä¹‹å‰[ç¬¬12èŠ‚è¯¾](https://time.geekbang.org/column/article/425820)ï¼Œå®šä¹‰ç›®å½•æœåŠ¡æ¥å£çš„æ—¶å€™ï¼Œæ²¡æœ‰å®šä¹‰Appçš„æœåŠ¡æ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—å»ç¨å¾®ä¿®æ”¹ä¸‹ç›®å½•æœåŠ¡æ¥å£ framework/contract/app.goï¼Œä¸ºå…¶å¢åŠ AppFolderè¿™ä¸ªç›®å½•æ¥å£ï¼š

```go
// App å®šä¹‰æ¥å£
type App interface {
   ...

   // AppFolder å®šä¹‰ä¸šåŠ¡ä»£ç æ‰€åœ¨çš„ç›®å½•ï¼Œç”¨äºç›‘æ§æ–‡ä»¶å˜æ›´ä½¿ç”¨
   AppFolder() string
   ...
}
```

åŒæ—¶ä¿®æ”¹å…¶å¯¹åº”å®ç° framework/provider/app/service.goï¼Œå¢åŠ è¿™ä¸ªAppFolderçš„å®ç°ï¼š

```go
// AppFolder ä»£è¡¨appç›®å½•
func (app *HadeApp) AppFolder() string {
   if val, ok := app.configMap["app_folder"]; ok {
      return val
   }
   return filepath.Join(app.BaseFolder(), "app")
}
```

åˆ°è¿™é‡Œï¼Œé…ç½®ç»“æ„devConfigåŠé…ç½®ç»“æ„åˆå§‹åŒ–æ–¹æ³• initDevConfigï¼Œå°±å®ç°å®Œæˆäº†ã€‚

## å…·ä½“å®ç°

ç°åœ¨ï¼Œæ¥å®Œæˆæ‹¼å›¾çš„æœ€åä¸€ä¸ªéƒ¨åˆ†ï¼Œå›åˆ°framework/command/dev.goä¸­ï¼Œä¸ŠèŠ‚è¯¾åªå®šä¹‰äº†Proxyç»“æ„ï¼Œä½†æ˜¯Proxyç»“æ„ä¸­çš„å­—æ®µï¼Œæˆ‘ä»¬æ²¡æœ‰è®¨è®ºã€‚

é¦–å…ˆæœ‰äº†ä¸Šé¢å®šä¹‰çš„devConfigç»“æ„ä¹‹åï¼ŒProxyçš„ç»“æ„ä¸­ï¼Œåº”è¯¥æœ‰ä¸€ä¸ªå­—æ®µä¿å­˜è¿™ä¸ªProxyçš„é…ç½®ä¿¡æ¯devConfigã€‚

å…¶æ¬¡ï¼Œåœ¨restartå‰ç«¯æˆ–è€…åç«¯çš„æ—¶å€™ï¼Œç”±äº**æ–°è¿›ç¨‹å’Œæ—§è¿›ç¨‹éƒ½ä½¿ç”¨ä¸€æ ·çš„ç«¯å£**ï¼Œæˆ‘ä»¬ä¸€å®šæ˜¯å…ˆå…³é—­æ—§çš„å‰ç«¯è¿›ç¨‹æˆ–è€…åç«¯è¿›ç¨‹ï¼Œæ‰èƒ½å¯åŠ¨æ–°çš„å‰ç«¯æˆ–è€…åç«¯è¿›ç¨‹ã€‚æ‰€ä»¥è¿™é‡Œè¦è®°å½•ä¸€ä¸‹å‰åç«¯è¿›ç¨‹çš„è¿›ç¨‹IDï¼Œè®¾ç½®äº†backendPidå’Œ frontendPidæ¥å­˜å‚¨è¿›ç¨‹IDã€‚

```go
// Proxy ä»£è¡¨serveå¯åŠ¨çš„æœåŠ¡å™¨ä»£ç†
type Proxy struct {
   devConfig   *devConfig // é…ç½®æ–‡ä»¶
   backendPid  int        // å½“å‰çš„backendæœåŠ¡çš„pid
   frontendPid int        // å½“å‰çš„frontendæœåŠ¡çš„pid
}
```

ä¸‹é¢æˆ‘ä»¬å°±é’ˆå¯¹æ¯ä¸ªå‡½æ•°çš„å…·ä½“å®ç°ä¸€ä¸€è¯´æ˜ï¼Œè¿™é‡ŒæŠŠä¸ŠèŠ‚è¯¾å®šä¹‰çš„å„ä¸ªå‡½æ•°ç®€å•å†åˆ—ä¸€ä¸‹ï¼Œå¦‚æœä½ å¯¹å®ƒä»¬çš„åŠŸèƒ½æœ‰ç‚¹æ¨¡ç³Šäº†ï¼Œå¯ä»¥å†å›é¡¾ä¸€ä¸‹ç¬¬19è¯¾ã€‚

```go
// åˆå§‹åŒ–ä¸€ä¸ªProxy
func NewProxy(c framework.Container) *Proxy{}
// é‡æ–°å¯åŠ¨ä¸€ä¸ªproxyç½‘å…³
func (p *Proxy) newProxyReverseProxy(frontend, backend *url.URL) *httputil.ReverseProxy{}
// å¯åŠ¨å‰ç«¯æœåŠ¡
func (p *Proxy) restartFrontend() error{}
// å¯åŠ¨åç«¯æœåŠ¡
func (p *Proxy) restartBackend() error {}
// ç¼–è¯‘åç«¯æœåŠ¡
func (p *Proxy) rebuildBackend() error {}
// å¯åŠ¨proxy
func (p *Proxy) startProxy(startFrontend, startBackend bool) error{}
// ç›‘æ§åç«¯æœåŠ¡æºç æ–‡ä»¶çš„å˜æ›´
func (p *Proxy) monitorBackend() error{}
```

### newProxyReverseProxy

é¦–å…ˆæ˜¯newProxyReverseProxyï¼Œå®ƒçš„æ ¸å¿ƒé€»è¾‘å°±æ˜¯åˆ›å»ºReverseProxyï¼Œè®¾ç½®Directorã€ModifyResponseã€ErrorHandlerä¸‰ä¸ªå­—æ®µã€‚ä½†æ˜¯æˆ‘ä»¬åœ¨ç»†èŠ‚ä¸Šè¦åšä¸€äº›è¡¥å……ã€‚

é¦–å…ˆï¼Œæ—¢ç„¶å·²ç»åœ¨proxyä¸­å­˜äº†å‰åç«¯çš„PIDï¼Œé‚£å°±å¯ä»¥çŸ¥é“å½“ä¸‹å‰ç«¯æœåŠ¡æˆ–è€…åç«¯æœåŠ¡æ˜¯å¦å·²ç»å¯åŠ¨äº†ã€‚å¦‚æœåªå¯åŠ¨äº†å‰ç«¯æœåŠ¡ï¼Œæˆ‘ä»¬ç›´æ¥ä»£ç†å‰ç«¯å°±å¥½äº†ï¼›å¦‚æœåªå¯åŠ¨åç«¯æœåŠ¡ï¼Œå°±ç›´æ¥ä»£ç†åç«¯ã€‚è€Œ**åªæœ‰ä¸¤ä¸ªæœåŠ¡éƒ½å¯åŠ¨äº†ï¼Œæˆ‘ä»¬æ‰è¿›è¡Œä¸Šä¸€èŠ‚è¯¾è¯´çš„ï¼šå…ˆè¯·æ±‚åç«¯æœåŠ¡ï¼Œé‡åˆ°404äº†ï¼Œå†è¯·æ±‚å‰ç«¯æœåŠ¡**ã€‚

åŒæ—¶ç¨å¾®ä¿®æ”¹ä¸€ä¸‹directorï¼Œå¯¹äºå‰ç«¯ä¸€äº›å›ºå®šçš„è¯·æ±‚åœ°å€ï¼Œæ¯”å¦‚ / æˆ–è€… /app.jsï¼Œæˆ‘ä»¬ç›´æ¥å°†è¿™ä¸ªåœ°å€å›ºå®šè¯·æ±‚å‰ç«¯ã€‚

```go
// é‡æ–°å¯åŠ¨ä¸€ä¸ªproxyç½‘å…³
func (p *Proxy) newProxyReverseProxy(frontend, backend *url.URL) *httputil.ReverseProxy {
   if p.frontendPid == 0 && p.backendPid == 0 {
      fmt.Println("å‰ç«¯å’Œåç«¯æœåŠ¡éƒ½ä¸å­˜åœ¨")
      return nil
   }

   // åç«¯æœåŠ¡å­˜åœ¨
   if p.frontendPid == 0 && p.backendPid != 0 {
      return httputil.NewSingleHostReverseProxy(backend)
   }

   // å‰ç«¯æœåŠ¡å­˜åœ¨
   if p.backendPid == 0 && p.frontendPid != 0 {
      return httputil.NewSingleHostReverseProxy(frontend)
   }

   // ä¸¤ä¸ªéƒ½æœ‰è¿›ç¨‹
   // å…ˆåˆ›å»ºä¸€ä¸ªåç«¯æœåŠ¡çš„directory
   director := func(req *http.Request) {
      if req.URL.Path == "/" || req.URL.Path == "/app.js" {
         req.URL.Scheme = frontend.Scheme
         req.URL.Host = frontend.Host
      } else {
         req.URL.Scheme = backend.Scheme
         req.URL.Host = backend.Host
      }
   }

   // å®šä¹‰ä¸€ä¸ªNotFoundErr
   NotFoundErr := errors.New("response is 404, need to redirect")
   return &httputil.ReverseProxy{
      Director: director, // å…ˆè½¬å‘åˆ°åç«¯æœåŠ¡
      ModifyResponse: func(response *http.Response) error {
         // å¦‚æœåç«¯æœåŠ¡è¿”å›äº†404ï¼Œæˆ‘ä»¬è¿”å›NotFoundErr ä¼šè¿›å…¥åˆ°errorHandlerä¸­
         if response.StatusCode == 404 {
            return NotFoundErr
         }
         return nil
      },
      ErrorHandler: func(writer http.ResponseWriter, request *http.Request, err error) {
         // åˆ¤æ–­ Error æ˜¯å¦ä¸ºNotFoundError, æ˜¯çš„è¯åˆ™è¿›è¡Œå‰ç«¯æœåŠ¡çš„è½¬å‘ï¼Œé‡æ–°ä¿®æ”¹writer
         if errors.Is(err, NotFoundErr) {
            httputil.NewSingleHostReverseProxy(frontend).ServeHTTP(writer, request)
         }
      }}
}
```

### rebuildBackend / restartBackend

ä¸‹ä¸€ä¸ªå‡½æ•°æ˜¯rebuildBackendã€‚è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯é‡æ–°ç¼–è¯‘åç«¯ã€‚

é‚£å¦‚ä½•ç¼–è¯‘åç«¯å‘¢ï¼Ÿè¿˜è®°å¾—ç¬¬18è¯¾ä¸­ä¸ºç¼–è¯‘åç«¯å®šä¹‰äº†å‘½ä»¤è¡Œä¹ˆï¼Ÿæ‰€ä»¥åœ¨â€œè°ƒè¯•å‘½ä»¤â€ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒç”¨â€œç¼–è¯‘å‘½ä»¤â€å°±è¡Œäº†ã€‚

- ç¼–è¯‘å‰ç«¯ ./hade build frontend
- ç¼–è¯‘åç«¯ ./hade build backend
- åŒæ—¶ç¼–è¯‘å‰åç«¯ ./hade build all
- è‡ªç¼–è¯‘ ./hade build self

æ‰€ä»¥rebuildBackend è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å°±æ˜¯è°ƒç”¨ä¸€æ¬¡ `./hade build backend` ã€‚

```go
// rebuildBackend é‡æ–°ç¼–è¯‘åç«¯
func (p *Proxy) rebuildBackend() error {
   // é‡æ–°ç¼–è¯‘hade
   cmdBuild := exec.Command("./hade", "build", "backend")
   cmdBuild.Stdout = os.Stdout
   cmdBuild.Stderr = os.Stderr
   if err := cmdBuild.Start(); err == nil {
      err = cmdBuild.Wait()
      if err != nil {
         return err
      }
   }
   return nil
}
```

ç¼–è¯‘åç«¯å‡½æ•°å®ç°äº†ï¼Œä¸‹é¢å°±æ˜¯é‡å¯åç«¯è¿›ç¨‹restartBackendã€‚

æˆ‘ä»¬å½“ç„¶ä¹Ÿä¼šè®°å¾—åœ¨[ç¬¬12ç« ](https://time.geekbang.org/column/article/425820)å°†å¯åŠ¨WebæœåŠ¡å˜æˆä¸€ä¸ªå‘½ä»¤ `./hade app start` ã€‚æ‰€ä»¥é‡å¯åç«¯æœåŠ¡çš„æ­¥éª¤å°±æ˜¯ï¼š

- å…³é—­æ—§è¿›ç¨‹ï¼ˆkillï¼‰
- å¯åŠ¨æ–°è¿›ç¨‹ï¼ˆ./hade app startï¼‰

ä½†æ˜¯è¿™é‡Œæœ‰ä¸ªå°é—®é¢˜ï¼Œ**ä¹‹å‰å¯åŠ¨è¿›ç¨‹çš„æ—¶å€™ï¼Œè¿›ç¨‹ç«¯å£æ˜¯å†™æ­»çš„ã€‚ä½†æ˜¯ï¼Œç°åœ¨éœ€è¦å›ºå®šå¯åŠ¨çš„Appçš„è¿›ç¨‹ç«¯å£**ã€‚æ‰€ä»¥è¦å¯¹ `./hade app start` å‘½ä»¤è¿›è¡Œä¸€äº›æ”¹é€ ã€‚

æ¥ä¿®æ”¹framework/command/app.goï¼Œæˆ‘ä»¬å¢åŠ ä¸€ä¸ªappAddressåœ°å€ï¼Œè¿™ä¸ªåœ°å€å¯ä»¥ä¼ é€’ç±»ä¼¼ `localhost:8888` æˆ–è€… `:8888` è¿™æ ·çš„å¯åŠ¨æœåŠ¡åœ°å€ï¼Œå¹¶ä¸”åœ¨appStartCommandä¸­ä½¿ç”¨è¿™ä¸ªappAddressã€‚

```go
// appå¯åŠ¨åœ°å€
var appAddress = ""

// initAppCommand åˆå§‹åŒ–appå‘½ä»¤å’Œå…¶å­å‘½ä»¤
func initAppCommand() *cobra.Command {
   // è®¾ç½®å¯åŠ¨åœ°å€
   appStartCommand.Flags().StringVar(&appAddress, "address", ":8888", "è®¾ç½®appå¯åŠ¨çš„åœ°å€ï¼Œé»˜è®¤ä¸º:8888")

   appCommand.AddCommand(appStartCommand)
   return appCommand
}

// appStartCommand å¯åŠ¨ä¸€ä¸ªWebæœåŠ¡
var appStartCommand = &cobra.Command{
   Use:   "start",
   Short: "å¯åŠ¨ä¸€ä¸ªWebæœåŠ¡",
   RunE: func(c *cobra.Command, args []string) error {
      ...
      // åˆ›å»ºä¸€ä¸ªServeræœåŠ¡
      server := &http.Server{
         Handler: core,
         Addr:    appAddress,
      }
      // è¿™ä¸ªgoroutineæ˜¯å¯åŠ¨æœåŠ¡çš„goroutine
      go func() {
         server.ListenAndServe()
      }()
      ...
   },
}
```

è¿™æ ·ï¼Œåç«¯è¿›ç¨‹å°±å¯ä»¥é€šè¿‡å‘½ä»¤ `./hade app start --address=:8888` è¿™æ ·çš„æ–¹å¼ï¼Œæ¥æŒ‡å®šç«¯å£å¯åŠ¨æœåŠ¡äº†ã€‚

å°é—®é¢˜è§£å†³ä¹‹åï¼Œå›åˆ°framework/command/dev.goï¼Œ æˆ‘ä»¬å®ç°restartBackendæ–¹æ³•ã€‚å…ˆæ€æ­»æ—§çš„è¿›ç¨‹ï¼Œå†é€šè¿‡å‘½ä»¤ `./hade app start` å¸¦ä¸Šå‚æ•° addressï¼Œå¯åŠ¨æ–°çš„åç«¯æœåŠ¡ã€‚å¯åŠ¨ä¹‹åï¼Œå†å°†å¯åŠ¨çš„è¿›ç¨‹IDå­˜å‚¨åˆ°proxyç»“æ„çš„backendPidå­—æ®µä¸­ï¼š

```go
// restartBackend å¯åŠ¨åç«¯æœåŠ¡
func (p *Proxy) restartBackend() error {

   // æ€æ­»ä¹‹å‰çš„è¿›ç¨‹
   if p.backendPid != 0 {
      syscall.Kill(p.backendPid, syscall.SIGKILL)
      p.backendPid = 0
   }

   // è®¾ç½®éšæœºç«¯å£ï¼ŒçœŸå®åç«¯çš„ç«¯å£
   port := p.devConfig.Backend.Port
   hadeAddress := fmt.Sprintf(":" + port)
   // ä½¿ç”¨å‘½ä»¤è¡Œå¯åŠ¨åç«¯è¿›ç¨‹
   cmd := exec.Command("./hade", "app", "start", "--address="+hadeAddress)
   cmd.Stdout = os.NewFile(0, os.DevNull)
   cmd.Stderr = os.Stderr
   fmt.Println("å¯åŠ¨åç«¯æœåŠ¡: ", "http://127.0.0.1:"+port)
   err := cmd.Start()
   if err != nil {
      fmt.Println(err)
   }
   p.backendPid = cmd.Process.Pid
   fmt.Println("åç«¯æœåŠ¡pid:", p.backendPid)
   return nil
}
```

### restartFrontend

è€Œé‡å¯å‰ç«¯æœåŠ¡çš„å‡½æ•°restartFrontendä¹Ÿæ˜¯ä¸€æ ·çš„é€»è¾‘ï¼Œå…ˆå…³é—­æ—§çš„å‰ç«¯è¿›ç¨‹ï¼Œç„¶åå¯åŠ¨æ–°çš„å‰ç«¯è¿›ç¨‹ã€‚è¿™é‡ŒåŒæ ·ä¹Ÿæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¯åŠ¨å‰ç«¯è¿›ç¨‹çš„å‘½ä»¤æ˜¯ `npm run dev` ï¼Œæˆ‘ä»¬æ€ä¹ˆå›ºå®šå…¶ç«¯å£å‘¢ï¼Ÿ

åœ¨Vueä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡[è®¾ç½®ç¯å¢ƒå˜é‡PORT](https://stackoverflow.com/questions/47219819/how-to-change-port-number-in-vue-cli-project)ï¼Œæ¥è§„å®šå‰ç«¯è¿›ç¨‹çš„å¯åŠ¨ç«¯å£ã€‚ä¹Ÿå°±æ˜¯è®©å¯åŠ¨å‘½ä»¤å˜ä¸º `PORT=8071 npm run dev` ï¼Œåœ¨Golangä¸­å¯åŠ¨ä¸€ä¸ªå‘½ä»¤ï¼Œå¹¶ä¸ºå‘½ä»¤è®¾ç½®ç¯å¢ƒå˜é‡æ˜¯è¿™æ ·è®¾ç½®çš„ï¼š

```go
// è¿è¡Œå‘½ä»¤
cmd := exec.Command("npm", "run", "dev")
// ä¸ºé»˜è®¤çš„ç¯å¢ƒå˜é‡å¢åŠ PORT=xxxçš„å˜é‡
cmd.Env = os.Environ()
cmd.Env = append(cmd.Env, fmt.Sprintf("%s%s", "PORT=", port))
```

æ‰€ä»¥å¯åŠ¨å‰ç«¯æœåŠ¡çš„é€»è¾‘å°±å¦‚ä¸‹ï¼Œå¾ˆç®€å•ï¼Œé‡ç‚¹ä½ç½®ä½ å¯ä»¥çœ‹æ³¨é‡Šã€‚

```go
// å¯åŠ¨å‰ç«¯æœåŠ¡
func (p *Proxy) restartFrontend() error {
   // å¯åŠ¨å‰ç«¯è°ƒè¯•æ¨¡å¼
   // å…ˆæ€æ­»æ—§è¿›ç¨‹
   if p.frontendPid != 0 {
      syscall.Kill(p.frontendPid, syscall.SIGKILL)
      p.frontendPid = 0
   }
   // å¦åˆ™å¼€å¯npm run serve
   port := p.devConfig.Frontend.Port
   path, err := exec.LookPath("npm")
   if err != nil {
      return err
   }
   cmd := exec.Command(path, "run", "dev")
   cmd.Env = os.Environ()
   cmd.Env = append(cmd.Env, fmt.Sprintf("%s%s", "PORT=", port))
   cmd.Stdout = os.NewFile(0, os.DevNull)
   cmd.Stderr = os.Stderr
   // å› ä¸ºnpm run serve æ˜¯æ§åˆ¶å°æŒ‚èµ·æ¨¡å¼ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨go routineå¯åŠ¨
   err = cmd.Start()
   fmt.Println("å¯åŠ¨å‰ç«¯æœåŠ¡: ", "http://127.0.0.1:"+port)
   if err != nil {
      fmt.Println(err)
   }
   p.frontendPid = cmd.Process.Pid
   fmt.Println("å‰ç«¯æœåŠ¡pid:", p.frontendPid)
   return nil
}
```

### startProxy

ä¸‹é¢æˆ‘ä»¬æ¥å®ç°startProxyæ–¹æ³•ï¼Œå®ƒæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºåœ¨å¯åŠ¨Proxyæ—¶æ˜¯å¦è¦å¯åŠ¨å‰ç«¯ã€åç«¯æœåŠ¡ã€‚

è¿™ä¸ªæ–¹æ³•çš„é€»è¾‘ä¹Ÿå¹¶ä¸å¤æ‚ï¼Œæ­¥éª¤æœ‰å››æ­¥ï¼Œå…ˆæ ¹æ®å‚æ•°åˆ¤æ–­æ˜¯å¦å¯åŠ¨åç«¯æœåŠ¡ï¼Œæ ¹æ®å‚æ•°åˆ¤æ–­æ˜¯å¦å¯åŠ¨å‰ç«¯æœåŠ¡ï¼Œç„¶åä½¿ç”¨newProxyReverseProxyæ¥åˆ›å»ºæ–°çš„ReverseProxyï¼Œæœ€åå¯åŠ¨ProxyæœåŠ¡ã€‚åœ¨ä»£ç ä¸­ä¹Ÿåšäº†æ­¥éª¤è¯´æ˜äº†ï¼š

```go
// å¯åŠ¨proxyæœåŠ¡ï¼Œå¹¶ä¸”æ ¹æ®å‚æ•°å¯åŠ¨å‰ç«¯æœåŠ¡æˆ–è€…åç«¯æœåŠ¡
func (p *Proxy) startProxy(startFrontend, startBackend bool) error {
   var backendURL, frontendURL *url.URL
   var err error

   // å¯åŠ¨åç«¯
   if startBackend {
      if err := p.restartBackend(); err != nil {
         return err
      }
   }
   // å¯åŠ¨å‰ç«¯
   if startFrontend {
      if err := p.restartFrontend(); err != nil {
         return err
      }
   }

   if frontendURL, err = url.Parse(fmt.Sprintf("%s%s", "http://127.0.0.1:", p.devConfig.Frontend.Port)); err != nil {
      return err
   }

   if backendURL, err = url.Parse(fmt.Sprintf("%s%s", "http://127.0.0.1:", p.devConfig.Backend.Port)); err != nil {
      return err
   }

   // è®¾ç½®åå‘ä»£ç†
   proxyReverse := p.newProxyReverseProxy(frontendURL, backendURL)
   proxyServer := &http.Server{
      Addr:    "127.0.0.1:" + p.devConfig.Port,
      Handler: proxyReverse,
   }

   fmt.Println("ä»£ç†æœåŠ¡å¯åŠ¨:", "http://"+proxyServer.Addr)
   // å¯åŠ¨proxyæœåŠ¡
   err = proxyServer.ListenAndServe()
   if err != nil {
      fmt.Println(err)
   }
   return nil
}
```

### monitorBackend

æœ€åæ˜¯ä¸€ä¸ªmonitorBackendæ–¹æ³•ï¼Œç›‘æ§æŸä¸ªæ–‡ä»¶å¤¹çš„å˜åŠ¨ï¼Œå¹¶ä¸”é‡æ–°ç¼–è¯‘å¹¶ä¸”è¿è¡Œåç«¯æœåŠ¡ã€‚

è¿™ä¸ªæ–¹æ³•æˆ‘ä»¬é‡ç‚¹è¯´ä¸€ä¸‹ï¼Œæœ‰äº›é€»è¾‘è¿˜æ˜¯æ¯”è¾ƒç»•çš„ã€‚

é¦–å…ˆï¼Œåœ¨å‰ä¸€èŠ‚è¯¾è¯´è¿‡äº†ï¼Œå¯ä»¥ä½¿ç”¨ [fsnotify](https://github.com/fsnotify/fsnotify) åº“å¯¹ç›®å½•è¿›è¡Œç›‘æ§ã€‚é‚£ä¹ˆå¯¹å“ªä¸ªç›®å½•è¿›è¡Œç›‘æ§å‘¢ï¼Ÿä¹‹å‰åœ¨é…ç½®devConfigä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªBackend.MonitorFolderç›®å½•ï¼Œè¿™ä¸ªé…ç½®é»˜è®¤ä½¿ç”¨çš„æ˜¯AppFolderç›®å½•ã€‚è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬ç›‘æ§çš„ç›®æ ‡ç›®å½•ã€‚

å…¶æ¬¡ï¼Œæ¯æ¬¡æœ‰å˜åŒ–çš„æ—¶å€™ï¼Œéƒ½è¦è¿›è¡Œä¸€æ¬¡ç¼–è¯‘åç«¯æœåŠ¡ã€æ€æ­»æ—§è¿›ç¨‹ã€é‡å¯æ–°è¿›ç¨‹ä¹ˆï¼Ÿ

åœ¨å¼€å‘è¿‡ç¨‹ä¸­æˆ‘ä»¬çŸ¥é“ï¼Œæ¯æ¬¡è°ƒæ•´ä¸€ä¸ªé€»è¾‘çš„æ—¶å€™ï¼Œæ˜¯æœ‰å¯èƒ½çŸ­æ—¶é—´å†…é‡å¤ä¿®æ”¹ã€ä¿å­˜å¤šä¸ªæ–‡ä»¶çš„ï¼Œæˆ–è€…ä¿å­˜ä¸€ä¸ªæ–‡ä»¶å¤šæ¬¡ã€‚è€Œé‡æ–°ç¼–è¯‘ã€é‡æ–°å¯åŠ¨è¿›ç¨‹çš„è¿‡ç¨‹ï¼Œåˆæ˜¯æœ‰ä¸€å®šè€—æ—¶çš„ï¼Œå¦‚æœæ¯æ”¹ä¸€æ¬¡å°±é‡æ¥ä¸€æ¬¡ï¼Œå¯ä»¥æƒ³è±¡è¿™ä¸ªä½“éªŒæ˜¯å¾ˆå·®çš„ã€‚

èƒ½æ€ä¹ˆä¼˜åŒ–è¿™ç§ä½“éªŒå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ç§è®¡æ—¶æ—¶é—´æœºåˆ¶ã€‚

è¿™ä¸ªæœºåˆ¶çš„é€»è¾‘å°±æ˜¯ï¼Œ**æ¯æ¬¡æœ‰æ–‡ä»¶å˜åŠ¨ï¼Œå¹¶ä¸ç«‹åˆ»è¿›è¡Œå®è´¨çš„æ“ä½œï¼Œè€Œæ˜¯å¼€å¯ä¸€ä¸ªè®¡æ—¶æ—¶é—´**ï¼Œå¦‚æœè¿™ä¸ªæ—¶é—´å†…ï¼Œæ²¡æœ‰ä»»ä½•åç»­çš„æ–‡ä»¶å˜åŠ¨äº†ï¼Œé‚£ä¹ˆåœ¨è®¡æ—¶æ—¶é—´åˆ°äº†ä¹‹åï¼Œæˆ‘ä»¬å†è¿›è¡Œå®è´¨çš„æ“ä½œã€‚è€Œå¦‚æœåœ¨è®¡æ—¶æ—¶é—´å†…ï¼Œæœ‰ä»»ä½•æ›´æ–°çš„æ–‡ä»¶å˜åŠ¨ï¼Œæˆ‘ä»¬å°±å°†è®¡æ—¶æ—¶é—´æœºåˆ¶é‡æ–°å¼€å§‹è®¡æ—¶ã€‚

è¿™ç§æœºåˆ¶èƒ½æœ‰ä¸€å®šæ¦‚ç‡ä¿è¯ï¼Œåœ¨â€œæ›´æ–°ä»£ç ç­‰å¾…ä¸€æ®µæ—¶é—´åâ€è¿›è¡Œåç«¯çš„é‡å¯æœåŠ¡ã€‚è€Œè¿™é‡Œçš„è®¡æ—¶æ—¶é—´æˆ‘ä»¬ä¹Ÿå˜æˆä¸€ä¸ªé…ç½®ï¼ŒdevConfigé‡Œé¢çš„Backend.RefreshTimeï¼Œé»˜è®¤æ—¶é•¿ä¸º1sã€‚

å¯¹åº”åœ¨framework/command/dev.goçš„monitorBackendä»£ç å®ç°ä¸­ï¼Œæˆ‘ä»¬å¤§è‡´åˆ†ä¸ºè¿™ä¹ˆå‡ æ­¥ï¼Œ**å…ˆåˆ›å»ºwatcherï¼Œç›‘å¬ç›®æ ‡ç›®å½•ï¼Œæœ‰å˜åŠ¨çš„æ—¶å€™å¼€å¯è®¡æ—¶æ—¶é—´æœºåˆ¶ï¼Œå¾ªç¯ç›‘å¬**ï¼š

- ç›®æ ‡ç›®å½•å˜æ›´äº‹ä»¶ï¼Œæœ‰äº‹ä»¶æ›´æ–°è®¡æ—¶æœºåˆ¶ï¼›
- è®¡æ—¶æœºåˆ¶åˆ°ç‚¹äº‹ä»¶ï¼Œè®¡æ—¶åˆ°ç‚¹äº‹ä»¶è§¦å‘ï¼Œä»£è¡¨æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªç›®æ ‡ç›®å½•å˜æ›´å·²ç»å­˜åœ¨ï¼Œæ›´æ–°åç«¯æœåŠ¡ã€‚

è¿™é‡Œåœ¨ç›‘å¬ç›®æ ‡ç›®å½•çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ç›‘å¬AppFolderç›®å½•ä¸‹çš„æ‰€æœ‰å­ç›®å½•åŠå­™ç›®å½•ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦ç”¨åˆ°é€’å½’ filepath.Walk ï¼Œæ¥é€’å½’ä¸€éæ‰€æœ‰å­ç›®å½•åŠå­™ç›®å½•ã€‚å¦‚æœæ˜¯ç›®å½•ï¼Œå°±ä½¿ç”¨watcher.Add æ¥å°†ç›®å½•åŠ å…¥åˆ°ç›‘æ§åˆ—è¡¨ä¸­ã€‚

å…·ä½“çš„ä»£ç é€»è¾‘å¯ä»¥çœ‹framework/command/dev.goä¸­çš„monitorBackendï¼š

```go
// monitorBackend ç›‘å¬åº”ç”¨æ–‡ä»¶
func (p *Proxy) monitorBackend() error {
   // ç›‘å¬
   watcher, err := fsnotify.NewWatcher()
   if err != nil {
      return err
   }
   defer watcher.Close()

   // å¼€å¯ç›‘å¬ç›®æ ‡æ–‡ä»¶å¤¹
   appFolder := p.devConfig.Backend.MonitorFolder
   fmt.Println("ç›‘æ§æ–‡ä»¶å¤¹ï¼š", appFolder)
   // ç›‘å¬æ‰€æœ‰å­ç›®å½•ï¼Œéœ€è¦ä½¿ç”¨filepath.walk
   filepath.Walk(appFolder, func(path string, info os.FileInfo, err error) error {
      if info != nil && !info.IsDir() {
         return nil
      }
      // å¦‚æœæ˜¯éšè—çš„ç›®å½•æ¯”å¦‚ . æˆ–è€… .. åˆ™ä¸ç”¨è¿›è¡Œç›‘æ§
      if util.IsHiddenDirectory(path) {
         return nil
      }
      return watcher.Add(path)
   })

   // å¼€å¯è®¡æ—¶æ—¶é—´æœºåˆ¶
   refreshTime := p.devConfig.Backend.RefreshTime
   t := time.NewTimer(time.Duration(refreshTime) * time.Second)
   // å…ˆåœæ­¢è®¡æ—¶å™¨
   t.Stop()
   for {
      select {
      case <-t.C:
         // è®¡æ—¶å™¨æ—¶é—´åˆ°äº†ï¼Œä»£è¡¨ä¹‹å‰æœ‰æ–‡ä»¶æ›´æ–°äº‹ä»¶é‡ç½®è¿‡è®¡æ—¶å™¨
         // å³æœ‰æ–‡ä»¶æ›´æ–°
         fmt.Println("...æ£€æµ‹åˆ°æ–‡ä»¶æ›´æ–°ï¼Œé‡å¯æœåŠ¡å¼€å§‹...")
         if err := p.rebuildBackend(); err != nil {
            fmt.Println("é‡æ–°ç¼–è¯‘å¤±è´¥ï¼š", err.Error())
         } else {
            if err := p.restartBackend(); err != nil {
               fmt.Println("é‡æ–°å¯åŠ¨å¤±è´¥ï¼š", err.Error())
            }
         }
         fmt.Println("...æ£€æµ‹åˆ°æ–‡ä»¶æ›´æ–°ï¼Œé‡å¯æœåŠ¡ç»“æŸ...")
         // åœæ­¢è®¡æ—¶å™¨
         t.Stop()
      case _, ok := <-watcher.Events:
         if !ok {
            continue
         }
         // æœ‰æ–‡ä»¶æ›´æ–°äº‹ä»¶ï¼Œé‡ç½®è®¡æ—¶å™¨
         t.Reset(time.Duration(refreshTime) * time.Second)
      case err, ok := <-watcher.Errors:
         if !ok {
            continue
         }
         // å¦‚æœæœ‰æ–‡ä»¶ç›‘å¬é”™è¯¯ï¼Œåˆ™åœæ­¢è®¡æ—¶å™¨
         fmt.Println("ç›‘å¬æ–‡ä»¶å¤¹é”™è¯¯ï¼š", err.Error())
         t.Reset(time.Duration(refreshTime) * time.Second)
      }
   }
}
```

## éªŒè¯

åˆ°è¿™é‡ŒProxyç›¸å…³çš„é€»è¾‘å’Œè°ƒè¯•å¯¹åº”çš„å‘½ä»¤è¡Œå·¥å…·éƒ½å¼€å‘å®Œæˆäº†ï¼Œä¸‹é¢æˆ‘ä»¬æ¥åšä¸€ä¸‹å¯¹åº”çš„éªŒè¯ï¼Œä¸€å…±ä¸‰æ¬¡éªŒè¯ï¼Œå•ç‹¬çš„å‰ç«¯ã€åç«¯ä¿®æ”¹ï¼Œä»¥åŠåŒæ—¶å¯¹å‰åç«¯çš„ä¿®æ”¹ã€‚

å…ˆä¿®æ”¹ä¸€ä¸‹config/development/app.yamlï¼Œå¢åŠ å¯¹åº”çš„è°ƒè¯•æ¨¡å¼é…ç½®ï¼š

```yaml
dev: # è°ƒè¯•æ¨¡å¼
  port: 8070 # è°ƒè¯•æ¨¡å¼æœ€ç»ˆç›‘å¬çš„ç«¯å£ï¼Œé»˜è®¤ä¸º8070
  backend: # åç«¯è°ƒè¯•æ¨¡å¼é…ç½®
    refresh_time: 3  # è°ƒè¯•æ¨¡å¼åç«¯æ›´æ–°æ—¶é—´ï¼Œå¦‚æœæ–‡ä»¶å˜æ›´ï¼Œç­‰å¾…3sæ‰è¿›è¡Œä¸€æ¬¡æ›´æ–°ï¼Œèƒ½è®©é¢‘ç¹ä¿å­˜å˜æ›´æ›´ä¸ºé¡ºç•…, é»˜è®¤1s
    port: 8072 # åç«¯ç›‘å¬ç«¯å£ï¼Œé»˜è®¤8072
    monitor_folder: "" # ç›‘å¬æ–‡ä»¶å¤¹åœ°å€ï¼Œä¸ºç©ºæˆ–è€…ä¸å¡«é»˜è®¤ä¸ºAppFolder
  frontend: # å‰ç«¯è°ƒè¯•æ¨¡å¼é…ç½®
    port: 8071 # å‰ç«¯ç›‘å¬ç«¯å£, é»˜è®¤8071
```

è¿™é‡Œè®¾ç½®refresh\_timeä¸º3sï¼Œä»£è¡¨åç»­åç«¯å˜æ›´å3såä¼šè§¦å‘é‡æ–°ç¼–è¯‘ã€‚å¯¹æˆ‘ä»¬çš„ä»£ç è¿›è¡Œä¸€æ¬¡ç¼–è¯‘ï¼Œä¸ç”¨go buildäº†ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„buildå‘½ä»¤äº†ã€‚  
![](https://static001.geekbang.org/resource/image/bc/dc/bccyy36fb507fc398b4ac69d6fab12dc.png?wh=744x53)

### å‰ç«¯éªŒè¯

é¦–å…ˆéªŒè¯å‰ç«¯è°ƒè¯•æ¨¡å¼ã€‚è°ƒç”¨å‘½ä»¤ `./hade dev front`ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„æ§åˆ¶å°ä¿¡æ¯ï¼š  
![](https://static001.geekbang.org/resource/image/69/3f/6932b5eacdd96f46bd7c431388a5663f.png?wh=1837x388)

å…ˆæ˜¯å‡ºç°å‡ è¡Œä¿¡æ¯ï¼š

```go
å¯åŠ¨å‰ç«¯æœåŠ¡:Â  http://127.0.0.1:8071
å‰ç«¯æœåŠ¡pid: 13750
ä»£ç†æœåŠ¡å¯åŠ¨: http://127.0.0.1:8070
```

ç„¶åè¿›å…¥åˆ°äº†Vueçš„è°ƒè¯•æ¨¡å¼ï¼Œä»ä¸Šè¿°ä¿¡æ¯æˆ‘ä»¬çŸ¥é“ï¼Œä»£ç†æœåŠ¡å¯åŠ¨åœ¨8070ç«¯å£ï¼Œä½¿ç”¨æµè§ˆå™¨æ‰“å¼€ [http://127.0.0.1:8070](http://127.0.0.1:8070) çœ‹åˆ°äº†ç†Ÿæ‚‰çš„Vueç•Œé¢ã€‚  
![](https://static001.geekbang.org/resource/image/51/cd/51bbd33f01b482fe38543e09fcf6a8cd.png?wh=821x675)

ç„¶åä¿®æ”¹é¦–é¡µçš„å‰ç«¯ç»„ä»¶ï¼Œä¸šåŠ¡ç›®å½•ä¸‹src/components/HelloWorld.vueï¼Œå°†å…¶å±•ç¤ºåœ¨é¦–é¡µçš„msgå†…å®¹ï¼š

```javascript
<script>
export default {
  name: 'HelloWorld',
  data() {
    return {
      msg: 'Welcome to Your Vue.js App '
    }
  }
}
</script>
```

ä¿®æ”¹ä¸ºï¼š

```javascript
<script>
export default {
    name: 'HelloWorld',
    data() {
        return {
            msg: 'Welcome to Hade Vue.js App '
        }
    }
}
</script>
```

ç°åœ¨ä½ å¯ä»¥çœ‹åˆ°ï¼Œå‰ç«¯è‡ªåŠ¨æ›´æ–°ï¼š  
![](https://static001.geekbang.org/resource/image/54/3b/54b76e64904e2c38b011e0625317cf3b.png?wh=823x700)  
å‰ç«¯éªŒè¯å®Œæˆã€‚ä¸‹é¢éªŒè¯åç«¯è°ƒè¯•æ¨¡å¼ã€‚

### åç«¯éªŒè¯

æˆ‘ä»¬å·²ç»åœ¨ä¸šåŠ¡ä»£ç app/http/module/demo/api.goä¸­ï¼Œå®šä¹‰äº†/demo/demoçš„è·¯ç”±ï¼Œå¹¶ä¸”ç®€å•è¾“å‡ºæ–‡å­—"this is demo"ã€‚

```go
func Register(r *gin.Engine) error {
   api := NewDemoApi()
   ...
   r.GET("/demo/demo", api.Demo)
   ...
   return nil
}

func (api *DemoApi) Demo(c *gin.Context) {
   c.JSON(200, "this is demo")
}
```

ä½¿ç”¨å‘½ä»¤ `./hade dev backend` ï¼Œæœ‰å¦‚ä¸‹è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°è¾“å‡ºä¸­å·²ç»æŠŠç›‘æ§æ–‡ä»¶å¤¹ã€åç«¯æœåŠ¡ç«¯å£ã€ä»£ç†æœåŠ¡ç«¯å£å®Œæ•´è¾“å‡ºäº†ï¼š  
![](https://static001.geekbang.org/resource/image/a1/71/a140ce0ef5yya414bb7c51879966a871.png?wh=756x126)

è®¿é—®ä»£ç†æœåŠ¡ [http://127.0.0.1:8087/demo/demo](http://127.0.0.1:8087/demo/demo)ï¼š  
![](https://static001.geekbang.org/resource/image/9c/35/9cfabbc9617ea7d382ef7a7656bbyy35.png?wh=819x223)

è¾“å‡ºäº†åç«¯æ¥å£å†…å®¹ã€‚

åŒæ—¶åœ¨ä»£ç ä¸­ä¿®æ”¹ä¸‹è¾“å‡ºå†…å®¹ä¹‹åï¼š

```go
func (api *DemoApi) Demo(c *gin.Context) {
   c.JSON(200, "this is demo for dev")
}
```

åœ¨æ§åˆ¶å°ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç­‰å¾…äº†3såï¼ˆè¿™é‡Œé…ç½®æ–‡ä»¶è®¾ç½®ä¸º3sï¼‰ï¼Œåœ¨æ§åˆ¶å°çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š  
![](https://static001.geekbang.org/resource/image/a9/77/a9f482cf449bdd63ab10b9589552f677.png?wh=766x251)

æ£€æµ‹åˆ°æ–‡ä»¶æ›´æ–°ï¼Œé‡å¯æœåŠ¡å¼€å¯ã€‚

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å†åˆ·æ–°æµè§ˆå™¨çš„æ¥å£ï¼Œè¾“å‡ºå·²ç»å˜åŒ–äº†ã€‚  
![](https://static001.geekbang.org/resource/image/8d/cd/8d2e45d4e396cda0772855466c864bcd.png?wh=826x257)  
åç«¯è°ƒè¯•æ¨¡å¼é€šè¿‡ï¼

### å‰åç«¯éªŒè¯

æœ€ååŒæ—¶éªŒè¯å‰ç«¯å’Œåç«¯ï¼Œå…¶å®å’Œå‰é¢å•ç‹¬éªŒè¯çš„æ–¹æ³•ä¸€æ ·ï¼Œåªæ˜¯å¯åŠ¨å‘½ä»¤æ¢æˆäº† `./hade dev all`

è¿™é‡Œæˆ‘ä»¬åŒæ—¶æ‰“å¼€ä¸¤ä¸ªçª—å£ï¼Œ[http://127.0.0.1:8070/demo/demo](http://127.0.0.1:8070/demo/demo)ã€[http://127.0.0.1:8070/#/](http://127.0.0.1:8070/#/)ï¼Œèƒ½åŒæ—¶çœ‹åˆ°å‰ç«¯å’Œåç«¯ä¿¡æ¯ï¼š  
![](https://static001.geekbang.org/resource/image/94/8b/948ca235cb9aaafafdfd019ec49c6e8b.png?wh=822x648)![](https://static001.geekbang.org/resource/image/24/a5/244a3f45c561081d2836da782c9d3ba5.png?wh=824x258)

ä¿®æ”¹å‰ç«¯msgå’Œä¿®æ”¹åç«¯å†…å®¹åï¼Œå˜æ›´ç”Ÿæ•ˆï¼š  
![](https://static001.geekbang.org/resource/image/b8/4b/b8322b3854a955ddab449324afb8574b.png?wh=822x686)![](https://static001.geekbang.org/resource/image/3e/8a/3eba5c41cdafd870878609274f05658a.png?wh=825x204)  
åˆ°è¿™é‡Œï¼Œå‰åç«¯åŒæ—¶è°ƒè¯•æ¨¡å¼éªŒè¯æˆåŠŸï¼

ä»Šå¤©çš„ä¸»è¦å†…å®¹æ˜¯åˆ›å»ºè°ƒè¯•æ¨¡å¼çš„ä¸‰ä¸ªäºŒçº§å‘½ä»¤ã€‚å®Œæ•´çš„ä»£ç ç¤ºä¾‹åœ¨GitHubä¸Šçš„ [geekbang/20](https://github.com/gohade/coredemo/tree/geekbang/20) åˆ†æ”¯ï¼Œæ¬¢è¿æ¯”å¯¹æŸ¥çœ‹ã€‚æœ¬èŠ‚è¯¾æˆ‘ä»¬åªåœ¨å‘½ä»¤æ–‡ä»¶ä¸­å¢åŠ äº†ä¸€ä¸ªframework/command/dev.goæ–‡ä»¶ï¼š  
![](https://static001.geekbang.org/resource/image/e7/y3/e7yy0d64af957beed7139733ac2fdyy3.png?wh=296x811)

## å°ç»“

ä»Šå¤©æˆ‘ä»¬å…·ä½“å®ç°äº†è°ƒè¯•æ¨¡å¼ï¼Œå…¶å®äº†è§£äº†ä¸ŠèŠ‚è¯¾å¯¹è°ƒè¯•æ¨¡å¼çš„è®¾è®¡ä¹‹åï¼Œä»Šå¤©çš„å†…å®¹ä¸»è¦æ˜¯ç»†èŠ‚ä¸Šçš„ä»£ç å®ç°äº†ï¼Œå°±æ˜¯å·¥ä½œé‡ã€‚ä¸è¿‡å…¶ä¸­çš„å®ç°ç»†èŠ‚ï¼Œä¹Ÿæ˜¯åœ¨å·¥ä½œä¸­ä¸æ–­ç§¯ç´¯ä¸‹æ¥çš„ï¼Œä½ å¯ä»¥å¤šå¤šä½“ä¼šã€‚

æ¯”å¦‚refresh\_timeè¿™ä¸ªè®¡æ—¶å™¨çª—å£è®¾è®¡ï¼Œåœ¨æœ€åˆç‰ˆæœ¬æ˜¯æ²¡æœ‰çš„ï¼Œåœ¨å®é™…å·¥ä½œä¸­ï¼Œä½¿ç”¨è¿™ä¸ªè°ƒè¯•æ¨¡å¼ï¼Œé‡åˆ°äº†é¢‘ç¹é‡å»ºçš„å›°æ‰°ï¼Œæ‰åšäº†è¿™ä¸ªè®¾è®¡ã€‚æ€»ä¹‹ï¼Œæ•´ä¸ªè°ƒè¯•æ¨¡å¼æ”¯æŒæ˜¯éå¸¸èµçš„ï¼Œå®ƒèƒ½è®©æˆ‘ä»¬çš„Webå¼€å‘æ•ˆç‡æé«˜äº†ä¸€ä¸ªæ¡£æ¬¡ï¼Œå¸Œæœ›ä½ ä¹Ÿèƒ½æ„ŸåŒèº«å—ã€‚

## æ€è€ƒé¢˜

åœ¨å›ç­”åŒå­¦ä»¬é—®é¢˜çš„æ—¶å€™ï¼Œæˆ‘å‘ç°æœ‰ä¸å°‘æ˜¯å…¶ä»–è¯­è¨€è½¬æ¥Goçš„ï¼Œä¸çŸ¥é“ä½ çš„ç»å†æ˜¯æ€æ ·çš„ï¼Œå¯ä»¥æ¥èŠä¸€èŠä½ åœ¨ä½¿ç”¨å…¶ä»–è¯­è¨€æ—¶ï¼Œè°ƒè¯•ä¸€ä¸ªç¨‹åºéƒ½æ˜¯æ€ä¹ˆè°ƒè¯•çš„å‘¢ï¼Ÿæœ‰æ²¡æœ‰æ¯”è¾ƒå¥½çš„è°ƒè¯•æ¨¡å¼ï¼Ÿ

æ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„æ€è€ƒã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ï½
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ11ï¼‰</strong></div><ul>
<li><span>å‹</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>å¦‚æœrefreshTimeè®¾ç½®çš„æ—¶é—´å¤ªçŸ­ é‚£ä¹ˆæ”¹ä¸€æ¬¡ä¼šrebuild3æ¬¡ </p>2021-12-11</li><br/><li><span>å®™æ–¯</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>æœ‰äº†è¿™ä¸ªè°ƒè¯•èµ·æ¥æ˜¯å¾ˆæ–¹ä¾¿ ï¼Œåªè¦æŠŠè‡ªå·±ç¼–è¯‘å‡ºæ¥äº†ï¼Œç„¶åå¯åŠ¨ï¼Œåç»­è°ƒè¯•å°±ä¼šè‡ªå·±ç¼–è¯‘è‡ªå·±ç„¶åè‡ªè¡Œå¯åŠ¨</p>2021-12-16</li><br/><li><span>qinsi</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>å®æ—¶é‡è½½(live reloading): ä»£ç å˜åŠ¨æ—¶é‡æ–°ç¼–è¯‘å’Œå¯åŠ¨appã€‚è¿™ä¸ªåº”è¯¥æ˜¯æ–‡ä¸­çš„æ¨¡å¼ï¼›

çƒ­é‡è½½(hot reloading): ä»£ç å˜åŠ¨æ—¶åŠ è½½å˜åŠ¨åçš„ä»£ç ï¼Œä¸é‡å¯appï¼Œä¿ç•™å½“å‰appçš„çŠ¶æ€ï¼›

è°ƒè¯•(debug): é€šå¸¸ç‰µæ¶‰åˆ°æ‰“æ–­ç‚¹ï¼Œå•æ­¥è·Ÿè¸ªç­‰ã€‚

å¦‚æœåªæ˜¯å®ç°live reloadçš„è¯ä¹Ÿå¯ä»¥å•ç‹¬ç”¨Airæˆ–nodemonç­‰ï¼Œå‰åç«¯åœ¨ä¸åŒçš„å­ç›®å½•é‡Œåˆ†åˆ«ä¿®æ”¹å’Œreloadä¹Ÿæ²¡å•¥é—®é¢˜ã€‚</p>2021-11-02</li><br/><li><span>å¼ æµ©è½©</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>å¤ªæœ‰æ„æ€äº†è¿™ä¸ªåŠŸèƒ½ï¼Œçˆ±äº†çˆ±äº†</p>2022-11-19</li><br/><li><span>Superdandan</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>é—®é¢˜ä¸€ï¼š cmd := exec.Command(path, &quot;run&quot;, &quot;dev&quot;, &quot;--&quot;, &quot;--port&quot;, port) ä½¿ç”¨vue3å¯åŠ¨å‰ç«¯è°ƒè¯•æ¨¡å¼çš„æ— æ³•è·³è½¬åˆ°å‰ç«¯ä¸»é¡µ
é—®é¢˜åŸå› ï¼švue3å¯åŠ¨ä¹‹åï¼Œé»˜è®¤è°ƒè¯•åœ°å€çš„hostæ˜¯localhost, çœ‹ä½ èƒ½å‡ºç° 127.0.0.1 æ— æ³•è·³è½¬çš„æƒ…å†µã€‚
è§£å†³æ–¹å¼ï¼š å¢åŠ hostå‚æ•°  cmd := exec.Command(path, &quot;run&quot;, &quot;dev&quot;, &quot;--&quot;, &quot;--port&quot;, port, &quot;--host&quot;, &quot;127.0.0.1&quot;)

é—®é¢˜äºŒï¼šå‰ç«¯ä¿®æ”¹çš„ä»£ç æ— æ³•é€šè¿‡ 127.0.0.1:8087 è®¿é—®çœ‹åˆ° 
é—®é¢˜åŸå› ï¼šcore.Use(static.Serve(&quot;&#47;&quot;, static.LocalFile(&quot;.&#47;dist&quot;, false))) å¯¼è‡´ è¯·æ±‚è¢«åç«¯æ•è·</p>2024-10-22</li><br/><li><span>Geek_6d3ca8</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>è¦è®¿é—®é¡µé¢æˆåŠŸ,è¦ä¿è¯ vue èƒ½åŸæœ¬å‘½ä»¤ build æˆåŠŸ,å³ npm run dev é‡Œæ‰§è¡Œçš„å®é™…å‘½ä»¤å¼å¯¹çš„,vite --host 127.0.0.1 --port 8071,ç¡®å®šä»£ç å¯åŠ¨çš„å‘½ä»¤æ˜¯æ­£ç¡®çš„,ç„¶åæ˜¯å¯åŠ¨çš„ç«¯å£èƒ½è¢«ä»£ç é‡Œçš„è½¬å‘çš„åœ°å€æˆåŠŸè®¿é—®åˆ°</p>2023-08-28</li><br/><li><span>Geek_6d3ca8</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>å¯åŠ¨å‰ç«¯ vue3 è¦ä¿®æ”¹ä¸€ä¸‹å‘½ä»¤,å¦‚æœæ˜¯ vite å¯åŠ¨çš„,å‚è€ƒå¦‚ä¸‹:
&#47;&#47; å¯åŠ¨å‰ç«¯æœåŠ¡
func (p *Proxy) restartFrontend() error {
	&#47;&#47; å¯åŠ¨å‰ç«¯è°ƒè¯•æ¨¡å¼
	&#47;&#47; å¦‚æœå·²ç»å¼€å¯äº†npm run serveï¼Œ ä»€ä¹ˆéƒ½ä¸åš
	if p.frontendPid != 0 {
		return nil
	}

	&#47;&#47; å¦åˆ™å¼€å¯npm run serve
	port := p.devConfig.Frontend.Port
	path, err := exec.LookPath(&quot;npm&quot;)
	if err != nil {
		return err
	}
&#47;&#47; ä¿®æ”¹ä¸ºæ­£ç¡®çš„é…ç½®è¿›æŒ‡å®šç«¯å£çš„å‘½ä»¤
	cmd := exec.Command(path, &quot;run&quot;, &quot;dev&quot;, &quot;--&quot;, &quot;--port&quot;, port)
	cmd.Env = os.Environ()
	cmd.Env = append(cmd.Env, fmt.Sprintf(&quot;%s%s&quot;, &quot;PORT=&quot;, port))
	cmd.Stdout = os.NewFile(0, os.DevNull)
	cmd.Stderr = os.Stderr
...
}
}</p>2023-08-28</li><br/><li><span>Geek_6d3ca8</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>ç”¨ npm run devå¯åŠ¨çš„ç«¯å£,å¹¶æ²¡æœ‰åœ¨ dev.goä»£ç é‡Œå¾—åˆ°ä¿®æ”¹,è¿™æ˜¯ä¸€ä¸ª bug,  VITE v4.4.9  ready in 611 ms

  âœ  Local:   http:&#47;&#47;localhost:5173&#47;
</p>2023-08-28</li><br/><li><span>Tal.Huang</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>è·‘èµ·æ¥äº† ä½†æ˜¯é¡µé¢æ˜¯ç©ºç™½çš„ï¼š
(base) huanghaitao@huanghaitaodeMacBook-Pro skeleton % .&#47;skeleton build all

&gt; skeleton-vue@0.0.0 build
&gt; run-p type-check build-only


&gt; skeleton-vue@0.0.0 type-check
&gt; vue-tsc --noEmit -p tsconfig.vitest.json --composite false


&gt; skeleton-vue@0.0.0 build-only
&gt; vite build

vite v4.0.3 building for production...
transforming...
âœ“ 48 modules transformed.
rendering chunks...
computing gzip size...
dist&#47;assets&#47;logo-da9b9095.svg        0.31 kB
dist&#47;index.html                      0.42 kB
dist&#47;assets&#47;AboutView-4d995ba2.css   0.09 kB â”‚ gzip:  0.10 kB
dist&#47;assets&#47;index-b9365240.css       4.18 kB â”‚ gzip:  1.31 kB
dist&#47;assets&#47;AboutView-3daf4bd4.js    0.23 kB â”‚ gzip:  0.20 kB
dist&#47;assets&#47;index-25bb1ea1.js       84.51 kB â”‚ gzip: 33.25 kB
=============  å‰ç«¯ç¼–è¯‘æˆåŠŸ ============
ç¼–è¯‘skeletonæˆåŠŸ

base) huanghaitao@huanghaitaodeMacBook-Pro skeleton % .&#47;skeleton dev all
å¯åŠ¨åç«¯æœåŠ¡:  http:&#47;&#47;127.0.0.1:8072
ç›‘æ§æ–‡ä»¶å¤¹ï¼š &#47;Users&#47;huanghaitao&#47;go&#47;src&#47;skeleton&#47;app
åç«¯æœåŠ¡pid: 13785
å¯åŠ¨å‰ç«¯æœåŠ¡:  http:&#47;&#47;127.0.0.1:8071
å‰ç«¯æœåŠ¡pid: 13786
ä»£ç†æœåŠ¡å¯åŠ¨: http:&#47;&#47;127.0.0.1:8070
[PID] 13785
app serve url: :8072

&gt; skeleton-vue@0.0.0 dev
&gt; vite


  VITE v4.0.3  ready in 545 ms

  âœ  Local:   http:&#47;&#47;localhost:5173&#47;
  âœ  Network: use --host to expose

http:&#47;&#47;127.0.0.1:8070&#47; æ˜¾ç¤ºç©ºç™½é¡µé¢
http:&#47;&#47;127.0.0.1:8070&#47;demo&#47;demo  æ˜¾ç¤º[{&quot;id&quot;:1,&quot;name&quot;:&quot;foo&quot;},{&quot;id&quot;:2,&quot;name&quot;:&quot;bar&quot;}]

https:&#47;&#47;github.com&#47;skeleton1231&#47;skeleton
è¿˜å¸Œæœ›è€å¸ˆæŒ‡å¯¼ä¸‹</p>2023-01-04</li><br/><li><span>tsunamiShi</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>æ§åˆ¶å°ä¹Ÿç›‘å¬æ–‡ä»¶å¤¹äº†ï¼Œä¿®æ”¹æ–‡ä»¶å¤¹ä¹Ÿé‡å¯æœåŠ¡äº†ï¼Œä½†æ˜¯åˆ·æ–°æµè§ˆå™¨å¹¶æ²¡æœ‰æ”¹å˜ï¼Œ</p>2022-05-12</li><br/><li><span>tsunamiShi</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>åç«¯ä¿®æ”¹apiæ–‡ä»¶ï¼Œåˆ·æ–°æµè§ˆå™¨å¹¶æ²¡æœ‰æ”¹å˜ï¼Œè¯·é—®æ˜¯ä»€ä¹ˆåŸå› å•Šï¼Ÿ</p>2022-05-12</li><br/>
</ul>