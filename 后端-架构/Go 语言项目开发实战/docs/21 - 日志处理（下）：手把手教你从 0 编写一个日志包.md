ä½ å¥½ï¼Œæˆ‘æ˜¯å­”ä»¤é£ã€‚

ä¸Šä¸€è®²æˆ‘ä»‹ç»äº†å¦‚ä½•è®¾è®¡æ—¥å¿—åŒ…ï¼Œä»Šå¤©æ˜¯å®æˆ˜ç¯èŠ‚ï¼Œæˆ‘ä¼šæ‰‹æŠŠæ‰‹æ•™ä½ ä»0ç¼–å†™ä¸€ä¸ªæ—¥å¿—åŒ…ã€‚

åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸€äº›ä¼˜ç§€çš„å¼€æºæ—¥å¿—åŒ…ï¼Œä¸åŠ ä¿®æ”¹ç›´æ¥æ‹¿æ¥ä½¿ç”¨ã€‚ä½†æ›´å¤šæ—¶å€™ï¼Œæ˜¯åŸºäºä¸€ä¸ªæˆ–æŸå‡ ä¸ªä¼˜ç§€çš„å¼€æºæ—¥å¿—åŒ…è¿›è¡ŒäºŒæ¬¡å¼€å‘ã€‚æƒ³è¦å¼€å‘æˆ–è€…äºŒæ¬¡å¼€å‘ä¸€ä¸ªæ—¥å¿—åŒ…ï¼Œå°±è¦æŒæ¡æ—¥å¿—åŒ…çš„å®ç°æ–¹å¼ã€‚é‚£ä¹ˆè¿™ä¸€è®²ä¸­ï¼Œæˆ‘æ¥å¸¦ä½ ä»0åˆ°1ï¼Œå®ç°ä¸€ä¸ªå…·å¤‡åŸºæœ¬åŠŸèƒ½çš„æ—¥å¿—åŒ…ï¼Œè®©ä½ ä»ä¸­ä¸€çª¥æ—¥å¿—åŒ…çš„å®ç°åŸç†å’Œå®ç°æ–¹æ³•ã€‚

åœ¨å¼€å§‹å®æˆ˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ç›®å‰ä¸šç•Œæœ‰å“ªäº›ä¼˜ç§€çš„å¼€æºæ—¥å¿—åŒ…ã€‚

## æœ‰å“ªäº›ä¼˜ç§€çš„å¼€æºæ—¥å¿—åŒ…ï¼Ÿ

åœ¨Goé¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹ä¸€äº›ä¼˜ç§€çš„å¼€æºæ—¥å¿—åŒ…ï¼Œæ¥å®ç°é¡¹ç›®çš„æ—¥å¿—åŒ…ã€‚Goç”Ÿæ€ä¸­æœ‰å¾ˆå¤šä¼˜ç§€çš„å¼€æºæ—¥å¿—åŒ…ï¼Œä¾‹å¦‚æ ‡å‡†åº“logåŒ…ã€glogã€logrusã€zapã€seelogã€zerologã€log15ã€apex/logã€go-loggingç­‰ã€‚å…¶ä¸­ï¼Œç”¨å¾—æ¯”è¾ƒå¤šçš„æ˜¯æ ‡å‡†åº“logåŒ…ã€glogã€logruså’Œzapã€‚

ä¸ºäº†ä½¿ä½ äº†è§£å¼€æºæ—¥å¿—åŒ…çš„ç°çŠ¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šç®€å•ä»‹ç»ä¸‹è¿™å‡ ä¸ªå¸¸ç”¨çš„æ—¥å¿—åŒ…ã€‚è‡³äºå®ƒä»¬çš„å…·ä½“ä½¿ç”¨æ–¹æ³•ï¼Œä½ å¯ä»¥å‚è€ƒæˆ‘æ•´ç†çš„ä¸€ç¯‡æ–‡ç« ï¼š[ä¼˜ç§€å¼€æºæ—¥å¿—åŒ…ä½¿ç”¨æ•™ç¨‹](https://github.com/marmotedu/geekbang-go/blob/master/%E4%BC%98%E7%A7%80%E5%BC%80%E6%BA%90%E6%97%A5%E5%BF%97%E5%8C%85%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.md)ã€‚

### æ ‡å‡†åº“logåŒ…

æ ‡å‡†åº“logåŒ…çš„åŠŸèƒ½éå¸¸ç®€å•ï¼Œåªæä¾›äº†Printã€Panicå’ŒFatalä¸‰ç±»å‡½æ•°ç”¨äºæ—¥å¿—è¾“å‡ºã€‚å› ä¸ºæ˜¯æ ‡å‡†åº“è‡ªå¸¦çš„ï¼Œæ‰€ä»¥ä¸éœ€è¦æˆ‘ä»¬ä¸‹è½½å®‰è£…ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ã€‚

æ ‡å‡†åº“logåŒ…åªæœ‰ä¸åˆ°400è¡Œçš„ä»£ç é‡ï¼Œå¦‚æœä½ æƒ³ç ”ç©¶å¦‚ä½•å®ç°ä¸€ä¸ªæ—¥å¿—åŒ…ï¼Œé˜…è¯»æ ‡å‡†åº“logåŒ…æ˜¯ä¸€ä¸ªä¸é”™çš„å¼€å§‹ã€‚Goçš„æ ‡å‡†åº“å¤§é‡ä½¿ç”¨äº†logåŒ…ï¼Œä¾‹å¦‚`net/http` ã€ `net/rpc` ç­‰ã€‚

### glog

[glog](https://github.com/golang/glog)æ˜¯Googleæ¨å‡ºçš„æ—¥å¿—åŒ…ï¼Œè·Ÿæ ‡å‡†åº“logåŒ…ä¸€æ ·ï¼Œå®ƒæ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ—¥å¿—åŒ…ï¼Œä½¿ç”¨èµ·æ¥ç®€å•æ–¹ä¾¿ã€‚ä½†glogæ¯”æ ‡å‡†åº“logåŒ…æä¾›äº†æ›´å¤šçš„åŠŸèƒ½ï¼Œå®ƒå…·æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š

- æ”¯æŒ4ç§æ—¥å¿—çº§åˆ«ï¼šInfoã€Warningã€Errorã€Fatalã€‚
- æ”¯æŒå‘½ä»¤è¡Œé€‰é¡¹ï¼Œä¾‹å¦‚`-alsologtostderr`ã€`-log_backtrace_at`ã€`-log_dir`ã€`-logtostderr`ã€`-v`ç­‰ï¼Œæ¯ä¸ªå‚æ•°å®ç°æŸç§åŠŸèƒ½ã€‚
- æ”¯æŒæ ¹æ®æ–‡ä»¶å¤§å°åˆ‡å‰²æ—¥å¿—æ–‡ä»¶ã€‚
- æ”¯æŒæ—¥å¿—æŒ‰çº§åˆ«åˆ†ç±»è¾“å‡ºã€‚
- æ”¯æŒV levelã€‚V levelç‰¹æ€§å¯ä»¥ä½¿å¼€å‘è€…è‡ªå®šä¹‰æ—¥å¿—çº§åˆ«ã€‚
- æ”¯æŒvmoduleã€‚vmoduleå¯ä»¥ä½¿å¼€å‘è€…å¯¹ä¸åŒçš„æ–‡ä»¶ä½¿ç”¨ä¸åŒçš„æ—¥å¿—çº§åˆ«ã€‚
- æ”¯æŒtraceLocationã€‚traceLocationå¯ä»¥æ‰“å°å‡ºæŒ‡å®šä½ç½®çš„æ ˆä¿¡æ¯ã€‚

Kubernetesé¡¹ç›®å°±ä½¿ç”¨äº†åŸºäºglogå°è£…çš„klogï¼Œä½œä¸ºå…¶æ—¥å¿—åº“ã€‚

### logrus

[logrus](https://github.com/sirupsen/logrus)æ˜¯ç›®å‰GitHubä¸Šstaræ•°é‡æœ€å¤šçš„æ—¥å¿—åŒ…ï¼Œå®ƒçš„ä¼˜ç‚¹æ˜¯åŠŸèƒ½å¼ºå¤§ã€æ€§èƒ½é«˜æ•ˆã€é«˜åº¦çµæ´»ï¼Œè¿˜æä¾›äº†è‡ªå®šä¹‰æ’ä»¶çš„åŠŸèƒ½ã€‚å¾ˆå¤šä¼˜ç§€çš„å¼€æºé¡¹ç›®ï¼Œä¾‹å¦‚Dockerã€Prometheusç­‰ï¼Œéƒ½ä½¿ç”¨äº†logrusã€‚é™¤äº†å…·æœ‰æ—¥å¿—çš„åŸºæœ¬åŠŸèƒ½å¤–ï¼Œlogrusè¿˜å…·æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š

- æ”¯æŒå¸¸ç”¨çš„æ—¥å¿—çº§åˆ«ã€‚logrusæ”¯æŒDebugã€Infoã€Warnã€Errorã€Fatalå’ŒPanicè¿™äº›æ—¥å¿—çº§åˆ«ã€‚
- å¯æ‰©å±•ã€‚logrusçš„Hookæœºåˆ¶å…è®¸ä½¿ç”¨è€…é€šè¿‡Hookçš„æ–¹å¼ï¼Œå°†æ—¥å¿—åˆ†å‘åˆ°ä»»æ„åœ°æ–¹ï¼Œä¾‹å¦‚æœ¬åœ°æ–‡ä»¶ã€æ ‡å‡†è¾“å‡ºã€Elasticsearchã€Logstashã€Kafkaç­‰ã€‚
- æ”¯æŒè‡ªå®šä¹‰æ—¥å¿—æ ¼å¼ã€‚logruså†…ç½®äº†JSONFormatterå’ŒTextFormatterä¸¤ç§æ ¼å¼ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œlogrusè¿˜å…è®¸ä½¿ç”¨è€…é€šè¿‡å®ç°Formatteræ¥å£ï¼Œæ¥è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼ã€‚
- ç»“æ„åŒ–æ—¥å¿—è®°å½•ã€‚logrusçš„Fieldæœºåˆ¶å…è®¸ä½¿ç”¨è€…è‡ªå®šä¹‰æ—¥å¿—å­—æ®µï¼Œè€Œä¸æ˜¯é€šè¿‡å†—é•¿çš„æ¶ˆæ¯æ¥è®°å½•æ—¥å¿—ã€‚
- é¢„è®¾æ—¥å¿—å­—æ®µã€‚logrusçš„Default Fieldsæœºåˆ¶ï¼Œå¯ä»¥ç»™ä¸€éƒ¨åˆ†æˆ–è€…å…¨éƒ¨æ—¥å¿—ç»Ÿä¸€æ·»åŠ å…±åŒçš„æ—¥å¿—å­—æ®µï¼Œä¾‹å¦‚ç»™æŸæ¬¡HTTPè¯·æ±‚çš„æ‰€æœ‰æ—¥å¿—æ·»åŠ X-Request-IDå­—æ®µã€‚
- Fatal handlersã€‚logruså…è®¸æ³¨å†Œä¸€ä¸ªæˆ–å¤šä¸ªhandlerï¼Œå½“äº§ç”ŸFatalçº§åˆ«çš„æ—¥å¿—æ—¶è°ƒç”¨ã€‚å½“æˆ‘ä»¬çš„ç¨‹åºéœ€è¦ä¼˜é›…å…³é—­æ—¶ï¼Œè¿™ä¸ªç‰¹æ€§ä¼šéå¸¸æœ‰ç”¨ã€‚

### zap

[zap](https://github.com/uber-go/zap)æ˜¯uberå¼€æºçš„æ—¥å¿—åŒ…ï¼Œä»¥é«˜æ€§èƒ½è‘—ç§°ï¼Œå¾ˆå¤šå…¬å¸çš„æ—¥å¿—åŒ…éƒ½æ˜¯åŸºäºzapæ”¹é€ è€Œæ¥ã€‚é™¤äº†å…·æœ‰æ—¥å¿—åŸºæœ¬çš„åŠŸèƒ½ä¹‹å¤–ï¼Œzapè¿˜å…·æœ‰å¾ˆå¤šå¼ºå¤§çš„ç‰¹æ€§ï¼š

- æ”¯æŒå¸¸ç”¨çš„æ—¥å¿—çº§åˆ«ï¼Œä¾‹å¦‚ï¼šDebugã€Infoã€Warnã€Errorã€DPanicã€Panicã€Fatalã€‚
- æ€§èƒ½éå¸¸é«˜ã€‚zapå…·æœ‰éå¸¸é«˜çš„æ€§èƒ½ï¼Œé€‚åˆå¯¹æ€§èƒ½è¦æ±‚æ¯”è¾ƒé«˜çš„åœºæ™¯ã€‚
- æ”¯æŒé’ˆå¯¹ç‰¹å®šçš„æ—¥å¿—çº§åˆ«ï¼Œè¾“å‡ºè°ƒç”¨å †æ ˆã€‚
- åƒlogrusä¸€æ ·ï¼Œzapä¹Ÿæ”¯æŒç»“æ„åŒ–çš„ç›®å½•æ—¥å¿—ã€é¢„è®¾æ—¥å¿—å­—æ®µï¼Œä¹Ÿå› ä¸ºæ”¯æŒHookè€Œå…·æœ‰å¯æ‰©å±•æ€§ã€‚

### å¼€æºæ—¥å¿—åŒ…é€‰æ‹©

ä¸Šé¢æˆ‘ä»‹ç»äº†å¾ˆå¤šæ—¥å¿—åŒ…ï¼Œæ¯ç§æ—¥å¿—åŒ…ä½¿ç”¨çš„åœºæ™¯ä¸åŒï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚ï¼Œç»“åˆæ—¥å¿—åŒ…çš„ç‰¹æ€§è¿›è¡Œé€‰æ‹©ï¼š

- **æ ‡å‡†åº“logåŒ…ï¼š** æ ‡å‡†åº“logåŒ…ä¸æ”¯æŒæ—¥å¿—çº§åˆ«ã€æ—¥å¿—åˆ†å‰²ã€æ—¥å¿—æ ¼å¼ç­‰åŠŸèƒ½ï¼Œæ‰€ä»¥åœ¨å¤§å‹é¡¹ç›®ä¸­å¾ˆå°‘ç›´æ¥ä½¿ç”¨ï¼Œé€šå¸¸ç”¨äºä¸€äº›çŸ­å°çš„ç¨‹åºï¼Œæ¯”å¦‚ç”¨äºç”ŸæˆJWT Tokençš„main.goæ–‡ä»¶ä¸­ã€‚æ ‡å‡†åº“æ—¥å¿—åŒ…ä¹Ÿå¾ˆé€‚åˆä¸€äº›ç®€çŸ­çš„ä»£ç ï¼Œç”¨äºå¿«é€Ÿè°ƒè¯•å’ŒéªŒè¯ã€‚
- **glogï¼š** glogå®ç°äº†æ—¥å¿—åŒ…çš„åŸºæœ¬åŠŸèƒ½ï¼Œéå¸¸é€‚åˆä¸€äº›å¯¹æ—¥å¿—åŠŸèƒ½è¦æ±‚ä¸å¤šçš„å°å‹é¡¹ç›®ã€‚
- **logrusï¼š** logrusåŠŸèƒ½å¼ºå¤§ï¼Œä¸ä»…å®ç°äº†æ—¥å¿—åŒ…çš„åŸºæœ¬åŠŸèƒ½ï¼Œè¿˜æœ‰å¾ˆå¤šé«˜çº§ç‰¹æ€§ï¼Œé€‚åˆä¸€äº›å¤§å‹é¡¹ç›®ï¼Œå°¤å…¶æ˜¯éœ€è¦ç»“æ„åŒ–æ—¥å¿—è®°å½•çš„é¡¹ç›®ã€‚
- **zapï¼š** zapæä¾›äº†å¾ˆå¼ºå¤§çš„æ—¥å¿—åŠŸèƒ½ï¼Œæ€§èƒ½é«˜ï¼Œå†…å­˜åˆ†é…æ¬¡æ•°å°‘ï¼Œé€‚åˆå¯¹æ—¥å¿—æ€§èƒ½è¦æ±‚å¾ˆé«˜çš„é¡¹ç›®ã€‚å¦å¤–ï¼ŒzapåŒ…ä¸­çš„å­åŒ…zapcoreï¼Œæä¾›äº†å¾ˆå¤šåº•å±‚çš„æ—¥å¿—æ¥å£ï¼Œé€‚åˆç”¨æ¥åšäºŒæ¬¡å°è£…ã€‚

ä¸¾ä¸ªæˆ‘è‡ªå·±é€‰æ‹©æ—¥å¿—åŒ…æ¥è¿›è¡ŒäºŒæ¬¡å¼€å‘çš„ä¾‹å­ï¼šæˆ‘åœ¨åšå®¹å™¨äº‘å¹³å°å¼€å‘æ—¶ï¼Œå‘ç°Kubernetesæºç ä¸­å¤§é‡ä½¿ç”¨äº†glogï¼Œè¿™æ—¶å°±éœ€è¦æ—¥å¿—åŒ…èƒ½å¤Ÿå…¼å®¹glogã€‚äºæ˜¯ï¼Œæˆ‘åŸºäºzapå’Œzapcoreå°è£…äº†[github.com/marmotedu/iam/pkg/log](https://github.com/marmotedu/iam/tree/master/pkg/log)æ—¥å¿—åŒ…ï¼Œè¿™ä¸ªæ—¥å¿—åŒ…å¯ä»¥å¾ˆå¥½åœ°å…¼å®¹glogã€‚

åœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­ï¼Œä½ å¯ä»¥æ ¹æ®é¡¹ç›®éœ€è¦ï¼Œä»ä¸Šé¢å‡ ä¸ªæ—¥å¿—åŒ…ä¸­è¿›è¡Œé€‰æ‹©ï¼Œç›´æ¥ä½¿ç”¨ï¼Œä½†æ›´å¤šæ—¶å€™ï¼Œä½ è¿˜éœ€è¦åŸºäºè¿™äº›åŒ…æ¥è¿›è¡Œå®šåˆ¶å¼€å‘ã€‚ä¸ºäº†ä½¿ä½ æ›´æ·±å…¥åœ°æŒæ¡æ—¥å¿—åŒ…çš„è®¾è®¡å’Œå¼€å‘ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šä»0åˆ°1å¸¦ä½ å¼€å‘ä¸€ä¸ªæ—¥å¿—åŒ…ã€‚

## ä»0ç¼–å†™ä¸€ä¸ªæ—¥å¿—åŒ…

æ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šå‘ä½ å±•ç¤ºå¦‚ä½•å¿«é€Ÿç¼–å†™ä¸€ä¸ªå…·å¤‡åŸºæœ¬åŠŸèƒ½çš„æ—¥å¿—åŒ…ï¼Œè®©ä½ é€šè¿‡è¿™ä¸ªç®€çŸ­çš„æ—¥å¿—åŒ…å®ç°æŒæ¡æ—¥å¿—åŒ…çš„æ ¸å¿ƒè®¾è®¡æ€è·¯ã€‚è¯¥æ—¥å¿—åŒ…ä¸»è¦å®ç°ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½ï¼š

- æ”¯æŒè‡ªå®šä¹‰é…ç½®ã€‚
- æ”¯æŒæ–‡ä»¶åå’Œè¡Œå·ã€‚
- æ”¯æŒæ—¥å¿—çº§åˆ« Debugã€Infoã€Warnã€Errorã€Panicã€Fatalã€‚
- æ”¯æŒè¾“å‡ºåˆ°æœ¬åœ°æ–‡ä»¶å’Œæ ‡å‡†è¾“å‡ºã€‚
- æ”¯æŒJSONå’ŒTEXTæ ¼å¼çš„æ—¥å¿—è¾“å‡ºï¼Œæ”¯æŒè‡ªå®šä¹‰æ—¥å¿—æ ¼å¼ã€‚
- æ”¯æŒé€‰é¡¹æ¨¡å¼ã€‚

æ—¥å¿—åŒ…åç§°ä¸º`cuslog`ï¼Œç¤ºä¾‹é¡¹ç›®å®Œæ•´ä»£ç å­˜æ”¾åœ¨ [cuslog](https://github.com/marmotedu/gopractise-demo/tree/main/log/cuslog)ã€‚

å…·ä½“å®ç°åˆ†ä¸ºä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š

1. å®šä¹‰ï¼šå®šä¹‰æ—¥å¿—çº§åˆ«å’Œæ—¥å¿—é€‰é¡¹ã€‚
2. åˆ›å»ºï¼šåˆ›å»ºLoggeråŠå„çº§åˆ«æ—¥å¿—æ‰“å°æ–¹æ³•ã€‚
3. å†™å…¥ï¼šå°†æ—¥å¿—è¾“å‡ºåˆ°æ”¯æŒçš„è¾“å‡ºä¸­ã€‚
4. è‡ªå®šä¹‰ï¼šè‡ªå®šä¹‰æ—¥å¿—è¾“å‡ºæ ¼å¼ã€‚

### å®šä¹‰æ—¥å¿—çº§åˆ«å’Œæ—¥å¿—é€‰é¡¹

ä¸€ä¸ªåŸºæœ¬çš„æ—¥å¿—åŒ…ï¼Œé¦–å…ˆéœ€è¦å®šä¹‰å¥½æ—¥å¿—çº§åˆ«å’Œæ—¥å¿—é€‰é¡¹ã€‚æœ¬ç¤ºä¾‹å°†å®šä¹‰ä»£ç ä¿å­˜åœ¨[options.go](https://github.com/marmotedu/gopractise-demo/blob/main/log/cuslog/options.go)æ–‡ä»¶ä¸­ã€‚

å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼å®šä¹‰æ—¥å¿—çº§åˆ«ï¼š

```
type Level uint8

const (
    DebugLevel Level = iota
    InfoLevel
    WarnLevel
    ErrorLevel
    PanicLevel
    FatalLevel
)

var LevelNameMapping = map[Level]string{
    DebugLevel: "DEBUG",
    InfoLevel:  "INFO",
    WarnLevel:  "WARN",
    ErrorLevel: "ERROR",
    PanicLevel: "PANIC",
    FatalLevel: "FATAL",
}
```

åœ¨æ—¥å¿—è¾“å‡ºæ—¶ï¼Œè¦é€šè¿‡å¯¹æ¯”å¼€å…³çº§åˆ«å’Œè¾“å‡ºçº§åˆ«çš„å¤§å°ï¼Œæ¥å†³å®šæ˜¯å¦è¾“å‡ºï¼Œæ‰€ä»¥æ—¥å¿—çº§åˆ«Levelè¦å®šä¹‰æˆæ–¹ä¾¿æ¯”è¾ƒçš„æ•°å€¼ç±»å‹ã€‚å‡ ä¹æ‰€æœ‰çš„æ—¥å¿—åŒ…éƒ½æ˜¯ç”¨å¸¸é‡è®¡æ•°å™¨iotaæ¥å®šä¹‰æ—¥å¿—çº§åˆ«ã€‚

å¦å¤–ï¼Œå› ä¸ºè¦åœ¨æ—¥å¿—è¾“å‡ºä¸­ï¼Œè¾“å‡ºå¯è¯»çš„æ—¥å¿—çº§åˆ«ï¼ˆä¾‹å¦‚è¾“å‡ºINFOè€Œä¸æ˜¯1ï¼‰ï¼Œæ‰€ä»¥éœ€è¦æœ‰Levelåˆ°Level Nameçš„æ˜ å°„LevelNameMappingï¼ŒLevelNameMappingä¼šåœ¨æ ¼å¼åŒ–æ—¶ç”¨åˆ°ã€‚

æ¥ä¸‹æ¥çœ‹å®šä¹‰æ—¥å¿—é€‰é¡¹ã€‚æ—¥å¿—éœ€è¦æ˜¯å¯é…ç½®çš„ï¼Œæ–¹ä¾¿å¼€å‘è€…æ ¹æ®ä¸åŒçš„ç¯å¢ƒè®¾ç½®ä¸åŒçš„æ—¥å¿—è¡Œä¸ºï¼Œæ¯”è¾ƒå¸¸è§çš„é…ç½®é€‰é¡¹ä¸ºï¼š

- æ—¥å¿—çº§åˆ«ã€‚
- è¾“å‡ºä½ç½®ï¼Œä¾‹å¦‚æ ‡å‡†è¾“å‡ºæˆ–è€…æ–‡ä»¶ã€‚
- è¾“å‡ºæ ¼å¼ï¼Œä¾‹å¦‚JSONæˆ–è€…Textã€‚
- æ˜¯å¦å¼€å¯æ–‡ä»¶åå’Œè¡Œå·ã€‚

æœ¬ç¤ºä¾‹çš„æ—¥å¿—é€‰é¡¹å®šä¹‰å¦‚ä¸‹ï¼š

```
type options struct {
    output        io.Writer
    level         Level
    stdLevel      Level
    formatter     Formatter
    disableCaller bool
}
```

ä¸ºäº†çµæ´»åœ°è®¾ç½®æ—¥å¿—çš„é€‰é¡¹ï¼Œä½ å¯ä»¥é€šè¿‡é€‰é¡¹æ¨¡å¼ï¼Œæ¥å¯¹æ—¥å¿—é€‰é¡¹è¿›è¡Œè®¾ç½®ï¼š

```
type Option func(*options)

func initOptions(opts ...Option) (o *options) {
    o = &options{}
    for _, opt := range opts {
        opt(o)
    }

    if o.output == nil {
        o.output = os.Stderr
    }

    if o.formatter == nil {
        o.formatter = &TextFormatter{}
    }

    return
}

func WithLevel(level Level) Option {
    return func(o *options) {
        o.level = level
    }
}
...
func SetOptions(opts ...Option) {
    std.SetOptions(opts...)
}

func (l *logger) SetOptions(opts ...Option) {
    l.mu.Lock()
    defer l.mu.Unlock()

    for _, opt := range opts {
        opt(l.opt)
    }
}
```

å…·æœ‰é€‰é¡¹æ¨¡å¼çš„æ—¥å¿—åŒ…ï¼Œå¯é€šè¿‡ä»¥ä¸‹æ–¹å¼ï¼Œæ¥åŠ¨æ€åœ°ä¿®æ”¹æ—¥å¿—çš„é€‰é¡¹ï¼š

```
cuslog.SetOptions(cuslog.WithLevel(cuslog.DebugLevel))
```

ä½ å¯ä»¥æ ¹æ®éœ€è¦ï¼Œå¯¹æ¯ä¸€ä¸ªæ—¥å¿—é€‰é¡¹åˆ›å»ºè®¾ç½®å‡½æ•° `WithXXXX` ã€‚è¿™ä¸ªç¤ºä¾‹æ—¥å¿—åŒ…æ”¯æŒå¦‚ä¸‹é€‰é¡¹è®¾ç½®å‡½æ•°ï¼š

- WithOutputï¼ˆoutput io.Writerï¼‰ï¼šè®¾ç½®è¾“å‡ºä½ç½®ã€‚
- WithLevelï¼ˆlevel Levelï¼‰ï¼šè®¾ç½®è¾“å‡ºçº§åˆ«ã€‚
- WithFormatterï¼ˆformatter Formatterï¼‰ï¼šè®¾ç½®è¾“å‡ºæ ¼å¼ã€‚
- WithDisableCallerï¼ˆcaller boolï¼‰ï¼šè®¾ç½®æ˜¯å¦æ‰“å°æ–‡ä»¶åå’Œè¡Œå·ã€‚

### åˆ›å»ºLoggeråŠå„çº§åˆ«æ—¥å¿—æ‰“å°æ–¹æ³•

ä¸ºäº†æ‰“å°æ—¥å¿—ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®æ—¥å¿—é…ç½®ï¼Œåˆ›å»ºä¸€ä¸ªLoggerï¼Œç„¶åé€šè¿‡è°ƒç”¨Loggerçš„æ—¥å¿—æ‰“å°æ–¹æ³•ï¼Œå®Œæˆå„çº§åˆ«æ—¥å¿—çš„è¾“å‡ºã€‚æœ¬ç¤ºä¾‹å°†åˆ›å»ºä»£ç ä¿å­˜åœ¨[logger.go](https://github.com/marmotedu/gopractise-demo/blob/main/log/cuslog/logger.go)æ–‡ä»¶ä¸­ã€‚

å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼åˆ›å»ºLoggerï¼š

```
var std = New()

type logger struct {
    opt       *options
    mu        sync.Mutex
    entryPool *sync.Pool
}

func New(opts ...Option) *logger {
    logger := &logger{opt: initOptions(opts...)}
    logger.entryPool = &sync.Pool{New: func() interface{} { return entry(logger) }}
    return logger
}
```

ä¸Šè¿°ä»£ç ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªLoggerï¼Œå¹¶å®ç°äº†åˆ›å»ºLoggerçš„Newå‡½æ•°ã€‚æ—¥å¿—åŒ…éƒ½ä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„å…¨å±€Loggerï¼Œæœ¬ç¤ºä¾‹é€šè¿‡ `var std = New()` åˆ›å»ºäº†ä¸€ä¸ªå…¨å±€çš„é»˜è®¤Loggerã€‚cuslog.Debugã€cuslog.Infoå’Œcuslog.Warnfç­‰å‡½æ•°ï¼Œåˆ™æ˜¯é€šè¿‡è°ƒç”¨std Loggeræ‰€æä¾›çš„æ–¹æ³•æ¥æ‰“å°æ—¥å¿—çš„ã€‚

å®šä¹‰äº†ä¸€ä¸ªLoggerä¹‹åï¼Œè¿˜éœ€è¦ç»™è¯¥Loggeræ·»åŠ æœ€æ ¸å¿ƒçš„æ—¥å¿—æ‰“å°æ–¹æ³•ï¼Œè¦æä¾›æ‰€æœ‰æ”¯æŒçº§åˆ«çš„æ—¥å¿—æ‰“å°æ–¹æ³•ã€‚

å¦‚æœæ—¥å¿—çº§åˆ«æ˜¯Xyzï¼Œåˆ™é€šå¸¸éœ€è¦æä¾›ä¸¤ç±»æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯éæ ¼å¼åŒ–æ–¹æ³•`Xyz(args ...interface{})`å’Œæ ¼å¼åŒ–æ–¹æ³•`Xyzf(format string, args ...interface{})`ï¼Œä¾‹å¦‚ï¼š

```
func (l *logger) Debug(args ...interface{}) {
    l.entry().write(DebugLevel, FmtEmptySeparate, args...)
}
func (l *logger) Debugf(format string, args ...interface{}) {
    l.entry().write(DebugLevel, format, args...)
}
```

æœ¬ç¤ºä¾‹å®ç°äº†å¦‚ä¸‹æ–¹æ³•ï¼šDebugã€Debugfã€Infoã€Infofã€Warnã€Warnfã€Errorã€Errorfã€Panicã€Panicfã€Fatalã€Fatalfã€‚æ›´è¯¦ç»†çš„å®ç°ï¼Œä½ å¯ä»¥å‚è€ƒ [cuslog/logger.go](https://github.com/marmotedu/gopractise-demo/blob/main/log/cuslog/logger.go)ã€‚

è¿™é‡Œè¦æ³¨æ„ï¼ŒPanicã€Panicfè¦è°ƒç”¨panic()å‡½æ•°ï¼ŒFatalã€Fatalfå‡½æ•°è¦è°ƒç”¨ `os.Exit(1)` å‡½æ•°ã€‚

### å°†æ—¥å¿—è¾“å‡ºåˆ°æ”¯æŒçš„è¾“å‡ºä¸­

è°ƒç”¨æ—¥å¿—æ‰“å°å‡½æ•°ä¹‹åï¼Œè¿˜éœ€è¦å°†è¿™äº›æ—¥å¿—è¾“å‡ºåˆ°æ”¯æŒçš„è¾“å‡ºä¸­ï¼Œæ‰€ä»¥éœ€è¦å®ç°writeå‡½æ•°ï¼Œå®ƒçš„å†™å…¥é€»è¾‘ä¿å­˜åœ¨[entry.go](https://github.com/marmotedu/gopractise-demo/blob/main/log/cuslog/entry.go)æ–‡ä»¶ä¸­ã€‚å®ç°æ–¹å¼å¦‚ä¸‹ï¼š

```
type Entry struct {
    logger *logger
    Buffer *bytes.Buffer
    Map    map[string]interface{}
    Level  Level
    Time   time.Time
    File   string
    Line   int
    Func   string
    Format string
    Args   []interface{}
}

func (e *Entry) write(level Level, format string, args ...interface{}) {
    if e.logger.opt.level > level {
        return
    }
    e.Time = time.Now()
    e.Level = level
    e.Format = format
    e.Args = args
    if !e.logger.opt.disableCaller {
        if pc, file, line, ok := runtime.Caller(2); !ok {
            e.File = "???"
            e.Func = "???"
        } else {
            e.File, e.Line, e.Func = file, line, runtime.FuncForPC(pc).Name()
            e.Func = e.Func[strings.LastIndex(e.Func, "/")+1:]
        }
    }
    e.format()
    e.writer()
    e.release()
}

func (e *Entry) format() {
    _ = e.logger.opt.formatter.Format(e)
}

func (e *Entry) writer() {
    e.logger.mu.Lock()
    _, _ = e.logger.opt.output.Write(e.Buffer.Bytes())
    e.logger.mu.Unlock()
}

func (e *Entry) release() {
    e.Args, e.Line, e.File, e.Format, e.Func = nil, 0, "", "", ""
    e.Buffer.Reset()
    e.logger.entryPool.Put(e)
}
```

ä¸Šè¿°ä»£ç ï¼Œé¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªEntryç»“æ„ä½“ç±»å‹ï¼Œè¯¥ç±»å‹ç”¨æ¥ä¿å­˜æ‰€æœ‰çš„æ—¥å¿—ä¿¡æ¯ï¼Œå³æ—¥å¿—é…ç½®å’Œæ—¥å¿—å†…å®¹ã€‚å†™å…¥é€»è¾‘éƒ½æ˜¯å›´ç»•Entryç±»å‹çš„å®ä¾‹æ¥å®Œæˆçš„ã€‚

ç”¨Entryçš„writeæ–¹æ³•æ¥å®Œæˆæ—¥å¿—çš„å†™å…¥ï¼Œåœ¨writeæ–¹æ³•ä¸­ï¼Œä¼šé¦–å…ˆåˆ¤æ–­æ—¥å¿—çš„è¾“å‡ºçº§åˆ«å’Œå¼€å…³çº§åˆ«ï¼Œå¦‚æœè¾“å‡ºçº§åˆ«å°äºå¼€å…³çº§åˆ«ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œä¸åšä»»ä½•è®°å½•ã€‚

åœ¨writeä¸­ï¼Œè¿˜ä¼šåˆ¤æ–­æ˜¯å¦éœ€è¦è®°å½•æ–‡ä»¶åå’Œè¡Œå·ï¼Œå¦‚æœéœ€è¦åˆ™è°ƒç”¨ `runtime.Caller()` æ¥è·å–æ–‡ä»¶åå’Œè¡Œå·ï¼Œè°ƒç”¨ `runtime.Caller()` æ—¶ï¼Œè¦æ³¨æ„ä¼ å…¥æ­£ç¡®çš„æ ˆæ·±åº¦ã€‚

writeå‡½æ•°ä¸­è°ƒç”¨ `e.format` æ¥æ ¼å¼åŒ–æ—¥å¿—ï¼Œè°ƒç”¨ `e.writer` æ¥å†™å…¥æ—¥å¿—ï¼Œåœ¨åˆ›å»ºLoggerä¼ å…¥çš„æ—¥å¿—é…ç½®ä¸­ï¼ŒæŒ‡å®šäº†è¾“å‡ºä½ç½® `output io.Writer` ï¼Œoutputç±»å‹ä¸º `io.Writer` ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

```
type Writer interface {
    Write(p []byte) (n int, err error)
}
```

io.Writerå®ç°äº†Writeæ–¹æ³•å¯ä¾›å†™å…¥ï¼Œæ‰€ä»¥åªéœ€è¦è°ƒç”¨`e.logger.opt.output.Write(e.Buffer.Bytes())`å³å¯å°†æ—¥å¿—å†™å…¥åˆ°æŒ‡å®šçš„ä½ç½®ä¸­ã€‚æœ€åï¼Œä¼šè°ƒç”¨release()æ–¹æ³•æ¥æ¸…ç©ºç¼“å­˜å’Œå¯¹è±¡æ± ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†æ—¥å¿—çš„è®°å½•å’Œå†™å…¥ã€‚

### è‡ªå®šä¹‰æ—¥å¿—è¾“å‡ºæ ¼å¼

cuslogåŒ…æ”¯æŒè‡ªå®šä¹‰è¾“å‡ºæ ¼å¼ï¼Œå¹¶ä¸”å†…ç½®äº†JSONå’ŒTextæ ¼å¼çš„Formatterã€‚Formatteræ¥å£å®šä¹‰ä¸ºï¼š

```
type Formatter interface {
    Format(entry *Entry) error
}
```

cuslogå†…ç½®çš„Formatteræœ‰ä¸¤ä¸ªï¼š[JSON](https://github.com/marmotedu/gopractise-demo/blob/main/log/cuslog/formatter_json.go)å’Œ[TEXT](https://github.com/marmotedu/gopractise-demo/blob/main/log/cuslog/formatter_text.go)ã€‚

### æµ‹è¯•æ—¥å¿—åŒ…

cuslogæ—¥å¿—åŒ…å¼€å‘å®Œæˆä¹‹åï¼Œå¯ä»¥ç¼–å†™æµ‹è¯•ä»£ç ï¼Œè°ƒç”¨cuslogåŒ…æ¥æµ‹è¯•cuslogåŒ…ï¼Œä»£ç å¦‚ä¸‹ï¼š

```
package main

import (
    "log"
    "os"

    "github.com/marmotedu/gopractise-demo/log/cuslog"
)

func main() {
    cuslog.Info("std log")
    cuslog.SetOptions(cuslog.WithLevel(cuslog.DebugLevel))
    cuslog.Debug("change std log to debug level")
    cuslog.SetOptions(cuslog.WithFormatter(&cuslog.JsonFormatter{IgnoreBasicFields: false}))
    cuslog.Debug("log in json format")
    cuslog.Info("another log in json format")

    // è¾“å‡ºåˆ°æ–‡ä»¶
    fd, err := os.OpenFile("test.log", os.O_APPEND|os.O_CREATE|os.O_WRONLY, 0644)
    if err != nil {
        log.Fatalln("create file test.log failed")
    }
    defer fd.Close()

    l := cuslog.New(cuslog.WithLevel(cuslog.InfoLevel),
        cuslog.WithOutput(fd),
        cuslog.WithFormatter(&cuslog.JsonFormatter{IgnoreBasicFields: false}),
    )
    l.Info("custom log with json formatter")
}
```

å°†ä¸Šè¿°ä»£ç ä¿å­˜åœ¨main.goæ–‡ä»¶ä¸­ï¼Œè¿è¡Œï¼š

```
$ go run example.go
2020-12-04T10:32:12+08:00 INFO example.go:11 std log
2020-12-04T10:32:12+08:00 DEBUG example.go:13 change std log to debug level
{"file":"/home/colin/workspace/golang/src/github.com/marmotedu/gopractise-demo/log/cuslog/example/example.go:15","func":"main.main","message":"log in json format","level":"DEBUG","time":"2020-12-04T10:32:12+08:00"}
{"level":"INFO","time":"2020-12-04T10:32:12+08:00","file":"/home/colin/workspace/golang/src/github.com/marmotedu/gopractise-demo/log/cuslog/example/example.go:16","func":"main.main","message":"another log in json format"}
```

åˆ°è¿™é‡Œæ—¥å¿—åŒ…å°±å¼€å‘å®Œæˆäº†ï¼Œå®Œæ•´åŒ…è§ [log/cuslog](https://github.com/marmotedu/gopractise-demo/tree/main/log/cuslog)ã€‚

## IAMé¡¹ç›®æ—¥å¿—åŒ…è®¾è®¡

è¿™ä¸€è®²çš„æœ€åï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹æˆ‘ä»¬çš„IAMé¡¹ç›®ä¸­ï¼Œæ—¥å¿—åŒ…æ˜¯æ€ä¹ˆè®¾è®¡çš„ã€‚

å…ˆæ¥çœ‹ä¸€ä¸‹IAMé¡¹ç›®logåŒ…çš„å­˜æ”¾ä½ç½®ï¼š[pkg/log](https://github.com/marmotedu/iam/tree/v1.0.0/pkg/log)ã€‚æ”¾åœ¨è¿™ä¸ªä½ç½®ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ï¼šç¬¬ä¸€ä¸ªï¼ŒlogåŒ…å±äºIAMé¡¹ç›®ï¼Œæœ‰å®šåˆ¶å¼€å‘çš„å†…å®¹ï¼›ç¬¬äºŒä¸ªï¼ŒlogåŒ…åŠŸèƒ½å®Œå¤‡ã€æˆç†Ÿï¼Œå¤–éƒ¨é¡¹ç›®ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚

è¯¥logåŒ…æ˜¯åŸºäº `go.uber.org/zap` åŒ…å°è£…è€Œæ¥çš„ï¼Œæ ¹æ®éœ€è¦æ·»åŠ äº†æ›´ä¸°å¯Œçš„åŠŸèƒ½ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡logåŒ…çš„[Options](https://github.com/marmotedu/iam/blob/master/pkg/log/options.go#L47)ï¼Œæ¥çœ‹ä¸‹logåŒ…æ‰€å®ç°çš„åŠŸèƒ½ï¼š

```
type Options struct {
    OutputPaths       []string `json:"output-paths"       mapstructure:"output-paths"`
    ErrorOutputPaths  []string `json:"error-output-paths" mapstructure:"error-output-paths"`
    Level             string   `json:"level"              mapstructure:"level"`
    Format            string   `json:"format"             mapstructure:"format"`
    DisableCaller     bool     `json:"disable-caller"     mapstructure:"disable-caller"`
    DisableStacktrace bool     `json:"disable-stacktrace" mapstructure:"disable-stacktrace"`
    EnableColor       bool     `json:"enable-color"       mapstructure:"enable-color"`
    Development       bool     `json:"development"        mapstructure:"development"`
    Name              string   `json:"name"               mapstructure:"name"`
}
```

Optionså„é…ç½®é¡¹å«ä¹‰å¦‚ä¸‹ï¼š

- developmentï¼šæ˜¯å¦æ˜¯å¼€å‘æ¨¡å¼ã€‚å¦‚æœæ˜¯å¼€å‘æ¨¡å¼ï¼Œä¼šå¯¹DPanicLevelè¿›è¡Œå †æ ˆè·Ÿè¸ªã€‚
- nameï¼šLoggerçš„åå­—ã€‚
- disable-callerï¼šæ˜¯å¦å¼€å¯ callerï¼Œå¦‚æœå¼€å¯ä¼šåœ¨æ—¥å¿—ä¸­æ˜¾ç¤ºè°ƒç”¨æ—¥å¿—æ‰€åœ¨çš„æ–‡ä»¶ã€å‡½æ•°å’Œè¡Œå·ã€‚
- disable-stacktraceï¼šæ˜¯å¦åœ¨PanicåŠä»¥ä¸Šçº§åˆ«ç¦æ­¢æ‰“å°å †æ ˆä¿¡æ¯ã€‚
- enable-colorï¼šæ˜¯å¦å¼€å¯é¢œè‰²è¾“å‡ºï¼Œtrueï¼Œæ˜¯ï¼›falseï¼Œå¦ã€‚
- levelï¼šæ—¥å¿—çº§åˆ«ï¼Œä¼˜å…ˆçº§ä»ä½åˆ°é«˜ä¾æ¬¡ä¸ºï¼šDebug, Info, Warn, Error, Dpanic, Panic, Fatalã€‚
- formatï¼šæ”¯æŒçš„æ—¥å¿—è¾“å‡ºæ ¼å¼ï¼Œç›®å‰æ”¯æŒConsoleå’ŒJSONä¸¤ç§ã€‚Consoleå…¶å®å°±æ˜¯Textæ ¼å¼ã€‚
- output-pathsï¼šæ”¯æŒè¾“å‡ºåˆ°å¤šä¸ªè¾“å‡ºï¼Œç”¨é€—å·åˆ†å¼€ã€‚æ”¯æŒè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰å’Œæ–‡ä»¶ã€‚
- error-output-pathsï¼šzapå†…éƒ¨(éä¸šåŠ¡)é”™è¯¯æ—¥å¿—è¾“å‡ºè·¯å¾„ï¼Œå¤šä¸ªè¾“å‡ºï¼Œç”¨é€—å·åˆ†å¼€ã€‚

logåŒ…çš„Optionsç»“æ„ä½“æ”¯æŒä»¥ä¸‹3ä¸ªæ–¹æ³•ï¼š

- Buildæ–¹æ³•ã€‚Buildæ–¹æ³•å¯ä»¥æ ¹æ®Optionsæ„å»ºä¸€ä¸ªå…¨å±€çš„Loggerã€‚
- AddFlagsæ–¹æ³•ã€‚AddFlagsæ–¹æ³•å¯ä»¥å°†Optionsçš„å„ä¸ªå­—æ®µè¿½åŠ åˆ°ä¼ å…¥çš„pflag.FlagSetå˜é‡ä¸­ã€‚
- Stringæ–¹æ³•ã€‚Stringæ–¹æ³•å¯ä»¥å°†Optionsçš„å€¼ä»¥JSONæ ¼å¼å­—ç¬¦ä¸²è¿”å›ã€‚

logåŒ…å®ç°äº†ä»¥ä¸‹3ç§æ—¥å¿—è®°å½•æ–¹æ³•ï¼š

```
log.Info("This is a info message", log.Int32("int_key", 10))
log.Infof("This is a formatted %s message", "info")
log.Infow("Message printed with Infow", "X-Request-ID", "fbf54504-64da-4088-9b86-67824a7fb508")
```

`Info` ä½¿ç”¨æŒ‡å®šçš„key/valueè®°å½•æ—¥å¿—ã€‚`Infof` æ ¼å¼åŒ–è®°å½•æ—¥å¿—ã€‚ `Infow` ä¹Ÿæ˜¯ä½¿ç”¨æŒ‡å®šçš„key/valueè®°å½•æ—¥å¿—ï¼Œè·Ÿ `Info` çš„åŒºåˆ«æ˜¯ï¼šä½¿ç”¨ `Info` éœ€è¦æŒ‡å®šå€¼çš„ç±»å‹ï¼Œé€šè¿‡æŒ‡å®šå€¼çš„æ—¥å¿—ç±»å‹ï¼Œæ—¥å¿—åº“åº•å±‚ä¸éœ€è¦è¿›è¡Œåå°„æ“ä½œï¼Œæ‰€ä»¥ä½¿ç”¨ `Info` è®°å½•æ—¥å¿—æ€§èƒ½æœ€é«˜ã€‚

logåŒ…æ”¯æŒéå¸¸ä¸°å¯Œçš„ç±»å‹ï¼Œå…·ä½“ä½ å¯ä»¥å‚è€ƒ [types.go](https://github.com/marmotedu/iam/blob/master/pkg/log/types.go#L56)ã€‚

ä¸Šè¿°æ—¥å¿—è¾“å‡ºä¸ºï¼š

```
2021-07-06 14:02:07.070 INFO This is a info message {"int_key": 10}
2021-07-06 14:02:07.071 INFO This is a formatted info message
2021-07-06 14:02:07.071 INFO Message printed with Infow {"X-Request-ID": "fbf54504-64da-4088-9b86-67824a7fb508"}
```

logåŒ…ä¸ºæ¯ç§çº§åˆ«çš„æ—¥å¿—éƒ½æä¾›äº†3ç§æ—¥å¿—è®°å½•æ–¹å¼ï¼Œä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾æ—¥å¿—æ ¼å¼ä¸º `Xyz` ï¼Œåˆ™åˆ†åˆ«æä¾›äº† `Xyz(msg string, fields ...Field)` ï¼Œ`Xyzf(format string, v ...interface{})` ï¼Œ`Xyzw(msg string, keysAndValues ...interface{})` 3ç§æ—¥å¿—è®°å½•æ–¹æ³•ã€‚

å¦å¤–ï¼ŒlogåŒ…ç›¸è¾ƒäºä¸€èˆ¬çš„æ—¥å¿—åŒ…ï¼Œè¿˜æä¾›äº†ä¼—å¤šè®°å½•æ—¥å¿—çš„æ–¹æ³•ã€‚

**ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼Œ** logåŒ…æ”¯æŒV Levelï¼Œå¯ä»¥é€šè¿‡æ•´å‹æ•°å€¼æ¥çµæ´»æŒ‡å®šæ—¥å¿—çº§åˆ«ï¼Œæ•°å€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šä½ã€‚ä¾‹å¦‚ï¼š

```
// V levelä½¿ç”¨
log.V(1).Info("This is a V level message")
log.V(1).Infof("This is a %s V level message", "formatted")
log.V(1).Infow("This is a V level message with fields", "X-Request-ID", "7a7b9f24-4cae-4b2a-9464-69088b45b904")
```

è¿™é‡Œè¦æ³¨æ„ï¼ŒLog.Våªæ”¯æŒ `Info` ã€`Infof` ã€`Infow`ä¸‰ç§æ—¥å¿—è®°å½•æ–¹æ³•ã€‚

**ç¬¬äºŒä¸ªæ–¹æ³•ï¼Œ** logåŒ…æ”¯æŒWithValueså‡½æ•°ï¼Œä¾‹å¦‚ï¼š

```
// WithValuesä½¿ç”¨
lv := log.WithValues("X-Request-ID", "7a7b9f24-4cae-4b2a-9464-69088b45b904")
lv.Infow("Info message printed with [WithValues] logger")
lv.Infow("Debug message printed with [WithValues] logger")
```

ä¸Šè¿°æ—¥å¿—è¾“å‡ºå¦‚ä¸‹ï¼š

```
2021-07-06 14:15:28.555 INFO Info message printed with [WithValues] logger {"X-Request-ID": "7a7b9f24-4cae-4b2a-9464-69088b45b904"}
2021-07-06 14:15:28.556 INFO Debug message printed with [WithValues] logger {"X-Request-ID": "7a7b9f24-4cae-4b2a-9464-69088b45b904"}
```

`WithValues` å¯ä»¥è¿”å›ä¸€ä¸ªæºå¸¦æŒ‡å®škey-valueçš„Loggerï¼Œä¾›åé¢ä½¿ç”¨ã€‚

**ç¬¬ä¸‰ä¸ªæ–¹æ³•ï¼Œ** logåŒ…æä¾› `WithContext` å’Œ `FromContext` ç”¨æ¥å°†æŒ‡å®šçš„Loggeræ·»åŠ åˆ°æŸä¸ªContextä¸­ï¼Œä»¥åŠä»æŸä¸ªContextä¸­è·å–Loggerï¼Œä¾‹å¦‚ï¼š

```
// Contextä½¿ç”¨
ctx := lv.WithContext(context.Background())
lc := log.FromContext(ctx)
lc.Info("Message printed with [WithContext] logger")
```

`WithContext`å’Œ`FromContext`éå¸¸é€‚åˆç”¨åœ¨ä»¥`context.Context`ä¼ é€’çš„å‡½æ•°ä¸­ï¼Œä¾‹å¦‚ï¼š

```
func main() {
 
    ...
 
    // WithValuesä½¿ç”¨
    lv := log.WithValues("X-Request-ID", "7a7b9f24-4cae-4b2a-9464-69088b45b904")
     
    // Contextä½¿ç”¨
    lv.Infof("Start to call pirntString")
    ctx := lv.WithContext(context.Background())
    pirntString(ctx, "World")  
}
 
func pirntString(ctx context.Context, str string) {
    lc := log.FromContext(ctx)
    lc.Infof("Hello %s", str)
}
```

ä¸Šè¿°ä»£ç è¾“å‡ºå¦‚ä¸‹ï¼š

```
2021-07-06 14:38:02.050 INFO Start to call pirntString {"X-Request-ID": "7a7b9f24-4cae-4b2a-9464-69088b45b904"}
2021-07-06 14:38:02.050 INFO Hello World {"X-Request-ID": "7a7b9f24-4cae-4b2a-9464-69088b45b904"}
```

å°†Loggeræ·»åŠ åˆ°Contextä¸­ï¼Œå¹¶é€šè¿‡Contextåœ¨ä¸åŒå‡½æ•°é—´ä¼ é€’ï¼Œå¯ä»¥ä½¿key-valueåœ¨ä¸åŒå‡½æ•°é—´ä¼ é€’ã€‚ä¾‹å¦‚ä¸Šè¿°ä»£ç ä¸­ï¼Œ `X-Request-ID` åœ¨mainå‡½æ•°ã€printStringå‡½æ•°ä¸­çš„æ—¥å¿—è¾“å‡ºä¸­å‡æœ‰è®°å½•ï¼Œä»è€Œå®ç°äº†ä¸€ç§è°ƒç”¨é“¾çš„æ•ˆæœã€‚

**ç¬¬å››ä¸ªæ–¹æ³•ï¼Œ** å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä»Contextä¸­æå–å‡ºæŒ‡å®šçš„key-valueï¼Œä½œä¸ºä¸Šä¸‹æ–‡æ·»åŠ åˆ°æ—¥å¿—è¾“å‡ºä¸­ï¼Œä¾‹å¦‚ [internal/apiserver/api/v1/user/create.go](https://github.com/marmotedu/iam/blob/v1.0.0/internal/apiserver/api/v1/user/create.go#L20)æ–‡ä»¶ä¸­çš„æ—¥å¿—è°ƒç”¨ï¼š

```
log.L(c).Info("user create function called.")
```

é€šè¿‡è°ƒç”¨ `Log.L()` å‡½æ•°ï¼Œå®ç°å¦‚ä¸‹ï¼š

```
// L method output with specified context value.
func L(ctx context.Context) *zapLogger {
    return std.L(ctx)
}
 
func (l *zapLogger) L(ctx context.Context) *zapLogger {
    lg := l.clone()
 
    requestID, _ := ctx.Value(KeyRequestID).(string)
    username, _ := ctx.Value(KeyUsername).(string)
    lg.zapLogger = lg.zapLogger.With(zap.String(KeyRequestID, requestID), zap.String(KeyUsername, username))
 
    return lg
}
```

`L()` æ–¹æ³•ä¼šä»ä¼ å…¥çš„Contextä¸­æå–å‡º `requestID` å’Œ `username` ï¼Œè¿½åŠ åˆ°Loggerä¸­ï¼Œå¹¶è¿”å›Loggerã€‚è¿™æ—¶å€™è°ƒç”¨è¯¥Loggerçš„Infoã€Infofã€Infowç­‰æ–¹æ³•è®°å½•æ—¥å¿—ï¼Œè¾“å‡ºçš„æ—¥å¿—ä¸­å‡åŒ…å« `requestID` å’Œ `username` å­—æ®µï¼Œä¾‹å¦‚ï¼š

```
2021-07-06 14:46:00.743 INFO    apiserver       secret/create.go:23     create secret function called.  {"requestID": "73144bed-534d-4f68-8e8d-dc8a8ed48507", "username": "admin"}
```

é€šè¿‡å°†Contextåœ¨å‡½æ•°é—´ä¼ é€’ï¼Œå¾ˆå®¹æ˜“å°±èƒ½å®ç°è°ƒç”¨é“¾æ•ˆæœï¼Œä¾‹å¦‚ï¼š

```
// Create add new secret key pairs to the storage.
func (s *SecretHandler) Create(c *gin.Context) {
    log.L(c).Info("create secret function called.")
     
    ...
     
    secrets, err := s.srv.Secrets().List(c, username, metav1.ListOptions{    
        Offset: pointer.ToInt64(0),
        Limit:  pointer.ToInt64(-1),
    })
     
    ...
     
     if err := s.srv.Secrets().Create(c, &r, metav1.CreateOptions{}); err != nil {
        core.WriteResponse(c, err, nil)

        return
    }
 
    core.WriteResponse(c, nil, r)
}
```

ä¸Šè¿°ä»£ç è¾“å‡ºä¸ºï¼š

```
2021-07-06 14:46:00.743 INFO    apiserver       secret/create.go:23     create secret function called.  {"requestID": "73144bed-534d-4f68-8e8d-dc8a8ed48507", "username": "admin"}
2021-07-06 14:46:00.744 INFO    apiserver       secret/create.go:23     list secret from storage.  {"requestID": "73144bed-534d-4f68-8e8d-dc8a8ed48507", "username": "admin"}
2021-07-06 14:46:00.745 INFO    apiserver       secret/create.go:23     insert secret to storage.  {"requestID": "73144bed-534d-4f68-8e8d-dc8a8ed48507", "username": "admin"}
```

è¿™é‡Œè¦æ³¨æ„ï¼Œ `log.L` å‡½æ•°é»˜è®¤ä¼šä»Contextä¸­å– `requestID` å’Œ `username` é”®ï¼Œè¿™è·ŸIAMé¡¹ç›®æœ‰è€¦åˆåº¦ï¼Œä½†è¿™ä¸å½±å“logåŒ…ä¾›ç¬¬ä¸‰æ–¹é¡¹ç›®ä½¿ç”¨ã€‚è¿™ä¹Ÿæ˜¯æˆ‘å»ºè®®ä½ è‡ªå·±å°è£…æ—¥å¿—åŒ…çš„åŸå› ã€‚

## æ€»ç»“

å¼€å‘ä¸€ä¸ªæ—¥å¿—åŒ…ï¼Œæˆ‘ä»¬å¾ˆå¤šæ—¶å€™éœ€è¦åŸºäºä¸€äº›ä¸šç•Œä¼˜ç§€çš„å¼€æºæ—¥å¿—åŒ…è¿›è¡ŒäºŒæ¬¡å¼€å‘ã€‚å½“å‰å¾ˆå¤šé¡¹ç›®çš„æ—¥å¿—åŒ…éƒ½æ˜¯åŸºäºzapæ—¥å¿—åŒ…æ¥å°è£…çš„ï¼Œå¦‚æœä½ æœ‰å°è£…çš„éœ€è¦ï¼Œæˆ‘å»ºè®®ä½ ä¼˜å…ˆé€‰æ‹©zapæ—¥å¿—åŒ…ã€‚

è¿™ä¸€è®²ä¸­ï¼Œæˆ‘å…ˆç»™ä½ ä»‹ç»äº†æ ‡å‡†åº“logåŒ…ã€glogã€logruså’Œzapè¿™å››ç§å¸¸ç”¨çš„æ—¥å¿—åŒ…ï¼Œç„¶åå‘ä½ å±•ç°äº†å¼€å‘ä¸€ä¸ªæ—¥å¿—åŒ…çš„å››ä¸ªæ­¥éª¤ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š

1. å®šä¹‰æ—¥å¿—çº§åˆ«å’Œæ—¥å¿—é€‰é¡¹ã€‚
2. åˆ›å»ºLoggeråŠå„çº§åˆ«æ—¥å¿—æ‰“å°æ–¹æ³•ã€‚
3. å°†æ—¥å¿—è¾“å‡ºåˆ°æ”¯æŒçš„è¾“å‡ºä¸­ã€‚
4. è‡ªå®šä¹‰æ—¥å¿—è¾“å‡ºæ ¼å¼ã€‚

æœ€åï¼Œæˆ‘ä»‹ç»äº†IAMé¡¹ç›®å°è£…çš„logåŒ…çš„è®¾è®¡å’Œä½¿ç”¨æ–¹å¼ã€‚logåŒ…åŸºäº `go.uber.org/zap`å°è£…ï¼Œå¹¶æä¾›äº†ä»¥ä¸‹å¼ºå¤§ç‰¹æ€§ï¼š

- logåŒ…æ”¯æŒV Levelï¼Œå¯ä»¥çµæ´»çš„é€šè¿‡æ•´å‹æ•°å€¼æ¥æŒ‡å®šæ—¥å¿—çº§åˆ«ã€‚
- logåŒ…æ”¯æŒ `WithValues` å‡½æ•°ï¼Œ `WithValues` å¯ä»¥è¿”å›ä¸€ä¸ªæºå¸¦æŒ‡å®škey-valueå¯¹çš„Loggerï¼Œä¾›åé¢ä½¿ç”¨ã€‚
- logåŒ…æä¾› `WithContext` å’Œ `FromContext` ç”¨æ¥å°†æŒ‡å®šçš„Loggeræ·»åŠ åˆ°æŸä¸ªContextä¸­å’Œä»æŸä¸ªContextä¸­è·å–Loggerã€‚
- logåŒ…æä¾›äº† `Log.L()` å‡½æ•°ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„ä»Contextä¸­æå–å‡ºæŒ‡å®šçš„key-valueå¯¹ï¼Œä½œä¸ºä¸Šä¸‹æ–‡æ·»åŠ åˆ°æ—¥å¿—è¾“å‡ºä¸­ã€‚

## è¯¾åç»ƒä¹ 

1. å°è¯•å®ç°ä¸€ä¸ªæ–°çš„Formatterï¼Œå¯ä»¥ä½¿ä¸åŒæ—¥å¿—çº§åˆ«ä»¥ä¸åŒé¢œè‰²è¾“å‡ºï¼ˆä¾‹å¦‚ï¼šErrorçº§åˆ«çš„æ—¥å¿—è¾“å‡ºä¸­ `Error` å­—ç¬¦ä¸²ç”¨çº¢è‰²å­—ä½“è¾“å‡ºï¼Œ `Info` å­—ç¬¦ä¸²ç”¨ç™½è‰²å­—ä½“è¾“å‡ºï¼‰ã€‚
2. å°è¯•å°†[runtime.Caller(2)](https://github.com/marmotedu/gopractise-demo/blob/master/log/cuslog/entry.go#L36)å‡½æ•°è°ƒç”¨ä¸­çš„ `2` æ”¹æˆ `1` ï¼Œçœ‹çœ‹æ—¥å¿—è¾“å‡ºæ˜¯å¦è·Ÿä¿®æ”¹å‰æœ‰å·®å¼‚ï¼Œå¦‚æœæœ‰å·®å¼‚ï¼Œæ€è€ƒå·®å¼‚äº§ç”Ÿçš„åŸå› ã€‚

æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºä¸æˆ‘äº¤æµè®¨è®ºï¼Œæˆ‘ä»¬ä¸‹ä¸€è®²è§ã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ15ï¼‰</strong></div><ul>
<li><span>ppd0705</span> ğŸ‘ï¼ˆ16ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>Caller(skip int) 0ä»£è¡¨å½“å‰å±‚ï¼Œ 1ä»£è¡¨ä¸Šä¸€æ¬¡è°ƒç”¨è€…ï¼Œä¸€æ¬¡ç±»æ¨ã€‚ å¯¹äºlogåŒ…ç”±äºå°è£…äº†2å±‚ï¼ˆEntry.write --&gt; Debugï¼‰ï¼Œæ‰€ä»¥Caller(2)èƒ½å¾—åˆ°ç”¨æˆ·å‡½æ•°çš„è°ƒç”¨æ ˆä¿¡æ¯</p>2021-08-04</li><br/><li><span>ä¸€å¿µä¹‹é—´</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>æ²¡å•¥ç”¨ï¼Œæœ€é‡è¦çš„å†™å…¥kafak,logstashåªå­—æœªæï¼Œå‘µå‘µäº†</p>2022-06-24</li><br/><li><span>helloworld</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>å‘ç°iamé¡¹ç›®çš„logåŒ…æœ‰ä¸ªä¸¥é‡çš„bug, æµ‹è¯•å¤§æ‰¹é‡å†™æ—¥å¿—åˆ°æ–‡ä»¶, åªèƒ½æˆåŠŸå†™å…¥ä¸€å°éƒ¨åˆ†, æ¯”å¦‚:
        defer log.Flush()
	for i := 0; i &lt;= 20000; i++ {
		log.Info(&quot;hello world&quot;)
	}
 åªèƒ½æˆåŠŸå†™å…¥299æ¡æ—¥å¿—, é¢„æœŸåº”è¯¥æ˜¯2ä¸‡æ¡æ—¥å¿—.

logåŒ…: github.com&#47;marmotedu&#47;iam&#47;pkg&#47;log
</p>2021-10-28</li><br/><li><span>Geek_399957</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>å¦‚æœæˆ‘éœ€è¦æ ¹æ®ä¸åŒçš„åœºæ™¯è¾“å‡ºåˆ°ä¸åŒæ–‡ä»¶ï¼Œæ˜¯å¦æ¯æ¬¡éƒ½éœ€è¦æ–°å»ºä¸€ä¸ª log å‘¢ï¼Œè¿™æ ·åšå¹¶å‘æƒ…å†µä¸‹æ˜¯å¦æœ‰é—®é¢˜å‘¢</p>2021-08-14</li><br/><li><span>å¾æµ·æµª</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>å°è¯•å°†runtime.Caller(2)å‡½æ•°è°ƒç”¨ä¸­çš„ 2 æ”¹æˆ 1 ï¼Œçœ‹çœ‹æ—¥å¿—è¾“å‡ºæ˜¯å¦è·Ÿä¿®æ”¹å‰æœ‰å·®å¼‚ï¼Œå¦‚æœæœ‰å·®å¼‚ï¼Œæ€è€ƒå·®å¼‚äº§ç”Ÿçš„åŸå› ã€‚
------
*Entry.write:0 -&gt; cuslog.Info:1 -&gt; main.main:2 -&gt; ...
æ‰€ä»¥2æ˜¯æ‰“å°mainå‡½æ•°çš„æ–‡ä»¶å’Œè¡Œå·ï¼Œ1æ‰“å°çš„åˆ™æ˜¯Infoçš„æ–‡ä»¶å’Œè¡Œå·
è¿˜æ‹“å±•äº†è§£åˆ°runtime.Caller(n)å¯¹æ—¥å¿—ç»„ä»¶æ€§èƒ½çš„å½±å“åŠå…¶å–èˆ</p>2021-07-29</li><br/><li><span>Nio</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>IAM é¡¹ç›® log åŒ…çš„æ€§èƒ½æ¯”è¾ƒå¤§æ¦‚æ˜¯ä»€ä¹ˆæ ·å­å‘¢</p>2021-07-13</li><br/><li><span>helloworld</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p> log.Int32(&quot;int_key&quot;, 10)è¿˜æœ‰V Levelè¿™ä¸¤å¤„æ²¡æœ‰getåˆ°æ˜¯å¹²å•¥ç”¨çš„</p>2021-07-13</li><br/><li><span>tinyğŸŒ¾</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>logè¾“å‡ºæ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¼šæŠ¥å‡ºpanic</p>2022-10-19</li><br/><li><span>Geek_6bdb4e</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>å¦‚ä½•å®ç°åœ¨ä¸åŒç¯å¢ƒä»¥ä¸åŒçš„æ ¼å¼ï¼ˆprod: json, dev: console, local:console+enableColorï¼‰è¾“å‡ºæ—¥å¿—å‘¢</p>2022-05-17</li><br/><li><span>Geek_6bdb4e</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>å¦‚æœæœåŠ¡æ˜¯éƒ¨ç½²åœ¨dockeré‡Œé¢ï¼Œè¯¥å¦‚ä½•åˆ©ç”¨logrotateè¿™ä¸ªå·¥å…·å®ç°æ—¥å¿—è½®è½¬å‘¢</p>2022-05-17</li><br/><li><span>Geek_6bdb4e</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>æˆ‘çœ‹äº†ä¸€ä¸‹iamé¡¹ç›®é‡Œé¢çš„logçš„ä½¿ç”¨æ–¹æ³•ï¼Œå‘ç°WIthValuesè¿™ä¸ªæ–¹æ³•ä½¿ç”¨çš„å¹¶ä¸æ˜¯å¾ˆå¤šï¼Œæƒ³é—®ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•åœ¨é¡¹ç›®é‡Œé¢çš„ä½¿ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä½ çœ‹æˆ‘è¿™ç§ä½¿ç”¨åœºæ™¯çš„æ‰“å¼€æ–¹å¼å¯¹ä¸å¯¹ï¼Œå°±æ˜¯åœ¨internalç›®å½•é‡ŒåŒ…å«apiserverã€authzserverç­‰ç­‰ï¼Œå…¶ä¸‹åˆåˆ†controllerã€serviceã€storeç­‰æ¨¡å—ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥åœ¨æ¯ä¸ªæ¨¡å—éƒ½åˆ©ç”¨lv := log.WithValues(&quot;module&quot;, &quot;apiserver&#47;controller&quot;)åˆ›å»ºç±»ä¼¼çš„ä¸€ä¸ªloggerä¾›æœ¬æ¨¡å—ä½¿ç”¨ï¼Ÿ</p>2022-05-17</li><br/><li><span>å¼ æµ©è½©</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è¯·é—®è€å¸ˆä¸šåŠ¡éœ€è¦è®°å½•çš„é”™è¯¯æ—¥å¿—æ€ä¹ˆæ”¾åˆ°errorOutputPathä¸­? æˆ‘çœ‹äº†exampleçš„ç¤ºä¾‹ï¼Œæ— æ³•å®ç°info erroræ—¥å¿—åŒºåˆ†å­˜æ”¾çš„åŠŸèƒ½ã€‚</p>2022-04-09</li><br/><li><span>çˆ±å­¦ä¹ çš„W</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>æˆ‘æƒ³çš„æ˜¯ï¼šç”¨é€‰é¡¹æ¨¡å¼ï¼Ÿ ä¸ºä»€ä¹ˆä¸ç”¨è´£ä»»é“¾æ¨¡å¼</p>2022-01-05</li><br/><li><span>Geek_6bf2d9</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆèƒ½ä¸èƒ½å¤§æ¦‚æŒ‡ä¸€ä¸‹cuslogåŒ…é‡Œçš„loggerç»“æ„ä½“è®¾è®¡ï¼Œä¸ºä»€ä¹ˆè¦åŠ ä¸€ä¸ªsync.Poolå‘¢ï¼Ÿè¿™é‡Œæ˜¯å¤„äºä»€ä¹ˆè€ƒè™‘ï¼Ÿ</p>2021-12-23</li><br/><li><span>Dppçš„å°è·Ÿç­å„¿</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆï¼Œè¯¥logåŒ…æ”¯æŒrotateåŠŸèƒ½å—ï¼Ÿå®é™…é¡¹ç›®ä¸­æ˜¯è¿ç»´ä½¿ç”¨è„šæœ¬æ§åˆ¶æ—¥å¿—å¤§å°å‘¢ï¼Œè¿˜æ˜¯æœ€å¥½å¼€å‘é€‰ç”¨çš„logåŒ…å°±ç›´æ¥æ”¯æŒæ‰æ˜¯æœ€ä½³è§£å†³æ–¹æ¡ˆå‘¢ï¼Ÿ</p>2021-12-13</li><br/>
</ul>