ä½ å¥½ï¼Œæˆ‘æ˜¯ä¿Šè¾¾ã€‚

ä¸çŸ¥é“ä½ åœ¨å¹³æ—¶å·¥ä½œä¸­æ˜¯å¦é‡åˆ°è¿‡ä¹±ç é—®é¢˜ï¼Ÿæˆ‘æœ€æ—©é‡åˆ°çš„ä¹±ç é—®é¢˜è¿˜æ˜¯åˆšå¼€å§‹å­¦Cè¯­è¨€ç¼–ç¨‹æ—¶ï¼Œæœ‰æ—¶å€™åœ¨Consoleä¸Šä¼šè¾“å‡ºâ€œçƒ«çƒ«çƒ«â€è¿™æ ·çš„ä¿¡æ¯ã€‚åœ¨ä½¿ç”¨MySQLæ—¶ï¼Œä¹Ÿé‡åˆ°è¿‡å„ç§ä¹±ç ï¼Œä¹±ç å¯èƒ½ä¼šä»¥ä¸åŒçš„å½¢å¼å‡ºç°ã€‚

é‚£ä¹ˆåœ¨è¿™ä¸€è®²ä¸­ï¼Œæˆ‘ä»¬å°±æ¥åˆ†æMySQLä¸­å‡ºç°ä¹±ç çš„å‡ ç§ä¸åŒæƒ…å†µï¼Œä»¥åŠä¹±ç äº§ç”Ÿçš„åº•å±‚åŸå› ï¼Œä»è€ŒæŒæ¡å¤„ç†å’Œé¿å…ä¹±ç é—®é¢˜çš„æ–¹æ³•ã€‚

# ç¼–ç ä¸è§£ç 

å¹³æ—¶æˆ‘ä»¬ä¼šä½¿ç”¨æ–‡å­—å’Œç¬¦å·æ¥è¿›è¡Œäº¤æµï¼Œæ¯”å¦‚â€œä¸­æ–‡ç¬¦å·â€å°±æ˜¯ä¸€ä¸ªæœ‰æ˜ç¡®å«ä¹‰çš„è¯ç»„ã€‚æˆ‘ä»¬ä¹ŸçŸ¥é“è®¡ç®—æœºåº•å±‚æ˜¯ä½¿ç”¨äºŒè¿›åˆ¶æ¥å­˜å‚¨å’Œä¼ è¾“æ•°æ®ï¼Œé‚£ä¹ˆè®¡ç®—æœºå¦‚ä½•ä»¥äºŒè¿›åˆ¶çš„å½¢å¼æ¥è¡¨ç¤ºâ€œä¸­æ–‡ç¬¦å·â€è¿™ä¸ªè¯ç»„å‘¢ï¼Ÿè¿™å°±æ¶‰åŠåˆ°å­—ç¬¦çš„ç¼–ç äº†ã€‚å¯¹äºä¸­æ–‡å­—ç¬¦ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„ç¼–ç æ–¹å¼å°±åŒ…æ‹¬GBKã€UTF8ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬å…¶ä»–ä¸€äº›ç¼–ç æ–¹å¼ï¼Œä½†æˆ‘ä»¬è¿™é‡Œå°±ä¸è¿‡å¤šè®¨è®ºäº†ï¼Œå› ä¸ºåº•å±‚åŸç†æ˜¯ä¸€æ ·çš„ã€‚

â€œä¸­æ–‡ç¬¦å·â€ä½¿ç”¨GBKç¼–ç åï¼Œæ˜¯è¿™ä¸ªæ ·å­çš„ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/83/d7/8351b0187c81578f6b7e02dfe83618d7.png?wh=694x92)

è€Œä½¿ç”¨UTF8ç¼–ç æ—¶ï¼Œæ˜¯è¿™ä¸ªæ ·å­çš„ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/e9/31/e96d812d605a089e9738e056f5c2a231.png?wh=986x90)

æˆ‘ä»¬å¯ä»¥åœ¨ç½‘ä¸Šæ‰¾åˆ°GBKçš„ç¼–ç è¡¨ï¼Œä¹Ÿå¯ä»¥æ‰¾åˆ°Unicodeçš„è¡¨ï¼Œè€ŒUnicodeå¯ä»¥ç”¨æ˜ç¡®çš„ç®—æ³•è½¬æ¢æˆUTF8ç¼–ç ã€‚è¿™é‡Œæˆ‘ä»¬æä¾›ä¸€ä¸ªç®€ä¾¿çš„æ–¹æ³•ï¼Œä½¿ç”¨Python(python2)æ¥è·å–å­—ç¬¦çš„ç¼–ç ã€‚

```plain
### GBK
>>> u"ä¸­æ–‡ç¬¦å·".encode('gbk')
'\xd6\xd0\xce\xc4\xb7\xfb\xba\xc5'

### UTF8
>>> u"ä¸­æ–‡ç¬¦å·".encode('utf8')
'\xe4\xb8\xad\xe6\x96\x87\xe7\xac\xa6\xe5\x8f\xb7'
```
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ5ï¼‰</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/11/0e/61/ae68f8eb.jpg" width="30px"><span>dream</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>æ–‡ç« ä¸­çš„è§£ç ç¤ºä¾‹ï¼Œæˆ‘å† ubuntu python3 ä¸­è¿è¡Œæœ‰ç‚¹é—®é¢˜ï¼Œéœ€è¦åœ¨å­—ç¬¦ä¸²å‰é¢åŠ  b:

```
&gt;&gt;&gt; &#39;\xd6\xd0\xce\xc4\xb7\xfb\xba\xc5&#39;.decode(&#39;gbk&#39;)
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
AttributeError: &#39;str&#39; object has no attribute &#39;decode&#39;. Did you mean: &#39;encode&#39;?
&gt;&gt;&gt; 
&gt;&gt;&gt; print &#39;\xd6\xd0\xce\xc4\xb7\xfb\xba\xc5&#39;.decode(&#39;gbk&#39;)
  File &quot;&lt;stdin&gt;&quot;, line 1
    print &#39;\xd6\xd0\xce\xc4\xb7\xfb\xba\xc5&#39;.decode(&#39;gbk&#39;)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
SyntaxError: Missing parentheses in call to &#39;print&#39;. Did you mean print(...)?
&gt;&gt;&gt; 
&gt;&gt;&gt; b&#39;\xd6\xd0\xce\xc4\xb7\xfb\xba\xc5&#39;.decode(&#39;gbk&#39;)
&#39;ä¸­æ–‡ç¬¦å·&#39;
&gt;&gt;&gt; print(b&#39;\xd6\xd0\xce\xc4\xb7\xfb\xba\xc5&#39;.decode(&#39;gbk&#39;))
ä¸­æ–‡ç¬¦å·
&gt;&gt;&gt; 

```</div>2024-09-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/0e/61/ae68f8eb.jpg" width="30px"><span>dream</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>ä»å‘é€è¯·æ±‚åˆ°æ¥æ”¶ç»“æœè¿‡ç¨‹ä¸­å‘ç”Ÿçš„å­—ç¬¦é›†è½¬æ¢ï¼Œå¯ä»¥åƒè¿™æ ·ç†è§£å—ï¼Ÿ

### 1. å†™æ“ä½œ

1. å®¢æˆ·ç«¯ä½¿ç”¨ `characterEncoding`(é»˜è®¤å€¼æ˜¯æ“ä½œç³»ç»Ÿçš„å­—ç¬¦é›†) å­—ç¬¦é›†ç¼–ç è¯·æ±‚å­—ç¬¦ä¸²ï¼Œå‘æœåŠ¡å™¨å‘é€çš„æ˜¯ç»è¿‡ç¼–ç çš„ä¸€ä¸ªå­—èŠ‚ä¸²ã€‚
   &gt; å‡è®¾ url æ˜¯ `jdbc:mysql:&#47;&#47;ip:port&#47;db?characterEncoding=UTF8`ï¼Œ é‚£å®¢æˆ·ç«¯å°±æ˜¯ utf8 ç¼–ç 
2. æœåŠ¡å™¨å°†å®¢æˆ·ç«¯å‘é€æ¥çš„å­—èŠ‚ä¸²é‡‡ç”¨ `character_set_client` è¡¨ç¤ºçš„å­—ç¬¦é›†è¿›è¡Œè§£ç ï¼Œå°†è§£ç åçš„å­—ç¬¦ä¸²å†æŒ‰ç…§`character_set_connection` ä»£è¡¨çš„å­—ç¬¦é›†è¿›è¡Œç¼–ç ã€‚
3. å¦‚æœ `character_set_connection` è¡¨ç¤ºçš„å­—ç¬¦é›†å’Œå­˜å‚¨å¼•æ“ä¸­åˆ—çš„å­—ç¬¦é›†ä¸€è‡´ï¼Œåˆ™ç›´æ¥è¿›è¡Œç›¸åº”æ“ä½œï¼›å¦åˆ™çš„è¯éœ€è¦å°†è¯·æ±‚çš„å­—ç¬¦ä¸²ä» `character_set_connection` è¡¨ç¤ºçš„å­—ç¬¦é›†è½¬æ¢ä¸ºå­˜å‚¨å¼•æ“ä¸­åˆ—ä½¿ç”¨çš„å­—ç¬¦é›†ä¹‹åå†è¿›è¡Œæ“ä½œã€‚
   
### 2. è¯»æ“ä½œ

1. å°†ä»æŸä¸ªåˆ—è·å–åˆ°çš„å­—èŠ‚ä¸²ä»è¯¥åˆ—ä½¿ç”¨çš„å­—ç¬¦é›†è½¬æ¢ä¸º `character_set_results` ä»£è¡¨çš„å­—ç¬¦é›†åå‘é€åˆ°å®¢æˆ·ç«¯ã€‚
2. å®¢æˆ·ç«¯ä½¿ç”¨`characterEncoding`(é»˜è®¤å€¼æ˜¯æ“ä½œç³»ç»Ÿçš„å­—ç¬¦é›†) å­—ç¬¦é›†è§£ç æ”¶åˆ°çš„ç»“æœäºŒè¿›åˆ¶ä¸ºå­—ç¬¦ä¸²ã€‚
</div>2024-09-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/28/a1/d8/42252c48.jpg" width="30px"><span>123</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆï¼Œè¯·æ•™å‡ ä¸ªé—®é¢˜ï¼š
1ã€â€œæ€»ç»“ä¸€ä¸‹ï¼Œå†™å…¥æ•°æ®æ—¶ï¼Œå¦‚æœ character_set_client çš„è®¾ç½®å’Œæ•°æ®çš„å®é™…ç¼–ç ä¸ä¸€è‡´ï¼Œå°±å¯èƒ½ä¼šäº§ç”Ÿä¹±ç ï¼Œæˆ–è€…åœ¨å†™å…¥æ•°æ®æ—¶ç›´æ¥æŠ¥é”™â€
mysqlæ˜¯å¦‚ä½•åˆ¤æ–­character_set_clientå’Œæ•°æ®çš„å®é™…ç¼–ç ä¸ä¸€è‡´ï¼Œåœ¨ä¼ å…¥çš„æ—¶å€™ä¼šæœ‰ç¼–ç ä¿¡æ¯å­—æ®µå—ï¼Ÿ

2ã€â€œè¿™è¯´æ˜äº† MySQL å®¹å¿äº†æ–‡æœ¬ç¼–ç ä» character_set_client è½¬æ¢åˆ° character_set_connection æ—¶çš„é”™è¯¯ã€‚ä½†å¦‚æœå¾€å­˜å‚¨å¼•æ“ä¸­å†™å…¥æ•°æ®æ—¶ç¼–ç è½¬æ¢æœ‰é—®é¢˜ï¼Œè¯­å¥å°±ä¼šå¤±è´¥ï¼Œæ•°æ®æ— æ³•å†™å…¥åˆ°æ•°æ®åº“ã€‚â€
å®éªŒç¯å¢ƒï¼šutf8ç»ˆç«¯ï¼Œcharacter_set_client=gbkï¼Œcharacter_set_connection=utf8, table charset=utf8

CREATE TABLE `t_utf8_2` (
  `a` varchar(30) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 

(1) â€œä¸­æ–‡å­—ç¬¦â€.encode(&#39;utf8&#39;).decode(&#39;gbk&#39;).encode(&#39;utf8&#39;) å¯ä»¥å­˜å…¥æ•°æ®ï¼Œä½†æ˜¯æ˜¾ç¤ºæ•°æ®ä¹±ç ï¼›
(2) set names = gbk =&gt; character_set_client=gbk;character_set_connection=gbk;character_set_results=gbk;
åº”è¯¥ä¹Ÿæ˜¯â€œä¸­æ–‡å­—ç¬¦â€.encode(&#39;utf8&#39;).decode(&#39;gbk&#39;).encode(&#39;utf8&#39;) ï¼Ÿä¸ªäººç†è§£æ˜¯é€šè¿‡ç»ˆç«¯çš„å­—ç¬¦é›†è¿›è¡Œç¼–ç ï¼Œç„¶åé€šè¿‡connectionå­—ç¬¦é›†è¿›è¡Œè§£ç ï¼Œæœ€ååœ¨æ ¹æ®table charsetè¿›è¡Œç¼–ç è¿›è¡Œå­˜å‚¨ï¼Ÿ
æ‰€ä»¥ä¸ºä»€ä¹ˆå½“ç»ˆç«¯charset != character_set_client = character_set_connection != table charset ä¼šæŠ¥é”™?
ä»¥ä¸Šçš„æƒ…å†µåˆ†åˆ«ä¸ºï¼š
 1&gt;  æ’å…¥ä¹±ç ï¼šç»ˆç«¯charset[utf8] != character_set_client[gbk] != character_set_connection[urf8] = table charset[urf8]
 2&gt; æ’å…¥æŠ¥é”™ï¼šç»ˆç«¯charset[utf8] != character_set_client[gbk] != character_set_connection[gbk] != table charset[urf8]
 3&gt; æ’å…¥æ­£å¸¸ï¼šç»ˆç«¯charset[utf8] = character_set_client[utf8] != character_set_connection[gbk] != table charset[urf8]
å¯¹äºæƒ…å†µ3ï¼Œâ€œå¦‚æœ character_set_connection å’Œ character_set_client è®¾ç½®ä¸ä¸€æ ·ï¼ŒMySQL Server ç«¯ä¼šå°†æ•°æ®è½¬æ¢æˆ character_set_connection æŒ‡å®šçš„å­—ç¬¦é›†ã€‚â€
ä½†æ˜¯åœ¨æˆ‘çš„ç¯å¢ƒä¸­ä¹Ÿæ˜¯æ­£å¸¸çš„ï¼Œmysql8.0.29
</div>2024-09-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/24/f7/b9/f2eec64e.jpg" width="30px"><span>Shelly</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>æ€è€ƒé¢˜ï¼š
1. æ˜¯å› ä¸ºä½ çš„ç»ˆç«¯çš„å­—ç¬¦é›†ä¸ºutf8ï¼Œåˆ›å»ºè¡¨æ’å…¥æ•°æ®æ—¶ç”±äºè®¾ç½®äº†set names = gbkï¼Œç”±äºè¡¨çš„å­—ç¬¦é›†ä¹Ÿæ˜¯gbk,æ‰€ä»¥æ•°æ®å­˜å‚¨åˆ°è¡¨æ—¶å­—ç¬¦é›†æ²¡æœ‰å‘ç”Ÿè½¬æ¢(ä½†å®é™…æ˜¯æŒ‰utf8å­—ç¬¦é›†å­˜å‚¨çš„)ï¼Œä½ æŸ¥è¯¢æ—¶ï¼Œç”±äºcharacter_set_resultsä¸ºgbkå’Œè¡¨çš„å­—ç¬¦é›†ä¸€è‡´ï¼Œæ‰€ä»¥å­—ç¬¦é›†æ²¡æœ‰å‘ç”Ÿè½¬æ¢ï¼Œæ­£å¥½ä½ å®¢æˆ·ç«¯çš„å­—ç¬¦é›†æ˜¯utf8ï¼Œäºæ˜¯ä¸­æ–‡å­—ç¬¦å°±è¢«é˜´å·®é˜³é”™çš„æ­£ç¡®æ˜¾ç¤ºäº†å‡ºæ¥ã€‚ 
2. ç”±äºä½ çš„åŒäº‹ç»ˆç«¯çš„å­—ç¬¦é›†æ˜¯gbkï¼Œå½“æŠŠæœåŠ¡å™¨ç«¯çš„å­—ç¬¦é›†è®¾ç½®æˆutf8æ—¶ï¼ŒæŸ¥è¯¢æ—¶ï¼Œç”±äºcharacter_set_results=utf8å’Œè¡¨gbkçš„å­—ç¬¦é›†ä¸ä¸€è‡´ï¼Œæ‰€ä»¥éœ€è¦å­—ç¬¦é›†è½¬æ¢ï¼Œå…ˆè¦ç”¨gbkå­—ç¬¦é›†è§£ç å®é™…ç”¨utf8å­˜å‚¨çš„æ•°æ®ï¼Œå†ç”¨utf8è¿›è¡Œç¼–ç å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œäºæ˜¯æ˜¾ç¤ºå°±ä¹±ç äº†ã€‚ å½“æŠŠæœåŠ¡å™¨çš„å­—ç¬¦é›†è®¾ç½®æˆgbkæ—¶ï¼Œç”±äºcharacter_set_results=gbkå’Œè¡¨gbkçš„å­—ç¬¦é›†ä¸€è‡´ï¼Œä¸å­˜åœ¨å­—ç¬¦é›†è½¬æ¢ï¼Œå®¢æˆ·ç«¯å®é™…æ”¶åˆ°æ˜¯çš„ç”¨utf8å­—ç¬¦é›†ç¼–ç çš„æ•°æ®ï¼Œç»ˆç«¯ç”¨GBKå­—ç¬¦é›†è§£ç utf8ç¼–ç çš„æ•°æ®ï¼Œæ‰€ä»¥ä¹Ÿå‘ç”Ÿäº†ä¹±ç ã€‚
3. è§£å†³æ–¹æ³•ï¼šæŠŠä½ åŒäº‹ç»ˆç«¯çš„å­—ç¬¦é›†æ”¹utf8ï¼ŒæœåŠ¡å™¨ç«¯è®¾ç½®set names=gbkï¼›æ˜¾ç¤ºä¸­æ–‡å°±ä¸ä¼šå‡ºç°ä¹±ç ã€‚</div>2024-09-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/3c/4a/fe/7b6bd101.jpg" width="30px"><span>ç¬™ é¸¢</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>mysql&gt; set names utf8;
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql&gt; set character_set_client=&#39;gbk&#39;;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; insert into t_utf8 values(&#39;ä¸­æ–‡ç¬¦å·&#39;);
Query OK, 1 row affected, 1 warning (0.02 sec)

mysql&gt; select a, hex(a) from t_utf8;
+------------------+----------------------------------+
| a                | hex(a)                           |
+------------------+----------------------------------+
| æ¶“?æƒç»—ï¹€å½¿ | E6B6933FE69E83E7BB97EFB980E5BDBF |
+------------------+----------------------------------+
1 row in set (0.00 sec)

mysql&gt; set names gbk;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; select a, hex(a) from t_utf8;

mysql&gt; select a, hex(a) from t_utf8;

mysql&gt;
æˆ‘è¿™ä¸ªæ˜¾ç¤ºä¸å‡ºæ¥æ˜¯ï¼Ÿ
-- ç»ˆç«¯ä¸ºUTF8ï¼Œå°†character_set_resultsè®¾ç½®ä¸ºGBK
mysql&gt; set names gbk;
è¿™ä¸ªç»ˆç«¯æ˜¯æŒ‡æ“ä½œç³»ç»Ÿçš„å­—ç¬¦é›†ï¼Ÿè¿˜æ˜¯è¿æ¥mysqlä¹‹åçš„set namesè®¾ç½®çš„å•Šï¼Ÿè®¾ç½®set names gbkæˆ‘çœ‹character_set_client     | gbk                                   |
| character_set_connection | gbk                                   |
| character_set_results    | gbk 
éƒ½ä¸ºgbkäº†ï¼Œæ˜¯è¿™ç§æ•ˆæœå—ï¼Ÿè¿™å—æœ‰ç‚¹æ²¡è½¬è¿‡æ¥                                 </div>2024-09-14</li><br/>
</ul>