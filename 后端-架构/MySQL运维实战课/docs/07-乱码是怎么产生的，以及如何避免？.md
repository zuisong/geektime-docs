ä½ å¥½ï¼Œæˆ‘æ˜¯ä¿Šè¾¾ã€‚

ä¸çŸ¥é“ä½ åœ¨å¹³æ—¶å·¥ä½œä¸­æ˜¯å¦é‡åˆ°è¿‡ä¹±ç é—®é¢˜ï¼Ÿæˆ‘æœ€æ—©é‡åˆ°çš„ä¹±ç é—®é¢˜è¿˜æ˜¯åˆšå¼€å§‹å­¦Cè¯­è¨€ç¼–ç¨‹æ—¶ï¼Œæœ‰æ—¶å€™åœ¨Consoleä¸Šä¼šè¾“å‡ºâ€œçƒ«çƒ«çƒ«â€è¿™æ ·çš„ä¿¡æ¯ã€‚åœ¨ä½¿ç”¨MySQLæ—¶ï¼Œä¹Ÿé‡åˆ°è¿‡å„ç§ä¹±ç ï¼Œä¹±ç å¯èƒ½ä¼šä»¥ä¸åŒçš„å½¢å¼å‡ºç°ã€‚

é‚£ä¹ˆåœ¨è¿™ä¸€è®²ä¸­ï¼Œæˆ‘ä»¬å°±æ¥åˆ†æMySQLä¸­å‡ºç°ä¹±ç çš„å‡ ç§ä¸åŒæƒ…å†µï¼Œä»¥åŠä¹±ç äº§ç”Ÿçš„åº•å±‚åŸå› ï¼Œä»è€ŒæŒæ¡å¤„ç†å’Œé¿å…ä¹±ç é—®é¢˜çš„æ–¹æ³•ã€‚

# ç¼–ç ä¸è§£ç 

å¹³æ—¶æˆ‘ä»¬ä¼šä½¿ç”¨æ–‡å­—å’Œç¬¦å·æ¥è¿›è¡Œäº¤æµï¼Œæ¯”å¦‚â€œä¸­æ–‡ç¬¦å·â€å°±æ˜¯ä¸€ä¸ªæœ‰æ˜ç¡®å«ä¹‰çš„è¯ç»„ã€‚æˆ‘ä»¬ä¹ŸçŸ¥é“è®¡ç®—æœºåº•å±‚æ˜¯ä½¿ç”¨äºŒè¿›åˆ¶æ¥å­˜å‚¨å’Œä¼ è¾“æ•°æ®ï¼Œé‚£ä¹ˆè®¡ç®—æœºå¦‚ä½•ä»¥äºŒè¿›åˆ¶çš„å½¢å¼æ¥è¡¨ç¤ºâ€œä¸­æ–‡ç¬¦å·â€è¿™ä¸ªè¯ç»„å‘¢ï¼Ÿè¿™å°±æ¶‰åŠåˆ°å­—ç¬¦çš„ç¼–ç äº†ã€‚å¯¹äºä¸­æ–‡å­—ç¬¦ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„ç¼–ç æ–¹å¼å°±åŒ…æ‹¬GBKã€UTF8ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬å…¶ä»–ä¸€äº›ç¼–ç æ–¹å¼ï¼Œä½†æˆ‘ä»¬è¿™é‡Œå°±ä¸è¿‡å¤šè®¨è®ºäº†ï¼Œå› ä¸ºåº•å±‚åŸç†æ˜¯ä¸€æ ·çš„ã€‚

â€œä¸­æ–‡ç¬¦å·â€ä½¿ç”¨GBKç¼–ç åï¼Œæ˜¯è¿™ä¸ªæ ·å­çš„ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/83/d7/8351b0187c81578f6b7e02dfe83618d7.png?wh=694x92)

è€Œä½¿ç”¨UTF8ç¼–ç æ—¶ï¼Œæ˜¯è¿™ä¸ªæ ·å­çš„ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/e9/31/e96d812d605a089e9738e056f5c2a231.png?wh=986x90)

æˆ‘ä»¬å¯ä»¥åœ¨ç½‘ä¸Šæ‰¾åˆ°GBKçš„ç¼–ç è¡¨ï¼Œä¹Ÿå¯ä»¥æ‰¾åˆ°Unicodeçš„è¡¨ï¼Œè€ŒUnicodeå¯ä»¥ç”¨æ˜ç¡®çš„ç®—æ³•è½¬æ¢æˆUTF8ç¼–ç ã€‚è¿™é‡Œæˆ‘ä»¬æä¾›ä¸€ä¸ªç®€ä¾¿çš„æ–¹æ³•ï¼Œä½¿ç”¨Python(python2)æ¥è·å–å­—ç¬¦çš„ç¼–ç ã€‚

```plain
### GBK
>>> u"ä¸­æ–‡ç¬¦å·".encode('gbk')
'\xd6\xd0\xce\xc4\xb7\xfb\xba\xc5'

### UTF8
>>> u"ä¸­æ–‡ç¬¦å·".encode('utf8')
'\xe4\xb8\xad\xe6\x96\x87\xe7\xac\xa6\xe5\x8f\xb7'
```

ç°åœ¨ä½ åº”è¯¥å·²ç»çŸ¥é“ç¼–ç çš„è¿‡ç¨‹äº†ã€‚ç¨‹åºåœ¨å¤„ç†æ–‡æœ¬ä¿¡æ¯æ—¶ï¼Œè¿˜æ¶‰åŠåˆ°è§£ç ã€‚è§£ç æ˜¯ç¼–ç çš„åå‘æ“ä½œï¼Œå°†äºŒè¿›åˆ¶çš„æ•°æ®è§£ææˆä¸€ä¸ªä¸ªçš„å­—ç¬¦ï¼Œæ¯”å¦‚ä¸Šé¢è¿™æ®µGBKç¼–ç åçš„æ•°æ®ï¼Œè§£ç åå°±å¾—åˆ°äº†åŸå§‹çš„ä¿¡æ¯ã€‚

```plain
>>> '\xd6\xd0\xce\xc4\xb7\xfb\xba\xc5'.decode('gbk')
u'\u4e2d\u6587\u7b26\u53f7'

>>> print '\xd6\xd0\xce\xc4\xb7\xfb\xba\xc5'.decode('gbk')
ä¸­æ–‡ç¬¦å·
```

åˆ°ç›®å‰ä¸ºæ­¢æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚ä½†æ˜¯æˆ‘æƒ³è¯·ä½ æ€è€ƒä¸€ä¸‹ï¼š**ç¨‹åºæ€ä¹ˆçŸ¥é“ä¸€æ®µç‰¹å®šçš„æ•°æ®æ˜¯é‡‡ç”¨å“ªç§å­—ç¬¦é›†ç¼–ç çš„å‘¢ï¼Ÿ**

å®é™…ä¸Šæ²¡æœ‰åŠæ³•ä»…ä»…ä¾èµ–æ•°æ®æœ¬èº«å°±å¾—çŸ¥æ•°æ®çš„ç¼–ç æ–¹å¼ã€‚å¾ˆå¤šä¹±ç é—®é¢˜å°±æ˜¯å¼„é”™äº†å­—ç¬¦é›†è€Œå¯¼è‡´çš„ã€‚

æ¥ç€ä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚æœç¨‹åºä»¥ä¸ºæ•°æ®ä½¿ç”¨äº†UTF8ç¼–ç ï¼ˆä½†æ˜¯å®é™…ä¸Šå¹¶ä¸æ˜¯ï¼‰ï¼Œå°±ä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚

```plain
>>> '\xd6\xd0\xce\xc4\xb7\xfb\xba\xc5'.decode('utf8', errors='replace')
u'\ufffd\ufffd\ufffd\u0137\ufffd\ufffd\ufffd'

>>> print '\xd6\xd0\xce\xc4\xb7\xfb\xba\xc5'.decode('utf8', errors='replace')
ï¿½ï¿½ï¿½Ä·ï¿½ï¿½ï¿½
```

![](https://static001.geekbang.org/resource/image/1f/70/1f2b512a9e092278146039f6c8812a70.png?wh=770x130)

ç”±äºè¿™äº›æ•°æ®ä¸­å¾ˆå¤šå­—èŠ‚å¹¶ä¸æ˜¯åˆæ³•çš„UTF8ç¼–ç ï¼Œæ— æ³•è§£ç æˆUnicodeï¼Œä¾¿ä½¿ç”¨äº†ç¬¦å·â€œï¿½â€æ¥ä»£æ›¿ã€‚

ç±»ä¼¼çš„ï¼Œå¦‚æœåŸå§‹æ•°æ®ä½¿ç”¨äº†UTF8ç¼–ç ï¼Œä½†é”™è¯¯åœ°ä½¿ç”¨äº†GBKæ¥è§£ç ï¼Œå°±ä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚

```plain
>>> '\xe4\xb8\xad\xe6\x96\x87\xe7\xac\xa6\xe5\x8f\xb7'.decode('gbk', errors='replace')
u'\u6d93\ufffd\u6783\u7ed7\ufe40\u5f7f'

>>> print '\xe4\xb8\xad\xe6\x96\x87\xe7\xac\xa6\xe5\x8f\xb7'.decode('gbk', errors='replace')
æ¶“ï¿½æƒç»—ï¹€å½¿
```

![](https://static001.geekbang.org/resource/image/cf/d9/cfae52e4415e6e11fa96030b078a30d9.png?wh=1056x134)

ä¸Šé¢æˆ‘ä»¬è§åˆ°äº†ä¹±ç äº§ç”Ÿçš„ä¸€äº›æƒ…å†µï¼Œè€Œç°å®ä¸­å…¶å®è¿˜å­˜åœ¨ç€æ›´å¤æ‚ä¸€äº›çš„æƒ…å†µã€‚

æ¯”å¦‚ï¼Œå‘é€è€…ä½¿ç”¨GBKç¼–ç ï¼Œæ¥æ”¶è€…æ¥æ”¶åˆ°æ•°æ®åï¼Œä½¿ç”¨UTF8è§£ç ï¼Œç„¶ååˆå°†æ•°æ®ä»¥UTF8çš„æ–¹å¼ç¼–ç åè¿”å›ç»™å‘é€è€…ã€‚å‘é€è€…æ¥æ”¶åˆ°æ•°æ®åï¼Œå†ä½¿ç”¨GBKæ¥è§£ç ï¼Œå°±ä¼šé‡åˆ°ç»å…¸çš„â€œ**é”Ÿæ–¤æ‹·**â€é—®é¢˜ã€‚

```plain
### å‘é€è€…ç¼–ç (GBK)
>>> u"ä¸­æ–‡ç¬¦å·".encode('gbk')
'\xd6\xd0\xce\xc4\xb7\xfb\xba\xc5'

### æ¥æ”¶è€…è§£ç (UTF8) å’Œ ç¼–ç (UTF8)
>>> '\xd6\xd0\xce\xc4\xb7\xfb\xba\xc5'.decode('utf8',errors='replace').encode('utf8')
'\xef\xbf\xbd\xef\xbf\xbd\xef\xbf\xbd\xc4\xb7\xef\xbf\xbd\xef\xbf\xbd\xef\xbf\xbd'

### å‘é€è€…è§£ç (GBK)
>>> print '\xef\xbf\xbd\xef\xbf\xbd\xef\xbf\xbd\xc4\xb7\xef\xbf\xbd\xef\xbf\xbd\xef\xbf\xbd'.decode('gbk')
é”Ÿæ–¤æ‹·é”Ÿä¾¥å‡¤æ‹·é”Ÿæ–¤æ‹·
```

![](https://static001.geekbang.org/resource/image/72/bc/720c3db0376551183c48c2d8a6bc29bc.png?wh=1608x130)

ç±»ä¼¼çš„ï¼Œæœ‰æ—¶å¯èƒ½è¿˜ä¼šé‡åˆ°è¿™ç§æƒ…å†µã€‚

```plain
### å‘é€è€…ç¼–ç (UTF8)
>>> u"ä¸­æ–‡ç¬¦å·".encode('utf8')
'\xe4\xb8\xad\xe6\x96\x87\xe7\xac\xa6\xe5\x8f\xb7'

### æ¥æ”¶è€…è§£ç (GBK) å’Œ ç¼–ç (UTF8)
>>> '\xe4\xb8\xad\xe6\x96\x87\xe7\xac\xa6\xe5\x8f\xb7'.decode('gbk', errors='replace').encode('utf8')
'\xe6\xb6\x93\xef\xbf\xbd\xe6\x9e\x83\xe7\xbb\x97\xef\xb9\x80\xe5\xbd\xbf'

### å‘é€è€…è§£ç (GBK)
>>> '\xe6\xb6\x93\xef\xbf\xbd\xe6\x9e\x83\xe7\xbb\x97\xef\xb9\x80\xe5\xbd\xbf'.decode('gbk', errors='replace')
u'\u5a11\u64c4\u62f7\u93cb\u51aa\u7cad\u9515\ufffd\u5a07'

>>> print '\xe6\xb6\x93\xef\xbf\xbd\xe6\x9e\x83\xe7\xbb\x97\xef\xb9\x80\xe5\xbd\xbf'.decode('gbk', errors='replace')
å¨‘æ“„æ‹·é‹å†ªç²­é”•ï¿½å¨‡
```

![](https://static001.geekbang.org/resource/image/dd/2e/dd5ab25e71b71b8fe5697c8da5ecfd2e.png?wh=1476x134)

# MySQL å¦‚ä½•å¤„ç†æ–‡æœ¬æ•°æ®ï¼Ÿ

ä»ä¸Šé¢çš„ä¾‹å­ä¸­å¯ä»¥çœ‹å‡ºï¼Œç¨‹åºæ— æ³•ä»…ä»…æ ¹æ®æ•°æ®æœ¬èº«å°±çŸ¥é“å…·ä½“çš„ç¼–ç æ–¹å¼ï¼Œè€Œç¼–ç å’Œè§£ç æ—¶ï¼Œå¦‚æœä½¿ç”¨äº†é”™è¯¯çš„å­—ç¬¦é›†ï¼Œå°±ä¼šå‡ºç°ä¹±ç ã€‚

è€ŒMySQLå¤„ç†æ–‡æœ¬æ•°æ®æ—¶ï¼Œå­˜åœ¨ä¸€æ ·çš„é—®é¢˜ï¼š

- å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ•°æ®ä½¿ç”¨ä»€ä¹ˆäº†ç¼–ç æ ¼å¼ï¼Ÿ
- æœåŠ¡å™¨ç«¯å¤„ç†æ•°æ®æ—¶ï¼Œåº”è¯¥ä½¿ç”¨å“ªç§ç¼–ç æ ¼å¼ï¼Ÿ
- å°†æ•°æ®å­˜å‚¨åˆ°è¡¨é‡Œæ—¶ï¼Œä½¿ç”¨ä»€ä¹ˆå­—ç¬¦é›†è¿›è¡Œç¼–ç ï¼Ÿ
- å°†æŸ¥è¯¢ç»“æœå‘é€ç»™å®¢æˆ·ç«¯æ—¶ï¼Œåˆåº”è¯¥å¦‚ä½•ç¼–ç æ•°æ®ï¼Ÿ

MySQLä½¿ç”¨äº†ä¸€ç³»åˆ—å˜é‡æ¥å‘Šè¯‰æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ•°æ®æ˜¯æ€ä¹ˆç¼–ç çš„ï¼Œå®¢æˆ·ç«¯å¸Œæœ›æ¥æ”¶åˆ°ä»€ä¹ˆç¼–ç çš„æ•°æ®ã€‚

è¡¨å’Œåˆ—çš„å­—ç¬¦é›†å±æ€§åˆ™å‘Šè¯‰æœåŠ¡å™¨ï¼Œå­˜å‚¨æ•°æ®æ—¶åº”è¯¥æ€ä¹ˆç¼–ç ï¼Œè¯»å–æ•°æ®æ—¶åˆåº”è¯¥æ€ä¹ˆè§£ç ã€‚

## å­—ç¬¦é›†å˜é‡

æ‰§è¡Œshow variableså‘½ä»¤å°±èƒ½æŸ¥çœ‹åˆ°å­—ç¬¦é›†ç›¸å…³çš„å˜é‡ã€‚

```go
mysql> show variables like '%char%';
+--------------------------+------------------------------------------------------+
| Variable_name            | Value                                                |
+--------------------------+------------------------------------------------------+
| character_set_client     | utf8mb3                                              |
| character_set_connection | utf8mb3                                              |
| character_set_database   | big5                                                 |
| character_set_filesystem | binary                                               |
| character_set_results    | utf8mb3                                              |
| character_set_server     | utf8mb4                                              |
| character_set_system     | utf8mb3                                              |
```

åœ¨MySQLä¸­ï¼Œæƒ³é¿å…äº§ç”Ÿä¹±ç ï¼Œé¦–å…ˆéœ€è¦æ­£ç¡®åœ°è®¾ç½®è¿™äº›å˜é‡ã€‚ä¸‹é¢çš„è¡¨æ ¼å¯¹è¿™äº›å˜é‡åšäº†ç®€è¦çš„è¯´æ˜ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/b5/fb/b5f80390561dcbea1ec8286fa1597bfb.png?wh=1736x1432)

## è¡¨å’Œåˆ—çš„å­—ç¬¦é›†å±æ€§

MySQLä¸­ï¼Œæ‰€æœ‰å­—ç¬¦ç±»å‹çš„å­—æ®µéƒ½æœ‰å¯¹åº”çš„å­—ç¬¦é›†å±æ€§ã€‚è¡¨å’Œåˆ—çš„å­—ç¬¦é›†å±æ€§è§„å®šäº†ä»¥ä½•ç§ç¼–ç å­˜å‚¨å­—ç¬¦ç±»æ•°æ®ã€‚å¦‚æœè¡¨çš„å­—ç¬¦é›†å±æ€§è®¾ç½®ä¸å¯¹ï¼Œä¹Ÿå®¹æ˜“å¼•èµ·ä¹±ç ã€‚

å»ºè¡¨çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬ä¸æŒ‡å®šè¡¨æˆ–åˆ—çš„å­—ç¬¦é›†ï¼ŒMySQLä¼šåŸºäºä¸€äº›è§„åˆ™æ¥è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„å­—ç¬¦é›†ã€‚

**è§„åˆ™1ï¼š**å»ºåº“æ—¶ï¼Œå¦‚æœä¸æŒ‡å®šåº“çš„å­—ç¬¦é›†ï¼Œåˆ™æ ¹æ®å‚æ•°character\_set\_serverçš„é…ç½®æ¥è®¾ç½®åº“çš„é»˜è®¤å­—ç¬¦é›†ã€‚

```go
mysql> show variables like '%character_set_server%';
+----------------------+--------+
| Variable_name        | Value  |
+----------------------+--------+
| character_set_server | latin1 |
+----------------------+--------+
1 row in set (0.00 sec)

### å»ºåº“æ—¶æŒ‡å®šå­—ç¬¦é›†
mysql> create database db_latin;
Query OK, 1 row affected (0.00 sec)

### åº“çš„å­—ç¬¦é›†ä»å˜é‡character_set_serverä¸­è·å–
mysql> show create database db_latin;
+----------+--------------------------------------------------------------------------------------------------------+
| Database | Create Database                                                                                        |
+----------+--------------------------------------------------------------------------------------------------------+
| db_latin | CREATE DATABASE `db_latin` /*!40100 DEFAULT CHARACTER SET latin1 */ /*!80016 DEFAULT ENCRYPTION='N' */ |
+----------+--------------------------------------------------------------------------------------------------------+
```

**è§„åˆ™2ï¼š**å»ºè¡¨æ—¶ï¼Œå¦‚æœä¸æŒ‡å®šè¡¨çš„å­—ç¬¦é›†ï¼Œåˆ™ä»¥è¡¨æ‰€åœ¨çš„æ•°æ®åº“çš„å­—ç¬¦é›†ä½œä¸ºè¡¨çš„é»˜è®¤å­—ç¬¦é›†ã€‚

```go
### æŒ‡å®šåº“çš„å­—ç¬¦é›† UTF8
mysql> create database db_utf8 default character set utf8;
Query OK, 1 row affected, 1 warning (0.00 sec)

### åº“çš„å­—ç¬¦é›†ä¸ºGBK
mysql> create database db_gbk default character set gbk;
Query OK, 1 row affected (0.00 sec)

### å»ºè¡¨æ—¶ä¸æŒ‡å®šå­—ç¬¦é›†
mysql> create table db_utf8.t(a varchar(100));
Query OK, 0 rows affected (0.00 sec)

mysql> create table db_gbk.t(a varchar(100));
Query OK, 0 rows affected (0.00 sec)

### UTF8åº“ä¸­çš„è¡¨é»˜è®¤ä½¿ç”¨äº†UTF8å­—ç¬¦é›†
mysql> show create table db_utf8.t\G
*************************** 1. row ***************************
       Table: t
Create Table: CREATE TABLE `t` (
  `a` varchar(100) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3
1 row in set (0.01 sec)

### GBKåº“ä¸­çš„è¡¨é»˜è®¤ä½¿ç”¨äº†GBKå­—ç¬¦é›†
mysql> show create table db_gbk.t\G
*************************** 1. row ***************************
       Table: t
Create Table: CREATE TABLE `t` (
  `a` varchar(100) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=gbk
1 row in set (0.00 sec)
```

**è§„åˆ™3ï¼š**å»ºè¡¨æ—¶ï¼Œå¦‚æœä¸æŒ‡å®šå­—æ®µçš„å­—ç¬¦é›†ï¼Œåˆ™å­—æ®µçš„å­—ç¬¦é›†è®¾ç½®ä¸ºè¡¨çš„é»˜è®¤å­—ç¬¦é›†ã€‚

**è§„åˆ™4ï¼š**å¦‚æœæ˜¾å¼æŒ‡å®šå­—æ®µçš„å­—ç¬¦é›†ï¼Œåˆ™ä»¥æŒ‡å®šçš„å­—ç¬¦é›†ä¸ºå‡†ã€‚

```go
mysql> alter table db_gbk.t add c1 varchar(10), 
   add  c2 varchar(10) character set utf8mb4;
Query OK, 0 rows affected (0.01 sec)
Records: 0  Duplicates: 0  Warnings: 0

### åˆ—C2ä½¿ç”¨äº†è·Ÿè¡¨ä¸ä¸€æ ·çš„å­—ç¬¦é›†ã€‚ä½†ä¸€èˆ¬æˆ‘ä»¬å»ºè®®ä¸è¦è¿™ä¹ˆç”¨ã€‚
mysql> show create table db_gbk.t\G
*************************** 1. row ***************************
       Table: t
Create Table: CREATE TABLE `t` (
  `a` varchar(100) DEFAULT NULL,
  `c1` varchar(10) DEFAULT NULL,
  `c2` varchar(10) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=gbk
1 row in set (0.00 sec)
```

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å»ºè®®éƒ½åœ¨å»ºè¡¨çš„æ—¶å€™æ˜¾å¼æŒ‡å®šè¡¨çš„å­—ç¬¦é›†ã€‚åŒä¸€ä¸ªè¡¨çš„å¤šä¸ªå­—æ®µå°½é‡ä½¿ç”¨ç›¸åŒçš„å­—ç¬¦é›†ï¼Œä¸æ··åˆä½¿ç”¨å¤šä¸ªå­—ç¬¦é›†ã€‚åŒä¸€ä¸ªåº“é‡Œçš„å¤šä¸ªè¡¨ï¼Œä¹Ÿä½¿ç”¨åŒæ ·çš„å­—ç¬¦é›†ã€‚æ··åˆä½¿ç”¨ä¸åŒçš„å­—ç¬¦é›†å°±ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ï¼š

- å®¹æ˜“å‘ç”Ÿä¹±ç é—®é¢˜ã€‚
- è¡¨è¿æ¥æ—¶å¯èƒ½ä¼šå‘ç”Ÿéšå¼ç±»å‹è½¬æ¢ï¼Œå¯¼è‡´æŸ¥è¯¢æ— æ³•ç”¨åˆ°ä¸€äº›ç´¢å¼•ï¼Œä»è€Œå½±å“æŸ¥è¯¢çš„æ€§èƒ½ã€‚å…³äºè¿™ä¸€ç‚¹ï¼Œåç»­çš„è¯¾ç¨‹ä¸­è¿˜ä¼šæœ‰å…·ä½“çš„ä¾‹å­ï¼Œè¿™é‡Œä¸å†å±•å¼€ã€‚

ä¸‹é¢æˆ‘ä»¬å€ŸåŠ©è¿™ä¸ªå›¾ï¼Œå¯¹æ–‡æœ¬æ•°æ®åœ¨å®¢æˆ·ç«¯ã€MySQLæœåŠ¡ç«¯ã€å­˜å‚¨å¼•æ“ä¹‹é—´çš„ä¼ è¾“å’Œå¤„ç†æ—¶å¦‚ä½•ç¼–ç å’Œè§£ç åšä¸€ä¸ªå°ç»“ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/64/38/649745b726c909defaa74fa7fcbbf438.png?wh=1920x484)

- æœåŠ¡ç«¯è®¤ä¸ºå®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ•°æ®çš„å­—ç¬¦é›†æ˜¯character\_set\_clientã€‚
- å¦‚æœcharacter\_set\_connectionå’Œcharacter\_set\_clientè®¾ç½®ä¸ä¸€æ ·ï¼ŒMySQL Serverç«¯ä¼šå°†æ•°æ®è½¬æ¢æˆcharacter\_set\_connectionæŒ‡å®šçš„å­—ç¬¦é›†ã€‚
- æ•°æ®å­˜å‚¨åˆ°è¡¨é‡Œæ—¶ï¼Œæ ¹æ®è¡¨ç»“æ„å®šä¹‰ä¸­æŒ‡å®šçš„å­—ç¬¦é›†è¿›è¡Œè½¬æ¢ã€‚å¦‚æœå­—ç¬¦é›†ä¸€è‡´ï¼Œåˆ™è¿™ä¸€æ­¥ä¸éœ€è¦è¿›è¡Œè½¬æ¢ã€‚
- æ•°æ®è¿”å›åˆ°å®¢æˆ·ç«¯æ—¶ï¼ŒæŒ‰character\_set\_resultsçš„è®¾ç½®è¿›è¡Œç¼–ç ã€‚

# MySQL ä¸­ä¹±ç æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Ÿ

è¿™é‡Œæˆ‘ä»¬å†æ¥å›é¡¾ä¸€ä¸‹å‰é¢è®²è§£çš„å‡ ä¸ªå…³é”®ç‚¹ã€‚

1. æ–‡æœ¬æ•°æ®åœ¨ä¼ è¾“ã€å¤„ç†ã€å­˜å‚¨æ—¶æ¶‰åŠåˆ°ç¼–ç å’Œè§£ç çš„è¿‡ç¨‹ã€‚
2. ç¼–ç å’Œè§£ç æ—¶ï¼Œå¦‚æœä½¿ç”¨äº†é”™è¯¯çš„å­—ç¬¦é›†ï¼Œå°±ä¼šäº§ç”Ÿä¹±ç ã€‚
3. MySQLä½¿ç”¨äº†ä¸€ç³»åˆ—çš„å˜é‡æ¥æŒ‡å®šæ–‡æœ¬å¤„ç†ä¸åŒé˜¶æ®µä½¿ç”¨çš„å­—ç¬¦é›†ã€‚
4. MySQLå­—ç¬¦ç±»å‹çš„å­—æ®µéƒ½æœ‰å¯¹åº”çš„å­—ç¬¦é›†å±æ€§ï¼Œè§„å®šäº†å­˜å‚¨æ•°æ®æ—¶åº”è¯¥å¦‚ä½•ç¼–ç ã€‚

å®é™…ä¸Šï¼ŒMySQLä¸­ä¼šäº§ç”Ÿä¹±ç ï¼Œä¸»è¦ä¹Ÿæ˜¯å› ä¸ºå­—ç¬¦é›†ç›¸å…³çš„å˜é‡ï¼ˆcharacter\_set\_client, character\_set\_connectionï¼Œcharacter\_set\_resultï¼‰è®¾ç½®ä¸æ­£ç¡®ï¼Œæˆ–è€…è¡¨å’Œå­—æ®µçš„å­—ç¬¦é›†å±æ€§è®¾ç½®ä¸å¯¹ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡å‡ ä¸ªå…·ä½“çš„ä¾‹å­æ¥æ¼”ç¤ºMySQLä¸­ä¹±ç æ˜¯å¦‚ä½•äº§ç”Ÿçš„ã€‚åœ¨è¿™äº›ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬éƒ½ä¼šä½¿ç”¨MySQLè‡ªå¸¦çš„å®¢æˆ·ç«¯ã€‚åº”ç”¨ç¨‹åºä»æ•°æ®åº“è¯»å†™æ•°æ®æ—¶ï¼Œè¿‡ç¨‹åŸºæœ¬ä¸Šä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚

æˆ‘ä»¬å…ˆæä¾›ä¸€ä¸ªç”¨æ¥åˆ¤æ–­å½“å‰ç»ˆç«¯ç¼–ç çš„ç®€ä¾¿æ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨MySQLçš„hexå‡½æ•°ã€‚

è¿™æ˜¯ä¸€ä¸ªGBKç¼–ç çš„ç»ˆç«¯ã€‚

```plain
mysql> select hex('ä¸­æ–‡ç¬¦å·');
+------------------+
| hex('ä¸­æ–‡ç¬¦å·')  |
+------------------+
| D6D0CEC4B7FBBAC5 |
+------------------+
```

è¿™æ˜¯ä¸€ä¸ªUTF8ç¼–ç çš„ç»ˆç«¯ã€‚

```plain
mysql>  select hex('ä¸­æ–‡ç¬¦å·');
+--------------------------+
| hex('ä¸­æ–‡ç¬¦å·')          |
+--------------------------+
| E4B8ADE69687E7ACA6E58FB7 |
+--------------------------+
```

## ä¹±ç æƒ…å†µ 1ï¼šè¡¨çš„å­—ç¬¦é›†å±æ€§è®¾ç½®é”™è¯¯

ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œå› ä¸ºè¡¨ä½¿ç”¨äº†latin1å­—ç¬¦é›†ï¼Œè€Œlatin1ä¸æ”¯æŒä¸­æ–‡ï¼Œå› æ­¤å†™å…¥ä¸­æ–‡æ—¶ä¼šæŠ¥é”™ã€‚

```go
mysql> use db1;
Database changed
mysql> create table t_latin(a varchar(100))charset latin1;
Query OK, 0 rows affected (0.01 sec)

mysql> insert into t_latin values('ä¸­æ–‡');
ERROR 1366 (HY000): Incorrect string value: '\xE4\xB8\xAD\xE6\x96\x87' for column 'a' at row 1
```

**é”™è¯¯çš„è§£å†³æ–¹æ³•ï¼š**MySQLå®¢æˆ·ç«¯æ‰§è¡Œå°†å­—ç¬¦é›†æ”¹ä¸ºlatin1ï¼Œç„¶åå†æ’å…¥æ•°æ®ï¼Œçœ‹èµ·æ¥å¥½åƒèƒ½æ­£å¸¸è¯»å†™ä¸­æ–‡äº†ã€‚

```go
mysql> set names 'latin1';
Query OK, 0 rows affected (0.00 sec)

mysql> insert into t_latin values('ä¸­æ–‡');
Query OK, 1 row affected (0.00 sec)

mysql> select * from t_latin;
+--------+
| a      |
+--------+
| ä¸­æ–‡   |
+--------+
1 row in set (0.00 sec)
```

è¿™æ˜¯é”™è¯¯çš„æ–¹æ³•ï¼ˆåªæ˜¯ä½œä¸ºä¸€ä¸ªä¾‹å­æ¼”ç¤ºï¼ŒçœŸå®åœºæ™¯ä¸‹åƒä¸‡ä¸è¦è¿™ä¹ˆåšï¼‰ï¼Œæœ‰éå¸¸å¤§çš„éšæ‚£ã€‚

é¦–å…ˆç»Ÿè®¡å­—ç¬¦æ•°æ—¶ï¼Œå¯ä»¥çœ‹åˆ°ç»“æœæ˜¯ä¸å¯¹çš„ã€‚

```go
mysql> set names 'latin1';
Query OK, 0 rows affected (0.00 sec)

mysql> select a, char_length(a)  from t_latin;
+--------+----------------+
| a      | char_length(a) |
+--------+----------------+
| ä¸­æ–‡   |              6 |
+--------+----------------+
1 row in set (0.00 sec)
```

è€Œä¸”åœ¨ä¸€ä¸ªè®¾ç½®æ­£å¸¸çš„ç¯å¢ƒä¸‹ï¼Œè¯»å–åˆ°çš„æ•°æ®ä¼šå˜æˆä¹±ç ã€‚

```go
mysql> select * from t_latin;
+----------------+
| aÂ  Â  Â  Â  Â  Â  Â  |
+----------------+
| Ã¤Â¸Â­Ã¦â€“â€¡Â  Â  Â  Â  Â |
+----------------+
1 row in set (0.00 sec)
```

è¿™ä¸ªé—®é¢˜çš„æ ¹æœ¬åŸå› åœ¨äºï¼Œlatin1å­—ç¬¦é›†æ— æ³•å­˜å‚¨ä¸­æ–‡ã€‚è§£å†³æ–¹æ³•å°±æ˜¯ä½¿ç”¨èƒ½æ­£ç¡®å­˜å‚¨ä¸­æ–‡çš„å­—ç¬¦é›†ï¼Œæ¯”å¦‚GBKæˆ–UTF8ã€‚

å¦‚æœä½ å·²ç»é‡åˆ°è¿™æ ·çš„é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›æ–¹æ³•è¿›è¡Œè¡¥æ•‘ã€‚æ¯”å¦‚ï¼š

1. ä½¿ç”¨msyqldumå¯¼å‡ºæ•°æ®ï¼Œå­—ç¬¦é›†æŒ‡å®šä¸ºlatin1ã€‚

```plain
mysqldump -uroot --default-character-set=latin1 db1 t_latin > t_latin.sql
```

2. æ ¹æ®æ•°æ®çš„åŸå§‹ç¼–ç ï¼Œä¿®æ”¹mysqldumpç”Ÿæˆçš„sqlæ–‡ä»¶ã€‚åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼ŒåŸå§‹ç¼–ç ä¸ºUTF8ï¼Œå¯ä»¥è¿™ä¹ˆä¿®æ”¹ã€‚  
   ![å›¾ç‰‡](https://static001.geekbang.org/resource/image/c7/77/c7044e412dbyye2087c20b4e8b5yy077.png?wh=1232x964)
3. é‡æ–°å¯¼å…¥æ•°æ®ã€‚

```plain
mysql -uroot db1 < t_latin.sql
```

è¿™æ ·å¤„ç†åï¼Œæ•°æ®å°±æ¢å¤æ­£å¸¸äº†ã€‚

```plain
mysql> select a, char_length(a), hex(a) from t_latin;
+--------+----------------+--------------+
| aÂ  Â  Â  | char_length(a) | hex(a)Â  Â  Â  Â |
+--------+----------------+--------------+
| ä¸­æ–‡Â  Â |Â  Â  Â  Â  Â  Â  Â  2 | E4B8ADE69687 |
+--------+----------------+--------------+
```

å½“ç„¶ï¼Œæ“ä½œå‰éœ€è¦å…ˆå¤‡ä»½å¥½æ•°æ®ã€‚å¤„ç†æ—¶ï¼Œä¹Ÿéœ€è¦å…ˆæš‚åœåº”ç”¨ç¨‹åºï¼Œé¿å…åœ¨å¤„ç†è¿‡ç¨‹ä¸­å†™å…¥æ–°çš„æœ‰é—®é¢˜çš„æ•°æ®ã€‚

## ä¹±ç æƒ…å†µ 2ï¼šcharacter\_set\_result å’Œç»ˆç«¯çš„ç¼–ç ä¸ä¸€è‡´

ç»ˆç«¯çš„å­—ç¬¦ç¼–ç ä¸ºUTF8ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/f3/e0/f37b24ecb8db7d0b38725accfbf570e0.png?wh=1100x240)

å…ˆå‡†å¤‡ä¸€äº›ï¼ˆæ­£ç¡®çš„ï¼‰æµ‹è¯•æ•°æ®ã€‚

```go
mysql> create table t_char1(a varchar(30)) charset utf8mb4;
Query OK, 0 rows affected (0.01 sec)

mysql> insert into t_char1 values('ä¸­æ–‡ç¬¦å·');
Query OK, 1 row affected (0.00 sec)

mysql> select a, hex(a) from t_char1;
+--------------+--------------------------+
| a            | hex(a)                   |
+--------------+--------------------------+
| ä¸­æ–‡ç¬¦å·     | E4B8ADE69687E7ACA6E58FB7 |
+--------------+--------------------------+
1 row in set (0.00 sec)
```

åœ¨UTF8ç¯å¢ƒä¸‹ï¼Œå¦‚æœcharacter\_set\_resultsè®¾ç½®ä¸ºGBKï¼ŒæŸ¥è¯¢æ•°æ®æ—¶ä¼šçœ‹åˆ°ä¹±ç ã€‚

```go
mysql> set character_set_results=gbk;
Query OK, 0 rows affected (0.00 sec)

mysql> select a,hex(a) from t_char1;
+----------+--------------------------+
| a        | hex(a)                   |
+----------+--------------------------+
| ï¿½ï¿½ï¿½Ä·ï¿½ï¿½        | E4B8ADE69687E7ACA6E58FB7 |
+----------+--------------------------+
1 row in set (0.01 sec)
```

ç”±äºcharacter\_set\_resultsè®¾ç½®ä¸ºGBKï¼ŒMySQLå°†è¿”å›çš„æ•°æ®ä»¥GBKæ–¹å¼ç¼–ç ã€‚åŒæ—¶å› ä¸ºç»ˆç«¯æ˜¯UTF8ç¯å¢ƒï¼ŒæŒ‰UTF8ç¼–ç çš„æ•°æ®è¿›è¡Œè§£ç ï¼Œä½†æ˜¯UTF8ç¼–ç æ— æ³•è§£æè¿™ä¸€ä¸²æ•°æ®ï¼Œæ— æ³•è§£ç çš„æ•°æ®ä½¿ç”¨äº†ç¬¦å·â€œï¿½â€è¿›è¡Œæ›¿ä»£ï¼Œå› æ­¤æˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸²é—®å·ã€‚

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹Pythonä»£ç æ¥æ¨¡æ‹Ÿè¿™ä¸ªè¿‡ç¨‹ã€‚

```go
>>> u"ä¸­æ–‡ç¬¦å·".encode('gbk')
'\xd6\xd0\xce\xc4\xb7\xfb\xba\xc5'

>>> u"ä¸­æ–‡ç¬¦å·".encode('gbk').decode('utf8', errors='replace')
u'\ufffd\ufffd\ufffd\u0137\ufffd\ufffd\ufffd'

>>> print u"ä¸­æ–‡ç¬¦å·".encode('gbk').decode('utf8', errors='replace')
ï¿½ï¿½ï¿½Ä·ï¿½ï¿½ï¿½
```

åè¿‡æ¥ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨äº†GBKç»ˆç«¯ï¼Œé‚£ä¹ˆcharacter\_set\_resultséœ€è¦è®¾ç½®ä¸ºGBKã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/e2/04/e2f5fyyb4023cf664f75ea5333fdab04.png?wh=1098x238)

```go
mysql> set names gbk;
Query OK, 0 rows affected (0.00 sec)

mysql> select a,hex(a) from t_char1;
+----------+--------------------------+
| a        | hex(a)                   |
+----------+--------------------------+
| ä¸­æ–‡ç¬¦å·        | E4B8ADE69687E7ACA6E58FB7 |
+----------+--------------------------+
1 row in set (0.00 sec)
```

å¦‚æœcharacter\_set\_resultsè®¾ç½®ä¸ºUTF8ï¼Œåˆ™ä¼šå‡ºç°å¦ä¸€ç§ä¹±ç çš„ç°è±¡ã€‚

```go
mysql> set character_set_results=utf8;
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql> select a,hex(a) from t_char1;
+--------------+--------------------------+
| a            | hex(a)                   |
+--------------+--------------------------+
| æ¶“î…Ÿæƒç»—ï¹€å½¿     | E4B8ADE69687E7ACA6E58FB7 |
+--------------+--------------------------+
1 row in set (0.00 sec)
```

è¿™ç§æƒ…å†µä¸‹ï¼Œç”±äºcharacter\_set\_resultsä¸ºUTF8ï¼Œå› æ­¤MySQLå°†æ•°æ®æŒ‰UTF8æ–¹å¼è¿›è¡Œç¼–ç åä¼ è¾“ç»™å®¢æˆ·ç«¯ã€‚ä½†æ˜¯ç”±äºå®¢æˆ·ç«¯æ˜¯GBKçš„ç¼–ç ï¼Œå› æ­¤ä»¥GBKçš„æ–¹å¼å¯¹è¿”å›çš„æ•°æ®è¿›è¡Œè§£ç ã€‚

ä¸‹é¢çš„Pythonä»£ç æ¨¡æ‹Ÿäº†è¿™ä¸ªè¿‡ç¨‹ã€‚

```go
>>> u"ä¸­æ–‡ç¬¦å·".encode('utf8')
'\xe4\xb8\xad\xe6\x96\x87\xe7\xac\xa6\xe5\x8f\xb7'

>>> u"ä¸­æ–‡ç¬¦å·".encode('utf8').decode('gbk', errors='replace')
u'\u6d93\ufffd\u6783\u7ed7\ufe40\u5f7f'

>>> print u"ä¸­æ–‡ç¬¦å·".encode('utf8').decode('gbk', errors='replace')
æ¶“ï¿½æƒç»—ï¹€å½¿
```

ä¸Šé¢æ¼”ç¤ºçš„è¿™ä¸¤ç§ä¹±ç ç°è±¡ï¼Œéƒ½æ˜¯ç”±äºcharacter\_set\_resultsçš„è®¾ç½®å’ŒçœŸå®ç¯å¢ƒçš„ç¼–ç ä¸åŒ¹é…å¼•èµ·çš„ã€‚è™½ç„¶çœ‹ä¸Šå»æœ‰ä¹±ç ï¼Œä½†å®é™…ä¸Šæ•°æ®åº“ä¸­å­˜å‚¨çš„æ•°æ®æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œå› æ­¤è§£å†³æ–¹æ³•ä¹Ÿç®€å•ï¼Œåªè¦å°†character\_set\_resultsçš„è®¾ç½®å’Œç»ˆç«¯çš„å­—ç¬¦ç¼–ç è®¾ç½®æˆä¸€æ ·å°±å¯ä»¥äº†ã€‚

## ä¹±ç æƒ…å†µ 3ï¼šcharacter\_set\_client å’Œç»ˆç«¯çš„ç¼–ç ä¸ä¸€è‡´

å¦‚æœcharacter\_set\_clientçš„è®¾ç½®å’Œç»ˆç«¯çš„ç¼–ç ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆåœ¨å†™å…¥æ•°æ®æ—¶ï¼Œå°±ä¼šäº§ç”Ÿä¹±ç ã€‚æˆ‘ä»¬åˆ†ä¸¤ç§æƒ…å†µæ¥è®¨è®ºã€‚

### UTF8 ç»ˆç«¯ï¼Œcharacter\_set\_client è®¾ç½®ä¸ºGBK

ç»ˆç«¯æ˜¯UTF8ç¼–ç ï¼Œä½†æ˜¯character\_set\_clienté”™è¯¯åœ°è®¾ç½®æˆäº†GBKï¼Œæ­¤æ—¶å¦‚æœå†™å…¥æ•°æ®ï¼Œå¯ä»¥å‘ç°insertè¯­å¥äº§ç”Ÿäº†warningï¼Œæç¤ºç¼–ç è½¬æ¢å­˜åœ¨é—®é¢˜ã€‚

```go
mysql> create table t_utf8(a varchar(30)) charset utf8;
Query OK, 0 rows affected, 1 warning (0.02 sec)

mysql> set character_set_client='gbk';
Query OK, 0 rows affected (0.00 sec)

mysql> insert into t_utf8 values('ä¸­æ–‡ç¬¦å·');
Query OK, 1 row affected, 1 warning (0.00 sec)

mysql> show warnings;
+---------+------+-------------------------------------------------------------------------+
| Level   | Code | Message                                                                 |
+---------+------+-------------------------------------------------------------------------+
| Warning | 1300 | Cannot convert string '\xE4\xB8\xAD\xE6\x96\x87...' from gbk to utf8mb3 |
+---------+------+-------------------------------------------------------------------------+
```

æŸ¥çœ‹æ•°æ®æ—¶ï¼Œå‘ç°å·²ç»æœ‰ä¹±ç äº§ç”Ÿï¼Œè€Œä¸”æ•°æ®åº“ä¸­å­˜å‚¨çš„ç¼–ç å·²ç»æœ‰é—®é¢˜äº†ï¼ˆå­˜å‚¨äº†E6B6933FE69E83E7BB97EFB980E5BDBFï¼Œæ­£ç¡®çš„åº”è¯¥æ˜¯E4B8ADE69687E7ACA6E58FB7ï¼‰ã€‚

```go
-- åœ¨è®¾ç½®æ­£ç¡®çš„ç»ˆç«¯ä¸‹æŸ¥è¯¢æ•°æ®

mysql> select a, hex(a) from t_utf8;
+------------------+----------------------------------+
| a                | hex(a)                           |
+------------------+----------------------------------+
| æ¶“?æƒç»—ï¹€å½¿      | E6B6933FE69E83E7BB97EFB980E5BDBF |
+------------------+----------------------------------+
1 row in set (0.00 sec)
```

ç”±äºæ•°æ®åº“ä¸­å­˜å‚¨çš„æ•°æ®å·²ç»æœ‰é—®é¢˜äº†ï¼ŒåŸå§‹æ•°æ®å¯èƒ½ä¼šæœ‰ä¸¢å¤±ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•æ¥æ‰¾å›åŸå§‹æ•°æ®ã€‚

```go
-- ç»ˆç«¯ä¸ºUTF8ï¼Œå°†character_set_resultsè®¾ç½®ä¸ºGBK
mysql> set names gbk;
Query OK, 0 rows affected (0.00 sec)

mysql> select a, hex(a) from t_utf8;
+-------------+----------------------------------+
| a           | hex(a)                           |
+-------------+----------------------------------+
| ï¿½?ï¿½ï¿½ç¬¦å·       | E6B6933FE69E83E7BB97EFB980E5BDBF |
+-------------+----------------------------------+
1 row in set (0.00 sec)
```

å¯ä»¥çœ‹åˆ°ï¼ŒåŸå§‹çš„æ–‡æœ¬ä¸ºâ€œä¸­æ–‡ç¬¦å·â€ï¼Œæˆ‘ä»¬è¿˜åŸäº†ä¸€éƒ¨åˆ†æ•°æ®â€œç¬¦å·â€ã€‚ä½†æ˜¯â€œä¸­æ–‡â€åœ¨è½¬æ¢è¿‡ç¨‹ä¸­ä¸¢å¤±äº†ã€‚

å¦‚æœæˆ‘ä»¬å°†character\_set\_clientå’Œcharacter\_set\_connectionå…¨éƒ¨éƒ½è®¾ç½®ä¸ºGBKï¼Œåˆ™æ•°æ®å†™å…¥æ—¶å°±ä¼šæŠ¥é”™ã€‚

```go
mysql> set character_set_client='gbk';
Query OK, 0 rows affected (0.00 sec)

mysql> set character_set_connection='gbk';
Query OK, 0 rows affected (0.00 sec)

mysql> insert into t_utf8 values('ä¸­æ–‡ç¬¦å·');
ERROR 1366 (HY000): Incorrect string value: '\xAD\xE6\x96\x87\xE7\xAC...' for column 'a' at row 1
```

è¿™è¯´æ˜äº†MySQLå®¹å¿äº†æ–‡æœ¬ç¼–ç ä»character\_set\_clientè½¬æ¢åˆ°character\_set\_connectionæ—¶çš„é”™è¯¯ã€‚ä½†å¦‚æœå¾€å­˜å‚¨å¼•æ“ä¸­å†™å…¥æ•°æ®æ—¶ç¼–ç è½¬æ¢æœ‰é—®é¢˜ï¼Œè¯­å¥å°±ä¼šå¤±è´¥ï¼Œæ•°æ®æ— æ³•å†™å…¥åˆ°æ•°æ®åº“ã€‚

### GBK ç»ˆç«¯ï¼Œcharacter\_set\_client è®¾ç½®ä¸º UTF8

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç»ˆç«¯æ˜¯GBKç¯å¢ƒï¼Œä½†æ˜¯character\_set\_clienté”™è¯¯åœ°è®¾ç½®æˆäº†UTF8ï¼Œæ­¤æ—¶å¦‚æœå†™å…¥æ•°æ®ï¼Œå¯ä»¥å‘ç°insertè¯­å¥äº§ç”Ÿäº†warningï¼Œæç¤ºç¼–ç è½¬æ¢å­˜åœ¨é—®é¢˜ã€‚

```go
mysql> create table t_utf8_2(a varchar(30)) charset utf8;
Query OK, 0 rows affected, 1 warning (0.01 sec)

-- gbkç»ˆç«¯
mysql> set character_set_client='utf8';
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql> insert into t_utf8_2 values('ä¸­æ–‡ç¬¦å·');
Query OK, 1 row affected, 1 warning (0.01 sec)


mysql> show warnings;
+---------+------+-------------------------------------------------------------------------+
| Level   | Code | Message                                                                 |
+---------+------+-------------------------------------------------------------------------+
| Warning | 1300 | Cannot convert string '\xD6\xD0\xCE\xC4\xB7\xFB...' from utf8mb3 to gbk |
+---------+------+-------------------------------------------------------------------------+
1 row in set (0.00 sec)
```

æˆ‘ä»¬åœ¨ä¸€ä¸ªç¼–ç è®¾ç½®æ­£ç¡®çš„ç»ˆç«¯ä¸‹æŸ¥çœ‹æ•°æ®ã€‚

```go
mysql> select a, hex(a) from t_utf8_2;
+--------+--------------+
| a      | hex(a)       |
+--------+--------------+
| ?????? | 3F3F3F3F3F3F |
+--------+--------------+
1 row in set (0.00 sec)
```

è¿™ç§æƒ…å†µä¸‹ï¼Œè¡¨é‡Œå­˜å‚¨çš„æ•°æ®å…¨éƒ¨å˜æˆäº†é—®å·ï¼ˆ0x3Få°±æ˜¯é—®å·çš„asciiç¼–ç ï¼‰ã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒåŸå§‹æ•°æ®å·²ç»å®Œå…¨ä¸¢å¤±äº†ã€‚

å¦‚æœcharacter\_set\_clientå’Œcharacter\_set\_connectionè®¾ç½®æˆä¸€æ ·ï¼Œåˆ™æ•°æ®è½¬æ¢å‘ç”Ÿåœ¨æ•°æ®å¾€å­˜å‚¨å¼•æ“å†™å…¥çš„è¿‡ç¨‹ä¸­ï¼Œè¯­å¥ä¼šç›´æ¥å¤±è´¥ã€‚

```go
mysql> set names utf8;
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql> insert into t_utf8_2 values('ä¸­æ–‡ç¬¦å·');
ERROR 1366 (HY000): Incorrect string value: '\xD6\xD0\xCE\xC4\xB7\xFB...' for column 'a' at row 1
```

æ€»ç»“ä¸€ä¸‹ï¼Œå†™å…¥æ•°æ®æ—¶ï¼Œå¦‚æœcharacter\_set\_clientçš„è®¾ç½®å’Œæ•°æ®çš„å®é™…ç¼–ç ä¸ä¸€è‡´ï¼Œå°±å¯èƒ½ä¼šäº§ç”Ÿä¹±ç ï¼Œæˆ–è€…åœ¨å†™å…¥æ•°æ®æ—¶ç›´æ¥æŠ¥é”™ã€‚å¦‚æœå†™å…¥äº†ä¹±ç æ•°æ®ï¼Œæœ‰å¯èƒ½æ— æ³•è·å–åˆ°åŸå…ˆæ­£ç¡®çš„æ•°æ®ã€‚

## ä¹±ç æƒ…å†µ 4ï¼šè¡¨ç»“æ„ä¹±ç 

æˆ‘ä»¬åœ¨æ‰§è¡ŒDDLæ—¶ï¼Œå¦‚æœç»ˆç«¯ç¯å¢ƒå’Œæ•°æ®åº“å­—ç¬¦é›†å‚æ•°ï¼ˆcharacte\_set\_clientï¼‰è®¾ç½®ä¸ä¸€è‡´ï¼Œå¹¶ä¸”DDLä¸­ä½¿ç”¨äº†ä¸­æ–‡ç¬¦å·ï¼Œä¹Ÿå¯èƒ½ä¼šäº§ç”Ÿä¹±ç ã€‚è¿™é‡Œäº§ç”Ÿä¹±ç çš„åŸå› å’Œå‰é¢æ•°æ®ä¹±ç çš„åŸå› ç±»ä¼¼ã€‚è¿™é‡Œç®€å•ä¸¾å‡ ä¸ªä¾‹å­ã€‚

ç»ˆç«¯ä¸ºUTF8ç¯å¢ƒï¼Œä½†æ˜¯å­—ç¬¦é›†é”™è¯¯åœ°è®¾ç½®æˆäº†GBKã€‚

```go
mysql> create database db_03;
Query OK, 1 row affected (0.00 sec)

mysql> use db_03
Database changed

mysql> create table ä¸­æ–‡ç¬¦å·è¡¨_t_01(a int);
Query OK, 0 rows affected, 1 warning (0.01 sec)

mysql> show warnings;
+---------+------+-------------------------------------------------------------------------+
| Level   | Code | Message                                                                 |
+---------+------+-------------------------------------------------------------------------+
| Warning | 1300 | Cannot convert string '\xE4\xB8\xAD\xE6\x96\x87...' from gbk to utf8mb3 |
+---------+------+-------------------------------------------------------------------------+
1 row in set (0.00 sec)


mysql> show tables;
+---------------------+
| Tables_in_db_03     |
+---------------------+
| ï¿½?ï¿½ï¿½ç¬¦å·è¡¨_t_01        |
+---------------------+
1 row in set (0.01 sec)
```

æˆ‘ä»¬åˆ°å­—ç¬¦é›†ä¸ºUTF8çš„ç»ˆç«¯ä¸‹æŸ¥çœ‹ï¼Œå‘ç°è¡¨åä¾ç„¶æ˜¯ä¹±ç ã€‚

```go
mysql> set names utf8;
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql> show tables;
+----------------------------+
| Tables_in_db_03            |
+----------------------------+
| æ¶“?æƒç»—ï¹€å½¿ç›â•›t_01         |
+----------------------------+
1 row in set (0.00 sec)
```

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Pythonæ¥æ¨¡æ‹Ÿè¿™ä¸ªç¼–ç è½¬æ¢çš„è¿‡ç¨‹ã€‚

```go
### åŸå§‹ç¼–ç 
>>> u"ä¸­æ–‡ç¬¦å·è¡¨_t_01".encode('utf8')
'\xe4\xb8\xad\xe6\x96\x87\xe7\xac\xa6\xe5\x8f\xb7\xe8\xa1\xa8_t_01'

### åŸå§‹ç¼–ç ä½¿ç”¨GBKè§£ç åï¼Œå†ç¼–ç æˆUTF8
>>> u"ä¸­æ–‡ç¬¦å·è¡¨_t_01".encode('utf8').decode('gbk',errors='replace').encode('utf8')
'\xe6\xb6\x93\xef\xbf\xbd\xe6\x9e\x83\xe7\xbb\x97\xef\xb9\x80\xe5\xbd\xbf\xe7\x90\x9b\xe2\x95\x9bt_01'

### è¿™å°±æ˜¯æˆ‘ä»¬show tablesçœ‹åˆ°çš„æƒ…å†µã€‚
>>> print u"ä¸­æ–‡ç¬¦å·è¡¨_t_01".encode('utf8').decode('gbk',errors='replace').encode('utf8')
æ¶“ï¿½æƒç»—ï¹€å½¿ç›â•›t_01
```

å¦‚æœæˆ‘ä»¬åœ¨GBKç¼–ç çš„ç»ˆç«¯ä¸‹ï¼Œé”™è¯¯åœ°å°†å­—ç¬¦é›†è®¾ç½®æˆäº†UTF8ã€‚

```go
-- GBKç»ˆç«¯
mysql> set names utf8;
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql> create table ä¸­æ–‡ç¬¦å·è¡¨_t_02(a int);
ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '???å§†??ç–Ÿ?_t_02(a int)' at line 1

mysql> create table ` ä¸­æ–‡ç¬¦å·è¡¨_t_02`(a i);
ERROR 1300 (HY000): Invalid utf8mb3 character string: '\xD6\xD0\xCE\xC4\xB7\xFB\xBA\xC5\xB1\xED_t_02'
```

è¿˜å¥½åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒDDLç›´æ¥å¤±è´¥äº†ã€‚

ä¸Šé¢çš„ä¾‹å­é‡Œï¼Œæˆ‘ä»¬ç‰¹æ„ä½¿ç”¨äº†ä¸­æ–‡è¡¨åæ¥åšæµ‹è¯•ã€‚MySQLä¸­è¡¨åã€åˆ—åã€è¡¨å’Œåˆ—çš„æ³¨é‡Šéƒ½å¯ä»¥ä½¿ç”¨Unicodeï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬ä¸­æ–‡ã€‚ä½¿ç”¨ä¸­æ–‡è¡¨åã€åˆ—åçš„æƒ…å†µå¯èƒ½æ¯”è¾ƒå°‘è§ï¼Œä½†æ˜¯è¡¨å’Œå­—æ®µçš„æ³¨é‡Šç»å¸¸ä¼šä½¿ç”¨ä¸­æ–‡ï¼Œå¦‚æœå®¢æˆ·ç«¯å­—ç¬¦é›†è®¾ç½®ä¸å¯¹ï¼Œå°±å®¹æ˜“å‡ºç°ä¹±ç ã€‚

## ä¹±ç æƒ…å†µ 5ï¼šæ•°æ®å¯¼å…¥å¯¼å‡ºæ—¶çš„å­—ç¬¦é›†è®¾ç½®ä¸å¯¹

æˆ‘ä»¬åœ¨è¿›è¡Œæ•°æ®è¿ç§»çš„æ—¶å€™ï¼Œå¦‚æœæŸä¸ªç¯èŠ‚å­—ç¬¦é›†è®¾ç½®ä¸å¯¹ï¼Œå°±æœ‰å¯èƒ½ä¼šäº§ç”Ÿä¹±ç ã€‚ä¸€èˆ¬åœ¨è¿›è¡Œæ•°æ®è¿ç§»ã€æ•°æ®å¯¼å…¥å¯¼å‡ºåï¼Œéœ€è¦é‡ç‚¹æ£€æŸ¥ä¸‹æ˜¯å¦æœ‰ä¹±ç äº§ç”Ÿã€‚mysqldumpæ˜¯å¾ˆå¸¸ç”¨çš„ä¸€ä¸ªæ•°æ®å¤‡ä»½å·¥å…·ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨mysqldumpæ¥æ¼”ç¤ºä¸€ä¸ªç”±äºå­—ç¬¦é›†è®¾ç½®ä¸å¯¹è€Œå¯¼è‡´çš„ä¹±ç é—®é¢˜ã€‚

å…ˆåˆ›å»ºä¸€ä¸ªæµ‹è¯•è¡¨ï¼Œå‡†å¤‡ä¸€ç‚¹æµ‹è¯•æ•°æ®ã€‚

```go
mysql> create database db_emoji;
Query OK, 1 row affected (0.00 sec)

mysql> use db_emoji
Database changed


mysql> create table t_emoji(a varchar(30)) charset utf8mb4;
Query OK, 0 rows affected (0.01 sec)


mysql> insert into t_emoji values('row1:ğŸ˜€ğŸ˜€ğŸ˜€');
ERROR 1366 (HY000): Incorrect string value: '\xF0\x9F\x98\x80\xF0\x9F...' for column 'a' at row 1

### ä½¿ç”¨emojiæ•°æ®æ—¶ï¼Œå­—ç¬¦é›†éœ€è¦è®¾ç½®ä¸ºutf8mb4
mysql> set names utf8mb4;
Query OK, 0 rows affected (0.00 sec)


mysql> insert into t_emoji values('row1:ğŸ˜€ğŸ˜€ğŸ˜€');
Query OK, 1 row affected (0.00 sec)

mysql> insert into t_emoji values('row2:no emoji chars');
Query OK, 1 row affected (0.00 sec)

### æˆ‘ä»¬ç¡®è®¤è¡¨é‡Œçš„æ•°æ®æ²¡æœ‰é—®é¢˜
mysql> select * from t_emoji;
+---------------------+
| a                   |
+---------------------+
| row1:ğŸ˜€ğŸ˜€ğŸ˜€               |
| row2:no emoji chars |
+---------------------+
2 rows in set (0.00 sec)
```

æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨mysqldumpæ¥å¤‡ä»½åˆšåˆšåˆ›å»ºçš„è¡¨ã€‚

```go
$ mysqldump -uroot db_emoji > db_emoji.sql
```

æˆ‘ä»¬çŸ¥é“mysqldumpäº§ç”Ÿçš„æ˜¯æ•°æ®åº“çš„é€»è¾‘å¤‡ä»½ï¼Œä¼šå°†åº“è¡¨é‡Œçš„æ•°æ®ä»¥INSERTè¯­å¥çš„æ–¹å¼å¯¼å‡ºã€‚

```go
$ grep 'INSERT INTO' db_emoji.sql
INSERT INTO `t_emoji` VALUES ('row1:???'),('row2:no emoji chars');
```

æ£€æŸ¥åå‘ç°emojiå­—ç¬¦éƒ½è¢«æ›¿æ¢æˆäº†é—®å·ã€‚å¦‚æœæˆ‘ä»¬å°†åˆšåˆšå¤‡ä»½å‡ºæ¥çš„æ•°æ®æ¢å¤åˆ°æ•°æ®åº“ï¼Œå°±ä¼šå‘ç°æ•°æ®æœ‰é—®é¢˜äº†ã€‚

è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦åœ¨å¤‡ä»½æ—¶æŒ‡å®šæ­£ç¡®çš„å­—ç¬¦é›†ã€‚

```go
$ mysqldump --default-character-set utf8mb4 -uroot db_emoji > db_emoji_utf8mb4.sql

$ grep 'INSERT INTO' db_emoji_utf8mb4.sql
INSERT INTO `t_emoji` VALUES ('row1:ğŸ˜€ğŸ˜€ğŸ˜€'),('row2:no emoji chars');
```

å¯ä»¥çœ‹åˆ°ï¼Œå°†å­—ç¬¦é›†æŒ‡å®šä¸º utf8mb4 åï¼Œå¯¼å‡ºçš„æ•°æ®å°±æ²¡æœ‰é—®é¢˜äº†ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨mysqldumpå¤‡ä»½æ—¶ï¼Œå»ºè®®ç»Ÿä¸€éƒ½æŒ‡å®š utf8mb4 å­—ç¬¦é›†ã€‚

# æ€»ç»“æ—¶åˆ»

åœ¨è¿™ä¸€è®²ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†æ–‡æœ¬ç¼–ç å’Œè§£ç çš„ä¸€èˆ¬è¿‡ç¨‹ï¼Œä»¥åŠä¹±ç äº§ç”Ÿçš„å‡ ç§æƒ…å†µã€‚æˆ‘ä»¬è¿˜å­¦ä¹ äº†MySQLå¦‚ä½•å¤„ç†æ–‡æœ¬ç¼–ç ï¼Œä»¥åŠåœ¨ä½¿ç”¨MySQLæ—¶ä½ å¯èƒ½ä¼šé‡åˆ°çš„å‡ ç§ä¹±ç é—®é¢˜ï¼Œå¹¶ç»™å‡ºäº†ç›¸åº”çš„è§£å†³æ–¹æ³•ã€‚

æœ€åæ€»ç»“ä¸€ä¸‹å‡ ä¸ªå…³é”®ç‚¹ã€‚

1. æ ¹æ®éœ€è¦å­˜å‚¨å’Œå¤„ç†çš„æ–‡æœ¬ç±»å‹å†³å®šä½¿ç”¨å“ªç§å­—ç¬¦é›†ã€‚ä¸€èˆ¬å¦‚æœè¦å¤„ç†ä¸­æ–‡ï¼Œå¯ä»¥é€‰æ‹©GBKæˆ–UTF8å­—ç¬¦é›†ã€‚GBKä½¿ç”¨åŒå­—èŠ‚å­˜å‚¨ä¸€ä¸ªæ±‰å­—ï¼Œåœ¨ç©ºé—´ä¸Šæœ‰ä¸€å®šçš„ä¼˜åŠ¿ã€‚UTF8é€‚ç”¨æ€§æ›´å¹¿ã€‚
2. å®¢æˆ·ç«¯éœ€è¦è®¾ç½®æ­£ç¡®çš„å­—ç¬¦é›†ã€‚å­—ç¬¦é›†çš„è®¾ç½®è¦å’Œç¨‹åºä¸­æ•°æ®çš„å®é™…ç¼–ç ä¿æŒä¸€è‡´ã€‚
3. MySQLä¸­ï¼Œå»ºè®®ä½¿ç”¨ utf8mb4 å­—ç¬¦é›†ã€‚å› ä¸ºMySQLä¸­UTF8å­—ç¬¦é›†å®é™…ä¸Šæ˜¯ utf8mb3ï¼Œæ— æ³•å­˜å‚¨4å­—èŠ‚çš„Unicodeç¼–ç ï¼Œå¦‚emojiå­—ç¬¦ã€‚
4. æ•°æ®åº“ä¸­ï¼Œå»ºè®®é€‰æ‹©ä¸€ç§ç»Ÿä¸€çš„å­—ç¬¦ç¼–ç ï¼Œå°½é‡é¿å…ä½¿ç”¨å¤šç§ä¸åŒçš„å­—ç¬¦é›†ã€‚

# æ€è€ƒé¢˜

æŸä¸€ä¸ªé¡¹ç›®å‘å¸ƒæ—¶ï¼Œæ‰§è¡Œäº†ä»¥ä¸‹æ•°æ®åˆå§‹åŒ–è„šæœ¬ã€‚

```plain
mysql> CREATE TABLE `t_b` (
    ->   `a` varchar(30) DEFAULT NULL
    -> ) ENGINE=InnoDB DEFAULT CHARSET=gbk;
Query OK, 0 rows affected (0.03 sec)


mysql> set names gbk;
Query OK, 0 rows affected (0.00 sec)

mysql>  insert into t_b values('ä¸­æ–‡ç¬¦å·');
Query OK, 1 row affected (0.00 sec)
```

å¯¹æ•°æ®è¿›è¡Œæ£€æŸ¥åï¼Œæ²¡æœ‰å‘ç°ä»»ä½•é—®é¢˜ã€‚

```plain
mysql> select * from t_b;
+--------------+
| a            |
+--------------+
| ä¸­æ–‡ç¬¦å·     |
+--------------+
1 row in set (0.00 sec)
```

ä½†æ˜¯å¦å¤–ä¸€ä¸ªåŒäº‹æŸ¥è¯¢è¿™ä¸ªè¡¨æ—¶ï¼Œå‘ç°æ— è®ºæ€ä¹ˆè®¾ç½®å­—ç¬¦é›†ï¼ŒæŸ¥å‡ºæ¥éƒ½æ˜¯ä¹±ç ã€‚

```plain
mysql> set names utf8;
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql> select * from t_b;
+------------------+
| a                |
+------------------+
| å¨‘??é‹å†ªç²­é”•è¤°? |
+------------------+
1 row in set (0.00 sec)


mysql> set names gbk;
Query OK, 0 rows affected (0.00 sec)

mysql> select * from t_b;
+--------------+
| a            |
+--------------+
| æ¶“î…Ÿæƒç»—ï¹€å½¿ |
+--------------+
1 row in set (0.00 sec)
```

è¿™ä½åŒäº‹æ‰¾åˆ°äº†ä½ ï¼Œè¯·ä½ å¸®å¿™åˆ†æä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜ï¼Ÿåº”è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ

æœŸå¾…ä½ çš„æ€è€ƒï¼Œæ¬¢è¿åœ¨ç•™è¨€åŒºä¸­ä¸æˆ‘äº¤æµã€‚å¦‚æœä»Šå¤©çš„è¯¾ç¨‹è®©ä½ æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿è½¬å‘ç»™æœ‰éœ€è¦çš„æœ‹å‹ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ5ï¼‰</strong></div><ul>
<li><span>dream</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>æ–‡ç« ä¸­çš„è§£ç ç¤ºä¾‹ï¼Œæˆ‘å† ubuntu python3 ä¸­è¿è¡Œæœ‰ç‚¹é—®é¢˜ï¼Œéœ€è¦åœ¨å­—ç¬¦ä¸²å‰é¢åŠ  b:

```
&gt;&gt;&gt; &#39;\xd6\xd0\xce\xc4\xb7\xfb\xba\xc5&#39;.decode(&#39;gbk&#39;)
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
AttributeError: &#39;str&#39; object has no attribute &#39;decode&#39;. Did you mean: &#39;encode&#39;?
&gt;&gt;&gt; 
&gt;&gt;&gt; print &#39;\xd6\xd0\xce\xc4\xb7\xfb\xba\xc5&#39;.decode(&#39;gbk&#39;)
  File &quot;&lt;stdin&gt;&quot;, line 1
    print &#39;\xd6\xd0\xce\xc4\xb7\xfb\xba\xc5&#39;.decode(&#39;gbk&#39;)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
SyntaxError: Missing parentheses in call to &#39;print&#39;. Did you mean print(...)?
&gt;&gt;&gt; 
&gt;&gt;&gt; b&#39;\xd6\xd0\xce\xc4\xb7\xfb\xba\xc5&#39;.decode(&#39;gbk&#39;)
&#39;ä¸­æ–‡ç¬¦å·&#39;
&gt;&gt;&gt; print(b&#39;\xd6\xd0\xce\xc4\xb7\xfb\xba\xc5&#39;.decode(&#39;gbk&#39;))
ä¸­æ–‡ç¬¦å·
&gt;&gt;&gt; 

```</p>2024-09-03</li><br/><li><span>dream</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>ä»å‘é€è¯·æ±‚åˆ°æ¥æ”¶ç»“æœè¿‡ç¨‹ä¸­å‘ç”Ÿçš„å­—ç¬¦é›†è½¬æ¢ï¼Œå¯ä»¥åƒè¿™æ ·ç†è§£å—ï¼Ÿ

### 1. å†™æ“ä½œ

1. å®¢æˆ·ç«¯ä½¿ç”¨ `characterEncoding`(é»˜è®¤å€¼æ˜¯æ“ä½œç³»ç»Ÿçš„å­—ç¬¦é›†) å­—ç¬¦é›†ç¼–ç è¯·æ±‚å­—ç¬¦ä¸²ï¼Œå‘æœåŠ¡å™¨å‘é€çš„æ˜¯ç»è¿‡ç¼–ç çš„ä¸€ä¸ªå­—èŠ‚ä¸²ã€‚
   &gt; å‡è®¾ url æ˜¯ `jdbc:mysql:&#47;&#47;ip:port&#47;db?characterEncoding=UTF8`ï¼Œ é‚£å®¢æˆ·ç«¯å°±æ˜¯ utf8 ç¼–ç 
2. æœåŠ¡å™¨å°†å®¢æˆ·ç«¯å‘é€æ¥çš„å­—èŠ‚ä¸²é‡‡ç”¨ `character_set_client` è¡¨ç¤ºçš„å­—ç¬¦é›†è¿›è¡Œè§£ç ï¼Œå°†è§£ç åçš„å­—ç¬¦ä¸²å†æŒ‰ç…§`character_set_connection` ä»£è¡¨çš„å­—ç¬¦é›†è¿›è¡Œç¼–ç ã€‚
3. å¦‚æœ `character_set_connection` è¡¨ç¤ºçš„å­—ç¬¦é›†å’Œå­˜å‚¨å¼•æ“ä¸­åˆ—çš„å­—ç¬¦é›†ä¸€è‡´ï¼Œåˆ™ç›´æ¥è¿›è¡Œç›¸åº”æ“ä½œï¼›å¦åˆ™çš„è¯éœ€è¦å°†è¯·æ±‚çš„å­—ç¬¦ä¸²ä» `character_set_connection` è¡¨ç¤ºçš„å­—ç¬¦é›†è½¬æ¢ä¸ºå­˜å‚¨å¼•æ“ä¸­åˆ—ä½¿ç”¨çš„å­—ç¬¦é›†ä¹‹åå†è¿›è¡Œæ“ä½œã€‚
   
### 2. è¯»æ“ä½œ

1. å°†ä»æŸä¸ªåˆ—è·å–åˆ°çš„å­—èŠ‚ä¸²ä»è¯¥åˆ—ä½¿ç”¨çš„å­—ç¬¦é›†è½¬æ¢ä¸º `character_set_results` ä»£è¡¨çš„å­—ç¬¦é›†åå‘é€åˆ°å®¢æˆ·ç«¯ã€‚
2. å®¢æˆ·ç«¯ä½¿ç”¨`characterEncoding`(é»˜è®¤å€¼æ˜¯æ“ä½œç³»ç»Ÿçš„å­—ç¬¦é›†) å­—ç¬¦é›†è§£ç æ”¶åˆ°çš„ç»“æœäºŒè¿›åˆ¶ä¸ºå­—ç¬¦ä¸²ã€‚
</p>2024-09-06</li><br/><li><span>123</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆï¼Œè¯·æ•™å‡ ä¸ªé—®é¢˜ï¼š
1ã€â€œæ€»ç»“ä¸€ä¸‹ï¼Œå†™å…¥æ•°æ®æ—¶ï¼Œå¦‚æœ character_set_client çš„è®¾ç½®å’Œæ•°æ®çš„å®é™…ç¼–ç ä¸ä¸€è‡´ï¼Œå°±å¯èƒ½ä¼šäº§ç”Ÿä¹±ç ï¼Œæˆ–è€…åœ¨å†™å…¥æ•°æ®æ—¶ç›´æ¥æŠ¥é”™â€
mysqlæ˜¯å¦‚ä½•åˆ¤æ–­character_set_clientå’Œæ•°æ®çš„å®é™…ç¼–ç ä¸ä¸€è‡´ï¼Œåœ¨ä¼ å…¥çš„æ—¶å€™ä¼šæœ‰ç¼–ç ä¿¡æ¯å­—æ®µå—ï¼Ÿ

2ã€â€œè¿™è¯´æ˜äº† MySQL å®¹å¿äº†æ–‡æœ¬ç¼–ç ä» character_set_client è½¬æ¢åˆ° character_set_connection æ—¶çš„é”™è¯¯ã€‚ä½†å¦‚æœå¾€å­˜å‚¨å¼•æ“ä¸­å†™å…¥æ•°æ®æ—¶ç¼–ç è½¬æ¢æœ‰é—®é¢˜ï¼Œè¯­å¥å°±ä¼šå¤±è´¥ï¼Œæ•°æ®æ— æ³•å†™å…¥åˆ°æ•°æ®åº“ã€‚â€
å®éªŒç¯å¢ƒï¼šutf8ç»ˆç«¯ï¼Œcharacter_set_client=gbkï¼Œcharacter_set_connection=utf8, table charset=utf8

CREATE TABLE `t_utf8_2` (
  `a` varchar(30) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 

(1) â€œä¸­æ–‡å­—ç¬¦â€.encode(&#39;utf8&#39;).decode(&#39;gbk&#39;).encode(&#39;utf8&#39;) å¯ä»¥å­˜å…¥æ•°æ®ï¼Œä½†æ˜¯æ˜¾ç¤ºæ•°æ®ä¹±ç ï¼›
(2) set names = gbk =&gt; character_set_client=gbk;character_set_connection=gbk;character_set_results=gbk;
åº”è¯¥ä¹Ÿæ˜¯â€œä¸­æ–‡å­—ç¬¦â€.encode(&#39;utf8&#39;).decode(&#39;gbk&#39;).encode(&#39;utf8&#39;) ï¼Ÿä¸ªäººç†è§£æ˜¯é€šè¿‡ç»ˆç«¯çš„å­—ç¬¦é›†è¿›è¡Œç¼–ç ï¼Œç„¶åé€šè¿‡connectionå­—ç¬¦é›†è¿›è¡Œè§£ç ï¼Œæœ€ååœ¨æ ¹æ®table charsetè¿›è¡Œç¼–ç è¿›è¡Œå­˜å‚¨ï¼Ÿ
æ‰€ä»¥ä¸ºä»€ä¹ˆå½“ç»ˆç«¯charset != character_set_client = character_set_connection != table charset ä¼šæŠ¥é”™?
ä»¥ä¸Šçš„æƒ…å†µåˆ†åˆ«ä¸ºï¼š
 1&gt;  æ’å…¥ä¹±ç ï¼šç»ˆç«¯charset[utf8] != character_set_client[gbk] != character_set_connection[urf8] = table charset[urf8]
 2&gt; æ’å…¥æŠ¥é”™ï¼šç»ˆç«¯charset[utf8] != character_set_client[gbk] != character_set_connection[gbk] != table charset[urf8]
 3&gt; æ’å…¥æ­£å¸¸ï¼šç»ˆç«¯charset[utf8] = character_set_client[utf8] != character_set_connection[gbk] != table charset[urf8]
å¯¹äºæƒ…å†µ3ï¼Œâ€œå¦‚æœ character_set_connection å’Œ character_set_client è®¾ç½®ä¸ä¸€æ ·ï¼ŒMySQL Server ç«¯ä¼šå°†æ•°æ®è½¬æ¢æˆ character_set_connection æŒ‡å®šçš„å­—ç¬¦é›†ã€‚â€
ä½†æ˜¯åœ¨æˆ‘çš„ç¯å¢ƒä¸­ä¹Ÿæ˜¯æ­£å¸¸çš„ï¼Œmysql8.0.29
</p>2024-09-03</li><br/><li><span>Shelly</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>æ€è€ƒé¢˜ï¼š
1. æ˜¯å› ä¸ºä½ çš„ç»ˆç«¯çš„å­—ç¬¦é›†ä¸ºutf8ï¼Œåˆ›å»ºè¡¨æ’å…¥æ•°æ®æ—¶ç”±äºè®¾ç½®äº†set names = gbkï¼Œç”±äºè¡¨çš„å­—ç¬¦é›†ä¹Ÿæ˜¯gbk,æ‰€ä»¥æ•°æ®å­˜å‚¨åˆ°è¡¨æ—¶å­—ç¬¦é›†æ²¡æœ‰å‘ç”Ÿè½¬æ¢(ä½†å®é™…æ˜¯æŒ‰utf8å­—ç¬¦é›†å­˜å‚¨çš„)ï¼Œä½ æŸ¥è¯¢æ—¶ï¼Œç”±äºcharacter_set_resultsä¸ºgbkå’Œè¡¨çš„å­—ç¬¦é›†ä¸€è‡´ï¼Œæ‰€ä»¥å­—ç¬¦é›†æ²¡æœ‰å‘ç”Ÿè½¬æ¢ï¼Œæ­£å¥½ä½ å®¢æˆ·ç«¯çš„å­—ç¬¦é›†æ˜¯utf8ï¼Œäºæ˜¯ä¸­æ–‡å­—ç¬¦å°±è¢«é˜´å·®é˜³é”™çš„æ­£ç¡®æ˜¾ç¤ºäº†å‡ºæ¥ã€‚ 
2. ç”±äºä½ çš„åŒäº‹ç»ˆç«¯çš„å­—ç¬¦é›†æ˜¯gbkï¼Œå½“æŠŠæœåŠ¡å™¨ç«¯çš„å­—ç¬¦é›†è®¾ç½®æˆutf8æ—¶ï¼ŒæŸ¥è¯¢æ—¶ï¼Œç”±äºcharacter_set_results=utf8å’Œè¡¨gbkçš„å­—ç¬¦é›†ä¸ä¸€è‡´ï¼Œæ‰€ä»¥éœ€è¦å­—ç¬¦é›†è½¬æ¢ï¼Œå…ˆè¦ç”¨gbkå­—ç¬¦é›†è§£ç å®é™…ç”¨utf8å­˜å‚¨çš„æ•°æ®ï¼Œå†ç”¨utf8è¿›è¡Œç¼–ç å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œäºæ˜¯æ˜¾ç¤ºå°±ä¹±ç äº†ã€‚ å½“æŠŠæœåŠ¡å™¨çš„å­—ç¬¦é›†è®¾ç½®æˆgbkæ—¶ï¼Œç”±äºcharacter_set_results=gbkå’Œè¡¨gbkçš„å­—ç¬¦é›†ä¸€è‡´ï¼Œä¸å­˜åœ¨å­—ç¬¦é›†è½¬æ¢ï¼Œå®¢æˆ·ç«¯å®é™…æ”¶åˆ°æ˜¯çš„ç”¨utf8å­—ç¬¦é›†ç¼–ç çš„æ•°æ®ï¼Œç»ˆç«¯ç”¨GBKå­—ç¬¦é›†è§£ç utf8ç¼–ç çš„æ•°æ®ï¼Œæ‰€ä»¥ä¹Ÿå‘ç”Ÿäº†ä¹±ç ã€‚
3. è§£å†³æ–¹æ³•ï¼šæŠŠä½ åŒäº‹ç»ˆç«¯çš„å­—ç¬¦é›†æ”¹utf8ï¼ŒæœåŠ¡å™¨ç«¯è®¾ç½®set names=gbkï¼›æ˜¾ç¤ºä¸­æ–‡å°±ä¸ä¼šå‡ºç°ä¹±ç ã€‚</p>2024-09-02</li><br/><li><span>ç¬™ é¸¢</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>mysql&gt; set names utf8;
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql&gt; set character_set_client=&#39;gbk&#39;;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; insert into t_utf8 values(&#39;ä¸­æ–‡ç¬¦å·&#39;);
Query OK, 1 row affected, 1 warning (0.02 sec)

mysql&gt; select a, hex(a) from t_utf8;
+------------------+----------------------------------+
| a                | hex(a)                           |
+------------------+----------------------------------+
| æ¶“?æƒç»—ï¹€å½¿ | E6B6933FE69E83E7BB97EFB980E5BDBF |
+------------------+----------------------------------+
1 row in set (0.00 sec)

mysql&gt; set names gbk;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; select a, hex(a) from t_utf8;

mysql&gt; select a, hex(a) from t_utf8;

mysql&gt;
æˆ‘è¿™ä¸ªæ˜¾ç¤ºä¸å‡ºæ¥æ˜¯ï¼Ÿ
-- ç»ˆç«¯ä¸ºUTF8ï¼Œå°†character_set_resultsè®¾ç½®ä¸ºGBK
mysql&gt; set names gbk;
è¿™ä¸ªç»ˆç«¯æ˜¯æŒ‡æ“ä½œç³»ç»Ÿçš„å­—ç¬¦é›†ï¼Ÿè¿˜æ˜¯è¿æ¥mysqlä¹‹åçš„set namesè®¾ç½®çš„å•Šï¼Ÿè®¾ç½®set names gbkæˆ‘çœ‹character_set_client     | gbk                                   |
| character_set_connection | gbk                                   |
| character_set_results    | gbk 
éƒ½ä¸ºgbkäº†ï¼Œæ˜¯è¿™ç§æ•ˆæœå—ï¼Ÿè¿™å—æœ‰ç‚¹æ²¡è½¬è¿‡æ¥                                 </p>2024-09-14</li><br/>
</ul>