ä½ å¥½ï¼Œæˆ‘æ˜¯ä¿Šè¾¾ã€‚

ä¸Šä¸€è®²ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å››åå¤šä¸ªSQLï¼Œæ¼”ç¤ºäº†MySQLå„ç§ä¸åŒçš„æ‰§è¡Œè®¡åˆ’ã€‚å¯¹äºç»™å®šçš„ä¸€ä¸ªSQLè¯­å¥ï¼ŒMySQLä¸ºä»€ä¹ˆé€‰æ‹©äº†æŸä¸€ä¸ªæ‰§è¡Œè®¡åˆ’ï¼Œè€Œæ²¡æœ‰é‡‡ç”¨å…¶ä»–çš„æ‰§è¡Œè®¡åˆ’å‘¢ï¼Ÿä¼˜åŒ–å™¨ä¼šè¯„ä¼°æ¯ä¸€ä¸ªå¯èƒ½çš„æ‰§è¡Œè®¡åˆ’çš„æˆæœ¬ï¼Œä»ä¸­é€‰æ‹©ä¸€ä¸ªæˆæœ¬æœ€ä½çš„ä½œä¸ºæœ€ç»ˆçš„æ‰§è¡Œè®¡åˆ’ã€‚è¿™ä¸€è®²ä¸­æˆ‘ä»¬å°±æ¥èŠä¸€èŠæ‰§è¡Œè®¡åˆ’çš„æˆæœ¬æ˜¯æ€ä¹ˆè®¡ç®—çš„ã€‚

## SQLé¢„å¤„ç†

ä¸€ä¸ªSQLï¼Œåœ¨è¿›è¡Œå…·ä½“çš„æˆæœ¬è®¡ç®—ä¹‹å‰ï¼Œä¼šå…ˆè¿›è¡Œä¸€ç³»åˆ—çš„é¢„å¤„ç†ã€‚é¦–å…ˆéœ€è¦å¯¹SQLæ–‡æœ¬è¿›è¡Œè¯æ³•åˆ†æå’Œè¯­æ³•è§£æï¼Œç”Ÿæˆè¯­æ³•æ ‘ã€‚ç„¶ååŸºäºå…³ç³»ä»£æ•°çš„ä¸€äº›åŸºæœ¬è§„åˆ™ï¼Œå¯¹SQLè¯­å¥è¿›è¡Œè½¬æ¢å’Œæ”¹å†™ã€‚

å¸¸è§çš„æ”¹å†™æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ã€‚

- ç­‰å€¼æ¡ä»¶ä¼ æ’­

å¦‚æœA=Bï¼Œå¹¶ä¸”B=Cï¼Œåˆ™A=Cã€‚

ä¸‹é¢è¿™ä¸ªSQLä¸­ï¼ŒåŸå§‹æ¡ä»¶æ˜¯t1.a = t2.a and t2.a = t3.aï¼Œè½¬æ¢åï¼Œå¾—åˆ°t1.a = t2.a and t1.a = t3.aï¼Œè§‚å¯Ÿæ‰§è¡Œè®¡åˆ’ä¸­çš„refåˆ—å°±å¯ä»¥çœ‹åˆ°è¿™ä¸€ç‚¹ã€‚

```plain
mysql> explain select * from tab t1, tab t2, tab t3 
  where t1.a = t2.a 
  and t2.a = t3.a;

+----+-------------+-------+------+---------------+---------+---------+----------+------+----------+-------+
| id | select_type | table | type | possible_keys | key     | key_len | ref      | rows | filtered | Extra |
+----+-------------+-------+------+---------------+---------+---------+----------+------+----------+-------+
|  1 | SIMPLE      | t1    | ALL  | idx_abc       | NULL    | NULL    | NULL     | 9913 |   100.00 | NULL  |
|  1 | SIMPLE      | t2    | ref  | idx_abc       | idx_abc | 4       | rep.t1.a | 3304 |   100.00 | NULL  |
|  1 | SIMPLE      | t3    | ref  | idx_abc       | idx_abc | 4       | rep.t1.a | 3304 |   100.00 | NULL  |
+----+-------------+-------+------+---------------+---------+---------+----------+------+----------+-------+
```
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ3ï¼‰</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/15/8d/4d/992070e8.jpg" width="30px"><span>å¶æ˜</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>  
å¦å¤–ï¼Œæˆ‘çœ‹ gh-ost çš„å®ç°æ–¹å¼æ˜¯å¦å¤–ä¸€ç§ï¼Œä»å·¦å³è¾¹ç•Œå’Œè”åˆä¸»é”®ä¸­å­—æ®µä¹‹é—´çš„åŒºé—´æ¥è€ƒè™‘
  1. æœ€å·¦è¾¹çš„è¾¹ç•Œ: id1=&#39;a&#39; and id2=&#39;a&#39; and id3=&#39;1&#39;ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæŸ¥è¯¢æ¡ä»¶æ¥æ‹¿åˆ°æœ€å·¦è¾¹ç•Œçš„è®°å½•
  2. è”åˆä¸»é”® (id1, id2, id3) ä¸­ id1 å¤„äºç´¢å¼•ä¸­ç¬¬ä¸€åˆ—ï¼Œå› æ­¤ id1 æ˜¯æœ‰åºçš„ï¼ŒæŸ¥è¯¢æ¡ä»¶ id1&gt;&#39;a&#39; æ‹¿åˆ°é™¤ id1=&#39;a&#39; ä¹‹å¤–çš„æ‰€æœ‰è®°å½•
  3. æ­¥éª¤2å®Œæˆåï¼Œåªéœ€è¦è€ƒè™‘ id1=&#39;a&#39; çš„æœ€åä¸€æ¡è®°å½•ä¸ç¬¬ä¸€æ¡è®°å½• (id1=&#39;a&#39;, id2=&#39;a&#39;, id3=&#39;1&#39;) è¿™æ®µèŒƒå›´çš„è®°å½•äº†
  4. å½“ id1=&#39;a&#39; and id2=&#39;a&#39; æ—¶ï¼Œè¦æƒ³è®¿é—® id3 çš„æ‰€æœ‰è®°å½•ï¼ŒæŸ¥è¯¢æ¡ä»¶å¾—ä¸º id3 &gt; &#39;1&#39;ï¼Œè¿™æ ·å°±èƒ½æ‹¿åˆ° id1, id2 ä¸ºå›ºå®šå€¼æ—¶ï¼Œid3 &gt; &#39;1&#39; çš„æ‰€æœ‰è®°å½•ï¼Œid3 = 1 çš„è¾¹ç•Œå€¼åœ¨æ­¥éª¤ 1 ä¸­å·²ç»æ‹¿åˆ°äº†
  5. æ­¥éª¤4å®Œæˆåï¼Œæ»¡è¶³ id1=&#39;a&#39; and id2=&#39;a&#39; æ¡ä»¶çš„æ‰€æœ‰è®°å½•å·²ç»èƒ½æ‹¿åˆ°äº†ï¼Œæ¥ä¸‹æ¥ï¼Œæ‹¿ id1 = &#39;a&#39; æ—¶ï¼Œid2 &gt; &#39;a&#39; çš„æ‰€æœ‰è®°å½•ï¼Œè¿™æ ·ï¼Œid1=&#39;a&#39; çš„æ‰€æœ‰è®°å½•å°±éƒ½èƒ½æ‹¿åˆ°äº†

select
  &#47;* gh-ost `test`.`t_business` iteration:0 *&#47; `id1`,
  `id2`,
  `id3`
from
  `test`.`t_business`
where
  (
    (`id1` &gt; _binary &#39;a&#39;)
    or (
      ((`id1` = _binary &#39;a&#39;))
      AND (`id2` &gt; _binary &#39;a&#39;)
    )
    or (
      (
        (`id1` = _binary &#39;a&#39;)
        and (`id2` = _binary &#39;a&#39;)
      )
      AND (`id3` &gt; _binary &#39;1&#39;)
    )
    or (
      (`id1` = _binary &#39;a&#39;)
      and (`id2` = _binary &#39;a&#39;)
      and (`id3` = _binary &#39;1&#39;)
    )
  )
  and (
    (`id1` &lt; _binary &#39;d&#39;)
    or (
      ((`id1` = _binary &#39;d&#39;))
      AND (`id2` &lt; _binary &#39;a&#39;)
    )
    or (
      (
        (`id1` = _binary &#39;d&#39;)
        and (`id2` = _binary &#39;a&#39;)
      )
      AND (`id3` &lt; _binary &#39;9990&#39;)
    )
    or (
      (`id1` = _binary &#39;d&#39;)
      and (`id2` = _binary &#39;a&#39;)
      and (`id3` = _binary &#39;9990&#39;)
    )
  )
order by
  `id1` asc,
  `id2` asc,
  `id3` asc
limit
  1
offset
  99</div>2024-10-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/8d/4d/992070e8.jpg" width="30px"><span>å¶æ˜</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è”åˆä¸»é”®çš„æœ€å°å’Œæœ€å¤§å€¼æ¯”è¾ƒå®¹æ˜“ç¡®å®šï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œçš„æœ€å°å€¼ (&#39;a&#39;, &#39;a&#39;, &#39;1&#39;)ï¼Œæœ€å¤§å€¼ (&#39;d&#39;, &#39;a&#39;, &#39;9990&#39;)ï¼Œä¸èƒ½é€šè¿‡ id1&gt;=&#39;a&#39; and id2&gt;=&#39;a&#39; and id3&gt;=&#39;1&#39; ä»¥åŠ id1&lt;=&#39;d&#39; and id2&lt;=&#39;a&#39; and id3 &lt;= &#39;9990&#39; æ¥è¿›è¡Œæ•°æ®åˆ†ç‰‡ï¼Œ
è¿™æ˜¯å› ä¸ºè¿™ä¸‰ä¸ªå­—æ®µä½œä¸ºè”åˆä¸»é”®ï¼Œä¸‰ä¸ªå­—æ®µä½œä¸ºä¸€ä¸ªæ•´ä½“æ˜¯æœ‰åºçš„ï¼Œä½†ç»†åŒ–åˆ° id2, id3 å­—æ®µï¼Œåˆ™æ˜¯å½“å‰é¢å­—æ®µçš„å€¼å›ºå®šæ—¶ï¼Œåé¢çš„å­—æ®µæ‰æ˜¯æœ‰åºçš„ï¼Œå¦‚æœæŒ‰ç…§ id1&gt;=&#39;a&#39; and id2&gt;=&#39;a&#39; and id3&gt;=&#39;1&#39; å»åŒ¹é…ï¼Œé‚£ä¹ˆä¼šæ¼æ‰ä¸€äº›æ•°æ®ã€‚
æˆ‘æƒ³åˆ°çš„ä¸€ç§æ–¹å¼æ˜¯å°†è”åˆå­—æ®µä½œä¸ºä¸€ä¸ªæ•´ä½“å»åŒ¹é…ï¼Œä¾‹å¦‚ (id1, id2, id3) &gt;= (&#39;a&#39;, &#39;a&#39;, &#39;1&#39;)ã€‚</div>2024-10-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/46/4d/161f3779.jpg" width="30px"><span>ls</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>å¾ªç¯ä¸»é”®ï¼Œæ ¹æ®ä¸»é”®å»æ‰¹é‡æ›´æ–°1000è¡Œï¼Œæ¯1000è¡Œæäº¤ä¸€æ¬¡ã€‚æ˜¯ä¸æ˜¯å°±å¯ä»¥äº†</div>2024-10-09</li><br/>
</ul>