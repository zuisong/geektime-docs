ä½ å¥½ï¼Œæˆ‘æ˜¯ä¿Šè¾¾ã€‚

ä¸Šä¸€è®²æˆ‘ä»‹ç»äº†æ•°æ®åº“ä¸­æœ€ä¸»è¦çš„å‡ ç§è®¿é—®è·¯å¾„ï¼Œä¸åŒçš„è®¿é—®è·¯å¾„ï¼Œåœ¨æ‰§è¡Œæ€§èƒ½ä¸Šå¯èƒ½ä¼šå­˜åœ¨å·¨å¤§çš„å·®åˆ«ã€‚ä½†æ˜¯æˆ‘ä»¬æ€ä¹ˆçŸ¥é“æŸä¸€ä¸ªå…·ä½“çš„SQLè¯­å¥åœ¨æ‰§è¡Œæ—¶ï¼Œé‡‡ç”¨äº†ä»€ä¹ˆæ ·çš„è®¿é—®è·¯å¾„å‘¢ï¼Ÿè¿™å°±æ¶‰åŠåˆ°SQLçš„æ‰§è¡Œè®¡åˆ’äº†ã€‚æ‰§è¡Œè®¡åˆ’æè¿°äº†SQLè¯­å¥çš„è®¿é—®è·¯å¾„ï¼Œé€šè¿‡æ‰§è¡Œè®¡åˆ’ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š

- è¡¨ä¸Šæ˜¯å¦æœ‰å¯ç”¨çš„ç´¢å¼•ï¼ŒSQLæ‰§è¡Œæ—¶æ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•ï¼Œä½¿ç”¨äº†å“ªäº›ç´¢å¼•ï¼Ÿ
- è¡¨è¿æ¥çš„é¡ºåºæ˜¯æ€æ ·çš„ï¼Ÿ
- ä½¿ç”¨äº†å“ªç§è¡¨è¿æ¥ç®—æ³•ï¼Œæ˜¯ç”¨äº†Nest Loopè¿˜æ˜¯Hash Joinï¼Ÿ
- æŸ¥è¯¢æ˜¯å¦ç”¨åˆ°äº†ä¸´æ—¶è¡¨ï¼Œæ˜¯å¦è¿›è¡Œäº†æ–‡ä»¶æ’åºï¼Ÿ

åœ¨MySQLä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨Explainå‘½ä»¤æŸ¥çœ‹è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ã€‚è¿™ä¸€è®²ä¸­æˆ‘ä¼šä½¿ç”¨å››åå¤šä¸ªæ¼”ç¤ºSQLï¼Œæ¥è§£é‡ŠEXPLAINè¾“å‡ºä¿¡æ¯çš„å…·ä½“å«ä¹‰ã€‚è‡³äºä¸ºä»€ä¹ˆä¸€ä¸ªSQLä½¿ç”¨äº†è¿™ä¸ªæ‰§è¡Œè®¡åˆ’ï¼Œè€Œä¸æ˜¯åˆ«çš„æ‰§è¡Œè®¡åˆ’ï¼Œæˆ‘ä¼šåœ¨æ¥ä¸‹æ¥çš„å‡ è®²ä¸­æ…¢æ…¢å±•å¼€ã€‚

ä¸ºäº†ä¾¿äºæ¼”ç¤ºå„ç§ä¸åŒçš„æ‰§è¡Œè®¡åˆ’ï¼Œæˆ‘ä½¿ç”¨äº†ä¸‹é¢è¿™äº›æµ‹è¯•è¡¨å’Œæµ‹è¯•æ•°æ®ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨è‡ªå·±çš„ç¯å¢ƒä¸­è¿›è¡Œæµ‹è¯•ã€‚

```plain
CREATE TABLE `digit` (
  `a` tinyint NOT NULL,
  PRIMARY KEY (`a`)
) ENGINE=InnoDB;

insert into digit values (0),(1),(2),(3),(4),(5),(6),(7),(8),(9);

CREATE VIEW numbers AS 
select a.a*1000 + b.a*100 + c.a*10 + d.a as n 
from digit a, digit b, digit c, digit d;

-- æœ¬ç« ä¸­å¤§éƒ¨åˆ†æ¡ˆä¾‹éƒ½ä½¿ç”¨tabè¡¨
CREATE TABLE `tab` (
  `id` int NOT NULL AUTO_INCREMENT,
  `a` int NOT NULL,
  `b` int NOT NULL,
  `c` int NOT NULL,
  `padding` varchar(7000) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `idx_abc` (`a`,`b`,`c`)
) ENGINE=InnoDB;

insert into tab (a,b,c,padding) 
select n%3, n, n%100, rpad('x', 100, 'x')  
from numbers where n < 10000;

-- t_mergeä¸»è¦ç”¨äºæ¼”ç¤ºindex_mergeçš„å‡ ç§æƒ…å†µ
create table t_merge(
    id int not null auto_increment, 
    a int not null,
    b int not null,
    c int not null,
    d int not null,
    padding varchar(4000),
    primary key(id),
    key idx_ad(a,d),
    key idx_bd(b,d),
    key idx_cd(c,d)
) ENGINE=InnoDB;

insert into t_merge(a,b,c,d,padding)
select n % 3 + 1, n % 17 + 1, n % 19 + 1, n % 10 + 1, rpad('y', 100, 'y')
from numbers
where n between 1 and 3*17*19*10;
```

## ä½¿ç”¨EXPLAINå‘½ä»¤

ä½¿ç”¨EXPLAINå‘½ä»¤å¯ä»¥æŸ¥çœ‹SELECTã€INSERTã€UPDATEã€DELETEã€REPLACEç­‰è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ã€‚EXPLAINå‘½ä»¤çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š

```plain
explain [format=traditional|json|tree] SQL Statement
```

FORMATæŒ‡å®šäº†æ‰§è¡Œè®¡åˆ’çš„è¾“å‡ºæ ¼å¼ï¼Œä¸æŒ‡å®šæ—¶ï¼Œé»˜è®¤ä»¥è¡¨æ ¼å½¢å¼è¾“å‡ºæ‰§è¡Œè®¡åˆ’ã€‚

```plain
mysql> explain select * from tab;
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+
| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+
|  1 | SIMPLE      | tab   | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 9755 |   100.00 | NULL  |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+
```

FORMATæŒ‡å®šä¸ºTREEæ—¶ï¼Œä»¥æ ‘çš„å½¢å¼æ˜¾ç¤ºæ‰§è¡Œè®¡åˆ’ï¼Œè¿™ç§æ˜¾ç¤ºæ ¼å¼å’ŒOracleæ‰§è¡Œè®¡åˆ’çš„æ˜¾ç¤ºæ–¹å¼æ¯”è¾ƒåƒã€‚

ä¸‹é¢è¿™ä¸ªæµ‹è¯•SQLä¸­ï¼Œä½¿ç”¨äº†NO\_SEMIJOINæç¤ºï¼Œé˜»æ­¢ä¼˜åŒ–å™¨å°†å­æŸ¥è¯¢æ”¹å†™æˆè¡¨è¿æ¥ã€‚ä½ å¯ä»¥è¯•ä¸€ä¸‹ï¼Œå°†æç¤ºå»æ‰åï¼Œä¼šä½¿ç”¨æ€æ ·çš„æ‰§è¡Œè®¡åˆ’ã€‚

```plain
explain format=tree 
select  /*+ NO_SEMIJOIN(@subq1)  */ * 
from tab a 
where id in ( 
    select /*+ QB_NAME(subq1) */ id from tab b 
)
```

```plain
EXPLAIN: -> Filter: <in_optimizer>(a.id,<exists>(select #2))Â  (cost=1031.55 rows=9913)
Â  Â  -> Table scan on aÂ  (cost=1031.55 rows=9913)
Â  Â  -> Select #2 (subquery in condition; dependent)
Â  Â  Â  Â  -> Limit: 1 row(s)Â  (cost=0.35 rows=1)
Â  Â  Â  Â  Â  Â  -> Single-row covering index lookup on b using PRIMARY (id=<cache>(a.id))Â  (cost=0.35 rows=1)
```

FORMATæŒ‡å®šä¸ºJSONæ—¶ï¼Œä»¥JSONæ ¼å¼æ˜¾ç¤ºæ‰§è¡Œè®¡åˆ’ã€‚JSONæ ¼å¼çš„æ‰§è¡Œè®¡åˆ’ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ä¸€äº›æˆæœ¬çš„ä¿¡æ¯ã€‚

```plain
explain format=json 
select  /*+ NO_SEMIJOIN(@subq1)  */ * 
from tab a 
where id in ( 
    select /*+ QB_NAME(subq1) */ id from tab b 
)

{
Â  "query_block": {
Â  Â  "select_id": 1,
Â  Â  "cost_info": {
Â  Â  Â  "query_cost": "1031.55"
Â  Â  },
Â  Â  "table": {
Â  Â  Â  "table_name": "a",
Â  Â  Â  "access_type": "ALL",
Â  Â  Â  "rows_examined_per_scan": 9913,
Â  Â  Â  "rows_produced_per_join": 9913,
Â  Â  Â  "filtered": "100.00",
Â  Â  Â  "cost_info": {
Â  Â  Â  Â  "read_cost": "40.25",
Â  Â  Â  Â  "eval_cost": "991.30",
Â  Â  Â  Â  "prefix_cost": "1031.55",
Â  Â  Â  Â  "data_read_per_join": "264M"
Â  Â  Â  },
Â  Â  Â  "used_columns": [
Â  Â  Â  Â  "id",
Â  Â  Â  Â  "a",
Â  Â  Â  Â  "b",
Â  Â  Â  Â  "c",
Â  Â  Â  Â  "padding"
Â  Â  Â  ],
Â  Â  Â  "attached_condition": "<in_optimizer>(`rep`.`a`.`id`,<exists>(<primary_index_lookup>(<cache>(`rep`.`a`.`id`) in tab on PRIMARY)))",
Â  Â  Â  "attached_subqueries": [
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  "dependent": true,
Â  Â  Â  Â  Â  "cacheable": false,
Â  Â  Â  Â  Â  "query_block": {
Â  Â  Â  Â  Â  Â  "select_id": 2,
Â  Â  Â  Â  Â  Â  "cost_info": {
Â  Â  Â  Â  Â  Â  Â  "query_cost": "0.35"
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  "table": {
Â  Â  Â  Â  Â  Â  Â  "table_name": "b",
Â  Â  Â  Â  Â  Â  Â  "access_type": "unique_subquery",
Â  Â  Â  Â  Â  Â  Â  "possible_keys": [
Â  Â  Â  Â  Â  Â  Â  Â  "PRIMARY"
Â  Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  Â  "key": "PRIMARY",
Â  Â  Â  Â  Â  Â  Â  "used_key_parts": [
Â  Â  Â  Â  Â  Â  Â  Â  "id"
Â  Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  Â  "key_length": "4",
Â  Â  Â  Â  Â  Â  Â  "ref": [
Â  Â  Â  Â  Â  Â  Â  Â  "func"
Â  Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  Â  "rows_examined_per_scan": 1,
Â  Â  Â  Â  Â  Â  Â  "rows_produced_per_join": 1,
Â  Â  Â  Â  Â  Â  Â  "filtered": "100.00",
Â  Â  Â  Â  Â  Â  Â  "using_index": true,
Â  Â  Â  Â  Â  Â  Â  "cost_info": {
Â  Â  Â  Â  Â  Â  Â  Â  "read_cost": "0.25",
Â  Â  Â  Â  Â  Â  Â  Â  "eval_cost": "0.10",
Â  Â  Â  Â  Â  Â  Â  Â  "prefix_cost": "0.35",
Â  Â  Â  Â  Â  Â  Â  Â  "data_read_per_join": "27K"
Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  "used_columns": [
Â  Â  Â  Â  Â  Â  Â  Â  "id"
Â  Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  ]
Â  Â  }
Â  }
}
```

## EXPLAINè¾“å‡ºè¯¦è§£

æ¥ä¸‹æ¥ï¼Œæˆ‘å°†ä»¥é»˜è®¤çš„è¡¨æ ¼è¾“å‡ºå½¢å¼ä¸ºå‡†ï¼Œæ¥è¿›è¡Œä»‹ç»ã€‚åœ¨EXPLAINçš„è¾“å‡ºä¸­ï¼Œæ¯ä¸€è¡Œè¡¨ç¤ºä¸€ä¸ªæŸ¥è¯¢å•å…ƒã€‚æŸ¥è¯¢å•å…ƒæœ‰å‡ ç§æƒ…å†µï¼š

- å…³è”æŸ¥è¯¢ä¸­ï¼Œæ¯ä¸€ä¸ªå…³è”çš„è¡¨æ˜¯ä¸€ä¸ªæŸ¥è¯¢å•å…ƒï¼›
- æ¯ä¸ªå­æŸ¥è¯¢éƒ½ä¼šå¯¹åº”ä¸€ä¸ªæŸ¥è¯¢å•å…ƒï¼›
- ç»„æˆUNIONè¯­å¥çš„æ¯ä¸ªå­å¥éƒ½ä¼šå¯¹åº”ä¸€ä¸ªæŸ¥è¯¢å•å…ƒï¼›
- æ¯ä¸ªæ´¾ç”Ÿè¡¨å¯¹åº”ä¸€ä¸ªæŸ¥è¯¢å•å…ƒã€‚

EXPLAINçš„è¾“å‡ºä¸­åŒ…å«ä»¥ä¸‹å­—æ®µï¼š

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/10/cb/108b835cb05b6873ee6b2ae13abfbdcb.jpg?wh=1920x1274)

### ID

IDä¸ºæŸ¥è¯¢å•å…ƒçš„ç¼–å·ã€‚ä¸»æŸ¥è¯¢ï¼ˆé¡¶å±‚æŸ¥è¯¢ï¼‰çš„IDä¸º1ã€‚åŒä¸€å±‚çº§å†…ï¼Œå¦‚æœæœ‰è¡¨è¿æ¥ï¼Œåˆ™å®ƒä»¬çš„æŸ¥è¯¢å•å…ƒIDä¸€æ ·ã€‚å­æŸ¥è¯¢çš„åµŒå¥—å±‚çº§è¶Šæ·±ï¼ŒIDè¶Šå¤§ã€‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæœ‰2ä¸ªå­æŸ¥è¯¢ï¼Œå­æŸ¥è¯¢2åµŒå¥—åœ¨å­æŸ¥è¯¢1ä¸­ã€‚

```plain
mysql> explain 
select  /*+ NO_SEMIJOIN(@subq1 )  */ * 
from tab ta, tab tx
where ta.id in ( 
    select /*+ QB_NAME(subq1) NO_SEMIJOIN(@subq2) */ id from tab tb 
	    where c in (select /*+ QB_NAME(subq2) */ c from tab tc)
)
and ta.id = tx.id

+----+-------------+-------+--------+---------------+---------+---------+-----------+------+----------+--------------------------+
| id | select_type | table | typeÂ  Â | possible_keys | keyÂ  Â  Â | key_len | refÂ  Â  Â  Â | rows | filtered | ExtraÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  |
+----+-------------+-------+--------+---------------+---------+---------+-----------+------+----------+--------------------------+
|Â  1 | PRIMARYÂ  Â  Â | taÂ  Â  | ALLÂ  Â  | PRIMARYÂ  Â  Â  Â | NULLÂ  Â  | NULLÂ  Â  | NULLÂ  Â  Â  | 9913 |Â  Â 100.00 | Using whereÂ  Â  Â  Â  Â  Â  Â  |
|Â  1 | PRIMARYÂ  Â  Â | txÂ  Â  | eq_ref | PRIMARYÂ  Â  Â  Â | PRIMARY | 4Â  Â  Â  Â | rep.ta.id |Â  Â  1 |Â  Â 100.00 | NULLÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â |
|Â  2 | SUBQUERYÂ  Â  | tbÂ  Â  | indexÂ  | PRIMARYÂ  Â  Â  Â | idx_abc | 12Â  Â  Â  | NULLÂ  Â  Â  | 9913 |Â  Â 100.00 | Using where; Using index |
|Â  3 | SUBQUERYÂ  Â  | tcÂ  Â  | indexÂ  | NULLÂ  Â  Â  Â  Â  | idx_abc | 12Â  Â  Â  | NULLÂ  Â  Â  | 9913 |Â  Â 100.00 | Using indexÂ  Â  Â  Â  Â  Â  Â  |
+----+-------------+-------+--------+---------------+---------+---------+-----------+------+----------+--------------------------+
```

æŸ¥è¯¢ä¸­ä½¿ç”¨æç¤ºQB\_NAMEã€NO\_SEMIJOINï¼Œæ˜¯ä¸ºäº†é¿å…ä¼˜åŒ–å™¨ä½¿ç”¨åŠè¿æ¥æŸ¥è¯¢ä¼˜åŒ–ï¼Œå› ä¸ºä½¿ç”¨åŠè¿æ¥ä¼˜åŒ–åï¼Œè¿™ä¸ªç¤ºä¾‹ä¸­çš„å­æŸ¥è¯¢å°±è¢«ä¼˜åŒ–æ‰äº†ã€‚IDä¸º1çš„2ä¸ªæŸ¥è¯¢å•å…ƒï¼ŒæŒ‰ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºå…³è”ï¼Œé©±åŠ¨è¡¨ä¸ºtaã€‚è¿™é‡ŒExtraä¸­æ²¡æœ‰é¢å¤–çš„ä¿¡æ¯ï¼Œè¯´æ˜ä½¿ç”¨äº†åµŒå¥—å¾ªç¯è¿æ¥ã€‚

### SELECT\_TYPE

SELECT\_TYPEä¸ºæŸ¥è¯¢å•å…ƒçš„ç±»å‹ï¼Œæœ‰ä»¥ä¸‹å‡ ç§å¯èƒ½çš„ç±»å‹ã€‚

- SIMPLE

å¦‚æœè¯­å¥æ²¡æœ‰ä½¿ç”¨UNIONæˆ–å­æŸ¥è¯¢ï¼Œé‚£ä¹ˆSELECT\_TYPEä¸ºSIMPLEã€‚

- PRIMARY

å¦‚æœè¯­å¥ç”¨åˆ°äº†å­æŸ¥è¯¢ï¼Œé‚£ä¹ˆæœ€å¤–å±‚æŸ¥è¯¢çš„select\_typeä¸ºPRIMARYï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸»è¯­å¥ã€‚å¦‚æœè¯­å¥ä½¿ç”¨äº†UNIONï¼Œåˆ™ç¬¬ä¸€ä¸ªæŸ¥è¯¢å•å…ƒçš„select\_typeä¸ºPRIMARYã€‚

- UNION

ä½¿ç”¨UNIONæˆ–UNION ALLçš„æŸ¥è¯¢ä¸­ï¼Œç¬¬äºŒä¸ªå’Œåç»­æŸ¥è¯¢çš„select\_typeä¸ºUNION

- UNION RESULT

UNION RESULTè¡¨ç¤ºUNIONå»é‡åçš„ç»“æœã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼ŒIDä¸º3çš„è¿™ä¸€è¡Œå°±æ˜¯IDä¸º1å’Œ2è¿™ä¸¤ä¸ªæŸ¥è¯¢å•å…ƒç»“æœé›†Unionä¹‹åå¾—åˆ°çš„ã€‚

```plain
mysql> explain select a from tab ta union select c from tab tb;
+----+--------------+------------+-------+---------------+---------+---------+------+------+----------+-----------------+
| id | select_typeÂ  | tableÂ  Â  Â  | typeÂ  | possible_keys | keyÂ  Â  Â | key_len | refÂ  | rows | filtered | ExtraÂ  Â  Â  Â  Â  Â |
+----+--------------+------------+-------+---------------+---------+---------+------+------+----------+-----------------+
|Â  1 | PRIMARYÂ  Â  Â  | taÂ  Â  Â  Â  Â | index | NULLÂ  Â  Â  Â  Â  | idx_abc | 12Â  Â  Â  | NULL | 9913 |Â  Â 100.00 | Using indexÂ  Â  Â |
|Â  2 | UNIONÂ  Â  Â  Â  | tbÂ  Â  Â  Â  Â | index | NULLÂ  Â  Â  Â  Â  | idx_abc | 12Â  Â  Â  | NULL | 9913 |Â  Â 100.00 | Using indexÂ  Â  Â |
|Â  3 | UNION RESULT | <union1,2> | ALLÂ  Â | NULLÂ  Â  Â  Â  Â  | NULLÂ  Â  | NULLÂ  Â  | NULL | NULL |Â  Â  Â NULL | Using temporary |
+----+--------------+------------+-------+---------------+---------+---------+------+------+----------+-----------------+
```

- DEPENDENT UNION

å¦‚æœUNIONå­å¥ä½äºå­æŸ¥è¯¢ä¸­ï¼Œå¹¶ä¸”å­æŸ¥è¯¢ä¾èµ–äº†å¤–éƒ¨æŸ¥è¯¢ä¸­å­—æ®µï¼Œåˆ™select\_typeä¸ºDEPENDENT UNIONã€‚

```plain
mysql> explain select * from tab ta where id in (
    select a from tab tb union select c from tab tc);


+----+--------------------+------------+-------+---------------+---------+---------+------+------+----------+--------------------------+
| id | select_typeÂ  Â  Â  Â  | tableÂ  Â  Â  | typeÂ  | possible_keys | keyÂ  Â  Â | key_len | refÂ  | rows | filtered | ExtraÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  |
+----+--------------------+------------+-------+---------------+---------+---------+------+------+----------+--------------------------+
|Â  1 | PRIMARYÂ  Â  Â  Â  Â  Â  | taÂ  Â  Â  Â  Â | ALLÂ  Â | NULLÂ  Â  Â  Â  Â  | NULLÂ  Â  | NULLÂ  Â  | NULL | 9913 |Â  Â 100.00 | Using whereÂ  Â  Â  Â  Â  Â  Â  |
|Â  2 | DEPENDENT SUBQUERY | tbÂ  Â  Â  Â  Â | refÂ  Â | idx_abcÂ  Â  Â  Â | idx_abc | 4Â  Â  Â  Â | func | 3304 |Â  Â 100.00 | Using indexÂ  Â  Â  Â  Â  Â  Â  |
|Â  3 | DEPENDENT UNIONÂ  Â  | tcÂ  Â  Â  Â  Â | index | NULLÂ  Â  Â  Â  Â  | idx_abc | 12Â  Â  Â  | NULL | 9913 |Â  Â  10.00 | Using where; Using index |
|Â  4 | UNION RESULTÂ  Â  Â  Â | <union2,3> | ALLÂ  Â | NULLÂ  Â  Â  Â  Â  | NULLÂ  Â  | NULLÂ  Â  | NULL | NULL |Â  Â  Â NULL | Using temporaryÂ  Â  Â  Â  Â  |
+----+--------------------+------------+-------+---------------+---------+---------+------+------+----------+--------------------------+
```

- UNCACHEABLE UNION

unionæŸ¥è¯¢å‡ºç°åœ¨å­æŸ¥è¯¢ä¸­ï¼Œå¹¶ä¸”unionè¯­å¥ä½¿ç”¨äº†éç¡®å®šæ€§å‡½æ•°ï¼ˆå¦‚randï¼‰æˆ–ä½¿ç”¨äº†å˜é‡ï¼Œé‚£ä¹ˆunionæŸ¥è¯¢å•å…ƒçš„select\_typeä¸ºUNCACHEABLE UNIONã€‚

```plain
mysql> explain select distinct a from  (
    select a from tab tb  
    union all 
    select c from tab tc where c > rand() 
) tx;


+----+-------------------+------------+-------+---------------+---------+---------+------+-------+----------+--------------------------+
| id | select_typeÂ  Â  Â  Â | tableÂ  Â  Â  | typeÂ  | possible_keys | keyÂ  Â  Â | key_len | refÂ  | rowsÂ  | filtered | ExtraÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  |
+----+-------------------+------------+-------+---------------+---------+---------+------+-------+----------+--------------------------+
|Â  1 | PRIMARYÂ  Â  Â  Â  Â  Â | <derived2> | ALLÂ  Â | NULLÂ  Â  Â  Â  Â  | NULLÂ  Â  | NULLÂ  Â  | NULL | 13217 |Â  Â 100.00 | Using temporaryÂ  Â  Â  Â  Â  |
|Â  2 | DERIVEDÂ  Â  Â  Â  Â  Â | tbÂ  Â  Â  Â  Â | index | NULLÂ  Â  Â  Â  Â  | idx_abc | 12Â  Â  Â  | NULL |Â  9913 |Â  Â 100.00 | Using indexÂ  Â  Â  Â  Â  Â  Â  |
|Â  3 | UNCACHEABLE UNION | tcÂ  Â  Â  Â  Â | index | NULLÂ  Â  Â  Â  Â  | idx_abc | 12Â  Â  Â  | NULL |Â  9913 |Â  Â  33.33 | Using where; Using index |
+----+-------------------+------------+-------+---------------+---------+---------+------+-------+----------+--------------------------+
```

```plain
mysql> explain select * from tab where exists (
    select avg(b) from tab  
    union all 
    select b from tab where b > rand()
);


+----+-------------------+-------+-------+---------------+---------+---------+------+------+----------+--------------------------+
| id | select_typeÂ  Â  Â  Â | table | typeÂ  | possible_keys | keyÂ  Â  Â | key_len | refÂ  | rows | filtered | ExtraÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  |
+----+-------------------+-------+-------+---------------+---------+---------+------+------+----------+--------------------------+
|Â  1 | PRIMARYÂ  Â  Â  Â  Â  Â | tabÂ  Â | ALLÂ  Â | NULLÂ  Â  Â  Â  Â  | NULLÂ  Â  | NULLÂ  Â  | NULL | 9913 |Â  Â 100.00 | Using whereÂ  Â  Â  Â  Â  Â  Â  |
|Â  2 | SUBQUERYÂ  Â  Â  Â  Â  | tabÂ  Â | index | NULLÂ  Â  Â  Â  Â  | idx_abc | 12Â  Â  Â  | NULL | 9913 |Â  Â 100.00 | Using indexÂ  Â  Â  Â  Â  Â  Â  |
|Â  3 | UNCACHEABLE UNION | tabÂ  Â | index | NULLÂ  Â  Â  Â  Â  | idx_abc | 12Â  Â  Â  | NULL | 9913 |Â  Â  33.33 | Using where; Using index |
+----+-------------------+-------+-------+---------------+---------+---------+------+------+----------+--------------------------+
```

- SUBQUERY

å­æŸ¥è¯¢å¯ä»¥å‡ºç°åœ¨selectåˆ—è¡¨ä¸­ã€whereæ¡ä»¶ä¸­ï¼Œä¹Ÿå¯ä»¥å‡ºç°åœ¨fromåˆ—è¡¨ä¸­ã€‚å‡ºç°åœ¨fromåˆ—è¡¨ä¸­çš„å­æŸ¥è¯¢ä¸ºæ´¾ç”Ÿè¡¨ï¼ˆDERIVEDï¼‰ã€‚å¦‚æœå­æŸ¥è¯¢ä¸ä¾èµ–ä¸»æŸ¥è¯¢ä¸­çš„å­—æ®µï¼Œåˆ™ç§°ä¸ºä¸ç›¸å…³å­æŸ¥è¯¢ï¼Œselect\_typeä¸ºSUBQUERYã€‚SQLæ‰§è¡Œæ—¶ï¼Œä¼šç¼“å­˜å­æŸ¥è¯¢çš„æŸ¥è¯¢ç»“æœã€‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œå­æŸ¥è¯¢ä¸­çš„SQLåªéœ€è¦æ‰§è¡Œ1æ¬¡ï¼Œä¸éœ€è¦æ¯è®¿é—®1è¡Œæ•°æ®å°±é‡å¤æ‰§è¡Œ1æ¬¡å­æŸ¥è¯¢ã€‚

```plain
mysql> explain select a, (select avg(b) from tab )  from tab t1;

+----+-------------+-------+-------+---------------+---------+---------+------+-------+----------+-------------+
| id | select_type | table | typeÂ  | possible_keys | keyÂ  Â  Â | key_len | refÂ  | rowsÂ  | filtered | ExtraÂ  Â  Â  Â |
+----+-------------+-------+-------+---------------+---------+---------+------+-------+----------+-------------+
|Â  1 | PRIMARYÂ  Â  Â | t1Â  Â  | index | NULLÂ  Â  Â  Â  Â  | idx_abc | 12Â  Â  Â  | NULL | 10010 |Â  Â 100.00 | Using index |
|Â  2 | SUBQUERYÂ  Â  | tabÂ  Â | index | NULLÂ  Â  Â  Â  Â  | idx_abc | 12Â  Â  Â  | NULL | 10010 |Â  Â 100.00 | Using index |
+----+-------------+-------+-------+---------------+---------+---------+------+-------+----------+-------------+
```

ä½¿ç”¨EXPLAN ANALYZEå‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°å­æŸ¥è¯¢åªæ‰§è¡Œäº†1æ¬¡ï¼ˆrun only onceï¼‰ã€‚

```plain
mysql> explain analyze select a, (select avg(b) from tab )  from tab t1\G
*************************** 1. row ***************************
EXPLAIN: 
-> Covering index scan on t1 using idx_abc  (cost=1025 rows=10010) (actual time=0.108..2.54 rows=10000 loops=1)
-> Select #2 (subquery in projection; run only once)
    -> Aggregate: avg(tab.b)  (cost=2026 rows=1) (actual time=3.79..3.79 rows=1 loops=1)
        -> Covering index scan on tab using idx_abc  (cost=1025 rows=10010) (actual time=0.0235..2.61 rows=10000 loops=1)
```

- DEPENDENT SUBQUERY

å­æŸ¥è¯¢å¼•ç”¨äº†ä¸»æŸ¥è¯¢ä¸­çš„å­—æ®µï¼Œåˆ™å­æŸ¥è¯¢ç§°ä¸ºç›¸å…³å­æŸ¥è¯¢ã€‚MySQLä¸­ï¼Œç›¸å…³å­æŸ¥è¯¢æ— æ³•è¢«ç¼“å­˜ã€‚å¯¹ä¸»æŸ¥è¯¢ä¸­çš„æ¯1è¡Œæ•°æ®ï¼Œéƒ½éœ€è¦æ‰§è¡Œ1æ¬¡å­æŸ¥è¯¢ã€‚

```plain
mysql> explain select a, (select avg(b) from tab where a=t1.a) from tab t1;

+----+--------------------+-------+-------+---------------+---------+---------+----------+------+----------+-------------+
| id | select_typeÂ  Â  Â  Â  | table | typeÂ  | possible_keys | keyÂ  Â  Â | key_len | refÂ  Â  Â  | rows | filtered | ExtraÂ  Â  Â  Â |
+----+--------------------+-------+-------+---------------+---------+---------+----------+------+----------+-------------+
|Â  1 | PRIMARYÂ  Â  Â  Â  Â  Â  | t1Â  Â  | index | NULLÂ  Â  Â  Â  Â  | idx_abc | 12Â  Â  Â  | NULLÂ  Â  Â | 9913 |Â  Â 100.00 | Using index |
|Â  2 | DEPENDENT SUBQUERY | tabÂ  Â | refÂ  Â | idx_abcÂ  Â  Â  Â | idx_abc | 4Â  Â  Â  Â | rep.t1.a | 3304 |Â  Â 100.00 | Using index |
+----+--------------------+-------+-------+---------------+---------+---------+----------+------+----------+-------------+
```

ä½¿ç”¨EXPLAN ANLYZEå‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°å­æŸ¥è¯¢æ‰§è¡Œäº†10000æ¬¡ï¼ˆloops=10000ï¼‰ã€‚

```plain
mysql> explain  analyze select a, (select avg(b) from tab where a=t1.a) from tab t1\G
*************************** 1. row ***************************
EXPLAIN: 
-> Covering index scan on t1 using idx_abc  (cost=1025 rows=10010) (actual time=0.0478..3.09 rows=10000 loops=1)
-> Select #2 (subquery in projection; dependent)
    -> Aggregate: avg(tab.b)  (cost=669 rows=1) (actual time=1.39..1.39 rows=1 loops=10000)
        -> Covering index lookup on tab using idx_abc (a=t1.a)  (cost=336 rows=3337) (actual time=0.023..1.03 rows=3333 loops=10000)

1 row in set, 1 warning (13.94 sec)
```

MariaDBä¸­ï¼Œç›¸å…³å­æŸ¥è¯¢ä¹Ÿå¯ä»¥cacheï¼Œå¯¹äºæœ¬ä¾‹ä¸­çš„SQLï¼Œå­æŸ¥è¯¢ä¾èµ–ä¸»æŸ¥è¯¢ä¸­t1è¡¨çš„å­—æ®µaï¼Œæ¯æ¬¡t1.aå‡ºç°æ–°å€¼æ—¶ï¼Œæ‰§è¡Œ1æ¬¡å­æŸ¥è¯¢ï¼Œå¹¶ç¼“å­˜t1.açš„å€¼å’ŒæŸ¥è¯¢ç»“æœã€‚å­æŸ¥è¯¢æ‰§è¡Œçš„æ¬¡æ•°å–å†³äºå…³è”çš„å¤–éƒ¨æŸ¥è¯¢ä¸­å­—æ®µçš„å”¯ä¸€å€¼æ•°é‡ã€‚

ä¸‹é¢è¿™ä¸ªä¾‹å­æ˜¯åœ¨MariaDB 10.0çš„ç¯å¢ƒä¸­æ‰§è¡Œå¾—åˆ°çš„ã€‚explain extendedçš„warningä¿¡æ¯ä¸­ï¼Œ`<expr_cache>` è¡¨ç¤ºä½¿ç”¨äº†å­æŸ¥è¯¢cacheã€‚

```plain
--è¿™ä¸ªä¾‹å­åœ¨mariadb 10.0 ä¸­æ‰§è¡Œ
mysql> explain extended select a, (select avg(b) from tab where a=t1.a) from tab t1;
+------+--------------------+-------+-------+---------------+---------+---------+------------+------+----------+-------------+
| id   | select_type        | table | type  | possible_keys | key     | key_len | ref        | rows | filtered | Extra       |
+------+--------------------+-------+-------+---------------+---------+---------+------------+------+----------+-------------+
|    1 | PRIMARY            | t1    | index | NULL          | idx_abc | 12      | NULL       | 9919 |   100.00 | Using index |
|    2 | DEPENDENT SUBQUERY | tab   | ref   | idx_abc       | idx_abc | 4       | mysql.t1.a | 1668 |   100.00 | Using index |
+------+--------------------+-------+-------+---------------+---------+---------+------------+------+----------+-------------+
2 rows in set, 2 warnings (0.00 sec)

mysql> show warnings;
+-------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Level | Code | Message                                                                                                                                                                                                                                                       |
+-------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Note  | 1276 | Field or reference 'mysql.t1.a' of SELECT #2 was resolved in SELECT #1                                                                                                                                                                                        |
| Note  | 1003 | /* select#1 */ select `mysql`.`t1`.`a` AS `a`,<expr_cache><`mysql`.`t1`.`a`>((/* select#2 */ select avg(`mysql`.`tab`.`b`) from `mysql`.`tab` where `mysql`.`tab`.`a` = `mysql`.`t1`.`a`)) AS `(select avg(b) from tab where a=t1.a)` from `mysql`.`tab` `t1` |
+-------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
```

- DERIVED

å­æŸ¥è¯¢å‡ºç°åœ¨ä¸»æŸ¥è¯¢çš„FROMå­å¥çš„ä½ç½®æ—¶ï¼Œselect\_typeä¸ºDERIVEDã€‚

```plain
mysql> explain select t1.* 
    from tab t1, (select a, avg(b) as avgb from tab group by a) t2  
    where t1.a = t2.a;
    
+----+-------------+------------+-------+---------------+-------------+---------+----------+------+----------+-------------+
| id | select_type | tableÂ  Â  Â  | typeÂ  | possible_keys | keyÂ  Â  Â  Â  Â | key_len | refÂ  Â  Â  | rows | filtered | ExtraÂ  Â  Â  Â |
+----+-------------+------------+-------+---------------+-------------+---------+----------+------+----------+-------------+
|Â  1 | PRIMARYÂ  Â  Â | t1Â  Â  Â  Â  Â | ALLÂ  Â | idx_abcÂ  Â  Â  Â | NULLÂ  Â  Â  Â  | NULLÂ  Â  | NULLÂ  Â  Â | 9913 |Â  Â 100.00 | NULLÂ  Â  Â  Â  |
|Â  1 | PRIMARYÂ  Â  Â | <derived2> | refÂ  Â | <auto_key0>Â  Â | <auto_key0> | 4Â  Â  Â  Â | rep.t1.a |Â  Â 10 |Â  Â 100.00 | NULLÂ  Â  Â  Â  |
|Â  2 | DERIVEDÂ  Â  Â | tabÂ  Â  Â  Â  | index | idx_abcÂ  Â  Â  Â | idx_abcÂ  Â  Â | 12Â  Â  Â  | NULLÂ  Â  Â | 9913 |Â  Â 100.00 | Using index |
+----+-------------+------------+-------+---------------+-------------+---------+----------+------+----------+-------------+
```

- DEPENDENT DERIVED

å¦‚æœæ´¾ç”ŸæŸ¥è¯¢å¼•ç”¨äº†ä¸»æŸ¥è¯¢ä¸­çš„å­—æ®µï¼Œåˆ™select\_typeä¸ºDEPENDENT DERIVEDã€‚

```plain
mysql> explain select a, (select * from (select avg(b) as avgb from tab where a=t0.a) td) from tab t0;

+----+--------------------+------------+-------+---------------+---------+---------+----------+------+----------+-------------+
| id | select_typeÂ  Â  Â  Â  | tableÂ  Â  Â  | typeÂ  | possible_keys | keyÂ  Â  Â | key_len | refÂ  Â  Â  | rows | filtered | ExtraÂ  Â  Â  Â |
+----+--------------------+------------+-------+---------------+---------+---------+----------+------+----------+-------------+
|Â  1 | PRIMARYÂ  Â  Â  Â  Â  Â  | t0Â  Â  Â  Â  Â | index | NULLÂ  Â  Â  Â  Â  | idx_abc | 12Â  Â  Â  | NULLÂ  Â  Â | 9913 |Â  Â 100.00 | Using index |
|Â  2 | DEPENDENT SUBQUERY | <derived3> | ALLÂ  Â | NULLÂ  Â  Â  Â  Â  | NULLÂ  Â  | NULLÂ  Â  | NULLÂ  Â  Â |Â  Â  2 |Â  Â 100.00 | NULLÂ  Â  Â  Â  |
|Â  3 | DEPENDENT DERIVEDÂ  | tabÂ  Â  Â  Â  | refÂ  Â | idx_abcÂ  Â  Â  Â | idx_abc | 4Â  Â  Â  Â | rep.t0.a | 3304 |Â  Â 100.00 | Using index |
+----+--------------------+------------+-------+---------------+---------+---------+----------+------+----------+-------------+

```

- MATERIALIZED

å­æŸ¥è¯¢çš„ç»“æœå…ˆå­˜å‚¨åˆ°ä¸´æ—¶è¡¨ï¼ŒæŸ¥è¯¢çš„å…¶ä»–éƒ¨åˆ†å’Œç”Ÿæˆçš„ä¸´æ—¶è¡¨å†å…³è”ã€‚

```plain
mysql> explain select * from tab where a in( select b from tab);

+----+--------------+-------------+--------+---------------------+---------------------+---------+-----------+------+----------+-------------+
| id | select_typeÂ  | tableÂ  Â  Â  Â | typeÂ  Â | possible_keysÂ  Â  Â  Â | keyÂ  Â  Â  Â  Â  Â  Â  Â  Â | key_len | refÂ  Â  Â  Â | rows | filtered | ExtraÂ  Â  Â  Â |
+----+--------------+-------------+--------+---------------------+---------------------+---------+-----------+------+----------+-------------+
|Â  1 | SIMPLEÂ  Â  Â  Â | tabÂ  Â  Â  Â  Â | ALLÂ  Â  | idx_abcÂ  Â  Â  Â  Â  Â  Â | NULLÂ  Â  Â  Â  Â  Â  Â  Â  | NULLÂ  Â  | NULLÂ  Â  Â  | 9913 |Â  Â 100.00 | NULLÂ  Â  Â  Â  |
|Â  1 | SIMPLEÂ  Â  Â  Â | <subquery2> | eq_ref | <auto_distinct_key> | <auto_distinct_key> | 4Â  Â  Â  Â | rep.tab.a |Â  Â  1 |Â  Â 100.00 | NULLÂ  Â  Â  Â  |
|Â  2 | MATERIALIZED | tabÂ  Â  Â  Â  Â | indexÂ  | NULLÂ  Â  Â  Â  Â  Â  Â  Â  | idx_abcÂ  Â  Â  Â  Â  Â  Â | 12Â  Â  Â  | NULLÂ  Â  Â  | 9913 |Â  Â 100.00 | Using index |
+----+--------------+-------------+--------+---------------------+---------------------+---------+-----------+------+----------+-------------+
```

- UNCACHEABLE SUBQUERY

å¦‚æœï¼ˆä¸ç›¸å…³ï¼‰å­æŸ¥è¯¢ç»“æœæ— æ³•è¢«ç¼“å­˜ï¼Œåˆ™select\_typeä¸ºUNCACHEABLE SUBQUERYã€‚

```plain
mysql> explain select * from tab where b > (select avg(b) from tab where b > rand());

+----+----------------------+-------+-------+---------------+---------+---------+------+------+----------+--------------------------+
| id | select_typeÂ  Â  Â  Â  Â  | table | typeÂ  | possible_keys | keyÂ  Â  Â | key_len | refÂ  | rows | filtered | ExtraÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  |
+----+----------------------+-------+-------+---------------+---------+---------+------+------+----------+--------------------------+
|Â  1 | PRIMARYÂ  Â  Â  Â  Â  Â  Â  | tabÂ  Â | ALLÂ  Â | NULLÂ  Â  Â  Â  Â  | NULLÂ  Â  | NULLÂ  Â  | NULL | 9913 |Â  Â 100.00 | Using whereÂ  Â  Â  Â  Â  Â  Â  |
|Â  2 | UNCACHEABLE SUBQUERY | tabÂ  Â | index | NULLÂ  Â  Â  Â  Â  | idx_abc | 12Â  Â  Â  | NULL | 9913 |Â  Â  33.33 | Using where; Using index |
+----+----------------------+-------+-------+---------------+---------+---------+------+------+----------+--------------------------+
```

å¯¼è‡´å­æŸ¥è¯¢æ— æ³•Cacheçš„ä¸€äº›æƒ…å†µï¼šå­æŸ¥è¯¢ä½¿ç”¨äº†ç»“æœä¸ç¡®å®šçš„å‡½æ•°ï¼ˆå¦‚randï¼‰ï¼Œå­æŸ¥è¯¢ä½¿ç”¨äº†å˜é‡ã€‚

- UNCACHEABLE UNION

```plain
mysql> explain select distinct a from  (select a from tab tb  union all select c from tab tc where c > rand() ) tx;

+----+-------------------+------------+-------+---------------+---------+---------+------+-------+----------+--------------------------+
| id | select_typeÂ  Â  Â  Â | tableÂ  Â  Â  | typeÂ  | possible_keys | keyÂ  Â  Â | key_len | refÂ  | rowsÂ  | filtered | ExtraÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  |
+----+-------------------+------------+-------+---------------+---------+---------+------+-------+----------+--------------------------+
|Â  1 | PRIMARYÂ  Â  Â  Â  Â  Â | <derived2> | ALLÂ  Â | NULLÂ  Â  Â  Â  Â  | NULLÂ  Â  | NULLÂ  Â  | NULL | 13346 |Â  Â 100.00 | Using temporaryÂ  Â  Â  Â  Â  |
|Â  2 | DERIVEDÂ  Â  Â  Â  Â  Â | tbÂ  Â  Â  Â  Â | index | NULLÂ  Â  Â  Â  Â  | idx_abc | 12Â  Â  Â  | NULL | 10010 |Â  Â 100.00 | Using indexÂ  Â  Â  Â  Â  Â  Â  |
|Â  3 | UNCACHEABLE UNION | tcÂ  Â  Â  Â  Â | index | NULLÂ  Â  Â  Â  Â  | idx_cÂ  Â | 4Â  Â  Â  Â | NULL | 10010 |Â  Â  33.33 | Using where; Using index |
+----+-------------------+------------+-------+---------------+---------+---------+------+-------+----------+--------------------------+
```

### TABLE

TABLEè¿™ä¸€åˆ—è¯´æ˜äº†ä¸€ä¸ªæŸ¥è¯¢å•å…ƒçš„æ•°æ®æ˜¯ä»å“ªä¸ªè¡¨è·å–çš„ã€‚è¿™é‡Œåˆ†å‡ ç§æƒ…å†µã€‚

1. tableæ˜¯ä¸€ä¸ªçœŸå®å­˜åœ¨çš„ç‰©ç†è¡¨ï¼Œè¿™é‡Œä¼šæ˜¾ç¤ºä¸ºè¡¨çš„åˆ«åã€‚
2. `<derivedN>`ï¼Œè¯´æ˜æ˜¯ä»æ´¾ç”Ÿè¡¨è·å–çš„æ•°æ®ï¼ŒçœŸå®çš„æ•°æ®æ¥è‡ªIDä¸ºNçš„æŸ¥è¯¢å•å…ƒ
3. `<unionM,N>`ï¼Œè¯´æ˜æ˜¯å°†IDä¸ºMå’ŒNçš„æŸ¥è¯¢å•å…ƒUnionåå¾—åˆ°çš„æ•°æ®ã€‚
4. `<subqueryN>`ï¼Œè¯´æ˜æ˜¯IDä¸ºNçš„å­æŸ¥è¯¢ç‰©åŒ–åå¾—åˆ°çš„æ•°æ®ã€‚

è¿™é‡Œçš„å‡ ç§æƒ…å†µï¼Œåœ¨å‰é¢çš„ä¾‹å­ä¸­éƒ½å‡ºç°è¿‡ï¼Œä½ å¯ä»¥å›å¤´å†çœ‹ä¸€ä¸‹ã€‚

### TYPE

TYPEåˆ—æ˜¾ç¤ºæŸ¥è¯¢å•å…ƒçš„è®¿é—®è·¯å¾„ï¼Œä½ å¯ä»¥æ ¹æ®TYPEåˆ—æ¥åˆ¤æ–­æŸ¥è¯¢å•å…ƒæ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•ã€‚

- system

å¦‚æœä½¿ç”¨äº†MyISAMå­˜å‚¨å¼•æ“ï¼Œå¹¶ä¸”è¡¨ä¸­åªæœ‰1è¡Œï¼Œåˆ™Typeä¸ºsystemã€‚

```plain
mysql> create table t1_myisam(a int) engine=myisam;
mysql> insert into t1_myisam values(100);

mysql> explain select * from t1_myisam;
+----+-------------+-----------+--------+---------------+------+---------+------+------+----------+-------+
| id | select_type | tableÂ  Â  Â | typeÂ  Â | possible_keys | keyÂ  | key_len | refÂ  | rows | filtered | Extra |
+----+-------------+-----------+--------+---------------+------+---------+------+------+----------+-------+
|Â  1 | SIMPLEÂ  Â  Â  | t1_myisam | system | NULLÂ  Â  Â  Â  Â  | NULL | NULLÂ  Â  | NULL |Â  Â  1 |Â  Â 100.00 | NULLÂ  |
+----+-------------+-----------+--------+---------------+------+---------+------+------+----------+-------+
```

- const

constè¡¨ç¤ºæŸ¥è¯¢æœ€å¤šè¿”å›1è¡Œè®°å½•ã€‚å¯¹ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•çš„æ‰€æœ‰å­—æ®µéƒ½ä½¿ç”¨å¸¸é‡ç­‰å€¼åŒ¹é…æ—¶ï¼Œtypeä¸ºconstã€‚ä¼˜åŒ–å™¨ä¼šå°†typeä¸ºconstçš„æŸ¥è¯¢å•å…ƒç›´æ¥æ›¿æ¢ä¸ºå¸¸é‡è¡¨ã€‚

```plain
mysql> explain select * from tab where id = 10\G
+----+-------------+-------+-------+---------------+---------+---------+-------+------+----------+-------+
| id | select_type | table | typeÂ  | possible_keys | keyÂ  Â  Â | key_len | refÂ  Â | rows | filtered | Extra |
+----+-------------+-------+-------+---------------+---------+---------+-------+------+----------+-------+
|Â  1 | SIMPLEÂ  Â  Â  | tabÂ  Â | const | PRIMARYÂ  Â  Â  Â | PRIMARY | 4Â  Â  Â  Â | const |Â  Â  1 |Â  Â 100.00 | NULLÂ  |
+----+-------------+-------+-------+---------------+---------+---------+-------+------+----------+-------+
```

- eq\_ref

ä½¿ç”¨ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•ç­‰å€¼åŒ¹é…æ—¶ï¼Œtypeä¸ºeq\_refã€‚å¯¹äºç»„åˆä¸»é”®ã€ç»„åˆå”¯ä¸€ç´¢å¼•ï¼Œç´¢å¼•ä¸­çš„æ¯ä¸€ä¸ªå­—æ®µéƒ½éœ€è¦ä»¥ç­‰å€¼åŒ¹é…æ—¶ï¼Œtypeæ‰ä¸ºeq\_refã€‚eq\_refè®¿é—®è·¯å¾„æ¯æ¬¡æœ€å¤šåªè¿”å›1è¡Œè®°å½•ã€‚eq\_refå’Œconstçš„åŒºåˆ«åœ¨äºï¼Œconstä½¿ç”¨å¸¸é‡åŒ¹é…ï¼Œè€Œeq\_refä¸­ï¼ŒåŒ¹é…ç´¢å¼•å­—æ®µçš„å€¼æ¥è‡ªé©±åŠ¨è¡¨ï¼Œä¸æ˜¯å›ºå®šçš„å¸¸é‡ã€‚

ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œt2è¡¨idå­—æ®µçš„åŒ¹é…æ¡ä»¶æ¥è‡ªé©±åŠ¨è¡¨t1çš„å­—æ®µaã€‚

```plain
mysql> explain select * from tab t1 , tab t2 where t1.a = t2.id;

+----+-------------+-------+--------+---------------+---------+---------+----------+------+----------+-------+
| id | select_type | table | typeÂ  Â | possible_keys | keyÂ  Â  Â | key_len | refÂ  Â  Â  | rows | filtered | Extra |
+----+-------------+-------+--------+---------------+---------+---------+----------+------+----------+-------+
|Â  1 | SIMPLEÂ  Â  Â  | t1Â  Â  | ALLÂ  Â  | idx_abcÂ  Â  Â  Â | NULLÂ  Â  | NULLÂ  Â  | NULLÂ  Â  Â | 9913 |Â  Â 100.00 | NULLÂ  |
|Â  1 | SIMPLEÂ  Â  Â  | t2Â  Â  | eq_ref | PRIMARYÂ  Â  Â  Â | PRIMARY | 4Â  Â  Â  Â | rep.t1.a |Â  Â  1 |Â  Â 100.00 | NULLÂ  |
+----+-------------+-------+--------+---------------+---------+---------+----------+------+----------+-------+
```

- ref

æ™®é€šç´¢å¼•å­—æ®µçš„ç­‰å€¼åŒ¹é…ï¼Œæˆ–ä¸»é”®å’Œå”¯ä¸€ç´¢å¼•å‰ç¼€å­—æ®µä¸Šçš„ç­‰å€¼åŒ¹é…ï¼Œç±»å‹ä¸ºrefã€‚å¯¹äºrefç±»å‹çš„è®¿é—®è·¯å¾„ï¼Œæ‰§è¡Œè®¡åˆ’è¾“å‡ºä¸­çš„keyåˆ—æ˜¾ç¤ºäº†å®é™…ä½¿ç”¨çš„ç´¢å¼•ï¼Œkey\_lenæ˜¾ç¤ºä½¿ç”¨çš„ç´¢å¼•å­—æ®µçš„é•¿åº¦ï¼Œrefå­—æ®µæ˜¾ç¤ºç”¨äºåŒ¹é…çš„å€¼ã€‚

```plain
mysql> explain select * from tab where a=1;

+----+-------------+-------+------+---------------+---------+---------+-------+------+----------+-------+
| id | select_type | table | type | possible_keys | keyÂ  Â  Â | key_len | refÂ  Â | rows | filtered | Extra |
+----+-------------+-------+------+---------------+---------+---------+-------+------+----------+-------+
|Â  1 | SIMPLEÂ  Â  Â  | tabÂ  Â | refÂ  | idx_abcÂ  Â  Â  Â | idx_abc | 4Â  Â  Â  Â | const | 3333 |Â  Â 100.00 | NULLÂ  |
+----+-------------+-------+------+---------------+---------+---------+-------+------+----------+-------+


mysql> explain select * from tab t1, tab t2 where t1.a = t2.a;

+----+-------------+-------+------+---------------+---------+---------+----------+------+----------+-------+
| id | select_type | table | type | possible_keys | keyÂ  Â  Â | key_len | refÂ  Â  Â  | rows | filtered | Extra |
+----+-------------+-------+------+---------------+---------+---------+----------+------+----------+-------+
|Â  1 | SIMPLEÂ  Â  Â  | t1Â  Â  | ALLÂ  | idx_abcÂ  Â  Â  Â | NULLÂ  Â  | NULLÂ  Â  | NULLÂ  Â  Â | 9913 |Â  Â 100.00 | NULLÂ  |
|Â  1 | SIMPLEÂ  Â  Â  | t2Â  Â  | refÂ  | idx_abcÂ  Â  Â  Â | idx_abc | 4Â  Â  Â  Â | rep.t1.a | 3304 |Â  Â 100.00 | NULLÂ  |
+----+-------------+-------+------+---------------+---------+---------+----------+------+----------+-------+
```

å¦‚æœç´¢å¼•å­—æ®µçš„æ¡ä»¶ä½¿ç”¨äº†oræˆ–inï¼Œé‚£ä¹ˆtypeå°±ä¸å†æ˜¯refäº†ã€‚

- ref\_or\_null

ref\_or\_nullå’Œrefç±»ä¼¼ï¼Œåªæ˜¯é¢å¤–åŠ äº†å­—æ®µä¸ºç©ºçš„æ¡ä»¶ã€‚å¯¹æ¯”ä¸‹ä¸‹é¢è¿™ä¸¤ä¸ªè¯­å¥ï¼Œå­—æ®µAæœ‰not nullçº¦æŸæ—¶ï¼Œtypeä¸ºrefã€‚

```plain
mysql> create table tab3 like tab;
mysql> alter table tab3 modify a int;
mysql> insert into tab3 select * from tab;

mysql> explain select * from tab where a is null or a = 1;
+----+-------------+-------+------+---------------+---------+---------+-------+------+----------+-------+
| id | select_type | table | type | possible_keys | keyÂ  Â  Â | key_len | refÂ  Â | rows | filtered | Extra |
+----+-------------+-------+------+---------------+---------+---------+-------+------+----------+-------+
|Â  1 | SIMPLEÂ  Â  Â  | tabÂ  Â | refÂ  | idx_abcÂ  Â  Â  Â | idx_abc | 4Â  Â  Â  Â | const | 3333 |Â  Â 100.00 | NULLÂ  |
+----+-------------+-------+------+---------------+---------+---------+-------+------+----------+-------+

mysql> explain select * from tab3 where a is null or a = 1;
+----+-------------+-------+-------------+---------------+---------+---------+-------+------+----------+-----------------------+
| id | select_type | table | typeÂ  Â  Â  Â  | possible_keys | keyÂ  Â  Â | key_len | refÂ  Â | rows | filtered | ExtraÂ  Â  Â  Â  Â  Â  Â  Â  Â |
+----+-------------+-------+-------------+---------------+---------+---------+-------+------+----------+-----------------------+
|Â  1 | SIMPLEÂ  Â  Â  | tab3Â  | ref_or_null | idx_abcÂ  Â  Â  Â | idx_abc | 5Â  Â  Â  Â | const | 3334 |Â  Â 100.00 | Using index condition |
+----+-------------+-------+-------------+---------------+---------+---------+-------+------+----------+-----------------------+
```

- range

ä½¿ç”¨ç´¢å¼•å­—æ®µä¸Šçš„èŒƒå›´æ¡ä»¶æŸ¥è¯¢æ•°æ®ã€‚èŒƒå›´æ¡ä»¶åŒ…æ‹¬ `<, <=, >, >=, BETWEEN` ç­‰ï¼Œç´¢å¼•å­—æ®µä½¿ç”¨ORæˆ–INå¤šä¸ªå€¼æ—¶ï¼Œç±»å‹ä¹Ÿä¸ºrangeã€‚å¯¹äºrangeè®¿é—®è·¯å¾„ï¼Œæ‰§è¡Œè®¡åˆ’ä¸­keyåˆ—æ˜¾ç¤ºå®é™…ä½¿ç”¨çš„ç´¢å¼•åã€‚key\_lenåˆ—æ˜¾ç¤ºä½¿ç”¨åˆ°çš„ç´¢å¼•å­—æ®µçš„é•¿åº¦ï¼Œken\_lenå–å†³äºä½¿ç”¨åˆ°çš„ç´¢å¼•å­—æ®µçš„æ•°æ®ç±»å‹ã€å­—æ®µæ˜¯å¦å¯ä»¥ä¸ºç©ºã€‚rowså­—æ®µæ˜¾ç¤ºä¼˜åŒ–å™¨è¯„ä¼°å¾—åˆ°çš„éœ€è¦åœ¨ç´¢å¼•ä¸­è®¿é—®çš„è®°å½•æ•°é‡ã€‚

```plain
mysql> explain select * from tab force index(idx_abc) where   a = 1 or a = 2;

+----+-------------+-------+-------+---------------+---------+---------+------+------+----------+-----------------------+
| id | select_type | table | typeÂ  | possible_keys | keyÂ  Â  Â | key_len | refÂ  | rows | filtered | ExtraÂ  Â  Â  Â  Â  Â  Â  Â  Â |
+----+-------------+-------+-------+---------------+---------+---------+------+------+----------+-----------------------+
|Â  1 | SIMPLEÂ  Â  Â  | tabÂ  Â | range | idx_abcÂ  Â  Â  Â | idx_abc | 4Â  Â  Â  Â | NULL | 6666 |Â  Â 100.00 | Using index condition |
+----+-------------+-------+-------+---------------+---------+---------+------+------+----------+-----------------------+


mysql> explain select * from tab where a = 1 and b between 100 and 200;
+----+-------------+-------+-------+---------------+---------+---------+------+------+----------+-----------------------+
| id | select_type | table | typeÂ  | possible_keys | keyÂ  Â  Â | key_len | refÂ  | rows | filtered | ExtraÂ  Â  Â  Â  Â  Â  Â  Â  Â |
+----+-------------+-------+-------+---------------+---------+---------+------+------+----------+-----------------------+
|Â  1 | SIMPLEÂ  Â  Â  | tabÂ  Â | range | idx_abcÂ  Â  Â  Â | idx_abc | 8Â  Â  Â  Â | NULL |Â  Â 34 |Â  Â 100.00 | Using index condition |
+----+-------------+-------+-------+---------------+---------+---------+------+------+----------+-----------------------+
```

- index\_merge

index\_mergeä¼šä½¿ç”¨å¤šä¸ªç´¢å¼•æ¥æŸ¥è¯¢æ•°æ®ï¼Œå¹¶å°†é€šè¿‡å¤šä¸ªç´¢å¼•è·å–åˆ°çš„æ•°æ®å–å¹¶é›†æˆ–äº¤é›†ï¼Œå¾—åˆ°æœ€ç»ˆçš„ç»“æœã€‚æ‰§è¡Œè®¡åˆ’è¾“å‡ºä¸­ï¼Œkeyå­—æ®µæ˜¾ç¤ºå®é™…å‚ä¸index\_mergeçš„ç´¢å¼•ã€‚Extraåˆ—ä¸­çš„ä¿¡æ¯æ˜¾ç¤ºäº†å®é™…çš„ç´¢å¼•åˆå¹¶æ–¹æ³•ï¼ŒåŒ…æ‹¬sort\_union, unionå’Œintersectã€‚

å¦‚æœåœ¨æ‰§è¡Œè®¡åˆ’ä¸­çœ‹åˆ°index\_mergeè®¿é—®è·¯å¾„ï¼Œä¸€èˆ¬è¦è€ƒè™‘æ˜¯å¦å¯ä»¥åˆ›å»ºè”åˆç´¢å¼•ï¼Œå°†è®¿é—®è·¯å¾„æ”¹æˆrangeæˆ–refï¼Œæˆ–è€…å°†SQLæ”¹å†™ä¸ºunionæŸ¥è¯¢ã€‚

```plain
mysql> explain select * 
  from t_merge 
  where (b=1 and d=1) or (c=1 and d between 3 and 5);
+----+-------------+---------+-------------+---------------+---------------+---------+------+------+----------+----------------------------------------------+
| id | select_type | tableÂ  Â | typeÂ  Â  Â  Â  | possible_keys | keyÂ  Â  Â  Â  Â  Â | key_len | refÂ  | rows | filtered | ExtraÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  |
+----+-------------+---------+-------------+---------------+---------------+---------+------+------+----------+----------------------------------------------+
|Â  1 | SIMPLEÂ  Â  Â  | t_merge | index_merge | idx_bd,idx_cd | idx_bd,idx_cd | 8,8Â  Â  Â | NULL |Â  210 |Â  Â 100.00 | Using sort_union(idx_bd,idx_cd); Using where |
+----+-------------+---------+-------------+---------------+---------------+---------+------+------+----------+----------------------------------------------+

mysql> explain select * from t_merge where a=1 and b=1 and d=1 and c=1;
+----+-------------+---------+-------------+----------------------+----------------------+---------+------+------+----------+----------------------------------------------------+
| id | select_type | tableÂ  Â | typeÂ  Â  Â  Â  | possible_keysÂ  Â  Â  Â  | keyÂ  Â  Â  Â  Â  Â  Â  Â  Â  | key_len | refÂ  | rows | filtered | ExtraÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  |
+----+-------------+---------+-------------+----------------------+----------------------+---------+------+------+----------+----------------------------------------------------+
|Â  1 | SIMPLEÂ  Â  Â  | t_merge | index_merge | idx_ad,idx_bd,idx_cd | idx_cd,idx_bd,idx_ad | 8,8,8Â  Â | NULL |Â  Â  1 |Â  Â 100.00 | Using intersect(idx_cd,idx_bd,idx_ad); Using where |
+----+-------------+---------+-------------+----------------------+----------------------+---------+------+------+----------+----------------------------------------------------+
```

- index\_subquery

index\_subqueryæ˜¯æ‰§è¡Œä¸‹é¢è¿™ç§ç±»å‹çš„å­æŸ¥è¯¢çš„ä¸€ç§æ–¹å¼ï¼š

```plain
where value in (select col from tab where ...)
```

å¦‚æœå­æŸ¥è¯¢ä¸­çš„è¡¨tabæœ‰åˆé€‚çš„ç´¢å¼•å¯ä»¥ç”¨æ¥æ£€ç´¢ï¼Œåˆ™å¯ä»¥ä½¿ç”¨index\_subqueryæ‰§è¡Œè·¯å¾„ï¼Œå¯¹ä¸»æŸ¥è¯¢ä¸­çš„æ¯1è¡Œè®°å½•ï¼Œæ‰§è¡Œç±»ä¼¼ä¸‹é¢çš„SQLï¼š

```plain
select * from tab where col = outer.value and ...
```

```plain
mysql> explain select /*+ NO_SEMIJOIN(@qb1) */ * from tab 
  where a = 1 
  and  b between 100 and 200  
  and c in (select /*+ QB_NAME(qb1) */  a from tab where b=1  );

+----+--------------------+-------+----------------+---------------+---------+---------+------------+------+----------+------------------------------------+
| id | select_typeÂ  Â  Â  Â  | table | typeÂ  Â  Â  Â  Â  Â | possible_keys | keyÂ  Â  Â | key_len | refÂ  Â  Â  Â  | rows | filtered | ExtraÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  |
+----+--------------------+-------+----------------+---------------+---------+---------+------------+------+----------+------------------------------------+
|Â  1 | PRIMARYÂ  Â  Â  Â  Â  Â  | tabÂ  Â | rangeÂ  Â  Â  Â  Â  | idx_abcÂ  Â  Â  Â | idx_abc | 8Â  Â  Â  Â | NULLÂ  Â  Â  Â |Â  Â 34 |Â  Â 100.00 | Using index condition; Using where |
|Â  2 | DEPENDENT SUBQUERY | tabÂ  Â | index_subquery | idx_abcÂ  Â  Â  Â | idx_abc | 8Â  Â  Â  Â | func,const |Â  Â  1 |Â  Â 100.00 | Using indexÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  |
+----+--------------------+-------+----------------+---------------+---------+---------+------------+------+----------+------------------------------------+

mysql> show warnings\G
*************************** 1. row ***************************
  Level: Note
   Code: 1003
Message: /* select#1 */ select /*+ NO_SEMIJOIN(@`qb1`) */ 
    `rep`.`tab`.`id` AS `id`,`rep`.`tab`.`a` AS `a`,`rep`.`tab`.`b` AS `b`,`rep`.`tab`.`c` AS `c`,`rep`.`tab`.`padding` AS `padding` 
from `rep`.`tab` 
where ((`rep`.`tab`.`a` = 1) 
and (`rep`.`tab`.`b` between 100 and 200) 
and <in_optimizer>(`rep`.`tab`.`c`,<exists>(<index_lookup>(<cache>(`rep`.`tab`.`c`) in tab on idx_abc))))
1 row in set (0.00 sec)
```

- unique\_subquery

unique\_subqueryå’Œindex\_subqueryç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºtypeä¸ºunique\_subqueryæ—¶ï¼Œå­æŸ¥è¯¢ä¸­çš„è¡¨ä½¿ç”¨ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•æ¥å…³è”æŸ¥è¯¢ã€‚

```plain
mysql> explain select /*+ NO_SEMIJOIN(@qb1) */ * 
  from tab 
  where a=1 
  and id in (select /*+ QB_NAME(qb1) */  id from tab);

+----+--------------------+-------+-----------------+---------------+---------+---------+-------+------+----------+-------------+
| id | select_typeÂ  Â  Â  Â  | table | typeÂ  Â  Â  Â  Â  Â  | possible_keys | keyÂ  Â  Â | key_len | refÂ  Â | rows | filtered | ExtraÂ  Â  Â  Â |
+----+--------------------+-------+-----------------+---------------+---------+---------+-------+------+----------+-------------+
|Â  1 | PRIMARYÂ  Â  Â  Â  Â  Â  | tabÂ  Â | refÂ  Â  Â  Â  Â  Â  Â | idx_abcÂ  Â  Â  Â | idx_abc | 4Â  Â  Â  Â | const | 3333 |Â  Â 100.00 | Using where |
|Â  2 | DEPENDENT SUBQUERY | tabÂ  Â | unique_subquery | PRIMARYÂ  Â  Â  Â | PRIMARY | 4Â  Â  Â  Â | funcÂ  |Â  Â  1 |Â  Â 100.00 | Using index |
+----+--------------------+-------+-----------------+---------------+---------+---------+-------+------+----------+-------------+


mysql> show warnings\G
*************************** 1. row ***************************
  Level: Note
   Code: 1003
Message: /* select#1 */ select /*+ NO_SEMIJOIN(@`qb1`) */ 
    `rep`.`tab`.`id` AS `id`,`rep`.`tab`.`a` AS `a`,`rep`.`tab`.`b` AS `b`,`rep`.`tab`.`c` AS `c`,`rep`.`tab`.`padding` AS `padding` 
  from `rep`.`tab` 
  where ((`rep`.`tab`.`a` = 1) 
  and <in_optimizer>(`rep`.`tab`.`id`,<exists>(<primary_index_lookup>(<cache>(`rep`.`tab`.`id`) in tab on PRIMARY))))

```

ä¸Šé¢ä¾‹å­ä¸­NO\_SEMIJOINæç¤ºæ˜¯ä¸ºäº†é˜»æ­¢ä¼˜åŒ–å™¨ä½¿ç”¨åŠè¿æ¥ä¼˜åŒ–ï¼Œå› ä¸ºä½¿ç”¨åŠè¿æ¥ä¼˜åŒ–åï¼Œå­æŸ¥è¯¢è¢«è½¬æ¢ä¸ºåŠè¿æ¥ï¼Œå°±ä¸ä¼šå‡ºç°index\_subqueryå’Œunique\_subqueryè®¿é—®è·¯å¾„äº†ã€‚

- index

indexè®¿é—®è·¯å¾„å’ŒALLç±»ä¼¼ï¼Œä¸»è¦åŒºåˆ«æ˜¯ALLè®¿é—®è·¯å¾„éœ€è¦è®¿é—®è¡¨çš„æ¯ä¸€è¡Œæ•°æ®ï¼Œè€Œindexè®¿é—®è·¯å¾„æ˜¯è®¿é—®ç´¢å¼•ä¸­çš„æ¯ä¸€è¡Œæ•°æ®ã€‚è®¿é—®è·¯å¾„ä¸ºindexæ—¶ï¼Œkey\_lenå­—æ®µæ˜¾ç¤ºçš„æ˜¯æ‰€æœ‰ç´¢å¼•å­—æ®µçš„é•¿åº¦æ€»å’Œã€‚ä¸€èˆ¬typeä¸ºindexæ—¶ï¼Œpossible\_keysæ€»æ˜¯NULLã€‚

ä»¥ä¸‹2ç§æƒ…å†µå¯ä»¥ä½¿ç”¨indexè®¿é—®è·¯å¾„ï¼š

æƒ…å†µ1ï¼šè¯­å¥ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œä½†æ˜¯åˆç¼ºå°‘ç´¢å¼•å­—æ®µçš„æŸ¥è¯¢æ¡ä»¶ã€‚è¿™ç§æƒ…å†µä¸‹Extraåˆ—ä¼šæ˜¾ç¤ºUsing indexã€‚

æƒ…å†µ2ï¼šæŒ‰ç´¢å¼•çš„é¡ºåºè¯»å–è¡¨çš„è®°å½•ï¼Œä½†æ˜¯æ— æ³•ä½¿ç”¨è¦†ç›–ç´¢å¼•ã€‚è¿™ç§æƒ…å†µä¸‹Extraåˆ—ä¸æ˜¾ç¤ºUsing indexã€‚

ä¸‹é¢çš„2ä¸ªä¾‹å­åˆ†åˆ«å±•ç¤ºäº†è¿™ä¸¤ç§æƒ…å†µã€‚

```plain
mysql> explain select a,b,c from tab force index(idx_abc) order by a,b,c;

+----+-------------+-------+-------+---------------+---------+---------+------+------+----------+-------------+
| id | select_type | table | typeÂ  | possible_keys | keyÂ  Â  Â | key_len | refÂ  | rows | filtered | ExtraÂ  Â  Â  Â |
+----+-------------+-------+-------+---------------+---------+---------+------+------+----------+-------------+
|Â  1 | SIMPLEÂ  Â  Â  | tabÂ  Â | index | NULLÂ  Â  Â  Â  Â  | idx_abc | 12Â  Â  Â  | NULL | 9913 |Â  Â 100.00 | Using index |
+----+-------------+-------+-------+---------------+---------+---------+------+------+----------+-------------+

mysql> explain select * from tab force index(idx_abc) order by a,b,c;

+----+-------------+-------+-------+---------------+---------+---------+------+------+----------+-------+
| id | select_type | table | typeÂ  | possible_keys | keyÂ  Â  Â | key_len | refÂ  | rows | filtered | Extra |
+----+-------------+-------+-------+---------------+---------+---------+------+------+----------+-------+
|Â  1 | SIMPLEÂ  Â  Â  | tabÂ  Â | index | NULLÂ  Â  Â  Â  Â  | idx_abc | 12Â  Â  Â  | NULL | 9913 |Â  Â 100.00 | NULLÂ  |
+----+-------------+-------+-------+---------------+---------+---------+------+------+----------+-------+
```

- ALL

å…¨è¡¨æ‰«æï¼Œéœ€è¦è®¿é—®è¡¨ä¸­çš„æ¯ä¸€è¡Œè®°å½•ã€‚å‡ºç°ALLè®¿é—®è·¯å¾„ï¼Œå¯èƒ½æ˜¯å› ä¸ºè¡¨ä¸Šç¼ºå°‘åˆé€‚çš„ç´¢å¼•ï¼Œæˆ–è€…æ˜¯å› ä¸ºSQLè¯­å¥çš„å†™æ³•é—®é¢˜å¯¼è‡´æ— æ³•ä½¿ç”¨ç´¢å¼•ï¼Œä¹Ÿå¯èƒ½æ˜¯å› ä¸ºæŸ¥è¯¢ä¸­å¯¹è¡¨ç¼ºå°‘åˆé€‚çš„è¿‡æ»¤æ¡ä»¶ï¼Œæˆ–è€…æ˜¯ç´¢å¼•å­—æ®µçš„è¿‡æ»¤æ€§ä¸å¥½ï¼Œéœ€è¦æ ¹æ®æŸ¥è¯¢è¯­å¥çš„æƒ…å†µå…·ä½“åˆ†æã€‚

\\å› å­—æ•°é™åˆ¶ï¼Œå­¦ä¹ åé¢çš„å†…å®¹è¯·ç›´æ¥è·³è½¬åˆ°ä¸‹ä¸€è®²
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ2ï¼‰</strong></div><ul>
<li><span>ç¬™ é¸¢</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆï¼Œæ´¾ç”Ÿè¡¨çš„è®²è§£å¤„ï¼Œå¥½å¤šDRIVEDçš„å†™æ³•ï¼Œæ˜¯ä¸æ˜¯å†™é”™äº†ï¼Ÿï¼Ÿ</p>2024-11-29</li><br/><li><span>mw</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>è€å¸ˆå¥½ï¼Œè¯·æ•™ä¸ªé—®é¢˜ï¼šåœ¨é€‰æ‹©é©±åŠ¨è¡¨çš„æ—¶å€™ éœ€è¦è¿‡æ»¤where ä¹‹åçš„æ‰€æœ‰æ¡ä»¶ä¹‹åä»¥æ•°æ®é‡å°çš„ä½œä¸ºé©±åŠ¨è¡¨ã€‚
1ã€é‚£è¦æ˜¯whereä¹‹åçš„æ¡ä»¶æ²¡æœ‰ç´¢å¼•æˆ–è€…æ— æ³•ä½¿ç”¨ç´¢å¼•çš„Cardinalityè¿›è¡Œä¼°ç®—è¿‡æ»¤ï¼Œé‚£é€‰æ‹©é©±åŠ¨è¡¨çš„æ—¶å€™å°±éœ€è¦æ‰«æå…¨è¡¨è¿‡æ»¤å‡ºç¬¦åˆwhereæ¡ä»¶çš„æ•°æ®ï¼Œç„¶åæ¯ä¸ªè¡¨æ¯”è¾ƒç¬¦åˆçš„æ•°æ®é‡å¤§å°ï¼Œä¹‹åé€‰å‡ºé©±åŠ¨è¡¨å—ï¼Ÿ è¿˜æ˜¯è¯´æœ‰å…¶ä»–çš„è®¡ç®—æ–¹æ³•ã€‚
2ã€å¦‚æœwhereåé¢åŒæ—¶å­˜åœ¨ä¸€ä¸ªè¡¨çš„ç´¢å¼•å­—æ®µæ¡ä»¶å’Œéç´¢å¼•å­—æ®µæ¡ä»¶ï¼Œéœ€è¦ç´¢å¼•å­—æ®µè¿‡æ»¤ä¹‹å å†è¿‡æ»¤éç´¢å¼•å­—æ®µçš„æ¡ä»¶å—ï¼Ÿ</p>2024-10-17</li><br/>
</ul>