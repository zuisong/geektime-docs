ä½ å¥½ï¼Œæˆ‘æ˜¯ä¿Šè¾¾ã€‚è¿™èŠ‚è¯¾æˆ‘ä»¬ç»§ç»­çœ‹å‰©ä¸‹çš„å‡ ä¸ªæ¡ˆä¾‹ã€‚

## æ¡ˆä¾‹ä¸ƒï¼šä¼˜åŒ–oræŸ¥è¯¢çš„å¦ä¸€ä¸ªä¾‹å­

ä¸‹é¢æ˜¯å¦ä¸€ä¸ªåœ¨whereä¸­ä½¿ç”¨äº†orçš„ä¾‹å­ï¼Œè¿™ä¸ªSQLçš„æ€§èƒ½éå¸¸å·®ï¼Œéœ€è¦å°†3ä¸ªè¡¨çš„æ•°æ®å…¨éƒ¨å…³è”èµ·æ¥ã€‚

```plain
SELECT t_msg.msg_idï¼Œt_msg.content , ......
FROM t_msg 
    LEFT JOIN t_user ON t_msg.user_id = t_user.user_id  
    LEFT JOIN t_group ON t_msg.group_id = t_group.group_id
WHERE t_msg.gmt_modified >= date_sub('2018-05-20 09:31:45', INTERVAL 30 SECOND)  
OR t_user.gmt_modified >= date_sub('2018-05-20 09:31:45', INTERVAL 30 SECOND)  
OR t_group.gmt_modified >= date_sub('2018-05-20 09:31:45', INTERVAL 30 SECOND)
```

ä¸šåŠ¡çš„éœ€æ±‚ï¼Œæ˜¯æŸ¥è¯¢æœ€è¿‘åŠåˆ†é’Ÿå†…å‘ç”Ÿè¿‡å˜åŒ–çš„æ•°æ®ã€‚è¿™ä¸ªSQLçš„whereæ¡ä»¶ä¸­ï¼Œç”¨åˆ°äº†3ä¸ªè¡¨çš„gmt\_modifiedå­—æ®µæ¥è¿‡æ»¤æ•°æ®ï¼Œè€Œä¸”è¿™äº›æ¡ä»¶ä½¿ç”¨orç›¸è¿ã€‚çœ‹ä¸€ä¸‹ä¸‹é¢çš„ç¤ºæ„å›¾ï¼Œä¸šåŠ¡å…³å¿ƒçš„æ˜¯æ–°æ•°æ®ï¼Œæ¯ä¸ªè¡¨ä¸­ï¼Œæœ€è¿‘ä¿®æ”¹è¿‡çš„æ•°æ®éƒ½åªå äº†æ•´ä¸ªè¡¨æ•°æ®çš„ä¸€å°éƒ¨åˆ†ã€‚è€Œä¸”t\_userã€t\_groupè¡¨çš„æ•°æ®å¾ˆå°‘æ›´æ–°ã€‚ä½†ç”±äºSQLçš„å†™æ³•ï¼Œæ¯æ¬¡éƒ½éœ€è¦è¿æ¥å…¨é‡çš„æ•°æ®ï¼Œç„¶åå†è¿‡æ»¤å‡ºä¸€å°éƒ¨åˆ†æ•°æ®ï¼Œå› æ­¤SQLçš„æ•ˆç‡å¾ˆä½ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/c0/43/c0a2ayy449a7093714ff7102f920b743.jpg?wh=1470x564)

æˆ‘ä»¬å°†SQLæ‹†åˆ†æˆ3ä¸ªéƒ¨åˆ†ã€‚

- SQLç‰‡æ®µ1

```plain
SELECT t_msg.msg_idï¼Œt_msg.content , ......
FROM t_msg 
    LEFT JOIN t_user ON t_msg.user_id = t_user.user_id  
    LEFT JOIN t_group ON t_msg.group_id = t_group.group_id
WHERE t_msg.gmt_modified >= date_sub('2018-05-20 09:31:45', INTERVAL 30 SECOND)  
```

SQLç‰‡æ®µ1ä»¥t\_msgè¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼Œå…ˆè¿‡æ»¤å‡ºè¡¨ä¸­gmt\_modifiedåœ¨åŠåˆ†é’Ÿä¹‹å†…çš„æ•°æ®ï¼Œç„¶åå†å»è¿æ¥t\_userå’Œt\_groupè¡¨ï¼Œå¤§å¤§å‡å°‘äº†è¿æ¥çš„æ•°æ®ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/f3/31/f3c4yy06a6a611f2425c718937858a31.jpg?wh=1458x568)

- SQLç‰‡æ®µ2

```plain
SELECT t_msg.msg_idï¼Œt_msg.content , ......
FROM t_msg 
    LEFT JOIN t_user ON t_msg.user_id = t_user.user_id  
    LEFT JOIN t_group ON t_msg.group_id = t_group.group_id
WHERE t_user.gmt_modified >= date_sub('2018-04-29 09:31:44', INTERVAL 30 SECOND)
```

SQLç‰‡æ®µ2ä¸­ï¼Œå¯¹t\_userè¡¨çš„left joinç­‰ä»·äºæ™®é€šjoinã€‚ä»¥t\_userè¡¨ä¸ºé©±åŠ¨è¡¨ï¼Œå…ˆè¿‡æ»¤t\_userè¡¨æœ€è¿‘ä¿®æ”¹è¿‡çš„æ•°æ®ï¼Œå†å»è¿æ¥t\_msgå’Œt\_groupè¡¨ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/87/64/87f233fee5a4609802afd00db65aa464.jpg?wh=1486x608)

- SQLç‰‡æ®µ3

```plain
SELECT t_msg.msg_idï¼Œt_msg.content , ......
FROM t_msg 
    LEFT JOIN t_user ON t_msg.user_id = t_user.user_id  
    LEFT JOIN t_group ON t_msg.group_id = t_group.group_id
WHERE t_group.gmt_modified >= date_sub('2018-04-29 09:31:44', INTERVAL 30 SECOND)
```

SQLç‰‡æ®µ3ä¸­ï¼Œå¯¹t\_groupè¡¨çš„left joinç­‰ä»·äºæ™®é€šjoinã€‚ä»¥t\_groupè¡¨ä¸ºé©±åŠ¨è¡¨ï¼Œå…ˆè¿‡æ»¤t\_groupè¡¨æœ€è¿‘ä¿®æ”¹è¿‡çš„æ•°æ®ï¼Œå†å»è¿æ¥t\_msgå’Œt\_userè¡¨ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/ee/68/eee9ae458224de2a85867b0f98236668.jpg?wh=1458x568)

å°†SQLæ‹†åˆ†æˆ3ä¸ªéƒ¨åˆ†åï¼Œä¼˜åŒ–å™¨å¯ä»¥å¯¹è¿™3ä¸ªSQLç‰‡æ®µåˆ†åˆ«ä¼˜åŒ–ï¼Œé€‰å–ä¸åŒçš„è¡¨å…³è”é¡ºåºã€‚åœ¨è¿™ä¸ªä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œç”±äºt\_userå’Œt\_groupè¡¨çš„æ•°æ®å¾ˆå°‘æœ‰å˜åŒ–ï¼Œå› æ­¤SQLç‰‡æ®µ2å’ŒSQLç‰‡æ®µ3å¤§éƒ¨åˆ†æ—¶é—´æ²¡æœ‰æ•°æ®è¿”å›ã€‚

SQLçš„å†™æ³•çµæ´»ï¼Œä½†æ˜¯åœ¨æœ‰äº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æ‹†åˆ†SQLï¼Œä½¿ä¼˜åŒ–å™¨å¯ä»¥é€‰æ‹©åˆ°æ›´å¥½çš„æ‰§è¡Œè®¡åˆ’ã€‚

## æ¡ˆä¾‹å…«ï¼šexistså­æŸ¥è¯¢ä¼˜åŒ–ä¸€ä¾‹

ä¸‹é¢æ˜¯ä¸€ä¸ªå¸¦äº†existså­æŸ¥è¯¢çš„SQLï¼Œå½“æ—¶è¿™ä¸ªSQLæ‰§è¡Œéœ€è¦120ç§’ã€‚

```plain
SELECT u.id userId, u.mobile, u.created_date createdDate 
FROM `user` u
    LEFT JOIN user_cash_detail ucd ON u.id= ucd.user_id
WHERE 1=1
AND EXISTS( 
    SELECT 1 
    FROM borrow b 
    WHERE b.user_id= u.id 
    AND b.borrow_no LIKE '202001011212XXX%') 
ORDER BY u.id limit 13;
```

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ‰§è¡Œè®¡åˆ’ï¼Œè¦æ‰«æçš„è®°å½•æ•°å¥½åƒï¼ˆrows 13ï¼‰å¾ˆå°‘ï¼Œè¿æ¥çš„å‡ ä¸ªè¡¨ä¹Ÿéƒ½æœ‰ç´¢å¼•ï¼Œç´¢å¼•çš„è¿‡æ»¤æ€§ä¹Ÿéƒ½å¾ˆå¥½ï¼ˆrows=1ï¼‰ã€‚è¿™ä¸ªSQLæ€§èƒ½åº”è¯¥æ˜¯æ¯”è¾ƒå¥½çš„ï¼Œä¸ºä»€ä¹ˆæ‰§è¡Œéœ€è¦120s çš„æ—¶é—´å‘¢ï¼Ÿ

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/a2/dd/a2e99857b7ab7f1648b9ee1784b6d8dd.png?wh=1806x304)

æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™ä¸ªSQLçš„æ‰§è¡Œè¿‡ç¨‹ï¼šå…ˆæ‰§è¡Œä¸»æŸ¥è¯¢ï¼Œä»userè¡¨è·å–ä¸€è¡Œè®°å½•ï¼Œå†æ‰§è¡Œexistsé‡Œçš„å­æŸ¥è¯¢ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰åŒ¹é…çš„è®°å½•ã€‚å¦‚æœåŒ¹é…äº†ï¼Œæ£€æŸ¥å·²ç»è·å–åˆ°çš„è®°å½•æ•°æ˜¯å¦å·²ç»è¾¾åˆ°limitçš„è¦æ±‚ã€‚å¦‚æœæ²¡åŒ¹é…ï¼Œé‚£ä¹ˆä»userè¡¨è·å–ä¸‹ä¸€è¡Œè®°å½•ï¼Œç»§ç»­è¿™ä¸ªè¿‡ç¨‹ã€‚å¦‚æœä¸»è¡¨çš„è®°å½•æ•°æ¯”è¾ƒå¤§ï¼Œè€Œä¸”åœ¨æ‰§è¡Œexistså­æŸ¥è¯¢æ—¶ä¸€ç›´æ²¡æœ‰åŒ¹é…åˆ°è®°å½•ï¼Œé‚£ä¹ˆæ•´ä¸ªæŸ¥è¯¢çš„æ‰§è¡Œæ—¶é—´å°±ä¼šæ¯”è¾ƒé•¿ã€‚

ä¸Šä¸€è®²ä¸­ï¼Œæˆ‘ä»¬æåˆ°äº†ï¼Œä»5.6å¼€å§‹ï¼ŒMySQLä¼šè‡ªåŠ¨å°†å­æŸ¥è¯¢è½¬æ¢ä¸ºåŠè¿æ¥ã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆè¿™ä¸ªSQLæ²¡æœ‰è¢«è½¬åŒ–ä¸ºåŠè¿æ¥å‘¢ï¼Ÿ

åŸå› æ˜¯8.0ä¹‹å‰çš„ç‰ˆæœ¬ï¼ŒMySQLè¿˜ä¸æ”¯æŒè½¬æ¢existså­æŸ¥è¯¢ã€‚åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œexistså­æŸ¥è¯¢ä¸­æœ‰ä¸€ä¸ªb.borrow\_noçš„æ¡ä»¶ï¼Œçœ‹èµ·æ¥è¿‡æ»¤æ€§æ¯”è¾ƒé«˜ï¼Œå› æ­¤æˆ‘ä»¬æ‰‹åŠ¨æ”¹å†™äº†SQLã€‚åŸå§‹SQLä¸­çš„LEFT JOIN user\_cash\_detailå®é™…ä¸Šæ˜¯å¤šä½™çš„ï¼ŒSQLæ”¹å†™ä¸ºè¿™ä¸ªæ ·å­ã€‚

```plain
SELECT distinct u.id userId, u.mobile, u.created_date createdDate  
FROM borrow b 
join `user` u on b.user_id= u.id 
where b.borrow_no LIKE '202001011212XXX%' 
order by u.id limit 13
```

æ”¹å†™åï¼ŒSQLçš„æ‰§è¡Œæ—¶é—´ä»120ç§’é™åˆ°äº†3æ¯«ç§’ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/9f/16/9fb4f250c0e0884dab71fce5d15b7616.png?wh=1736x262)

å°†existså­æŸ¥è¯¢æ”¹å†™ä¸ºå¸¸è§„çš„è¡¨å…³è”ï¼Œæœ‰å‡ ä¸ªåœ°æ–¹è¦æ³¨æ„ã€‚

1. åŸå§‹SQLä¸­å¹¶æ²¡æœ‰ä½¿ç”¨åˆ°user\_cash\_detailè¡¨ï¼Œå¯ä»¥å°†left joinå»æ‰ã€‚
2. Exists æ”¹æˆjoinåï¼Œç”±äºborrowè¡¨user\_idä¸å”¯ä¸€ï¼Œå¯èƒ½ä¼šæœ‰é‡å¤æ•°æ®å‡ºç°ï¼Œéœ€è¦æ·»åŠ distinctå»é‡ã€‚

æˆ‘ä»¬åœ¨SQLä¼˜åŒ–çš„æ—¶å€™ï¼Œä¸€ä¸ªåŸºæœ¬æ€æƒ³æ˜¯**å°½æ—©è¿‡æ»¤æ‰å°½å¯èƒ½å¤šçš„æ•°æ®**ã€‚è¿™ä¸ªä¾‹å­ä¸­ï¼Œå…ˆæ‰§è¡Œexistsä¸­çš„å­æŸ¥è¯¢å¯ä»¥æå‰è¿‡æ»¤æ‰å¤§é‡æ•°æ®ã€‚

å¯¹äºè¿™ä¸ªæ¡ˆä¾‹ä¸­çš„SQLï¼Œå¦‚æœä½¿ç”¨äº†8.0ï¼Œå°±ä¸å†éœ€è¦æ‰‹åŠ¨æ”¹å†™äº†ã€‚æˆ‘ä»¬æ¥æ„é€ ä¸€äº›æµ‹è¯•æ•°æ®éªŒè¯ä¸€ä¸‹ã€‚å…ˆåˆ›å»ºSQLä¸­çš„æµ‹è¯•è¡¨ï¼Œå†™å…¥ä¸€äº›æ•°æ®ã€‚

```plain
create table user (
	id int not null auto_increment,
	mobile varchar(20),
	created_date datetime,
	padding varchar(2000),
	primary key(id)
) engine=innodb;

create table user_cash_detail(
	id int not null auto_increment,
	user_id int not null,
	padding varchar(2000),
	primary key(id),
	key idx_userid(user_id)
) engine=innodb;

create table borrow(
	id int not null auto_increment,
	user_id int not null,
	borrow_no varchar(30),
	padding varchar(2000),
	primary key(id),
	key idx_user_id(user_id),
	key idx_borrowno(borrow_no)
) engine=innodb;


insert into user(id, mobile, created_date, padding)
select 1000000 + n, 13500000000 + n, date_add('2024-01-01 00:00:00', interval n hour), rpad('', 1000, 'abcd ')
from numbers;

insert into user_cash_detail(user_id, padding)
select 1000000 + n, rpad('', 1000, 'abcd ')
from numbers;

insert into borrow(user_id, borrow_no, padding)
select 1000000 + n - n % 2,  date_format(date_add('2019-06-01 00:00:00', interval n hour), '%Y%m%d%H%i%s'), rpad('', 1000, 'abcd ')
from numbers;
```

åœ¨8.0ä¸­ï¼Œè¿™ä¸ªSQLè‡ªåŠ¨è½¬æ¢æˆäº†åŠè¿æ¥ã€‚

```plain
explain> SELECT u.id userId, u.mobile, u.created_date createdDate 
FROM user u
    LEFT JOIN user_cash_detail ucd ON u.id= ucd.user_id
WHERE 1= 1
AND EXISTS( 
    SELECT 1 
    FROM borrow b 
    WHERE b.user_id= u.id 
    AND b.borrow_no LIKE '202007201%') 
ORDER BY u.id limit 13;

+----+--------------+-------------+--------+--------------------------+--------------+---------+---------------------+------+----------+---------------------------------+
| id | select_type  | table       | type   | possible_keys            | key          | key_len | ref                 | rows | filtered | Extra                           |
+----+--------------+-------------+--------+--------------------------+--------------+---------+---------------------+------+----------+---------------------------------+
|  1 | SIMPLE       | <subquery2> | ALL    | NULL                     | NULL         | NULL    | NULL                | NULL |   100.00 | Using temporary; Using filesort |
|  1 | SIMPLE       | u           | eq_ref | PRIMARY                  | PRIMARY      | 4       | <subquery2>.user_id |    1 |   100.00 | NULL                            |
|  1 | SIMPLE       | ucd         | ref    | idx_userid               | idx_userid   | 4       | <subquery2>.user_id |    1 |   100.00 | Using where; Using index        |
|  2 | MATERIALIZED | b           | range  | idx_user_id,idx_borrowno | idx_borrowno | 123     | NULL                |   10 |   100.00 | Using index condition           |
+----+--------------+-------------+--------+--------------------------+--------------+---------+---------------------+------+----------+---------------------------------+
```

## æ¡ˆä¾‹ä¹ï¼šrangeå’Œref

ä¼˜åŒ–å™¨åœ¨è®¡ç®—REFå’ŒRangeçš„è®¿é—®æˆæœ¬æ—¶ï¼Œä½¿ç”¨äº†ä¸åŒçš„å…¬å¼ã€‚åœ¨æœ‰äº›æƒ…å†µä¸‹ï¼Œä½¿ç”¨åŒä¸€ä¸ªç´¢å¼•ï¼Œè™½ç„¶rangeä½¿ç”¨äº†æ›´å¤šçš„ç´¢å¼•å­—æ®µï¼Œä½†æ˜¯æˆæœ¬æ¯”REFé«˜ï¼Œæœ‰æ—¶Rangeçš„æˆæœ¬æ¯”å…¨è¡¨æ‰«æè¿˜è¦é«˜ï¼Œæ­¤æ—¶ä¼˜åŒ–å™¨ä¼šä½¿ç”¨REFè®¿é—®è·¯å¾„ï¼Œè€Œä¸æ˜¯æ•ˆç‡æ›´é«˜çš„Rangeã€‚

ä¸‹é¢çš„è¿™ä¸ªä¾‹å­å°±æ˜¯è¿™ç§æƒ…å†µã€‚è¿™æ˜¯åœ¨5.6ç‰ˆæœ¬ä¸­é‡åˆ°çš„é—®é¢˜ã€‚å…ˆåˆ›å»ºä¸€ä¸ªè¡¨ï¼Œå†™å…¥ä¸€äº›æ¨¡æ‹Ÿæ•°æ®ã€‚

```plain
mysql> create table mysql_stat(
    id int not null auto_increment,
    tenant_id int not null,
    instance_name varchar(30) not null,
    check_time datetime not null,
    padding varchar(200),
    primary key(id),
    key idx_tenantid_instname_checktime(tenant_id, instance_name, check_time)
  ) engine=innodb;


mysql> insert into mysql_stat(tenant_id, instance_name, check_time, padding)
select 1, 'dtstack-dev1:3306', 
  date_add('2024-01-01 00:00:00', interval n * 10 second) as check_time,
  rpad('x', 100, 'abcd ')
from numbers_1m

mysql> select min(check_time), max(check_time) from  mysql_stat;
+---------------------+---------------------+
| min(check_time)     | max(check_time)     |
+---------------------+---------------------+
| 2024-01-01 00:00:00 | 2024-04-25 17:46:30 |
+---------------------+---------------------+
```

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªSQLçš„æ‰§è¡Œè®¡åˆ’ï¼Œtypeä¸ºrefï¼Œåªç”¨åˆ°äº†tenant\_idå’Œinstance\_nameçš„ç´¢å¼•æ¡ä»¶ã€‚

```plain
mysql> explain SELECT * 
FROM mysql_stat  
WHERE tenant_id = 1 
  and instance_name='dtstack-dev1:3306' 
  and check_time >='2024-02-01' and check_time <= '2024-03-01' 
ORDER BY check_time desc limit 1\G

*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: mysql_stat
         type: ref
possible_keys: idx_tenantid_instname_checktime
          key: idx_tenantid_instname_checktime
      key_len: 36
          ref: const,const
         rows: 468284
        Extra: Using where
```

check\_timeå­—æ®µä¸Šçš„æ¡ä»¶ï¼Œæœ¬æ¥ä¹Ÿå¯ä»¥ç”¨æ¥è¿‡æ»¤æ•°æ®ï¼Œä½†æ˜¯ä¼˜åŒ–å™¨å´æ²¡æœ‰ä½¿ç”¨ã€‚åœ¨æˆ‘çš„æµ‹è¯•ç¯å¢ƒä¸­ï¼Œè¿™ä¸ªSQLè€—æ—¶1ç§’å¤šã€‚ä»æ…¢æ—¥å¿—ä¸­ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°SQLæ‰«æäº†48ä¸‡è¡Œæ•°æ®ã€‚

```plain
# Query_time: 1.245558  Lock_time: 0.000281 Rows_sent: 1  Rows_examined: 481600
SET timestamp=1725604597;
SELECT *
FROM mysql_stat
WHERE tenant_id = 1
  and instance_name='dtstack-dev1:3306'
  and check_time >='2024-02-01' and check_time <= '2024-03-01'
ORDER BY check_time desc limit 1;
```

æˆ‘ä»¬ç»™è¿™ä¸ªSQLåŠ ä¸Šä¸€ä¸ªforce indexæç¤ºã€‚

```plain
mysql> explain SELECT * 
FROM mysql_stat  force index(idx_tenantid_instname_checktime)
WHERE tenant_id = 1 
  and instance_name='dtstack-dev1:3306' 
  and check_time >='2024-02-01' and check_time <= '2024-03-01'
ORDER BY check_time desc limit 1\G

*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: mysql_stat
         type: range
possible_keys: idx_tenantid_instname_checktime
          key: idx_tenantid_instname_checktime
      key_len: 41
          ref: NULL
         rows: 468284
        Extra: Using index condition
```

åŠ ä¸Šforce indexä¹‹åï¼Œæ‰§è¡Œè®¡åˆ’typeå˜æˆäº†rangeã€‚è§‚å¯Ÿæ…¢æ—¥å¿—ï¼ŒSQLåªæ‰«æäº†1è¡Œæ•°æ®ï¼Œæ‰§è¡Œæ—¶é—´ä¸åˆ°1æ¯«ç§’ã€‚

```plain
# Query_time: 0.000468  Lock_time: 0.000162 Rows_sent: 1  Rows_examined: 1
SET timestamp=1725604885;
SELECT *
FROM mysql_stat  force index(idx_tenantid_instname_checktime)
WHERE tenant_id = 1
  and instance_name='dtstack-dev1:3306'
  and check_time >='2024-02-01' and check_time <= '2024-03-01'
ORDER BY check_time desc limit 1;
```

ä»optimizer traceä¸­å¯ä»¥çœ‹åˆ°ï¼ŒåŠ äº†force indexåï¼Œrefçš„æˆæœ¬è¿˜æ˜¯æ¯”rangeä½ã€‚

```plain
"considered_execution_plans": [
  {
    "plan_prefix": [
    ],
    "table": "`mysql_stat` FORCE INDEX (`idx_tenantid_instname_checktime`)",
    "best_access_path": {
      "considered_access_paths": [
        {
          "access_type": "ref",
          "index": "idx_tenantid_instname_checktime",
          "rows": 468284,
          "cost": 123354,
          "chosen": true
        },
        {
          "access_type": "range",
          "rows": 351213,
          "cost": 655599,
          "chosen": false
        }
      ]
    },
    "cost_for_plan": 123354,
    "rows_for_plan": 468284,
    "chosen": true
  }
]
```

ä½†æ˜¯ä¼˜åŒ–å™¨æœ€ç»ˆè¿˜æ˜¯é€‰æ‹©äº†rangeï¼Œå› ä¸ºrangeèƒ½ç”¨åˆ°æ›´å¤šçš„ç´¢å¼•å­—æ®µã€‚

```plain
"attached_conditions_computation": [
  {
    "access_type_changed": {
      "table": "`mysql_stat` FORCE INDEX (`idx_tenantid_instname_checktime`)",
      "index": "idx_tenantid_instname_checktime",
      "old_type": "ref",
      "new_type": "range",
      "cause": "uses_more_keyparts"
    }
  }
]
```

ä¸Šé¢çš„è¿™ä¸ªSQLï¼Œåœ¨5.7å’Œ8.0çš„ç¯å¢ƒä¸­ï¼Œä¸éœ€è¦åŠ force indexï¼Œä¹Ÿä¼šä½¿ç”¨æ•ˆç‡æ›´é«˜çš„rangeè®¿é—®è·¯å¾„ã€‚æœ‰å…´è¶£çš„è¯ï¼Œä½ å¯ä»¥è‡ªå·±æµ‹è¯•ä¸€ä¸‹ï¼Œä½¿ç”¨ä¼˜åŒ–å™¨è·Ÿè¸ªå¯¹æ¯”ä¸€ä¸‹åŒºåˆ«ã€‚

## æ¡ˆä¾‹åï¼šinå‚æ•°åˆ—è¡¨è¿‡é•¿å¯¼è‡´çš„å…¨è¡¨æ‰«æ

è¿™æ˜¯ä¸€ä¸ªåœ¨MySQL 5.6ä¸­é‡åˆ°çš„æ€§èƒ½é—®é¢˜ã€‚æˆ‘ä»¬æ¥çœ‹è¿™ä¸ªå•è¡¨æŸ¥è¯¢çš„SQLã€‚è¡¨é‡Œæœ‰å‡ åƒä¸‡è¡Œæ•°æ®ã€‚

```plain
SELECT *
FROM t_exp t
WHERE t.link_id in (x,x,x, ......)
and t.com_id = xx
and t.expense in (x,x,x)
and t.link_type= 1 
and ledger_status= 1 
AND status = 1
```

è¡¨ä¸Šæœ‰ä¸€ä¸ªå”¯ä¸€ç´¢å¼•ã€‚whereæ¡ä»¶ä¸­ï¼Œlink\_idã€com\_idã€expense, link\_typeè¿™å‡ ä¸ªå­—æ®µæ˜¯ç´¢å¼•çš„å‰ç¼€ã€‚

```plain
UNIQUE KEY uk (
  link_id,
  com_id,
  expense,
  link_type,
  link_com_id,
  trans_batch_id,
  status)
```

ç†è®ºä¸Šè¿™ä¸ªSQLæ˜¯å¯ä»¥ç”¨ä¸Šè¿™ä¸ªç´¢å¼•çš„ï¼Œä½†æ˜¯SQLå´ä½¿ç”¨äº†å…¨è¡¨æ‰«æã€‚è€Œä¸”å³ä½¿åŠ ä¸Šforce indexæç¤ºï¼Œè¿˜æ˜¯å…¨è¡¨æ‰«æã€‚

SQLä¸­link\_idä¼ å…¥äº†å‡ ä¸‡ä¸ªï¼Œæˆ‘å°è¯•ç€å‡å°‘link\_idçš„ä¸ªæ•°ï¼Œå½“æ•°é‡å°‘äºæŸä¸ªä¸´ç•Œå€¼æ—¶ï¼Œå°±å¯ä»¥ç”¨ä¸Šç´¢å¼•äº†ï¼ŒæŸ¥è¯¢çš„æ€§èƒ½ä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆå½“INåˆ—è¡¨ä¸­çš„å‚æ•°å¤šä¸€ç‚¹æ—¶ï¼Œå°±ä½¿ç”¨å…¨è¡¨æ‰«æäº†å‘¢ï¼Ÿ

æˆ‘ä»¬æ¥å¯¹æ¯”ä¸‹è¿™ä¸¤ç§æƒ…å†µä¸‹çš„ä¼˜åŒ–å™¨è·Ÿè¸ªä¿¡æ¯ã€‚

- ä½¿ç”¨å…¨è¡¨æ‰«ææ—¶çš„è·Ÿè¸ªä¿¡æ¯

å½“INä¼ å…¥çš„å‚æ•°è¶…è¿‡ä¸€å®šçš„ä¸ªæ•°åï¼Œä¼˜åŒ–å™¨åªè€ƒè™‘äº†å…¨è¡¨æ‰«æã€‚ä»considered\_execution\_plansä¸­å¯ä»¥çœ‹å‡ºè¿™ä¸€ç‚¹ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/99/d4/997f695c15fe43546a8c867e6a8ddbd4.png?wh=884x800)

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/75/4b/756d79ec6de5ac7f25e4e5f585b8004b.png?wh=684x698)

- ä½¿ç”¨ç´¢å¼•æ—¶çš„è·Ÿè¸ªä¿¡æ¯

å°†INçš„å‚æ•°å‡å°‘åˆ°æŸä¸ªä¸´ç•Œå€¼ä¹‹åï¼Œä¼˜åŒ–å™¨è€ƒè™‘äº†rangeè®¿é—®è·¯å¾„ï¼Œå¹¶ä¸”åŸºäºæˆæœ¬ï¼Œé€‰æ‹©äº†rangeæ‰§è¡Œè®¡åˆ’ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/80/c4/8001e3be24849ddd22032fcf46f998c4.png?wh=1820x690)  
![å›¾ç‰‡](https://static001.geekbang.org/resource/image/e3/c5/e33a4bca4d29f4946e1cca5d77dc40c5.png?wh=872x798)  
![å›¾ç‰‡](https://static001.geekbang.org/resource/image/22/17/220a5545364818d9c76581d10f1d4217.png?wh=692x706)

å½“inæ¡ä»¶ä¸­çš„å€¼è¶…è¿‡ä¸€å®šæ•°é‡æ—¶ï¼Œä¼˜åŒ–å™¨ä¼šæ”¾å¼ƒä½¿ç”¨rangeæ‰§è¡Œè®¡åˆ’ã€‚åŸå› æ˜¯MySQLé™åˆ¶äº†ç”Ÿæˆrangeæ‰§è¡Œè®¡åˆ’æ—¶ä½¿ç”¨çš„å†…å­˜ï¼Œå½“INå‚æ•°åˆ—è¡¨å¤ªé•¿æ—¶ï¼Œæ¶ˆè€—çš„å†…å­˜å¤ªå¤šï¼Œè¶…å‡ºäº†é™åˆ¶ï¼Œå› æ­¤æ”¾å¼ƒä½¿ç”¨rangeæ‰§è¡Œè®¡åˆ’ï¼Œæœ€ç»ˆä½¿ç”¨äº†å…¨è¡¨æ‰«æã€‚MySQL 5.6ä¸­ï¼Œrangeä¼˜åŒ–å†…å­˜çš„ä¸Šé™æ˜¯å›ºå®šçš„ã€‚MySQL 5.7å¼•å…¥äº†å‚æ•°range\_optimizer\_max\_mem\_sizeï¼Œæˆ‘ä»¬å¯ä»¥è°ƒæ•´è¿™ä¸ªå‚æ•°æ¥è§£å†³inå‚æ•°åˆ—è¡¨è¿‡é•¿æ— æ³•ä½¿ç”¨ç´¢å¼•çš„é—®é¢˜ã€‚å®é™…ä¸Šï¼Œåœ¨5.7ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœinå‚æ•°åˆ—è¡¨è¿‡é•¿å¯¼è‡´æ— æ³•ä½¿ç”¨rangeä¼˜åŒ–ï¼Œä¼šæœ‰è¿™æ ·çš„warningä¿¡æ¯ã€‚

```plain
Warning    3170    Memory capacity of N bytes for
                   'range_optimizer_max_mem_size' exceeded. Range
                   optimization was not done for this query.
```

æ ¹æ®å®˜æ–¹æ–‡æ¡£çš„æè¿°ï¼Œæ¯ä¸ªORæ¡ä»¶ä½¿ç”¨230å­—èŠ‚ï¼Œæ¯ä¸ªANDæ¡ä»¶ä½¿ç”¨125å­—èŠ‚ï¼Œå•ä¸ªå­—æ®µä¸Šçš„INæ¡ä»¶ï¼Œä¼šè½¬æ¢æˆORã€‚å¤šä¸ªå­—æ®µä½¿ç”¨INï¼Œä¼šä»¥ç»„åˆå½¢å¼å±•å¼€ï¼Œæ¯”å¦‚ c1 in (a,b) and c2 in (x,y,z)ä¼šè½¬æ¢æˆ (c1 = a and c2 = x) or (c1 = a and c2=y) or ( c1=a and c2=z) or (c1 = b and c2 = x) or (c1 = b and c2=y) or ( c1=b and c2=z) ã€‚

æˆ‘ä»¬æ¡ˆä¾‹ä¸­çš„SQLï¼Œæœ‰2ä¸ªinæ¡ä»¶ä¼šåœ¨rangeä¼˜åŒ–æ—¶å±•å¼€ã€‚

```plain
SELECT *
FROM t_exp t
WHERE t.link_id in (x,x,x,â€¦)
and t.com_id = xx
and t.expense in (x,x,x)
and t.link_type= 1 
and ledger_status= 1 
AND status = 1
```

æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿä¸€ä¸ªæ–¹æ³•æ˜¯å‡å°‘INé‡Œé¢ä¼ å…¥çš„å‚æ•°ä¸ªæ•°ï¼Œä½†è¿™éœ€è¦ä¿®æ”¹ä»£ç ã€‚æ‰€ä»¥å½“æ—¶æˆ‘é‡‡ç”¨å¦å¤–ä¸€ç§æ–¹æ³•ï¼Œè°ƒæ•´ç´¢å¼•å­—æ®µé¡ºåºï¼Œå°†expenseå­—æ®µè°ƒæ•´åˆ°äº†link\_com\_idä¹‹åã€‚å› ä¸ºSQLç¼ºå°‘link\_com\_idçš„æ¡ä»¶ï¼Œè°ƒæ•´ç´¢å¼•å­—æ®µé¡ºåºåï¼Œåªéœ€è¦å±•å¼€link\_idï¼Œè€Œä¸æ˜¯link\_idå’Œexpenseçš„ç»„åˆï¼Œè¿™æ ·SQLå°±ç”¨ä¸Šäº†ç´¢å¼•ã€‚

```plain
UNIQUE KEY uk_new (
  link_id,
  com_id,
  link_type,
  link_com_id,
  expense, 
  trans_batch_id,
  status)
```

## æ¡ˆä¾‹åä¸€ï¼šæ•°æ®å€¾æ–œå¼•èµ·çš„æ€§èƒ½é—®é¢˜

ä¸‹é¢è¿™ä¸ªSQLæ˜¯åœ¨ä¸€ä¸ªç³»ç»Ÿå‹æµ‹æ—¶å‘ç°çš„ã€‚

```plain
select *
FROM trans_001 a LEFT JOIN purchase_001 b 

ON a.serial_no = b.order_no 
AND a.dist_name = b.inst_id 
AND a.alino = b.alino 

WHERE b.order_no IS NULL 
AND a.serial_no >= '201809200000057858291ALI'
AND a.serial_no <= '201809216100342526601ALI' 
AND a.business_code = 'xx' 
AND a.trans_date = '20180921';
```

è¿™æ˜¯ä¸€ä¸ªä¸¤è¡¨è¿æ¥çš„SQLï¼Œå½“æ—¶è¿™ä¸ªSQLæ‰§è¡Œäº†ä¸¤ç™¾å¤šç§’ï¼Œä»æ…¢æ—¥å¿—ä¸­çœ‹åˆ°æ‰«æè¡Œæ•°æœ‰1.1äº¿ã€‚ä¸‹é¢æ˜¯å½“æ—¶è¯Šæ–­æŠ¥å‘Šçš„è¾“å‡ºã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/3b/6d/3b66489b25903a17facc101a80c5a16d.png?wh=964x412)

è¿™ä¸ªç³»ç»Ÿä½¿ç”¨äº†åˆ†åº“åˆ†è¡¨ï¼Œè¿™ä¸¤ä¸ªè¡¨å¤§æ¦‚æœ‰å‡ åä¸‡è¡Œæ•°æ®ã€‚SQLçš„æ‰§è¡Œè®¡åˆ’å¹¶æ²¡æœ‰é—®é¢˜ï¼Œè¿æ¥æ¡ä»¶ä¸­çš„å­—æ®µä¸Šä¹Ÿå»ºç«‹äº†æ­£ç¡®çš„è”åˆç´¢å¼•ã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆæ‰«æè¡Œæ•°ä¼šè¿™ä¹ˆé«˜å‘¢ï¼Ÿä½ æ˜¯ä¸æ˜¯ä¼šæ€€ç–‘æ…¢SQLçš„è¾“å‡ºæœ‰é—®é¢˜ï¼Ÿ

æœ‰ç»éªŒçš„åŒå­¦å¯èƒ½å·²ç»æƒ³åˆ°åŸå› äº†ï¼Œè¿™å…¶å®æ˜¯æ•°æ®å€¾æ–œå¼•èµ·çš„é—®é¢˜ã€‚åˆ†åˆ«æŸ¥çœ‹2ä¸ªè¡¨ä¸­è¿æ¥æ¡ä»¶ä¸Šçš„æ•°æ®åˆ†å¸ƒå°±èƒ½å‘ç°é—®é¢˜ã€‚

```plain
select serial_no, dist_name, alino, count(*)
from trans_001
group by serial_no, dist_name, alino
order by count(*) desc limit 10;

select order_no, inst_id, alino, count(*)
from purchase_001
group by order_no, inst_id, alino
order by count(*) desc limit 10;
```

åªè¦æŸä¸ªç»„åˆæ¡ä»¶ä¸‹çš„è®°å½•æ•°è¶…è¿‡1ä¸‡ï¼Œè¿æ¥æ—¶æ‰«æçš„è®°å½•æ•°å°±ä¼šè¶…è¿‡1äº¿ã€‚æ‰¾åˆ°é—®é¢˜åï¼Œéœ€è¦ä¸šåŠ¡æ–¹æ¥åˆ†æä¸ºä»€ä¹ˆä¼šæœ‰è¿™æ ·çš„æ•°æ®ï¼Œå¹¶è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚

## æ¡ˆä¾‹åäºŒï¼šRange checked for each record

MySQLä¼˜åŒ–å™¨åœ¨è¯„ä¼°ä¸€ä¸ªç´¢å¼•çš„è®¿é—®æ•ˆç‡æ—¶ï¼Œè¦ä¹ˆä½¿ç”¨Index Diveï¼Œè¦ä¹ˆä½¿ç”¨ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯ã€‚åœ¨è¡¨è¿æ¥æ—¶ï¼Œå¦‚æœè¿æ¥æ¡ä»¶æ˜¯ä¸€ä¸ªèŒƒå›´ï¼Œé‚£ä¹ˆå¯¹äºé©±åŠ¨è¡¨ä¸­çš„æ¯ä¸€è¡Œè®°å½•ï¼Œéƒ½éœ€è¦è¿›è¡Œä¸€æ¬¡Index Diveï¼Œæ¥è¯„ä¼°è¢«é©±åŠ¨è¡¨é‡Œæ»¡è¶³æ¡ä»¶çš„è®°å½•æ•°ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰§è¡Œè®¡åˆ’çš„Extra åˆ—ä¸­ä¼šæ˜¾ç¤ºâ€œRange checked for each recordâ€ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªæŸ¥è¯¢æ€§èƒ½ä¸å¥½çš„ä¿¡å·ã€‚

æˆ‘ä»¬æ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ã€‚

```plain
SELECT t1.ppd , (
    SELECT sum(amount) AS total_amount        
    FROM `order`
    WHERE pay_date <= t1.ppd         
    AND pay_date >= date_sub(t1.ppd, INTERVAL 7 DAY)
) AS total_amount
FROM (
    select distinct pay_date as ppd 
    from `order`
    where pay_date is not null
) t1
```

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/1f/yy/1f3c045f96b313fee457f639caa9b0yy.png?wh=1920x432)

è¿™æ ·çš„SQLè¿˜æœ‰ä¼˜åŒ–çš„ç©ºé—´å—ï¼Ÿæˆ‘ä»¬æ¥å°è¯•ä¸€ä¸‹ã€‚å…ˆå‡†å¤‡ä¸€ç‚¹æµ‹è¯•æ•°æ®ã€‚

```plain
create table t_order(
	id int not null auto_increment,
	pay_date date not null,
	amount int not null,
	padding varchar(2000),
	primary key(id),
	key idx_paydate(pay_date)
) engine=innodb;

insert into t_order(pay_date, amount, padding)
select date_add('2023-01-01', interval n % 365 day), 
    2000 + n % 1000, 
    rpad('', 1000, 'abcd ')
from numbers;
```

åœ¨æˆ‘çš„æµ‹è¯•ç¯å¢ƒä¸­ï¼ŒåŸå§‹SQLè€—æ—¶35ç§’ã€‚

```plain
# Query_time: 35.923849  
# Lock_time: 0.000086 
# Rows_sent: 365  
# Rows_examined: 3650365
SELECT t1.ppd , (SELECT sum(amount) AS total_amount        
    FROM t_order
    WHERE pay_date <= t1.ppd         
    AND pay_date >= date_sub(t1.ppd, INTERVAL 7 DAY) ) AS total_amount
FROM (
    select distinct pay_date as ppd 
    from t_order
    where pay_date is not null
) t1;
```

æˆ‘å°è¯•æŠŠSQLæ”¹å†™æˆè¡¨è¿æ¥ï¼Œæ‰§è¡Œæ—¶é—´å‡å°‘äº†ä¸€äº›ã€‚

```plain
# Query_time: 7.566888  
# Lock_time: 0.000050 
# Rows_sent: 365  
# Rows_examined: 365
SELECT t1.ppd, sum(amount) AS leiji_amount
FROM  (select distinct pay_date as ppd 
       from t_order 
       where pay_date is not null) t1
    , t_order t2 
WHERE t1.ppd >= t2. pay_date
    AND t2.pay_date >= date_sub(t1.ppd, INTERVAL 7 DAY)
GROUP BY t1.ppd;
```

å°±è¿™ä¸ªSQLçš„é€»è¾‘ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨MySQL 8.0çš„çª—å£å‡½æ•°ï¼Œè¿™æ ·SQLæ‰§è¡Œåˆæ›´å¿«äº†ä¸€äº›ã€‚

```plain
# Query_time: 0.776545  
# Lock_time: 0.000046 
# Rows_sent: 365  
# Rows_examined: 730
select pay_date, sum(total_amount) over(
    order by pay_date 
    range BETWEEN INTERVAL 7 DAY PRECEDING AND CURRENT ROW)
from (
    select pay_date, sum(amount) as total_amount
    from t_order
    where pay_date is not null
    group by pay_date
) t;
```

è€ƒè™‘åˆ°SQLä¸­åªç”¨åˆ°äº†2ä¸ªå­—æ®µï¼Œæˆ‘ä»¬ç»™è¿™ä¸ªSQLå»ºç«‹ä¸€ä¸ªè”åˆç´¢å¼•ã€‚

```plain
alter table t_order add key idx_paydate_amount(pay_date, amount);
```

è¿™æ ·æ‰§è¡Œçš„é€Ÿåº¦åˆæå‡äº†ä¸€äº›ã€‚

```plain
# Query_time: 0.090399  
# Lock_time: 0.000026 
# Rows_sent: 365  
# Rows_examined: 730
select pay_date, sum(total_amount) over(
    order by pay_date
    range BETWEEN INTERVAL 7 DAY PRECEDING AND CURRENT ROW)
from (
    select pay_date, sum(amount) as total_amount
    from t_order
    where pay_date is not null
    group by pay_date
) t;
```

æˆ‘ä»¬çš„æµ‹è¯•è¡¨é‡Œï¼Œåªå†™å…¥äº†10000è¡Œæ•°æ®ï¼Œå¦‚æœä½ æœ‰å…´è¶£ï¼Œå¯ä»¥å°è¯•å†™å…¥10ä¸‡è¡Œæˆ–100ä¸‡è¡Œæ•°æ®ï¼Œå¯¹æ¯”ä¸‹è¿™å‡ ç§æƒ…å†µä¸‹å‡ ä¸ªSQLçš„è€—æ—¶ã€‚

## æ€»ç»“

SQLä¼˜åŒ–æ˜¯ä¸€é¡¹åŸºæœ¬çš„æŠ€èƒ½ã€‚ä½ éœ€è¦æŒæ¡ç´¢å¼•çš„ç‰¹ç‚¹ï¼Œäº†è§£ä¸åŒè¡¨è¿æ¥ç®—æ³•çš„ç‰¹ç‚¹å’Œé€‚ç”¨åœºæ™¯ï¼Œè¿˜éœ€è¦äº†è§£ä¼˜åŒ–å™¨çš„ä¸€äº›å·¥ä½œåŸç†ã€‚æœ‰çš„æ—¶å€™ä½ å¯èƒ½éœ€è¦æ”¹å†™SQLï¼Œæˆ–è€…ä½¿ç”¨SQLæç¤ºï¼Œæ¥è·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚

è¿™ä¸¤è®²çš„åå‡ ä¸ªä¾‹å­ï¼Œéƒ½æ˜¯ä»çœŸå®çš„ä¸šåŠ¡åœºæ™¯ä¸­æŒ‘é€‰å‡ºæ¥çš„ï¼Œå½“æ—¶ä½¿ç”¨çš„ç‰ˆæœ¬åŒ…æ‹¬5.5ã€5.6ã€5.7ã€‚å¯ä»¥çœ‹åˆ°ï¼Œåœ¨8.0ä¸­ï¼Œæœ‰ä¸€äº›SQLå®é™…ä¸Šä¼˜åŒ–å™¨å·²ç»èƒ½è‡ªåŠ¨ä¼˜åŒ–å¾—æ›´å¥½äº†ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬è¦ä½¿ç”¨æ–°ç‰ˆæœ¬çš„ä¸€ä¸ªé‡è¦çš„åŸå› ã€‚

## æ€è€ƒé¢˜

ä¸‹é¢è¿™ç±»SQLæŒ‰å¤šä¸ªè¡¨çš„å­—æ®µæ¥æ’åºï¼Œè¯·åˆ†æä¸‹è¿™ä¹ˆæ’åºï¼Œå¯¹SQLæ€§èƒ½çš„å½±å“æ˜¯ä»€ä¹ˆï¼Ÿå¦‚æœåªä½¿ç”¨ä¸€ä¸ªè¡¨çš„å­—æ®µæ¥æ’åºï¼Œæ€§èƒ½ä¸Šä¼šæœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿ

```plain
select * 
from t1, t2, t3
where t1.c1 = t2.c1
and t2.c2 = t3.c3
order by t1.s1, t2.s2
limit 100;
```

æœŸå¾…ä½ çš„æ€è€ƒï¼Œæ¬¢è¿åœ¨ç•™è¨€åŒºä¸­ä¸æˆ‘äº¤æµã€‚å¦‚æœä»Šå¤©çš„è¯¾ç¨‹è®©ä½ æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿è½¬å‘ç»™æœ‰éœ€è¦çš„æœ‹å‹ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ1ï¼‰</strong></div><ul>
<li><span>å¶æ˜</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>
1ã€å¯¹ SQL æ€§èƒ½çš„å½±å“ï¼Œt1.s1 å’Œ t2.s2 è¿™ä¸¤ä¸ªå­—æ®µæ¥æºä¸åŒè¡¨ï¼Œå¹¶ä¸”æ²¡æœ‰å…³è”å…³ç³»ï¼Œé©±åŠ¨è¡¨åªæœ‰ä¸€ä¸ªï¼Œå½“å…¶ä¸­ä¸€ä¸ªå­—æ®µæœ‰åºæ—¶ï¼Œæ— æ³•ä¿è¯å¦ä¸€ä¸ªå­—æ®µä¹Ÿæœ‰åºï¼Œå› æ­¤å¿…é¡»ä½¿ç”¨åˆ°ä¸´æ—¶è¡¨å’Œæ–‡ä»¶æ’åºï¼Œå¦å¤–å¦‚æœæ•°æ®é‡è¾ƒå¤§ï¼Œåˆ™è¿˜ä¼šä½¿ç”¨åˆ°æ›´æ…¢çš„ç£ç›˜ä¸´æ—¶è¡¨æ¥å¤„ç†ã€‚
2ã€å¦‚æœåªä½¿ç”¨ä¸€ä¸ªè¡¨çš„å­—æ®µæ¥æ’åºï¼Œæ€§èƒ½ä¸Šä¼šæœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿå¦‚æœè¡¨ä¸Šè¿™ä¸€ä¸ªç”¨æ¥æ’åºçš„å­—æ®µä¸Šæœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆä»¥è¿™ä¸ªè¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼Œä¸€æ¥ä¸ç”¨å»ºç«‹ä¸´æ—¶è¡¨å’Œæ’åºï¼Œåªéœ€è¦æœ‰åºéå†è¿™ä¸ªç´¢å¼•çš„å‰ 100æ¡è®°å½•å°±å¯ä»¥è¿”å›äº†ï¼ŒäºŒæ¥åªç”¨è¿”å› 100 æ¡æ•°æ®ï¼Œå¤§å¤§å‡å°‘äº†æ‰«æè¡Œæ•°</p>2024-10-16</li><br/>
</ul>