ä½ å¥½ï¼Œæˆ‘æ˜¯å—æŸ¯ã€‚

å‰é¢å‡ è®²ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†æ‰©æ•£æ¨¡å‹çš„ç®—æ³•åŸç†å’Œç»„æˆæ¨¡å—ï¼Œå­¦ä¹ äº†Stable Diffusionæ¨¡å‹æ–°å¢çš„CLIPå’ŒVAEæ¨¡å—ã€‚æŒæ¡äº†è¿™äº›çŸ¥è¯†ï¼Œç›¸ä¿¡ä½ ä¹Ÿä¸€å®šè·ƒè·ƒæ¬²è¯•ï¼Œæƒ³è¦è®­ç»ƒä¸€ä¸ªå±äºè‡ªå·±çš„AIç»˜ç”»æ¨¡å‹ã€‚

è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä¼šå°†å‰å‡ è®²çš„çŸ¥è¯†ä¸²è”èµ·æ¥ï¼Œä»å…¨å±€çš„è§†è§’è®¨è®ºæ‰©æ•£æ¨¡å‹å¦‚ä½•è®­ç»ƒå’Œä½¿ç”¨ã€‚æˆ‘ä»¬å°†é€šè¿‡å®æˆ˜çš„å½¢å¼ï¼Œä¸€èµ·è®­ç»ƒä¸€ä¸ªæ ‡å‡†æ‰©æ•£æ¨¡å‹ï¼Œå¹¶å¾®è°ƒä¸€ä¸ªStable Diffusionæ¨¡å‹ï¼Œå¸®ä½ è¿›ä¸€æ­¥åŠ æ·±å¯¹çŸ¥è¯†çš„ç†è§£ã€‚å­¦å®Œè¿™ä¸€è®²ï¼Œæˆ‘ä»¬å°±è¿ˆå‡ºäº†æ¨¡å‹è‡ªç”±çš„å…³é”®ä¸€æ­¥ã€‚

## å…³é”®çŸ¥è¯†ä¸²è”

åœ¨å®æˆ˜ä¹‹å‰ï¼Œæˆ‘æƒ³è¯·ä½ æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šæƒ³è¦æŠŠæ ‡å‡†çš„æ‰©æ•£æ¨¡å‹å‡çº§ä¸ºStable Diffusionï¼Œéœ€è¦å‡ æ­¥æ“ä½œï¼Ÿ

ç­”æ¡ˆæ˜¯ä¸¤æ­¥ã€‚

æˆ‘ä»¬é€šè¿‡[ç¬¬6è®²](https://time.geekbang.org/column/article/681276)å·²ç»çŸ¥é“ï¼Œæ ‡å‡†æ‰©æ•£æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹åŒ…å«6ä¸ªæ­¥éª¤ï¼Œåˆ†åˆ«æ˜¯éšæœºé€‰å–è®­ç»ƒå›¾åƒã€éšæœºé€‰æ‹©æ—¶é—´æ­¥tã€éšæœºç”Ÿæˆé«˜æ–¯å™ªå£°ã€ä¸€æ­¥è®¡ç®—ç¬¬tæ­¥åŠ å™ªå›¾ã€ä½¿ç”¨UNeté¢„æµ‹å™ªå£°å€¼å’Œè®¡ç®—å™ªå£°æ•°å€¼è¯¯å·®ã€‚

Stable Diffusionåœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¢åŠ äº†VAEæ¨¡å—å’ŒCLIPæ¨¡å—ã€‚VAEæ¨¡å—çš„ä½œç”¨æ˜¯é™ä½è¾“å…¥å›¾åƒçš„ç»´åº¦ï¼Œä»è€ŒåŠ å¿«æ¨¡å‹è®­ç»ƒã€ç»™GPUè…¾è…¾åœ°æ–¹ï¼›CLIPæ¨¡å—çš„ä½œç”¨åˆ™æ˜¯å°†æ–‡æœ¬æè¿°é€šè¿‡äº¤å‰æ³¨æ„åŠ›æœºåˆ¶æ³¨å…¥åˆ°UNetæ¨¡å—ï¼Œè®©AIç»˜ç”»æ¨¡å‹åšåˆ°è¨€å‡ºæ³•éšã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ13ï¼‰</strong></div><ul>
<li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep2B3n5OEDVZVjpkJWxyrxTq2ib20qjBBcsAIU3jXhQ5BwlRBPsdZlwOHqdiaJtn7niaLvOz2biaja6pw/132" width="30px"><span>åˆ˜</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>ä½ å¥½ï¼Œæˆ‘æƒ³é—®ä¸‹ï¼Œè¿™é‡Œå¾®è°ƒæ¨¡å‹å’Œè®­ç»ƒloraæ¨¡å‹æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</div>2023-08-27</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Ge7uhlEVxicQT73YuomDPrVKI8UmhqxKWrhtO5GMNlFjrHWfd3HAjgaSribR4Pzorw8yalYGYqJI4VPvUyPzicSKg/132" width="30px"><span>é™ˆä¸œ</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>æ¯æ¬¡åœ¨Google colabä¸­å®‰è£…packageï¼Œå…³é—­åå®‰è£…åŒ…è¢«åˆ é™¤ï¼Œå¦‚ä½•æ°¸ä¹…æ€§ä½¿ç”¨å®‰è£…åŒ…ï¼Ÿå°è¯•äº†å¾ˆå¤šåŠæ³•ï¼Œä¸å¯è¡Œã€‚è¯·é—®è€å¸ˆæœ‰æ°¸ä¹…æ€§å®‰è£…åŠæ³•å—ï¼Ÿè°¢è°¢</div>2023-10-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/38/9a/6b/791d0f5e.jpg" width="30px"><span>å¤±è½çš„èµ°åœ°é¸¡</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>å¾®è°ƒSDæ¨¡å‹ä¸­æœ‰è¡Œä»£ç ï¼štokenizer = CLIPTokenizer.from_pretrained()ã€‚å‰é¢è®²transformerçš„ç»„æˆæ—¶æåˆ°tokenå’Œè¯åµŒå…¥ï¼Œè¿™é‡Œåˆå°†å®ƒä»¬å½’å±åˆ°clipï¼Œè¯·é—®æ€ä¹ˆç†è§£è¿™ä¸¤ç§çŸ›ç›¾çš„è¯´æ³•ï¼Ÿ</div>2023-10-05</li><br/><li><img src="" width="30px"><span>Geek_535f73</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>Generating train split:   0%|                                                                                    | 0&#47;7169 [00:00&lt;?, ? examples&#47;s]
Traceback (most recent call last):
  File &quot;&#47;cloud&#47;sd_hbo&#47;lib&#47;python3.10&#47;site-packages&#47;datasets&#47;builder.py&quot;, line 1925, in _prepare_split_single
    for _, table in generator:
  File &quot;&#47;cloud&#47;sd_hbo&#47;lib&#47;python3.10&#47;site-packages&#47;datasets&#47;packaged_modules&#47;parquet&#47;parquet.py&quot;, line 77, in _generate_tables
    parquet_file = pq.ParquetFile(f)
  File &quot;&#47;cloud&#47;sd_hbo&#47;lib&#47;python3.10&#47;site-packages&#47;pyarrow&#47;parquet&#47;__init__.py&quot;, line 286, in __init__
    self.reader.open(
  File &quot;pyarrow&#47;_parquet.pyx&quot;, line 1227, in pyarrow._parquet.ParquetReader.open
  File &quot;pyarrow&#47;error.pxi&quot;, line 100, in pyarrow.lib.check_status
pyarrow.lib.ArrowInvalid: Parquet magic bytes not found in footer. Either the file is corrupted or this is not a parquet file.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
  File &quot;&#47;cloud&#47;sd_hbo&#47;lib&#47;python3.10&#47;site-packages&#47;datasets&#47;load.py&quot;, line 2136, in load_dataset
    builder_instance.download_and_prepare(
  File &quot;&#47;cloud&#47;sd_hbo&#47;lib&#47;python3.10&#47;site-packages&#47;datasets&#47;builder.py&quot;, line 954, in download_and_prepare
    self._download_and_prepare(
  File &quot;&#47;cloud&#47;sd_hbo&#47;lib&#47;python3.10&#47;site-packages&#47;datasets&#47;builder.py&quot;, line 1049, in _download_and_prepare
    self._prepare_split(split_generator, **prepare_split_kwargs)
  File &quot;&#47;cloud&#47;sd_hbo&#47;lib&#47;python3.10&#47;site-packages&#47;datasets&#47;builder.py&quot;, line 1813, in _prepare_split
    for job_id, done, content in self._prepare_split_single(
  File &quot;&#47;cloud&#47;sd_hbo&#47;lib&#47;python3.10&#47;site-packages&#47;datasets&#47;builder.py&quot;, line 1958, in _prepare_split_single
    raise DatasetGenerationError(&quot;An error occurred while generating the dataset&quot;) from e
datasets.builder.DatasetGenerationError: An error occurred while generating the dataset</div>2023-09-02</li><br/><li><img src="" width="30px"><span>Geek_535f73</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>è€å¸ˆæ‚¨å¥½
æˆ‘åœ¨è‡ªå·±çš„ä»£ç ä¸­dataset = load_dataset(&quot;nelorth&#47;oxford-flowers&quot;)æ—¶é‡åˆ°è¿™ä¸ªé—®é¢˜

ç¡®å®ç½‘ä¸Šæœäº†å¾ˆä¹…éƒ½æ²¡æœ‰æ‰¾åˆ°ç­”æ¡ˆï¼Œæ‰€ä»¥æ¥è¯·æ•™æ‚¨&#47;å“­</div>2023-09-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/0b/c3/3385cd46.jpg" width="30px"><span>Ericpoon</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è¯•è¿‡åœ¨æœ¬åœ°è¿è¡ŒSDXL0.9ï¼Œï¼ˆ1.0 è¿è¡Œä¸äº†ï¼Œå†…å­˜ä¸è¶³ï¼‰ï¼Œ0.9å¾—åˆ°çš„å›¾è±¡ç»“æœæ²¡æœ‰ç½‘ä¸Šå†™çš„é‚£ä¹ˆå¥½ï¼Œäººæˆ–åŠ¨ç‰©ä¹Ÿçœ‹ç€å¾ˆæŠ½è±¡ï¼Œæˆ‘ç”¨çš„åªæ˜¯HUGGING FACEä¸Šç»™çš„è¿è¡Œä»£ç ï¼Œä»€ä¹ˆå‚æ•°éƒ½æ²¡æœ‰ã€‚è¯·é—®è¿™ä¸ªæœ‰æ²¡æœ‰ç›¸å…³çš„å‚æ•°è®¾ç½®çš„æ–‡ç« ï¼Œä»‹ç»ä¸€ä¸‹ã€‚</div>2023-08-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/d8/13/082013bc.jpg" width="30px"><span>æ˜µç§°C</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆï¼Œæ‚¨å¥½ã€‚æˆ‘æƒ³åšä¸€ä¸ªæ¢è„¸ï¼Œæ¢è¡£æœçš„å›¾ç”Ÿå›¾å°åŠŸèƒ½ã€‚æœ‰åˆé€‚çš„å¼€æºæ¨¡å‹æ¨èä¹ˆï¼Ÿæˆ‘åœ¨ç”¨çš„æ—¶å€™stable-diffusion-v1-5æ¨¡å‹ç”Ÿæˆçš„å†…å®¹æ˜¯æœ‰ä¸é€‚å®œæ£€æµ‹çš„ï¼Œæ€ä¹ˆèƒ½å»æ‰è¿™ä¸ªæ£€æµ‹å‘¢ï¼Ÿ</div>2023-08-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/0a/65/9cd6d109.jpg" width="30px"><span>ç§‹æ™¨</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è®¤è¯†åŸºç¡€æ¨¡å—
ä¼¼ä¹ç¼ºå¤±äº†è®²è§£å¦‚ä½•è¾“å‡ºå™ªå£°å›¾çš„ä»£ç </div>2023-08-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/6a/f2/8829a0b8.jpg" width="30px"><span>@äºŒåä¸€å¤§å”</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è€å¸ˆï¼Œæœ€åè°ƒç”¨sdæ¨¡å‹çš„ä»£ç ï¼Œåœ¨æœ¬åœ°è¿è¡Œæ—¶æœ‰æ²¡æœ‰åŠæ³•å»åŠ è½½æœ¬åœ°æŒ‡å®šæ–‡ä»¶å¤¹ä¸‹çš„æ¨¡å‹ï¼Œè€Œä¸æ˜¯å»ä¸‹è½½huggingfaceä¸­çš„æ¨¡å‹ï¼Œç›®å‰æ˜¯ä¼šæŠŠæ¨¡å‹ä»“åº“ä¸­çš„æ‰€æœ‰é—®ä»·éƒ½ç¼“å­˜åˆ°æœ¬åœ°ï¼Œè¿™æ ·å¯¹äºåˆ‡æ¢æ¨¡å‹æ—¶éå¸¸çš„ä¸å‹å¥½</div>2023-08-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg" width="30px"><span>peter</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è¯·æ•™è€å¸ˆå‡ ä¸ªé—®é¢˜å•Šï¼š
Q1ï¼šæœ‰æ¯”è¾ƒå¥½çš„å‚ç›´ç±»æ¨¡å‹å—ï¼Ÿæ¨èå‡ ä¸ªå•Šã€‚
Q2ï¼šå¼€æºç¤¾åŒºç½‘å€æ˜¯ä»€ä¹ˆï¼Ÿéº»çƒ¦æä¾›ä¸€ä¸‹ã€‚å‰é¢è¯¾ç¨‹ä¹Ÿè®¸æä¾›äº†ï¼Œä½†éš¾ä»¥é€ä¸ªæŸ¥æ‰¾ã€‚éƒ½æ˜¯åœ¨åœ°é“ä¸Šçœ‹çš„ï¼Œå½“æ—¶æ²¡æœ‰è®°ã€‚éº»çƒ¦è€å¸ˆäº†ã€‚</div>2023-08-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/30/ef/2d/757bb0d3.jpg" width="30px"><span>Toni</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>æ€è€ƒé¢˜: åœ¨ Hugging Face ä¸­é€‰æ‹©SDXL1.0
https:&#47;&#47;huggingface.co&#47;stabilityai&#47;stable-diffusion-xl-refiner-1.0
ä»£ç å¦‚ä¸‹:

pip install diffusers --upgrade

pip install invisible_watermark transformers accelerate safetensors

from diffusers import DiffusionPipeline
import torch

# load both base &amp; refiner
base = DiffusionPipeline.from_pretrained(
    &quot;stabilityai&#47;stable-diffusion-xl-base-1.0&quot;, torch_dtype=torch.float16, variant=&quot;fp16&quot;, use_safetensors=True
)
base.to(&quot;cuda&quot;)
refiner = DiffusionPipeline.from_pretrained(
    &quot;stabilityai&#47;stable-diffusion-xl-refiner-1.0&quot;,
    text_encoder_2=base.text_encoder_2,
    vae=base.vae,
    torch_dtype=torch.float16,
    use_safetensors=True,
    variant=&quot;fp16&quot;,
)
refiner.to(&quot;cuda&quot;)

# Define how many steps and what % of steps to be run on each experts (80&#47;20) here
n_steps = 40
high_noise_frac = 0.8

prompt = &quot;RAW photo,Childhood in Beijing Hutongs,70s,two little boys playing and chasing each other,boys are dressed in shorts and vests,and appear to be very happy,the background is street,several old houses,the color tone is somewhat yellowish-brown,8k,DSLR,soft light,high quality,film grain,Fujifilm XT3&quot;
negative_prompt=&quot;mutated hands, fused fingers, too many fingers, missing fingers, poorly drawn hands, blurry eyes, blurred iris, blurry face, poorly drawn face, mutation, deformed, ugly, blurry, bad anatomy, bad proportions, extra limbs, cloned face, disfigured, out of frame, multiple faces, long neck, nsfw&quot;

# run both experts
image = base(
    prompt=prompt,
    negative_prompt=negative_prompt,
    num_inference_steps=n_steps,
    denoising_end=high_noise_frac,
    output_type=&quot;latent&quot;,
).images
image1 = refiner(
    prompt=prompt,
    negative_prompt=negative_prompt,
    num_inference_steps=n_steps,
    denoising_start=high_noise_frac,
    image=image,
).images[0]

image1

å›¾å‘åœ¨[å¾®ä¿¡AIç»˜ç”»ä¸“æ äº¤æµç¾¤]é‡Œäº†ã€‚</div>2023-08-11</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLwAlcUEico92QXNQXFHQibC8Tzfsmqv9jVAItUtL56icL7ahbRHfr3hnB40Ra5Wdibxj1LTfLyr2ZEtQ/132" width="30px"><span>é»„å°”æ—</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>è¯·é—®å¸‚åœºé‚£äº› sd å¤§æ¨¡å‹ï¼Œæ¯”å¦‚éº¦æ©˜ï¼Œå¢¨å¹½ï¼Œrealistic ç­‰å¤§æ¨¡å‹ï¼Œä¹Ÿæ˜¯è¿™ç§æ–¹å¼è®­ç»ƒçš„å—</div>2024-08-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/24/4d/f5/2e80aca6.jpg" width="30px"><span>å¥”è·‘çš„èš‚èš</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>sdå¾®è°ƒ Counterfeit-V2.5è¿™æ®µ

import torch
from diffusers import DiffusionPipeline

pipeline = DiffusionPipeline.from_pretrained(&quot;gsdf&#47;Counterfeit-V2.5&quot;)

æŠ¥é”™

AttributeError                            Traceback (most recent call last)

&lt;ipython-input-14-2f5c494bd124&gt; in &lt;cell line: 2&gt;()
      1 import torch
----&gt; 2 from diffusers import DiffusionPipeline
      3 
      4 pipeline = DiffusionPipeline.from_pretrained(&quot;gsdf&#47;Counterfeit-V2.5&quot;)

7 frames

&#47;usr&#47;local&#47;lib&#47;python3.10&#47;dist-packages&#47;jax&#47;_src&#47;deprecations.py in getattr(name)
     52       warnings.warn(message, DeprecationWarning, stacklevel=2)
     53       return fn
---&gt; 54     raise AttributeError(f&quot;module {module!r} has no attribute {name!r}&quot;)
     55 
     56   return getattr

AttributeError: module &#39;jax.random&#39; has no attribute &#39;KeyArray&#39;</div>2024-04-11</li><br/>
</ul>