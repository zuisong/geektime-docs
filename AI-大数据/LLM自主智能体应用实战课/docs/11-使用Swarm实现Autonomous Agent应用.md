ä½ å¥½ï¼Œæˆ‘æ˜¯æé”Ÿã€‚

åœ¨ä¸ŠèŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å®‰è£…å¥½äº† Swarmï¼Œè¿è¡Œäº†ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œç„¶åä¸€èµ·å­¦ä¹ äº† Swarm çš„å®˜æ–¹æ–‡æ¡£ã€‚è¿™èŠ‚è¯¾æˆ‘ä»¬æŠŠä¸ŠèŠ‚è¯¾å­¦åˆ°çš„æ–°çŸ¥è¯†æŠ•å…¥å®æˆ˜ï¼ŒåŸºäº Swarm å¼€å‘æˆ‘ä»¬çš„ 24 ç‚¹æ¸¸æˆæ™ºèƒ½ä½“åº”ç”¨ã€‚

æˆ‘ä»¬ä¹‹å‰å·²ç»åŸºäº MetaGPTã€AutoGPT å®ç°è¿‡ä¸¤æ¬¡è¿™ä¸ªåº”ç”¨ï¼Œè¿™èŠ‚è¯¾è¦åšçš„å·¥ä½œå°±æ˜¯å°†ä¹‹å‰çš„è®¾è®¡ç§»æ¤åˆ° Swarmã€‚

## è§’è‰²å»ºæ¨¡å’Œå·¥ä½œæµè®¾è®¡

é¦–å…ˆæˆ‘ä»¬è¦åšçš„å·¥ä½œè¿˜æ˜¯é’ˆå¯¹ Swarm æ¥åšè§’è‰²å»ºæ¨¡å’Œå·¥ä½œæµè®¾è®¡ã€‚

ä»æ¦‚å¿µä¸Šè®²ï¼ŒSwarm åº”ç”¨ä¸­çš„æ¦‚å¿µå…¶å®æ›´æ¥è¿‘ AutoGPTã€‚Swarm çš„ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯ Agentï¼ˆæ™ºèƒ½ä½“ï¼‰å’Œ Handoffï¼ˆç§»äº¤ï¼‰ï¼ŒAgent ä¸ AutoGPT çš„ Agent å¯¹åº”ï¼ŒHandoff å¯¹åº”ç€ AutoGPT Builder å›¾å½¢ç•Œé¢ä¸­ä¸¤ä¸ª Agent ä¹‹é—´çš„é‚£äº›è¿æ¥å…³ç³»ï¼ˆè¿æ¥çº¿ä»¥åŠç›¸å…³çš„è¾“å…¥ã€è¾“å‡ºæ•°æ®ï¼‰ã€‚å› æ­¤ Swarm ç‰ˆ 24 ç‚¹æ¸¸æˆæ™ºèƒ½ä½“åº”ç”¨çš„è§’è‰²å»ºæ¨¡å’Œå·¥ä½œæµè®¾è®¡ä¸ AutoGPT ç‰ˆå®Œå…¨ç›¸åŒï¼ŒåŒæ ·ä¹Ÿåˆ’åˆ†ä¸º 4 ä¸ª Agentï¼š**GameDealer**ã€**MathProdigy**ã€**GameJudger**ã€**GamePlayer**ã€‚

æˆ‘ç›´æ¥æŠŠ 08 è¯¾ä¸­çš„æµç¨‹å›¾å¤åˆ¶è¿‡æ¥ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/bc/84/bc46948cd46f8529ea921f306374c584.png?wh=878x932)

å› ä¸º Swarm çš„æ¯ä¸€ä¸ª Agent åœ¨è¿è¡Œ client.run() æ—¶éƒ½éœ€è¦è®¿é—® LLMï¼Œè€Œæˆ‘ä»¬ä¹‹å‰åœ¨å®ç° MetaGPTã€AutoGPT ç‰ˆçš„ 24 ç‚¹æ¸¸æˆæ™ºèƒ½ä½“åº”ç”¨æ—¶ï¼ŒMathProdigy å’Œ GamePlayer è¿™ä¸¤ä¸ª Agentï¼ˆæˆ– Roleï¼‰æ˜¯æ²¡æœ‰è®¿é—® LLM çš„ã€‚å¯¹äº MathProdigy å’Œ GamePlayerï¼Œè²Œä¼¼æœ€ç›´æ¥çš„æ–¹å¼æ˜¯ä¸ä½¿ç”¨ Swarm çš„ Agentï¼Œè€Œæ˜¯ç”¨è‡ªå®šä¹‰çš„ç±»æ¥å®ç°ã€‚è¿™æ ·åšç¡®å®ä¹Ÿèƒ½å®ç° 24 ç‚¹æ¸¸æˆæ™ºèƒ½ä½“åº”ç”¨ï¼Œä¸è¿‡ä¸ºäº†å±•ç¤º Swarm è°ƒç”¨å¤–éƒ¨å‡½æ•°ï¼ˆå¤–éƒ¨å·¥å…·ï¼‰çš„èƒ½åŠ›ï¼Œä¹Ÿä¸ºäº†ä»£ç çš„ä¸€è‡´æ€§ï¼Œæˆ‘å†³å®šæŠŠå®ƒä»¬ 4 ä¸ªå…¨éƒ¨å®ç°ä¸º Swarm çš„ Agentã€‚

## å®ç°ç¬¬ä¸€ç‰ˆ

æ€»ä½“çš„è®¾è®¡æ€è·¯ç¡®å®šäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å…ˆåšä¸€äº›åŸºç¡€æ€§å·¥ä½œã€‚æˆ‘ä»¬æŒ‰ç…§è‡ªåº•å‘ä¸Šçš„æ–¹å¼æ¥åšå¼€å‘ã€‚

### å®ç° Agent çš„å¤–éƒ¨å‡½æ•°

æˆ‘ä»¬éœ€è¦å…ˆç¡®å®šç»™è¿™ 4 ä¸ª Agent æä¾›å‡ ä¸ªå‡½æ•°ã€‚åŸºäºå‰é¢è¯¾ç¨‹ä¸­çš„å®ç°ç»éªŒï¼ŒGameDealer å¯ä»¥å®Œå…¨åŸºäº qwen2.5 çš„èƒ½åŠ›æ¥å®ç°å‘ç‰ŒåŠŸèƒ½ï¼Œå› æ­¤ä¸éœ€è¦æä¾›å¤–éƒ¨å‡½æ•°ã€‚ç„¶è€Œ qwen2.5 ç‹¬ç«‹è§£å†³ 24 ç‚¹è¡¨è¾¾å¼ç›®å‰æ¥è¯´è¿˜éå¸¸å›°éš¾ï¼Œå› æ­¤ MathProdigy éœ€è¦ä¸€ä¸ªå¤–éƒ¨å‡½æ•°çš„æ”¯æŒã€‚

ä¸ŠèŠ‚è¯¾æˆ‘å·²ç»æåˆ°è¿‡ï¼Œæˆ‘ä»¬å°†ä¼šåŸºäº qwen2.5 çš„ Assistants API å’Œæˆ‘ä»¬è‡ªå·±å®ç°çš„éªŒè¯å‡½æ•°æ¥åšè®¡ç®—ï¼Œåˆ¤æ–­è¡¨è¾¾å¼æ˜¯å¦æ­£ç¡®ï¼Œå› æ­¤ GameJudger ä¹Ÿéœ€è¦ä¸€ä¸ªå¤–éƒ¨å‡½æ•°ã€‚GamePlayer éœ€è¦æ¥å—äººç±»ç”¨æˆ·çš„è¾“å…¥ï¼Œæ— ç–‘ä¹Ÿéœ€è¦ä¸€ä¸ªå¤–éƒ¨å‡½æ•°ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸€å…±éœ€è¦ 3 ä¸ªå¤–éƒ¨å‡½æ•°ï¼Œåˆ†åˆ«å‘½åä¸º get\_24\_points\_expression\_funcã€check\_24\_points\_expression\_funcã€get\_human\_reply\_funcï¼Œè¿™ 3 ä¸ªå‡½æ•°çš„å®ç°å¦‚ä¸‹ï¼š

```plain
def get_24_points_expression_func(last_cards_posted: str) -> str:
    """Resolve the expression of 24 points game, return an arithmetic expression.
    Keyword arguments:
      last_cards_posted: an array of 4 integers between 1 to 13.
    """

    point_list = json.loads(last_cards_posted)  
    if len(point_list) == 0:
        return "expression not found"

    expressions = get_cached_expressions(point_list)
    
    result = "expression not found"
    if len(expressions) > 0:
        random_idx = random.randint(0, len(expressions)-1)
        expression = f"'{expressions[random_idx]}'".replace("'", "")
        print(f"The resolved 24 points expression is '{expression}'")
        return expression
    
    return "expression not found"

def check_24_points_expression_func(expression: str, last_cards_posted: str) -> str:
    """Check if the result of an arithmetic expression is equal 24, return 'Correct' or 'Wrong'.
    Keyword arguments:
      expression: an arithmetic expression
      last_cards_posted: an array of 4 integers between 1 to 13.
    """

    result = eval(expression.replace("'", ""))
    if abs(result - 24) < 0.001:
        return "Correct"

    return "Wrong"

def get_human_reply_func(last_cards_posted: str) -> str:
    """Get a human reply for an an array formated as string. The replay should be 'deal', 'help', 'exit' or an an arithmetic expression.
    Keyword arguments:
      last_cards_posted: an array of 4 integers between 1 to 13.
    """

    PROMPT_TEMPLATE: str = """
    Cards the dealer just posted: {content}
    Please give an expression for the four operations that results in 24.
    Type 'help' if you feel it's difficult.
    Type 'deal' if you want the dealer to deal cards again.
    Type 'exit' if you want to exit this game, type 'exit'.
    """

    point_list = json.loads(last_cards_posted)
    card_list = get_random_card_list(point_list)
    cards_content = f"{{'card_list': {card_list}, 'point_list': {point_list}}}"

    prompt = PROMPT_TEMPLATE.format(content=cards_content)
    human_reply = input(prompt)

    return {"human_reply": f"{human_reply}"}
```

åœ¨è¿™ 3 ä¸ªå‡½æ•°å®ç°ä¸­è°ƒç”¨çš„ä¸€äº› helper å‡½æ•°ï¼Œåœ¨æ–‡ä»¶ game\_helper.py ä¸­ã€‚ä¸ MetaGPTã€AutoGPT ç‰ˆæœ¬ä¸­çš„ helper å‡½æ•°åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ã€‚

### å®ç° Agent çš„æç¤ºè¯æ¨¡æ¿

ä»ä¸ŠèŠ‚è¯¾çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ï¼ŒSwarm çš„æ¯ä¸ª Agent è®¿é—® LLM æ—¶æä¾›çš„æç¤ºè¯ä¸»è¦åˆ’åˆ†ä¸º**ç³»ç»Ÿæç¤ºè¯**å’Œ**ç”¨æˆ·æç¤ºè¯**ä¸¤å¤§ç±»ã€‚ç³»ç»Ÿæç¤ºè¯å¯ä»¥ç”±åˆ›å»º Agent å¯¹è±¡æ—¶ **instructions** å‚æ•°å¯¹åº”çš„å‡½æ•°æä¾›ï¼Œæˆ‘å†™äº†ä¸€ä¸ª get\_instruction() å‡½æ•°æ¥æä¾› 4 ä¸ª Agent çš„ç³»ç»Ÿæç¤ºè¯ã€‚ä¸æ­¤å¯¹åº”ï¼Œæˆ‘è¿˜å†™äº†ä¸€ä¸ªå¯¹åº”çš„ get\_user\_prompt() å‡½æ•°æ¥æä¾› 4 ä¸ª Agent çš„ç”¨æˆ·æç¤ºè¯ã€‚æç¤ºè¯æ¨¡æ¿å’Œè¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°å¦‚ä¸‹ï¼š

```plain
instruction_template_dict = {
    "GameDealer": """
        Generate 4 random natural numbers between 1 and 13, include 1 and 13. Just return 4 numbers in an array, don't include other content. The returned array should not be repeated with the following arrays:
        {old_arrays}
        """,
    "MathProdigy": """You are a helpful agent. """,
    "GameJudger": """You are a helpful agent. """,
    "GamePlayer": """You are a helpful agent. """,
}

user_prompt_template_dict = {
    "GameDealer": """generate an array""",
    "MathProdigy": """
        What's the 24 points expression of {last_cards_posted} ? 
        If the result is 'expression not found', just return 'expression not found'. 
        If the result is an arithmetic expression, just return the expression itself and do not add anything else.
        """,
    "GameJudger": """
        Cards posted is '{last_cards_posted}', what's the check result of {expression} ? Just return the check result itself such as 'Correct' or 'Wrong', and do not add anything else such as 'The check result is ...'. 
    """,
    "GamePlayer": """
        What's the human reply of {last_cards_posted} ? Just return the human reply itself and do not add anything else, such as 'The human reply ...'. 
    """,
}

def get_instruction(context_variables):
    global instruction_template_dict

    agent_name = context_variables["agent_name"]
    instruction_template = instruction_template_dict[agent_name]
    instruction = instruction_template

    if agent_name == "GameDealer":
        last_cards_posted = context_variables["old_arrays"]
        instruction = instruction_template.format(old_arrays=last_cards_posted)
   
    return instruction

def get_user_prompt(context_variables):
    global user_prompt_template_dict

    agent_name = context_variables["agent_name"]
    user_prompt_template = user_prompt_template_dict[agent_name]
    user_prompt = user_prompt_template

    if agent_name == "MathProdigy":
        last_cards_posted = context_variables["last_cards_posted"]
        user_prompt = user_prompt_template.format(last_cards_posted=last_cards_posted)

    elif agent_name == "GameJudger":
        expression = context_variables["expression"]
        last_cards_posted = context_variables["last_cards_posted"]
        user_prompt = user_prompt_template.format(expression=expression,last_cards_posted=last_cards_posted)

    elif agent_name == "GamePlayer":
        last_cards_posted = context_variables["last_cards_posted"]
        user_prompt = user_prompt_template.format(last_cards_posted=last_cards_posted)

    return user_prompt
```

éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯æ¯ä¸ª Agent çš„æç¤ºè¯æ¨¡æ¿çš„è®¾è®¡ï¼Œç›®æ ‡æ˜¯ä¸ºäº†è®©ä¸ä¹‹äº¤äº’çš„ LLM å‡†ç¡®å®ç°æˆ‘ä»¬æœŸæœ›çš„è¡Œä¸ºï¼Œå³ç¡®ä¿ LLM å‡†ç¡®è°ƒç”¨ç»™æ¯ä¸ª Agent é…ç½®çš„å‡½æ•°ï¼Œè€Œä¸”ç¡®ä¿ LLM è¿”å›ç»“æœçš„æ ¼å¼æ˜¯æˆ‘ä»¬æœŸæœ›çš„æ ¼å¼ã€‚å…¶ä¸­çš„ context\_variables æ˜¯ä¸ŠèŠ‚è¯¾ä»‹ç»è¿‡çš„ä¸Šä¸‹æ–‡å˜é‡ï¼Œåœ¨æ¯ä¸€æ¬¡è¿è¡Œ client.run() æ—¶ä¼ å…¥ã€‚

ä½ å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œåªæœ‰ GameDealer å…·ä½“è¦åšçš„äº‹æƒ…æ˜¯å®ç°ä¸ºç³»ç»Ÿæç¤ºè¯ï¼Œå…¶ä»– 3 ä¸ª Agent å…·ä½“è¦åšçš„äº‹æƒ…éƒ½å®ç°ä¸ºç”¨æˆ·æç¤ºè¯ã€‚è¿™æ ·åšæ˜¯æœ‰åŸå› çš„ï¼Œè€Œä¸”é’ˆå¯¹ä¸åŒçš„ LLM ç±»å‹ï¼Œå®ç°æ–¹å¼æœªå¿…æ˜¯ç›¸åŒçš„ã€‚å¯¹äºæˆ‘ä»¬ä½¿ç”¨çš„ qwen2.5 æ¥è¯´ï¼Œç²¾ç¡®æè¿°çš„ç”¨æˆ·æç¤ºè¯çš„æ•ˆæœæ˜¯æœ€å¥½çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨é…ç½®æœ‰å¤–éƒ¨å‡½æ•°çš„æƒ…å†µä¸‹ã€‚å¦‚æœä½¿ç”¨ç³»ç»Ÿæç¤ºè¯ï¼Œæœªå¿…æ¯æ¬¡éƒ½èƒ½æ‰§è¡ŒæœŸæœ›çš„å‡½æ•°è°ƒç”¨ã€‚GameDealer å¹¶æœªé…ç½®å¤–éƒ¨å‡½æ•°ï¼Œæ‰€ä»¥å…·ä½“è¦åšçš„äº‹æƒ…å®ç°ä¸ºç³»ç»Ÿæç¤ºè¯å³å¯ã€‚

### åˆ›å»º Agent å¯¹è±¡å®ä¾‹

æ¥ä¸‹æ¥æˆ‘ä»¬åˆ›å»º 4 ä¸ª Agent å¯¹è±¡å®ä¾‹ã€‚æˆ‘ä»¬åˆ†åˆ«ç»™è¿™ 4 ä¸ª Agent å¯¹è±¡å®ä¾‹å–åä¸º Billã€Gaussã€Peterã€David ä»¥ç¤ºåŒºåˆ«ã€‚

```plain
agent_bill = Agent(
    name="GameDealer",
    instructions=get_instruction,
    model="qwen2.5",
    functions=[],
)

agent_gauss = Agent(
    name="MathProdigy",
    instructions=get_instruction,
    model="qwen2.5",
    functions=[get_24_points_expression_func],
)

agent_peter = Agent(
    name="GameJudger",
    instructions=get_instruction,
    model="qwen2.5",
    functions=[check_24_points_expression_func],
)

agent_david = Agent(
    name="GamePlayer",
    instructions=get_instruction,
    model="qwen2.5",
    functions=[get_human_reply_func],
)
```

æ³¨æ„ï¼šæ¯ä¸ª Agent å¯¹è±¡å®ä¾‹åœ¨åˆ›å»ºæ—¶éƒ½éœ€è¦è®¾ç½® model=â€œqwen2.5â€ï¼Œå› ä¸ºé»˜è®¤çš„ model æ˜¯ OpenAI è‡ªå®¶çš„ GPT-4oã€‚

### å®ç° Agent çš„ä¸šåŠ¡å‡½æ•°

å®Œæˆäº†ä»¥ä¸ŠåŸºç¡€å·¥ä½œï¼Œæˆ‘ä»¬å†ç»™æ¯ä¸ª Agent å®ç°ä¸€ä¸ªä¸šåŠ¡å‡½æ•°ã€‚

```plain
def deal_cards(old_arrays: List[int]) -> str:
    global client, agent_bill

    print(f"used old_arrays is :{old_arrays}")
    context_var_dict = {
        "agent_name":"GameDealer", 
        "old_arrays": f"{old_arrays}"
    }
    response = client.run(
        agent=agent_bill,
        messages=[{"role": "user", "content": get_user_prompt(context_var_dict)}],
        context_variables=context_var_dict
    )

    cards_posted = response.messages[-1]["content"]
    print(cards_posted)
    return cards_posted

def machine_give_expression(last_cards_posted: str) -> str:
    global client, agent_gauss

    context_var_dict = {
        "agent_name":"MathProdigy", 
        "last_cards_posted": f"{last_cards_posted}"
    }
    response = client.run(
        agent=agent_gauss,
        messages=[{"role": "user", "content": get_user_prompt(context_var_dict)}],
        context_variables=context_var_dict
    )

    expression = response.messages[-1]["content"]
    print(expression)
    return expression

def check_expression(expression: str, last_cards_posted: str) -> str:
    global client, agent_peter

    context_var_dict = {
        "agent_name":"GameJudger", 
        "expression": f"{expression}",
        "last_cards_posted": f"{last_cards_posted}"
    }
    response = client.run(
        agent=agent_peter,
        messages=[{"role": "user", "content": get_user_prompt(context_var_dict)}],
        context_variables=context_var_dict
    )

    check_result = response.messages[-1]["content"]
    print(check_result)
    return check_result

def get_human_reply(last_cards_posted: str) -> str:
    global client, agent_david

    context_var_dict = {
        "agent_name":"GamePlayer", 
        "last_cards_posted": f"{last_cards_posted}"
    }
    response = client.run(
        agent=agent_david,
        messages=[{"role": "user", "content": get_user_prompt(context_var_dict)}],
        context_variables=context_var_dict
    )

    human_reply = response.messages[-1]["content"]
    print(human_reply)
    return human_reply
```

è¿™ 4 ä¸ªå‡½æ•°çš„åŠŸèƒ½ï¼Œå’Œ 08 è¯¾ AutoGPT ç‰ˆæœ¬ä¸­å¯¹åº”çš„åŒå Block çš„åŠŸèƒ½æ˜¯ä¸€è‡´çš„ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚

### åœ¨ main å‡½æ•°ä¸­å®ç°å®Œæ•´çš„å·¥ä½œæµ

æœ€åï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ª main å‡½æ•°å†…å®ç°å®Œæ•´çš„å·¥ä½œæµã€‚

```plain
def main_func():
    
    old_arrays = []
    last_cards_posted = deal_cards(old_arrays)

    while True:
        human_reply = get_human_reply(last_cards_posted)

        if human_reply == "deal":
            old_arrays.append(json.loads(last_cards_posted))
            last_cards_posted = deal_cards(old_arrays)
            continue
        elif human_reply == "help":
            expression = machine_give_expression(last_cards_posted)
        elif human_reply == "exit":
            print("Bye bye, have a good day!")
            break
        else:
            expression = human_reply
        
        if expression != "expression not found":
            check_result = check_expression(expression, last_cards_posted)
        else:
            check_result = "Correct"
                        
        if check_result == "Correct":
            old_arrays.append(json.loads(last_cards_posted))
            last_cards_posted = deal_cards(old_arrays)
```

å®Œæ•´çš„ä»£ç å®ç°ï¼Œåœ¨è¯¾ç¨‹ä»£ç  play\_24\_points\_game\_v1.py ä¸­ã€‚è¿è¡Œèµ·æ¥ä½“éªŒä¸€ä¸‹å§ã€‚

```plain
cd ~/work/learn_swarm
run_swarm_app play_24_points_game_v1.py
```

## ç¬¬ä¸€ç‰ˆæˆ‘ä»¬æ¼æ‰äº†ä»€ä¹ˆï¼Ÿ

ä» Swarm ç‰ˆ 24 ç‚¹æ¸¸æˆæ™ºèƒ½ä½“åº”ç”¨ç¬¬ä¸€ç‰ˆçš„å®ç°æ¥çœ‹ï¼Œå®ç°ä¸€ä¸ª Swarm åº”ç”¨æ˜¯éå¸¸ç®€å•ç›´æ¥çš„ï¼Œæ¯”å®ç° MetaGPTã€AutoGPT åº”ç”¨éƒ½è¦ç®€å•ã€‚è¿™ä¸ªå·¥ä½œæ˜¯å¦‚æ­¤è½»æ¾æƒ¬æ„ï¼ŒçœŸæ˜¯å¤ªæ£’äº†ï¼

ä¸è¿‡ï¼Œäº‹åéšéšä¼šæ„Ÿè§‰åˆ°åœ¨ç¬¬ä¸€ç‰ˆå®ç°ä¸­ä¼¼ä¹ç¼ºäº†ç‚¹é‡è¦çš„ä¸œè¥¿ï¼Œé‚£ä¹ˆç©¶ç«Ÿæ˜¯ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿ

å‰é¢æˆ‘è®²è¿‡ Swarm æœ‰ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µ Agent å’Œ Handoffã€‚ç¬¬ä¸€ç‰ˆå®ç°ä¸­ç¡®å®ä½¿ç”¨äº† Agentï¼Œä¹Ÿå®ç°äº†å‡½æ•°è°ƒç”¨ï¼Œä½†æ˜¯å®Œå…¨æ²¡æœ‰ç”¨åˆ° Handoffï¼Œæ‰€æœ‰çš„å·¥ä½œæµéƒ½æ˜¯ç”¨æ‰‹å†™ä»£ç å®ç°çš„ã€‚è¿™æ ·åšå½“ç„¶æ˜¯ä¸å®Œå–„çš„ï¼Œç„¶è€Œç¬¬ä¸€ç‰ˆçš„å®ç°ä»ç„¶æ˜¯å¾ˆæœ‰ä»·å€¼çš„ï¼Œä¹Ÿå®Œå…¨ç¬¦åˆæˆ‘ç»å¸¸æåˆ°çš„ KISS åŸåˆ™ã€‚æˆ‘ä»¬æ¥ç»§ç»­åšä¸€äº›æ”¹è¿›ï¼Œå¼€å‘ä½¿ç”¨äº† Handoff çš„ç¬¬äºŒç‰ˆå®ç°ã€‚

æ ¹æ®ä¸ŠèŠ‚è¯¾æˆ‘ä»¬å­¦ä¹ è¿‡çš„ [Swarm çš„å®˜æ–¹æ–‡æ¡£](https://github.com/openai/swarm)ï¼Œå¤–éƒ¨å‡½æ•°æ—¢å¯ä»¥è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ª Result å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š

```plain
def talk_to_sales():
   print("Hello, World!")
   return Result(
       value="Done",
       agent=sales_agent,
       context_variables={"department": "sales"}
   )
```

Result å¯¹è±¡æœ‰ 3 ä¸ªå‚æ•°ï¼š

- agent æ˜¯ client.run() ä¸­ä¸‹ä¸€ä¸ªè¦è°ƒç”¨çš„ Agentã€‚
- value æ˜¯ä¼ ç»™ä¸‹ä¸€ä¸ª Agent çš„å†…å®¹ã€‚
- context\_variables æ˜¯ client.run() ä¸­è°ƒç”¨ä¸‹ä¸€ä¸ª Agent æ—¶ä¼ å…¥çš„ä¸Šä¸‹æ–‡å˜é‡ã€‚

æ—¢ç„¶å¦‚æ­¤ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯æŠŠç¬¬ä¸€ç‰ˆä¸­çš„å¤–éƒ¨å‡½æ•°åšäº›ä¿®æ”¹ï¼Œåœ¨å¿…è¦çš„æƒ…å†µä¸‹è¿”å›ä¸€ä¸ª Result å¯¹è±¡ï¼Œè€Œä¸æ˜¯è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚

## å®ç°ç¬¬äºŒç‰ˆ

ç¬¬äºŒç‰ˆå®ç°æ˜¯å»ºç«‹åœ¨ç¬¬ä¸€ç‰ˆå®ç°çš„åŸºç¡€ä¹‹ä¸Šçš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»‹ç»ä¸€äº›éœ€è¦åšå“ªäº›æ”¹åŠ¨ã€‚

### ä¿®æ”¹ Agent çš„å¤–éƒ¨å‡½æ•°å®ç°

3 ä¸ªå¤–éƒ¨å‡½æ•°ä¸­ check\_24\_points\_expression\_func() å‡½æ•°æ— éœ€ä¿®æ”¹ï¼Œå…¶ä»–ä¸¤ä¸ªå‡½æ•°éœ€è¦ä¿®æ”¹ï¼Œä»¥ä¸‹æ˜¯ä¿®æ”¹ä¹‹åçš„ç‰ˆæœ¬ï¼š

```plain
def get_24_points_expression_func(last_cards_posted: str) -> str:
    """Resolve the expression of 24 points game, return an arithmetic expression.

    Keyword arguments:
      last_cards_posted: an array of 4 integers between 1 to 13.
    """

    point_list = json.loads(last_cards_posted)  
    if len(point_list) == 0:
        return "expression not found"

    expressions = get_cached_expressions(point_list)
    
    if len(expressions) > 0:
        random_idx = random.randint(0, len(expressions)-1)
        expression = f"'{expressions[random_idx]}'".replace("'", "")
        print(f"The resolved 24 points expression is '{expression}'")

        context_var_dict = {
            "agent_name":"GameJudger", 
            "expression": f"{expression}",
            "last_cards_posted": f"{last_cards_posted}"
        }
        user_prompt = get_user_prompt(context_var_dict)
        return Result(
            value=user_prompt,
            agent=agent_peter,
            context_variables=context_var_dict
        )

    return "expression not found"

def get_human_reply_func(last_cards_posted: str) -> str:
    """Get a human reply for an an array formated as string. The replay should be 'deal', 'help', 'exit' or an an arithmetic expression.

    Keyword arguments:
      last_cards_posted: an array of 4 integers between 1 to 13.
    """

    PROMPT_TEMPLATE: str = """
    Cards the dealer just posted: {content}
    Please give an expression for the four operations that results in 24.
    Type 'help' if you feel it's difficult.
    Type 'deal' if you want the dealer to deal cards again.
    Type 'exit' if you want to exit this game, type 'exit'.
    """

    point_list = json.loads(last_cards_posted)
    card_list = get_random_card_list(point_list)
    cards_content = f"{{'card_list': {card_list}, 'point_list': {point_list}}}"

    prompt = PROMPT_TEMPLATE.format(content=cards_content)
    human_reply = input(prompt)

    if human_reply == "help":
        context_var_dict = {
            "agent_name":"MathProdigy", 
            "last_cards_posted": f"{last_cards_posted}"
        }
        user_prompt = get_user_prompt(context_var_dict)
        return Result(
            value=user_prompt,
            agent=agent_gauss,
            context_variables=context_var_dict
        )

    elif human_reply != "deal" and human_reply != "exit":
        context_var_dict = {
            "agent_name":"GameJudger", 
            "expression": f"{human_reply}",
            "last_cards_posted": f"{last_cards_posted}"
        }
        user_prompt = get_user_prompt(context_var_dict)
        return Result(
            value=user_prompt,
            agent=agent_peter,
            context_variables=context_var_dict
        )

    return human_reply
```

### ä¸º Swarm æ‰“è¡¥ä¸

æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥å†™ä¸€äº›ç®€å•çš„ä»£ç æ¥æµ‹è¯•ä¿®æ”¹åçš„å¤–éƒ¨å‡½æ•°ã€‚ä¾‹å¦‚é€šè¿‡ client.run() è°ƒç”¨ agent\_davidï¼Œæˆ‘æœŸæœ›çš„è¡Œä¸ºæ˜¯ï¼š

- è‹¥ç”¨æˆ·è¾“å…¥ â€œhelpâ€ï¼Œclient.run() è‡ªåŠ¨è°ƒç”¨ agent\_gauss ç»™å‡º 24 ç‚¹è¡¨è¾¾å¼ï¼Œç„¶åè‡ªåŠ¨è°ƒç”¨ agent\_peter æ¥åšè¡¨è¾¾å¼çš„éªŒè¯ã€‚
- è‹¥ç”¨æˆ·è‡ªå·±ç»™å‡ºäº† 24 ç‚¹è¡¨è¾¾å¼ï¼Œclient.run() è‡ªåŠ¨è°ƒç”¨ agent\_peter æ¥åšè¡¨è¾¾å¼çš„éªŒè¯ã€‚

ç„¶è€Œåœ¨æµ‹è¯•ä¿®æ”¹åçš„å¤–éƒ¨å‡½æ•°æ—¶ï¼Œæˆ‘å‘ç°åº”ç”¨è¿è¡Œæ—¶çš„è¡Œä¸ºå¹¶ä¸èƒ½è¾¾åˆ°æˆ‘çš„é¢„æœŸã€‚å¼€å‘è¿‡ç¨‹åˆè¢«å¡ä½äº†ï¼ä¸è¿‡æ²¡ä»€ä¹ˆå¤§ä¸äº†ï¼Œå…³å…³éš¾è¿‡å…³å…³è¿‡å’¯ã€‚:)

Swarm çš„å®˜æ–¹æ–‡æ¡£å†™çš„å¾ˆç®€ç•¥ï¼Œä¼¼ä¹åœ¨åº”ç”¨å±‚é¢æˆ‘æ²¡æœ‰ä»€ä¹ˆå¯ä»¥ç»§ç»­åšçš„äº‹æƒ…äº†ã€‚é‚£ä¹ˆæˆ‘éœ€è¦ææ¸…æ¥šåœ¨ Swarm çš„ client.run() ä¸­ç©¶ç«Ÿåšäº†äº›ä»€ä¹ˆäº‹æƒ…ã€‚å¥½åœ¨ Swarm æ˜¯å¼€æºçš„ï¼Œä»£ç é‡å¾ˆå°‘ï¼Œé‡åˆ°é—®é¢˜å®Œå…¨å¯ä»¥ DIYï¼ˆè¿™å°±æ˜¯æˆ‘å¾ˆå¤šæ¬¡å¼ºè°ƒé€‰æ‹©â€œè½»é‡çº§å¼€å‘æ¡†æ¶â€çš„ä¼˜ç‚¹ï¼‰ã€‚

é€šè¿‡è·Ÿè¸ª client.run() å†…éƒ¨çš„å®ç°ï¼Œæˆ‘å‘ç°æ— æ³•é¡ºåˆ©è°ƒç”¨ä¸‹ä¸€ä¸ª Agent åŠå…¶å¯¹åº”å¤–å‡½æ•°çš„åŸå› ï¼Œæ˜¯ client.run() ä¸­ç¬¬äºŒè½®ä¸ LLM äº¤äº’æ—¶ï¼Œæœ€åä¸€æ¡æ¶ˆæ¯çš„ â€œroleâ€ å±æ€§ä¸º â€œtoolâ€ï¼Œè€Œ qwen2.5 å¯¹ç”± tool å‘æ¥çš„æ¶ˆæ¯æ¯”è¾ƒå†·æ·¡ï¼Œé™¤éæœ€åä¸€æ¡æ¶ˆæ¯çš„ â€œroleâ€ å±æ€§ä¸º â€œuserâ€ï¼Œæ‰ä¼šç§¯æå›åº”ï¼Œè¿”å›æˆ‘æœŸæœ›çš„å›å¤ï¼ˆåŒ…æ‹¬äº†è°ƒç”¨å¤–éƒ¨å‡½æ•°çš„æŒ‡ç¤ºï¼‰ã€‚

client.run() çš„å®ç°ä½äº Swarm çš„ â€œ/swarm/core.pyâ€ æ–‡ä»¶ (~/work/swarm/swarm/core.py) å†…ã€‚æˆ‘å¯¹ client.run() çš„å®ç°åšäº†ä¸€ç‚¹ä¿®æ”¹ï¼Œåœ¨ while å¾ªç¯æœ€åé¢ â€œif partial\_response.agent:â€ åˆ¤æ–­è¯­å¥ä¸‹æ·»åŠ äº†ä»¥ä¸‹ä»£ç ï¼š

```plain
Â  Â  Â  Â  Â  Â Â history.extend(partial_response.messages)
Â  Â  Â  Â  Â  Â  context_variables.update(partial_response.context_variables)
Â  Â  Â  Â  Â  Â  if partial_response.agent:
Â  Â  Â  Â  Â  Â  Â  Â  active_agent = partial_response.agent

Â  Â  Â  Â  Â  Â  Â  Â  # ä»¥ä¸‹ä¸ºæ–°å¢ä»£ç 
Â  Â  Â  Â  Â  Â  Â  Â  new_user_msg = copy.copy(partial_response.messages[-1])
Â  Â  Â  Â  Â  Â  Â  Â  if new_user_msg['role'] == 'tool':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  new_user_msg['role'] = 'user'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  del new_user_msg['tool_call_id']
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  del new_user_msg['tool_name']
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  history.append(new_user_msg)
```

æ³¨æ„ï¼šåœ¨ä¿®æ”¹ Swarm çš„ core.py å‰ï¼Œéœ€è¦å…ˆå¯¹ core.py çš„åŸæ–‡ä»¶åšä¸€ä¸‹å¤‡ä»½ã€‚

æ–°å¢ä»£ç åšçš„äº‹æƒ…æ¯”è¾ƒç®€å•ï¼Œè‹¥åœ¨å¯¹è¯è¿‡ç¨‹ä¸­å‘ç”Ÿäº† Agent åˆ‡æ¢ï¼Œä¸”å‘ç°å¯¹è¯å†å² (chat history) ä¸­æœ€åä¸€æ¡æ¶ˆæ¯çš„ role ä¸º â€œtoolâ€ï¼Œåˆ™åœ¨å¯¹è¯å†å²ä¸­æ·»åŠ ä¸€æ¡æ–°çš„ user æ¶ˆæ¯ï¼Œæ¶ˆæ¯å†…å®¹ä¸ä¸Šä¸€æ¡ tool æ¶ˆæ¯ç›¸åŒã€‚è¿™æ ·å°±å¯ä»¥è§¦å‘ qwen2.5 è¿”å›æœŸæœ›çš„å“åº”ã€‚

### ä¿®æ”¹ Agent çš„ä¸šåŠ¡å‡½æ•°

ä½¿ç”¨ä¿®æ”¹åçš„å¤–éƒ¨å‡½æ•°ä¹‹åï¼Œåªéœ€è¦é€šè¿‡ client.run() åˆ†åˆ«è°ƒç”¨ agent\_bill å’Œ agent\_david ä¸¤ä¸ª Agentï¼Œè€Œä¸å†éœ€è¦è°ƒç”¨ agent\_gaussã€agent\_peterã€‚å› æ­¤ç¬¬ä¸€ç‰ˆå®ç°ä¸­çš„ 4 ä¸ªä¸šåŠ¡å‡½æ•°ï¼Œç°åœ¨åªéœ€è¦ 2 ä¸ªå³å¯ã€‚agent\_bill å¯¹åº”çš„ä¸šåŠ¡å‡½æ•° deal\_cards() ä¿æŒä¸å˜ï¼Œå…¶ä»– 3 ä¸ªä¸šåŠ¡å‡½æ•°ç°åœ¨åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„ä¸šåŠ¡å‡½æ•° run\_game\_one\_turn()ï¼Œå…¶å®ç°å¦‚ä¸‹ï¼š

```plain
def run_game_one_turn(last_cards_posted: str) -> str:
    global client, agent_david
    
    context_var_dict = {
        "agent_name":"GamePlayer", 
        "last_cards_posted": f"{last_cards_posted}"
    }
    response = client.run(
        agent=agent_david,
        messages=[{"role": "user", "content": get_user_prompt(context_var_dict)}],
        context_variables=context_var_dict
    )

    result = response.messages[-1]["content"]
    return result
```

### ä¿®æ”¹ main å‡½æ•°

æ–°çš„ main å‡½æ•°å®ç°å¦‚ä¸‹ï¼š

```plain
def main_func():
    old_arrays = []
    last_cards_posted = deal_cards(old_arrays)

    while True:
        result = run_game_one_turn(last_cards_posted)
        print(f"In this turn, cards posted is '{last_cards_posted}', result is '{result}'.")
        
        if result == "expression not found" or result == "Correct" or result == "deal":
            old_arrays.append(json.loads(last_cards_posted))
            last_cards_posted = deal_cards(old_arrays)
        elif result == "exit":
            print("Bye bye, have a good day!")
            break
```

å®Œæ•´çš„ä»£ç å®ç°ï¼Œåœ¨è¯¾ç¨‹ä»£ç  play\_24\_points\_game\_v2.py ä¸­ã€‚è¿è¡Œæ–¹å¼å¦‚ä¸‹ï¼š

```plain
cd ~/work/learn_swarm
run_swarm_app play_24_points_game_v2.py
```

ä»ä¸Šè¿°ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œç¬¬äºŒç‰ˆå®ç°ä¸­çš„ä¸šåŠ¡å‡½æ•°å’Œ main å‡½æ•°æ›´åŠ ç®€ç»ƒæ˜“æ‡‚ã€‚é€šè¿‡ Handoff æ¥å®ç°å·¥ä½œæµï¼Œæ¯”ä¸ç”¨ Handoff è€Œæ˜¯å®Œå…¨æ‰‹å†™çš„æ–¹å¼è¦æ›´åŠ çµæ´»ï¼Œä»£ç æ›´åŠ ç®€ç»ƒã€æ›´å®¹æ˜“ç»´æŠ¤ã€‚

## æ€»ç»“æ—¶åˆ»

åœ¨è¿™èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æœ¬è¯¾ç¨‹ä¸­å­¦ä¹ åˆ°çš„ç¬¬ä¸‰ä¸ªå¤š Agent åº”ç”¨å¼€å‘æ¡†æ¶ Swarm å®ç°äº† 24 ç‚¹æ¸¸æˆæ™ºèƒ½ä½“åº”ç”¨ã€‚ä¸ä»…å·©å›ºäº†ä¸ŠèŠ‚è¯¾çš„å­¦ä¹ æˆæœï¼Œè¿˜è®©æˆ‘ä»¬å¾ˆå¥½åœ°æŒæ¡äº† Assistants API çš„ä½¿ç”¨æ–¹æ³•ã€‚å–„ç”¨ Assistants APIï¼Œä¼šä½¿æˆ‘ä»¬çš„ LLM åº”ç”¨æ›´åŠ çµå·§ã€‚æˆ‘ä»¬ä½¿ç”¨çš„ qwen2.5 æ˜¯æœ€ä¼˜ç§€çš„å›½äº§å¼€æº LLMï¼Œå¯¹ Assistants API ä¹Ÿæœ‰å¾ˆå¥½çš„æ”¯æŒï¼Œå¦‚æœä½ å¯¹å…·ä½“ç»†èŠ‚æ„Ÿå…´è¶£çš„è¯å¯ä»¥é˜…è¯»ä¸€ä¸‹ qwen2.5 çš„å®˜æ–¹æ–‡æ¡£ï¼š[Function Calling](https://qwen.readthedocs.io/en/latest/framework/function_call.html)ã€‚

ä»æœ€è¿‘è¿™ä¸¤èŠ‚è¯¾çš„å­¦ä¹ ä¸­ï¼Œæƒ³å¿…ä½ å·²ç»ä½“éªŒåˆ° Swarm è¿™ä¸ªè¶…è½»é‡çº§å¼€å‘æ¡†æ¶çš„é­…åŠ›ã€‚è½»é‡çº§å¹¶ä¸ä»£è¡¨ç®€é™‹ï¼Œè™½ç„¶ Swarm å¼€å‘å›¢é˜Ÿåœ¨å®˜æ–¹æ–‡æ¡£ä¸­è¯´ Swarm ç›®å‰åªèƒ½ç”¨äºæ•™å­¦åœºæ™¯ï¼Œç„¶è€Œ Swarm éå¸¸çµæ´»ï¼Œä¹Ÿéå¸¸å®ç”¨ï¼Œå…¶å®åŠ ä»¥æ‰©å……ä¹‹åä¹Ÿå¯ä»¥ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚å§‹ç»ˆåšæŒç”¨æ›´ç®€å•ã€æ›´æœ‰æ•ˆç‡çš„æ–¹å¼æ¥å®ç°çœŸå®çš„ä¸šåŠ¡éœ€æ±‚ï¼Œæ‰èƒ½ç¡®ä¿æˆ‘ä»¬åœ¨æ¿€çƒˆç«äº‰çš„ç¯å¢ƒä¸­ç«‹äºä¸è´¥ä¹‹åœ°ã€‚

è¿™ä¸€è¯¾å­¦ä¹ å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å·²ç»æŒæ¡äº†ä¸‰ä¸ªå¾ˆæ£’çš„å¤š Agent å¼€å‘æ¡†æ¶çš„ä½¿ç”¨æ–¹æ³•ï¼Œä¹Ÿåœ¨å¼€å‘ 24 ç‚¹æ¸¸æˆæ™ºèƒ½ä½“åº”ç”¨çš„è¿‡ç¨‹ä¸­ç§¯ç´¯äº†ä¸å°‘å®æˆ˜ç»éªŒã€‚è¿™äº›ç»éªŒä¸ºæˆ‘ä»¬ç»§ç»­æ·±å…¥æ¢ç´¢å¼€å‘å¤š Agent åä½œçš„ Autonomous Agent åº”ç”¨å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚å¼€å‘ Autonomous AI åº”ç”¨ï¼Œå…¶å®å°±æ˜¯ AI é¢†åŸŸå‡ åå¹´ä»¥æ¥çš„ä¸€ä¸ªé‡è¦ç›®æ ‡ï¼Œæœªæ¥ä¼šæœ‰éå¸¸å¹¿é˜”çš„åº”ç”¨åœºæ™¯ã€‚

åœ¨ä¸‹ä¸€è¯¾ä¸­æˆ‘å°†å¼€å¯ä¸€ä¸ªå…¨æ–°çš„é¢†åŸŸï¼Œå¸¦ä½ å­¦ä¹ ä¸€ä¸ª**è‡ªåŠ¨æç¤ºè¯å·¥ç¨‹**å¼€å‘æ¡†æ¶ DSPy ã€‚è¿™ä¹Ÿæ˜¯ LLM åº”ç”¨å¼€å‘æ–¹é¢ä¸€ä¸ªæ–¹å…´æœªè‰¾çš„é¢†åŸŸã€‚

## æ€è€ƒé¢˜

ç¬¬äºŒç‰ˆçš„å®ç°è¿˜æœ‰ä»€ä¹ˆä¸è¶³ä¹‹å¤„ï¼Œè¿˜å¯ä»¥ç»§ç»­æ”¹è¿›å—ï¼Ÿå‡å¦‚ä¸º GameDealer ä¹Ÿè®¾ç½®ä¸€ä¸ªå¤–éƒ¨å‡½æ•°ï¼Œå°†å…¶ä¸ GamePlayer è¿æ¥èµ·æ¥ï¼Œmain å‡½æ•°æ˜¯ä¸æ˜¯ä¼šæ›´åŠ ç®€ç»ƒï¼Ÿ

æœŸå¾…ä½ çš„åˆ†äº«ã€‚å¦‚æœä»Šå¤©çš„å†…å®¹å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œä¹ŸæœŸå¾…ä½ è½¬å‘ç»™ä½ çš„åŒäº‹æˆ–è€…æœ‹å‹ï¼Œå¤§å®¶ä¸€èµ·å­¦ä¹ ï¼Œå…±åŒè¿›æ­¥ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼

**å°ç¼–ç•™è¨€**ï¼šé©¬ä¸Šå°±è¦åˆ°æ˜¥èŠ‚å‡æœŸå•¦ï¼ç¥å¤§å®¶æ–°æ˜¥å¤§å‰ï¼Œæ˜¥èŠ‚æœŸé—´æˆ‘ä»¬çš„è¯¾ç¨‹æš‚åœæ›´æ–°ï¼Œåˆ°2æœˆ5æ—¥0ç‚¹æ¢å¤æ­£å¸¸æ›´æ–°ã€‚å¸Œæœ›æ˜¥èŠ‚æœŸé—´ä½ å¯ä»¥å¥½å¥½ä¼‘æ¯ï¼Œåˆå®¶å›¢åœ†ï¼
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ2ï¼‰</strong></div><ul>
<li><span>ç³ç²‘ä¸æ˜¯é¥­</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>è€å¸ˆæ‚¨å¥½ï¼Œè¯·é—®è¿™æ˜¯ä»€ä¹ˆåŸå› é€ æˆçš„å‘¢ï¼Ÿ
å®šä¹‰ç©å®¶ agent, æœ‰å‡½æ•° get_human_reply_funcè·å– ç”¨æˆ·è¾“å…¥ã€‚
```python
agent_david = Agent(
    name=&quot;GamePlayer&quot;,
    instructions=get_instruction,
    model=&quot;qwen2.5&quot;,
    functions=[get_human_reply_func],
)
``` 

è¿è¡Œagent è¿™é‡Œï¼Œè¿™é‡Œæœ‰ user_prompt.
```python
    response = client.run(
        agent=agent_david,
        messages=[{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: get_user_prompt(context_var_dict)}],
        context_variables=context_var_dict
    )
    for message in response.messages:
        print(f&quot;message is: {message}&quot;)
    human_reply = response.messages[-1][&quot;content&quot;]
    print(human_reply)
    return human_reply
```
æ˜¯ client.run() è¿è¡Œåï¼Œæ˜¯å…ˆè¿è¡Œçš„ get_human_reply_func å—ï¼Ÿ ç„¶åå†å»è·å– user_prompt?  ä¸ºä»€ä¹ˆresponse ä¼šæœ‰å¥½å‡ ä¸ªå‘¢ï¼ˆæ•°å­¦è¡¨è¾¾å¼ä¹Ÿæ•è·äº†ï¼Œdeal ä¹Ÿé”™è¯¯æ•è·äº†ï¼‰ï¼Ÿ</p>2025-02-17</li><br/><li><span>YX</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>åœ¨ä½¿ç”¨GamePlayerçš„æ—¶å€™ï¼Œå‘ç°ä¸çŸ¥é“ä»€ä¹ˆåŸå› ï¼Œå½“è¾“å…¥ç®—æœ¯è¡¨è¾¾å¼çš„æ—¶å€™ï¼Œæ¨¡å‹æœ€åä¼šè¿”å›dealï¼Œæˆ‘ç¨å¾®æŠŠæç¤ºè¯æ”¹äº†ä¸‹ï¼š
What&#39;s the human reply of {last_cards_posted}? Just return the human reply itself and do not add anything else, such as &#39;The human reply ...&#39;. If the input is an arithmetic expression, return it as is.</p>2025-02-01</li><br/>
</ul>