ä»Šå¤©æˆ‘ä»¬åšä¸€ä¸ªæ•°æ®å¯è§†åŒ–çš„é¡¹ç›®ã€‚

æˆ‘ä»¬ç»å¸¸éœ€è¦å¯¹åˆ†æçš„æ•°æ®æå–å¸¸ç”¨è¯ï¼Œåšè¯äº‘å±•ç¤ºã€‚æ¯”å¦‚ä¸€äº›äº’è”ç½‘å…¬å¸ä¼šæŠ“å–ç”¨æˆ·çš„ç”»åƒï¼Œæˆ–è€…æ¯æ—¥è®¨è®ºè¯é¢˜çš„å…³é”®è¯ï¼Œå½¢æˆè¯äº‘å¹¶è¿›è¡Œå±•ç¤ºã€‚å†æˆ–è€…ï¼Œå‡å¦‚ä½ å–œæ¬¢æŸä¸ªæ­Œæ‰‹ï¼Œæƒ³äº†è§£è¿™ä¸ªæ­Œæ‰‹åˆ›ä½œçš„æ­Œæ›²ä¸­ç»å¸¸ç”¨åˆ°å“ªäº›è¯è¯­ï¼Œè¯äº‘å°±æ˜¯ä¸ªå¾ˆå¥½çš„å·¥å…·ã€‚æœ€åï¼Œåªéœ€è¦å°†è¯äº‘ç”Ÿæˆä¸€å¼ å›¾ç‰‡å°±å¯ä»¥ç›´è§‚åœ°çœ‹åˆ°ç»“æœã€‚

é‚£ä¹ˆåœ¨ä»Šå¤©çš„å®æˆ˜é¡¹ç›®é‡Œï¼Œæœ‰3ä¸ªç›®æ ‡éœ€è¦æŒæ¡ï¼š

1. æŒæ¡è¯äº‘åˆ†æå·¥å…·ï¼Œå¹¶è¿›è¡Œå¯è§†åŒ–å‘ˆç°ï¼›
2. æŒæ¡Pythonçˆ¬è™«ï¼Œå¯¹ç½‘é¡µçš„æ•°æ®è¿›è¡Œçˆ¬å–ï¼›
3. æŒæ¡XPathå·¥å…·ï¼Œåˆ†ææå–æƒ³è¦çš„å…ƒç´  ã€‚

## å¦‚ä½•åˆ¶ä½œè¯äº‘

é¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£ä»€ä¹ˆæ˜¯è¯äº‘ã€‚è¯äº‘ä¹Ÿå«æ–‡å­—äº‘ï¼Œå®ƒå¸®åŠ©æˆ‘ä»¬ç»Ÿè®¡æ–‡æœ¬ä¸­é«˜é¢‘å‡ºç°çš„è¯ï¼Œè¿‡æ»¤æ‰æŸäº›å¸¸ç”¨è¯ï¼ˆæ¯”å¦‚â€œä½œæ›²â€â€œä½œè¯â€ï¼‰ï¼Œå°†æ–‡æœ¬ä¸­çš„é‡è¦å…³é”®è¯è¿›è¡Œå¯è§†åŒ–ï¼Œæ–¹ä¾¿åˆ†æè€…æ›´å¥½æ›´å¿«åœ°äº†è§£æ–‡æœ¬çš„é‡ç‚¹ï¼ŒåŒæ—¶è¿˜å…·æœ‰ä¸€å®šçš„ç¾è§‚åº¦ã€‚

Pythonæä¾›äº†è¯äº‘å·¥å…·WordCloudï¼Œä½¿ç”¨pip install wordcloudå®‰è£…åï¼Œå°±å¯ä»¥åˆ›å»ºä¸€ä¸ªè¯äº‘ï¼Œæ„é€ æ–¹æ³•å¦‚ä¸‹ï¼š

```
wc = WordCloud(
    background_color='white',# è®¾ç½®èƒŒæ™¯é¢œè‰²
    mask=backgroud_Image,# è®¾ç½®èƒŒæ™¯å›¾ç‰‡
    font_path='./SimHei.ttf',  # è®¾ç½®å­—ä½“ï¼Œé’ˆå¯¹ä¸­æ–‡çš„æƒ…å†µéœ€è¦è®¾ç½®ä¸­æ–‡å­—ä½“ï¼Œå¦åˆ™æ˜¾ç¤ºä¹±ç 
    max_words=100, # è®¾ç½®æœ€å¤§çš„å­—æ•°
    stopwords=STOPWORDS,# è®¾ç½®åœç”¨è¯
	max_font_size=150,# è®¾ç½®å­—ä½“æœ€å¤§å€¼
	width=2000,# è®¾ç½®ç”»å¸ƒçš„å®½åº¦
	height=1200,# è®¾ç½®ç”»å¸ƒçš„é«˜åº¦
    random_state=30# è®¾ç½®å¤šå°‘ç§éšæœºçŠ¶æ€ï¼Œå³å¤šå°‘ç§é¢œè‰²
)
```

å®é™…ä¸ŠWordCloudè¿˜æœ‰æ›´å¤šçš„æ„é€ å‚æ•°ï¼Œä»£ç é‡Œå±•ç¤ºçš„æ˜¯ä¸€äº›ä¸»è¦å‚æ•°ï¼Œæˆ‘åœ¨ä»£ç ä¸­éƒ½æœ‰æ³¨é‡Šï¼Œä½ å¯ä»¥è‡ªå·±çœ‹ä¸‹ã€‚

åˆ›å»ºå¥½WordCloudç±»ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨wordcloud=generate(text)æ–¹æ³•ç”Ÿæˆè¯äº‘ï¼Œä¼ å…¥çš„å‚æ•°textä»£è¡¨ä½ è¦åˆ†æçš„æ–‡æœ¬ï¼Œæœ€åä½¿ç”¨wordcloud.tofile(â€œa.jpgâ€)å‡½æ•°ï¼Œå°†å¾—åˆ°çš„è¯äº‘å›¾åƒç›´æ¥ä¿å­˜ä¸ºå›¾ç‰‡æ ¼å¼æ–‡ä»¶ã€‚

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨Pythonçš„å¯è§†åŒ–å·¥å…·Matplotlibè¿›è¡Œæ˜¾ç¤ºï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š

```
import matplotlib.pyplot as plt
plt.imshow(wordcloud)
plt.axis("off")
plt.show()
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ˜¾ç¤ºXè½´å’ŒYè½´çš„åæ ‡ï¼Œä½¿ç”¨plt.axis(â€œoffâ€)å¯ä»¥å°†åæ ‡è½´å…³é—­ã€‚

äº†è§£äº†å¦‚ä½•ä½¿ç”¨è¯äº‘å·¥å…·WordCloudä¹‹åï¼Œæˆ‘ä»¬å°†ä¸“æ å‰15èŠ‚çš„æ ‡é¢˜è¿›è¡Œè¯äº‘å¯è§†åŒ–ï¼Œå…·ä½“çš„ä»£ç å¦‚ä¸‹ï¼š

```
#-*- coding:utf-8 -*-
from wordcloud import WordCloud
import matplotlib.pyplot as plt
import jieba
from PIL import Image
import numpy as np
# ç”Ÿæˆè¯äº‘
def create_word_cloud(f):
     print('æ ¹æ®è¯é¢‘è®¡ç®—è¯äº‘')
     text = " ".join(jieba.cut(f,cut_all=False, HMM=True))
     wc = WordCloud(
           font_path="./SimHei.ttf",
           max_words=100,
           width=2000,
           height=1200,
    )
     wordcloud = wc.generate(text)
     # å†™è¯äº‘å›¾ç‰‡
     wordcloud.to_file("wordcloud.jpg")
     # æ˜¾ç¤ºè¯äº‘æ–‡ä»¶
     plt.imshow(wordcloud)
     plt.axis("off")
     plt.show()

f = 'æ•°æ®åˆ†æå…¨æ™¯å›¾åŠä¿®ç‚¼æŒ‡å—\
å­¦ä¹ æ•°æ®æŒ–æ˜çš„æœ€ä½³å­¦ä¹ è·¯å¾„æ˜¯ä»€ä¹ˆï¼Ÿ\
PythonåŸºç¡€è¯­æ³•ï¼šå¼€å§‹ä½ çš„Pythonä¹‹æ—…\
Pythonç§‘å­¦è®¡ç®—ï¼šNumPy\
Pythonç§‘å­¦è®¡ç®—ï¼šPandas\
å­¦ä¹ æ•°æ®åˆ†æè¦æŒæ¡å“ªäº›åŸºæœ¬æ¦‚å¿µï¼Ÿ\
ç”¨æˆ·ç”»åƒï¼šæ ‡ç­¾åŒ–å°±æ˜¯æ•°æ®çš„æŠ½è±¡èƒ½åŠ›\
æ•°æ®é‡‡é›†ï¼šå¦‚ä½•è‡ªåŠ¨åŒ–é‡‡é›†æ•°æ®ï¼Ÿ\
æ•°æ®é‡‡é›†ï¼šå¦‚ä½•ç”¨å…«çˆªé±¼é‡‡é›†å¾®åšä¸Šçš„â€œD&Gâ€è¯„è®ºï¼Ÿ\
Pythonçˆ¬è™«ï¼šå¦‚ä½•è‡ªåŠ¨åŒ–ä¸‹è½½ç‹ç¥–è´¤æµ·æŠ¥ï¼Ÿ\
æ•°æ®æ¸…æ´—ï¼šæ•°æ®ç§‘å­¦å®¶80%æ—¶é—´éƒ½èŠ±è´¹åœ¨äº†è¿™é‡Œï¼Ÿ\
æ•°æ®é›†æˆï¼šè¿™äº›å¤§å·ä¸€å…±20äº¿ç²‰ä¸ï¼Ÿ\
æ•°æ®å˜æ¢ï¼šå¤§å­¦æˆç»©è¦æ±‚æ­£æ€åˆ†å¸ƒåˆç†ä¹ˆï¼Ÿ\
æ•°æ®å¯è§†åŒ–ï¼šæŒæ¡æ•°æ®é¢†åŸŸçš„ä¸‡é‡‘æ²¹æŠ€èƒ½\
ä¸€æ¬¡å­¦ä¼šPythonæ•°æ®å¯è§†åŒ–çš„10ç§æŠ€èƒ½'
```

è¿è¡Œç»“æœï¼š  
![](https://static001.geekbang.org/resource/image/49/34/49b2c6a27345777922db4b6e31110434.png?wh=1725%2A1035)  
ä½ èƒ½ä»ç»“æœä¸­çœ‹å‡ºï¼Œè¿˜æ˜¯æœ‰ä¸€äº›å¸¸ç”¨è¯æ˜¾ç¤ºå‡ºæ¥äº†ï¼Œæ¯”å¦‚â€œä»€ä¹ˆâ€â€œè¦æ±‚â€â€œè¿™äº›â€ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›è¯è®¾ç½®ä¸ºåœç”¨è¯ï¼Œç¼–å†™remove\_stop\_wordså‡½æ•°ï¼Œä»æ–‡æœ¬ä¸­å»æ‰ï¼š

```
# å»æ‰åœç”¨è¯
def remove_stop_words(f):
     stop_words = ['å­¦ä¼š', 'å°±æ˜¯', 'ä»€ä¹ˆ']
     for stop_word in stop_words:
           f = f.replace(stop_word, '')
     return f
```

ç„¶ååœ¨ç»“ç®—è¯äº‘å‰è°ƒç”¨f = remove\_stop\_words(f)æ–¹æ³•ï¼Œæœ€åè¿è¡Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„ç»“æœï¼š

![](https://static001.geekbang.org/resource/image/d0/ed/d0bd9cde1e1c0638976cef26b519fded.png?wh=1725%2A1035)  
ä½ èƒ½çœ‹å‡ºï¼Œå»æ‰åœç”¨è¯ä¹‹åçš„è¯äº‘æ›´åŠ æ¸…æ™°ï¼Œæ›´èƒ½ä½“ç°å‰15ç« çš„ä¸»è¦å†…å®¹ã€‚

## ç»™æ¯›ä¸æ˜“çš„æ­Œè¯åˆ¶ä½œè¯äº‘

å‡è®¾æˆ‘ä»¬ç°åœ¨è¦ç»™æ¯›ä¸æ˜“çš„æ­Œè¯åšä¸ªè¯äº‘ï¼Œé‚£ä¹ˆéœ€è¦æ€ä¹ˆåšå‘¢ï¼Ÿæˆ‘ä»¬å…ˆæŠŠæ•´ä¸ªé¡¹ç›®çš„æµç¨‹æ¢³ç†ä¸‹ï¼š

![](https://static001.geekbang.org/resource/image/7c/97/7cff33b392cec653ca2e68fbecd4ef97.jpg?wh=2337%2A776)

1. åœ¨å‡†å¤‡é˜¶æ®µï¼šæˆ‘ä»¬ä¸»è¦ä½¿ç”¨Pythonçˆ¬è™«è·å–HTMLï¼Œç”¨XPathå¯¹æ­Œæ›²çš„IDã€åç§°è¿›è¡Œè§£æï¼Œç„¶åé€šè¿‡ç½‘æ˜“äº‘éŸ³ä¹çš„APIæ¥å£è·å–æ¯é¦–æ­Œçš„æ­Œè¯ï¼Œæœ€åå°†æ‰€æœ‰çš„æ­Œè¯åˆå¹¶å¾—åˆ°ä¸€ä¸ªå˜é‡ã€‚
2. åœ¨è¯äº‘åˆ†æé˜¶æ®µï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºWordCloudè¯äº‘ç±»ï¼Œåˆ†æå¾—åˆ°çš„æ­Œè¯æ–‡æœ¬ï¼Œæœ€åå¯è§†åŒ–ã€‚

åŸºäºä¸Šé¢çš„æµç¨‹ï¼Œç¼–å†™ä»£ç å¦‚ä¸‹ï¼š

```
# -*- coding:utf-8 -*-
# ç½‘æ˜“äº‘éŸ³ä¹ é€šè¿‡æ­Œæ‰‹IDï¼Œç”Ÿæˆè¯¥æ­Œæ‰‹çš„è¯äº‘
import requests
import sys
import re
import os
from wordcloud import WordCloud
import matplotlib.pyplot as plt
import jieba
from PIL import Image
import numpy as np
from lxml import etree
 
headers = {
       'Referer'  :'http://music.163.com',
       'Host'     :'music.163.com',
       'Accept'   :'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
       'User-Agent':'Chrome/10'
    }
 
# å¾—åˆ°æŸä¸€é¦–æ­Œçš„æ­Œè¯
def get_song_lyric(headers,lyric_url):
    res = requests.request('GET', lyric_url, headers=headers)
    if 'lrc' in res.json():
       lyric = res.json()['lrc']['lyric']
       new_lyric = re.sub(r'[\d:.[\]]','',lyric)
       return new_lyric
    else:
       return ''
       print(res.json())
# å»æ‰åœç”¨è¯
def remove_stop_words(f):
    stop_words = ['ä½œè¯', 'ä½œæ›²', 'ç¼–æ›²', 'Arranger', 'å½•éŸ³', 'æ··éŸ³', 'äººå£°', 'Vocal', 'å¼¦ä¹', 'Keyboard', 'é”®ç›˜', 'ç¼–è¾‘', 'åŠ©ç†', 'Assistants', 'Mixing', 'Editing', 'Recording', 'éŸ³ä¹', 'åˆ¶ä½œ', 'Producer', 'å‘è¡Œ', 'produced', 'and', 'distributed']
    for stop_word in stop_words:
       f = f.replace(stop_word, '')
    return f
# ç”Ÿæˆè¯äº‘
def create_word_cloud(f):
    print('æ ¹æ®è¯é¢‘ï¼Œå¼€å§‹ç”Ÿæˆè¯äº‘!')
    f = remove_stop_words(f)
    cut_text = " ".join(jieba.cut(f,cut_all=False, HMM=True))
    wc = WordCloud(
       font_path="./wc.ttf",
       max_words=100,
       width=2000,
       height=1200,
    )
    print(cut_text)
    wordcloud = wc.generate(cut_text)
    # å†™è¯äº‘å›¾ç‰‡
    wordcloud.to_file("wordcloud.jpg")
    # æ˜¾ç¤ºè¯äº‘æ–‡ä»¶
    plt.imshow(wordcloud)
    plt.axis("off")
    plt.show()
# å¾—åˆ°æŒ‡å®šæ­Œæ‰‹é¡µé¢ çƒ­é—¨å‰50çš„æ­Œæ›²IDï¼Œæ­Œæ›²å
def get_songs(artist_id):
    page_url = 'https://music.163.com/artist?id=' + artist_id
    # è·å–ç½‘é¡µHTML
    res = requests.request('GET', page_url, headers=headers)
    # ç”¨XPathè§£æ å‰50é¦–çƒ­é—¨æ­Œæ›²
    html = etree.HTML(res.text)
    href_xpath = "//*[@id='hotsong-list']//a/@href"
    name_xpath = "//*[@id='hotsong-list']//a/text()"
    hrefs = html.xpath(href_xpath)
    names = html.xpath(name_xpath)
    # è®¾ç½®çƒ­é—¨æ­Œæ›²çš„IDï¼Œæ­Œæ›²åç§°
    song_ids = []
    song_names = []
    for href, name in zip(hrefs, names):
       song_ids.append(href[9:])
       song_names.append(name)
       print(href, '  ', name)
    return song_ids, song_names
# è®¾ç½®æ­Œæ‰‹IDï¼Œæ¯›ä¸æ˜“ä¸º12138269
artist_id = '12138269'
[song_ids, song_names] = get_songs(artist_id)
# æ‰€æœ‰æ­Œè¯
all_word = ''
# è·å–æ¯é¦–æ­Œæ­Œè¯
for (song_id, song_name) in zip(song_ids, song_names):
    # æ­Œè¯API URL
    lyric_url = 'http://music.163.com/api/song/lyric?os=pc&id=' + song_id + '&lv=-1&kv=-1&tv=-1'
    lyric = get_song_lyric(headers, lyric_url)
    all_word = all_word + ' ' + lyric
    print(song_name)
#æ ¹æ®è¯é¢‘ ç”Ÿæˆè¯äº‘
create_word_cloud(all_word)
```

è¿è¡Œç»“æœï¼š

![](https://static001.geekbang.org/resource/image/ee/2c/ee24610141c2722660f2e4cb5824802c.png?wh=1725%2A1035)  
è¿™ä¸ªè¿‡ç¨‹é‡Œæœ‰ä¸€äº›æ¨¡å—ï¼Œæˆ‘éœ€è¦è¯´æ˜ä¸‹ã€‚

é¦–å…ˆæˆ‘ç¼–å†™get\_songså‡½æ•°ï¼Œå¯ä»¥å¾—åˆ°æŒ‡å®šæ­Œæ‰‹é¡µé¢ä¸­çƒ­é—¨å‰50çš„æ­Œæ›²IDï¼Œæ­Œæ›²åã€‚åœ¨è¿™ä¸ªå‡½æ•°é‡Œï¼Œæˆ‘ä½¿ç”¨requests.requestå‡½æ•°è·å–æ¯›ä¸æ˜“æ­Œæ‰‹é¡µé¢çš„HTMLã€‚è¿™é‡Œéœ€è¦ä¼ å…¥æŒ‡å®šçš„è¯·æ±‚å¤´ï¼ˆheadersï¼‰ï¼Œå¦åˆ™è·å–ä¸åˆ°å®Œæ•´çš„ä¿¡æ¯ã€‚ç„¶åç”¨XPathè§£æå¹¶è·å–æŒ‡å®šçš„å†…å®¹ï¼Œè¿™ä¸ªæ¨¡å—ä¸­ï¼Œæˆ‘æƒ³è·å–çš„æ˜¯æ­Œæ›²çš„é“¾æ¥å’Œåç§°ã€‚

å…¶ä¸­æ­Œæ›²çš„é“¾æ¥ç±»ä¼¼ /song?id=536099160 è¿™ç§å½¢å¼ï¼Œä½ èƒ½çœ‹åˆ°å­—ç¬¦ä¸²ç¬¬9ä½ä¹‹åï¼Œå°±æ˜¯æ­Œæ›²çš„IDã€‚

æœ‰å…³XPathè§£æçš„å†…å®¹ï¼Œæˆ‘åœ¨[ç¬¬10èŠ‚](https://time.geekbang.org/column/article/76001)è®²åˆ°è¿‡ï¼Œå¦‚æœä½ å¿˜è®°äº†ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒXPathè§£æ 99%çš„å¯èƒ½éƒ½æ˜¯ä»¥//å¼€å¤´ï¼Œå› ä¸ºä½ éœ€è¦è·å–æ‰€æœ‰ç¬¦åˆè¿™ä¸ªXPathçš„å†…å®¹ã€‚æˆ‘ä»¬é€šè¿‡åˆ†æHTMLä»£ç ï¼Œèƒ½çœ‹åˆ°ä¸€ä¸ªå…³é”®çš„éƒ¨åˆ†ï¼šid=â€˜hotsong-listâ€™ã€‚è¿™ä¸ªä»£è¡¨çƒ­é—¨æ­Œæ›²åˆ—è¡¨ï¼Œä¹Ÿæ­£æ˜¯æˆ‘ä»¬æƒ³è¦è§£æçš„å†…å®¹ã€‚æˆ‘ä»¬æƒ³è¦è·å–è¿™ä¸ªçƒ­é—¨æ­Œæ›²åˆ—è¡¨ä¸‹é¢æ‰€æœ‰çš„é“¾æ¥ï¼ŒXPathè§£æå°±å¯ä»¥å†™æˆ//\*\[@id=â€˜hotsong-listâ€™]//aã€‚ç„¶åä½ èƒ½çœ‹åˆ°æ­Œæ›²é“¾æ¥æ˜¯hrefå±æ€§ï¼Œæ­Œæ›²åç§°æ˜¯è¿™ä¸ªé“¾æ¥çš„æ–‡æœ¬ã€‚

è·å¾—æ­Œæ›²IDä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“è¿™ä¸ªæ­Œæ›²çš„æ­Œè¯ï¼Œå¯¹åº”ä»£ç ä¸­çš„get\_song\_lyricå‡½æ•°ï¼Œåœ¨è¿™ä¸ªå‡½æ•°é‡Œè°ƒç”¨äº†ç½‘æ˜“äº‘çš„æ­Œè¯APIæ¥å£ï¼Œæ¯”å¦‚[http://music.163.com/api/song/lyric?os=pc&amp;id=536099160&amp;lv=-1&amp;kv=-1&amp;tv=-1](http://music.163.com/api/song/lyric?os=pc&id=536099160&lv=-1&kv=-1&tv=-1)ã€‚

ä½ èƒ½çœ‹åˆ°æ­Œè¯æ–‡ä»¶é‡Œé¢è¿˜ä¿å­˜äº†æ—¶é—´ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦å»æ‰è¿™éƒ¨åˆ†ã€‚å› æ­¤æˆ‘ä½¿ç”¨äº†re.subå‡½æ•°ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œå°†\[]ä¸­æ•°å­—ä¿¡æ¯å»æ‰ï¼Œæ–¹æ³•ä¸ºre.sub(râ€™\[\\d:.\[]]â€™,â€™â€™,lyric)ã€‚

æœ€åæˆ‘ä»¬è¿˜éœ€è¦è®¾ç½®ä¸€äº›æ­Œè¯ä¸­å¸¸ç”¨çš„åœç”¨è¯ï¼Œæ¯”å¦‚â€œä½œè¯â€â€œä½œæ›²â€â€œç¼–æ›²â€ç­‰ï¼Œç¼–å†™remove\_stop\_wordså‡½æ•°ï¼Œå°†æ­Œè¯æ–‡æœ¬ä¸­çš„åœç”¨è¯å»æ‰ã€‚

æœ€åç¼–å†™create\_word\_cloudå‡½æ•°ï¼Œé€šè¿‡æ­Œè¯æ–‡æœ¬ç”Ÿæˆè¯äº‘æ–‡ä»¶ã€‚

## æ€»ç»“

ä»Šå¤©æˆ‘ç»™ä½ è®²äº†è¯äº‘çš„å¯è§†åŒ–ã€‚åœ¨è¿™ä¸ªå®æˆ˜ä¸­ï¼Œä½ èƒ½çœ‹åˆ°å‰æœŸçš„æ•°æ®å‡†å¤‡åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­å äº†å¾ˆå¤§ä¸€éƒ¨åˆ†ã€‚å¦‚æœä½ ç”¨Pythonä½œä¸ºæ•°æ®é‡‡é›†å·¥å…·ï¼Œå°±éœ€è¦æŒæ¡Pythonçˆ¬è™«å’ŒXPathè§£æï¼ŒæŒæ¡è¿™ä¸¤ä¸ªå·¥å…·æœ€å¥½çš„æ–¹å¼å°±æ˜¯å¤šåšç»ƒä¹ ã€‚

æˆ‘ä»¬ä»Šå¤©è®²åˆ°äº†è¯äº‘å·¥å…·WordCloudï¼Œå®ƒæ˜¯ä¸€ä¸ªå¾ˆå¥½ç”¨çš„Pythonå·¥å…·ï¼Œå¯ä»¥å°†å¤æ‚çš„æ–‡æœ¬é€šè¿‡è¯äº‘å›¾çš„æ–¹å¼å‘ˆç°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸­æ–‡å­—ä½“çš„æ—¶å€™ï¼Œæ¯”å¦‚é»‘ä½“SimHeiï¼Œå°±å¯ä»¥å°†WordCloudä¸­çš„font\_pathå±æ€§è®¾ç½®ä¸ºSimHei.ttfï¼Œä½ ä¹Ÿå¯ä»¥è®¾ç½®å…¶ä»–è‰ºæœ¯å­—ä½“ï¼Œåœ¨ç»™æ¯›ä¸æ˜“çš„æ­Œè¯åšè¯äº‘å±•ç¤ºçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ç”¨åˆ°äº†è‰ºæœ¯å­—ä½“ã€‚

ä½ å¯ä»¥ä»GitHubä¸Šä¸‹è½½å­—ä½“å’Œä»£ç ï¼š[https://github.com/cystanford/word\_cloud](https://github.com/cystanford/word_cloud)ã€‚

![](https://static001.geekbang.org/resource/image/0c/6d/0cbc5f3e4ecd41af9a872fd9b4aed06d.png?wh=1728%2A939)  
æœ€åç»™ä½ ç•™ä¸€é“æ€è€ƒé¢˜å§ã€‚æˆ‘æŠ“å–äº†æ¯›ä¸æ˜“ä¸»é¡µçš„æ­Œè¯ï¼Œæ˜¯ä»¥æ­Œæ‰‹ä¸»é¡µä¸ºç²’åº¦è¿›è¡Œçš„è¯äº‘å¯è§†åŒ–ã€‚å®é™…ä¸Šç½‘æ˜“äº‘éŸ³ä¹ä¹Ÿæœ‰æ­Œå•çš„APIï¼Œæ¯”å¦‚[http://music.163.com/api/playlist/detail?id=753776811](http://music.163.com/api/playlist/detail?id=753776811)ã€‚ä½ èƒ½ä¸èƒ½ç¼–å†™ä»£ç å¯¹æ­Œå•åšä¸ªè¯äº‘å±•ç¤ºï¼ˆæ¯”å¦‚æ­Œå•IDä¸º753776811ï¼‰å‘¢ï¼Ÿ

æ¬¢è¿ä½ åœ¨è¯„è®ºåŒºä¸æˆ‘åˆ†äº«ä½ çš„ç­”æ¡ˆï¼Œä¹Ÿæ¬¢è¿ç‚¹å‡»â€œè¯·æœ‹å‹è¯»â€ï¼ŒæŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–è€…åŒäº‹ã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ15ï¼‰</strong></div><ul>
<li><span>third</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>from wordcloud import WordCloud
import matplotlib.pyplot as plt
import requests

headers = {
    &#39;Referer&#39;: &#39;http:&#47;&#47;music.163.com&#39;,
    &#39;Host&#39;: &#39;music.163.com&#39;,
    &#39;Accept&#39;: &#39;text&#47;html,application&#47;xhtml+xml,application&#47;xml;q=0.9,image&#47;webp,image&#47;apng,*&#47;*;q=0.8&#39;,
    &#39;User-Agent&#39;: &#39;Chrome&#47;10&#39;
}


def getsong(headers):
    url = &#39;http:&#47;&#47;music.163.com&#47;api&#47;playlist&#47;detail?id=753776811&#39;
    res = requests.request(&#39;GET&#39;, url, headers=headers)
    page = res.json()
    tracks=page[&#39;result&#39;][&#39;tracks&#39;]
    list = []
    for i in range(len(tracks)):
        Name = tracks[i][&quot;name&quot;]
        list.append(Name)
    return list


def create_WordCloud(list):
    print(&quot;æ ¹æºè¯é¢‘è®¡ç®—è¯äº‘&quot;)

    wc = WordCloud(
        font_path=&quot;simhei.ttf&quot;,
        max_words=100,  # è®¾ç½®æœ€å¤§å­—æ•°
        width=2000,  # è®¾ç½®ç”»å¸ƒå®½åº¦
        height=1200,  # è®¾ç½®ç”»å¸ƒé«˜åº¦
        random_state=100
    )
    wordcloud = wc.generate(list)
    # å†™è¯äº‘å›¾ç‰‡
    wordcloud.to_file(&quot;ä½œä¸š.jpg&quot;)
    # æ˜¾ç¤ºè¯äº‘æ–‡ä»¶
    plt.imshow(wordcloud)
    # ä¸éœ€è¦æ˜¾ç¤ºX&#47;Yè½´ï¼Œç”¨offå°†åæ ‡è½´å…³é—­
    plt.axis(&quot;off&quot;)
    plt.show()


# å»æ‰åœç”¨è¯ä»¥åŠä¸­è‹±æ–‡æ··åˆçš„è¯
def remove_stop_words(f):
    stop_words = [&#39;(ä¼´å¥)&#39;, &#39;(Demoç‰ˆ)&#39;, &#39;(å¿…èƒœå®¢æ–°æ˜¥ç‰ˆ)&#39;]
    mixed_words = [&#39;Bonus Trackï¼šä¸€è¤ä¸€ç´ &#39;, &#39;Bonus Trackï¼šç»™ä½ ç»™æˆ‘&#39;]
    for stop_word in stop_words:
        f = f.replace(stop_word, &#39;&#39;)
    for mixed_word in mixed_words:
        f = f.replace(mixed_word, mixed_word[12:])
    return f

gerlists = getsong(headers)
# è·å–æ­Œå•æ˜¯listç±»å‹ç›´æ¥è½¬åŒ–ä¸ºè½¬æ¢ä¸ºstr
lists_str = &quot; &quot;.join(gerlists)

lists = remove_stop_words(lists_str)
create_WordCloud(lists)</p>2019-03-20</li><br/><li><span>Geek_hve78z</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>
ï¼ˆ2ï¼‰å°†æ­Œå•çš„æ­Œæ›²å¯¹åº”çš„æ­Œè¯ä½œè¯äº‘å±•ç¤º
import requests
import jieba
from wordcloud import WordCloud
import matplotlib.pyplot as plt


#å¾—åˆ°æŒ‡å®šæ­Œå•é¡µé¢çš„ å…¨éƒ¨æ­Œæ›²çš„æ­Œæ›²IDï¼Œæ­Œæ›²å
def get_songs(playlist_id):
    page_url=&#39;http:&#47;&#47;music.163.com&#47;api&#47;playlist&#47;detail?id=&#39;+playlist_id
    #è·å–ç½‘é¡µHTML
    res=requests.request(&#39;GET&#39;,page_url,headers=headers)
    # è¾“å‡ºæ­Œå•ä¸­æ­Œæ›²æ•°é‡
    print(len(res.json()[&#39;result&#39;][&#39;tracks&#39;]))

    # è®¾ç½®çƒ­é—¨æ­Œæ›²çš„IDï¼Œæ­Œæ›²åç§°
    song_ids=[]
    song_names=[]

    for i in range(len(res.json()[&#39;result&#39;][&#39;tracks&#39;])):
        names=res.json()[&#39;result&#39;][&#39;tracks&#39;][i][&#39;name&#39;]
        ids=res.json()[&#39;result&#39;][&#39;tracks&#39;][i][&#39;id&#39;]
        song_names.append(names)
        song_ids.append(ids)
        print(names,&#39; &#39;,ids)
    return song_names,song_ids
 
# å¾—åˆ°æŸä¸€é¦–æ­Œçš„æ­Œè¯
def get_song_lyric(headers,lyric_url):
    res = requests.request(&#39;GET&#39;, lyric_url, headers=headers)
    if &#39;lrc&#39; in res.json():
       lyric = res.json()[&#39;lrc&#39;][&#39;lyric&#39;]
       new_lyric = re.sub(r&#39;[\d:.[\]]&#39;,&#39;&#39;,lyric)
       return new_lyric
    else:
       return &#39;&#39;
       print(res.json())



#ç”Ÿæˆè¯äº‘
def create_word_cloud(f):
    print(&#39;æ ¹æ®è¯é¢‘ ç”Ÿæˆè¯äº‘&#39;)
    f=remove_stop_words(f)
    cut_text=&#39; &#39;.join(jieba.cut(f,cut_all=False,HMM=True))
    wc = WordCloud(
       font_path=&quot;.&#47;wc.ttf&quot;,
       max_words=100,
       width=2000,
       height=1200,
    )
    print(cut_text)
    wordcloud = wc.generate(cut_text)
    # å†™è¯äº‘å›¾ç‰‡
    wordcloud.to_file(&quot;wordcloud.jpg&quot;)
    # æ˜¾ç¤ºè¯äº‘æ–‡ä»¶
    plt.imshow(wordcloud)
    plt.axis(&quot;off&quot;)
    plt.show()
    

# è®¾ç½®æ­Œå•IDï¼Œã€æ¯›ä¸æ˜“ | ä¸å–„è¨€è¾çš„æ·±æƒ…ã€‘ä¸º753776811
playlist_id=&#39;753776811&#39;
[song_names,song_ids]=get_songs(playlist_id)

#æ‰€æœ‰æ­Œè¯
all_word=&#39;&#39;
# è·å–æ¯é¦–æ­Œæ­Œè¯
for (song_id, song_name) in zip(song_ids, song_names):
    # æ­Œè¯ API URL
    lyric_url = &#39;http:&#47;&#47;music.163.com&#47;api&#47;song&#47;lyric?os=pc&amp;id=&#39; + str(song_id) + &#39;&amp;lv=-1&amp;kv=-1&amp;tv=-1&#39;
    lyric = get_song_lyric(headers, lyric_url)
    all_word = all_word + &#39; &#39; + lyric
    print(song_name)

#æ ¹æ®è¯é¢‘ï¼Œç”Ÿæˆè¯äº‘
create_word_cloud(all_word)
</p>2019-03-13</li><br/><li><span>æ»¢</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è¯¾åä½œä¸šï¼šè¯­è¨€Python3.6
import requests
import matplotlib.pyplot as plt
from wordcloud import WordCloud

#åˆ›å»ºè¯·æ±‚å¤´
headers = {
    &#39;Referer&#39;:&#39;http:&#47;&#47;music.163.com&#39;,
    &#39;Host&#39;:&#39;music.163.com&#39;,
    &#39;Accept&#39;:&#39;text&#47;html,application&#47;xhtml+xml,application&#47;xml;q=0.9,image&#47;Webp,image&#47;apng,*&#47;*;q=0.8&#39;,
    &#39;User-Agent&#39;:&#39;Chrome&#47;10&#39;
}

#è·å–æ­Œå•
def get_song_name(req_url):
    res = requests.request(&#39;GET&#39;,req_url,headers=headers)
    if &#39;tracks&#39; in res.json()[&#39;result&#39;]:
        tracks = res.json()[&#39;result&#39;][&#39;tracks&#39;]
        names = []
        for i in  range(len(tracks)):
            name = tracks[i][&#39;name&#39;]
            names.append(name)
        return names
    else:
        return &#39;&#39;

#è¿‡æ»¤åœç”¨è¯
def remove_stop_words(text):
    stop_words = [&#39;(ä¼´å¥)&#39;,&#39;Bonus Trackï¼š&#39;,&#39;(Demoç‰ˆ)&#39;]
    for stop_word in stop_words:
        text = text.replace(stop_word,&#39;&#39;)
    return text

path = &#39;&#47;Users&#47;apple&#47;Desktop&#47;GitHubProject&#47;Read mark&#47;æ•°æ®åˆ†æ&#47;geekTime&#47;data&#47;&#39;
#è·å¾—è¯äº‘
def create_wordcloud(text):
    #ç§»é™¤è¿‡æ»¤è¯
    text = remove_stop_words(text)
    wc = WordCloud(
        font_path = &quot;&#47;Library&#47;Fonts&#47;Arial Unicode.ttf&quot;,
        max_words = 100,
        width = 2000,
        height = 1200
    )
    wordcloud = wc.generate(text)
    wordcloud.to_file(path + &#39;wordcloud_homework.jpg&#39;)
    plt.imshow(wordcloud)
    plt.axis(&#39;off&#39;)
    plt.show()

#å¤„ç†æ­Œå•ï¼Œå½¢æˆè¯äº‘
request_url = &#39;http:&#47;&#47;music.163.com&#47;api&#47;playlist&#47;detail?id=753776811&#39;
content_list = get_song_name(request_url)
content = &quot; &quot;.join(content_list)
print(&#39;æ­Œå•ä¿¡æ¯---&#39;,content)
create_wordcloud(content)

--------------
æ­Œå•ä¿¡æ¯--- åˆ«å†é—¹äº† åœ¨æ— é£æ—¶ é‚£æ—¶çš„æˆ‘ä»¬ ä»æ— åˆ°æœ‰ ä¸€æ±Ÿæ°´ å€Ÿ æ¶ˆæ„ ä¸æŸ“ ç››å¤ å“å“Ÿ æ— é—® ä¸€è¤ä¸€ç´  å—ä¸€é“è¡— èŠ¬èŠ³ä¸€ç”Ÿ è¯·è®°ä½æˆ‘ é¡¹ç¾½è™å§¬ ç»™ä½ ç»™æˆ‘ æƒ³ä½ æƒ³ä½  æ„æ–™ä¹‹ä¸­ å¹³å‡¡çš„ä¸€å¤© åƒæˆ‘è¿™æ ·çš„äºº æ„Ÿè§‰è‡ªå·±æ˜¯å·¨æ˜Ÿ å¦‚æœæœ‰ä¸€å¤©æˆ‘å˜å¾—å¾ˆæœ‰é’± å€Ÿ (ä¼´å¥) æ¶ˆæ„ (ä¼´å¥) ç››å¤ (ä¼´å¥) å“å“Ÿ (ä¼´å¥) æƒ³ä½ æƒ³ä½  (ä¼´å¥) å—ä¸€é“è¡— (ä¼´å¥) ç»™ä½ ç»™æˆ‘ (ä¼´å¥) èŠ¬èŠ³ä¸€ç”Ÿ (ä¼´å¥) ä¸€è¤ä¸€ç´  (ä¼´å¥) å¹³å‡¡çš„ä¸€å¤© (ä¼´å¥) åƒæˆ‘è¿™æ ·çš„äºº (ä¼´å¥) å¦‚æœæœ‰ä¸€å¤©æˆ‘å˜å¾—å¾ˆæœ‰é’± (ä¼´å¥) å¦‚æœæœ‰ä¸€å¤©æˆ‘å˜å¾—å¾ˆæœ‰é’± (å¿…èƒœå®¢æ–°æ˜¥ç‰ˆ) Bonus Trackï¼šä¸€è¤ä¸€ç´  (Demoç‰ˆ) Bonus Trackï¼šç»™ä½ ç»™æˆ‘ (Demoç‰ˆ)
---------------
å›¾ç‰‡æ— æ³•å±•ç¤ºï¼Œå¸Œæœ›æå®¢å®è·µçš„PMèƒ½æå‡ºæ”¹è¿›æ–¹æ¡ˆï¼Œå‰ç«¯å’Œåå°å®ç°ä¸€ä¸‹ï¼ˆğŸ˜‚ğŸ˜‚ï¼‰ï¼Œç¥ä¸“æ è¶Šåšè¶Šå¥½</p>2019-04-24</li><br/><li><span>ä¸€è¯­ä¸­çš„</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>ä»¥http:&#47;&#47;music.163.com&#47;api&#47;playlist&#47;detail?id=753776811ä¸­æ­Œå•ä¸ºä¾‹åšè¯äº‘å±•ç¤º
#-*- coding:utf-8 -*-
from wordcloud import WordCloud
import matplotlib.pyplot as plt
import requests

def getSonglists(url, headers):
    #æ ¹æ®æ­Œå•APIè·å–æ­Œæ›²åˆ—è¡¨
	#å°†é¡µé¢ä¿¡æ¯è½¬æ¢ä¸ºjsonæ ¼å¼ä¾¿äºé€šè¿‡å­—å…¸å–å€¼
    r = requests.get(url, headers=headers)
    page_json = r.json()
    tracks = page_json[&quot;result&quot;][&quot;tracks&quot;]
    lists = []
    for i in  range(len(tracks)):
        listName = tracks[i][&quot;name&quot;]
        lists.append(listName)
    return lists

#ç”Ÿæˆè¯äº‘
def create_WordCloud(lists):
    print(&quot;æ ¹æºè¯é¢‘è®¡ç®—è¯äº‘&quot;)
 
    wc = WordCloud(
        font_path = &quot;C:\Windows\Fonts\simhei.ttf&quot;,  #è®¾ç½®ä¸­æ–‡å­—ä½“
        max_words = 100,             #è®¾ç½®æœ€å¤§å­—æ•°
        width = 2000,                #è®¾ç½®ç”»å¸ƒå®½åº¦
        height = 1200,                #è®¾ç½®ç”»å¸ƒé«˜åº¦
        random_state = 100
    )
    wordcloud = wc.generate(lists)
    #å†™è¯äº‘å›¾ç‰‡
    wordcloud.to_file(&quot;wordcloud.jpg&quot;)
    #æ˜¾ç¤ºè¯äº‘æ–‡ä»¶
    plt.imshow(wordcloud)
    #ä¸éœ€è¦æ˜¾ç¤ºX&#47;Yè½´ï¼Œç”¨offå°†åæ ‡è½´å…³é—­
    plt.axis(&quot;off&quot;)
    plt.show()

#å»æ‰åœç”¨è¯ä»¥åŠä¸­è‹±æ–‡æ··åˆçš„è¯
def remove_stop_words(f):
    stop_words = [&#39;(ä¼´å¥)&#39;, &#39;(Demoç‰ˆ)&#39;, &#39;(å¿…èƒœå®¢æ–°æ˜¥ç‰ˆ)&#39;]
    mixed_words = [&#39;Bonus Trackï¼šä¸€è¤ä¸€ç´ &#39;, &#39;Bonus Trackï¼šç»™ä½ ç»™æˆ‘&#39;]
    for stop_word in stop_words:
        f = f.replace(stop_word, &#39;&#39;)
    for mixed_word in mixed_words:
        f = f.replace(mixed_word, mixed_word[12:])
    return  f

if __name__ == &quot;__main__&quot;:

    headers = {
        &#39;Referer&#39;: &#39;http:&#47;&#47;music.163.com&#39;,
        &#39;Host&#39;: &#39;music.163.com&#39;,
        &#39;Accept&#39;: &#39;text&#47;html,application&#47;xhtml+xml,application&#47;xml;q=0.9,image&#47;webp,image&#47;apng,*&#47;*;q=0.8&#39;,
        &#39;User-Agent&#39;: &#39;Chrome&#47;10&#39;
    }
    url = &quot;http:&#47;&#47;music.163.com&#47;api&#47;playlist&#47;detail?id=753776811&quot;
    gerLists = getSonglists(url, headers)
	#è·å–æ­Œå•æ˜¯listç±»å‹ï¼Œè½¬æ¢ä¸ºstrï¼Œé‚£ä¹ˆå°±ä¸å†éœ€è¦ç”¨jiebaåˆ†è¯
    lists_str = &quot; &quot;.join(gerLists)
	
    lists = remove_stop_words(lists_str)
    create_WordCloud(lists)</p>2019-03-11</li><br/><li><span>Geeky_Ben</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<p>è€å¸ˆï¼Œä¸ºä»€ä¹ˆæˆ‘çš„ç»“æœæ˜¾ç¤º cannot open resource</p>2020-08-06</li><br/><li><span>Geek_l0anid</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p># -*- coding:utf-8 -*-
# ç½‘æ˜“äº‘éŸ³ä¹ é€šè¿‡æ­Œæ‰‹IDï¼Œç”Ÿæˆè¯¥æ­Œæ‰‹çš„è¯äº‘
import requests
import os
import re
import sys
from wordcloud import WordCloud
import matplotlib.pyplot as plt
from PIL import Image
import numpy as np
import jieba
from lxml import etree

headers = {
    &#39;Referer&#39;: &#39;http:&#47;&#47;music.163.com&#39;,
    &#39;Host&#39;: &#39;music.163.com&#39;,
    &#39;Accept&#39;: &#39;text&#47;html,application&#47;xhtml+xml,application&#47;xml;q=0.9,image&#47;webp,image&#47;apng,*&#47;*;q=0.8&#39;,
    &#39;User-Agent&#39;: &#39;Chrome&#47;10&#39;
}

# è·å–åˆ°æ­Œå•çš„ä¿¡æ¯
def get_song_list(headers,song_list_url):
    res = requests.request(&quot;GET&quot;,song_list_url,headers=headers)
    if &#39;result&#39; in res.json():
        all_song_list = &quot;&quot;
        for song_list in res.json()[&#39;result&#39;][&#39;tracks&#39;]:
            all_song_list = all_song_list + song_list[&#39;name&#39;]
            print(all_song_list)
        return all_song_list
    else:
        return &#39;&#39;

# åˆ›å»ºè¯äº‘å±•ç¤º
def wordcloud(f):
    print(&quot;æ ¹æ®è¯é¢‘ç»“æœè¿›è¡Œè¯äº‘å±•ç¤ºï¼&quot;)
    cut_text = &quot; &quot;.join(jieba.cut(f,cut_all=False,HMM=True))
    wc = WordCloud(
        font_path=&quot;.&#47;wc.ttf&quot;,
        max_words=100,
        width=2000,
        height=1200,
    )
    wordcloud = wc.generate(cut_text)
    wordcloud.to_file(&quot;song_list_wordcloud.jpg&quot;)
    # è¯äº‘å±•ç¤º
    plt.imshow(wordcloud)
    plt.axis(&quot;off&quot;)
    plt.show()

# è·å–æ­Œå•
song_list_id = &#39;753776811&#39;
song_list_url = &#39;http:&#47;&#47;music.163.com&#47;api&#47;playlist&#47;detail?id=&#39; + song_list_id
all_song_list_new = get_song_list(headers,song_list_url)
wordcloud(all_song_list_new)</p>2019-09-22</li><br/><li><span>é™ˆç‚«å®</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>APIæ˜¯æ€ä¹ˆæ‰¾åˆ°çš„ï¼Ÿ</p>2021-03-11</li><br/><li><span>å¦‚æœ</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆä½ å¥½ï¼Œè¯·é—®ä¸‹headeré‡Œçš„Acceptå‚æ•°æ˜¯æ€ä¹ˆæ¥çš„</p>2020-06-11</li><br/><li><span>GS</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>https:&#47;&#47;github.com&#47;leledada&#47;jupyter&#47;tree&#47;master&#47;wordcloud</p>2019-12-15</li><br/><li><span>GS</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p> if &#39;lrc&#39; in res.json():
        try:
            lyric = res.json()[&#39;lrc&#39;][&#39;lyric&#39;]
            new_lyric = re.sub(r&#39;[\d:.[\]]&#39;,&#39;&#39;,lyric)
            return new_lyric
        except:
            print(&#39;å‘ç”Ÿäº†å¼‚å¸¸-----------------------------------&#39;,lyric_url)
            return &#39;&#39;
    else:
        return &#39;&#39;</p>2019-12-13</li><br/><li><span>GS</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è§£ææ­Œè¯çš„æ—¶å€™æœ€å¥½æ˜¯ç”¨try except åŒ…èµ·æ¥ï¼Œä¸ç„¶é‡åˆ°å¼‚å¸¸å°±ä¸èµ°äº†</p>2019-12-13</li><br/><li><span>#Yema</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>lyric_url = &#39;http:&#47;&#47;music.163.com&#47;api&#47;song&#47;lyric?os=pc&amp;id=&#39; + str(song_id) + &#39;&amp;lv=-1&amp;kv=-1
è€å¸ˆèƒ½è§£é‡Šä¸€ä¸‹è¿™ä¸ªurlæ˜¯ä»å“ªæ‰¾åˆ°çš„å—ï¼Ÿä¸ºä»€ä¹ˆåœ¨æµè§ˆå™¨æŠ“åŒ…é‡Œé¢æ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªapiï¼Œæˆ‘æ‰¾åˆ°çš„apiæ˜¯ä¸€ä¸ªå¼‚æ­¥éœ€è¦å‘apiä¼ csrf_tokenæ‰èƒ½æ‹¿åˆ°æ­Œè¯</p>2019-12-12</li><br/><li><span>å¿—</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>æ€è€ƒé¢˜å…³é”®ä»£ç éƒ¨åˆ†ï¼š

import time
id_list = []
name_list = []
# å¾—åˆ°æŸä¸€æ­Œå•é‡Œçš„æ¯ä¸€é¦–æ­ŒIDå’Œæ­Œå
def get_song_list(headers,list_url):
    res = requests.request(&#39;GET&#39;, list_url, headers=headers)
    if &#39;result&#39; in res.json():
        for item in res.json()[&#39;result&#39;][&#39;tracks&#39;]:   # è¯»å–jsonæ•°æ®ä¸­çš„æ¯ä¸€ä¸ªIDå’Œname
            id_list.append(item[&#39;id&#39;]) 
            name_list.append(item[&#39;name&#39;])
            print(item[&#39;id&#39;],&quot; &quot;,item[&#39;name&#39;])
            time.sleep(1)      # è®¾ç½®åœç•™æ—¶é—´ï¼Œé˜²æ­¢â€œbad handshakeâ€
        return id_list,name_list
    else:
        return &#39;&#39;
        print(res.json())
        
# è®¾ç½®æ­Œå•é“¾æ¥
list_url = &#39;https:&#47;&#47;music.163.com&#47;api&#47;playlist&#47;detail?id=753776811&#39;
# è·å¾—æ­Œå•æ¯ä¸€é¦–æ­Œçš„IDå’Œname
get_song_list(headers,list_url)   
     
all_word_list = &#39;&#39;
# è·å–æ¯é¦–æ­Œæ­Œè¯
for (song_id, song_name) in zip(id_list, name_list):
    # æ­Œè¯ API URL
    lyric_url = &#39;http:&#47;&#47;music.163.com&#47;api&#47;song&#47;lyric?os=pc&amp;id=&#39; + str(song_id) + &#39;&amp;lv=-1&amp;kv=-1&amp;tv=-1&#39;
    lyric = get_song_lyric(headers, lyric_url)
    all_word_list = all_word_list + &#39; &#39; + lyric
    print(song_name)
    
# å»æ‰åœç”¨è¯
remove_stop_words(all_word_list)

# æ ¹æ®è¯é¢‘ ç”Ÿæˆè¯äº‘
create_word_cloud(all_word_list)   </p>2019-03-11</li><br/><li><span>è·³è·³</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>#éœ€è¦æ³¨æ„çš„æœ‰ä¸¤ç‚¹
#1.æ­Œå•è¿”å›çš„æ˜¯jsonæ–‡ä»¶ï¼Œget_songséœ€è¦å‚è€ƒget_songs_lyriè·å–
#2.list_urlä¸­é—´æ˜¯strç±»å‹ï¼Œæ³¨æ„ç±»å‹è½¬æ¢
#emmmï¼Œä»£ç å¤ªé•¿æ”¾ä¸ä¸‹äº†ï¼Œåˆ é™¤äº†ä¸€éƒ¨åˆ†å’Œè€å¸ˆä¸€æ ·çš„å‡½æ•°
# -*- coding:utf-8 -*-
# ç½‘æ˜“äº‘éŸ³ä¹ é€šè¿‡æ­Œå•IDï¼Œç”Ÿæˆè¯¥æ­Œå•çš„è¯äº‘
import requests
import sys
import re
import os
from wordcloud import WordCloud
import matplotlib.pyplot as plt
import jieba
from PIL import Image
import numpy as np
from lxml import etree
def get_songs(songlist):
    list_url=&#39;https:&#47;&#47;music.163.com&#47;api&#47;playlist&#47;detail?id=&#39;+songlist
    res = requests.request(&#39;GET&#39;, list_url, headers=headers)
    if &#39;result&#39; in res.json():
        for item in res.json()[&#39;result&#39;][&#39;tracks&#39;]: # è¯»å–jsonæ•°æ®ä¸­çš„æ¯ä¸€ä¸ªIDå’Œname
            song_ids.append(item[&#39;id&#39;]) 
            song_names.append(item[&#39;name&#39;])
            print(item[&#39;id&#39;],&quot; &quot;,item[&#39;name&#39;])
            time.sleep(1) # è®¾ç½®åœç•™æ—¶é—´ï¼Œé˜²æ­¢â€œbad handshakeâ€
        return song_ids,song_names
    else:
        return &#39;&#39;
        print(res.json())
# è®¾ç½®æ­Œå•
songlist = &#39;753776811&#39;
[song_ids, song_names] = get_songs(songlist)
# æ‰€æœ‰æ­Œè¯
all_word = &#39;&#39;
# è·å–æ¯é¦–æ­Œæ­Œè¯
for (song_id, song_name) in zip(song_ids, song_names):
    # æ­Œè¯ API URL
    list_url = &#39;http:&#47;&#47;music.163.com&#47;api&#47;song&#47;lyric?os=pc&amp;id=&#39; + str(song_id) + &#39;&amp;lv=-1&amp;kv=-1&amp;tv=-1&#39;
    lyric = get_song_lyric(headers, list_url)
    all_word = all_word + &#39; &#39; + lyric
    print(song_name)
# æ ¹æ®è¯é¢‘ ç”Ÿæˆè¯äº‘
create_word_cloud(all_word)</p>2019-03-13</li><br/><li><span>èµµæ™“å¶</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>print(len(res.json()[&#39;result&#39;][&#39;tracks&#39;]))
KeyError: &#39;result&#39;
æ€»æ˜¯æŠ¥è¿™ä¸ªé”™</p>2023-09-06</li><br/>
</ul>