ä½ å¥½ï¼Œæˆ‘æ˜¯å´ç£Šã€‚

ä»è¿™èŠ‚è¯¾å¼€å§‹ï¼Œæˆ‘ä»¬å…ˆæ¥å­¦ä¹ Sparkçš„â€œåŸºç¡€çŸ¥è¯†â€æ¨¡å—ï¼Œå¯¹Sparkçš„æ¦‚å¿µå’Œæ ¸å¿ƒåŸç†å…ˆåšä¸€ä¸ªæ•´ä½“çš„äº†è§£ã€‚æˆ‘å¹¶ä¸ä¼šä»RDDã€DAGè¿™äº›åŸºæœ¬æ¦‚å¿µç»™ä½ è®²èµ·ã€‚å¦ç™½åœ°è¯´ï¼Œè¿™äº›æŠ½è±¡çš„æ¦‚å¿µæ¯ç‡¥è€Œåˆä¹å‘³ï¼Œå¯¹äºåˆšå¼€å§‹æ¥è§¦Sparkçš„ä½ æ¥è¯´ï¼Œå¾ˆéš¾å­¦è¿›å»ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸å¦¨åå…¶é“è€Œè¡Œä¹‹ï¼Œå…ˆä»å®æˆ˜å…¥æ‰‹ï¼Œç”¨ä¸€ä¸ªå°ä¾‹å­æ¥ç›´è§‚åœ°è®¤è¯†Sparkï¼Œçœ‹çœ‹Sparkéƒ½èƒ½åšäº›ä»€ä¹ˆã€‚

è¿™å°±å¥½æ¯”æˆ‘ä»¬å­¦ä¹ ä¸€é—¨æ–°çš„ç¼–ç¨‹è¯­è¨€ï¼Œå¾€å¾€éƒ½æ˜¯ä»â€œHello Worldâ€å¼€å§‹ã€‚æˆ‘è¿˜è®°å¾—ï¼Œåˆšåˆšå­¦ç¼–ç¨‹é‚£ä¼šï¼Œå±å¹•ä¸Šæ‰“å°å‡ºçš„â€œHello Worldâ€ï¼Œè¶³è¶³è®©æˆ‘å…´å¥‹äº†ä¸€æ•´å¤©ï¼Œè®©æˆ‘è«ååœ°æœ‰ä¸€ç§â€œI can change the worldâ€çš„å†²åŠ¨ã€‚

ä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å°±ä»â€œå¤§æ•°æ®çš„Hello Worldâ€å¼€å§‹ï¼Œå»å­¦ä¹ æ€ä¹ˆåœ¨Sparkä¹‹ä¸Šåšåº”ç”¨å¼€å‘ã€‚ä¸è¿‡ï¼Œâ€œå¤§æ•°æ®çš„Hello Worldâ€å¹¶ä¸æ˜¯æŠŠå­—ç¬¦ä¸²æ‰“å°åˆ°å±å¹•ä¸Šè¿™ä¹ˆç®€å•ï¼Œè€Œæ˜¯è¦å…ˆå¯¹æ–‡ä»¶ä¸­çš„å•è¯åšç»Ÿè®¡è®¡æ•°ï¼Œç„¶åå†æ‰“å°å‡ºé¢‘æ¬¡æœ€é«˜çš„5ä¸ªå•è¯ï¼Œæ±Ÿæ¹–äººç§°â€œWord Countâ€ã€‚

ä¹‹æ‰€ä»¥ä¼šé€‰æ‹©Word Countï¼Œä½œä¸ºæˆ‘ä»¬è¿ˆå…¥Sparké—¨æ§›çš„ç¬¬ä¸€ä¸ªé¡¹ç›®ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ï¼Œä¸€æ˜¯Word Countåœºæ™¯æ¯”è¾ƒç®€å•ã€å®¹æ˜“ç†è§£ï¼›äºŒæ˜¯Word Countéº»é›€è™½å°ï¼Œä½†äº”è„ä¿±å…¨ï¼Œä¸€ä¸ªå°å°çš„Word Countï¼Œå°±èƒ½å¤Ÿç‰µå¼•å‡ºSparkè®¸å¤šçš„æ ¸å¿ƒåŸç†ï¼Œå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå…¥é—¨ã€‚

å¥½å•¦ï¼Œè¯ä¸å¤šè¯´ï¼Œä¸‹é¢æˆ‘ä»¬æ­£å¼å¼€å¯Word Countä¹‹æ—…ã€‚

## **å‡†å¤‡å·¥ä½œ**

å·§å¦‡éš¾ä¸ºæ— ç±³ä¹‹ç‚Šï¼Œè¦åšWord Countï¼Œæˆ‘ä»¬å¾—å…ˆæŠŠæºæ–‡ä»¶å‡†å¤‡å¥½ã€‚

å’±ä»¬åšWord Countçš„åˆè¡·æ˜¯å­¦ä¹ Sparkï¼Œå› æ­¤æºæ–‡ä»¶çš„å†…å®¹æ— è¶³è½»é‡ã€‚è¿™é‡Œæˆ‘æå–äº†[Wikipediaä¸­å¯¹Sparkçš„ä»‹ç»](https://en.wikipedia.org/wiki/Apache_Spark)æ¥åšæˆ‘ä»¬çš„æºæ–‡ä»¶ã€‚æˆ‘æŠŠå®ƒä¿å­˜åˆ°äº†ä¸è¯¾ç¨‹é…å¥—çš„GitHubé¡¹ç›®ä¸­ï¼Œå¹¶æŠŠå®ƒå‘½åä¸ºâ€œwikiOfSpark.txtâ€ã€‚ä½ å¯ä»¥ä»[è¿™é‡Œ](https://github.com/wulei-bj-cn/learn-spark/blob/main/chapter01/wikiOfSpark.txt)ä¸‹è½½å®ƒã€‚

ä¸ºäº†è·‘é€šWord Countå®ä¾‹ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨æœ¬åœ°ï¼ˆLocalï¼‰éƒ¨ç½²Sparkè¿è¡Œç¯å¢ƒã€‚è¿™é‡Œçš„â€œæœ¬åœ°â€ï¼ŒæŒ‡çš„æ˜¯ä½ æ‰‹å¤´èƒ½å¤Ÿè·å–åˆ°çš„ä»»ä½•è®¡ç®—èµ„æºï¼Œæ¯”å¦‚æœåŠ¡å™¨ã€å°å¼æœºï¼Œæˆ–æ˜¯ç¬”è®°æœ¬ç”µè„‘ã€‚

åœ¨æœ¬åœ°éƒ¨ç½²Sparkè¿è¡Œç¯å¢ƒéå¸¸ç®€å•ï¼Œå³ä¾¿ä½ ä»æ¥æ²¡æœ‰å’ŒSparkæ‰“è¿‡äº¤é“ï¼Œä¹Ÿä¸å¿…æ‹…å¿ƒã€‚**åªéœ€è¦ä¸‹é¢è¿™3ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ŒæˆSparkçš„æœ¬åœ°éƒ¨ç½²äº†**ã€‚

1. **ä¸‹è½½å®‰è£…åŒ…ï¼š**ä»[Sparkå®˜ç½‘](http://spark.apache.org/downloads.html)ä¸‹è½½å®‰è£…åŒ…ï¼Œé€‰æ‹©æœ€æ–°çš„é¢„ç¼–è¯‘ç‰ˆæœ¬å³å¯ï¼›
2. **è§£å‹ï¼š**è§£å‹Sparkå®‰è£…åŒ…åˆ°ä»»æ„æœ¬åœ°ç›®å½•ï¼›
3. **é…ç½®ï¼š**å°†â€œ${è§£å‹ç›®å½•}/binâ€é…ç½®åˆ°PATHç¯å¢ƒå˜é‡ã€‚

æˆ‘è¿™é‡Œç»™ä½ å‡†å¤‡äº†ä¸€ä¸ªæœ¬åœ°éƒ¨ç½²çš„å°è§†é¢‘ï¼Œä½ å¯ä»¥ç›´è§‚åœ°æ„Ÿå—ä¸€ä¸‹ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç¡®è®¤ä¸€ä¸‹Sparkæ˜¯å¦éƒ¨ç½²æˆåŠŸã€‚æ‰“å¼€å‘½ä»¤è¡Œç»ˆç«¯ï¼Œæ•²å…¥â€œspark-shell --versionâ€å‘½ä»¤ï¼Œå¦‚æœè¯¥å‘½ä»¤èƒ½æˆåŠŸåœ°æ‰“å°å‡ºSparkç‰ˆæœ¬å·ï¼Œå°±è¡¨ç¤ºæˆ‘ä»¬å¤§åŠŸå‘Šæˆäº†ï¼Œå°±åƒè¿™æ ·ï¼š

![](https://static001.geekbang.org/resource/image/51/34/51664d2f8479aac9099a1b2736ebee34.jpg?wh=1112x726 "éªŒè¯Sparkæœ¬åœ°éƒ¨ç½²æˆåŠŸ")

åœ¨åç»­çš„å®æˆ˜ä¸­ï¼Œæˆ‘ä»¬ä¼šç”¨spark-shellæ¥æ¼”ç¤ºWord Countçš„æ‰§è¡Œè¿‡ç¨‹ã€‚spark-shellæ˜¯æäº¤Sparkä½œä¸šä¼—å¤šæ–¹å¼ä¸­çš„ä¸€ç§ï¼Œæˆ‘ä»¬åœ¨åç»­çš„è¯¾ç¨‹ä¸­è¿˜ä¼šå±•å¼€ä»‹ç»ï¼Œè¿™é‡Œä½ ä¸å¦¨æš‚æ—¶æŠŠå®ƒå½“åšæ˜¯Sparkä¸­çš„Linux shellã€‚spark-shellæä¾›äº¤äº’å¼çš„è¿è¡Œç¯å¢ƒï¼ˆREPLï¼ŒRead-Evaluate-Print-Loopï¼‰ï¼Œä»¥â€œæ‰€è§å³æ‰€å¾—â€çš„æ–¹å¼ï¼Œè®©å¼€å‘è€…åœ¨æäº¤æºä»£ç ä¹‹åï¼Œå°±å¯ä»¥è¿…é€Ÿåœ°è·å–æ‰§è¡Œç»“æœã€‚

ä¸è¿‡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œspark-shellåœ¨è¿è¡Œçš„æ—¶å€™ï¼Œä¾èµ–äºJavaå’ŒScalaè¯­è¨€ç¯å¢ƒã€‚å› æ­¤ï¼Œä¸ºäº†ä¿è¯spark-shellçš„æˆåŠŸå¯åŠ¨ï¼Œä½ éœ€è¦åœ¨æœ¬åœ°é¢„è£…Javaä¸Scalaã€‚å¥½æ¶ˆæ¯æ˜¯ï¼Œå…³äºJavaä¸Scalaçš„å®‰è£…ï¼Œç½‘ä¸Šçš„èµ„æ–™éå¸¸ä¸°å¯Œï¼Œä½ å¯ä»¥å‚è€ƒé‚£äº›èµ„æ–™æ¥è¿›è¡Œå®‰è£…ï¼Œå’±ä»¬åœ¨æœ¬è®²å°±ä¸å†èµ˜è¿°Javaä¸Scalaçš„å®‰è£…æ­¥éª¤å•¦ã€‚

## **æ¢³ç†**Word Countçš„è®¡ç®—æ­¥éª¤

åšäº†ä¸€ç•ªå‡†å¤‡ä¹‹åï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹å†™ä»£ç äº†ã€‚ä¸è¿‡ï¼Œåœ¨â€œä¸‹æ‰‹â€ä¹‹å‰ï¼Œå’±ä»¬ä¸å¦¨ä¸€èµ·æ¢³ç†ä¸‹Word Countçš„è®¡ç®—æ­¥éª¤ï¼Œå…ˆåšåˆ°å¿ƒä¸­æœ‰æ•°ï¼Œç„¶åå†å’ä»£ç ä¹Ÿä¸è¿Ÿã€‚

ä¹‹å‰æˆ‘ä»¬æåˆ°ï¼ŒWord Countçš„åˆè¡·æ˜¯å¯¹æ–‡ä»¶ä¸­çš„å•è¯åšç»Ÿè®¡è®¡æ•°ï¼Œæ‰“å°å‡ºé¢‘æ¬¡æœ€é«˜çš„5ä¸ªè¯æ±‡ã€‚é‚£ä¹ˆWord Countçš„ç¬¬ä¸€æ­¥å°±å¾ˆæ˜æ˜¾äº†ï¼Œå½“ç„¶æ˜¯å¾—è¯»å–æ–‡ä»¶çš„å†…å®¹ï¼Œä¸ç„¶å’±ä»¬ç»Ÿè®¡ä»€ä¹ˆå‘¢ï¼Ÿ

æˆ‘ä»¬å‡†å¤‡å¥½çš„æ–‡ä»¶æ˜¯wikiOfSpark.txtï¼Œå®ƒä»¥çº¯æ–‡æœ¬çš„æ–¹å¼è®°å½•äº†å…³äºSparkçš„ç®€å•ä»‹ç»ï¼Œæˆ‘æ‘˜å–äº†å…¶ä¸­çš„éƒ¨åˆ†å†…å®¹ç»™ä½ çœ‹ä¸€ä¸‹ï¼š

![](https://static001.geekbang.org/resource/image/8f/d3/8fa70d857b684ef85cd5fa92611651d3.png?wh=1292x394 "wikiOfSpark.txtå†…å®¹æ‘˜è¦")

æˆ‘ä»¬çŸ¥é“ï¼Œæ–‡ä»¶çš„è¯»å–å¾€å¾€æ˜¯ä»¥è¡Œï¼ˆLineï¼‰ä¸ºå•ä½çš„ã€‚ä¸éš¾å‘ç°ï¼ŒwikiOfSpark.txtçš„æ¯ä¸€è¡Œéƒ½åŒ…å«å¤šä¸ªå•è¯ã€‚

æˆ‘ä»¬è¦æ˜¯ä»¥â€œå•è¯â€ä½œä¸ºç²’åº¦åšè®¡æ•°ï¼Œå°±éœ€è¦å¯¹æ¯ä¸€è¡Œçš„æ–‡æœ¬åšåˆ†è¯ã€‚åˆ†è¯è¿‡åï¼Œæ–‡ä»¶ä¸­çš„æ¯ä¸€å¥è¯ï¼Œéƒ½è¢«æ‰“æ•£æˆäº†ä¸€ä¸ªä¸ªå•è¯ã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŒ‰ç…§å•è¯åšåˆ†ç»„è®¡æ•°äº†ã€‚è¿™å°±æ˜¯Word Countçš„è®¡ç®—è¿‡ç¨‹ï¼Œä¸»è¦åŒ…å«å¦‚ä¸‹3ä¸ªæ­¥éª¤ï¼š

1. **è¯»å–å†…å®¹**ï¼šè°ƒç”¨Sparkæ–‡ä»¶è¯»å–APIï¼ŒåŠ è½½wikiOfSpark.txtæ–‡ä»¶å†…å®¹ï¼›
2. **åˆ†è¯**ï¼šä»¥è¡Œä¸ºå•ä½ï¼ŒæŠŠå¥å­æ‰“æ•£ä¸ºå•è¯ï¼›
3. **åˆ†ç»„è®¡æ•°**ï¼šæŒ‰ç…§å•è¯åšåˆ†ç»„è®¡æ•°ã€‚

æ˜ç¡®äº†è®¡ç®—æ­¥éª¤åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨Sparkå¼€å‘APIï¼Œå¯¹è¿™äº›æ­¥éª¤è¿›è¡Œä»£ç å®ç°ï¼Œä»è€Œå®ŒæˆWord Countçš„åº”ç”¨å¼€å‘ã€‚

ä¼—æ‰€å‘¨çŸ¥ï¼ŒSparkæ”¯æŒç§ç±»ä¸°å¯Œçš„å¼€å‘è¯­è¨€ï¼Œå¦‚Scalaã€Javaã€Pythonï¼Œç­‰ç­‰ã€‚ä½ å¯ä»¥ç»“åˆä¸ªäººåå¥½å’Œå¼€å‘ä¹ æƒ¯ï¼Œä»»æ„é€‰æ‹©å…¶ä¸­çš„ä¸€ç§è¿›è¡Œå¼€å‘ã€‚å°½ç®¡ä¸åŒè¯­è¨€çš„å¼€å‘APIåœ¨è¯­æ³•ä¸Šæœ‰ç€ç»†å¾®çš„å·®å¼‚ï¼Œä½†ä¸è®ºæ˜¯åŠŸèƒ½æ–¹é¢ã€è¿˜æ˜¯æ€§èƒ½æ–¹é¢ï¼ŒSparkå¯¹äºæ¯ä¸€ç§è¯­è¨€çš„æ”¯æŒéƒ½æ˜¯ä¸€è‡´çš„ã€‚æ¢å¥è¯è¯´ï¼ŒåŒæ ·æ˜¯Word Countï¼Œä½ ç”¨Scalaå®ç°ä¹Ÿè¡Œï¼Œç”¨Pythonå®ç°ä¹Ÿå¯ä»¥ï¼Œä¸¤ä»½ä»£ç çš„æ‰§è¡Œç»“æœæ˜¯ä¸€è‡´çš„ã€‚ä¸ä»…å¦‚æ­¤ï¼Œåœ¨åŒæ ·çš„è®¡ç®—èµ„æºä¸‹ï¼Œä¸¤ä»½ä»£ç çš„æ‰§è¡Œæ•ˆç‡ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚

å› æ­¤ï¼Œå°±Word Countè¿™ä¸ªç¤ºä¾‹æ¥è¯´ï¼Œå¼€å‘è¯­è¨€ä¸æ˜¯é‡ç‚¹ï¼Œæˆ‘ä»¬ä¸å¦¨é€‰æ‹©Scalaã€‚ä½ å¯èƒ½ä¼šè¯´ï¼šâ€œæˆ‘æœ¬æ¥å¯¹Sparkå°±ä¸ç†Ÿï¼Œæ›´æ²¡æœ‰æ¥è§¦è¿‡Scalaï¼Œä¸€ä¸Šæ¥å°±ç”¨Scalaæ¼”ç¤ºSparkåº”ç”¨ä»£ç ï¼Œç†è§£èµ·æ¥ä¼šä¸ä¼šå¾ˆå›°éš¾ï¼Ÿâ€

å…¶å®å¤§å¯ä¸å¿…æ‹…å¿ƒï¼ŒScalaè¯­æ³•æ¯”è¾ƒç®€æ´ï¼ŒWord Countçš„Scalaå®ç°ä¸è¶…è¿‡10è¡Œä»£ç ã€‚å†è€…ï¼Œå¯¹äºWord Countä¸­çš„æ¯ä¸€è¡ŒScalaä»£ç ï¼Œæˆ‘ä¼šå¸¦ç€ä½ æ‰‹æŠŠæ‰‹ã€é€è¡Œåœ°è¿›è¡Œè®²è§£å’Œåˆ†æã€‚æˆ‘ç›¸ä¿¡ï¼Œè·Ÿç€æˆ‘è¿‡å®Œä¸€éä»£ç ä¹‹åï¼Œä½ èƒ½å¾ˆå¿«åœ°æŠŠå®ƒâ€œç¿»è¯‘â€æˆä½ ç†Ÿæ‚‰çš„è¯­è¨€ï¼Œæ¯”å¦‚Javaæˆ–Pythonã€‚å¦å¤–ï¼Œç»å¤§å¤šæ•°çš„Spark æºç éƒ½æ˜¯ç”± Scala å®ç°çš„ï¼Œæ¥è§¦å¹¶äº†è§£ä¸€äº›Scalaçš„åŸºæœ¬è¯­æ³•ï¼Œæœ‰åˆ©äºä½ åç»­é˜…è¯»ã€å­¦ä¹ Sparkæºä»£ç ã€‚

## Word Countä»£ç å®ç°

é€‰å®šäº†è¯­è¨€ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æŒ‰ç…§è¯»å–å†…å®¹ã€åˆ†è¯ã€åˆ†ç»„è®¡æ•°è¿™ä¸‰æ­¥æ¥çœ‹çœ‹Word Countå…·ä½“æ€ä¹ˆå®ç°ã€‚

### ç¬¬ä¸€æ­¥ï¼Œè¯»å–å†…å®¹

é¦–å…ˆï¼Œæˆ‘ä»¬è°ƒç”¨SparkContextçš„textFileæ–¹æ³•ï¼Œè¯»å–æºæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯wikiOfSpark.txtï¼Œä»£ç å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š

```scala
import org.apache.spark.rdd.RDD
 
// è¿™é‡Œçš„ä¸‹åˆ’çº¿"_"æ˜¯å ä½ç¬¦ï¼Œä»£è¡¨æ•°æ®æ–‡ä»¶çš„æ ¹ç›®å½•
val rootPath: String = _
val file: String = s"${rootPath}/wikiOfSpark.txt"
 
// è¯»å–æ–‡ä»¶å†…å®¹
val lineRDD: RDD[String] = spark.sparkContext.textFile(file) 
```

åœ¨è¿™æ®µä»£ç ä¸­ï¼Œä½ å¯èƒ½ä¼šå‘ç°3ä¸ªæ–°æ¦‚å¿µï¼Œåˆ†åˆ«æ˜¯sparkã€sparkContextå’ŒRDDã€‚

å…¶ä¸­ï¼Œsparkå’ŒsparkContextåˆ†åˆ«æ˜¯ä¸¤ç§ä¸åŒçš„å¼€å‘å…¥å£å®ä¾‹ï¼š

- sparkæ˜¯å¼€å‘å…¥å£SparkSessionå®ä¾‹ï¼ˆInstanceï¼‰ï¼ŒSparkSessionåœ¨spark-shellä¸­ä¼šç”±ç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºï¼›
- sparkContextæ˜¯å¼€å‘å…¥å£SparkContextå®ä¾‹ã€‚

åœ¨Sparkç‰ˆæœ¬æ¼”è¿›çš„è¿‡ç¨‹ä¸­ï¼Œä»2.0ç‰ˆæœ¬å¼€å§‹ï¼ŒSparkSessionå–ä»£äº†SparkContextï¼Œæˆä¸ºç»Ÿä¸€çš„å¼€å‘å…¥å£ã€‚æ¢å¥è¯è¯´ï¼Œè¦å¼€å‘Sparkåº”ç”¨ï¼Œä½ å¿…é¡»å…ˆåˆ›å»ºSparkSessionã€‚å…³äºSparkSessionå’ŒSparkContextï¼Œæˆ‘ä¼šåœ¨åç»­çš„è¯¾ç¨‹åšæ›´è¯¦ç»†çš„ä»‹ç»ï¼Œè¿™é‡Œä½ åªè¦è®°ä½å®ƒä»¬æ˜¯å¿…éœ€çš„å¼€å‘å…¥å£å°±å¯ä»¥äº†ã€‚

æˆ‘ä»¬å†æ¥çœ‹çœ‹RDDï¼ŒRDDçš„å…¨ç§°æ˜¯Resilient Distributed Datasetï¼Œæ„æ€æ˜¯â€œå¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†â€ã€‚RDDæ˜¯Sparkå¯¹äºåˆ†å¸ƒå¼æ•°æ®çš„ç»Ÿä¸€æŠ½è±¡ï¼Œå®ƒå®šä¹‰äº†ä¸€ç³»åˆ—åˆ†å¸ƒå¼æ•°æ®çš„åŸºæœ¬å±æ€§ä¸å¤„ç†æ–¹æ³•ã€‚å…³äºRDDçš„å®šä¹‰ã€å†…æ¶µä¸ä½œç”¨ï¼Œæˆ‘ä»¬ç•™åˆ°[ä¸‹ä¸€è®²](https://time.geekbang.org/column/article/417164)å†å»å±•å¼€ã€‚

åœ¨è¿™é‡Œï¼Œä½ ä¸å¦¨å…ˆç®€å•åœ°æŠŠRDDç†è§£æˆâ€œæ•°ç»„â€ï¼Œæ¯”å¦‚ä»£ç ä¸­çš„lineRDDå˜é‡ï¼Œå®ƒçš„ç±»å‹æ˜¯RDD\[String]ï¼Œä½ å¯ä»¥æš‚æ—¶æŠŠå®ƒå½“æˆå…ƒç´ ç±»å‹æ˜¯Stringçš„æ•°ç»„ï¼Œæ•°ç»„çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯æ–‡ä»¶ä¸­çš„ä¸€è¡Œå­—ç¬¦ä¸²ã€‚

è·å–åˆ°æ–‡ä»¶å†…å®¹ä¹‹åï¼Œä¸‹ä¸€æ­¥æˆ‘ä»¬å°±è¦åšåˆ†è¯äº†ã€‚

### ç¬¬äºŒæ­¥ï¼Œåˆ†è¯

â€œåˆ†è¯â€å°±æ˜¯æŠŠâ€œæ•°ç»„â€çš„è¡Œå…ƒç´ æ‰“æ•£ä¸ºå•è¯ã€‚è¦å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨RDDçš„flatMapæ–¹æ³•æ¥å®Œæˆã€‚flatMapæ“ä½œåœ¨é€»è¾‘ä¸Šå¯ä»¥åˆ†æˆä¸¤ä¸ªæ­¥éª¤ï¼š**æ˜ å°„**å’Œ**å±•å¹³**ã€‚

è¿™ä¸¤ä¸ªæ­¥éª¤æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæˆ‘ä»¬è¿˜æ˜¯ç»“åˆWord Countçš„ä¾‹å­æ¥çœ‹ï¼š

```scala
// ä»¥è¡Œä¸ºå•ä½åšåˆ†è¯
val wordRDD: RDD[String] = lineRDD.flatMap(line => line.split(" "))Â 
```

è¦æŠŠlineRDDçš„è¡Œå…ƒç´ è½¬æ¢ä¸ºå•è¯ï¼Œæˆ‘ä»¬å¾—å…ˆç”¨åˆ†éš”ç¬¦å¯¹æ¯ä¸ªè¡Œå…ƒç´ è¿›è¡Œåˆ†å‰²ï¼ˆSplitï¼‰ï¼Œå’±ä»¬è¿™é‡Œçš„åˆ†éš”ç¬¦æ˜¯ç©ºæ ¼ã€‚

åˆ†å‰²ä¹‹åï¼Œæ¯ä¸ªè¡Œå…ƒç´ å°±éƒ½å˜æˆäº†å•è¯æ•°ç»„ï¼Œå…ƒç´ ç±»å‹ä¹Ÿä»Stringå˜æˆäº†Array\[String]ï¼Œåƒè¿™æ ·ä»¥å…ƒç´ ä¸ºå•ä½è¿›è¡Œè½¬æ¢çš„æ“ä½œï¼Œç»Ÿä¸€ç§°ä½œâ€œ**æ˜ å°„**â€ã€‚

æ˜ å°„è¿‡åï¼ŒRDDç±»å‹ç”±åŸæ¥çš„RDD\[String]å˜ä¸ºRDD\[Array\[String]]ã€‚å¦‚æœæŠŠRDD\[String]çœ‹æˆæ˜¯â€œæ•°ç»„â€çš„è¯ï¼Œé‚£ä¹ˆRDD\[Array\[String]]å°±æ˜¯ä¸€ä¸ªâ€œäºŒç»´æ•°ç»„â€ï¼Œå®ƒçš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯å•è¯ã€‚

![](https://static001.geekbang.org/resource/image/1e/2a/1e364df2yy57857efafc1023c102942a.jpg?wh=2284x758 "ä»¥è¡Œä¸ºå•ä½åšåˆ†è¯")

ä¸ºäº†åç»­å¯¹å•è¯åšåˆ†ç»„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹è¿™ä¸ªâ€œäºŒç»´æ•°ç»„â€åš**å±•å¹³**ï¼Œä¹Ÿå°±æ˜¯å»æ‰å†…å±‚çš„åµŒå¥—ç»“æ„ï¼ŒæŠŠâ€œäºŒç»´æ•°ç»„â€è¿˜åŸæˆâ€œä¸€ç»´æ•°ç»„â€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](https://static001.geekbang.org/resource/image/b5/34/b51c79dfeeb393456f2392011688c934.jpg?wh=2284x643 "åˆ†è¯ååšå±•å¹³")

å°±è¿™æ ·ï¼Œåœ¨flatMapç®—å­çš„ä½œç”¨ä¸‹ï¼ŒåŸæ¥ä»¥è¡Œä¸ºå…ƒç´ çš„lineRDDï¼Œè½¬æ¢æˆäº†ä»¥å•è¯ä¸ºå…ƒç´ çš„wordRDDã€‚

ä¸è¿‡ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ç”¨â€œç©ºæ ¼â€å»åˆ†å‰²å¥å­ï¼Œæœ‰å¯èƒ½ä¼šäº§ç”Ÿç©ºå­—ç¬¦ä¸²ã€‚æ‰€ä»¥ï¼Œåœ¨å®Œæˆâ€œæ˜ å°„â€å’Œâ€œå±•å¹³â€ä¹‹åï¼Œå¯¹äºè¿™æ ·çš„â€œå•è¯â€ï¼Œæˆ‘ä»¬è¦æŠŠå…¶ä¸­çš„ç©ºå­—ç¬¦ä¸²éƒ½è¿‡æ»¤æ‰ï¼Œè¿™é‡Œæˆ‘ä»¬è°ƒç”¨RDDçš„filteræ–¹æ³•æ¥è¿‡æ»¤ï¼š

```scala
// è¿‡æ»¤æ‰ç©ºå­—ç¬¦ä¸²
val cleanWordRDD: RDD[String] = wordRDD.filter(word => !word.equals(""))
```

è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬åœ¨åˆ†è¯é˜¶æ®µå°±å¾—åˆ°äº†è¿‡æ»¤æ‰ç©ºå­—ç¬¦ä¸²ä¹‹åçš„å•è¯â€œæ•°ç»„â€ï¼Œç±»å‹æ˜¯RDD\[String]ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‡†å¤‡åšåˆ†ç»„è®¡æ•°äº†ã€‚

### ç¬¬ä¸‰æ­¥ï¼Œåˆ†ç»„è®¡æ•°

åœ¨RDDçš„å¼€å‘æ¡†æ¶ä¸‹ï¼Œèšåˆç±»æ“ä½œï¼Œå¦‚è®¡æ•°ã€æ±‚å’Œã€æ±‚å‡å€¼ï¼Œéœ€è¦ä¾èµ–**é”®å€¼å¯¹**ï¼ˆKey Value Pairï¼‰ç±»å‹çš„æ•°æ®å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯ï¼ˆKeyï¼ŒValueï¼‰å½¢å¼çš„â€œæ•°ç»„â€å…ƒç´ ã€‚

å› æ­¤ï¼Œåœ¨è°ƒç”¨èšåˆç®—å­åšåˆ†ç»„è®¡æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬è¦å…ˆæŠŠRDDå…ƒç´ è½¬æ¢ä¸ºï¼ˆKeyï¼ŒValueï¼‰çš„å½¢å¼ï¼Œä¹Ÿå°±æ˜¯æŠŠRDD\[String]æ˜ å°„æˆRDD\[(String, Int)]ã€‚

å…¶ä¸­ï¼Œæˆ‘ä»¬ç»Ÿä¸€æŠŠæ‰€æœ‰çš„Valueç½®ä¸º1ã€‚è¿™æ ·ä¸€æ¥ï¼Œå¯¹äºåŒä¸€ä¸ªçš„å•è¯ï¼Œåœ¨åç»­çš„è®¡æ•°è¿ç®—ä¸­ï¼Œæˆ‘ä»¬åªè¦å¯¹Valueåšç´¯åŠ å³å¯ï¼Œå°±åƒè¿™æ ·ï¼š

![](https://static001.geekbang.org/resource/image/9c/ac/9c4c96fe9a9f48f0cb7e2e1f3374f5ac.jpg?wh=2284x866 "æŠŠå…ƒç´ è½¬æ¢ä¸ºï¼ˆKeyï¼ŒValueï¼‰å½¢å¼")

ä¸‹é¢æ˜¯å¯¹åº”çš„ä»£ç ï¼š

```scala
// æŠŠRDDå…ƒç´ è½¬æ¢ä¸ºï¼ˆKeyï¼ŒValueï¼‰çš„å½¢å¼
val kvRDD: RDD[(String, Int)] = cleanWordRDD.map(word => (word, 1))Â 
```

è¿™æ ·ä¸€æ¥ï¼ŒRDDå°±ç”±åŸæ¥å­˜å‚¨Stringå…ƒç´ çš„cleanWordRDDï¼Œè½¬æ¢ä¸ºäº†å­˜å‚¨ï¼ˆStringï¼ŒIntï¼‰çš„kvRDDã€‚

å®Œæˆäº†å½¢å¼çš„è½¬æ¢ä¹‹åï¼Œæˆ‘ä»¬å°±è¯¥æ­£å¼åšåˆ†ç»„è®¡æ•°äº†ã€‚åˆ†ç»„è®¡æ•°å…¶å®æ˜¯ä¸¤ä¸ªæ­¥éª¤ï¼Œä¹Ÿå°±æ˜¯å…ˆâ€œåˆ†ç»„â€ï¼Œå†â€œè®¡æ•°â€ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬ä½¿ç”¨èšåˆç®—å­reduceByKeyæ¥åŒæ—¶å®Œæˆåˆ†ç»„å’Œè®¡æ•°è¿™ä¸¤ä¸ªæ“ä½œã€‚

å¯¹äºkvRDDè¿™ä¸ªé”®å€¼å¯¹â€œæ•°ç»„â€ï¼ŒreduceByKeyå…ˆæ˜¯æŒ‰ç…§Keyï¼ˆä¹Ÿå°±æ˜¯å•è¯ï¼‰æ¥åšåˆ†ç»„ï¼Œåˆ†ç»„ä¹‹åï¼Œæ¯ä¸ªå•è¯éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„Valueåˆ—è¡¨ã€‚ç„¶åæ ¹æ®ç”¨æˆ·æä¾›çš„èšåˆå‡½æ•°ï¼Œå¯¹åŒä¸€ä¸ªKeyçš„æ‰€æœ‰Valueåšreduceè¿ç®—ã€‚

è¿™é‡Œçš„reduceï¼Œä½ å¯ä»¥ç†è§£æˆæ˜¯ä¸€ç§è®¡ç®—æ­¥éª¤æˆ–æ˜¯ä¸€ç§è®¡ç®—æ–¹æ³•ã€‚å½“æˆ‘ä»¬ç»™å®šèšåˆå‡½æ•°åï¼Œå®ƒä¼šç”¨æŠ˜å çš„æ–¹å¼ï¼ŒæŠŠåŒ…å«å¤šä¸ªå…ƒç´ çš„åˆ—è¡¨è½¬æ¢ä¸ºå•ä¸ªå…ƒç´ å€¼ï¼Œä»è€Œç»Ÿè®¡å‡ºä¸åŒå…ƒç´ çš„æ•°é‡ã€‚

åœ¨Word Countçš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨reduceByKeyå®ç°åˆ†ç»„è®¡ç®—çš„ä»£ç å¦‚ä¸‹ï¼š

```scala
// æŒ‰ç…§å•è¯åšåˆ†ç»„è®¡æ•°
val wordCounts: RDD[(String, Int)] = kvRDD.reduceByKey((x, y) => x + y)Â 
```

å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¼ é€’ç»™reduceByKeyç®—å­çš„èšåˆå‡½æ•°æ˜¯(x, y) =&gt; x + yï¼Œä¹Ÿå°±æ˜¯ç´¯åŠ å‡½æ•°ã€‚å› æ­¤ï¼Œåœ¨æ¯ä¸ªå•è¯åˆ†ç»„ä¹‹åï¼Œreduceä¼šä½¿ç”¨ç´¯åŠ å‡½æ•°ï¼Œä¾æ¬¡æŠ˜å è®¡ç®—Valueåˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œæœ€ç»ˆæŠŠå…ƒç´ åˆ—è¡¨è½¬æ¢ä¸ºå•è¯çš„é¢‘æ¬¡ã€‚å¯¹äºä»»æ„ä¸€ä¸ªå•è¯æ¥è¯´ï¼Œreduceçš„è®¡ç®—è¿‡ç¨‹éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](https://static001.geekbang.org/resource/image/c1/c4/c1b5022a6c8d62226ba53af3dd90b2c4.jpg?wh=2284x747 "reduceæ“ä½œç¤ºæ„å›¾")

reduceByKeyå®Œæˆè®¡ç®—ä¹‹åï¼Œæˆ‘ä»¬å¾—åˆ°çš„ä¾ç„¶æ˜¯ç±»å‹ä¸ºRDD\[(String, Int)]çš„RDDã€‚ä¸è¿‡ï¼Œä¸kvRDDä¸åŒï¼ŒwordCountså…ƒç´ çš„Valueå€¼ï¼Œè®°å½•çš„æ˜¯æ¯ä¸ªå•è¯çš„ç»Ÿè®¡è¯é¢‘ã€‚åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†Word Countä¸»é€»è¾‘çš„å¼€å‘ä¸å®ç°ã€‚

![](https://static001.geekbang.org/resource/image/79/33/7948a3d9c923791e139397988fcc6433.jpg?wh=2284x791 "reduceByKeyè½¬æ¢ç¤ºæ„å›¾")

åœ¨ç¨‹åºçš„æœ€åï¼Œæˆ‘ä»¬è¿˜è¦æŠŠwordCountsæŒ‰ç…§è¯é¢‘åšæ’åºï¼Œå¹¶æŠŠè¯é¢‘æœ€é«˜çš„5ä¸ªå•è¯æ‰“å°åˆ°å±å¹•ä¸Šï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚

```scala
// æ‰“å°è¯é¢‘æœ€é«˜çš„5ä¸ªè¯æ±‡
wordCounts.map{case (k, v) => (v, k)}.sortByKey(false).take(5)
```

### **ä»£ç æ‰§è¡Œ**

åº”ç”¨å¼€å‘å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠä»£ç ä¸¢è¿›å·²ç»å‡†å¤‡å¥½çš„æœ¬åœ°Sparkéƒ¨ç½²ç¯å¢ƒé‡Œå•¦ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ‰“å¼€å‘½ä»¤è¡Œç»ˆç«¯ï¼ˆTerminalï¼‰ï¼Œæ•²å…¥â€œspark-shellâ€ï¼Œæ‰“å¼€äº¤äº’å¼è¿è¡Œç¯å¢ƒï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](https://static001.geekbang.org/resource/image/65/4d/65257daf7030ca80c3da9c615edb654d.jpg?wh=1790x978 "spark-shellå¯åŠ¨ç•Œé¢")

ç„¶åï¼ŒæŠŠæˆ‘ä»¬å¼€å‘å¥½çš„ä»£ç ï¼Œä¾æ¬¡æ•²å…¥spark-shellã€‚ä¸ºäº†æ–¹ä¾¿ä½ æ“ä½œï¼Œæˆ‘æŠŠå®Œæ•´çš„ä»£ç å®ç°æ•´ç†åˆ°ä¸‹é¢äº†ï¼š

```scala
import org.apache.spark.rdd.RDD
 
// è¿™é‡Œçš„ä¸‹åˆ’çº¿"_"æ˜¯å ä½ç¬¦ï¼Œä»£è¡¨æ•°æ®æ–‡ä»¶çš„æ ¹ç›®å½•
val rootPath: String = _
val file: String = s"${rootPath}/wikiOfSpark.txt"
 
// è¯»å–æ–‡ä»¶å†…å®¹
val lineRDD: RDD[String] = spark.sparkContext.textFile(file)
 
// ä»¥è¡Œä¸ºå•ä½åšåˆ†è¯
val wordRDD: RDD[String] = lineRDD.flatMap(line => line.split(" "))
val cleanWordRDD: RDD[String] = wordRDD.filter(word => !word.equals(""))
 
// æŠŠRDDå…ƒç´ è½¬æ¢ä¸ºï¼ˆKeyï¼ŒValueï¼‰çš„å½¢å¼
val kvRDD: RDD[(String, Int)] = cleanWordRDD.map(word => (word, 1))
// æŒ‰ç…§å•è¯åšåˆ†ç»„è®¡æ•°
val wordCounts: RDD[(String, Int)] = kvRDD.reduceByKey((x, y) => x + y)
 
// æ‰“å°è¯é¢‘æœ€é«˜çš„5ä¸ªè¯æ±‡
wordCounts.map{case (k, v) => (v, k)}.sortByKey(false).take(5)
```

æˆ‘ä»¬æŠŠä¸Šé¢çš„ä»£ç ä¾æ¬¡æ•²å…¥åˆ°spark-shellä¹‹åï¼Œspark-shellæœ€ç»ˆä¼šæŠŠè¯é¢‘æœ€é«˜çš„5ä¸ªå•è¯æ‰“å°åˆ°å±å¹•ä¸Šï¼š

![](https://static001.geekbang.org/resource/image/6a/f4/6acf199e126b205c92c2ec03ffba33f4.png?wh=1524x84 "æ‰“å°è¯é¢‘æœ€é«˜çš„5ä¸ªè¯æ±‡")

åœ¨Wikipediaçš„Sparkä»‹ç»æ–‡æœ¬ä¸­ï¼Œè¯é¢‘æœ€é«˜çš„å•è¯åˆ†åˆ«æ˜¯theã€Sparkã€aã€andå’Œofï¼Œé™¤äº†â€œSparkâ€ä¹‹å¤–ï¼Œå…¶ä»–4ä¸ªå•è¯éƒ½æ˜¯å¸¸ç”¨çš„åœç”¨è¯ï¼ˆStop Wordï¼‰ï¼Œå› æ­¤å®ƒä»¬å‡ ä¸ªé«˜å±…æ¦œé¦–ä¹Ÿå°±ä¸è¶³ä¸ºæ€ªäº†ã€‚

å¥½å•¦ï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬åœ¨Sparkä¹‹ä¸Šï¼Œå®Œæˆäº†â€œå¤§æ•°æ®é¢†åŸŸHello Worldâ€çš„å¼€å‘ä¸å®ç°ï¼Œæ­å–œä½ è·¨å…¥å¤§æ•°æ®å¼€å‘çš„å¤§é—¨ï¼

## é‡ç‚¹å›é¡¾

ä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å›´ç»•ç€Word Countï¼Œåˆæ­¥æ¢ç´¢å¹¶ä½“éªŒäº†Sparkåº”ç”¨å¼€å‘ã€‚ä½ é¦–å…ˆéœ€è¦æŒæ¡çš„æ˜¯Sparkçš„æœ¬åœ°éƒ¨ç½²ï¼Œä»è€Œå¯ä»¥é€šè¿‡spark-shellæ¥è¿…é€Ÿç†Ÿæ‚‰Sparkï¼Œè·å¾—å¯¹Sparkçš„â€œç¬¬ä¸€å°è±¡â€ã€‚è¦åœ¨æœ¬åœ°éƒ¨ç½²Sparkï¼Œä½ éœ€è¦éµå¾ª3ä¸ªæ­¥éª¤ï¼š

- ä»[Sparkå®˜ç½‘](http://spark.apache.org/downloads.html)ä¸‹è½½å®‰è£…åŒ…ï¼Œé€‰æ‹©æœ€æ–°çš„é¢„ç¼–è¯‘ç‰ˆæœ¬å³å¯ï¼›
- è§£å‹Sparkå®‰è£…åŒ…åˆ°ä»»æ„æœ¬åœ°ç›®å½•ï¼›
- å°†â€œ${è§£å‹ç›®å½•}/binâ€é…ç½®åˆ°PATHç¯å¢ƒå˜é‡ã€‚

ç„¶åï¼Œæˆ‘ä»¬ä¸€èµ·åˆ†æå¹¶å®ç°äº†å…¥é—¨Sparkçš„ç¬¬ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼šWord Countã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼ŒWord Countè¦å®Œæˆçš„è®¡ç®—ä»»åŠ¡ï¼Œæ˜¯å…ˆå¯¹æ–‡ä»¶ä¸­çš„å•è¯åšç»Ÿè®¡è®¡æ•°ï¼Œç„¶åå†æ‰“å°å‡ºé¢‘æ¬¡æœ€é«˜çš„5ä¸ªå•è¯ã€‚å®ƒçš„å®ç°è¿‡ç¨‹åˆ†ä¸º3ä¸ªæ­¥éª¤ï¼š

- è¯»å–å†…å®¹ï¼šè°ƒç”¨Sparkæ–‡ä»¶è¯»å–APIï¼ŒåŠ è½½wikiOfSpark.txtæ–‡ä»¶å†…å®¹ï¼›
- åˆ†è¯ï¼šä»¥è¡Œä¸ºå•ä½ï¼ŒæŠŠå¥å­æ‰“æ•£ä¸ºå•è¯ï¼›
- åˆ†ç»„è®¡æ•°ï¼šæŒ‰ç…§å•è¯åšåˆ†ç»„è®¡æ•°ã€‚

ä¹Ÿè®¸ä½ å¯¹RDD APIè¿˜ä¸ç†Ÿæ‚‰ï¼Œç”šè‡³ä»æœªæ¥è§¦è¿‡Scalaï¼Œä¸è¿‡æ²¡å…³ç³»ï¼Œå®Œæˆäº†è¿™æ¬¡â€œå¤§æ•°æ®çš„Hello Worldâ€å¼€å‘ä¹‹æ—…ï¼Œä½ å°±å·²ç»è¸ä¸Šäº†æ–°çš„å¾ç¨‹ã€‚åœ¨æ¥ä¸‹æ¥çš„è¯¾ç¨‹é‡Œï¼Œè®©æˆ‘ä»¬æºæ‰‹å¹¶è‚©ï¼Œåƒæ¢ç´¢æ–°å¤§é™†ä¸€æ ·ï¼Œä¸€å±‚ä¸€å±‚åœ°å‰¥å¼€Sparkçš„ç¥ç§˜é¢çº±ï¼ŒåŠ æ²¹ï¼

## æ¯è¯¾ä¸€ç»ƒ

åœ¨Word Countçš„ä»£ç å®ç°ä¸­ï¼Œæˆ‘ä»¬ç”¨åˆ°äº†å¤šç§å¤šæ ·çš„RDDç®—å­ï¼Œå¦‚mapã€filterã€flatMapå’ŒreduceByKeyï¼Œé™¤äº†è¿™äº›ç®—å­ä»¥å¤–ï¼Œä½ çŸ¥é“è¿˜æœ‰å“ªäº›å¸¸ç”¨çš„RDDç®—å­å—ï¼Ÿï¼ˆæç¤ºï¼Œå¯ä»¥ç»“åˆ[å®˜ç½‘](https://spark.apache.org/docs/latest/rdd-programming-guide.html#transformations)å»æŸ¥æ‰¾ï¼‰ã€‚

å¦å¤–ï¼Œä½ èƒ½è¯´è¯´ï¼Œä»¥ä¸Šè¿™äº›ç®—å­éƒ½æœ‰å“ªäº›å…±æ€§æˆ–æ˜¯å…±åŒç‚¹å—ï¼Ÿ

æ¬¢è¿ä½ æŠŠç­”æ¡ˆåˆ†äº«åˆ°è¯„è®ºåŒºï¼Œæˆ‘åœ¨è¯„è®ºåŒºç­‰ä½ ã€‚

å¦‚æœè¿™ä¸€è®²å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¹Ÿæ¬¢è¿ä½ åˆ†äº«ç»™è‡ªå·±çš„æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹ä¸€è®²å†è§ï¼
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ15ï¼‰</strong></div><ul>
<li><span>Alvin-L</span> ğŸ‘ï¼ˆ21ï¼‰ ğŸ’¬ï¼ˆ6ï¼‰<p>åœ¨Pythonä¸­è¿è¡Œ:
``` 
from pyspark import SparkContext

textFile = SparkContext().textFile(&quot;.&#47;wikiOfSpark.txt&quot;)
wordCount = (
    textFile.flatMap(lambda line: line.split(&quot; &quot;))
    .filter(lambda word: word != &quot;&quot;)
    .map(lambda word: (word, 1))
    .reduceByKey(lambda x, y: x + y)
    .sortBy(lambda x: x[1], False)
    .take(5)
)
print(wordCount)
#æ˜¾ç¤º: [(&#39;the&#39;, 67), (&#39;Spark&#39;, 63), (&#39;a&#39;, 54), (&#39;and&#39;, 51), (&#39;of&#39;, 50)]
``` 
</p>2021-09-20</li><br/><li><span>liugddx</span> ğŸ‘ï¼ˆ44ï¼‰ ğŸ’¬ï¼ˆ4ï¼‰<p>æˆ‘æ˜¯ä¸€ä¸ªå¤§æ•°æ®å°ç™½ï¼Œæˆ‘æƒ³å’¨è¯¢ä¸‹sparkå’Œhadoopåœ¨å¤§æ•°æ®ä½“ç³»ä¸‹çš„å…³ç³»ï¼Ÿ</p>2021-09-07</li><br/><li><span>Neo-dqy</span> ğŸ‘ï¼ˆ26ï¼‰ ğŸ’¬ï¼ˆ5ï¼‰<p>è€å¸ˆå¥½ï¼wordCounts.map{case (k, v) =&gt; (v, k)}.sortByKey(false).take(5)è¿™è¡Œä»£ç æˆ‘è¿˜å­˜åœ¨ç–‘é—®ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œçš„mapå‡½æ•°ä½¿ç”¨äº†èŠ±æ‹¬å·{ }è€Œä¸æ˜¯ä¸Šé¢ä¸€äº›ç®—å­çš„( )ï¼ŒåŒæ—¶è¿™ä¸ªcaseåˆæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿè¿™ä¸€è¡Œä»£ç éå¸¸åƒæˆ‘æ›¾ç»åœ¨Pythonä¸­ä½¿ç”¨å­—å…¸æ•°æ®ç»“æ„ï¼Œç„¶åæ ¹æ®å­—å…¸å€¼çš„å‡åºæ’åºã€‚æœ€åï¼Œè²Œä¼¼Scalaè¯­è¨€æœ¬èº«å°±å¯ä»¥å®ç°wordcountæ¡ˆä¾‹ï¼Œé‚£ä¹ˆå®ƒæœ¬èº«çš„å®ç°å’Œsparkå®ç°ç›¸æ¯”ï¼Œsparkæœ‰ä»€ä¹ˆä¼˜åŠ¿å‘¢ï¼Ÿ</p>2021-09-18</li><br/><li><span>Vic</span> ğŸ‘ï¼ˆ8ï¼‰ ğŸ’¬ï¼ˆ9ï¼‰<p>é‡åˆ°è¿™ä¸ªé—®é¢˜
scala&gt; val rootPath: String = _
&lt;console&gt;:24: error: unbound placeholder parameter
       val rootPath: String = _
ç½‘ä¸Šæœä¸€ä¸‹ï¼Œè¯´è¿™æ˜¯æ±‡ç¼–é”™è¯¯ã€‚
è¦æŠŠval æ”¹æˆvar , ä½†ä¼šé‡åˆ°&quot;_&quot;è¿™defaultå€¼æ˜¯nullã€‚
org.apache.hadoop.mapred.InvalidInputException: Input path does not exist: file:&#47;Users&#47;vic&#47;src&#47;data&#47;null&#47;wikiOfSpark.txt
è¿™ä¸€æ®µå°±å…ˆè·³è¿‡root_pathï¼Œç›´æ¥ç»™fileä¸€ä¸ªè·¯å¾„ï¼Œæ˜¯å¯ä»¥æˆåŠŸè¿è¡Œ&quot;word count&quot;,å¾—åˆ°å’Œè€å¸ˆä¸€æ ·çš„ç»“æœ:
[Stage 0:&gt;                                                          (0 + 2) &#47;                                                                               res0: Array[(Int, String)] = Array((67,the), (63,Spark), (54,a), (51,and), (50,of))</p>2021-09-07</li><br/><li><span>Neo-dqy</span> ğŸ‘ï¼ˆ6ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆæˆ‘å¯ä»¥å†é—®ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘æ˜¯ç”¨IDEAåˆ›å»ºSparké¡¹ç›®ï¼Œæ˜¯ä¸æ˜¯åªè¦é…ç½®å¥½Scalaçš„SDKï¼Œç„¶ååœ¨pomæ–‡ä»¶ä¸­åŠ å…¥å¯¹åº”ç‰ˆæœ¬å·çš„sparkä¾èµ–ï¼Œå°±ä¼šè‡ªåŠ¨ä¸‹è½½sparkåŒ…äº†ï¼Ÿè¿™ä¸ªæ—¶å€™ä¸éœ€è¦å†å»å®˜ç½‘ä¸‹è½½sparkäº†å—ï¼ŒåŒæ—¶ä¹Ÿä¸å†éœ€è¦ä½¿ç”¨spark-shelläº†å—ï¼Ÿ</p>2021-09-18</li><br/><li><span>Abigail</span> ğŸ‘ï¼ˆ6ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>å‰æ’å åº§ï¼ä¸‰å¹´å‰æ¥è§¦è¿‡ Spark ä»Šå¤©ä»å¤´å†å­¦ï¼</p>2021-09-07</li><br/><li><span>æµ®ç”Ÿè‹¥æ¢¦</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ4ï¼‰<p>Javaå®ç°ï¼š

SparkConf sparkConf = new SparkConf().setAppName(&quot;Test&quot;).setMaster(&quot;local[*]&quot;);
        JavaSparkContext JSC = new JavaSparkContext(sparkConf);

        &#47;&#47; è¯»å–æ–‡ä»¶å†…å®¹
        JavaRDD&lt;String&gt; lineRDD = JSC.textFile(&quot;wikiOfSpark.txt&quot;);
        &#47;&#47; ä»¥è¡Œä¸ºå•ä½åšåˆ†è¯
        JavaRDD&lt;String&gt; wordRDD = lineRDD.flatMap(new FlatMapFunction&lt;String, String&gt;() {
            @Override
            public Iterator&lt;String&gt; call(String s) throws Exception {
                return  Arrays.asList(s.split(&quot; &quot;)).iterator();
            }
        });
        JavaRDD&lt;String&gt; cleanWordRDD = wordRDD.filter(new Function&lt;String, Boolean&gt;() {
            @Override
            public Boolean call(String s) throws Exception {
                return !s.equals(&quot;&quot;);
            }
        });

        &#47;&#47; æŠŠRDDå…ƒç´ è½¬æ¢ä¸ºï¼ˆKeyï¼ŒValueï¼‰çš„å½¢å¼
        JavaPairRDD&lt;String, Integer&gt; kvRDD = cleanWordRDD.mapToPair(new PairFunction&lt;String, String, Integer&gt;() {
            @Override
            public Tuple2&lt;String, Integer&gt; call(String s) throws Exception {
                return new Tuple2&lt;String, Integer&gt;(s,1);
            }
        });
        &#47;&#47; æŒ‰ç…§å•è¯åšåˆ†ç»„è®¡æ•°
        JavaPairRDD&lt;String, Integer&gt; wordCounts = kvRDD.reduceByKey(new Function2&lt;Integer, Integer, Integer&gt;() {
            @Override
            public Integer call(Integer integer, Integer integer2) throws Exception {
                return integer+integer2;
            }
        });
        &#47;&#47; æ‰“å°è¯é¢‘æœ€é«˜çš„5ä¸ªè¯æ±‡(å…ˆå°†å…ƒç»„çš„key valueäº¤æ¢ä¸€ä¸‹é¡ºåºï¼Œç„¶ååœ¨è°ƒç”¨sortByKey())
        wordCounts.mapToPair((row)-&gt;  new Tuple2&lt;&gt;(row._2,row._1)).sortByKey(false).foreach(new VoidFunction&lt;Tuple2&lt;Integer, String&gt;&gt;() {
            @Override
            public void call(Tuple2&lt;Integer, String&gt; stringIntegerTuple2) throws Exception {
                System.out.println(stringIntegerTuple2._1 + &quot;:&quot; + stringIntegerTuple2._2);
            }
        });

        &#47;&#47;å…³é—­context
        JSC.close();</p>2021-12-24</li><br/><li><span>ç«ç‚ç„±ç‡š</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>Pythonç‰ˆä»£ç ä¸ºï¼š

file=&#39;~~~&#47;wikiOfSpark.txt&#39;
lineRDD=sc.textFile(file)
lineRDD.first() # ä¼šæ‰“å°å‡ºlineRDDçš„ç¬¬ä¸€è¡Œï¼š u&#39;Apache Spark&#39;ï¼Œå¦‚æœå‡ºé”™åˆ™ä¸æ‰“å°
wordRDD=lineRDD.flatMap(lambda line: line.split(&quot; &quot;))
cleanWordRDD=wordRDD.filter(lambda word: word!=&#39;&#39;)
kvRDD=cleanWordRDD.map(lambda word:(word,1))
wordCounts=kvRDD.reduceByKey(lambda x,y:x+y)
wordCounts.map(lambda (k,v):(v,k)).sortByKey(False).take(5)</p>2021-09-17</li><br/><li><span>Unknown element</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>é—®ä¸‹æ‰§è¡Œ val lineRDD: RDD[String] = spark.sparkContext.textFile(file) æŠ¥é”™error: not found: value sparkæ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ</p>2021-09-17</li><br/><li><span>å›½åº¦</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>2022å¹´2æœˆ5å·å­¦ä¹ æ‰“å¡è®°å½•
æœºå™¨ç¯å¢ƒï¼šROG14
æ“ä½œç³»ç»Ÿï¼šwin11 + wsl Ubuntu20.04
ç¯å¢ƒå˜é‡ï¼š
----------------------------

export SPARK_HOME=&#47;mnt&#47;c&#47;spark&#47;spark-2.4.8-bin-hadoop2.7
export JAVA_HOME=&#47;mnt&#47;c&#47;linux_environment&#47;jdk&#47;jdk1.8.0_321
export M2_HOME=&#47;mnt&#47;c&#47;linux_environment&#47;apache-maven-3.8.4
export SCALA_HOME=&#47;mnt&#47;c&#47;linux_environment&#47;scala3-3.1.1

export PATH=$SPARK_HOME&#47;bin:$SCALA_HOME&#47;bin:$M2_HOME&#47;bin:$JAVA_HOME&#47;bin:$PATH

---------------------------
å¸Œæœ›å¸®åŠ©å’Œæˆ‘ä¸€æ ·ä»é›¶å¼€å§‹ä¸€èµ·å­¦ä¹ çš„åŒå­¦èº²é¿ä¸€äº›å‘ï¼š

å‘1ï¼šjdkç‰ˆæœ¬ä¸å…¼å®¹ï¼š
ä¸€å¼€å§‹ä½¿ç”¨jdk17ç‰ˆæœ¬ï¼Œåœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ä¸€ç›´æŠ¥é”™ï¼Œé™ä¸º1.8åå¯åŠ¨æˆåŠŸï¼›

å‘2ï¼šhadoopç‰ˆæœ¬é—®é¢˜ï¼š
hadoop3.2.1 é€æ­¥ä½¿ç”¨Datasetï¼ŒæŠ¥é”™ç±»å‹è½¬æ¢å¼‚å¸¸ï¼›
ç”±äºscalaç»éªŒä¸è¶³ï¼Œæš‚æ—¶æ— æ³•å¤§è§„æ¨¡æ”¹å†™è€å¸ˆçš„ä»£ç ï¼Œé™ä½ç‰ˆæœ¬ä¸ºspark2.4.8
ä¸‹è½½åœ°å€ï¼šhttps:&#47;&#47;dlcdn.apache.org&#47;spark&#47; å¯ä»¥é€‰æ‹©é€‚åˆçš„ç‰ˆæœ¬ä¸‹è½½

åŸç†æ€§çš„è¿˜æ²¡æœ‰ææ‡‚ï¼Œç›®å‰åœ¨ç¬¬ä¸€é˜¶æ®µï¼Œè¯»æ‡‚ï¼Œç®€å•æ”¹å†™ä¸ºä¸»ï¼›

æ„Ÿè°¢å´ç£Šè€å¸ˆçš„è¯¾</p>2022-02-05</li><br/><li><span>çŒ«å¤ªå¤ª</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è¯·é—®åœ¨æœ¬åœ°éƒ¨ç½²sparkç¯å¢ƒä¸éœ€è¦å…ˆå®‰è£…hadoopä¹ˆ</p>2021-11-18</li><br/><li><span>å·´æ™®æ´›å¤«çš„</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>wordCounts.map{case (k, v) =&gt; (v, k)}.sortByKey(false) 
è¿™ä¸€æ­¥æ˜¯åšäº†ä»€ä¹ˆå‘¢ï¼Œæ²¡æœ‰è§è¿‡çš„è¯­æ³•</p>2021-09-12</li><br/><li><span>Z</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>ä¸ºå•¥æˆ‘çš„ç»“æœæ˜¯å•ä¸ªå­—æ¯å‘¢ï¼Ÿ</p>2021-09-08</li><br/><li><span>é’±é¹ Allen</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>æ³¨æ„ç©ºæ ¼â€œ â€ï¼Œå’Œç©ºå­—ç¬¦ä¸²â€œâ€ï¼Œå‰è€…æœ‰ç©ºæ ¼ï¼Œåè€…æ²¡æœ‰

ä¹¦å†™çš„æ—¶å€™ï¼Œæ ¹æ®è‡ªå·±çš„æ–‡ä»¶æ‰€åœ¨ç›®å½•æ¥ï¼Œæ¯”å¦‚æˆ‘çš„æ˜¯ &#47;input&#47;wikiOfSpark.txt
ä¸è¦é—æ¼åç¼€åã€‚

å­¦ä¹ çš„è¿‡ç¨‹ï¼Œéœ€è¦ç»™è‡ªå·±ä¸€äº›è€å¿ƒå’Œé¼“åŠ±ï¼Œä¸€èµ·åŠ æ²¹æŠŠï¼</p>2021-09-07</li><br/><li><span>GACÂ·DU</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>Spark RDDç®—å­åˆ†ä¸ºTransformationç®—å­å’ŒActionç®—å­ï¼ŒTransformationç®—å­åŸºæœ¬ä¸Šéƒ½æ˜¯å»¶è¿Ÿè®¡ç®—ï¼Œéœ€è¦é€šè¿‡è°ƒç”¨Actionç®—å­è¿›è¡Œè§¦å‘ã€‚</p>2021-09-07</li><br/>
</ul>