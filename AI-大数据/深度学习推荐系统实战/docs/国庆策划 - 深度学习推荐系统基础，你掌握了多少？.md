ä½ å¥½ï¼Œæˆ‘æ˜¯ç‹å–†ã€‚

ä»Šå¤©æ˜¯å›½åº†å‡æœŸçš„ç¬¬äºŒå¤©ï¼Œæˆ‘åœ¨åŸºç¡€æ¶æ„ç¯‡çš„åŸºç¡€ä¸Šï¼Œè®¾è®¡äº†ä¸€å¥—æµ‹è¯•é¢˜ï¼Œå¸Œæœ›ä½ èƒ½åœ¨å‡æœŸé‡Œè¯•åšä¸€ä¸‹ï¼Œæ¸©æ•…çŸ¥æ–°ï¼Œå·©å›ºæ‰€å­¦ã€‚

åœ¨è¿™å¥—æµ‹è¯•é¢˜ä¸­ï¼Œæœ‰ 10 é“é€‰æ‹©é¢˜ï¼Œæ¯é“é¢˜ 10 åˆ†ï¼Œæ»¡åˆ†ä¸º 100ã€‚è¿™äº›å†…å®¹å…¨éƒ¨æ¥è‡ªæˆ‘ä»¬ä¹‹å‰ä¸“æ æ‰€è®²çš„å†…å®¹ï¼Œéƒ½æ˜¯åŸºç¡€çŸ¥è¯†ï¼Œå¸Œæœ›èƒ½å¸®åŠ©ä½ æŸ¥ç¼ºè¡¥æ¼ã€‚

æœ€åå‘¢ï¼Œæˆ‘è¿˜ä¸ºä½ å‡†å¤‡äº†ä¸¤é“å®è·µé¢˜ï¼Œè¿™ä¸¤é“é¢˜ä¸ºé€‰åšã€‚å¦‚æœä½ å¯¹è‡ªå·±æœ‰æ›´é«˜çš„è¦æ±‚ï¼Œæˆ‘å¸Œæœ›ä½ å¯ä»¥show me the codeï¼å½“ç„¶ï¼Œåœ¨ç­”é¢˜å’Œå®è·µä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œéƒ½å¯ä»¥åœ¨ç•™è¨€åŒºè¯„è®ºï¼Œæˆ‘ä»¬ä¸€èµ·æ¥æ¢è®¨ã€‚è¿˜ç­‰ä»€ä¹ˆï¼Œç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®å¼€å§‹æµ‹è¯•å§ï¼

## é€‰æ‹©é¢˜

[![](https://static001.geekbang.org/resource/image/28/a4/28d1be62669b4f3cc01c36466bf811a4.png?wh=1142%2A201)](http://time.geekbang.org/quiz/intro?act_id=216&exam_id=666)

## é—®ç­”é¢˜

ç¬¬ä¸€é¢˜ï¼šé€šè¿‡é˜…è¯»SparrowRecSysçš„ä»£ç ï¼Œä½ èƒ½æ‰¾åˆ°é¦–é¡µä¸­æ¯è¡Œå†…éƒ¨çš„ç”µå½±éƒ½æ˜¯æŒ‰ç…§ä»€ä¹ˆæ’åºçš„å—ï¼Ÿ

ç¬¬äºŒé“é¢˜ï¼šå¦‚æœä½ å·²ç»å‘ç°äº†æ’åºçš„è§„åˆ™ï¼Œä½ èƒ½åœ¨æ¨èæœåŠ¡å™¨çš„ä»£ç é‡Œæ·»åŠ ä¸€ä¸ªå«â€œçƒ­åº¦â€ï¼ˆpopularityï¼‰çš„æ’åºè§„åˆ™ï¼Œç„¶åè®©é¦–é¡µæŒ‰ç…§â€œçƒ­åº¦â€æ’åºå—ï¼ˆğŸ’¡è¡¥å……ï¼šçƒ­åº¦çš„å®šä¹‰æ˜¯â€œè¿™ä¸ªç”µå½±è¢«è¯„ä»·çš„æ¬¡æ•°â€ï¼‰ï¼Ÿ

æˆ‘ç›¸ä¿¡è¿™æ˜¯ç†Ÿæ‚‰movielensæ•°æ®ã€æ¨èæœåŠ¡å™¨ä»£ç çš„ä¸€ä¸ªéå¸¸å¥½çš„æœºä¼šï¼Œé‚£åœ¨å®ç°è¿‡ç¨‹ä¸­çš„ä»»ä½•é—®é¢˜ï¼Œéƒ½æ¬¢è¿ä½ ç•™è¨€å’Œæˆ‘äº¤æµï¼æˆ‘ä»¬10æœˆ9æ—¥å†è§ï¼
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ15ï¼‰</strong></div><ul>
<li><span>ç¥ç»è›™</span> ğŸ‘ï¼ˆ24ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>è¯¾åé¢˜ï¼š
1.æ’åºä¾æ®ï¼š
	æ ¹æ®å½±ç‰‡å†å²å¹³å‡è¯„åˆ†ï¼Œé™åºæ’åˆ—ã€‚è¯¦ç»†è°ƒç”¨è¿‡ç¨‹ï¼š
	a.index.htmlé‡Œé¢çš„jsä»£ç ï¼Œè°ƒç”¨åœ¨å¤´éƒ¨åŠ è½½çš„recsys.js çš„addGenreRow, ä¼ å…¥å‚æ•°(é¡µé¢ID,å½±ç‰‡ç±»åˆ«åç§°,rowId, æ¯è¡Œæ”¾ç½®å½±ç‰‡ä¸ªæ•°,baseUrl)
	b.åœ¨addGenreRowè°ƒç”¨å·²æ³¨å†Œçš„ getrecommendation æœåŠ¡ï¼Œä¼ å‚çš„æ’åºä¾æ®ä¸ºrating.
	c.æœåŠ¡getrecommendationç»‘å®šç±»RecommendationService, GETè¯·æ±‚æ•°æ®
	d.RecommendationService.doGet ä¸­ è°ƒç”¨ online.datamanager.DataManager#getMoviesByGenre,æ ¹æ®æ¯ä¸ªå½±ç‰‡çš„å†å²å¹³å‡rating,é™åºæ’åˆ—.
2.æ ¹æ®popularityæ’åº:
	a.recsys.js
		function addGenreRow(pageId, rowName, rowId, size, baseUrl) {
		    addRowFrame(pageId, rowName, rowId, baseUrl);
		    $.getJSON(baseUrl + &quot;getrecommendation?genre=&quot;+rowName+&quot;&amp;size=&quot;+size+&quot;&amp;sortby=popularity&quot;, function(result){
		        $.each(result, function(i, movie){
		          appendMovie2Row(rowId, movie.title, movie.movieId, movie.releaseYear, movie.averageRating.toPrecision(2), movie.ratingNumber, movie.genres,baseUrl);
		        });
		    });
		};
	b.com.wzhe.sparrowrecsys.online.datamanager.DataManager#getMoviesByGenre:
		æ·»åŠ ä¸€è¡Œï¼š
		case &quot;popularity&quot;: movies.sort((m1, m2) -&gt; Integer.compare(m2.getRatingNumber(), m1.getRatingNumber()));break;

		ç”¨mmovie.getRatings.size() ä¹Ÿè¡Œï¼Œä½†åº”è¯¥æ•ˆç‡æ¯”ä¸Šé¢çš„ä½ã€‚
	c.æ”¹æ”¹å‰ç«¯çš„å±•ç¤ºä»£ç 
		ä¸å¤ªæ“…é•¿</p>2020-11-24</li><br/><li><span>Sean</span> ğŸ‘ï¼ˆ10ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>ç¬¬ä¸€é¢˜
æ˜¯æ ¹æ®ç”µå½±çš„åˆ†æ•°(rating)æ’åºçš„

ç¬¬äºŒé¢˜
1. å…ˆä»RecSysServer.javaè¿›å…¥ï¼Œæ‰¾åˆ°68è¡Œçš„RecommendationService
2. å†çœ‹åˆ°getMoviesByGenre.javaç¬¬35è¡Œçš„getMoviesByGenre()
3. åœ¨switchä¸­æ–°å¢: case &quot;popularity&quot;: movies.sort((m1, m2) -&gt; Integer.compare(m2.getRatingNumber(), m1.getRatingNumber()));break; å°±æ˜¯æŒ‰ç…§çƒ­åº¦æ’åºäº†
4. å†å›åˆ°RecommendationServiceçš„33è¡Œï¼Œ String sortby = request.getParameter(&quot;sortby&quot;); ä»£è¡¨æ’åºä¾æ®çš„å‚æ•°æ˜¯ç”±æŸä¸ªapiä¼ å…¥çš„
5. æ‰¾åˆ°recsys.jsç¬¬102è¡Œï¼ŒæŠŠsortby=ratingä¿®æ”¹ä¸ºsortby=popularityå³å¯ï¼š$.getJSON(baseUrl + &quot;getrecommendation?genre=&quot;+rowName+&quot;&amp;size=&quot;+size+&quot;&amp;sortby=popularity&quot;, function(result)</p>2021-04-28</li><br/><li><span>æœ±æœˆä¿Š</span> ğŸ‘ï¼ˆ8ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>å…ˆè¯´ä¸€ä¸‹æ¯ä¸€ç§ç±»å‹çš„ç”µå½±æ˜¯å¦‚ä½•æ’åçš„ï¼š
é»˜è®¤æ˜¯æŒ‰ç…§æ‰“åˆ†å¹³å‡åˆ†æ•°ä»¥åŠå‘å¸ƒæ—¶é—´æ’åï¼Œåœ¨recsys.jsä¸­çš„addGenereRowå¤„æŒ‡å®šæ’åçš„æ–¹å¼ã€‚
å¦‚ä½•æ–°å¢æ’åç®—æ³•ï¼Œæ¯”å¦‚å¢åŠ çƒ­åº¦è¿™ä¸ªæŒ‡æ ‡ï¼Ÿ
éœ€è¦åœ¨DataManagerä¸­ç…§è‘«èŠ¦ç”»ç“¢å¢åŠ ratingNumberï¼Œç„¶ååœ¨jsä¸­æŒ‡å®šä¸€ä¸‹å³å¯ã€‚

è¿˜åœ¨ç ”ç©¶çš„é—®é¢˜ï¼šé¦–é¡µæ˜¯å¦‚ä½•è°ƒç”¨getrecommendationæ¥å£ä»¥åŠå¦‚ä½•ä¼ å…¥å‚æ•°çš„ã€‚éº»çƒ¦è€å¸ˆæŒ‡æ•™ä¸€ä¸‹ã€‚</p>2020-10-07</li><br/><li><span>Kepler</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>é—®é¢˜ï¼šå¦‚æœä¿®æ”¹jsåŠå¯¹åº”çš„RecommendationServiceåï¼Œä¸»é¡µä»æœªæ˜¾ç¤ºæ’åºæ•ˆæœ
è§£å†³ï¼š
æ–¹å¼1. æ‹‰æ–°githubï¼ˆæ¨èï¼Œé¿å…åç»­æœ‰ä»€ä¹ˆå…¶ä»–é—®é¢˜ï¼‰
æ–¹å¼2. ä¿®æ”¹index.htmlçš„&lt;script src=&quot;.&#47;js&#47;recsys.js&quot;&gt;&lt;&#47;script&gt;ï¼ŒåŸåŠ è½½jsæ–‡ä»¶ä¸ºrecsys.js?v=1.19</p>2021-02-03</li><br/><li><span>ALAN</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>é—®é¢˜ä¸€ï¼šæŒ‰ç”µå½±çš„å¹³å‡æ‰“åˆ†ä»é«˜åˆ°ä½æ’åº
é—®é¢˜äºŒï¼šä¿®æ”¹DataManager.javaä¸­221è¡Œä»£ç ã€‚å°†comparaå‡½æ•°ä¸­å‚æ•°getAverageRatingå‡½æ•°æ”¹æˆgetRatingNumberå‡½æ•°</p>2020-10-05</li><br/><li><span>å¤§é’°å„¿</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>ä»Šå¤©æ‹‰çš„ä¸»å¹²ä»£ç ï¼Œé»˜è®¤ç”¨äº†redisè½½å…¥embeddingå¯¼è‡´æ— æ³•å¯åŠ¨ï¼Œæ˜¯ä¸æ˜¯éœ€è¦æ”¹ä¸€ä¸‹ğŸ˜…</p>2020-10-13</li><br/><li><span>é‡‘é¹</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>é—®é¢˜ä¸€ï¼š
é¦–é¡µæ¯è¡Œï¼ˆä¸€ä¸ªç±»åˆ«ï¼‰æŒ‰ç”µå½±çš„AverageRatingå¹³å‡æ‰“åˆ†ä»é«˜åˆ°ä½åšä¸ºæ’åºä¾æ®ï¼›

é—®é¢˜äºŒï¼š
public List&lt;Movie&gt; getMoviesByGenre(String genre, int size, String sortBy){
        if (null != genre){
            List&lt;Movie&gt; movies = new ArrayList&lt;&gt;(this.genreReverseIndexMap.get(genre));
            switch (sortBy){
                case &quot;rating&quot;:movies.sort((m1, m2) -&gt; Double.compare(m2.getAverageRating(), m1.getAverageRating()));break;
                case &quot;releaseYear&quot;: movies.sort((m1, m2) -&gt; Integer.compare(m2.getReleaseYear(), m1.getReleaseYear()));break;
                case &quot;popularity&quot;:movies.sort((m1, m2) -&gt; Integer.compare(m2.getRatingNumber(), m1.getRatingNumber()));break;
                default:
            }
........</p>2020-10-02</li><br/><li><span>è½©</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è¯¾åé€‰æ‹©é¢˜ä¹ é¢˜ç¬¬äºŒé¢˜ï¼šæ„Ÿè§‰é€‰é¡¹Då…¶å®ä¹Ÿæ˜¯æ·±åº¦å­¦ä¹ å¸¦æ¥çš„é‡è¦å˜é©ã€‚
æ¨èç³»ç»Ÿæ˜¯è¿æ¥äººä¸ç‰©çš„ï¼Œé‚£ä¹ˆå¦‚ä½•è¡¨ç¤ºå’Œç¼–ç äººä¸ç‰©å°±æ˜¯éå¸¸é‡è¦çš„ï¼Œæ¯•ç«Ÿåªæœ‰æ›´å¥½çš„è®¤çŸ¥ï¼Œæ‰èƒ½å¸¦æ¥æ›´å¥½çš„è¿æ¥ï¼Œæ·±åº¦å­¦ä¹ å¸¦æ¥çš„è¡¨ç¤ºå­¦ä¹ æˆ‘è§‰çš„èƒ½ç®—æ˜¯é‡è¦å˜é©å§ï¼Ÿè™½ç„¶éæ·±åº¦å­¦ä¹ æ—¶ä»£çš„çŸ©é˜µåˆ†è§£ç­‰å¾—åˆ°çš„latent vectorä¹Ÿç®—æ˜¯embeddingå§ï¼Œä½†å’Œå¦‚ä»Šä¸‡ç‰©çš†å¯embeddingï¼Œåº”è¯¥ç®—æ˜¯ä¸ªé‡è¦å˜é©ï¼Ÿ</p>2021-01-06</li><br/><li><span>VICTOR</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>é’ˆå¯¹ä¿®æ”¹å®Œåå‰ç«¯æ²¡æœ‰ç°å®çš„åŸå› ï¼Œå¯èƒ½æ˜¯å› ä¸ºjsç¼“å­˜çš„åŸå› ï¼Œå°è¯•Win: Ctrl+Shift+R &#47; Mac OS: Cmd+Shft+R å¼ºåˆ¶åˆ·æ–°ç¼“å­˜è¿›è¡Œåˆ·æ–°</p>2021-11-29</li><br/><li><span>é—«é˜¿ä½³éœ€è¦å­¦ä¹ </span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>ä¿®æ”¹index.htmlçš„&lt;script src=&quot;.&#47;js&#47;recsys.js&quot;&gt;&lt;&#47;script&gt; æ²¡æœ‰èµ·ä½œç”¨ï¼Œæœ€åè¿˜æ˜¯æ¸…æ¥šç¼“å­˜é‡æ–°åŠ è½½åæ˜¾ç¤ºçš„
æ­¥éª¤ï¼šï¼ˆchromeï¼‰F12-&gt;å‹¾é€‰&quot; Disable cache&quot; -&gt; åˆ·æ–°</p>2021-10-04</li><br/><li><span>yangchao</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>æ€è€ƒé¢˜
1.é¦–é¡µä¸­æ¯è¡Œå†…éƒ¨çš„ç”µå½±éƒ½æ˜¯æŒ‰ç…§ratingå³è¯„åˆ†è¿›è¡Œæ’åºçš„

2.é¦–å…ˆä¿®æ”¹DataManagerç±»ä¸‹çš„getMoviesByGenre:
case &quot;popularity&quot;: movies.sort((m1, m2) -&gt; Integer.compare(m2.getRatingNumber(), m1.getRatingNumber()));break;

ç„¶ååœ¨recsys.jsé‡Œæ–°å¢æ–¹æ³•ï¼š
function addGenreRowByPopularitySort(pageId, rowName, rowId, size, baseUrl) {
     addRowFrame(pageId, rowName, rowId, baseUrl);
     $.getJSON(baseUrl + &quot;getrecommendation?genre=&quot;+rowName+&quot;&amp;size=&quot;+size+&quot;&amp;sortby=popularity&quot;, function(result){
         $.each(result, function(i, movie){
             appendMovie2Row(rowId, movie.title, movie.movieId, movie.releaseYear, movie.averageRating.toPrecision(2), movie.ratingNumber, movie.genres,baseUrl);
         });
     });
 };

æœ€ååœ¨index.htmlé‡Œ å°†æ‰€æœ‰ addGenreRowæ›¿æ¢ä¸ºaddGenreRowByPopularitySort

æœ€åé‡æ–°ç¼–è¯‘é‡å¯goå³å¯
</p>2022-02-23</li><br/><li><span>yangchao</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>è€ƒè¯•ç»“æœï¼š
https:&#47;&#47;time.geekbang.org&#47;quiz&#47;?act_id=216&amp;exam_id=666&amp;source=1009560</p>2022-02-23</li><br/><li><span>Geek_0ea2ff</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>ç¬¬äºŒé¢˜ï¼Œä¿®æ”¹æˆæŒ‰Popularityæ’åºï¼Œè·‘å‡ºæ¥çš„ç»“æœä¸å¯¹ï¼ŒåŒç±»å‹ç”µå½±æ²¡æœ‰æŒ‰ratingNumberé™åºå±•ç¤ºã€‚</p>2022-01-24</li><br/><li><span>åœŸè±†æ˜¯å¤©ä½¿</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>è€å¸ˆï¼ŒæŒ‰ç…§åˆ«çš„åŒå­¦è¯´çš„æ”¹äº†ä»£ç ï¼Œä¹ŸæŒ‰ç…§ä¸èƒ½æ˜¾ç¤ºçš„æ–¹æ³•è¯•äº†ï¼Œæ’åºç»“æœè¿˜æ˜¯å’Œä¹‹å‰ä¸€æ ·</p>2021-11-13</li><br/><li><span>Geek_8a732a</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>1ã€æŒ‰ç…§ç”µå½±å¹³å‡å†å²è¯„åˆ†è¿›è¡Œæ’åº

2ã€RecSysServer.javaçš„68è¡Œæ‰¾åˆ°RecommendationService()ï¼Œè¿›å…¥åæ‰¾åˆ°35è¡ŒgetMoviesByGenreï¼Œå†è¿›å…¥åï¼Œåœ¨switché‡Œæ–°å¢ case &quot;popularity&quot;: movies.sort((m1,m2) -&gt; Integer.compare(m2.getRatingNumber(),m1.getRatingNumber()));break;

3ã€å›åˆ°RecommendationService.javaä¸­æ‰¾åˆ° 
&#47;&#47;ranking algorithm
String sortby = request.getParameter(&quot;sortby&quot;);
é€‰ä¸­sortbyï¼Œå³é”®find in filesï¼Œ
æ‰¾åˆ°
$.getJSON(baseUrl + &quot;getrecommendation?genre=&quot;+rowName+&quot;&amp;size=&quot;+size+&quot;&amp;sortby=rating&quot;, function(result)
å°†å…¶ä¸­çš„sortby=ratingï¼Œæ”¹æˆsortby=popularity

4ã€ä¸ºçœ‹æ˜¾ç¤ºæ•ˆæœï¼Œå‚è€ƒäº†Kelperçš„â€œ ä¿®æ”¹index.htmlçš„&lt;script src=&quot;.&#47;js&#47;recsys.js&quot;&gt;&lt;&#47;script&gt;ï¼ŒåŸåŠ è½½jsæ–‡ä»¶ä¸ºrecsys.js?v=1.19â€ï¼Œç„¶åé‡æ–°run RecSysServer.javaå°±å¯ä»¥äº†</p>2021-08-05</li><br/>
</ul>