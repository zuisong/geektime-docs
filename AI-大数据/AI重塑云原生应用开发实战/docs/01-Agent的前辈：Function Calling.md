ä½ å¥½ï¼Œæˆ‘æ˜¯é‚¢äº‘é˜³ã€‚

è‡ª2023å¹´3æœˆ ChatGPT åœ¨ä¸­å›½çˆ†ç«ä»¥æ¥ï¼Œå¤§æ¨¡å‹å·²ç»æ‚„ç„¶æ”¹å˜äº†è®¸å¤šäººçš„æé—®æ–¹å¼ï¼Œå°¤å…¶æ˜¯åœ¨äº’è”ç½‘åœˆå­é‡Œã€‚ä»ä»¥å‰çš„â€œæœ‰é—®é¢˜ï¼ŒGoogle ä¸€ä¸‹â€ï¼Œåˆ°ç°åœ¨çš„â€œå…ˆé—®é—®å¤§æ¨¡å‹â€ï¼Œè¿™ç§è½¬å˜åæ˜ äº†æŠ€æœ¯å¯¹æ—¥å¸¸ç”Ÿæ´»çš„æ·±è¿œå½±å“ï¼Œæ¯”å¦‚å›¾ä¸­è¿™ä½å¥³å£«å°±å°† ChatGPT ä½¿ç”¨çš„æ·‹æ¼“å°½è‡´ã€‚

![](https://static001.geekbang.org/resource/image/d6/23/d608212c2ebb73c43ee94353f6021923.jpg?wh=968x961)

ä½†æ˜¯åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œæœ‰æ—¶å¤§æ¨¡å‹å¹¶ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå®ƒä¼šä¸€æœ¬æ­£ç»çš„ç»™å‡ºé”™è¯¯ç­”æ¡ˆï¼Œä¸šç•ŒæŠŠè¿™ç§ç°è±¡ç§°ä¹‹ä¸ºâ€œå¹»è§‰â€ã€‚æ¯”å¦‚æˆ‘é—® ChatGPT-4o ä¸€ä¸ªå®ƒè‚¯å®šä¸ä¼šçš„é—®é¢˜ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/12/ce/126d324784yy8bfb4d2ff9fc66475fce.png?wh=1221x505)

æˆ‘ä»¬ä¼šå‘ç°ï¼Œå¤§æ¨¡å‹ç»™å‡ºäº†çœ‹ä¼¼æ­£ç¡®å®åˆ™â€œåºŸè¯â€çš„ç­”æ¡ˆã€‚

å†æ¯”å¦‚ï¼Œæˆ‘é—®ä¸€é“å°å­¦ä¸€äºŒå¹´çº§çš„æ•°å­¦é¢˜ï¼š

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/34/6e/342d4b45a41122d6868b5686d546586e.png?wh=1183x264)

æˆ‘ä»¬å¾ˆå®¹æ˜“çŸ¥é“1+2+3+4-5-6=-1ï¼Œä½†å¤§æ¨¡å‹ç»™æˆ‘ä»¬çš„ç­”æ¡ˆæ˜¯0ã€‚

â€œå¹»è§‰â€å‡ºç°çš„åŸå› å…¶å®å¾ˆç®€å•ã€‚æˆ‘ä»¬çŸ¥é“ä½œä¸ºäººç±»æ¥è¯´ï¼Œå³ä½¿æ˜¯æ‰é«˜å…«æ–—ï¼Œå­¦å¯Œäº”è½¦ï¼Œä¹Ÿä¸å¯èƒ½ä»€ä¹ˆéƒ½æ‡‚ï¼Œäºæ˜¯å°±æœ‰è¿™æ ·ä¸€ç§äººï¼Œä¸ºäº†é¢å­ï¼Œåœ¨é‡åˆ°ä¸ä¼šçš„é—®é¢˜æ—¶ï¼Œä¹Ÿè¦å¼ºè¡Œç»™å‡ºä¸€ä¸ªæ¨¡æ¨¡ç³Šç³Šçš„ç­”æ¡ˆï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºä¸æ‡‚è£…æ‡‚ã€‚

åŒæ ·ï¼Œä½œä¸ºå¤§æ¨¡å‹ï¼Œè®­ç»ƒæ•°æ®æ˜¯æœ‰é™çš„ï¼Œç‰¹åˆ«æ˜¯å¯¹äºä¸€äº›å‚ç›´é¢†åŸŸä»¥åŠå®æ—¶æ€§çš„é—®é¢˜ï¼Œä¾‹å¦‚é™„è¿‘å“ªæœ‰åŠ æ²¹ç«™ï¼Ÿä»Šå¤©çš„èŒ…å°è‚¡ç¥¨å¤šå°‘é’±ä¸€è‚¡ï¼Ÿå¤§æ¨¡å‹æ˜¯æ— æ³•ç»™å‡ºæ­£ç¡®çš„å›ç­”çš„ã€‚é‚£å¤§æ¨¡å‹ä¸ºä»€ä¹ˆä¹Ÿå¤„ç†ä¸äº†å°å­¦æ•°å­¦é¢˜å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºå¤§æ¨¡å‹çš„è®­ç»ƒæ–¹æ³•æ˜¯é€šè¿‡å­¦ä¹ è¯­è¨€çš„ç»“æ„å’Œæ¨¡å¼ï¼Œä½¿å¾—å…¶èƒ½å¤Ÿç”Ÿæˆä¸äººç±»è¯­è¨€ç›¸ä¼¼çš„æ–‡æœ¬ï¼Œè€Œä¸æ˜¯é’ˆå¯¹æ•°å­¦é—®é¢˜è¿™ç§ç²¾ç¡®é€»è¾‘åšçš„è®­ç»ƒï¼Œå› æ­¤å®ƒçš„æ•°å­¦èƒ½åŠ›å¾ˆå¼±ã€‚

æˆ‘ä»¬åº”å¦‚ä½•è§£å†³è¿™ç±»é—®é¢˜å‘¢ï¼ŸOpenAI å…¬å¸ä¸ºäº†èƒ½è®©å¤§æ¨¡å‹ä¸å¤–ç•Œè¿›è¡Œäº¤äº’ï¼Œå‘æ˜äº† Function Calling æœºåˆ¶ï¼Œå³å¯ä»¥åœ¨å‘å¤§æ¨¡å‹æé—®æ—¶ï¼Œç»™å¤§æ¨¡å‹æä¾›ä¸€äº›å·¥å…·ï¼ˆå‡½æ•°ï¼‰ï¼Œç”±å¤§æ¨¡å‹æ ¹æ®éœ€è¦ï¼Œè‡ªè¡Œé€‰æ‹©åˆé€‚çš„å·¥å…·ï¼Œä»è€Œè§£å†³é—®é¢˜ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘å°†ä½¿ç”¨Goè¯­è¨€ï¼Œä¸ºä½ æ¼”ç¤ºä¸€ä¸‹ Function Calling åŠŸèƒ½ï¼Œæˆ‘ä»¬å°±ä»¥åŠ æ³•å‡æ³•å·¥å…·ä¸ºä¾‹ï¼Œè®©å¤§æ¨¡å‹é€šè¿‡å·¥å…·æ¥è¿›è¡Œæ•°å­¦è¿ç®—ã€‚

## ä»£ç å®æˆ˜å‰ç½®å·¥ä½œ

### ç¯å¢ƒå‡†å¤‡

- è¿è¡Œç¯å¢ƒï¼šWindows/Linux
- Goç‰ˆæœ¬ï¼š1.19
- LLMï¼šé˜¿é‡Œäº‘ qwen-turbo
- SDKï¼šgo-openai v1.32.0

è€ƒè™‘åˆ°ä½¿ç”¨ OpenAI çš„æ¨¡å‹ï¼Œéœ€è¦ç§‘å­¦ä¸Šç½‘ï¼Œä¸”è´­ä¹° API çš„è°ƒç”¨é¢åº¦ï¼Œéœ€è¦ç¾å›½ä¿¡ç”¨å¡æ”¯ä»˜ã€‚å› æ­¤æˆ‘ä»¬é€‰æ‹©å›½å†…æ¨¡å‹ä½œä¸ºæ›¿ä»£æ¼”ç¤ºã€‚å¦‚æœæœ‰åŒå­¦æƒ³äº†è§£å¦‚ä½•ä½¿ç”¨ OpenAI API ï¼Œå¯ç•™è¨€åŒºç•™è¨€è¯„è®ºï¼Œæˆ‘ä»¬ä¸åœ¨è¯¾ç¨‹ä¸­å±•ç¤ºã€‚

### é€šä¹‰åƒé—®å¤§æ¨¡å‹å¼€é€š

é˜¿é‡Œäº‘é€šä¹‰åƒé—®æä¾›äº†æ¯”è¾ƒä¸°å¯Œçš„å¤§æ¨¡å‹äº§å“ä¾›ç”¨æˆ·ä½¿ç”¨ï¼Œä¸”å…¶è¯·æ±‚æ–¹å¼æ˜¯å…¼å®¹ OpenAI SDK çš„ã€‚æœ¬å°èŠ‚å®æˆ˜æ‰€ä½¿ç”¨çš„æ¨¡å‹æ˜¯é€šä¹‰åƒé—®ä¸­æœ€ä¾¿å®œçš„ qwen-turbo æ¨¡å‹ã€‚å¦‚ä½•å¼€é€šæœåŠ¡ï¼Œå¯å‚è€ƒå®˜ç½‘æ•™ç¨‹[å¼€é€šDashScopeå¹¶åˆ›å»ºAPI-KEY\_æ¨¡å‹æœåŠ¡çµç§¯(DashScope)-é˜¿é‡Œäº‘å¸®åŠ©ä¸­å¿ƒ (aliyun.com)](https://help.aliyun.com/zh/dashscope/opening-service?spm=a2c22.12281978.0.0.4d59588ebiflN0) ã€‚

## ä»£ç å®æˆ˜æ¼”ç¤º

### æ¨¡å‹ç¯å¢ƒå˜é‡é…ç½®

å½“æˆ‘ä»¬è·å–äº†é€šä¹‰åƒé—®å¤§æ¨¡å‹çš„ api\_key ä¹‹åï¼Œä¸ºäº†ä¿å¯†å’Œè°ƒç”¨æ–¹ä¾¿ï¼Œå¯ä»¥å°†å…¶é…ç½®åˆ°ç¯å¢ƒå˜é‡ã€‚

ä»¥ Windows ç³»ç»Ÿä¸ºä¾‹ï¼Œæˆ‘çš„ç”µè„‘-&gt;å³é”®å±æ€§-&gt;é«˜çº§ç³»ç»Ÿè®¾ç½®-&gt;ç¯å¢ƒå˜é‡ï¼Œåœ¨ç³»ç»Ÿå˜é‡ä¸­ç‚¹å‡»æ–°å»ºã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/94/89/94c2859904708be8205faba30011bc89.png?wh=1030x472)

è¾“å…¥å˜é‡åå’Œ api\_key çš„å€¼å³å¯ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹å†™åˆå§‹åŒ– OpenAI å®¢æˆ·ç«¯çš„ä»£ç ã€‚

é¦–å…ˆå°† go-openai sdk ä¸‹è½½ä¸‹æ¥ã€‚

```plain
go get github.com/sashabaranov/go-openai
```

ä¹‹åï¼Œå¼€å§‹åˆå§‹åŒ–ä¸€ä¸ª OpenAI å®¢æˆ·ç«¯ï¼Œéœ€è¦å¡«å…… token å’Œ baseurl ä¸¤é¡¹ï¼Œç”¨äºå®¢æˆ·ç«¯ä¸å¤§æ¨¡å‹æœåŠ¡å™¨çš„è¿æ¥ã€‚

```go
func NewOpenAiClient() *openai.Client {
Â  Â  token := os.Getenv("DashScope")
Â  Â  dashscope_url := "https://dashscope.aliyuncs.com/compatible-mode/v1"
Â  Â  config := openai.DefaultConfig(token)
Â  Â  config.BaseURL = dashscope_url


Â  Â  return openai.NewClientWithConfig(config)
}
```

ç”±äºé€šä¹‰åƒé—®å¤§æ¨¡å‹æ˜¯å…¼å®¹ OpenAI çš„ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ OpenAI SDK åˆå§‹åŒ–å¤§æ¨¡å‹å®¢æˆ·ç«¯ã€‚ä½¿ç”¨ os åŒ…ä»ç¯å¢ƒå˜é‡ä¸­è·å– api\_keyã€‚

### Chat Completions

æˆ‘ä»¬åœ¨æ¼”ç¤ºå·¥å…·é€‰æ‹©ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦æŠŠå’Œå¤§æ¨¡å‹å¯¹è¯çš„åŸºç¡€ä»£ç å†™å¥½ã€‚è¿™å°±è¦ç”¨åˆ° Chat Completionsã€‚Chat Completions æ˜¯ OpenAI SDK æä¾›çš„ä¸€æ¬¡æ€§å¯¹è¯çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒå¯ä»¥å®Œæˆå’Œå¤§æ¨¡å‹çš„å¯¹è¯ã€‚

åœ¨ä¸å¤§æ¨¡å‹çš„å¯¹è¯è¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰ä¸‰ç§åŸºç¡€è§’è‰²ï¼Œç”¨æ¥è®©å¤§æ¨¡å‹æ¸…æ¥šæŸå¥è¯æ˜¯è°è¯´çš„ã€‚

- systemï¼šç³»ç»Ÿè§’è‰²ï¼Œå¯ä»¥ç†è§£ä¸ºå…¨å±€å˜é‡æˆ–å‰ç½®æ¡ä»¶ï¼Œè®¾ç½®ä¸Šè¿™ä¸ªè§’è‰²ä¹‹åï¼Œå°±ä¼šè§„å®šå¤§æ¨¡å‹çš„èŠå¤©èŒƒå›´ï¼Œä¸šç•Œé€šå¸¸ç§°ä¹‹ä¸ºâ€œäººè®¾â€ã€‚
- userï¼šäººç±»è§’è‰²ï¼Œä»£è¡¨è¿™å¥è¯æ˜¯äººç±»è¯´çš„ã€‚åœ¨åŒ…æ‹¬ LangChain åœ¨å†…çš„å¾ˆå¤šæ¡†æ¶å’Œåœºæ™¯ä¸‹ï¼Œuser è§’è‰²ä¹Ÿä¼šè¢«å†™æˆ humanã€‚
- assistantï¼šAIè§’è‰²ï¼Œä»£è¡¨è¿™å¥è¯æ˜¯å¤§æ¨¡å‹ç»™æˆ‘ä»¬çš„è¿”å›ã€‚åœ¨åŒ…æ‹¬ LangChain åœ¨å†…çš„å¾ˆå¤šæ¡†æ¶å’Œåœºæ™¯ä¸‹ï¼Œassistant è§’è‰²ä¹Ÿä¼šè¢«å†™æˆ AIã€‚

æˆ‘ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œæ¼”ç¤ºä¸€ä¸‹ä½¿ç”¨ä»¥ä¸Šä¸‰ç§è§’è‰²å®Œæˆä¸€æ¬¡ Chat Completionsã€‚

```plain
system: ä½ æ˜¯ä¸€ä¸ªè¶³çƒé¢†åŸŸçš„ä¸“å®¶ï¼Œè¯·å°½å¯èƒ½åœ°å¸®æˆ‘å›ç­”ä¸è¶³çƒç›¸å…³çš„é—®é¢˜ã€‚
user: Cç½—æ˜¯å“ªä¸ªå›½å®¶çš„è¶³çƒè¿åŠ¨å‘˜ï¼Ÿ
assistant: è‘¡è„ç‰™
```

å¦‚æœæƒ³è¦å®ç°å¤šè½®å¯¹è¯æ•ˆæœï¼Œåˆ™éœ€è¦æ¯ä¸€æ¬¡éƒ½å¸¦ç€å†å²å¯¹è¯æé—®ï¼Œä¾‹å¦‚ï¼š

```plain
system: ä½ æ˜¯ä¸€ä¸ªè¶³çƒé¢†åŸŸçš„ä¸“å®¶ï¼Œè¯·å°½å¯èƒ½åœ°å¸®æˆ‘å›ç­”ä¸è¶³çƒç›¸å…³çš„é—®é¢˜ã€‚
user: Cç½—æ˜¯å“ªä¸ªå›½å®¶çš„è¶³çƒè¿åŠ¨å‘˜ï¼Ÿ
assistant: è‘¡è„ç‰™
user: å†…é©¬å°”å‘¢ï¼Ÿ
```

è™½ç„¶æœ€åä¸€æ¬¡äººç±»çš„æé—®â€œå†…é©¬å°”å‘¢â€æ˜¯ä¸€ä¸ªæ¨¡ç³Šæé—®ï¼Œä½†ç”±äºå­˜åœ¨å†å²å¯¹è¯ï¼Œå› æ­¤å¤§æ¨¡å‹å¯ä»¥ç†è§£ç”¨æˆ·çš„æé—®çš„æ„æ€æ˜¯â€œå†…é©¬å°”æ˜¯å“ªä¸ªå›½å®¶çš„è¶³çƒè¿åŠ¨å‘˜ï¼Ÿâ€

ç†è§£äº†ä¸‰ç§è§’è‰²åï¼Œæˆ‘ä»¬å¼€å§‹å†™ä»£ç ã€‚

```go
func Chat(message []openai.ChatCompletionMessage) openai.ChatCompletionMessage {
Â  Â  c := NewOpenAiClient()
Â  Â  rsp, err := c.CreateChatCompletion(context.TODO(), openai.ChatCompletionRequest{
Â  Â  Â  Â  Model: Â  Â "qwen-plus",
Â  Â  Â  Â  Messages: message,
Â  Â  })
Â  Â  if err != nil {
Â  Â  Â  Â  log.Println(err)
Â  Â  Â  Â  return openai.ChatCompletionMessage{}
Â  Â  }


Â  Â  return rsp.Choices[0].Message
}
```

åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œé¦–å…ˆæˆ‘è·å–äº† OpenAI å®¢æˆ·ç«¯ï¼Œä¹‹åé€šè¿‡å®¢æˆ·ç«¯è°ƒç”¨äº† CreateChatCompletion æ–¹æ³•ã€‚è¯¥æ–¹å¼æ˜¯å®Œæˆä¸€æ¬¡ä¸å¤§æ¨¡å‹çš„ Chatã€‚è¯¥æ–¹æ³•çš„è¿”å›å€¼ rspï¼Œä¾¿æ˜¯å¤§æ¨¡å‹çš„å›å¤ã€‚

åœ¨è¿™æ¬¡ Chat Compleetion ä¸­ï¼Œæˆ‘ä½¿ç”¨çš„æ¨¡å‹æ˜¯ qwen-plusï¼Œmessage å³å‘å¤§æ¨¡å‹å‘é€çš„æ¶ˆæ¯ã€‚message çš„ç±»å‹æ˜¯ä¸€ä¸ª openai.ChatCompletionMessage åˆ‡ç‰‡ã€‚

openai.ChatCompletionMessageåŒ…å«äº†å¤šä¸ªå­—æ®µï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªåŸºç¡€å­—æ®µä¸ºï¼š

```go
Role Â  Â  Â  Â  string `json:"role"`
Content Â  Â  Â string `json:"content"`
```

role ä»£è¡¨è§’è‰²ï¼Œcontent ä»£è¡¨å¯¹è¯å†…å®¹ã€‚

openai.ChatCompletionMessageä¸ºåˆ‡ç‰‡ç±»å‹ï¼Œæ˜¯å› ä¸ºè€ƒè™‘åˆ°ä¼šæœ‰å†å²æ¶ˆæ¯ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ„å»ºä¸€ä¸ªå†å²æ¶ˆæ¯å­˜å‚¨å™¨æ¥å­˜å‚¨å†å²å¯¹è¯ã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š

```go
var MessageStore ChatMessages
type ChatMessages []openai.ChatCompletionMessage


func (cm *ChatMessages) AddFor(role string, msg string) {
Â  Â  *cm = append(*cm, openai.ChatCompletionMessage{
Â  Â  Â  Â  Role: Â  Â role,
Â  Â  Â  Â  Content: msg,
Â  Â  })
}


func (cm *ChatMessages) ToMessage() []openai.ChatCompletionMessage {
Â  Â  ret := make([]openai.ChatCompletionMessage, len(*cm))
Â  Â  for index, c := range *cm {
Â  Â  Â  Â  ret[index] = c
Â  Â  }
Â  Â  return ret
}
```

åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†å†å²æ¶ˆæ¯å­˜å‚¨å™¨MessageStoreï¼Œå…¶æœ¬è´¨æ˜¯ä¸€ä¸ªç”¨äºå­˜æ”¾å„ç±»è§’è‰²å¯¹è¯å†…å®¹çš„ openai.ChatCompletionMessage åˆ‡ç‰‡ã€‚å¹¶ç¼–å†™äº† AddFor æ–¹æ³•ï¼Œç”¨äºæ·»åŠ å„ç±»è§’è‰²çš„å¯¹è¯å†…å®¹ï¼Œæœ€åç¼–å†™äº† ToMessage æ–¹æ³•ï¼Œç”¨äºå–å‡ºå­˜å‚¨å™¨ä¸­çš„æ‰€æœ‰æ¶ˆæ¯ã€‚

å®Œæˆäº†ä»¥ä¸Šç¼–ç åï¼Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•ä¸€ä¸‹å’Œå¤§æ¨¡å‹å¯¹è¯çš„æ•ˆæœäº†ã€‚

```go
func main() {
Â  Â  ai.MessageStore.AddFor(ai.RoleSystem, "ä½ æ˜¯ä¸€ä¸ªè¶³çƒé¢†åŸŸçš„ä¸“å®¶ï¼Œè¯·å°½å¯èƒ½åœ°å¸®æˆ‘å›ç­”ä¸è¶³çƒç›¸å…³çš„é—®é¢˜ã€‚")
Â  Â  ai.MessageStore.AddFor(ai.RoleUser, "Cç½—æ˜¯å“ªä¸ªå›½å®¶çš„è¶³çƒè¿åŠ¨å‘˜ï¼Ÿ")
Â  Â  ai.MessageStore.AddFor(ai.RoleAssistant, "Cç½—æ˜¯è‘¡è„ç‰™è¶³çƒè¿åŠ¨å‘˜ã€‚")
Â  Â  ai.MessageStore.AddFor(ai.RoleUser, "å†…é©¬å°”å‘¢ï¼Ÿ")


Â  Â  response := ai.Chat(ai.MessageStore.ToMessage())
Â  Â  fmt.Println(response.Content)
}
```

è¾“å‡ºï¼š

```go
å†…é©¬å°”æ˜¯å·´è¥¿è¶³çƒè¿åŠ¨å‘˜ã€‚
```

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¤§æ¨¡å‹æˆåŠŸçš„æ ¹æ®å¯¹è¯å†å²ï¼Œç†è§£äº†â€œå†…é©¬å°”å‘¢ï¼Ÿâ€è¡¨è¾¾çš„çœŸæ­£å«ä¹‰ã€‚

### Function Calling

ç”±äº Function Calling åŠŸèƒ½æ˜¯ OpenAI å…¬å¸å‘æ˜çš„ï¼Œå› æ­¤æˆ‘ä»¬å®šä¹‰å·¥å…·éœ€è¦éµå¾ª OpenAI SDK çš„è§„èŒƒã€‚è§„èŒƒå¦‚ä¸‹ï¼š

```go
const (
Â  Â  ToolTypeFunction ToolType = "function"
)


type Tool struct {
Â  Â  Type Â  Â  ToolType Â  Â  Â  Â  Â  Â `json:"type"`
Â  Â  Function *FunctionDefinition `json:"function,omitempty"`
}


type FunctionDefinition struct {
Â  Â  Name Â  Â  Â  Â string `json:"name"`
Â  Â  Description string `json:"description,omitempty"`
Â  Â  Parameters any `json:"parameters"`
}
```

è§„èŒƒè¿˜æ˜¯å¾ˆç®€å•çš„ï¼ŒåŒ…å«äº†å·¥å…·ç±»å‹ Type å’Œå·¥å…·å®šä¹‰ Function ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå…¶å®å·¥å…·ç±»å‹æ˜¯å†™æ­»çš„ â€œfuctionâ€ã€‚å·¥å…·å®šä¹‰åŒ…å«åç§° Nameã€æè¿° Description ä»¥åŠå‚æ•° Parameters ä¸‰ä¸ªéƒ¨åˆ†ã€‚

æ¥ä¸‹æ¥æˆ‘æ¥å®šä¹‰ä¸€ä¸ªåŠ æ³•å·¥å…·ï¼Œç»™ä½ åšä¸€ä¸‹æ¼”ç¤ºã€‚

```go
var AddToolDefine = openai.Tool{
Â  Â  Type: "function",
Â  Â  Function: &openai.FunctionDefinition{
Â  Â  Â  Â  Name: "AddTool",
Â  Â  Â  Â  Description: `
Â  Â  Â  Â  Use this tool for addition calculations.
Â  Â  Â  Â  Â  Â  example:
Â  Â  Â  Â  Â  Â  Â  Â  1+2 =?
Â  Â  Â  Â  Â  Â  then Action Input is: 1,2
Â  Â  Â  Â  `,
Â  Â  Â  Â  Parameters: `{"type":"object","properties":{"numbers":{"type":"array","items":{"type":"integer"}}}}`,
Â  Â  },
}
```

åœ¨æˆ‘çš„å·¥å…·å®šä¹‰çš„ Description éƒ¨åˆ†ï¼Œæˆ‘ä¸ä»…å†™æ¸…æ¥šäº† AddTool å·¥å…·çš„ä½œç”¨ï¼Œè¿˜ä¸¾äº†ä¸€ä¸ªä¾‹å­ï¼Œè¿™æ ·å¯ä»¥è®©å¤§æ¨¡å‹æ›´å¥½åœ°ç†è§£ã€‚åœ¨Parameterséƒ¨åˆ†ï¼Œæˆ‘ä½¿ç”¨äº†æ ‡å‡†çš„ json schema æ–¹å¼ç¼–å†™äº†å‚æ•°åç§°ã€ç±»å‹ç­‰ï¼Œè¿™æ ·ä¹Ÿæœ‰åŠ©äºå¤§æ¨¡å‹å‡†ç¡®ç†è§£ã€‚

åœ¨å®šä¹‰å¥½å·¥å…·åï¼Œæˆ‘ä»¬éœ€è¦åœ¨å‘å¤§æ¨¡å‹æé—®æ—¶ï¼Œå¸¦ä¸Šå·¥å…·ï¼Œå› æ­¤ Chat Completions å¢åŠ äº†ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ Toolsï¼Œç”¨äºæ¥æ”¶ \[]openai.tool åˆ—è¡¨ï¼›å¦ä¸€ä¸ªå‚æ•°æ˜¯ToolChoiceï¼Œç”¨äºè®¾ç½®è®©å¤§æ¨¡å‹ä½¿ç”¨å·¥å…·è¿˜æ˜¯ä¸ä½¿ç”¨å·¥å…·ï¼Œä¸€èˆ¬è®¾ç½®ä¸º â€œautoâ€ï¼Œæ„æ€æ˜¯è®©å¤§æ¨¡å‹è‡ªå·±æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©æ˜¯å¦è°ƒç”¨å·¥å…·ã€‚ä¿®æ”¹åçš„ chat å‡½æ•°ä»£ç å¦‚ä¸‹ï¼š

```go
func ToolsChat(message []openai.ChatCompletionMessage, tools []openai.Tool) openai.ChatCompletionMessage {
Â  Â  c := NewOpenAiClient()
Â  Â  rsp, err := c.CreateChatCompletion(context.TODO(), openai.ChatCompletionRequest{
Â  Â  Â  Â  Model: Â  Â  Â "qwen-turbo",
Â  Â  Â  Â  Messages: Â  message,
Â  Â  Â  Â  Tools: Â  Â  Â tools,
Â  Â  Â  Â  ToolChoice: "auto",
Â  Â  })
Â  Â  if err != nil {
Â  Â  Â  Â  log.Println(err)
Â  Â  Â  Â  return openai.ChatCompletionMessage{}
Â  Â  }


Â  Â  return rsp.Choices[0].Message
}
```

æœ‰äº†è¿™äº›åŸºç¡€ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘å¤§æ¨¡å‹æé—®ï¼Œæµ‹è¯•å·¥å…·é€‰æ‹©äº†ã€‚æˆ‘ä»¬è®©å¤§æ¨¡å‹è®¡ç®—ä¸€ä¸‹"1+2=?"

```go
func main() {
Â  Â  toolsList := make([]openai.Tool, 0)
Â  Â  toolsList = append(toolsList, tools.AddToolDefine, tools.SubToolDefine
)


Â  Â  prompt := "1+2=? Just give me a number result"
Â  Â  ai.MessageStore.AddFor(ai.RoleUser, prompt)


Â  Â  response := ai.ToolsChat(ai.MessageStore.ToMessage(), toolsList)
Â  Â  toolCall := response.ToolCalls


Â  Â  fmt.Println("å¤§æ¨¡å‹çš„å›å¤æ˜¯: ", response.Content)
Â  Â  fmt.Println("å¤§æ¨¡å‹é€‰æ‹©çš„å·¥å…·æ˜¯: ", toolCalls)
}
```

è¾“å‡ºï¼š

```go
å¤§æ¨¡å‹çš„å›å¤æ˜¯:Â Â 
å¤§æ¨¡å‹é€‰æ‹©çš„å·¥å…·æ˜¯:Â  [{0xc000284520 call_f31f9091de504216a3a84d function {AddTool {"numbers": [1, 2]}}}]
```

å¯ä»¥çœ‹åˆ°å¤§æ¨¡å‹é€‰æ‹©äº†å·¥å…· AddToolï¼Œå¹¶å°†å‚æ•°æŒ‰ç…§æˆ‘ä»¬çš„è¦æ±‚æ‹†è§£æˆäº† \[1, 2] è¿™æ ·ä¸€ä¸ªåˆ‡ç‰‡ã€‚åªè¦å¤§æ¨¡å‹é€‰æ‹©äº†å·¥å…·ï¼Œåˆ™å…¶å›å¤å°±ä¼šæ˜¯ç©ºå­—ç¬¦ä¸²ã€‚

æµ‹è¯•åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥åˆæ­¥ç†è§£æ‰€è°“å¤§æ¨¡å‹â€œè°ƒç”¨â€å·¥å…·çš„æœºåˆ¶ã€‚å…¶å®å°±æ˜¯å°†å·¥å…·ç”¨æ–‡å­—æè¿°æ¸…æ¥šï¼Œå¹¶å’Œé—®é¢˜ä¸€èµ·å‘é€ç»™å¤§æ¨¡å‹ï¼Œç”±å¤§æ¨¡å‹åˆ¤æ–­é€‰æ‹©å“ªä¸ªå·¥å…·èƒ½è§£å†³é—®é¢˜ã€‚å› æ­¤å…¶å® Function Calling è¿™ä¸ªè¡¨è¿°æˆ‘ä¸ªäººæ„Ÿè§‰å¹¶ä¸å‡†ç¡®ï¼Œæˆ–è®¸å« Function Selecting ä¼šæ›´åŠ æ²¡æœ‰æ­§ä¹‰ã€‚

**è¿™é‡Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸¤ä¸ªç»“è®ºï¼š**

1. **å·¥å…·çš„å®šä¹‰ä¹Ÿæ˜¯ promptï¼Œä¹Ÿå°±æ˜¯è¦æ¶ˆè€—** **token** **çš„ã€‚**
2. **å¤§æ¨¡å‹åªèƒ½é€‰æ‹©ä½¿ç”¨å·¥å…·ï¼è€Œä¸èƒ½è°ƒç”¨å·¥å…·ï¼çœŸæ­£è°ƒç”¨å·¥å…·çš„ä»ç„¶æ˜¯äººç±»ï¼**

æœ€åæˆ‘ä»¬çœ‹ä¸€ä¸‹ï¼Œäººç±»å¦‚ä½•è°ƒç”¨å·¥å…·ï¼Œå¹¶å°†ç»“æœåé¦ˆç»™å¤§æ¨¡å‹ï¼Œä»è€Œè¾…åŠ©å¤§æ¨¡å‹å®Œæˆä»»åŠ¡ã€‚

OpenAI çš„ SDK æ–‡æ¡£ç»™å‡ºäº†è¯´æ˜ï¼Œç»è¿‡æˆ‘ç®€åŒ–åï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š

```json
#1. å°†æé—®å­˜å‚¨åˆ°MessageStore
{"role": "user", "content": "1+2=? Just give me a number result"}


#å¼€å§‹è¿›è¡Œç¬¬ä¸€è½®æé—®....
#å¾—åˆ°å¤§æ¨¡å‹è¿”å›


#2. å°†å¤§æ¨¡å‹çš„è¿”å›ï¼Œå­˜å‚¨åˆ°MessageStore
{"role": "assistant", "content": "", "tool_calls": [{0xc000284520 call_f31f9091de504216a3a84d function {AddTool {"numbers": [1, 2]}}}]
}


#3. å°†å·¥å…·è°ƒç”¨ä¿¡æ¯ï¼Œå­˜å‚¨åˆ°MessageStore
{"role": "tool", "content": "3", "name": "AddTool", "tool_call_id": "call_f31f9091de504216a3a84d"}


#4. å¼€å§‹è¿›è¡Œç¬¬äºŒè½®æé—®ï¼Œå°†ä¸Šè¿°æ‰€æœ‰Mesageï¼Œå‘é€ç»™å¤§æ¨¡å‹
#å¾—åˆ°å¤§æ¨¡å‹è¿”å›


```

å¯ä»¥çœ‹åˆ°ï¼Œç›¸æ¯”æ­£å¸¸çš„ user assistant çš„å¤šè½®å¯¹è¯æ¨¡å¼ï¼ŒFunction Calling çš„å¯¹è¯æ¨¡å¼ï¼Œåªæ˜¯ç•¥æœ‰ä¸åŒï¼Œä¸åŒç‚¹åœ¨äºç¬¬ä¸€è¦å°†å¤§æ¨¡å‹é€‰æ‹©çš„å·¥å…·æ·»åŠ åˆ° assistant å¯¹è¯ä¸­ï¼Œç¬¬äºŒæ˜¯è¦åœ¨assistant ä¹‹åæ·»åŠ  tool è§’è‰²çš„æ¶ˆæ¯ï¼Œç”¨äºå­˜å‚¨å·¥å…·è°ƒç”¨ç»“æœã€å·¥å…·åç§°ä»¥åŠ idã€‚

ç†è§£äº†åŸç†åï¼Œæˆ‘ä»¬æ¥çœ‹ä»£ç ï¼š

```go
if toolCalls != nil {
Â  Â  var result int
Â  Â  var args tools.InputArgs
Â  Â  err := json.Unmarshal([]byte(toolCalls[0].Function.Arguments), &args)
Â  Â  if err != nil {
Â  Â  Â  Â  log.Fatalln("json unmarshal err: ", err.Error())
Â  Â  }


Â  Â  if toolCalls[0].Function.Name == tools.AddToolDefine.Function.Name {
Â  Â  Â  Â  result = tools.AddTool(args.Numbers)
Â  Â  } else if toolCalls[0].Function.Name == tools.SubToolDefine.Function.Name {
Â  Â  Â  Â  result = tools.SubTool(args.Numbers)
Â  Â  }


Â  Â  fmt.Println("å‡½æ•°è®¡ç®—ç»“æœ: ", result)
Â  Â  ai.MessageStore.AddFor(ai.RoleAssistant, response.Content, toolCalls)
Â  Â  ai.MessageStore.AddForTool(string(result), toolCalls[0].Function.Name, toolCalls[0].ID)


Â  Â  response := ai.ToolsChat(ai.MessageStore.ToMessage(), toolsList)


Â  Â  fmt.Println("å¤§æ¨¡å‹çš„æœ€ç»ˆå›å¤: ", response.Content)
}
```

é¦–å…ˆåˆ¤æ–­ä¸€ä¸‹å¤§æ¨¡å‹æœ‰æ²¡æœ‰è°ƒç”¨å·¥å…·ï¼Œå¦‚æœè°ƒç”¨äº†ï¼Œåˆ™ä» toolCalls\[0].Function.Arguments ä¸­è§£æå‡ºå‡½æ•°å…¥å‚ã€‚ä¹‹åæ ¹æ®å·¥å…·åç§°ï¼Œè°ƒç”¨ç›¸åº”çš„å·¥å…·å‡½æ•°ã€‚æœ€åæŒ‰ç…§ä¸Šæ–‡ä¸­ OpenAI è§„å®šçš„æ ¼å¼ï¼Œå°†å¯¹åº”çš„ assistant ä»¥åŠ tool æ¶ˆæ¯å¡«å¥½ï¼Œåé¦ˆç»™å¤§æ¨¡å‹ã€‚

è¾“å‡ºï¼š

```json
å‡½æ•°è®¡ç®—ç»“æœ:Â  3
å¤§æ¨¡å‹çš„æœ€ç»ˆå›å¤:Â  1 + 2 = 3
```

## æ€»ç»“

æœ¬èŠ‚è¯¾æˆ‘åœ¨å¼€ç¯‡ç”¨äº†ä¸¤ä¸ªå°ä¾‹å­ä¸ºä½ å±•ç¤ºäº†å¤§æ¨¡å‹ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå¤§æ¨¡å‹ä¹Ÿæœ‰è‡ªèº«çš„å¼±ç‚¹ä»¥åŠæ— æ³•è§£å†³çš„é—®é¢˜ï¼Œè®©ä½ ä½“éªŒäº†ä¸€ä¸‹ä»€ä¹ˆæ˜¯ä¸šç•Œå¸¸è¯´çš„â€œå¹»è§‰â€ã€‚

OpenAI å…¬å¸ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œæƒ³åˆ°äº†è®©å¤§æ¨¡å‹ä¸å¤–ç•Œç¯å¢ƒäº¤äº’çš„ç ´è§£ä¹‹æ³•ï¼Œå› æ­¤æå‡ºäº† Function Calling æœºåˆ¶ï¼Œå¹¶åœ¨ SDK ä¸­è¿›è¡Œäº†æ”¯æŒï¼Œåœ¨è¿…é€Ÿæˆä¸ºäº†è¡Œä¸šæ ‡æ†åšæ³•åï¼Œå…¶ä»–å…¬å¸åŒ…æ‹¬å›½å†…å…¬å¸çš„å¤§æ¨¡å‹ï¼Œä¹Ÿå¯¹è¯¥æœºåˆ¶è¿›è¡Œäº†å…¼å®¹ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ OpenAI SDK é…åˆé˜¿é‡Œäº‘çš„é€šä¹‰åƒé—®å¤§æ¨¡å‹ä½“éªŒè¯¥æœºåˆ¶ã€‚

æœ€åæˆ‘ç”¨ä¸€ä¸ªåŠ æ³•å°ä¾‹å­ï¼Œä¸ºä½ å±•ç¤ºäº† Function Calling çš„ä»£ç åº”å¦‚ä½•å†™ï¼Œå¹¶ä»‹ç»äº†å…¶å‰ç½®åŸºç¡€ Chat Completionã€‚æœ¬èŠ‚è¯¾çš„ä»£ç å·²å…¬å¼€åœ¨ GitHub ä¸Šï¼Œé“¾æ¥ä¸ºï¼š[Geek/function-calling at main Â· xingyunyang01/Geek (github.com)](https://github.com/xingyunyang01/Geek/tree/main/function-calling)

## æ€è€ƒé¢˜

æˆ‘åœ¨è¯¾ç¨‹ä¸­çš„ä»£ç ï¼Œä¸ºä½ æ¼”ç¤ºäº† â€œ1+2=ï¼Ÿâ€ è¿™ä¸ªå°ä¾‹å­ï¼Œå¦‚æœæ˜¯è®¡ç®— â€œ1+2+3+4-5-6=?â€ å‘¢ï¼Ÿä»£ç è¯¥å¦‚ä½•ç¼–å†™ï¼Ÿå¤§æ¨¡å‹èƒ½å¦ç»™å‡ºæ­£ç¡®çš„å›ç­”ï¼Ÿ

æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºå±•ç¤ºä½ çš„æ€è€ƒè¿‡ç¨‹ï¼Œæˆ‘ä»¬ä¸€èµ·æ¢è®¨ã€‚å¦‚æœä½ è§‰å¾—è¿™èŠ‚è¯¾çš„å†…å®¹å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œä¹Ÿæ¬¢è¿ä½ åˆ†äº«ç»™å…¶ä»–æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ7ï¼‰</strong></div><ul>
<li><span>åˆ˜è•¾</span> ğŸ‘ï¼ˆ4ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>æ²¡çœ‹æ‡‚ï¼ŒToolé‡Œé¢æ²¡æœ‰å®šä¹‰åŠ æ³•å®ç°ã€‚è¿˜æ˜¯ç”¨å¤§è¯­è¨€æ¨¡å‹ç»™å‡ºç»“æœï¼Œè¿™æ ·ç”¨function callæœ‰ä»€ä¹ˆå¥½å¤„?</p>2024-12-24</li><br/><li><span>æ—¥æœˆæ˜Ÿè¾°</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>ä¸‹é¢æ˜¯æˆ‘è¿™è¾¹æ‰§è¡Œç»“æœçš„è¾“å‡ºï¼Œæƒ³è¯·æ•™è€å¸ˆï¼Œä¸ºä»€ä¹ˆè¿™é‡Œä¼šå¤šæ¬¡è°ƒç”¨å‡½æ•°
2025&#47;02&#47;10 13:22:45 message_store.go:44: {ID:0194f006b99eab2c83e6d4ebde00af4f Object:chat.completion Created:1739193760 Model:deepseek-ai&#47;DeepSeek-V3 Choices:[{Index:0 Message:{Role:assistant Content: Refusal: MultiContent:[] Name: FunctionCall:&lt;nil&gt; ToolCalls:[{Index:&lt;nil&gt; ID:0194f006cc4a3475b18692239a8c0e41 Type:function Function:{Name:AddTool Arguments:{&quot;numbers&quot;:[1,2,3,4]}}}] ToolCallID:} Fã€‚ã€‚ã€‚]}
2025&#47;02&#47;10 13:22:45 chat.go:49: å¤§æ¨¡å‹å›å¤çš„å†…å®¹:
2025&#47;02&#47;10 13:22:45 chat.go:50: å¤§æ¨¡å‹é€‰æ‹©çš„å·¥å…·æ˜¯: [{&lt;nil&gt; 0194f006cc4a3475b18692239a8c0e41 function {AddTool {&quot;numbers&quot;:[1,2,3,4]}}}]
å‡½æ•°è®¡ç®—ç»“æœ:  10
2025&#47;02&#47;10 13:22:47 message_store.go:44: {ID:0194f006cd150a0ã€‚ã€‚ã€‚ã€‚:47 GMT]]}
2025&#47;02&#47;10 13:22:47 chat.go:49: å¤§æ¨¡å‹å›å¤çš„å†…å®¹:
2025&#47;02&#47;10 13:22:47 chat.go:50: å¤§æ¨¡å‹é€‰æ‹©çš„å·¥å…·æ˜¯: [{&lt;nil&gt; 0194f006d51bf7375ffe69a9b6fcbb08 function {AddTool {&quot;numbers&quot;:[1,2,3,4]}}}]
å‡½æ•°è®¡ç®—ç»“æœ:  10
2025&#47;02&#47;10 13:22:49 message_store.go:44: {ID:0194f006d59cff7a0964ã€‚ã€‚ã€‚ã€‚}
2025&#47;02&#47;10 13:22:49 chat.go:49: å¤§æ¨¡å‹å›å¤çš„å†…å®¹:
2025&#47;02&#47;10 13:22:49 chat.go:50: å¤§æ¨¡å‹é€‰æ‹©çš„å·¥å…·æ˜¯: [{&lt;nil&gt; 0194f006de23c39d1001e9c67f5b829e function {AddTool {&quot;numbers&quot;:[1,2,3,4]}}}]
å‡½æ•°è®¡ç®—ç»“æœ:  10
2025&#47;02&#47;10 13:22:53 message_store.go:44: {ID:0194f006de9ã€‚ã€‚ã€‚ã€‚]}
2025&#47;02&#47;10 13:22:53 chat.go:49: å¤§æ¨¡å‹å›å¤çš„å†…å®¹:
2025&#47;02&#47;10 13:22:53 chat.go:50: å¤§æ¨¡å‹é€‰æ‹©çš„å·¥å…·æ˜¯: [{&lt;nil&gt; 0194f006ecb585e948c052459e301020 function {AddTool {&quot;numbers&quot;:[1,2,3,4]}}}]
å‡½æ•°è®¡ç®—ç»“æœ:  10
2025&#47;02&#47;10 13:22:57 message_store.go:44: {ID:0194f006eã€‚ã€‚ã€‚]]}
å¤§æ¨¡å‹çš„æœ€ç»ˆå›å¤:  &lt;ï½œtoolâ–callsâ–beginï½œ&gt;&lt;ï½œtoolâ–callsâ–beginï½œ&gt;&lt;ï½œtoolâ–callâ–beginï½œ&gt;function&lt;ï½œtoolâ–sepï½œ&gt;AddTool
```json
{&quot;numbers&quot;:[1,2,3,4]}
```&lt;ï½œtoolâ–callâ–endï½œ&gt;&lt;ï½œtoolâ–callsâ–endï½œ&gt;</p>2025-02-10</li><br/><li><span>ğŸ¤¡</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>é‡åˆ°ä¸€ä¸ªå¥‡æ€ªçš„é—®é¢˜
ä»£ç ä¸­éœ€è¦å»è®¡ç®— prompt := &quot;1+2-3+4-5+6=? Just give me a number result&quot; 

æŒ‰ç…§è€å¸ˆç»™çš„ä»£ç è·‘ï¼Œä¼šåœ¨å¾ªç¯ä¸­æœ‰å¥½å‡ è½®è®¡ç®—ï¼Œæ¯æ¬¡å°†è®¡ç®—ç»“æœé™„åŠ åˆ° messageStore åé¢
æˆ‘ä¿®æ”¹ä»£ç å°†è®¡ç®—è¿‡ç¨‹æ‰“å°åœ¨å‘½ä»¤è¡Œï¼Œæ¯ä¸€è½®è®¡ç®—ä½¿ç”¨ ----- ç¬¦å·åˆ†éš”
ç¬¬ä¸€è½®è®¡ç®—è°ƒç”¨  addTool è®¡ç®—å‡º 1 2 4 6 ä¹‹å’Œä¸º13 
ç¬¬äºŒè½®è®¡ç®—è°ƒç”¨ subTool è®¡ç®—å‡º 3 5 åªå·® ä¸º -2 ï¼ˆè¿™é‡Œæœ‰é—®é¢˜ï¼‰
ç¬¬ä¸‰è½®å¾—å‡ºç»“è®º æœ€ç»ˆè®¡ç®—ç»“æœä¸º 5 
è¿™é‡Œæˆ‘çš„é—®é¢˜æ˜¯ä¸ºä»€ä¹ˆ åœ¨ ç¬¬äºŒè½®è®¡ç®—å‡ºçš„ç»“æœæ˜¯ -2 ï¼Œæ·»åŠ åˆ°messageStoreä¸­ï¼Œå±…ç„¶æœ€åèƒ½å¾—å‡ºæ­£ç¡®çš„ç­”æ¡ˆï¼Œæœ¬è´¨ä¸Šç¬¬äºŒè½®è®¡ç®—åº”è¯¥æ˜¯ -3 -5 = -8 æ‰æ˜¯åˆç†çš„
åé¢åˆä½¿ç”¨ go run main.go å¤šæ¬¡å®éªŒéƒ½æœ‰åŒæ ·çš„é—®é¢˜ï¼Œè¯·é—®ä¸‹è¿™ä¸ªæ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿï¼Ÿ

é™„åŠ æŸæ¬¡å®éªŒçš„è¾“å‡ºï¼š
å¤§æ¨¡å‹é€‰æ‹©çš„å·¥å…·æ˜¯:  [{0xc0004c9bc0 call_81af19d5cf3247a99b0d45 function {AddTool {&quot;numbers&quot;: [1, 2, 4, 6]}}}]
å‡½æ•°è®¡ç®—ç»“æœ:  13
--------------
å¤§æ¨¡å‹é€‰æ‹©çš„å·¥å…·æ˜¯:  [{0xc000014a50 call_d7719388d48d42e5994cb0 function {SubTool {&quot;numbers&quot;: [3, 5]}}}]
å‡½æ•°è®¡ç®—ç»“æœ:  -2
--------
å¤§æ¨¡å‹çš„æœ€ç»ˆå›å¤:  The result of the calculation \( 1 + 2 - 3 + 4 - 5 + 6 \) is \( 5 \).</p>2025-02-01</li><br/><li><span>ä»²ç„</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>AddToolå’ŒSubToolçš„å‡½æ•°æ˜¯éœ€è¦ç”¨æˆ·è‡ªå·±å®ç°å—? </p>2024-12-27</li><br/><li><span>0mfg</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆæ‚¨å¥½ï¼Œè¯·æ•™ä¸¤ä¸ªå¯èƒ½å’Œfunctioncallæœ¬èº«å…³ç³»ä¸å¤§çš„é—®é¢˜ï¼Œä¸»è¦è¿˜æ˜¯goè¯­è¨€æœ¬èº«çš„é—®é¢˜æˆ–è€…è¯´æ˜¯openai go sdkçš„é—®é¢˜ã€‚
é—®é¢˜1ï¼šæˆ‘çš„goæ˜¯1.24.1ç‰ˆæœ¬ï¼ŒæŒ‰ç…§æ‚¨çš„ä»£ç addtooldefineä»£ç é‡Œå…³äºåŠ æ³•å‚æ•°çš„å®šä¹‰ï¼Œæˆ‘çš„ç¯å¢ƒç¼–è¯‘è¿è¡ŒæŠ¥é”™â€œ2025&#47;03&#47;30 00:23:08 error, status code: 400, status: 400 Bad Request, message: Invalid type for &#39;tools[0].function.parameters&#39;: expected an object, but got a string instead. (request id: 2025032916230715366345006827442)ã€‚ å®šä½ä¸‹æ¥ä»£ç æ˜¯è¿™ä¸ªåœ°æ–¹æœ‰é—®é¢˜ï¼Œ
Parameters: `{&quot;type&quot;:&quot;object&quot;,&quot;properties&quot;:{&quot;numbers&quot;:{&quot;type&quot;:&quot;array&quot;,&quot;items&quot;:{&quot;type&quot;:&quot;integer&quot;}}}}`,
	},

æˆ‘ä¿®æ”¹æˆè¿™æ ·å†™æ‰§è¡Œæ­£å¸¸äº†ï¼š
Parameters: map[string]any{
			&quot;type&quot;: &quot;object&quot;,
			&quot;properties&quot;: map[string]any{
				&quot;numbers&quot;: map[string]any{
					&quot;type&quot;: &quot;array&quot;,
					&quot;items&quot;: map[string]any{
						&quot;type&quot;: &quot;integer&quot;,
					},
				},

æƒ³ç¡®è®¤ä¸€ä¸‹è¿™ä¸ªæ˜¯sdkçš„ç‰ˆæœ¬æ›´æ–°è¿˜æ˜¯goç‰ˆæœ¬æ›´æ–°å¯¼è‡´çš„ã€‚

é—®é¢˜2ï¼štomessageæ–¹æ³•çš„å…·ä½“è€ƒè™‘æˆ–è€…è®¾è®¡çš„å·§å¦™æ€è·¯èƒ½å¦å…·ä½“è¯´æ˜ä¸€ä¸‹ï¼Œå› ä¸ºæˆ‘è°ƒè¯•äº†ä¸€ä¸‹å‘ç°å‡½æ•°è°ƒç”¨çš„æ—¶å€™ï¼Œå‚æ•°ç›´æ¥ä¼ å°±è¡Œï¼Œä¸ç”¨è°ƒç”¨tomessageæ–¹æ³•ä¹Ÿå¯ä»¥æˆåŠŸè¿è¡Œã€‚

			&#47;&#47;response = ai.ToolsChat(ai.MessageStore.ToMessage(), toolsList)
			response = ai.ToolsChat(ai.MessageStore, toolsList)
			toolCalls = response.ToolCalls

æ„Ÿè°¢è€å¸ˆç™¾å¿™ä¸­æŠ½ç©ºç­”å¤


</p>2025-03-31</li><br/><li><span>0.0</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>çœ‹èµ·æ¥å’Œ MCP æœ‰åŒæ ·çš„å¼‚æ›²åŒå·¥ä¹‹å¦™,åªæ˜¯ MCP æ›´åŠ é€šç”¨,ç›´æ¥åˆ¶å®šæ ‡å‡†åè®®,MCP ä¼šä¸€ç»Ÿæ±Ÿæ¹–å—?</p>2025-03-20</li><br/><li><span>Geek_b73ed3</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>å¤§æ¨¡å‹æ¨å¯¼å‡ºæ¥æäº¤çš„toolè¿™å—è€å¸ˆæœ‰äº†è§£å˜›ï¼Ÿå®ƒæ€ä¹ˆçŸ¥é“æˆ‘æ‰”ç»™å®ƒçš„æ˜¯golangçš„ä»£ç ï¼Ÿ</p>2025-03-04</li><br/>
</ul>