ä½ å¥½ï¼Œæˆ‘æ˜¯é‚¢äº‘é˜³ã€‚

æ²¿ç€ä¸ŠèŠ‚è¯¾çš„å­¦ä¹ ï¼Œä»Šå¤©æˆ‘ä»¬æ¥åšä¸€ä¸ªå°å°çš„å®æˆ˜ã€‚å®æˆ˜å†…å®¹å‘¢ï¼Œå°±æ˜¯æˆ‘ä¹‹å‰ä»‹ç»æ¸…ç«çš„é‡‘èå¤§æ¨¡å‹å¤§èµ›æ—¶ï¼Œæåˆ°çš„åˆçº§é—®é¢˜â€”â€”è‚¡ç¥¨ä¿¡æ¯çš„æŸ¥è¯¢æ“ä½œï¼Œæ¯”å¦‚è‚¡ç¥¨ä»£ç ç­‰ç­‰ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ç»“åˆ LangGraph Agent è¿›è¡Œå®ç°ã€‚

## è‚¡ç¥¨ä¿¡æ¯æŸ¥è¯¢å·¥å…·

ç”±äºä»Šå¤©çš„éœ€æ±‚æ˜¯æŸ¥è¯¢è‚¡ç¥¨ä»£ç ï¼Œä¸ŠèŠ‚è¯¾è®²çš„å†å²è¡Œæƒ…æ¥å£å°±ä¸é€‚åˆäº†ï¼Œé‚£ä¸ªæ¥å£ä¸€æ¬¡åªèƒ½æŠ“å–ä¸€åªè‚¡ç¥¨çš„æŸæ®µæ—¶é—´çš„æ•°æ®ï¼Œå’Œæˆ‘ä»¬çš„éœ€æ±‚ä¸ç¬¦ã€‚æ‰€ä»¥æˆ‘ä»¬è¦ä½¿ç”¨çš„æ˜¯å®æ—¶è¡Œæƒ…æŠ“å–æ¥å£ï¼Œæ–‡æ¡£é“¾æ¥åœ¨è¿™ï¼š[AKShare è‚¡ç¥¨æ•°æ® â€” AKShare 1.16.79 æ–‡æ¡£](https://akshare.akfamily.xyz/data/stock/stock.html#id11)

è¯¥æ¥å£æ˜¯åœ¨ä¸œæ–¹è´¢å¯Œç½‘ä¸ŠæŠ“å–å„ä¸ªå¸‚åœºçš„æ‰€æœ‰è‚¡ç¥¨çš„å®æ—¶æ•°æ®ã€‚æ¯”å¦‚æ²ª Aã€æ·± Aã€åˆ›ä¸šæ¿ç­‰ç­‰ã€‚æˆ‘ä»¬å°±ä»¥åˆ›ä¸šæ¿çš„æ•°æ®ä¸ºä¾‹è¿›è¡Œæ¼”ç¤ºã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/74/87/748f8e923b78f9d52cdd806110fb6087.png?wh=803x340)

ä»æ–‡æ¡£ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æŠ“å–åˆ›ä¸šæ¿å®æ—¶æ•°æ®çš„æ¥å£ä¸º stock\_cy\_a\_spot\_emï¼Œè¾“å‡ºå‚æ•°å’Œç¤ºä¾‹å¦‚ä¸‹ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/ac/2b/acce7e546beef4a239f2495b11a9b42b.png?wh=1132x1975)

æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨ä»£ç ä¸­ç›´æ¥è°ƒç”¨è¯¥æ¥å£ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªåŒ…å«äº†ä¸Šè¿°ä¿¡æ¯çš„ dataframeã€‚

é‚£æœ‰äº†è¿™äº›æ•°æ®åï¼Œå·¥å…·å¦‚ä½•è®¾è®¡å‘¢ï¼Ÿå…¶å®éå¸¸ç®€å•ï¼Œåªéœ€è¦ä¼ å…¥è‚¡ç¥¨ä»£ç æˆ–è€…è‚¡ç¥¨åç§°ï¼Œç„¶åä» dataframe ä¸­ç­›é€‰ç›¸åº”çš„è‚¡ç¥¨çš„ä¿¡æ¯å°±å¯ä»¥äº†ã€‚ä»£ç å¦‚ä¸‹ï¼š

```python
from langchain_core.tools import tool
from llm import DeepSeek
import akshare as ak

@tool
def get_stock_info(code: str, name: str) -> str:
Â  Â  """å¯ä»¥æ ¹æ®ä¼ å…¥çš„è‚¡ç¥¨ä»£ç æˆ–è‚¡ç¥¨åç§°è·å–è‚¡ç¥¨ä¿¡æ¯
Â  Â  Args:
Â  Â  Â  Â  code: è‚¡ç¥¨ä»£ç 
Â  Â  Â  Â  name: è‚¡ç¥¨åç§°
Â  Â  """
Â  Â  code_isempty = (code == "" or len(code) <= 2)
Â  Â  name_isempty = (name == "" or len(name) <= 2)

Â  Â  if code_isempty and name_isempty:
Â  Â  Â  Â  return []
Â  Â  
Â  Â  df = ak.stock_cy_a_spot_em() # è·å–åˆ›ä¸šæ¿è‚¡ç¥¨åˆ—è¡¨

Â  Â  ret = None
Â  Â  if code_isempty and not name_isempty:
Â  Â  Â  Â  ret = df[df['åç§°'].str.contains(name)]
Â  Â  elif not code_isempty and name_isempty:
Â  Â  Â  Â  ret = df[df['ä»£ç '].str.contains(code)]
Â  Â  else:
Â  Â  Â  Â  ret = df[df['ä»£ç '].str.contains(code) & df['åç§°'].str.contains(name)]

Â  Â  return ret.to_dict(orient='records')
```

å…³äº tool çš„è¯­æ³•åœ¨ä¸Šä¸€ç« è®²è¿‡ï¼Œç°åœ¨å¤ä¹ ä¸€ä¸‹ã€‚é¦–å…ˆæˆ‘ä»¬è¦å¼•å…¥ langchain\_core.tools è¿™ä¸ªåŒ…ï¼Œè¿™æ˜¯å› ä¸º LangGraph æ˜¯åœ¨ LangChain çš„åŸºç¡€ä¸Šè®¾è®¡çš„ï¼Œå› æ­¤ LangChain çš„å¾ˆå¤šåŠŸèƒ½ï¼Œåœ¨ LangGraph éƒ½æ˜¯ç›´æ¥å¤ç”¨çš„ã€‚

æ¥ä¸‹æ¥ï¼Œå¦‚ä½•å°†ä¸€ä¸ªæ™®é€šæ–¹æ³•å˜æˆå·¥å…·æ–¹æ³•å‘¢ï¼Ÿåªéœ€è¦ä¸¤æ­¥å°±èƒ½æå®šã€‚ç¬¬ä¸€æ­¥ï¼Œæ˜¯å¢åŠ  @tool è¿™ä¸ªè£…é¥°å™¨ã€‚ç¬¬äºŒæ­¥ï¼Œåœ¨æ–¹æ³•çš„å¼€å¤´ç”¨ â€œâ€" â€œâ€" å†™å…¥å·¥å…·æè¿°ï¼Œè¿™æ®µå·¥å…·æè¿°ä¼šä½œä¸º prompt å‘ç»™å¤§æ¨¡å‹ï¼Œä»è€Œè®©å¤§æ¨¡å‹çŸ¥é“æœ‰å“ªäº›å·¥å…·å¯ä»¥è°ƒç”¨ã€‚

å…¶ä»–çš„ä»£ç å°±éå¸¸ç®€å•äº†ï¼Œå°±æ˜¯åˆ©ç”¨äº† dataframe è¿›è¡Œäº†è‚¡ç¥¨ä»£ç æˆ–è€…åç§°çš„ç­›é€‰ï¼Œä¹‹åå°†ç­›é€‰å‡ºçš„è®°å½•è½¬æˆå­—å…¸åè¿”å›ã€‚

## Agent çš„å®ç°

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥æå®šå…·ä½“å®ç°ç¯èŠ‚ã€‚

### Function Calling

ç°åœ¨å¾ˆå¤šåœ°æ–¹ä¼šæŠŠ Function Calling ä¹Ÿç®—åš Agent çš„ä¸€ç§å®ç°æ¨¡å¼ã€‚æ¯”å¦‚ Difyã€LangGraph éƒ½æ˜¯è¿™ç§æ€è·¯ï¼Œè€Œä¸”è¿˜ä¼šé»˜è®¤ä¼˜å…ˆä½¿ç”¨ Function Calling çš„æ¨¡å¼ï¼Œå› æ­¤æˆ‘ä»¬ä¸Šä¸€ç« è®²çš„ä¹Ÿæ˜¯ Function Calling çš„æ¨¡å¼ã€‚ç°åœ¨æˆ‘ä»¬åšä¸€ä¸ªå¤ä¹ ä¸è¡¥å……ï¼Œç”¨ Function Calling å®ç°è‚¡ç¥¨ä¿¡æ¯æŸ¥è¯¢ã€‚

è¦å®ç° Function Calling é¦–å…ˆéœ€è¦å°†å·¥å…·ç»‘å®šåˆ°å¤§æ¨¡å‹ï¼Œä»£ç å¦‚ä¸‹ï¼š

```python
tools = [get_stock_info]
tools_by_name = {tool.name: tool for tool in tools}
llm = DeepSeek()
llm_with_tools = llm.bind_tools(tools)
```

ç¬¬ä¸€è¡Œä»£ç æ˜¯ç”Ÿæˆä¸€ä¸ª tools åˆ—è¡¨ã€‚ç¬¬äºŒè¡Œä»£ç æ˜¯æ ¹æ®å·¥å…·åç§° tool.name åœ¨å·¥å…·åˆ—è¡¨ tools ä¸­å¾—åˆ° tool å¯¹è±¡ï¼Œè¿™ä¸ªä¼šåœ¨åé¢å·¥å…·è°ƒç”¨æ—¶ä½¿ç”¨åˆ°ã€‚ç¬¬ä¸‰ç¬¬å››è¡Œä»£ç ï¼Œå°±æ˜¯ä¸ºå¤§æ¨¡å‹ç»‘å®šå·¥å…·äº†ï¼Œè¿™é‡Œçš„å¤§æ¨¡å‹ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ deepseek-chatï¼Œä¹Ÿå°±æ˜¯ V3ã€‚

å·¥å…·ç»‘å®šå®Œæˆåï¼Œæ¥ä¸‹æ¥å°±æ˜¯è®©å¤§æ¨¡å‹é€‰æ‹©å·¥å…·ä»¥åŠäººç±»æ‰§è¡Œå·¥å…·è¿™ä¸¤ä¸ªæ­¥éª¤äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å°†è¿™ä¸¤æ­¥åˆ†åˆ«åšæˆä¸€ä¸ª LangGraph èŠ‚ç‚¹ã€‚ä»£ç å¦‚ä¸‹ï¼š

```python
from langgraph.graph import MessagesState
from langchain_core.messages import SystemMessage, HumanMessage, ToolMessage
from typing_extensions import Literal
from tools import tools_by_name, llm_with_tools

def llm_call(state: MessagesState):
Â  Â  """LLM decides whether to call a tool or not"""
Â  Â  
Â  Â  # åˆ›å»ºæ¶ˆæ¯åˆ—è¡¨
Â  Â  messages = [
Â  Â  Â  Â  SystemMessage(
Â  Â  Â  Â  Â  Â  content="ä½ æ˜¯ä¸€ä¸ªè‚¡ç¥¨åŠ©æ‰‹ï¼Œå¦‚æœç”¨æˆ·è¯¢é—®è‚¡ç¥¨ä»£ç æˆ–è‚¡ç¥¨åç§°ï¼Œè¯·ç›´æ¥ç»™å‡ºä»£ç æˆ–åç§°ï¼Œè€Œä¸è¦ç»™å‡ºå…¶ä»–ä¿¡æ¯"
Â  Â  Â  Â  )
Â  Â  ] + state["messages"]
Â  Â  
Â  Â  # è°ƒç”¨ LLM
Â  Â  response = llm_with_tools.invoke(messages)
Â  Â  
Â  Â  return {
Â  Â  Â  Â  "messages": [response]
Â  Â  }


def tool_node(state: dict):
Â  Â  """Performs the tool call"""

Â  Â  result = []
Â  Â  for tool_call in state["messages"][-1].tool_calls:
Â  Â  Â  Â  tool = tools_by_name[tool_call["name"]]
Â  Â  Â  Â  observation = tool.invoke(tool_call["args"])
Â  Â  Â  Â  # å°†è§‚å¯Ÿç»“æœè½¬æ¢ä¸ºå­—ç¬¦ä¸²æ ¼å¼
Â  Â  Â  Â  if isinstance(observation, list):
Â  Â  Â  Â  Â  Â  # å¦‚æœæ˜¯åˆ—è¡¨ï¼Œå°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²è¡¨ç¤º
Â  Â  Â  Â  Â  Â  observation = str(observation)

Â  Â  Â  Â  result.append(ToolMessage(content=observation, tool_call_id=tool_call["id"]))
Â  Â  return {"messages": result}

# Add nodes
agent_builder.add_node("llm_call", llm_call)
agent_builder.add_node("environment", tool_node)
```

è¿™é‡Œçš„ llm\_call å°±æ˜¯å¤§æ¨¡å‹é€‰æ‹©å·¥å…·çš„èŠ‚ç‚¹ï¼Œtool\_node åˆ™æ˜¯æ‰§è¡Œå·¥å…·çš„èŠ‚ç‚¹ã€‚åœ¨ llm\_call ä¸­æˆ‘ç”¨çš„ä¸­å¤®çŠ¶æ€å­˜å‚¨å™¨ state ä¸æ˜¯æˆ‘è‡ªå·±å†™çš„ï¼Œè€Œæ˜¯ç”¨çš„ LangGraph å®˜æ–¹æä¾›äº† MessagesStateï¼Œå…¶å®ç°å°±æ˜¯ä¸€ä¸ª messages å­—å…¸ï¼Œæºç å¦‚ä¸‹ï¼š

```python
class MessagesState(TypedDict):
Â  Â  messages: Annotated[list[AnyMessage], add_messages]
```

ç”¨æˆ·æœ€å¼€å§‹è¾“å…¥çš„æ¶ˆæ¯ä¼šä½œä¸º HumanMessage å­˜å‚¨åœ¨é‡Œé¢ï¼Œæ‰€ä»¥ä¸Šé¢ llm\_call ä¸­çš„åˆ›å»ºæ¶ˆæ¯åˆ—è¡¨çš„ä»£ç ï¼Œæ‰ä¼šè¿™ä¹ˆå†™ã€‚ä¹‹åçš„ response å°±æ˜¯å¤§æ¨¡å‹è¿”å›çš„é€‰æ‹©äº†ä»€ä¹ˆå·¥å…·çš„ä¿¡æ¯ã€‚

æ­¤æ—¶ï¼ŒæŒ‰ç…§ä¸Šä¸€ç« çš„å†™æ³•ï¼Œæˆ‘ä»¬åº”è¯¥å°† response è¿½åŠ åˆ° state\[â€œmessagesâ€] é‡Œé¢ï¼Œä½†è¿™é‡Œæˆ‘ç”¨äº†ç®€åŒ–å†™æ³•ï¼Œç›´æ¥è¿”å›äº† â€œmessagesâ€: \[response]ï¼Œè¿™æ ·å†™ç­‰åŒäºè¿½åŠ åˆ° stateï¼ŒLangGraph ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åˆå¹¶ã€‚

tool\_node å°±æ˜¯å·¥å…·çš„æ‰§è¡Œï¼Œä»£ç åœ¨ä¹‹å‰è®²è¿‡ï¼Œå°±ä¸å†é‡å¤äº†ã€‚æœ€åçš„ return ä¹Ÿæ˜¯ä¸ tool\_node ä¸€æ ·çš„é€»è¾‘ã€‚

ä»¥ä¸Šå°±æ˜¯ä¸¤ä¸ªèŠ‚ç‚¹çš„è®¾è®¡æ€è·¯ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¿æ¥èŠ‚ç‚¹æ„æˆå›¾ã€‚åœ¨ä¸Šä¸€ç« ï¼Œæˆ‘ä»¬åªè®²äº†èµ·å§‹è¾¹ã€æ™®é€šè¾¹ä¸æ¡ä»¶è¾¹ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è®²ä¸€ä¸‹æ¡ä»¶è¾¹ã€‚

æ¡ä»¶è¾¹å¯ä»¥ç†è§£ä¸º Dify é‡Œé¢çš„æ¡ä»¶åˆ†æ”¯ï¼Œä¹Ÿå°±æ˜¯ if elseã€‚ä¹‹å‰æˆ‘ä»¬è®² Function Calling å’Œ Agent æ—¶ï¼Œå¤šæ¬¡è®²è¿‡ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ­»å¾ªç¯å®ç°ä¸å¤§æ¨¡å‹çš„å¤šè½®å¯¹è¯ï¼Œä»è€Œå¯ä»¥è®©å¤§æ¨¡å‹å¤šæ¬¡è°ƒç”¨å·¥å…·ï¼Œåœ¨å¾—åˆ°æœ€ç»ˆç­”æ¡ˆåï¼Œæ‰ä¼šé€€å‡ºå¾ªç¯ï¼Œæ‰€ä»¥æ­¤æ—¶éœ€è¦ç”¨åˆ°æ¡ä»¶è¾¹æ¥åˆ¤æ–­ä½•æ—¶é€€å‡ºå¾ªç¯ã€‚

é‚£æ—¢ç„¶æ¡ä»¶è¾¹éœ€è¦åšæ¡ä»¶åˆ†æ”¯åˆ¤æ–­ï¼Œé‚£å°±è‚¯å®šä¹Ÿéœ€è¦æœ‰ä¸€ä¸ªæ¡ä»¶èŠ‚ç‚¹ï¼Œæ¥å¤„ç†è¿™äº›é€»è¾‘ã€‚ä»£ç å¦‚ä¸‹ï¼š

```python
def should_continue(state: MessagesState) -> Literal["environment", "END"]:
Â  Â  """Decide if we should continue the loop or stop based upon whether the LLM made a tool call"""
Â  Â  messages = state["messages"]
Â  Â  last_message = messages[-1]
Â  Â  # If the LLM makes a tool call, then perform an action
Â  Â  if last_message.tool_calls:
Â  Â  Â  Â  return "Action"
Â  Â  # Otherwise, we stop (reply to the user)
Â  Â  return "END"

agent_builder.add_conditional_edges(
Â  Â  "llm_call",
Â  Â  should_continue,
Â  Â  {
Â  Â  Â  Â  # Name returned by should_continue : Name of next node to visit
Â  Â  Â  Â  "Action": "environment",
Â  Â  Â  Â  "END": END,
Â  Â  },
)
```

è¿™é‡Œçš„æ¡ä»¶åˆ¤æ–­éå¸¸ç®€å•ï¼Œå°±æ˜¯è¯»å–æœ€åä¸€æ¡ messageï¼Œå¦‚æœæœ‰ tool\_callsï¼Œå°±è¿”å› â€œActionâ€ï¼Œå¦‚æœæ²¡æœ‰å°±è¿”å› â€œENDâ€ã€‚â€œActionâ€ å¯¹åº”çš„æ˜¯ â€œenvironmentâ€ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œå·¥å…·çš„èŠ‚ç‚¹ã€‚â€œENDâ€ å¯¹åº”çš„ ENDï¼Œä¹Ÿå°±æ˜¯ç»“æŸèŠ‚ç‚¹ã€‚

é‚£å¾ªç¯æ˜¯æ€ä¹ˆè¿è½¬èµ·æ¥çš„å‘¢ï¼Ÿæˆ‘ä»¬çœ‹ä¸€ä¸‹å®Œæ•´çš„èŠ‚ç‚¹è¿è¿çœ‹çš„ä»£ç ï¼š

```python
# Build workflow
agent_builder = StateGraph(MessagesState)

# Add nodes
agent_builder.add_node("llm_call", llm_call)
agent_builder.add_node("environment", tool_node)

# Add edges to connect nodes
agent_builder.add_edge(START, "llm_call")
agent_builder.add_conditional_edges(
Â  Â  "llm_call",
Â  Â  should_continue,
Â  Â  {
Â  Â  Â  Â  # Name returned by should_continue : Name of next node to visit
Â  Â  Â  Â  "Action": "environment",
Â  Â  Â  Â  "END": END,
Â  Â  },
)
agent_builder.add_edge("environment", "llm_call")

# Compile the agent
agent = agent_builder.compile()
```

å¯ä»¥çœ‹åˆ°åŸæœ¬ â€œenvironmentâ€ åº”è¯¥ç”¨ç»“æŸè¾¹ä¸ END ç›¸è¿ï¼Œä½†è¿™é‡Œæ˜¯ç”¨æ™®é€šè¾¹é‡æ–°ä¸ â€œllm\_callâ€ç›¸è¿çš„ï¼Œè¿™æ ·å°±å®ç°äº†å¾ªç¯ï¼Œç›¸å½“äº A -&gt; Bï¼ŒB -&gt; Aã€‚å¦‚æœä½ å¯¹äºè¿™ä¸ªå›¾çš„é€»è¾‘è¿˜ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è°ƒç”¨ç”»å›¾å·¥å…·ï¼ŒæŠŠå›¾ç»“æ„ç”»å‡ºæ¥ã€‚ä»£ç å¦‚ä¸‹ï¼š

```python
from IPython.display import Image, display

# Show the agent
display(Image(agent.get_graph(xray=True).draw_mermaid_png()))

# ä¿å­˜æµç¨‹å›¾åˆ°æ–‡ä»¶
graph_png = agent.get_graph(xray=True).draw_mermaid_png()
with open("agent_graph.png", "wb") as f:
Â  Â  f.write(graph_png)
```

ç”»å›¾éœ€è¦å¼•å…¥ä¸€ä¸‹ IPython.display è¿™ä¸ªåŒ…ï¼Œå¦‚æœæˆ‘ä»¬æ˜¯ç”¨çš„ Jupyter Notebook å†™çš„ä»£ç ï¼Œåˆ™ç›´æ¥ç”¨ç¬¬ 4 è¡Œçš„ä»£ç å°±èƒ½åœ¨è¿è¡Œæ—¶çœ‹åˆ°æ•ˆæœã€‚ä½†å¦‚æœæ˜¯æ™®é€šçš„ VScode è¿è¡Œä»£ç ï¼Œåˆ™å¿…é¡»æŠŠå›¾ä¿å­˜æˆæ–‡ä»¶ï¼Œæ‰èƒ½çœ‹åˆ°æ•ˆæœï¼Œä¹Ÿå°±æ˜¯ä»£ç çš„ 7 ~9 è¡Œã€‚

è¿è¡Œåç”Ÿæˆçš„å›¾ç‰‡æ˜¯åé¢è¿™æ ·ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/fa/9e/fabf325721f340cb8393916bb1d98e9e.png?wh=270x273)

æœ€åæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ç¨‹åºçš„æ•ˆæœï¼Œæµ‹è¯•ä»£ç ä¸ºï¼š

```python
# Invoke
messages = [HumanMessage(content="300750 æ˜¯å“ªåªè‚¡ç¥¨çš„ä»£ç ï¼Ÿ")]
messages = agent.invoke({"messages": messages})
for m in messages["messages"]:
Â  Â  m.pretty_print()
```

æ•ˆæœå¦‚ä¸‹ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/a6/4f/a6c61f26cb10815a28778dac6473f94f.png?wh=1270x235)

### Pre-built Agent

é™¤äº†æ‰‹å·¥å®ç° Function Calling å¤–ï¼ŒLangGraph è¿˜å¸®æˆ‘ä»¬æŠŠå‰é¢çš„é€»è¾‘è¿›è¡Œäº†å°è£…ï¼Œæä¾›äº†ä¸€ç§å« Pre-built çš„æ–¹å¼ï¼Œæ–‡æ¡£åœ¨è¿™ï¼š[Workflows and Agents](https://langchain-ai.github.io/langgraph/tutorials/workflows/#pre-built)ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/d5/33/d5d7949a36bd7849f2f41bba1d0c6a33.png?wh=1054x282)

Pre-built çš„æ„æ€æ˜¯é¢„æ„å»ºï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘æŠŠå¤„ç†é€»è¾‘éƒ½é¢„å…ˆå°è£…æˆåŒ…äº†ï¼Œä¸éœ€è¦ä½ å†æ„å»º Graph äº†ï¼Œä½ åªéœ€è¦è°ƒç”¨å°±å¥½ï¼Œæ‰€ä»¥ä»£ç ä¹Ÿå°±éå¸¸ç®€å•äº†ã€‚

ä½†å®ƒè¿™é‡Œæœ‰ä¸€ä¸ªæè¿°ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºæ˜¯æœ‰è¯¯å¯¼çš„ï¼Œä¹Ÿå°±æ˜¯çº¢æ¡†ä¸­çš„ create\_react\_agentã€‚æœ€å¼€å§‹ï¼Œæˆ‘æ²¡çœ‹æºç å‰ï¼Œä»¥ä¸ºå®ƒæ˜¯ç”¨çš„ ReAct prompt çš„æ–¹å¼æ„å»ºçš„ Agentã€‚ä½†åæ¥çœ‹äº†çœ‹ä»£ç æ‰çŸ¥é“ï¼Œå®ƒçš„å®ç°é€»è¾‘è¿˜æ˜¯ Function Callingï¼Œä¹Ÿæé†’ä½ ç•™æ„ä¸€ä¸‹ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡ç¼–ç æµ‹è¯•çœ‹ä¸€ä¸‹å…¶æ•ˆæœã€‚é¦–å…ˆæˆ‘ä»¬æŠŠ Function Calling å°èŠ‚çš„ tools ä»£ç æ‹¿è¿‡æ¥ï¼Œåˆ é™¤æ‰ä»¥ä¸‹ä»£ç ï¼š

```python
tools_by_name = {tool.name: tool for tool in tools}
llm = DeepSeek()
llm_with_tools = llm.bind_tools(tools)
```

å› ä¸ºè¿™é‡Œä¸éœ€è¦æˆ‘ä»¬æ‰‹å·¥ç»‘å®šå·¥å…·ã€‚ä¹‹åçš„ Graph ä»£ç è¶…çº§ç®€å•ï¼Œä»£ç å¦‚ä¸‹ï¼š

```python
from langgraph.prebuilt import create_react_agent
from langchain_core.messages import HumanMessage
from llm import DeepSeek
from tools import tools

llm = DeepSeek()

pre_built_agent = create_react_agent(llm, tools=tools)

# ä¿å­˜ä»£ç†å·¥ä½œæµç¨‹å›¾åˆ°æ–‡ä»¶
graph_png = pre_built_agent.get_graph(xray=True).draw_mermaid_png()
with open("agent_graph.png", "wb") as f:
Â  Â  f.write(graph_png)


# Invoke
messages = [HumanMessage(content="300750 æ˜¯å“ªåªè‚¡ç¥¨çš„ä»£ç ï¼Ÿ")]
messages = pre_built_agent.invoke({"messages": messages})
for m in messages["messages"]:
Â  Â  m.pretty_print()
```

å¯ä»¥çœ‹åˆ°åªéœ€è¦å¼•å…¥ prebuilt åŒ…ï¼Œè°ƒä¸€ä¸‹ create\_react\_agent æ–¹æ³•å°±å¯ä»¥æå®šï¼Œå®Œå…¨ä¸éœ€è¦è‡ªå·±å†™ Graph ä»£ç ã€‚æœ€åçš„è¿è¡Œæ•ˆæœä¸ºï¼š

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/e1/b2/e13c543956aef482a30f9c4783acc8b2.png?wh=1270x498)  
![å›¾ç‰‡](https://static001.geekbang.org/resource/image/7e/30/7e408ab08f2be8d95387c13377954830.png?wh=1272x413)

çœ‹åˆ°äº†å§ï¼Œè¿˜æ˜¯ Function Calling çš„è¿‡ç¨‹ã€‚

å†æ¥çœ‹çœ‹ç”Ÿæˆçš„ Graph å›¾ï¼š

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/bc/89/bcd3f56e031aa6686bbf14f80315aa89.png?wh=216x249)

è¿™å¼ å›¾æ›´åŠ æ¸…æ™°åœ°è¡¨è¾¾äº†ç”¨ä¸€ä¸ª Agent æ¨¡å—å°è£… Function Calling ä»£ç çš„é€»è¾‘ã€‚

## æ€»ç»“

è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬ç»“åˆè‚¡ç¥¨çš„ä¸šåŠ¡èƒŒæ™¯ï¼Œå†æ¬¡å¯¹å¦‚ä½•åº”ç”¨ LangGraph å®ç° Agent åšäº†æ¢³ç†ã€‚ä½ ä¼šå‘ç°ä¸šåŠ¡æœ¬èº«ä¸éš¾ï¼Œæœ‰äº†æ•°æ®ä¹‹åï¼Œäº¤ç»™AIéƒ½å¥½åŠã€‚

è¿™æ¬¡çš„ Agent å®ç°ä¸­æœ‰ä¸¤æ¡æœ€æ ¸å¿ƒçš„é€»è¾‘ï¼Œ**ä¸€ä¸ªå°±æ˜¯è®© Graph å®ç°å¾ªç¯ï¼Œå¦ä¸€ä¸ªå°±æ˜¯é€šè¿‡æ¡ä»¶è¾¹å’Œæ¡ä»¶èŠ‚ç‚¹é€€å‡ºå¾ªç¯**ã€‚å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å­¦åˆ°äº†é€šè¿‡è‡ªåŠ¨ç”Ÿæˆ Graph å›¾ç‰‡çš„æ–¹å¼ï¼Œè¿™å¯ä»¥ç›´è§‚éªŒè¯æˆ‘ä»¬çš„ Graph é€»è¾‘æ˜¯å¦æ­£ç¡®ã€‚è¯¾åä½ å¯ä»¥è‡ªå·±åŠ¨æ‰‹è¯•è¯•çœ‹ï¼Œè¿™æ ·å°è±¡æ›´æ·±åˆ»ã€‚

ç»“åˆæˆ‘çš„ç»éªŒçœ‹ï¼ŒLangGraph çš„åŠŸèƒ½çœŸçš„éå¸¸å¼ºå¤§ï¼Œä¹Ÿéå¸¸å¥½ç”¨ï¼Œå€¼å¾—ä½ èŠ±ä¸€äº›æ—¶é—´å­¦ä¹ å®è·µä¸€ä¸‹ï¼Œä¹ŸæœŸå¾…åœ¨ç•™è¨€åŒºçœ‹åˆ°ä½ çš„ä½¿ç”¨ä½“éªŒã€‚è¿™èŠ‚è¯¾çš„ä»£ç å·²ç»ä¸Šä¼ åˆ° GitHubï¼Œåœ°å€æ˜¯ï¼š[Geek02/class30 at main Â· xingyunyang01/Geek02](https://github.com/xingyunyang01/Geek02/tree/main/class30)ï¼Œä½ å¯ä»¥ä¸‹è½½ä»£ç åè¿›è¡Œæµ‹è¯•ï¼ŒåŠ æ·±ç†è§£ã€‚

è¯·å¤§å®¶æ€è€ƒä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆåœ¨è¿™èŠ‚è¯¾çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘è¦ä½¿ç”¨ deepseek chat V3 å‘¢ï¼Ÿä½¿ç”¨ R1 è¡Œä¸è¡Œï¼Ÿ

æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºå±•ç¤ºä½ çš„æ€è€ƒç»“æœï¼Œæˆ‘ä»¬ä¸€èµ·æ¥è®¨è®ºã€‚å¦‚æœä½ è§‰å¾—è¿™èŠ‚è¯¾çš„å†…å®¹å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œä¹Ÿæ¬¢è¿ä½ åˆ†äº«ç»™å…¶ä»–æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ4ï¼‰</strong></div><ul>
<li><span>ä»˜åŸæº¥</span> ğŸ‘ï¼ˆ3ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è¿™ç§æŸ¥è¯¢å·¥å…·æ¯”è¾ƒç®€å•æ„Ÿè§‰ç”¨ä¸åˆ°r1ï¼Œå¦å¤–r1æ¯æ¬¡è¦æ€è€ƒä¹Ÿå½±å“æ€§èƒ½</p>2025-05-07</li><br/><li><span>sky</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>r1å¥½åƒä¸æ”¯æŒå·¥å…·è°ƒç”¨</p>2025-05-07</li><br/><li><span>Feng</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>tool.invokeä¸æ˜¯æˆ‘ä»¬è‡ªå·±æ‰§è¡Œçš„å—ï¼ŒLLMåªæ˜¯åšäº†ä¸‹åˆ¤æ–­éœ€è¦ä½¿ç”¨åˆ°æŸä¸ªtoolã€‚R1è¿™ä¸ªåˆ¤æ–­ä¹Ÿä¸æ”¯æŒæ˜¯å—ï¼Ÿ</p>2025-05-08</li><br/><li><span>chenyf</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<p>def should_continue(state: MessagesState) -&gt; Literal[&quot;environment&quot;, &quot;END&quot;]  è¿™ä¸ªå‡½æ•°å£°æ˜è¿”å›å€¼åº”è¯¥æ˜¯environmentæˆ–ENDï¼Œä½†æ˜¯ä¸ºå•¥åœ¨ç¬¬7è¡Œè¿”å›äº†&quot;Action&quot;?</p>2025-05-07</li><br/>
</ul>