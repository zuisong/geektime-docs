ä½ å¥½ï¼Œæˆ‘æ˜¯å¾æ–‡æµ©ã€‚

æœ‰ä¸å°‘äººåœ¨ä½¿ç”¨OpenAIæä¾›çš„GPTç³»åˆ—æ¨¡å‹çš„æ—¶å€™ï¼Œéƒ½åé¦ˆæ•ˆæœå¹¶ä¸å¥½ã€‚è¿™äº›åé¦ˆä¸­æœ‰ä¸€å¤§ç±»é—®é¢˜ï¼Œæ˜¯å›ç­”ä¸äº†ä¸€äº›ç®€å•çš„é—®é¢˜ã€‚æ¯”å¦‚å½“æˆ‘ä»¬ç”¨ä¸­æ–‡é—®AIä¸€äº›äº‹å®æ€§çš„é—®é¢˜ï¼ŒAIå¾ˆå®¹æ˜“èƒ¡ç¼–ä¹±é€ ã€‚è€Œå½“ä½ é—®å®ƒæœ€è¿‘å‘ç”Ÿçš„æ–°é—»äº‹ä»¶çš„æ—¶å€™ï¼Œå®ƒå°±å¹²è„†å‘Šè¯‰ä½ å®ƒä¸çŸ¥é“21å¹´ä¹‹åçš„äº‹æƒ…ã€‚

æœ¬æ¥å‘¢ï¼Œæˆ‘å†™åˆ°è¿™é‡Œå°±å¯ä»¥äº†ã€‚ä¸è¿‡åˆ°äº†3æœˆ24æ—¥ï¼ŒOpenAIæ¨å‡ºäº†ChatGPT Pluginsè¿™ä¸ªåŠŸèƒ½ï¼Œå¯ä»¥è®©ChatGPTé€šè¿‡æ’ä»¶çš„å½¢å¼é“¾æ¥å¤–éƒ¨çš„ç¬¬ä¸‰æ–¹åº”ç”¨ã€‚æˆ‘è‡ªå·±ä¹Ÿè¿˜åœ¨æ’é˜Ÿç­‰waiting listï¼Œæ‰€ä»¥æš‚æ—¶ä¹Ÿæ— æ³•ä½“éªŒã€‚ä¸è¿‡ï¼Œå³ä½¿æœ‰äº†ç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½ç¡®ä¿è‡ªå·±æƒ³è¦çŸ¥é“çš„ä¿¡æ¯æ­£å¥½è¢«å…¶ä»–äººæä¾›äº†ã€‚è€Œä¸”ï¼Œæœ‰äº›ä¿¡æ¯å’Œé—®é¢˜æˆ‘ä»¬åªæƒ³æä¾›ç»™è‡ªå·±å…¬å¸çš„å†…éƒ¨ä½¿ç”¨ï¼Œå¹¶ä¸æƒ³å¼€æ”¾ç»™æ‰€æœ‰äººã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬æ—¢å¸Œæœ›èƒ½å¤Ÿåˆ©ç”¨OpenAIçš„å¤§è¯­è¨€æ¨¡å‹çš„èƒ½åŠ›ï¼Œä½†æ˜¯åˆéœ€è¦è¿™äº›èƒ½åŠ›ä»…ä»…åœ¨æˆ‘ä»¬è‡ªå·±æŒ‡å®šçš„æ•°æ®ä¸Šã€‚é‚£ä¹ˆè¿™ä¸€è®²ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚

## å¤§å‹è¯­è¨€æ¨¡å‹çš„ä¸è¶³ä¹‹å¤„

æˆ‘ä»¬å…ˆæ¥å°è¯•é—®ChatGPTä¸€ä¸ªäººå°½çš†çŸ¥çš„å¸¸è¯†ï¼Œâ€œé²è¿…å…ˆç”Ÿå»æ—¥æœ¬å­¦ä¹ åŒ»å­¦çš„è€å¸ˆæ˜¯è°â€ï¼Œç»“æœå®ƒç»™å‡ºçš„ç­”æ¡ˆæ˜¯é²è¿…çš„å¥½å‹ï¼Œå†…å±±ä¹¦åº—çš„è€æ¿å†…å±±å®Œé€ ï¼Œè€Œä¸æ˜¯å¤§å®¶éƒ½å­¦ä¹ è¿‡çš„è—¤é‡å…ˆç”Ÿã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/89/64/891fc431e1cd46b1d45f60fe79c2e964.png?wh=704x264)

ä¹‹æ‰€ä»¥ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼Œå’Œå¤§æ¨¡å‹çš„åŸç†ä»¥åŠå®ƒä½¿ç”¨è®­ç»ƒçš„æ•°æ®é›†æ˜¯æœ‰å…³çš„ã€‚å¤§è¯­è¨€æ¨¡å‹çš„åŸç†ï¼Œå°±æ˜¯åˆ©ç”¨è®­ç»ƒæ ·æœ¬é‡Œé¢å‡ºç°çš„æ–‡æœ¬çš„å‰åå…³ç³»ï¼Œé€šè¿‡å‰é¢çš„æ–‡æœ¬å¯¹æ¥ä¸‹æ¥å‡ºç°çš„æ–‡æœ¬è¿›è¡Œæ¦‚ç‡é¢„æµ‹ã€‚å¦‚æœç±»ä¼¼çš„å‰åæ–‡æœ¬å‡ºç°å¾—è¶Šå¤šï¼Œé‚£ä¹ˆè¿™ä¸ªæ¦‚ç‡åœ¨è®­ç»ƒè¿‡ç¨‹é‡Œä¼šæ”¶æ•›åˆ°å°‘æ•°æ­£ç¡®ç­”æ¡ˆä¸Šï¼Œå›ç­”å°±å‡†ç¡®ã€‚å¦‚æœè¿™æ ·çš„æ–‡æœ¬å¾ˆå°‘ï¼Œé‚£ä¹ˆè®­ç»ƒè¿‡ç¨‹é‡Œå°±ä¼šæœ‰ä¸€å®šçš„éšæœºæ€§ï¼Œå¯¹åº”çš„ç­”æ¡ˆå°±å®¹æ˜“ä¼¼æ˜¯è€Œéã€‚è€Œåœ¨GPT-3çš„æ¨¡å‹é‡Œï¼Œè™½ç„¶æ•´ä½“çš„è®­ç»ƒè¯­æ–™å¾ˆå¤šï¼Œä½†æ˜¯ä¸­æ–‡è¯­æ–™å¾ˆå°‘ã€‚åªæœ‰ä¸åˆ°1%çš„è¯­æ–™æ˜¯ä¸­æ–‡çš„ï¼Œæ‰€ä»¥å¦‚æœé—®å¾ˆå¤šä¸­æ–‡ç›¸å…³çš„çŸ¥è¯†æ€§æˆ–è€…å¸¸è¯†æ€§é—®é¢˜ï¼Œå®ƒçš„å›ç­”å¾€å¾€å°±å¾ˆæ‰¯ã€‚

å½“ç„¶ï¼Œä½ å¯ä»¥è¯´æˆ‘ä»¬æœ‰ä¸€ä¸ªè§£å†³åŠæ³•ï¼Œå°±æ˜¯å¤šæ‰¾ä¸€äº›é«˜è´¨é‡çš„ä¸­æ–‡è¯­æ–™è®­ç»ƒä¸€ä¸ªæ–°çš„æ¨¡å‹ã€‚æˆ–è€…ï¼Œå¯¹äºæˆ‘ä»¬æƒ³è®©AIèƒ½å¤Ÿå›ç­”å‡ºæ¥çš„é—®é¢˜ï¼Œæ‰¾ä¸€äº›æ•°æ®ã€‚ç„¶ååˆ©ç”¨OpenAIæä¾›çš„â€œå¾®è°ƒâ€ï¼ˆFine-tuneï¼‰æ¥å£ï¼Œåœ¨åŸæ¥çš„åŸºç¡€ä¸Šè®­ç»ƒä¸€ä¸ªæ–°æ¨¡å‹å‡ºæ¥ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/47/9c/47e11ff6d1534e8f53ea8da3ae5bcb9c.png?wh=700x217 "å¦‚æœä½ é—®ä¸€ä¸‹æ–°é—»ç±»çš„ä¿¡æ¯ï¼ŒChatGPTé€šå¸¸ä¼šæ‹’ç»å›ç­”")

è¿™æ ·å½“ç„¶æ˜¯å¯ä»¥çš„ï¼Œå°±æ˜¯æˆæœ¬æœ‰ç‚¹é«˜ã€‚å¯¹äºä¸Šé¢é‚£ä¸ªä¾‹å­æ¥è¯´ï¼Œåªæ˜¯ç¼ºå°‘ä¸€äº›æ–‡æœ¬æ•°æ®ï¼Œè¿˜å¥½è¯´ã€‚å¦‚æœæ˜¯æ—¶æ•ˆæ€§è¦æ±‚æ¯”è¾ƒå¼ºçš„èµ„è®¯ç±»çš„ä¿¡æ¯ï¼Œå°±å¾ˆéš¾è¿™ä¹ˆåšã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬æƒ³è®©AIå‘Šè¯‰æˆ‘ä»¬å‰ä¸€å¤©è¶³çƒèµ›çš„æ¯”åˆ†ï¼Œæˆ‘ä»¬ä¸å¤ªå¯èƒ½æ¯éš”å‡ ä¸ªå°æ—¶å°±å•ç‹¬è®­ç»ƒæˆ–è€…å¾®è°ƒä¸€ä¸‹æ¨¡å‹ï¼Œé‚£æ ·å¹²çš„æˆæœ¬å¤ªé«˜äº†ã€‚

## Bingçš„è§£æ³•â€”â€”å…ˆæœç´¢ï¼Œåæç¤º

ä¸è¿‡å¯¹è¿™ä¸ªé¢†åŸŸæ¯”è¾ƒå…³æ³¨çš„æœ‹å‹å¯èƒ½å°±è¦é—®äº†ã€‚ä¹‹å‰å¾®è½¯ä¸æ˜¯åœ¨Bingè¿™ä¸ªæœç´¢å¼•æ“é‡Œï¼ŒåŠ ä¸Šäº†ChatGPTçš„é—®ç­”åŠŸèƒ½å—ï¼Ÿæ•ˆæœä¼¼ä¹ä¹Ÿè¿˜ä¸é”™ï¼Œé‚£Bingæ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Œæ˜¯å› ä¸ºä»–ä»¬ç”¨äº†æ›´åŠ å‰å®³çš„è¯­è¨€æ¨¡å‹å—ï¼Ÿ

è™½ç„¶æˆ‘å¹¶æ²¡æœ‰ä»€ä¹ˆå†…å¹•æ¶ˆæ¯ï¼Œä¸äº†è§£Bingæ˜¯æ€ä¹ˆåšçš„ã€‚ä½†æ˜¯å¦‚æœæ˜¯æˆ‘çš„è¯ï¼Œä¼šç”¨è¿™æ ·ä¸€ä¸ªè§£å†³åŠæ³•â€”â€”é‚£å°±æ˜¯å…ˆæœç´¢ï¼Œåæç¤ºï¼ˆPromptï¼‰ã€‚

1. æˆ‘ä»¬å…ˆé€šè¿‡æœç´¢çš„æ–¹å¼ï¼Œæ‰¾åˆ°å’Œè¯¢é—®çš„é—®é¢˜æœ€ç›¸å…³çš„è¯­æ–™ã€‚è¿™ä¸ªæœç´¢è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ—¢å¯ä»¥ç”¨ä¼ ç»Ÿçš„åŸºäºå…³é”®è¯æœç´¢çš„æŠ€æœ¯ï¼Œä¹Ÿå¯ä»¥ç”¨[ç¬¬ 9 è®²](http://time.geekbang.org/column/article/644795)æˆ‘ä»¬åˆšåˆšä»‹ç»è¿‡çš„ä½¿ç”¨Embeddingçš„ç›¸ä¼¼åº¦è¿›è¡Œè¯­ä¹‰æœç´¢çš„æŠ€æœ¯ã€‚
2. ç„¶åï¼Œæˆ‘ä»¬å°†å’Œé—®é¢˜è¯­ä¹‰æœ€æ¥è¿‘çš„å‰å‡ æ¡å†…å®¹ï¼Œä½œä¸ºæç¤ºè¯­çš„ä¸€éƒ¨åˆ†ç»™åˆ°AIã€‚ç„¶åè¯·AIå‚è€ƒè¿™äº›å†…å®¹ï¼Œå†æ¥å›ç­”è¿™ä¸ªé—®é¢˜ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/c8/f2/c8f7888bdfc3438934e784beayybeef2.png?wh=686x438)

æˆ‘åœ¨è¿™é‡Œï¼Œä¹Ÿç»™äº†ä½ ä¸€ä¸ªä¾‹å­çš„æˆªå›¾ã€‚å½“æˆ‘ä»¬æŠŠã€Šè—¤é‡å…ˆç”Ÿã€‹é‡Œçš„ä¸¤ä¸ªæ®µè½ç»™åˆ°AIï¼Œç„¶åè¯·AIæ ¹æ®è¿™ä¸¤ä¸ªæ®µè½ï¼Œå›ç­”åŸæ¥é‚£ä¸ªé—®é¢˜ï¼Œå°±ä¼šå¾—åˆ°æ­£ç¡®çš„ç­”æ¡ˆï¼Œä½ ä¹Ÿå¯ä»¥å»çœ‹ä¸€çœ‹ã€‚

è¿™ä¹Ÿæ˜¯åˆ©ç”¨å¤§è¯­è¨€æ¨¡å‹çš„ä¸€ä¸ªå¸¸è§æ¨¡å¼ã€‚å› ä¸ºå¤§è¯­è¨€æ¨¡å‹å…¶å®å†…å«äº†ä¸¤ç§èƒ½åŠ›ã€‚

ç¬¬ä¸€ç§ï¼Œæ˜¯æµ·é‡çš„è¯­æ–™ä¸­ï¼Œæœ¬èº«å·²ç»åŒ…å«äº†çš„çŸ¥è¯†ä¿¡æ¯ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å‰é¢é—®AIé±¼é¦™è‚‰ä¸çš„åšæ³•ï¼Œå®ƒèƒ½å›ç­”ä¸Šæ¥å°±æ˜¯å› ä¸ºè¯­æ–™é‡Œå·²ç»æœ‰äº†å……è¶³çš„ç›¸å…³çŸ¥è¯†ã€‚æˆ‘ä»¬ä¸€èˆ¬ç§°ä¹‹ä¸ºâ€œä¸–ç•ŒçŸ¥è¯†â€ã€‚

ç¬¬äºŒç§ï¼Œæ˜¯æ ¹æ®ä½ è¾“å…¥çš„å†…å®¹ï¼Œç†è§£å’Œæ¨ç†çš„èƒ½åŠ›ã€‚è¿™ä¸ªèƒ½åŠ›ï¼Œä¸éœ€è¦è®­ç»ƒè¯­æ–™é‡Œæœ‰ä¸€æ ·çš„å†…å®¹ã€‚è€Œæ˜¯å¤§è¯­è¨€æ¨¡å‹æœ¬èº«æœ‰â€œæ€ç»´èƒ½åŠ›â€ï¼Œèƒ½å¤Ÿè¿›è¡Œé˜…è¯»ç†è§£ã€‚è¿™ä¸ªè¿‡ç¨‹é‡Œï¼Œâ€œçŸ¥è¯†â€ä¸æ˜¯æ¨¡å‹æœ¬èº«æä¾›çš„ï¼Œè€Œæ˜¯æˆ‘ä»¬æ‰¾å‡ºæ¥ï¼Œä¸´æ—¶æä¾›ç»™æ¨¡å‹çš„ã€‚å¦‚æœä¸æä¾›è¿™ä¸ªä¸Šä¸‹æ–‡ï¼Œå†é—®ä¸€æ¬¡æ¨¡å‹ç›¸åŒçš„é—®é¢˜ï¼Œå®ƒè¿˜æ˜¯ç­”ä¸ä¸Šæ¥çš„ã€‚

## é€šè¿‡llama\_indexå°è£…â€œç¬¬äºŒå¤§è„‘â€

æˆ‘ç»™ä¸Šé¢è¿™ç§å…ˆæœç´¢ã€åæç¤ºçš„æ–¹å¼ï¼Œå–äº†ä¸€ä¸ªåå­—ï¼Œå«åšAIçš„â€œç¬¬äºŒå¤§è„‘â€æ¨¡å¼ã€‚å› ä¸ºè¿™ä¸ªæ–¹æ³•ï¼Œéœ€è¦æå‰æŠŠä½ å¸Œæœ›AIèƒ½å¤Ÿå›ç­”çš„çŸ¥è¯†ï¼Œå»ºç«‹ä¸€ä¸ªå¤–éƒ¨çš„ç´¢å¼•ï¼Œè¿™ä¸ªç´¢å¼•å°±å¥½åƒAIçš„â€œç¬¬äºŒä¸ªå¤§è„‘â€ã€‚æ¯æ¬¡å‘AIæé—®çš„æ—¶å€™ï¼Œå®ƒéƒ½ä¼šå…ˆå»æŸ¥è¯¢ä¸€ä¸‹è¿™ä¸ªç¬¬äºŒå¤§è„‘é‡Œé¢çš„èµ„æ–™ï¼Œæ‰¾åˆ°ç›¸å…³èµ„æ–™ä¹‹åï¼Œå†é€šè¿‡è‡ªå·±çš„æ€ç»´èƒ½åŠ›æ¥å›ç­”é—®é¢˜ã€‚

å®é™…ä¸Šï¼Œä½ ç°åœ¨åœ¨ç½‘ä¸Šçœ‹åˆ°çš„å¾ˆå¤šè¯»è®ºæ–‡ã€è¯»ä¹¦å›ç­”é—®é¢˜çš„åº”ç”¨ï¼Œéƒ½æ˜¯é€šè¿‡è¿™ä¸ªæ¨¡å¼æ¥å®ç°çš„ã€‚é‚£ä¹ˆï¼Œç°åœ¨æˆ‘ä»¬å°±æ¥è‡ªå·±å®ç°ä¸€ä¸‹è¿™ä¸ªâ€œç¬¬äºŒå¤§è„‘â€æ¨¡å¼ã€‚

ä¸è¿‡ï¼Œæˆ‘ä»¬ä¸å¿…ä»0å¼€å§‹å†™ä»£ç ã€‚å› ä¸ºè¿™ä¸ªæ¨¡å¼å®åœ¨å¤ªè¿‡å¸¸ç”¨äº†ï¼Œæ‰€ä»¥æœ‰äººä¸ºå®ƒå†™äº†ä¸€ä¸ªå¼€æºPythonåŒ…ï¼Œå«åšllama-indexã€‚é‚£ä¹ˆæˆ‘ä»¬è¿™é‡Œï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨è¿™ä¸ªè½¯ä»¶åŒ…ï¼Œç”¨å‡ è¡Œä»£ç æ¥è¯•ä¸€è¯•ï¼Œå®ƒèƒ½ä¸èƒ½å›ç­”ä¸Šé²è¿…å…ˆç”Ÿå†™çš„ã€Šè—¤é‡å…ˆç”Ÿã€‹ç›¸å…³çš„é—®é¢˜ã€‚

llama-indexè¿˜æ²¡æœ‰äººåšå¥½Condaä¸‹çš„åŒ…ï¼Œæ‰€ä»¥å³ä½¿åœ¨Condaä¸‹è¿˜æ˜¯è¦é€šè¿‡pipæ¥å®‰è£…ã€‚

```python
pip install llama-index
pip install langchain
```

æˆ‘æŠŠä»ç½‘ä¸Šæ‰¾åˆ°çš„ã€Šè—¤é‡å…ˆç”Ÿã€‹è¿™ç¯‡æ–‡ç« å˜æˆäº†ä¸€ä¸ªtxtæ–‡ä»¶ï¼Œæ”¾åœ¨äº† data/mr\_fujino è¿™ä¸ªç›®å½•ä¸‹ã€‚æˆ‘ä»¬çš„ä»£ç ä¹Ÿéå¸¸ç®€å•ï¼Œä¸€å…±æ²¡æœ‰å‡ è¡Œã€‚

```python
import openai, os
from llama_index import GPTVectorStoreIndex, SimpleDirectoryReader

openai.api_key = os.environ.get("OPENAI_API_KEY")

documents = SimpleDirectoryReader('./data/mr_fujino').load_data()
index = GPTSimpleVectorIndex.from_documents(documents)

index.save_to_disk('index_mr_fujino.json')
```

è¾“å‡ºç»“æœï¼š

```python
INFO:llama_index.token_counter.token_counter:> [build_index_from_nodes] Total LLM token usage: 0 tokens
INFO:llama_index.token_counter.token_counter:> [build_index_from_nodes] Total embedding token usage: 6763 tokens
```

æ³¨ï¼šæ—¥å¿—ä¸­ä¼šæ‰“å°å‡ºæ¥æˆ‘ä»¬é€šè¿‡Embeddingæ¶ˆè€—äº†å¤šå°‘ä¸ªTokenã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå«åšSimpleDirectoryReaderçš„æ•°æ®åŠ è½½å™¨ï¼Œå°†æ•´ä¸ª./data/mr\_fujino çš„ç›®å½•ç»™åŠ è½½è¿›æ¥ã€‚è¿™é‡Œé¢çš„æ¯ä¸€ä¸ªæ–‡ä»¶ï¼Œéƒ½ä¼šè¢«å½“æˆæ˜¯ä¸€ç¯‡æ–‡æ¡£ã€‚

ç„¶åï¼Œæˆ‘ä»¬å°†æ‰€æœ‰çš„æ–‡æ¡£äº¤ç»™äº† GPTSimpleVectorIndex æ„å»ºç´¢å¼•ã€‚é¡¾åæ€ä¹‰ï¼Œå®ƒä¼šæŠŠæ–‡æ¡£åˆ†æ®µè½¬æ¢æˆä¸€ä¸ªä¸ªå‘é‡ï¼Œç„¶åå­˜å‚¨æˆä¸€ä¸ªç´¢å¼•ã€‚

æœ€åï¼Œæˆ‘ä»¬ä¼šæŠŠå¯¹åº”çš„ç´¢å¼•å­˜ä¸‹æ¥ï¼Œå­˜å‚¨çš„ç»“æœå°±æ˜¯ä¸€ä¸ªjsonæ–‡ä»¶ã€‚åé¢ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨è¿™ä¸ªç´¢å¼•æ¥è¿›è¡Œç›¸åº”çš„é—®ç­”ã€‚

```python
index = GPTVectorStoreIndex.load_from_disk('index_mr_fujino.json')
response = index.query("é²è¿…å…ˆç”Ÿåœ¨æ—¥æœ¬å­¦ä¹ åŒ»å­¦çš„è€å¸ˆæ˜¯è°ï¼Ÿ")
print(response)
```

è¦è¿›è¡Œé—®ç­”ä¹Ÿæ²¡æœ‰å‡ è¡Œä»£ç ï¼Œæˆ‘ä»¬é€šè¿‡ GPTSimpleVectorIndex çš„ load\_from\_disk å‡½æ•°ï¼Œå¯ä»¥æŠŠåˆšæ‰ç”Ÿæˆçš„ç´¢å¼•åŠ è½½åˆ°å†…å­˜é‡Œé¢æ¥ã€‚ç„¶åå¯¹ç€Indexç´¢å¼•è°ƒç”¨Queryå‡½æ•°ï¼Œå°±èƒ½å¤Ÿè·å¾—é—®é¢˜çš„ç­”æ¡ˆã€‚å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡å¤–éƒ¨çš„ç´¢å¼•ï¼Œæˆ‘ä»¬å¯ä»¥æ­£ç¡®åœ°è·å¾—é—®é¢˜çš„ç­”æ¡ˆã€‚

```python
INFO:llama_index.token_counter.token_counter:> [query] Total LLM token usage: 2984 tokens
INFO:llama_index.token_counter.token_counter:> [query] Total embedding token usage: 34 tokens

é²è¿…å…ˆç”Ÿåœ¨æ—¥æœ¬å­¦ä¹ åŒ»å­¦çš„è€å¸ˆæ˜¯è—¤é‡ä¸¥ä¹éƒå…ˆç”Ÿã€‚
```

è¿™ä¹ˆä¸€çœ‹ï¼Œä¼¼ä¹é—®é¢˜ç‰¹åˆ«ç®€å•ï¼Œä¸‰è¡Œä»£ç å°±æå®šäº†ã€‚åˆ«ç€æ€¥ï¼Œæˆ‘ä»¬å†çœ‹çœ‹åˆ«çš„é—®é¢˜å®ƒæ˜¯ä¸æ˜¯ä¹Ÿèƒ½ç­”ä¸Šæ¥ï¼Ÿè¿™æ¬¡æˆ‘ä»¬æ¥è¯•ç€é—®é—®é²è¿…å…ˆç”Ÿæ˜¯åœ¨å“ªé‡Œå­¦ä¹ åŒ»å­¦çš„ã€‚

```python
response = index.query("é²è¿…å…ˆç”Ÿå»å“ªé‡Œå­¦çš„åŒ»å­¦ï¼Ÿ")
print(response)
```

è¾“å‡ºç»“æœï¼š

```python
> Got node text: è—¤é‡å…ˆç”Ÿ
ä¸œäº¬ä¹Ÿæ— éæ˜¯è¿™æ ·ã€‚ä¸Šé‡çš„æ¨±èŠ±çƒ‚ç†³çš„æ—¶èŠ‚ï¼Œæœ›å»ç¡®ä¹Ÿåƒç»¯çº¢çš„è½»äº‘ï¼Œä½†èŠ±ä¸‹ä¹Ÿç¼ºä¸äº†æˆç¾¤ç»“é˜Ÿçš„â€œæ¸…å›½ç•™å­¦ç”Ÿâ€çš„é€Ÿæˆç­ï¼Œå¤´é¡¶ä¸Šç›˜ç€å¤§è¾«å­ï¼Œé¡¶å¾—å­¦ç”Ÿåˆ¶å¸½çš„é¡¶ä¸Šé«˜é«˜è€¸èµ·ï¼Œå½¢æˆä¸€åº§å¯Œå£«å±±ã€‚ä¹Ÿæœ‰è§£æ•£è¾«å­ï¼Œç›˜å¾—å¹³çš„ï¼Œé™¤ä¸‹å¸½æ¥ï¼Œæ²¹å…‰å¯é‰´ï¼Œå®›å¦‚å°å§‘å¨˜çš„å‘é«»ä¸€èˆ¬ï¼Œè¿˜è¦å°†è„–å­æ‰­å‡ æ‰­ã€‚å®åœ¨æ ‡è‡´æäº†ã€‚
ä¸­å›½ç•™å­¦ç”Ÿä¼šé¦†çš„é—¨æˆ¿é‡Œæœ‰å‡ æœ¬ä¹¦ä¹°ï¼Œæœ‰æ—¶è¿˜å€¼å¾—å»ä¸€è½¬ï¼›å€˜åœ¨ä¸Šåˆï¼Œé‡Œé¢çš„å‡ é—´æ´‹æˆ¿é‡Œå€’ä¹Ÿè¿˜å¯ä»¥ååçš„ã€‚ä½†åˆ°å‚æ™šï¼Œæœ‰...

INFO:llama_index.token_counter.token_counter:> [query] Total LLM token usage: 2969 tokens
INFO:llama_index.token_counter.token_counter:> [query] Total embedding token usage: 26 tokens

é²è¿…å…ˆç”Ÿå»ä»™å°çš„åŒ»å­¦ä¸“é—¨å­¦æ ¡å­¦ä¹ åŒ»å­¦ã€‚
```

å®ƒä»ç„¶æ­£ç¡®å›ç­”äº†é—®é¢˜ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬æœç´¢åˆ°çš„å†…å®¹ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹é‡Œé¢æ˜¯å¦‚ä½•æäº¤ç»™OpenAIçš„å‘¢ï¼Ÿæˆ‘ä»¬å°±æ¥çœ‹çœ‹ä¸‹é¢çš„è¿™æ®µä»£ç å°±çŸ¥é“äº†ã€‚

```python
from llama_index import QuestionAnswerPrompt
query_str = "é²è¿…å…ˆç”Ÿå»å“ªé‡Œå­¦çš„åŒ»å­¦ï¼Ÿ"
DEFAULT_TEXT_QA_PROMPT_TMPL = (
    "Context information is below. \n"
    "---------------------\n"
    "{context_str}"
    "\n---------------------\n"
    "Given the context information and not prior knowledge, "
    "answer the question: {query_str}\n"
)
QA_PROMPT = QuestionAnswerPrompt(DEFAULT_TEXT_QA_PROMPT_TMPL)

response = index.query(query_str, text_qa_template=QA_PROMPT)
print(response)
```

è¿™æ®µä»£ç é‡Œï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªQA\_PROMPTçš„å¯¹è±¡ï¼Œå¹¶ä¸”ä¸ºå®ƒè®¾è®¡äº†ä¸€ä¸ªæ¨¡ç‰ˆã€‚

1. è¿™ä¸ªæ¨¡ç‰ˆçš„å¼€å¤´ï¼Œæˆ‘ä»¬å‘Šè¯‰AIï¼Œæˆ‘ä»¬ä¸ºAIæä¾›äº†ä¸€äº›ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆContext informationï¼‰ã€‚
2. æ¨¡ç‰ˆé‡Œé¢æ”¯æŒä¸¤ä¸ªå˜é‡ï¼Œä¸€ä¸ªå«åš context\_strï¼Œå¦ä¸€ä¸ªå«åšquery\_strã€‚context\_str çš„åœ°æ–¹ï¼Œåœ¨å®é™…è°ƒç”¨çš„æ—¶å€™ï¼Œä¼šè¢«é€šè¿‡Embeddingç›¸ä¼¼åº¦æ‰¾å‡ºæ¥çš„å†…å®¹å¡«å…¥ã€‚è€Œ query\_str åˆ™æ˜¯ä¼šè¢«æˆ‘ä»¬å®é™…æçš„é—®é¢˜æ›¿æ¢æ‰ã€‚
3. å®é™…æé—®çš„æ—¶å€™ï¼Œæˆ‘ä»¬å‘Šè¯‰AIï¼Œåªè€ƒè™‘ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè€Œä¸è¦æ ¹æ®è‡ªå·±å·²ç»æœ‰çš„å…ˆéªŒçŸ¥è¯†ï¼ˆprior knowledgeï¼‰æ¥å›ç­”é—®é¢˜ã€‚

æˆ‘ä»¬å°±æ˜¯è¿™æ ·ï¼ŒæŠŠæœç´¢æ‰¾åˆ°çš„ç›¸å…³å†…å®¹ä»¥åŠé—®é¢˜ï¼Œç»„åˆåˆ°ä¸€èµ·å˜æˆä¸€æ®µæç¤ºè¯­ï¼Œè®©AIèƒ½å¤ŸæŒ‰ç…§æˆ‘ä»¬çš„è¦æ±‚æ¥å›ç­”é—®é¢˜ã€‚é‚£æˆ‘ä»¬å†é—®ä¸€æ¬¡AIï¼Œçœ‹çœ‹ç­”æ¡ˆæ˜¯ä¸æ˜¯æ²¡æœ‰å˜ã€‚

è¾“å‡ºç»“æœï¼š

```python
é²è¿…å…ˆç”Ÿå»ä»™å°çš„åŒ»å­¦ä¸“é—¨å­¦æ ¡å­¦ä¹ åŒ»å­¦ã€‚
```

è¿™ä¸€æ¬¡AIè¿˜æ˜¯æ­£ç¡®åœ°å›ç­”å‡ºäº†é²è¿…å…ˆç”Ÿæ˜¯å»ä»™å°çš„åŒ»å­¦ä¸“é—¨å­¦æ ¡å­¦ä¹ çš„ã€‚æˆ‘ä»¬å†è¯•ä¸€è¯•ï¼Œé—®ä¸€äº›ä¸ç›¸å¹²çš„é—®é¢˜ï¼Œä¼šå¾—åˆ°ä»€ä¹ˆç­”æ¡ˆï¼Œæ¯”å¦‚æˆ‘ä»¬é—®é—®çº¢æ¥¼æ¢¦é‡Œæ—é»›ç‰å’Œè´¾å®ç‰çš„å…³ç³»ã€‚

```python
QA_PROMPT_TMPL = (
    "ä¸‹é¢çš„â€œæˆ‘â€æŒ‡çš„æ˜¯é²è¿…å…ˆç”Ÿ \n"
    "---------------------\n"
    "{context_str}"
    "\n---------------------\n"
    "æ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œè¯·å›ç­”é—®é¢˜: {query_str}\n"
    "å¦‚æœæ‚¨ä¸çŸ¥é“çš„è¯ï¼Œè¯·å›ç­”ä¸çŸ¥é“\n"
)
QA_PROMPT = QuestionAnswerPrompt(QA_PROMPT_TMPL)

response = index.query("è¯·é—®æ—é»›ç‰å’Œè´¾å®ç‰æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ", text_qa_template=QA_PROMPT)

print(response)
```

è¾“å‡ºç»“æœï¼š

```python
ä¸çŸ¥é“
```

å¯ä»¥çœ‹åˆ°ï¼ŒAIçš„ç¡®æŒ‰ç…§æˆ‘ä»¬çš„æŒ‡ä»¤å›ç­”ä¸çŸ¥é“ï¼Œè€Œä¸æ˜¯èƒ¡ç­”ä¸€æ°”ã€‚

## é€šè¿‡llama\_indexå¯¹äºæ–‡ç« è¿›è¡Œå°ç»“

è¿˜æœ‰ä¸€ä¸ªå¸¸è§çš„ä½¿ç”¨llama-indexè¿™æ ·â€œç¬¬äºŒå¤§è„‘â€çš„Pythonåº“çš„åº”ç”¨åœºæ™¯ï¼Œå°±æ˜¯ç”Ÿæˆæ–‡ç« çš„æ‘˜è¦ã€‚åœ¨å‰é¢æ•™ä½ å¦‚ä½•è¿›è¡Œæ–‡æœ¬èšç±»çš„æ—¶å€™ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¯ä»¥é€šè¿‡åˆé€‚çš„æç¤ºè¯­ï¼ˆPromptï¼‰åšåˆ°è¿™ä¸€ç‚¹ã€‚ä¸è¿‡ï¼Œå¦‚æœè¦æ€»ç»“ä¸€ç¯‡è®ºæ–‡ã€ç”šè‡³æ˜¯ä¸€æœ¬ä¹¦ï¼Œæ¯æ¬¡æœ€å¤šåªèƒ½æ”¯æŒ4096ä¸ªTokençš„APIå°±ä¸å¤ªå¤Ÿç”¨äº†ã€‚

è¦è§£å†³è¿™ä¸ªé—®é¢˜ä¹Ÿå¹¶ä¸å›°éš¾ï¼Œæˆ‘ä»¬åªè¦è¿›è¡Œåˆ†æ®µå°ç»“ï¼Œå†å¯¹æ€»ç»“å‡ºæ¥çš„å†…å®¹å†åšä¸€æ¬¡å°ç»“å°±å¯ä»¥äº†ã€‚æˆ‘ä»¬å¯ä»¥æŠŠä¸€ç¯‡æ–‡ç« ï¼Œä¹ƒè‡³ä¸€æœ¬ä¹¦ï¼Œæ„å»ºæˆä¸€ä¸ªæ ‘çŠ¶çš„ç´¢å¼•ã€‚æ¯ä¸€ä¸ªæ ‘é‡Œé¢çš„èŠ‚ç‚¹ï¼Œå°±æ˜¯å®ƒçš„å­æ ‘ä¸‹å†…å®¹çš„æ‘˜è¦ã€‚æœ€åï¼Œåœ¨æ•´æ£µæ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œå¾—åˆ°çš„å°±æ˜¯æ•´ç¯‡æ–‡ç« æˆ–è€…æ•´æœ¬ä¹¦çš„æ€»ç»“äº†ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/49/42/49489cc171aee72855930aaf68112b42.jpg?wh=1820x1350 "é€šè¿‡å°†æ–‡æœ¬åˆ†ç‰‡å»ºç«‹æ ‘çŠ¶ç»“æ„çš„ç´¢å¼•æ¥å®Œæˆå…¨æ–‡çš„æ€»ç»“")

äº‹å®ä¸Šï¼Œllama-indexæœ¬èº«å°±å†…ç½®äº†è¿™æ ·çš„åŠŸèƒ½ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹è¦å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬çš„ä»£ç åº”è¯¥æ€ä¹ˆå†™ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ¥å®‰è£…ä¸€ä¸‹ spaCy è¿™ä¸ªPythonåº“ï¼Œå¹¶ä¸”ä¸‹è½½ä¸€ä¸‹å¯¹åº”çš„ä¸­æ–‡åˆ†è¯åˆ†å¥éœ€è¦çš„æ¨¡å‹ã€‚

```python
pip install spacy
python -m spacy download zh_core_web_sm
```

æ¥ä¸‹æ¥çš„ä»£ç å¾ˆç®€å•ï¼Œæˆ‘ä»¬é€‰ç”¨äº†GPTListIndexè¿™ä¸ªllama-indexé‡Œæœ€ç®€å•çš„ç´¢å¼•ç»“æ„ã€‚ä¸è¿‡æˆ‘ä»¬é’ˆå¯¹è‡ªèº«éœ€æ±‚åšäº†ä¸¤ç‚¹ä¼˜åŒ–ã€‚

é¦–å…ˆï¼Œåœ¨ç´¢å¼•é‡Œé¢ï¼Œæˆ‘ä»¬æŒ‡å®šäº†ä¸€ä¸ª LLMPredictorï¼Œè®©æˆ‘ä»¬å‘OpenAIå‘èµ·è¯·æ±‚çš„æ—¶å€™ï¼Œéƒ½ä½¿ç”¨ChatGPTçš„æ¨¡å‹ã€‚å› ä¸ºè¿™ä¸ªæ¨¡å‹æ¯”è¾ƒå¿«ï¼Œä¹Ÿæ¯”è¾ƒä¾¿å®œã€‚llama-indexé»˜è®¤ä½¿ç”¨çš„æ¨¡å‹æ˜¯text-davinci-003ï¼Œä»·æ ¼æ¯”gpt-3.5-turboè¦è´µä¸Šåå€ã€‚åœ¨æˆ‘ä»¬å‰é¢åªæ˜¯ç®€å•è¿›è¡Œå‡ è½®å¯¹è¯çš„æ—¶å€™ï¼Œè¿™ä¸ªä»·æ ¼å·®å¼‚è¿˜ä¸æ˜æ˜¾ã€‚è€Œå¦‚æœä½ è¦æŠŠå‡ åæœ¬ä¹¦éƒ½çŒè¿›å»ï¼Œé‚£æˆæœ¬ä¸Šå°±ä¼šå·®ä¸Šä¸å°‘äº†ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œï¼Œè®¾ç½®äº†æ¨¡å‹è¾“å‡ºçš„å†…å®¹éƒ½åœ¨1024ä¸ªTokenä»¥å†…ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿æˆ‘ä»¬çš„å°ç»“ä¸ä¼šå¤ªé•¿ï¼Œä¸ä¼šæŠŠä¸€å¤§æ®µä¸ç›¸å…³çš„å†…å®¹éƒ½åˆå¹¶åˆ°ä¸€èµ·å»ã€‚

å…¶æ¬¡ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä½¿ç”¨ SpacyTextSplitteræ¥è¿›è¡Œä¸­æ–‡æ–‡æœ¬çš„åˆ†å‰²ã€‚llama-indexé»˜è®¤çš„è®¾ç½®å¯¹äºä¸­æ–‡çš„æ”¯æŒå’Œæ•ˆæœéƒ½ä¸å¤ªå¥½ã€‚ä¸è¿‡å¥½åœ¨å®ƒå¯ä»¥è®©ä½ è‡ªå®šä¹‰ä½¿ç”¨çš„æ–‡æœ¬åˆ†å‰²æ–¹å¼ã€‚æˆ‘ä»¬é€‰ç”¨çš„æ–‡ç« æ˜¯ä¸­æ–‡çš„ï¼Œé‡Œé¢çš„æ ‡ç‚¹ç¬¦å·ä¹Ÿéƒ½æ˜¯ä¸­æ–‡çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ç”¨äº†ä¸­æ–‡çš„è¯­è¨€æ¨¡å‹ã€‚æˆ‘ä»¬ä¹Ÿé™åˆ¶äº†åˆ†å‰²å‡ºæ¥çš„æ–‡æœ¬æ®µï¼Œæœ€é•¿ä¸è¦è¶…è¿‡2048ä¸ªTokenï¼Œè¿™äº›å‚æ•°éƒ½å¯ä»¥æ ¹æ®ä½ å®é™…ç”¨æ¥å¤„ç†çš„æ–‡ç« å†…å®¹å’Œå±æ€§è‡ªå·±è®¾ç½®ã€‚

```python
from langchain.chat_models import ChatOpenAI
from langchain.text_splitter import SpacyTextSplitter
from llama_index import GPTListIndex, LLMPredictor, ServiceContext
from llama_index.node_parser import SimpleNodeParser

# define LLM
llm_predictor = LLMPredictor(llm=ChatOpenAI(temperature=0, model_name="gpt-3.5-turbo", max_tokens=1024))

text_splitter = SpacyTextSplitter(pipeline="zh_core_web_sm", chunk_size = 2048)
parser = SimpleNodeParser(text_splitter=text_splitter)
documents = SimpleDirectoryReader('./data/mr_fujino').load_data()
nodes = parser.get_nodes_from_documents(documents)

service_context = ServiceContext.from_defaults(llm_predictor=llm_predictor)

list_index = GPTListIndex(nodes=nodes, service_context=service_context)
```

è¾“å‡ºç»“æœï¼š

```python
WARNING:llama_index.llm_predictor.base:Unknown max input size for gpt-3.5-turbo, using defaults.
INFO:llama_index.token_counter.token_counter:> [build_index_from_nodes] Total LLM token usage: 0 tokens
INFO:llama_index.token_counter.token_counter:> [build_index_from_nodes] Total embedding token usage: 0 tokens
```

GPTListIndexåœ¨æ„å»ºç´¢å¼•çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šåˆ›å»ºEmbeddingï¼Œæ‰€ä»¥ç´¢å¼•åˆ›å»ºçš„æ—¶å€™å¾ˆå¿«ï¼Œä¹Ÿä¸æ¶ˆè€—Tokenæ•°é‡ã€‚å®ƒåªæ˜¯æ ¹æ®ä½ è®¾ç½®çš„ç´¢å¼•ç»“æ„å’Œåˆ†å‰²æ–¹å¼ï¼Œå»ºç«‹äº†ä¸€ä¸ªListçš„ç´¢å¼•ã€‚

æ¥ç€ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®©AIå¸®æˆ‘ä»¬å»å°ç»“è¿™ç¯‡æ–‡ç« äº†ã€‚åŒæ ·çš„ï¼Œæç¤ºè¯­æœ¬èº«å¾ˆé‡è¦ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯å¼ºè°ƒäº†æ–‡ç« å†…å®¹æ˜¯é²è¿…å…ˆç”Ÿä»¥â€œæˆ‘â€è¿™ä¸ªç¬¬ä¸€äººç§°å†™çš„ã€‚å› ä¸ºæˆ‘ä»¬æƒ³è¦çš„æ˜¯æŒ‰ç…§æ ‘çŠ¶ç»“æ„è¿›è¡Œæ–‡ç« çš„å°ç»“ï¼Œæ‰€ä»¥æˆ‘ä»¬è®¾å®šäº†ä¸€ä¸ªå‚æ•°ï¼Œå«åš response\_mode = â€œtree\_summarizeâ€ã€‚è¿™ä¸ªå‚æ•°ï¼Œå°±ä¼šæŒ‰ç…§ä¸Šé¢æˆ‘ä»¬æ‰€è¯´çš„æ ‘çŠ¶ç»“æ„æŠŠæ•´ä¸ªæ–‡ç« æ€»ç»“å‡ºæ¥ã€‚

å®é™…ä¸Šï¼Œå®ƒå°±æ˜¯å°†æ¯ä¸€æ®µæ–‡æœ¬åˆ†ç‰‡ï¼Œéƒ½é€šè¿‡queryå†…çš„æç¤ºè¯­å°ç»“ã€‚å†å¯¹å¤šä¸ªå°ç»“é‡Œçš„å†…å®¹ï¼Œå†æ¬¡é€šè¿‡queryé‡Œçš„æç¤ºè¯­ç»§ç»­å°ç»“ã€‚

```python
response = list_index.query("ä¸‹é¢é²è¿…å…ˆç”Ÿä»¥ç¬¬ä¸€äººç§°â€˜æˆ‘â€™å†™çš„å†…å®¹ï¼Œè¯·ä½ ç”¨ä¸­æ–‡æ€»ç»“ä¸€ä¸‹:", response_mode="tree_summarize")
print(response)
```

è¾“å‡ºç»“æœï¼š

```python
INFO:llama_index.indices.common_tree.base:> Building index from nodes: 2 chunks
INFO:llama_index.token_counter.token_counter:> [query] Total LLM token usage: 9787 tokens
INFO:llama_index.token_counter.token_counter:> [query] Total embedding token usage: 0 tokens
é²è¿…å…ˆç”Ÿå›å¿†äº†è‡ªå·±åœ¨æ—¥æœ¬å­¦åŒ»æœŸé—´çš„ç»å†ï¼Œæè¿°äº†è‡ªå·±åœ¨è§£å‰–å®ä¹ ä¸­çš„ç»å†ï¼Œä»¥åŠä¸æ•™æˆè—¤é‡å…ˆç”Ÿçš„äº¤å¾€ã€‚ä»–è¿˜æåˆ°äº†ä¸€äº›ä¸æ„‰å¿«çš„äº‹æƒ…ï¼Œæ¯”å¦‚é­åˆ°åŒå­¦çš„è¯½è°¤å’Œæ­§è§†ï¼Œä»¥åŠçœ‹åˆ°ä¸­å›½äººè¢«æªæ¯™æ—¶çš„æ„Ÿå—ã€‚æœ€åï¼Œä»–å‘Šè¯‰è—¤é‡å…ˆç”Ÿè‡ªå·±å°†ä¸å†å­¦åŒ»ï¼Œè€Œæ˜¯æƒ³å­¦ç”Ÿç‰©å­¦ã€‚ä»–æƒ³èµ·äº†ä¸€ä¸ªäººï¼Œè¿™ä¸ªäººæ˜¯ä»–çš„è€å¸ˆï¼Œä»–å¯¹é²è¿…å¾ˆçƒ­å¿ƒï¼Œç»™ä»–å¾ˆå¤šé¼“åŠ±å’Œæ•™è¯²ã€‚é²è¿…ç°åœ¨åªæœ‰ä»–çš„ç…§ç‰‡ï¼Œä½†æ˜¯æ¯æ¬¡çœ‹åˆ°ä»–çš„ç…§ç‰‡ï¼Œéƒ½ä¼šè®©ä»–æ„Ÿåˆ°å‹‡æ°”å’Œè‰¯å¿ƒå‘ç°ã€‚
```

å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åªç”¨äº†å‡ è¡Œä»£ç å°±å®Œæˆäº†æ•´ä¸ªæ–‡ç« çš„å°ç»“ï¼Œè¿”å›çš„ç»“æœæ•´ä½“ä¸Šæ¥è¯´ä¹Ÿè¿˜ç®—ä¸é”™ã€‚

## å¼•å…¥å¤šæ¨¡æ€ï¼Œè®©llamd-indexèƒ½å¤Ÿè¯†åˆ«å°ç¥¨

llama\_indexä¸å…‰èƒ½ç´¢å¼•æ–‡æœ¬ï¼Œå¾ˆå¤šä¹¦é‡Œé¢è¿˜æœ‰å›¾ç‰‡ã€æ’ç”»è¿™æ ·çš„ä¿¡æ¯ã€‚llama\_indexä¸€æ ·å¯ä»¥ç´¢å¼•èµ·æ¥ï¼Œä¾›ä½ æŸ¥è¯¢ï¼Œè¿™ä¹Ÿå°±æ˜¯æ‰€è°“çš„å¤šæ¨¡æ€èƒ½åŠ›ã€‚å½“ç„¶ï¼Œè¿™ä¸ªèƒ½åŠ›å…¶å®æ˜¯é€šè¿‡ä¸€äº›å¤šæ¨¡æ€çš„æ¨¡å‹ï¼ŒæŠŠæ–‡æœ¬å’Œå›¾ç‰‡èƒ½å¤Ÿè”ç³»åˆ°ä¸€èµ·åšåˆ°çš„ã€‚åœ¨æ•´ä¸ªè¯¾ç¨‹çš„ç¬¬ä¸‰éƒ¨åˆ†ï¼Œæˆ‘ä»¬ä¹Ÿä¼šä¸“é—¨æ¥çœ‹çœ‹è¿™äº›å›¾åƒçš„å¤šæ¨¡æ€æ¨¡å‹æ˜¯æ€ä¹ˆæ ·çš„ã€‚

è¿™é‡Œæˆ‘ä»¬å°±æ¥çœ‹ä¸€ä¸ªllama\_index[å®˜æ–¹æ ·ä¾‹åº“](https://github.com/jerryjliu/llama_index/blob/main/examples/multimodal/Multimodal.ipynb)é‡Œé¢ç»™åˆ°çš„ä¾‹å­ï¼Œä¹Ÿå°±æ˜¯æŠŠåƒé¥­çš„å°ç¥¨éƒ½æ‹ä¸‹æ¥ã€‚ç„¶åè¯¢é—®å“ªå¤©åƒäº†ä»€ä¹ˆï¼ŒèŠ±äº†å¤šå°‘é’±ã€‚

```python
from llama_index import SimpleDirectoryReader, GPTVectorStoreIndex
from llama_index.readers.file.base import DEFAULT_FILE_EXTRACTOR, ImageParser
from llama_index.response.notebook_utils import display_response, display_image
from llama_index.indices.query.query_transform.base import ImageOutputQueryTransform

image_parser = ImageParser(keep_image=True, parse_text=True)
file_extractor = DEFAULT_FILE_EXTRACTOR
file_extractor.update(
{
    ".jpg": image_parser,
    ".png": image_parser,
    ".jpeg": image_parser,
})

# NOTE: we add filename as metadata for all documents
filename_fn = lambda filename: {'file_name': filename}

receipt_reader = SimpleDirectoryReader(
    input_dir='./data/receipts', 
    file_extractor=file_extractor, 
    file_metadata=filename_fn,
)
receipt_documents = receipt_reader.load_data()
```

è¦èƒ½å¤Ÿç´¢å¼•å›¾ç‰‡ï¼Œæˆ‘ä»¬å¼•å…¥äº†ImageParserè¿™ä¸ªç±»ï¼Œè¿™ä¸ªç±»èƒŒåï¼Œå…¶å®æ˜¯ä¸€ä¸ªåŸºäºOCRæ‰«æçš„æ¨¡å‹ [Donut](https://huggingface.co/naver-clova-ix/donut-base-finetuned-cord-v2)ã€‚å®ƒé€šè¿‡ä¸€ä¸ªè§†è§‰çš„Encoderå’Œä¸€ä¸ªæ–‡æœ¬çš„Decoderï¼Œè¿™æ ·ä»»ä½•ä¸€ä¸ªå›¾ç‰‡èƒ½å¤Ÿå˜æˆä¸€ä¸ªä¸€æ®µæ–‡æœ¬ï¼Œç„¶åæˆ‘ä»¬å†é€šè¿‡OpenAIçš„EmbeddingæŠŠè¿™æ®µæ–‡æœ¬å˜æˆäº†ä¸€ä¸ªå‘é‡ã€‚

æˆ‘ä»¬ä»ç„¶åªéœ€è¦ä½¿ç”¨ç®€å•çš„SimpleDirectoryReaderï¼Œæˆ‘ä»¬é€šè¿‡æŒ‡å®šFileExtractorï¼Œä¼šæŠŠå¯¹åº”çš„å›¾ç‰‡é€šè¿‡ImageParserè§£ææˆä¸ºæ–‡æœ¬ï¼Œå¹¶æœ€ç»ˆæˆä¸ºå‘é‡æ¥ç”¨äºæ£€ç´¢ã€‚

ç„¶åï¼Œæˆ‘ä»¬ä»ç„¶åªéœ€è¦å‘æˆ‘ä»¬çš„ç´¢å¼•ç”¨è‡ªç„¶è¯­è¨€æé—®ï¼Œå°±èƒ½æ‰¾åˆ°å¯¹åº”çš„å›¾ç‰‡äº†ã€‚åœ¨æé—®çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸“é—¨åˆ¶å®šäº†ä¸€ä¸ªImageOutputQueryTransformï¼Œä¸»è¦æ˜¯ä¸ºäº†åœ¨è¾“å‡ºç»“æœçš„æ—¶å€™ï¼Œèƒ½å¤Ÿåœ¨å›¾ç‰‡å¤–åŠ ä¸Š `<img>` çš„æ ‡ç­¾æ–¹ä¾¿åœ¨Notebooké‡Œé¢æ˜¾ç¤ºã€‚

```python
receipts_index = GPTVectorStoreIndex.from_documents(receipt_documents)
receipts_response = receipts_index.query(
    'When was the last time I went to McDonald\'s and how much did I spend. \
    Also show me the receipt from my visit.',
    query_transform=ImageOutputQueryTransform(width=400)
)

display_response(receipts_response)
```

è¾“å‡ºç»“æœï¼š

```python
INFO:llama_index.token_counter.token_counter:> [query] Total LLM token usage: 1004 tokens
INFO:llama_index.token_counter.token_counter:> [query] Total embedding token usage: 30 tokens

Final Response:Â The last time you went to McDonald's was on 03/10/2018 at 07:39:12 PM and you spent $26.15. Here is the receipt from your visit:
```

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/18/08/181747bf1e95664b3929db6ec4a46b08.jpg?wh=750x1000)

å¯ä»¥çœ‹åˆ°ï¼Œç­”æ¡ˆä¸­ä¸ä»…æ˜¾ç¤ºå‡ºäº†å¯¹åº”çš„å›¾ç‰‡ï¼Œä¹Ÿç»™å‡ºäº†æ­£ç¡®çš„ç­”æ¡ˆï¼Œè¿™ä¹Ÿè¦å½’åŠŸäºOpenAIå¯¹äºä»»æ„æ–‡æœ¬å¼ºå¤§çš„å¤„ç†èƒ½åŠ›ã€‚

æˆ‘ä»¬å¯ä»¥å•ç‹¬è§£æä¸€ä¸‹å›¾ç‰‡ï¼Œçœ‹çœ‹å¯¹åº”çš„æ–‡æœ¬å†…å®¹æ˜¯ä»€ä¹ˆã€‚

```python
output_image = image_parser.parse_file('./data/receipts/1100-receipt.jpg')
print(output_image.text)
```

è¾“å‡ºç»“æœï¼š

```plain
<s_menu><s_nm> Story</s_nm><s_num> 16725 Stony Platin Rd</s_nm><s_num> Store#:</s_nm><s_num> 3659</s_num><s_price> 700-418-8362</s_price><sep/><s_nm> Welcome to all day breakfast dormist O Md Donald's</s_nm><s_num> 192</s_num><s_price> 192</s_price><sep/><s_nm> QTY ITEM</s_nm><s_num> OTAL</s_num><s_unitprice> 03/10/2018</s_unitprice><s_cnt> 1</s_cnt><s_price> 07:39:12 PM</s_price><sep/><s_nm> Delivery</s_nm><s_cnt> 1</s_cnt><s_price> 0.00</s_price><sep/><s_nm> 10 McNuggets EVM</s_nm><s_cnt> 1</s_cnt><s_price> 10.29</s_price><sep/><s_nm> Barbeque Sauce</s_nm><s_cnt> 1</s_cnt><s_price> 1</s_price><sep/><s_nm> Barbeque Sauce</s_nm><s_num> 1</s_cnt><s_price> 0.40</s_price><sep/><s_nm> L Coke</s_nm><s_cnt> 1</s_cnt><s_price> 0.40</s_price><sep/><s_nm> M French Fries</s_nm><s_cnt> 1</s_cnt><s_price> 3.99</s_price><sep/><s_nm> HM GrChS S-Fry Yog</s_nm><s_cnt> 1</s_cnt><sep/><s_nm> Smoonya</s_nm><s_cnt> 1</s_cnt><sep/><s_nm> HM Apple Juice</s_nm><s_cnt> 1</s_cnt><s_price> 2.89</s_price><sep/><s_nm> Cookies</s_nm><s_cnt> 6</s_cnt><s_price> 2.89</s_price><sep/><s_nm> Choc Chip Cookie</s_nm><s_cnt> 6</s_cnt><s_price> 1.19</s_price><sep/><s_nm> Baked Apple Pie</s_nm><s_cnt> 1</s_cnt><s_price> 3.29</s_price><sep/><s_nm> French Fries</s_nm><s_cnt> 1</s_cnt><s_price> 2.99</s_price><sep/><s_nm> Iced Tea</s_nm><s_cnt> 1</s_cnt><s_price> 2.99</s_price></s_menu><s_sub_total><s_subtotal_price> 25.04</s_subtotal_price><s_tax_price> 1.11</s_tax_price></s_sub_total><s_total><s_total_price> 26.15</s_total_price><s_changeprice> 0.00</s_changeprice><s_creditcardprice> 26.15</s_creditcardprice></s_total>



```

å¯ä»¥çœ‹åˆ°ï¼Œå¯¹åº”çš„å°±æ˜¯OCRåçš„æ–‡æœ¬ç»“æœï¼Œé‡Œé¢çš„ç¡®æœ‰å¯¹åº”æˆ‘ä»¬å»çš„åº—é“ºçš„åå­—å’Œæ—¶é—´ï¼Œä»¥åŠæ¶ˆè´¹çš„é‡‘é¢ã€‚

å›´ç»•OpenAIä»¥åŠæ•´ä¸ªå¤§è¯­è¨€æ¨¡å‹çš„ç”Ÿæ€è¿˜åœ¨å¿«é€Ÿå‘å±•ä¸­ï¼Œæ‰€ä»¥llama-indexè¿™ä¸ªåº“ä¹Ÿåœ¨å¿«é€Ÿè¿­ä»£ã€‚æˆ‘è‡ªå·±åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿé‡åˆ°å„ç§å„æ ·çš„å°Bugã€‚å¯¹äºä¸­æ–‡çš„æ”¯æŒä¹Ÿæœ‰å„ç§å„æ ·çš„å°ç¼ºé™·ã€‚ä¸è¿‡ï¼Œä½œä¸ºå¼€æºé¡¹ç›®ï¼Œå®ƒå·²ç»æœ‰ä¸€ä¸ªå¾ˆä¸é”™çš„ç”Ÿæ€äº†ï¼Œç‰¹åˆ«æ˜¯æä¾›äº†å¤§é‡çš„DataConnectorï¼Œæ—¢åŒ…æ‹¬PDFã€ePubè¿™æ ·çš„ç”µå­ä¹¦æ ¼å¼ï¼Œä¹ŸåŒ…æ‹¬YouTubeã€Notionã€MongoDBè¿™æ ·å¤–éƒ¨çš„æ•°æ®æºã€APIæ¥å…¥çš„æ•°æ®ï¼Œæˆ–è€…æ˜¯æœ¬åœ°æ•°æ®åº“çš„æ•°æ®ã€‚ä½ å¯ä»¥åœ¨ [llamahub.ai](https://llamahub.ai/) çœ‹åˆ°ç¤¾åŒºå¼€å‘å‡ºæ¥çš„è¯»å–å„ç§ä¸åŒæ•°æ®æºæ ¼å¼çš„DataConnectorã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/d1/91/d19d1dd9888785c85bbc3ac5aec08191.png?wh=1237x1029)

## å°ç»“

å¥½äº†ï¼Œç›¸ä¿¡ç»è¿‡è¿™ä¸€è®²ï¼Œä½ å·²ç»èƒ½å¤Ÿä¸Šæ‰‹ä½¿ç”¨llama-indexè¿™ä¸ªPythonåŒ…äº†ã€‚é€šè¿‡å®ƒï¼Œä½ å¯ä»¥å¿«é€Ÿå°†å¤–éƒ¨çš„èµ„æ–™åº“å˜æˆç´¢å¼•ï¼Œå¹¶ä¸”é€šè¿‡å®ƒæä¾›çš„queryæ¥å£å¿«é€Ÿå‘æ–‡æ¡£æé—®ï¼Œä¹Ÿèƒ½å¤Ÿé€šè¿‡å°†æ–‡æœ¬åˆ†ç‰‡ï¼Œå¹¶é€šè¿‡æ ‘çŠ¶çš„æ–¹å¼ç®¡ç†ç´¢å¼•å¹¶è¿›è¡Œå°ç»“ã€‚

llama-indexè¿˜æœ‰å¾ˆå¤šå…¶ä»–åŠŸèƒ½ï¼Œè¿™ä¸ªPythonåº“ä»ç„¶åœ¨å‘å±•è¿‡ç¨‹ä¸­ï¼Œä¸è¿‡å·²ç»éå¸¸å€¼å¾—æ‹¿æ¥ä½¿ç”¨ï¼ŒåŠ é€Ÿä½ å¼€å‘å¤§è¯­è¨€æ¨¡å‹ç±»çš„ç›¸å…³åº”ç”¨äº†ã€‚ç›¸å…³çš„æ–‡æ¡£ï¼Œå¯ä»¥åœ¨[å®˜ç½‘](https://gpt-index.readthedocs.io/en/latest/)çœ‹åˆ°ã€‚å¯¹åº”çš„ä»£ç ä¹Ÿæ˜¯å¼€æºçš„ï¼Œé‡åˆ°é—®é¢˜ä¹Ÿå¯ä»¥ç›´æ¥å»[æºä»£ç ](https://github.com/jerryjliu/gpt_index)é‡Œä¸€æ¢ç©¶ç«Ÿã€‚

llama-indexå…¶å®ç»™å‡ºäº†ä¸€ç§ä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹çš„è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ç§°ä¹‹ä¸ºâ€œç¬¬äºŒå¤§è„‘â€æ¨¡å¼ã€‚é€šè¿‡å…ˆå°†å¤–éƒ¨çš„èµ„æ–™åº“ç´¢å¼•ï¼Œç„¶åæ¯æ¬¡æé—®çš„æ—¶å€™ï¼Œå…ˆä»èµ„æ–™åº“é‡Œé€šè¿‡æœç´¢æ‰¾åˆ°æœ‰ç›¸å…³æ€§çš„ææ–™ï¼Œç„¶åå†é€šè¿‡AIçš„è¯­ä¹‰ç†è§£èƒ½åŠ›è®©AIåŸºäºæœç´¢åˆ°çš„ç»“æœæ¥å›ç­”é—®é¢˜ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/e4/6c/e4ae3fbeaa82d82e317dfcef40679f6c.jpg?wh=1896x1292)

å…¶ä¸­ï¼Œå‰ä¸¤æ­¥çš„ç´¢å¼•å’Œæœç´¢ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨OpenAIçš„Embeddingæ¥å£ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶å®ƒçš„å¤§è¯­è¨€æ¨¡å‹çš„Embeddingï¼Œæˆ–è€…ä¼ ç»Ÿçš„æ–‡æœ¬æœç´¢æŠ€æœ¯ã€‚åªæœ‰æœ€åä¸€æ­¥çš„é—®ç­”ï¼Œå¾€å¾€æ‰å¿…é¡»ä½¿ç”¨OpenAIçš„æ¥å£ã€‚æˆ‘ä»¬ä¸ä»…å¯ä»¥ç´¢å¼•æ–‡æœ¬ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–çš„æ¨¡å‹æ¥æŠŠå›¾ç‰‡å˜æˆæ–‡æœ¬è¿›è¡Œç´¢å¼•ï¼Œå®ç°æ‰€è°“çš„å¤šæ¨¡æ€åŠŸèƒ½ã€‚

å¸Œæœ›é€šè¿‡ä»Šå¤©çš„è¿™å‡ ä¸ªä¾‹å­ï¼Œä½ ä¹Ÿèƒ½å¼€å§‹å»ºç«‹èµ·è‡ªå·±çš„â€œç¬¬äºŒå¤§è„‘â€èµ„æ–™åº“ï¼Œèƒ½å¤Ÿå°†è‡ªå·±çš„æ•°æ®é›†äº¤ç»™AIè¿›è¡Œç´¢å¼•ï¼Œè·å¾—ä¸€ä¸ªä¸“å±äºä½ è‡ªå·±çš„AIã€‚

## è¯¾åç»ƒä¹ 

1. llama-indexçš„ç”Ÿæ€ï¼Œä¸ä»…æ”¯æŒå„ç§å„æ ·çš„DataConnectorå»åŠ è½½æ•°æ®ï¼Œåç«¯ä¹Ÿæ”¯æŒå„ç§å½¢å¼çš„ç´¢å¼•ï¼Œæ¯”å¦‚åœ¨è¯­ä¹‰æœç´¢é‡Œé¢æˆ‘ä»¬ä»‹ç»è¿‡çš„ Faissã€Pineconeã€Weaviate å®ƒéƒ½æ˜¯æ”¯æŒçš„ã€‚é™¤äº†è¿™äº›ä¹‹å¤–ï¼Œä½ èƒ½çœ‹çœ‹ llama-index è¿˜æœ‰å“ªäº›å½¢å¼çš„ç´¢å¼•å—ï¼Ÿé™¤äº†è¿›è¡Œé—®ç­”å’Œæ–‡ç« æ¦‚æ‹¬ä¹‹å¤–ï¼Œä½ è§‰å¾—è¿™ä¸ªåº“è¿˜èƒ½å¸®åŠ©æˆ‘ä»¬åšä»€ä¹ˆäº‹æƒ…ï¼Ÿ
2. ç°åœ¨æœ‰å¾ˆå¤šåº”ç”¨ï¼Œåœ¨ä½ æŠŠæ–‡æ¡£ä¸Šä¼ ä¹‹åï¼Œè¿˜ä¼šç»™ä½ ä¸€ç³»åˆ—çš„æç¤ºï¼Œå‘Šè¯‰ä½ å¯ä»¥å‘å¯¹åº”çš„ä¹¦æˆ–è€…è®ºæ–‡é—®ä»€ä¹ˆé—®é¢˜ã€‚æ¯”å¦‚ [SCISPACE](https://scispace.com/)ï¼Œä½ èƒ½æƒ³æƒ³è¿™äº›é—®é¢˜æ˜¯æ€ä¹ˆæ¥çš„å—ï¼Ÿ

æœŸå¾…èƒ½åœ¨è¯„è®ºåŒºçœ‹åˆ°ä½ çš„åˆ†äº«ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™æ„Ÿå…´è¶£çš„æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹ä¸€è®²å†è§ã€‚

## æ¨èé˜…è¯»

llama-indexçš„åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œå¹¶ä¸”æºä»£ç é‡Œä¹Ÿä¸“é—¨æä¾›äº†ç¤ºä¾‹éƒ¨åˆ†ã€‚ä½ å¯ä»¥å»çœ‹ä¸€ä¸‹å®ƒçš„å®˜æ–¹æ–‡æ¡£ä»¥åŠç¤ºä¾‹ï¼Œäº†è§£å®ƒå¯ä»¥ç”¨æ¥å¹²ä»€ä¹ˆã€‚

1. å®˜æ–¹æ–‡æ¡£ï¼š[https://gpt-index.readthedocs.io/en/latest/](https://gpt-index.readthedocs.io/en/latest/)
2. æºç ä»¥åŠç¤ºä¾‹ï¼š[https://github.com/jerryjliu/llama\_index](https://github.com/jerryjliu/llama_index)
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ15ï¼‰</strong></div><ul>
<li><span>Owen</span> ğŸ‘ï¼ˆ7ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>æˆªæ­¢åˆ°ç›®å‰ï¼Œæœ€æ–°èƒ½è¿è¡Œçš„ä»£ç 

&#39;&#39;&#39;
å½’çº³æ€»ç»“æ–‡ç« å†…å®¹
&#39;&#39;&#39;
from langchain.chat_models import ChatOpenAI
from langchain.text_splitter import SpacyTextSplitter
from llama_index.core import SummaryIndex, ServiceContext, SimpleDirectoryReader
from llama_index.core.node_parser import SentenceSplitter

documents = SimpleDirectoryReader(input_dir=&quot;data&quot;).load_data() # åªèƒ½å¡«å†™æ–‡ä»¶å¤¹ï¼Œä¸èƒ½å…·ä½“åˆ°æ–‡ä»¶

service_context = ServiceContext.from_defaults(
    llm=ChatOpenAI(temperature=0, model_name=&quot;gpt-3.5-turbo&quot;, max_tokens=1000, n=1),
    node_parser=SentenceSplitter(chunk_size=512, chunk_overlap=20),
)

index = SummaryIndex.from_documents(documents = documents, service_context = service_context)
query_engine = index.as_query_engine()
response = query_engine.query(&quot;ç”¨ä¸­æ–‡æ€»ç»“è¿™ä¸ªæ•…äº‹&quot;)

print(response)</p>2024-03-01</li><br/><li><span>Penguin Shi</span> ğŸ‘ï¼ˆ7ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>ã€Šè—¤é‡å…ˆç”Ÿã€‹è¾“å‡ºæ‘˜è¦çš„ä»£ç ï¼Œå› ä¸ºä»£ç æ›´æ–°ï¼Œæœ‰bugï¼Œå‚è€ƒhttps:&#47;&#47;gpt-index.readthedocs.io&#47;en&#47;latest&#47;guides&#47;primer&#47;usage_pattern.htmlæ›´æ–°ä»£ç å¦‚ä¸‹ï¼š

from langchain.chat_models import ChatOpenAI
from langchain.text_splitter import SpacyTextSplitter
from llama_index import ListIndex, LLMPredictor, ServiceContext
from llama_index import (
    VectorStoreIndex,
    get_response_synthesizer,
)
from llama_index.retrievers import VectorIndexRetriever
from llama_index.query_engine import RetrieverQueryEngine
from llama_index.node_parser import SimpleNodeParser

# define LLM
llm_predictor = LLMPredictor(llm=ChatOpenAI(temperature=0, model_name=&quot;gpt-3.5-turbo&quot;, max_tokens=1024))

text_splitter = SpacyTextSplitter(pipeline=&quot;zh_core_web_sm&quot;, chunk_size = 2048)
parser = SimpleNodeParser(text_splitter=text_splitter)
documents = SimpleDirectoryReader(&#39;.&#47;data&#47;mr_fujino&#39;).load_data()

index = ListIndex.from_documents(documents)
retriever = index.as_retriever()

query_engine = RetrieverQueryEngine.from_args(retriever, response_mode=&#39;tree_summarize&#39;)
response = query_engine.query(&quot;ä¸‹é¢é²è¿…å…ˆç”Ÿä»¥ç¬¬ä¸€äººç§°â€˜æˆ‘â€™å†™çš„å†…å®¹ï¼Œè¯·ä½ ç”¨ä¸­æ–‡æ€»ç»“ä¸€ä¸‹:&quot;)

print(response)

å¦ç›®å‰æ–‡æ¡£ä¸­ï¼Œ&quot;æˆ‘æŠŠä»ç½‘ä¸Šæ‰¾åˆ°çš„ã€Šè—¤é‡å…ˆç”Ÿã€‹è¿™ç¯‡æ–‡ç« å˜æˆäº†ä¸€ä¸ª txt æ–‡ä»¶ï¼Œæ”¾åœ¨äº† data&#47;mr_fujino è¿™ä¸ªç›®å½•ä¸‹ã€‚æˆ‘ä»¬çš„ä»£ç ä¹Ÿéå¸¸ç®€å•ï¼Œä¸€å…±æ²¡æœ‰å‡ è¡Œã€‚&quot;æ­¤æ–‡å­—ä¸‹æ–¹ä»£ç çš„ï¼Œç¬¬7è¡Œï¼Œindex = GPTSimpleVectorIndex.from_documents(documents)ä¸­ï¼Œâ€œGPTSimpleVectorIndexâ€è¿˜æœªæ”¹æˆâ€œGPTVectorStoreIndexâ€ ï¼›ç¬¬9è¡Œï¼Œæ›´æ”¹ä¸ºindex.storage_context.persist(&#39;index_mr_fujino&#39;)ã€‚
è¯·æ›´æ”¹ï¼Œæ–¹ä¾¿åç»­åŒå­¦å­¦ä¹ å¹¶è¿è¡Œä»£ç ã€‚</p>2023-07-09</li><br/><li><span>Wise</span> ğŸ‘ï¼ˆ20ï¼‰ ğŸ’¬ï¼ˆ5ï¼‰<p>åœ¨llama_index V0.6.1 ç‰ˆæœ¬ä¸­ï¼Œæ²¡æœ‰GPTSimpleVectorIndex ç±»äº†
import openai, os
from llama_index import GPTVectorStoreIndex, SimpleDirectoryReader
os.environ[&quot;OPENAI_API_KEY&quot;] = &#39;&#39;
# åŠ è½½ documents
documents = SimpleDirectoryReader(&#39;.&#47;data&#47;mr_fujino&#39;).load_data()
index = GPTVectorStoreIndex.from_documents(documents)
index.storage_context.persist(&#39;index_mr_fujino&#39;)

# ä»ç£ç›˜é‡æ–°åŠ è½½ï¼š
from llama_index import StorageContext, load_index_from_storage
# rebuild storage context
storage_context = StorageContext.from_defaults(persist_dir=&quot;.&#47;index_mr_fujino&quot;)
# load index
index = load_index_from_storage(storage_context)
query_engine = index.as_query_engine()
response = query_engine.query(&quot;é²è¿…å…ˆç”Ÿåœ¨æ—¥æœ¬å­¦ä¹ åŒ»å­¦çš„è€å¸ˆæ˜¯è°ï¼Ÿ&quot;)
print(response)

å‚è€ƒå®˜æ–¹æ–‡æ¡£è¿æ¥ï¼šhttps:&#47;&#47;gpt-index.readthedocs.io&#47;en&#47;latest&#47;getting_started&#47;starter_example.html</p>2023-05-07</li><br/><li><span>hello</span> ğŸ‘ï¼ˆ15ï¼‰ ğŸ’¬ï¼ˆ4ï¼‰<p>æƒ³è¯·æ•™ä¸‹è€å¸ˆï¼Œæˆ‘ä»¬å–‚çš„è¯­æ–™ï¼Œä¼šè¢«å…¶ä»–äººçœ‹åˆ°ä½¿ç”¨å—ï¼Ÿ</p>2023-04-06</li><br/><li><span>daz2yy</span> ğŸ‘ï¼ˆ11ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆï¼Œè¯·é—®ä¸‹ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘æŠŠå®ƒç”¨ä½œ QA ç³»ç»Ÿçš„æ—¶å€™æœ‰ä¸ªé—®é¢˜ï¼ŒåŸæœ¬ QA å°±æœ‰æ ‡å‡†çš„å›ç­”æ¨¡ç‰ˆï¼Œé‡Œé¢åŒ…æ‹¬æœ‰æ–‡æ¡£åœ°å€ã€æ“ä½œæ­¥éª¤ç­‰ï¼›å¦‚æœè®© GPT æ ¹æ®è¿™ä¸ªæ¨¡ç‰ˆæ¥å›ç­”é—®é¢˜ï¼Œä»–ä¼šè‡ªç”±å‘æŒ¥ï¼Œä¼šæ¼æ‰ä¸€éƒ¨åˆ†å†…å®¹ï¼›æƒ³æ‹¥æœ‰ AI è‡ªç”±å¯¹è¯çš„èƒ½åŠ›ï¼Œåˆæƒ³æœ‰å›ºå®šçš„å›ç­”æ¨¡ç‰ˆè¿™ä¸ªæ€ä¹ˆèƒ½è¾ƒå¥½çš„å…¼é¡¾å‘¢ï¼Ÿ</p>2023-04-04</li><br/><li><span>Terry</span> ğŸ‘ï¼ˆ8ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>è€å¸ˆï¼Œè¯·æ•™ä¸€ä¸‹langchainæˆ‘ç†è§£ä¹Ÿæ˜¯ä¸€ä¸ªLLMåº”ç”¨æ¡†æ¶ï¼Œå®ƒçš„åŠŸèƒ½å’Œç‰ˆæœ¬ä¹Ÿæ›´æ–°å¾ˆå¿«ã€‚å®ƒå’Œllama_indexçš„åŒºåˆ†æ˜¯ä»€ä¹ˆï¼Ÿåœ¨LLMåº”ç”¨å¼€å‘ä¸Šï¼Œæˆ‘ä»¬ä¸€èˆ¬æ€ä¹ˆé€‰æ‹©ä¼šæ¯”è¾ƒå¥½ï¼Ÿ</p>2023-04-25</li><br/><li><span>é©¬å¬</span> ğŸ‘ï¼ˆ8ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<p>åˆ†äº«ä¸€ä¸ªåŠ è½½MySQLæ•°æ®çš„ä¾‹å­ï¼š
from llama_index import GPTSimpleVectorIndex,download_loader

DatabaseReader = download_loader(&#39;DatabaseReader&#39;)

reader = DatabaseReader(
    scheme = &quot;mysql&quot;, # Database Scheme
    host = &quot;localhost&quot;, # Database Host
    port = &quot;3306&quot;, # Database Port
    user = &quot;martin&quot;, # Database User
    password = &quot;xxxxxx&quot;, # Database Password
    dbname = &quot;martin&quot;, # Database Name
)

query = f&quot;&quot;&quot;
select * from student_info
&quot;&quot;&quot;

documents = reader.load_data(query=query)
print(documents)</p>2023-04-12</li><br/><li><span>Oxygen Au æ˜•</span> ğŸ‘ï¼ˆ6ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>
response = list_index.query(&quot;ä¸‹é¢é²è¿…å…ˆç”Ÿä»¥ç¬¬ä¸€äººç§°â€˜æˆ‘â€™å†™çš„å†…å®¹ï¼Œè¯·ä½ ç”¨ä¸­æ–‡æ€»ç»“ä¸€ä¸‹:&quot;, response_mode=&quot;tree_summarize&quot;)
print(response)


ä¸Šé¢è¿™æ®µä»£ç æŠ¥é”™ï¼ŒAttributeError: &#39;GPTListIndex&#39; object has no attribute &#39;query&#39; ï¼Œ æˆ‘ç”¨çš„æ˜¯llama-index 0.6.1

ä¸‹é¢æ˜¯æ­£ç¡®çš„ä»£ç 
query_engine = list_index.as_query_engine(response_mode=&quot;tree_summarize&quot;)
response = query_engine.query(&quot;ä¸‹é¢é²è¿…å…ˆç”Ÿä»¥ç¬¬ä¸€äººç§°â€˜æˆ‘â€™å†™çš„å†…å®¹ï¼Œè¯·ä½ ç”¨ä¸­æ–‡æ€»ç»“ä¸€ä¸‹:&quot;)
print(response)

ç»“æœï¼š é²è¿…å…ˆç”Ÿåœ¨æ—¥æœ¬å­¦ä¹ åŒ»å­¦æ—¶é‡åˆ°äº†è—¤é‡ä¸¥ä¹éƒæ•™æˆï¼Œä»–å¾ˆæœ‰å­¦é—®ï¼Œå¯¹å­¦ç”Ÿä¹Ÿå¾ˆå…³å¿ƒï¼Œç”šè‡³å¸®åŠ©é²è¿…ä¿®æ”¹è®²ä¹‰ã€‚ä½†é²è¿…å½“æ—¶ä¸å¤Ÿç”¨åŠŸï¼Œæœ‰æ—¶ä¹Ÿå¾ˆä»»æ€§ã€‚åœ¨å­¦ä¹ ä¸­ï¼Œä»–é‡åˆ°äº†ä¸€äº›å›°éš¾å’Œä¸æ„‰å¿«çš„äº‹æƒ…ï¼Œæœ€ç»ˆå†³å®šç¦»å¼€åŒ»å­¦å»å­¦ä¹ ç”Ÿç‰©å­¦ã€‚ç¦»å¼€å‰ï¼Œè—¤é‡å…ˆç”Ÿé€ç»™ä»–ä¸€å¼ ç…§ç‰‡ï¼Œå¹¶å¸Œæœ›ä»–èƒ½ä¿æŒè”ç³»ã€‚é²è¿…å¾ˆä¹…æ²¡æœ‰å’Œä»»ä½•äººé€šä¿¡ï¼Œä½†æƒ³èµ·äº†è¿™ä½çƒ­å¿ƒçš„è€å¸ˆï¼Œä»–çš„ç…§ç‰‡æŒ‚åœ¨é²è¿…çš„æˆ¿é—´é‡Œï¼Œæ¯å½“ä»–ç–²å€¦æ—¶çœ‹åˆ°ç…§ç‰‡å°±ä¼šæ„Ÿåˆ°å‹‡æ°”å’Œè‰¯å¿ƒå‘ç°ã€‚</p>2023-05-09</li><br/><li><span>é»„æ™ºè£</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>ç°åœ¨æœ‰å¾ˆå¤šåº”ç”¨ï¼Œåœ¨ä½ æŠŠæ–‡æ¡£ä¸Šä¼ ä¹‹åï¼Œè¿˜ä¼šç»™ä½ ä¸€ç³»åˆ—çš„æç¤ºï¼Œå‘Šè¯‰ä½ å¯ä»¥å‘å¯¹åº”çš„ä¹¦æˆ–è€…è®ºæ–‡é—®ä»€ä¹ˆé—®é¢˜ã€‚
------ å¯ä»¥æ ¹æ®ç´¢å¼•çš„æ–‡æœ¬ï¼Œè®©chatgpt è®¾è®¡å‡ ä¸ªæé—®çš„é—®é¢˜</p>2023-05-16</li><br/><li><span>å‹‡.Max</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<p>ä¸Šé¢from llama_index import GPTSimpleVectorIndexä¼šæŠ¥é”™ï¼Œå› ä¸ºç°åœ¨å·²ç»æ”¹æˆäº†GPTVectorStoreIndexã€‚
from llama_index import GPTVectorStoreIndex &#47;&#47;è€å¸ˆçœ‹åˆ°åå¯ä»¥æ›´æ–°ä¸‹
</p>2023-05-08</li><br/><li><span>Viola</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p> æœ‰åŒå­¦é‡åˆ°å—ï¼Ÿ
type object &#39;GPTSimpleVectorIndex&#39; has no attribute &#39;from_documents&#39;</p>2023-04-05</li><br/><li><span>hawk</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ3ï¼‰<p>è¿™äº›é¢„é€‰çš„é—®é¢˜ï¼Œåº”è¯¥ä¹Ÿæ˜¯é€šè¿‡ç»„åˆç‰¹å®šçš„æç¤ºè¯­ï¼Œå’Œæ®µè½æ‘˜è¦ï¼Œæ‰”ç»™GPTå¾—åˆ°çš„å§ï¼Ÿ</p>2023-04-04</li><br/><li><span>ç‰›å‘³æµ“é¾™é­æµ</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>æ‰€ä»¥llama_indexè·ŸchatGPTæ²¡ä»€ä¹ˆå…³ç³»æ˜¯å—ã€‚ã€‚è¿˜æ˜¯è¯´è¿™ä¸ªåŒ…æœ¬èº«ä¹Ÿåœ¨è·ŸopenAIæ‰“äº¤é“ï¼Œçœ‹ä»£ç çœ‹ä¸å‡ºæ¥</p>2023-05-15</li><br/><li><span>ä¸œä¸´æ²§æµ·</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<p>å»ºè®®è€å¸ˆå®‰è£…çš„åº“æ–‡ä»¶æ ‡æ˜ä¸€ä¸‹ç‰ˆæœ¬å·ï¼Œé‡åˆ°è¿™æ ·é—®é¢˜å¥½å‡ æ¬¡äº†ï¼Œæ¯æ¬¡éƒ½è¦æµªè´¹å¤§é‡æ—¶é—´ã€‚
llama_indexç‰ˆæœ¬éƒ½åˆ°v0.6.5ï¼Œæ›´æ–°å¤ªå¿«äº†</p>2023-05-11</li><br/><li><span>snow</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<p>æƒ³è¯·æ•™ä¸‹è€å¸ˆï¼Œä¸ºä»€ä¹ˆæˆ‘åœ¨è°ƒç”¨query çš„æ—¶å€™ï¼Œæç¤ºè¯´BaseQueryEngine.query() got an unexpected keyword argument &#39;response_mode&#39; ï¼Ÿ  å‘ç°å½“å®šä¹‰ list_index = GPTListIndex(nodes=nodes, service_context=service_context)ï¼Œ æ²¡æ³•ç›´æ¥è°ƒç”¨list_index.query() ,è€Œéœ€è¦  list_index.as_query_engine().query() è¿™æ ·å­è°ƒç”¨ã€‚ </p>2023-05-09</li><br/>
</ul>