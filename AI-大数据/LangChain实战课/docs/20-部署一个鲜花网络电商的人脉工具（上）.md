ä½ å¥½ï¼Œæˆ‘æ˜¯é»„ä½³ï¼Œæ¬¢è¿æ¥åˆ°LangChainå®æˆ˜è¯¾ï¼

ä»ä»Šå¤©å¼€å§‹ï¼Œæˆ‘è¦ç”¨4èŠ‚è¯¾çš„ç¯‡å¹…ï¼Œå¸¦ç€ä½ è®¾è®¡ä¸¤ä¸ªæœ‰è¶£è€Œåˆå®ç”¨çš„åº”ç”¨ç¨‹åºã€‚è®¾è®¡è¿™ä¸¤ä¸ªåº”ç”¨ç¨‹åºçš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†è®©ä½ èƒ½å¤ŸæŠŠLangChainä¸­çš„å„ä¸ªç»„ä»¶çµæ´»åœ°ç»„åˆèµ·æ¥ï¼Œèä¼šè´¯é€šï¼Œå¹¶ä»¥æ­¤ä½œä¸ºå¯å‘ï¼Œåœ¨ä½ ç†Ÿæ‚‰çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œåˆ©ç”¨LangChainå’ŒLLMçš„èƒ½åŠ›ï¼Œå¼€å‘å‡ºæ›´å¤šã€æ›´å¼ºå¤§çš„æ•ˆç‡å·¥å…·ã€‚

ç¬¬ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œæ˜¯ç”¨LangChainåˆ›å»ºå‡ºä¸€ä¸ªä¸“å±äºâ€œæ˜“é€Ÿé²œèŠ±â€çš„ç½‘ç»œäººè„‰å·¥å…·ã€‚å…‰è¿™ä¹ˆè¯´ï¼Œæœ‰äº›æ¨¡ç³Šï¼Œè¿™ä¸ªäººè„‰å·¥å…·é•¿å•¥æ ·ï¼Ÿæœ‰äº›å•¥å…·ä½“åŠŸèƒ½ï¼Ÿ

åŠ¨æ‰‹ä¹‹å‰ï¼Œè®©æˆ‘å…ˆç»™ä½ æŠŠè¿™ä¸ªæ‰€è°“â€œäººè„‰â€å·¥å…·çš„èƒ½åŠ›å’Œç»†èŠ‚è¯´æ¸…æ¥šã€‚

## â€œäººè„‰å·¥å…·â€é¡¹ç›®è¯´æ˜

**é¡¹ç›®èƒŒæ™¯**ï¼šæ˜“é€Ÿé²œèŠ±ç”µå•†ç½‘ç»œè‡ªä»åˆ›å»ºä»¥æ¥ï¼Œé€šè¿‡å¾®ä¿¡ã€æŠ–éŸ³ã€å°çº¢ä¹¦ç­‰è‡ªåª’ä½“å®£ä¼ æ¨å¹¿ï¼ŒçŸ­æœŸå†…è·å¾—äº†å¹¿æ³›æµé‡å±•ç¤ºã€‚ç›®å‰ï¼Œè¥é”€éƒ¨é—¨å¸Œæœ›ä»¥æ­¤ä¸ºå¥‘æœºï¼Œå†æ¥å†å‰ï¼Œç»§ç»­æ‰©å¤§å“ç‰Œå½±å“åŠ›ã€‚ç»è¿‡è°ƒç ”ï¼Œå‘ç°å¾ˆå¤šç”¨æˆ·ä¼šé€šè¿‡å¾®åšçƒ­æœæ¨èçš„æ–°é—»æ¥è´­ä¹°é²œèŠ±èµ é€ç»™æ˜æ˜Ÿã€è¾¾äººç­‰ï¼Œå› æ­¤å„éƒ¨é—¨ä¸€è‡´è®¤ä¸ºåº”è¯¥è”ç»œç›¸å…³å¾®åšå¤§Vï¼Œå…±åŒæ¨å¹¿ï¼Œå¸¦åŠ¨å“ç‰Œæˆé•¿ã€‚

ç„¶è€Œï¼Œå‘æ˜å¹¶é€‰æ‹©é€‚åˆäºâ€œé²œèŠ±æ¨å¹¿â€çš„å¾®åšå¤§Væœ‰ä¸€å®šéš¾åº¦ã€‚è¥é”€éƒ¨é—¨å‘˜å·¥è¡¨ç¤ºï¼Œè¿™ä¸ªä»»åŠ¡æ¯”æ‰¾å¾®ä¿¡ã€æŠ–éŸ³å’Œå°çº¢ä¹¦è¾¾äººè¦éš¾å¾—å¤šã€‚ä»–ä»¬éƒ½å¸Œæœ›æŠ€æœ¯éƒ¨é—¨èƒ½å¤Ÿç»™å‡ºä¸€ä¸ªâ€œäººè„‰æœç´¢å·¥å…·â€æ¥ååŠ©å®Œæˆè¿™ä¸€ç›®æ ‡ã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ6ï¼‰</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/ff/67/6ffe3a52.jpg" width="30px"><span>é©¬é‡Œå¥¥çš„é©¬é‡Œå¥¥</span> ğŸ‘ï¼ˆ2ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>2ä¸ªé—®é¢˜
1.è™½ç„¶ä¿®æ”¹äº†è·å–linkçš„æ–¹å¼ï¼Œä¾ç„¶æ˜¯ä¼šæœ‰é”™è¯¯ï¼Œåœ¨æˆ‘è¿™é‡Œè§£æåˆ°çš„æ˜¯ https:&#47;&#47;weibo.com&#47;p&#47;xxxåçš„è¿™ä¸ªxxæ•°å­—ï¼›
2.æˆ‘å°è¯•ä¿®æ”¹æç¤ºè¯ï¼Œåªæœç´¢ç²‰ä¸è¶…è¿‡ä¸€ç™¾ä¸‡çš„è´¦å·ï¼Œä¼¼ä¹ä¹Ÿä¸ç”Ÿæ•ˆã€‚</div>2023-12-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/d4/1b/6444e933.jpg" width="30px"><span>Liberalism</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>åœ¨çˆ¬å–å¾®åšç”¨æˆ·èµ„æ–™æ—¶æŠ¥ 400 é”™è¯¯ï¼Œè¯·é—®æ˜¯å“ªé‡Œå‡ºäº†é—®é¢˜ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ

def scrape_weibo(url: str):
    &quot;&quot;&quot;çˆ¬å–ç›¸å…³é²œèŠ±æœåŠ¡å•†çš„èµ„æ–™&quot;&quot;&quot;
    headers = {
        &quot;User-Agent&quot;: &quot;Mozilla&#47;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#47;537.36 (KHTML, like Gecko) &quot;
                      &quot;Chrome&#47;89.0.4389.82 Safari&#47;537.36&quot;,
        &quot;Referer&quot;: &quot;https:&#47;&#47;weibo.com&quot;}
    cookies = {
        &quot;cookie&quot;: &#39;&#39;&#39;SINAGLOBAL=6620500101466.929.1684124696145; 
        ULV=1701318517344:5:1:1:2994044278409.513.1701318517342:1695626334231; 
        SUB=_2A25IbH_LDeRhGedJ71EX9C3Kwz6IHXVrAP0DrDV8PUNbmtAGLWP8kW9NVhncgwwKDAJC-BEIEyWCj9aAZiYRqGGn; 
        SUBP=0033WrSXqPxfM725Ws9jqgMF55529P9D9WF1hJoCEpSf.bqAJzfD-UMO5JpX5KzhUgL.Fo2NShecShec1hz2dJLoI7peIgiLMJ8jIPS_qgRt; 
        ALF=1732854554; XSRF-TOKEN=Dr6hVUuVr5JfuRn3NHntHjk7; 
        WBPSESS=qWBqMfNAAnlnO3TmyuUMG1qvHg86Rz2Zv7YHVRzN1MJAsJSyBhxx0_AUvWsjCUhaTWJpEmAC3UJ6u4OKi_zznpkRnRQ8ciUPXXDldaaw58i1fvBUm_1oDKnjo6sGr9qeK-zdbnLVltKplYXJysV88A==&#39;&#39;&#39;
    }
    response = requests.get(url, headers=headers, cookies=cookies)

    time.sleep(3)  # åŠ ä¸Š3s çš„å»¶æ—¶é˜²æ­¢è¢«åçˆ¬
    return response.text</div>2023-12-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/d4/1b/6444e933.jpg" width="30px"><span>Liberalism</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>def scrape_weibo(url: str):
    &quot;&quot;&quot;çˆ¬å–ç›¸å…³é²œèŠ±æœåŠ¡å•†çš„èµ„æ–™&quot;&quot;&quot;
    headers = {
        &#39;Accept&#39;: &#39;text&#47;html,application&#47;xhtml+xml,application&#47;xml;q=0.9,image&#47;webp,*&#47;*;q=0.8&#39;,
        &#39;Cache-Control&#39;: &#39;max-age=0&#39;,
        &#39;Connection&#39;: &#39;keep-alive&#39;,
        &#39;Referer&#39;: &#39;http:&#47;&#47;www.baidu.com&#47;&#39;,
        &#39;User-Agent&#39;: &#39;Mozilla&#47;5.0 (Windows NT 6.1; WOW64) AppleWebKit&#47;537.36 (KHTML, like Gecko)&#39;
    }
    cookies = {
        &quot;cookie&quot;: &#39;&#39;&#39;SINAGLOBAL=6620500101466.929.1684124696145; 
        ULV=1701318517344:5:1:1:2994044278409.513.1701318517342:1695626334231; 
        SUB=_2A25IbH_LDeRhGedJ71EX9C3Kwz6IHXVrAP0DrDV8PUNbmtAGLWP8kW9NVhncgwwKDAJC-BEIEyWCj9aAZiYRqGGn; 
        SUBP=0033WrSXqPxfM725Ws9jqgMF55529P9D9WF1hJoCEpSf.bqAJzfD-UMO5JpX5KzhUgL.Fo2NShecShec1hz2dJLoI7peIgiLMJ8jIPS_qgRt; 
        ALF=1732854554; XSRF-TOKEN=Dr6hVUuVr5JfuRn3NHntHjk7; 
        WBPSESS=qWBqMfNAAnlnO3TmyuUMG1qvHg86Rz2Zv7YHVRzN1MJAsJSyBhxx0_AUvWsjCUhaTWJpEmAC3UJ6u4OKi_zznpkRnRQ8ciUPXXDldaaw58i1fvBUm_1oDKnjo6sGr9qeK-zdbnLVltKplYXJysV88A==&#39;&#39;&#39;
    }
    response = requests.get(url, headers=headers, cookies=cookies)

    time.sleep(3)  # åŠ ä¸Š3s çš„å»¶æ—¶é˜²æ­¢è¢«åçˆ¬
    return response.text


çˆ¬å–æ•°æ®è¿™é‡Œä¸€ç›´æŠ¥é”™  400 </div>2023-12-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/62/b8/0e1b655e.jpg" width="30px"><span>fireshort</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>é»„è€å¸ˆï¼Œè¿™é‡Œçš„Agentæ„Ÿè§‰æ²¡æœ‰å‘æŒ¥ä½œç”¨ï¼Œæ²¡æœ‰å¤ªå¤šæ™ºèƒ½ï¼ŒLLMå°±åŠ äº†â€œå¾®åšâ€å»æœç´¢ã€‚
ID = agent.run(prompt_template.format_prompt(flower=flower_type))
æ”¹æˆ
ID = get_UID(flower_type+&quot; å¾®åš&quot;)
å¾—åˆ°ä¸€æ ·çš„ç»“æœã€‚


</div>2023-11-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/eb/37/a2f4c9f8.jpg" width="30px"><span>starj</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>githubä¸Šæ²¡æœ‰ä»£ç ï¼Ÿ</div>2023-10-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ba/1f/7551f182.jpg" width="30px"><span>å“ä¸îŒ®îŒ®</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>æˆ‘é‡åˆ°ä¸€ä¸ªæŠ¥é”™ï¼š
    raise JSONDecodeError(&quot;Expecting value&quot;, s, err.value) from None
json.decoder.JSONDecodeError: Expecting value: line 2 column 3 (char 3)

çœ‹ç€å¥½åƒæ˜¯ json.loadsè§£æå¤±è´¥äº†ã€‚
è¿›ä¸€æ­¥çœ‹æŠ¥é”™æ ˆï¼Œæ˜¯æŠ¥ 400 çš„çŠ¶æ€ç ã€‚

äºæ˜¯æˆ‘å°è¯•å°†get_dataæ–¹æ³•æ‰€è¯·æ±‚çš„urlæ‰“å°å‡ºæ¥äº†ä¸€ä¸‹ã€‚

```
# æ ¹æ®UIDæ„å»ºURLçˆ¬å–ä¿¡æ¯
def get_data(id):
    url = &quot;https:&#47;&#47;weibo.com&#47;ajax&#47;profile&#47;detail?uid={}&quot;.format(id)
    print(&quot;url-&gt;&quot;,url)
    html = scrape_weibo(url)
    print(html)
    response = json.loads(html)

    return response
```

ç»“æœå¦‚ä¸‹ï¼š

&gt; Finished chain.
è¿™ä½é²œèŠ±å¤§Vçš„å¾®åšIDæ˜¯ 100808
url-&gt; https:&#47;&#47;weibo.com&#47;ajax&#47;profile&#47;detail?uid=100808
&lt;h2&gt;400 Bad Request&lt;&#47;h2&gt;
Traceback (most recent call last):
  File &quot;&#47;Users&#47;bawenmao&#47;PycharmProjects&#47;socializer_v0&#47;findbigV.py&quot;, line 23, in &lt;module&gt;
    person_info = get_data(UID)
                  ^^^^^^^^^^^^^
  File &quot;&#47;Users&#47;bawenmao&#47;PycharmProjects&#47;socializer_v0&#47;tools&#47;scraping_tool.py&quot;, line 26, in get_data
    response = json.loads(html)
               ^^^^^^^^^^^^^^^^
  File &quot;&#47;Library&#47;Frameworks&#47;Python.framework&#47;Versions&#47;3.11&#47;lib&#47;python3.11&#47;json&#47;__init__.py&quot;, line 346, in loads
    return _default_decoder.decode(s)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;&#47;Library&#47;Frameworks&#47;Python.framework&#47;Versions&#47;3.11&#47;lib&#47;python3.11&#47;json&#47;decoder.py&quot;, line 337, in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;&#47;Library&#47;Frameworks&#47;Python.framework&#47;Versions&#47;3.11&#47;lib&#47;python3.11&#47;json&#47;decoder.py&quot;, line 355, in raw_decode
    raise JSONDecodeError(&quot;Expecting value&quot;, s, err.value) from None
json.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)



æ˜¯ä¸æ˜¯æ‰€è¯·æ±‚çš„é‚£ä¸ªurl æœ¬èº«ä¸å¯¹ï¼›
è¯·æ•™ä¸‹è€å¸ˆï¼Œè¿™æ˜¯å“ªé‡Œçš„é—®é¢˜ï¼›</div>2024-02-21</li><br/>
</ul>