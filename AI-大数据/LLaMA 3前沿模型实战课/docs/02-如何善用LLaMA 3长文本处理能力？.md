ä½ å¥½ï¼Œæˆ‘æ˜¯Tylerã€‚

åœ¨ä¹‹å‰çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ·±å…¥æ¢è®¨äº†å¦‚ä½•åˆ©ç”¨ LLaMA æ¨¡å‹è¿›è¡Œå¯¹è¯ï¼Œå¹¶æ˜ç¡®äº†LLaMA åœ¨å¤šè½®å¯¹è¯ä¸­çš„æ ¸å¿ƒæœºåˆ¶ã€‚è¿™ä¸€æœºåˆ¶é€šè¿‡å­˜å‚¨å†å²å¯¹è¯å†…å®¹ï¼Œå°†æ— çŠ¶æ€çš„å¤§æ¨¡å‹æ¨ç†æœåŠ¡è½¬å˜ä¸ºæœ‰çŠ¶æ€çš„å¤šè½®å¯¹è¯æœåŠ¡ã€‚

è¿™ä¸€æœºåˆ¶æ˜¾è‘—æå‡äº†å¯¹è¯ç³»ç»Ÿåœ¨å¤„ç†å¤æ‚å¯¹è¯æƒ…å¢ƒæ—¶çš„èƒ½åŠ›ï¼Œä½†ä¹Ÿå¸¦æ¥äº†æ–°çš„æŒ‘æˆ˜ï¼šéšç€å†å²å¯¹è¯è½®æ¬¡çš„å¢åŠ ï¼Œæ¨¡å‹çš„è¾“å…¥é•¿åº¦ä¹Ÿéšä¹‹å¢é•¿ã€‚ä¸ºåº”å¯¹è¿™ä¸€æŒ‘æˆ˜ï¼Œå¤§æ¨¡å‹å¿…é¡»å…·å¤‡å¤„ç†é•¿æ–‡æœ¬è¾“å…¥çš„èƒ½åŠ›ï¼Œè¿™ä¸ä»…æ˜¯å¯¹ç°æœ‰æŠ€æœ¯çš„æ‰©å±•ï¼Œä¹Ÿæ˜¯é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›å‘å±•çš„å…³é”®é©±åŠ¨åŠ›ã€‚

æœ¬èŠ‚è¯¾æˆ‘ä»¬å°†æ·±å…¥æ¢è®¨å¤„ç†é•¿æ–‡æœ¬è¾“å…¥æ—¶çš„å…³é”®æŠ€æœ¯å·¥ä½œï¼ŒåŒ…æ‹¬å½“å‰çš„è§£å†³æ–¹æ¡ˆã€ä¼˜åŠ¿åŠå…¶å±€é™æ€§ã€‚æˆ‘ä»¬å°†ç³»ç»Ÿæ€§åœ°åˆ†æå¦‚ä½•ä¼˜åŒ–é•¿æ–‡æœ¬è¾“å…¥çš„å¤„ç†ï¼Œä»¥æ»¡è¶³å¤§è§„æ¨¡å¯¹è¯ç³»ç»Ÿå¯¹é•¿æ–‡æœ¬çš„éœ€æ±‚ï¼Œå¹¶è¯„ä¼°è¿™äº›æŠ€æœ¯æ–¹æ¡ˆåœ¨å®é™…åº”ç”¨ä¸­çš„è¡¨ç°å’Œæ½œåœ¨æ”¹è¿›æ–¹å‘ã€‚

## é•¿æ–‡æœ¬å¤„ç†çš„å‘å±•ä¸ç°çŠ¶

LLaMA æ¨¡å‹çš„é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›æœ‰äº†æ˜¾è‘—æå‡ã€‚ä» LLaMA 2 çš„ 2048 ä¸ª token æ‰©å±•åˆ° 4096 ä¸ª tokenï¼Œå†åˆ° LLaMA 3 æ”¯æŒçš„ 8000 ä¸ª tokenï¼Œç”šè‡³é€šè¿‡è¿›ä¸€æ­¥å¾®è°ƒå¯ä»¥å¤„ç†æ›´é•¿çš„æ–‡æœ¬ã€‚è¿™æ„å‘³ç€è¿™äº›æ¨¡å‹ç°åœ¨å¯ä»¥å¤„ç†æ›´é•¿çš„æ–‡æœ¬ï¼Œç†è§£èƒ½åŠ›ä¹Ÿå¾—åˆ°äº†å¢å¼ºï¼Œç”Ÿæˆçš„å›åº”æ›´åŠ è¿è´¯ï¼Œç›¸å…³æ€§ä¹Ÿæ›´å¼ºã€‚å›¾è¡¨å±•ç¤ºäº†ä¸åŒæ¨¡å‹åœ¨é•¿æ–‡æœ¬å¤„ç†æ–¹é¢çš„è¿›å±•ã€‚
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ6ï¼‰</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/2b/63/57/b8eef585.jpg" width="30px"><span>å°è™å­11ğŸ¯</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>è¯¾ç¨‹ä»£ç åœ°å€ï¼šhttps:&#47;&#47;github.com&#47;tylerelyt&#47;LLaMa-in-Action</div>2024-11-25</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/iaK3hr7TO6WRFgmFkia0Q75ThkpyIOQtnXSttpI1ib8ianXxbb6LlPgPLZNOj5niaZnBt6Htps2Jia11v9l2VeL7EPibw/132" width="30px"><span>åˆå¤œä¿®é“ƒ</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>Windowsæœ¬åœ°æ¨¡å‹ï¼Œä½¿ç”¨ollamaæ—¶å¦‚ä½•è°ƒç”¨æœ¬åœ°æ˜¾å¡ï¼Ÿ</div>2024-12-17</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/iaK3hr7TO6WRFgmFkia0Q75ThkpyIOQtnXSttpI1ib8ianXxbb6LlPgPLZNOj5niaZnBt6Htps2Jia11v9l2VeL7EPibw/132" width="30px"><span>åˆå¤œä¿®é“ƒ</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>ç”Ÿæˆçš„ç»“æœï¼š æ ¹æ®ç»™å‡ºçš„æ•°æ®ï¼ŒåˆåŒä¸­çš„ä¸»è¦ä¹‰åŠ¡åŒ…æ‹¬ï¼š

1. ä»˜æ¬¾ä¹‰åŠ¡
2. å•†å“äº¤ä»˜ä¹‰åŠ¡
3. ç›¸å…³æœåŠ¡çš„æä¾›
Exception ignored in: &lt;function AbsEmbedder.__del__ at 0x00000174DDF64540&gt;
Traceback (most recent call last):
  File &quot;C:\Users\xxx\miniconda3\Lib\site-packages\FlagEmbedding\abc\inference\AbsEmbedder.py&quot;, line 270, in __del__
  File &quot;C:\Users\xxx\miniconda3\Lib\site-packages\FlagEmbedding\abc\inference\AbsEmbedder.py&quot;, line 89, in stop_self_pool
TypeError: &#39;NoneType&#39; object is not callable

è¿™é‡ŒæŠ¥é”™äº†ã€‚
flagembedding             1.3.3                   </div>2024-12-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/61/e0/c20f2457.jpg" width="30px"><span>æ±Ÿæ…§æ˜</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>å…·å¤‡é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›ï¼Œä¹Ÿæ„å‘³ç€éœ€è¦æ›´å¤šèµ„æºï¼Œæ˜¾å­˜èµ„æºï¼ŒCPUèµ„æºï¼Œä¹Ÿæ„å‘³ç€å›ç­”ç”¨æˆ·é—®é¢˜éœ€è¦æ›´é•¿æ—¶é—´ï¼Œæ‰€ä»¥å…·å¤‡é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›æ¨¡å‹ï¼Œåœ¨å…·ä½“å®è·µä¸­ä¹Ÿä¸èƒ½æ¯«æ— èŠ‚åˆ¶ä½¿ç”¨ï¼Œè€Œæ˜¯å……åˆ†æœ‰ç†ç”±ä½¿ç”¨ï¼Œä¸ºå–å¾—é€Ÿåº¦ã€èµ„æºã€ä¸Šä¸‹æ–‡çš„å¹³è¡¡ï¼Œæˆ‘ä»¬éœ€è¦å……åˆ†è®¾è®¡ï¼Œåˆ©ç”¨langchainå·¥å…·ï¼Œå¯ä»¥æŠŠé—®é¢˜æ‹†åˆ†å¤šä¸ªèšç„¦ç‚¹ï¼Œç„¶åç”¨LLMå¿«é€Ÿè·å¾—ç­”æ¡ˆï¼Œç„¶åå†è®²é—®é¢˜ç»„åˆ</div>2024-11-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/c1/65/2fb5c4ce.jpg" width="30px"><span>æ—…æ¢¦å¼€å‘å›¢</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>åœ¨åˆåŒRAGçš„æ¡ˆä¾‹ä¸­ æˆ‘å®‰è£…FlagEmbeddingæŠ¥é”™äº†ï¼Œå¯èƒ½æ˜¯pythonç‰ˆæœ¬çš„é—®é¢˜ã€‚ æˆ‘ä½¿ç”¨nomic-embed-text:latest åµŒå…¥æ¨¡å‹ä»£æ›¿ï¼Œ å¤§å®¶ä¹Ÿå¯ä»¥è¯•è¯•ã€‚ æˆ‘çš„å®Œæ•´ä»£ç å¦‚ä¸‹
```python
# å‘é‡æ•°æ®åº“
import chromadb
# Settings é…ç½®
from chromadb.config import Settings
# ç”Ÿæˆå™¨åµŒå…¥ å›¾åƒå¤„ è‡ªç„¶è¯­è¨€å¤„ç†
# from FlagEmbedding import BGEM3FlagModel
import ollama

chroma_client = chromadb.PersistentClient(path=&quot;.&#47;chromadb&quot;)
# document, metadata embedding
documents = [
...
]

documentation_collection = chroma_client.get_or_create_collection(name=&quot;legal_docs&quot;)

for doc in documents:
  embedding = ollama.embeddings(model=&#39;nomic-embed-text:latest&#39;,prompt=doc[&#39;page_content&#39;])
  # print(embedding.get(&#39;embedding&#39;))
  # id, embedding, åŸå†…å®¹
  documentation_collection.add(
    ids=[doc[&#39;metadata&#39;][&#39;id&#39;]],
    embeddings=embedding.get(&#39;embeddings&#39;),
    documents=[doc[&#39;page_content&#39;]]
  )

query = &quot;åˆåŒæ˜¯ä»€ä¹ˆï¼Ÿ&quot;
query_embedding = ollama.embeddings(model=&#39;nomic-embed-text:latest&#39;, prompt=query)
query_embedding = query_embedding.get(&#39;embedding&#39;)[:384] 
# print(query_embedding.get())
# # # æ ¹æ®embedding æŸ¥è¯¢
results = documentation_collection.query(
  query_embeddings = query_embedding,
  n_results=1
)
# # # # å–å‡ºåŸå†…å®¹
data = results[&#39;documents&#39;][0]
document_content = data

prompt = f&quot;æ ¹æ®ä¸€ä¸‹ä¿¡æ¯ï¼Œ è¯·å›ç­”ï¼š{query}&quot;

output = ollama.chat(model=&#39;qwen2.5:latest&#39;, messages=[
  {
    &#39;role&#39;: &#39;user&#39;,
    &#39;content&#39;: f&quot;ä½¿ç”¨ä¸€ä¸‹æ•°æ®ï¼š{document_content},å“åº”è¿™ä¸ªæç¤ºï¼š{prompt}&quot;
  }
])

print(&quot;ç”Ÿæˆçš„ç»“æœï¼š&quot;, output[&#39;message&#39;][&#39;content&#39;])
```</div>2024-10-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/83/7f/7b1f3f68.jpg" width="30px"><span>willmyc</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>è¶…é•¿æ–‡æœ¬æ˜¯å¦åº”è¯¥è€ƒè™‘è·Ÿllama3å¤šè½®å¯¹è¯çš„æƒ…å†µï¼Œllama3å¦‚ä½•å¤„ç†ï¼Œå¯å¦ä»‹ç»ä¸€ä¸‹ï¼Œè°¢è°¢ï¼</div>2024-10-22</li><br/>
</ul>