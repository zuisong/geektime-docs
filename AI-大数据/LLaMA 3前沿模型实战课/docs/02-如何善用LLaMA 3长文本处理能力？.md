ä½ å¥½ï¼Œæˆ‘æ˜¯Tylerã€‚

åœ¨ä¹‹å‰çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ·±å…¥æ¢è®¨äº†å¦‚ä½•åˆ©ç”¨ LLaMA æ¨¡å‹è¿›è¡Œå¯¹è¯ï¼Œå¹¶æ˜ç¡®äº†LLaMA åœ¨å¤šè½®å¯¹è¯ä¸­çš„æ ¸å¿ƒæœºåˆ¶ã€‚è¿™ä¸€æœºåˆ¶é€šè¿‡å­˜å‚¨å†å²å¯¹è¯å†…å®¹ï¼Œå°†æ— çŠ¶æ€çš„å¤§æ¨¡å‹æ¨ç†æœåŠ¡è½¬å˜ä¸ºæœ‰çŠ¶æ€çš„å¤šè½®å¯¹è¯æœåŠ¡ã€‚

è¿™ä¸€æœºåˆ¶æ˜¾è‘—æå‡äº†å¯¹è¯ç³»ç»Ÿåœ¨å¤„ç†å¤æ‚å¯¹è¯æƒ…å¢ƒæ—¶çš„èƒ½åŠ›ï¼Œä½†ä¹Ÿå¸¦æ¥äº†æ–°çš„æŒ‘æˆ˜ï¼šéšç€å†å²å¯¹è¯è½®æ¬¡çš„å¢åŠ ï¼Œæ¨¡å‹çš„è¾“å…¥é•¿åº¦ä¹Ÿéšä¹‹å¢é•¿ã€‚ä¸ºåº”å¯¹è¿™ä¸€æŒ‘æˆ˜ï¼Œå¤§æ¨¡å‹å¿…é¡»å…·å¤‡å¤„ç†é•¿æ–‡æœ¬è¾“å…¥çš„èƒ½åŠ›ï¼Œè¿™ä¸ä»…æ˜¯å¯¹ç°æœ‰æŠ€æœ¯çš„æ‰©å±•ï¼Œä¹Ÿæ˜¯é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›å‘å±•çš„å…³é”®é©±åŠ¨åŠ›ã€‚

æœ¬èŠ‚è¯¾æˆ‘ä»¬å°†æ·±å…¥æ¢è®¨å¤„ç†é•¿æ–‡æœ¬è¾“å…¥æ—¶çš„å…³é”®æŠ€æœ¯å·¥ä½œï¼ŒåŒ…æ‹¬å½“å‰çš„è§£å†³æ–¹æ¡ˆã€ä¼˜åŠ¿åŠå…¶å±€é™æ€§ã€‚æˆ‘ä»¬å°†ç³»ç»Ÿæ€§åœ°åˆ†æå¦‚ä½•ä¼˜åŒ–é•¿æ–‡æœ¬è¾“å…¥çš„å¤„ç†ï¼Œä»¥æ»¡è¶³å¤§è§„æ¨¡å¯¹è¯ç³»ç»Ÿå¯¹é•¿æ–‡æœ¬çš„éœ€æ±‚ï¼Œå¹¶è¯„ä¼°è¿™äº›æŠ€æœ¯æ–¹æ¡ˆåœ¨å®é™…åº”ç”¨ä¸­çš„è¡¨ç°å’Œæ½œåœ¨æ”¹è¿›æ–¹å‘ã€‚

## é•¿æ–‡æœ¬å¤„ç†çš„å‘å±•ä¸ç°çŠ¶

LLaMA æ¨¡å‹çš„é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›æœ‰äº†æ˜¾è‘—æå‡ã€‚ä» LLaMA 2 çš„ 2048 ä¸ª token æ‰©å±•åˆ° 4096 ä¸ª tokenï¼Œå†åˆ° LLaMA 3 æ”¯æŒçš„ 8000 ä¸ª tokenï¼Œç”šè‡³é€šè¿‡è¿›ä¸€æ­¥å¾®è°ƒå¯ä»¥å¤„ç†æ›´é•¿çš„æ–‡æœ¬ã€‚è¿™æ„å‘³ç€è¿™äº›æ¨¡å‹ç°åœ¨å¯ä»¥å¤„ç†æ›´é•¿çš„æ–‡æœ¬ï¼Œç†è§£èƒ½åŠ›ä¹Ÿå¾—åˆ°äº†å¢å¼ºï¼Œç”Ÿæˆçš„å›åº”æ›´åŠ è¿è´¯ï¼Œç›¸å…³æ€§ä¹Ÿæ›´å¼ºã€‚å›¾è¡¨å±•ç¤ºäº†ä¸åŒæ¨¡å‹åœ¨é•¿æ–‡æœ¬å¤„ç†æ–¹é¢çš„è¿›å±•ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/b5/b5/b558303bce1d3801c0fc0bd42575d5b5.png?wh=400x591)

é•¿æ–‡æœ¬å¤„ç†çš„å‘å±•ä¸ä»…æ˜¯æŠ€æœ¯çš„è¿›æ­¥ï¼Œä¹Ÿæ˜¯å¯¹å®é™…åº”ç”¨éœ€æ±‚çš„å“åº”ã€‚é•¿æ–‡æœ¬å¤„ç†çš„èƒ½åŠ›ç›´æ¥å½±å“åˆ°å¤§è§„æ¨¡å¯¹è¯ç³»ç»Ÿåœ¨å¤æ‚åœºæ™¯ä¸‹çš„è¡¨ç°ã€‚

## LLM é•¿æ–‡æœ¬çš„å¿…è¦æ€§

åœ¨å¼€ç¯‡çš„æ—¶å€™ï¼Œæˆ‘ä»¬æåˆ°äº†é•¿æ–‡æœ¬å¯¹å¤šè½®å¯¹è¯çš„é‡è¦æ€§ï¼ŒåŒ…æ‹¬æ™ºèƒ½ä½“è‡ªæˆ‘æˆ–å½¼æ­¤ä¹‹é—´çš„å¤æ‚æç¤ºè¯åº”ç”¨åœºæ™¯ã€‚é•¿æ–‡æœ¬æ”¯æŒçš„å¤šè½®å¯¹è¯åœºæ™¯ä¸­ï¼Œæç¤ºè¯çš„é•¿åº¦é™åˆ¶ä¼šå½±å“æ™ºèƒ½ä½“çš„æ€è€ƒæ·±åº¦ã€‚

ä¸‹å›¾å±•ç¤ºäº†åŸºäº ReAct æç¤ºè¯çš„æ™ºèƒ½ä½“å¤šè½®æ€è€ƒèƒ½åŠ›ã€‚å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œæ™ºèƒ½ä½“åœ¨æ¯ä¸€æ­¥æ ¹æ®æœ€æ–°çš„å¤–éƒ¨æ•°æ®åˆ¤æ–­æ˜¯å¦èƒ½å¤Ÿå®Œæˆä»»åŠ¡ã€‚æç¤ºè¯çš„é•¿åº¦åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™åˆ¶äº†æ™ºèƒ½ä½“æ€è€ƒçš„æ·±åº¦ã€‚

![å›¾ç‰‡](https://static001.geekbang.org/resource/image/e9/ce/e940161046168f3f8f0f4a9608831dce.png?wh=818x699)

ä»¥ä¸‹æ˜¯ä¸€ä¸ªä»£ç ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ LLaMA è¿›è¡Œå¯¹è¯ä»»åŠ¡ï¼š

```python
from langchain_ollama.llms import OllamaLLM
from langchain.agents import load_tools, initialize_agent
from langchain.tools import Tool
import numexpr as ne

# å®šä¹‰æ•°å­¦è®¡ç®—å·¥å…·
def calculate_expression(expression):
Â  Â  return ne.evaluate(expression).item()Â  # ä½¿ç”¨ numexpr è®¡ç®—è¡¨è¾¾å¼å¹¶è¿”å›ç»“æœ

math_tools = [
Â  Â  Tool(
Â  Â  Â  Â  name="Numexpr Math",
Â  Â  Â  Â  func=calculate_expression,
Â  Â  Â  Â  description="ä¸€ä¸ªèƒ½å¤Ÿè¿›è¡Œé«˜æ•ˆæ•°å­¦è®¡ç®—çš„å·¥å…·ï¼Œå‚æ•°æ˜¯è¾“å…¥çš„æ•°å­¦è¡¨è¾¾å¼"
Â  Â  )
]

# åˆå§‹åŒ– LLM
llm = OllamaLLM(model="llama3")

# å®šä¹‰ agent
agent = initialize_agent(
Â  Â  tools=math_tools,Â  # ä½¿ç”¨è‡ªå®šä¹‰çš„æ•°å­¦è®¡ç®—å·¥å…·
Â  Â  llm=llm,Â 
Â  Â  agent_type="zero-shot-react-description",Â 
Â  Â  verbose=True,
Â  Â  agent_kwargs={"handle_parsing_errors": True}Â  # å¤„ç†è§£æé”™è¯¯
)

# ç”¨æˆ·é—®é¢˜
user_question = "What is 37593 * 67?"
print(f"ç”¨æˆ·é—®é¢˜ï¼š{user_question}")

# æ‰§è¡Œå¹¶æ‰“å°ç»“æœ
response = agent.run(user_question)
print(response)

```

å‡è®¾ä¸Šè¿°ä»£ç å¤„ç†ä¸€ä¸ªå…³äºè®¡ç®—é—®é¢˜çš„åˆå§‹æç¤ºï¼Œå¹¶ç»è¿‡å¤šè½®å¯¹è¯ï¼Œå¯èƒ½çš„è¾“å‡ºå¦‚ä¸‹ï¼š

```plain
Question: What is 37593 * 67?
Thought: Let's get started!

Thought: I need to perform a mathematical operation using Numexpr Math.

Action: Numexpr Math

Action Input: 37593 * 67
Observation: 2518731
Thought:I'm excited to help! Here are the answers:

Final Answer: 2518731

> Finished chain.
```

ä½†æ˜¯è¿™éƒ½è°ˆä¸ä¸Šé•¿æ–‡æœ¬è¾“å…¥çš„åˆšéœ€ï¼Œå› ä¸ºå­˜åœ¨ä¸€äº›æç¤ºè¯å‹ç¼©çš„æ›¿ä»£æ–¹æ¡ˆã€‚çœŸæ­£é•¿æ–‡æœ¬çš„â€œåˆšéœ€â€åœºæ™¯ï¼Œæˆ‘ä»¬åªèƒ½æŠŠä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶æ”¾è¿›å»ï¼Œéœ€è¦é€šè¿‡ä¸Šä¸‹æ–‡å†…å®¹è”åˆåˆ†æï¼Œæ‰èƒ½ç”Ÿæˆå‡ºç›®æ ‡å†…å®¹çš„åœºæ™¯ã€‚

é•¿æ–‡æœ¬å¤„ç†çš„â€œåˆšéœ€â€åœºæ™¯åŒ…æ‹¬å¤„ç†å®Œæ•´çš„æ–‡æ¡£ï¼Œå¦‚æ–‡ç« ã€ä»£ç ã€è„šæœ¬ã€æŠ¥å‘Šç­‰ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå°† Python ä»£ç ç¿»è¯‘ä¸º JavaScript çš„ä¾‹å­ï¼Œå±•ç¤ºäº†å…¨æ–‡è¾“å…¥çš„å¿…è¦æ€§ï¼š

```python
import ollama

def translate_code_to_js(python_code):
Â  Â  # ä¼˜åŒ–ç¿»è¯‘æç¤º
Â  Â  prompt = f"""
You are a code translation assistant. Your task is to translate Python code into JavaScript while ensuring the following:

1. Maintain the original logic and functionality.
2. Adapt Python-specific constructs to their JavaScript equivalents.
3. Use clear and idiomatic JavaScript syntax.

Here is the Python code you need to translate:

Python Code:
{python_code}

Please provide the corresponding JavaScript code below:
JavaScript Code:
"""

Â  Â  # ä½¿ç”¨ Ollama æ¨¡å‹ 'llama3' è¿›è¡Œå¯¹è¯
Â  Â  response = ollama.chat(model='llama3', messages=[
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  'role': 'user',
Â  Â  Â  Â  Â  Â  'content': prompt,
Â  Â  Â  Â  },
Â  Â  ])

Â  Â  # è·å–ç”Ÿæˆçš„ JavaScript ä»£ç 
Â  Â  js_code = response['message']['content']
Â  Â  return js_code

# ç¤ºä¾‹ Python ä»£ç 
python_code = """
def fibonacci(n):
Â  Â  a, b = 0, 1
Â  Â  while n > 0:
Â  Â  Â  Â  yield a
Â  Â  Â  Â  a, b = b, a + b
Â  Â  Â  Â  n -= 1

for number in fibonacci(5):
Â  Â  print(number)
"""

# è°ƒç”¨å‡½æ•°å¹¶æ‰“å° JavaScript ä»£ç 
print(translate_code_to_js(python_code))

```

è¾“å‡ºçš„ä»£ç ï¼š

```javascript
function* fibonacci(n) {
Â  let a = 0, b = 1;
Â  for (let i = 0; i < n; i++) {
Â  Â  yield a;
Â  Â  [a, b] = [b, a + b];
Â  }
}

for (const number of fibonacci(5)) {
Â  console.log(number);
}
```

è¿™ä¸ªä¾‹å­è¡¨æ˜ï¼Œé€šè¿‡å¤šæ¬¡è¾“å…¥ä¸åŒçš„ä»£ç ç‰‡æ®µï¼Œå¾ˆéš¾è®©æ¨¡å‹ç”Ÿæˆå…¨å±€ä¸€è‡´çš„å˜é‡å£°æ˜å’Œé€»è¾‘è¡¨è¾¾ã€‚å› æ­¤ï¼Œé•¿æ–‡æœ¬è¾“å…¥åœ¨ä¸€äº›åœºæ™¯ä¸‹æ˜¯ä¸å¯æˆ–ç¼ºçš„ã€‚

é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›çš„å¿«é€Ÿå‘å±•ï¼Œä¸ç”±è®©å¤§å®¶æå‡ºäº†ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼šæç¤ºè¯­å·¥ç¨‹æ–¹æ³•ï¼Œæ¯”å¦‚ RAG å’Œæ€ç»´é“¾ï¼ˆCoTï¼‰ï¼Œæ˜¯å¦ä»ç„¶å¿…è¦ï¼Ÿ

## é•¿æ–‡æœ¬å¤„ç†çš„å±€é™æ€§

### é•¿æ–‡æœ¬å¤„ç†æ€§èƒ½é—®é¢˜

ä¸ŠèŠ‚è¯¾æˆ‘ä»¬è®¨è®ºäº†LLaMAç”Ÿæˆå†…å®¹çš„æ–¹æ³•ã€‚æˆ‘ä»¬äº†è§£åˆ°ï¼ŒLLaMAåœ¨å¤„ç†é•¿æ–‡æœ¬æ—¶ï¼Œä¼šé¢ä¸´å¾ˆå¤§çš„ç®—åŠ›å¼€é”€ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ›´è¯¦ç»†åœ°äº†è§£LLaMAçš„å·¥ä½œåŸç†ï¼Œç‰¹åˆ«æ˜¯å®ƒçš„è‡ªå›å½’ç”Ÿæˆæœºåˆ¶å¦‚ä½•å½±å“æ¨ç†æ—¶çš„ç®—åŠ›éœ€æ±‚ï¼Œä»¥åŠä¸ºä»€ä¹ˆé•¿æ–‡æœ¬ä¼šæ¶ˆè€—æ›´å¤šèµ„æºã€‚

è¿™é‡Œå¿«é€Ÿå›é¡¾ä¸€ä¸‹ï¼ŒLLaMAæ¨¡å‹çš„æ–‡æœ¬ç”Ÿæˆä¾èµ–äºè‡ªå›å½’æ–¹æ³•ã€‚è‡ªå›å½’ç”Ÿæˆæ–¹æ³•é€æ­¥ç”Ÿæˆæ¯ä¸€ä¸ªè¯ï¼š

- åˆå§‹åŒ–ä¸Šä¸‹æ–‡ï¼šæ¨¡å‹ä»ä¸€ä¸ªèµ·å§‹æ–‡æœ¬æˆ–ç§å­ä¿¡æ¯å¼€å§‹ã€‚
- é¢„æµ‹ä¸‹ä¸€ä¸ªè¯ï¼šæ¯ç”Ÿæˆä¸€ä¸ªæ–°è¯ï¼Œæ¨¡å‹ä¼šæ ¹æ®å½“å‰ä¸Šä¸‹æ–‡ï¼ˆå·²ç»ç”Ÿæˆçš„è¯ï¼‰æ¥é¢„æµ‹ä¸‹ä¸€ä¸ªæœ€å¯èƒ½çš„è¯ã€‚å®ƒä¼šè®¡ç®—å½“å‰ä¸Šä¸‹æ–‡ä¸è¯æ±‡è¡¨ä¸­æ‰€æœ‰å¯èƒ½è¯æ±‡çš„ç›¸ä¼¼åº¦ï¼Œæ‰¾åˆ°æœ€åˆé€‚çš„ä¸‹ä¸€ä¸ªè¯ã€‚
- æ›´æ–°ä¸Šä¸‹æ–‡ï¼šç”Ÿæˆçš„æ–°è¯ä¼šè¢«æ·»åŠ åˆ°ä¸Šä¸‹æ–‡ä¸­ï¼Œæ¨¡å‹ä¼šæ›´æ–°çŠ¶æ€ï¼Œå‡†å¤‡ç”Ÿæˆä¸‹ä¸€ä¸ªè¯ã€‚è¿™ä¸€è¿‡ç¨‹ä¼šä¸€ç›´è¿›è¡Œï¼Œç›´åˆ°ç”Ÿæˆå®Œæ•´çš„æ–‡æœ¬ã€‚

è‡ªå›å½’æ–¹æ³•çš„æ¨ç†ç®—åŠ›å¼€é”€å’Œè¾“å…¥æ–‡æœ¬çš„é•¿åº¦æœ‰å¾ˆå¤§å…³ç³»ã€‚

1. è‡ªæ³¨æ„åŠ›æœºåˆ¶çš„è®¡ç®—å¤æ‚åº¦ï¼šç”±äºè‡ªæ³¨æ„åŠ›æœºåˆ¶çš„è®¡ç®—å¤æ‚åº¦ä¸ºO(n^2)ï¼Œå…¶ä¸­næ˜¯åºåˆ—é•¿åº¦ï¼Œå¤„ç†é•¿æ–‡æœ¬æ—¶è®¡ç®—å¤æ‚åº¦ä¼šæ˜¾è‘—å¢åŠ ã€‚æ¯æ–°å¢ä¸€ä¸ªä½ç½®ï¼Œæ¨¡å‹éœ€è¦å¤„ç†å’Œè®°å¿†æ•´ä¸ªä¸Šä¸‹æ–‡ï¼Œä»è€Œå¯¼è‡´è®¡ç®—æ—¶é—´å’Œèµ„æºéœ€æ±‚ä»¥å¹³æ–¹çº§å¢é•¿ã€‚
2. æ˜¾å­˜å ç”¨ï¼šå¤„ç†é•¿æ–‡æœ¬ä¸ä»…å¢åŠ äº†è®¡ç®—å¤æ‚åº¦ï¼Œè¿˜å¢åŠ äº†æ˜¾å­˜çš„éœ€æ±‚ã€‚ç”±äºæ¨¡å‹éœ€è¦åœ¨ç”Ÿæˆæ¯ä¸€ä¸ªè¯æ—¶ä¿ç•™å’Œè®¡ç®—ä¹‹å‰æ‰€æœ‰ä½ç½®çš„çŠ¶æ€ï¼Œæ˜¾å­˜å ç”¨ä¹Ÿéšåºåˆ—é•¿åº¦å¢åŠ è€Œå¢åŠ ã€‚

å› æ­¤ï¼Œå°½ç®¡LLaMAæ¨¡å‹åœ¨å¤„ç†æ–‡æœ¬ç”Ÿæˆæ—¶å±•ç°äº†å¼ºå¤§çš„èƒ½åŠ›ï¼Œä½†é•¿æ–‡æœ¬çš„è¾“å…¥ä»ç„¶ä¼šå¯¼è‡´æ˜¾è‘—çš„èµ„æºæ¶ˆè€—ã€‚è¿™åŒ…æ‹¬è®¡ç®—æ—¶é—´å’Œæ˜¾å­˜çš„éœ€æ±‚ã€‚å› æ­¤ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€è¦å¯¹é•¿æ–‡æœ¬è¿›è¡Œåˆç†çš„è£å‰ªå’Œé¢„å¤„ç†ï¼Œä»¥å¹³è¡¡èµ„æºçš„æ¶ˆè€—å¹¶ä¿æŒæ¨¡å‹çš„é«˜æ•ˆè¿è¡Œã€‚

ç”Ÿæˆé•¿æ–‡æœ¬é€šå¸¸éœ€è¦å¤§é‡çš„è®¡ç®—å’Œé€šä¿¡èµ„æºï¼Œå¹¶ä¸”è€—æ—¶è¾ƒé•¿ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒRAG çš„å…³é”®ä½œç”¨æ˜¯æå‡ç”Ÿæˆè´¨é‡çš„åŒæ—¶ä¿æŒæ•ˆç‡ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤„ç†é•¿æ–‡æ¡£æ—¶ï¼Œæˆ‘ä»¬å¾€å¾€åªéœ€è¦å…¶ä¸­çš„ä¸€ä¸ªå…³é”®ç‰‡æ®µæ¥å›ç­”é—®é¢˜ã€‚ä¸‹é¢åŸºäºå‘é‡æ•°æ®åº“å’Œ LLaMA 3 RAG çš„ä¾‹å­å¯ä»¥å¾ˆå¥½åœ°è¯´æ˜è¿™ä¸€ç‚¹ã€‚

```javascript
import chromadb
from chromadb.config import Settings
from FlagEmbedding import BGEM3FlagModel
import ollamaÂ  # å¯¼å…¥Ollamaåº“

# åˆå§‹åŒ–Chromaæ•°æ®åº“
chroma_client = chromadb.PersistentClient(path="./chromadb")

# åˆ›å»ºä¸€äº›æµ‹è¯•æ–‡æ¡£
documents = [
Â  Â  {
Â  Â  Â  Â  "page_content": "åˆåŒæ˜¯ä¸¤æ–¹æˆ–å¤šæ–¹ä¹‹é—´çš„æ³•å¾‹åè®®ï¼Œé€šå¸¸åŒ…æ‹¬å„æ–¹çš„æƒåˆ©å’Œä¹‰åŠ¡ã€‚åˆåŒå¿…é¡»å…·å¤‡åˆæ³•æ€§å’Œå¯æ‰§è¡Œæ€§ã€‚",
Â  Â  Â  Â  "metadata": {"id": "doc1"}
Â  Â  },
Â  Â  {
Â  Â  Â  Â  "page_content": "åœ¨åˆåŒä¸­ï¼Œä¸»è¦ä¹‰åŠ¡åŒ…æ‹¬ï¼š1) ä»˜æ¬¾ä¹‰åŠ¡ï¼Œ2) å•†å“äº¤ä»˜ä¹‰åŠ¡ï¼Œ3) ç›¸å…³æœåŠ¡çš„æä¾›ã€‚åˆåŒä¸­çš„è¿™äº›ä¹‰åŠ¡å¿…é¡»åœ¨çº¦å®šçš„æ—¶é—´å†…å±¥è¡Œã€‚",
Â  Â  Â  Â  "metadata": {"id": "doc2"}
Â  Â  },
Â  Â  {
Â  Â  Â  Â  "page_content": "åˆåŒçš„è§£é™¤é€šå¸¸éœ€è¦åŒæ–¹çš„åŒæ„ï¼Œæˆ–è€…ç”±äºæ³•å¾‹è§„å®šçš„ç‰¹æ®Šæƒ…å†µï¼Œå¦‚è¿çº¦æˆ–ä¸å¯æŠ—åŠ›äº‹ä»¶ã€‚",
Â  Â  Â  Â  "metadata": {"id": "doc3"}
Â  Â  },
Â  Â  {
Â  Â  Â  Â  "page_content": "è¿çº¦è´£ä»»æ˜¯æŒ‡ä¸€æ–¹æœªèƒ½å±¥è¡ŒåˆåŒä¹‰åŠ¡æ—¶ï¼Œåº”æ‰¿æ‹…çš„æ³•å¾‹åæœï¼Œé€šå¸¸åŒ…æ‹¬èµ”å¿æŸå¤±å’Œç»§ç»­å±¥è¡ŒåˆåŒçš„è´£ä»»ã€‚",
Â  Â  Â  Â  "metadata": {"id": "doc4"}
Â  Â  },
Â  Â  {
Â  Â  Â  Â  "page_content": "åœ¨åˆåŒç”Ÿæ•ˆä¹‹å‰ï¼Œæ‰€æœ‰ç›¸å…³æ–¹å¿…é¡»ç†è§£åˆåŒæ¡æ¬¾ï¼Œå¹¶åŒæ„å…¶å†…å®¹ã€‚ç­¾å­—æ˜¯åˆåŒç”Ÿæ•ˆçš„é‡è¦æ ‡å¿—ã€‚",
Â  Â  Â  Â  "metadata": {"id": "doc5"}
Â  Â  },
Â  Â  {
Â  Â  Â  Â  "page_content": "åˆçº¦çš„å±¥è¡Œå¿…é¡»ç¬¦åˆè¯šä¿¡åŸåˆ™ï¼Œå³å„æ–¹åº”è¯šå®å®ˆä¿¡åœ°å±¥è¡Œè‡ªå·±çš„ä¹‰åŠ¡ï¼Œå¹¶å°Šé‡å¯¹æ–¹çš„åˆæ³•æƒç›Šã€‚",
Â  Â  Â  Â  "metadata": {"id": "doc6"}
Â  Â  },
Â  Â  {
Â  Â  Â  Â  "page_content": "åœ¨åˆåŒäº‰è®®ä¸­ï¼ŒåŒæ–¹å¯é€šè¿‡è°ƒè§£ã€ä»²è£æˆ–è¯‰è®¼çš„æ–¹å¼è§£å†³äº‰ç«¯ã€‚é€‰æ‹©åˆé€‚çš„æ–¹å¼å–å†³äºäº‰è®®çš„æ€§è´¨åŠé‡‘é¢ã€‚",
Â  Â  Â  Â  "metadata": {"id": "doc7"}
Â  Â  },
Â  Â  {
Â  Â  Â  Â  "page_content": "å…³äºåˆåŒçš„æ³•å¾‹æ³•è§„å„å›½æœ‰æ‰€ä¸åŒï¼Œäº†è§£é€‚ç”¨çš„æ³•å¾‹æ¡æ¬¾æ˜¯ç­¾è®¢åˆåŒå‰çš„é‡è¦æ­¥éª¤ã€‚",
Â  Â  Â  Â  "metadata": {"id": "doc8"}
Â  Â  }
]

# åˆå§‹åŒ–BGE M3æ¨¡å‹
model = BGEM3FlagModel('BAAI/bge-m3', use_fp16=True)

# å°†æ–‡æ¡£æ·»åŠ åˆ°å‘é‡å­˜å‚¨ä¸­
documentation_collection = chroma_client.get_or_create_collection(name="legal_docs")

# ç”Ÿæˆæ–‡æ¡£åµŒå…¥å¹¶æ·»åŠ åˆ°é›†åˆä¸­
for doc in documents:
Â  Â  embedding = model.encode([doc['page_content']], batch_size=1)['dense_vecs'][0]
Â  Â  documentation_collection.add(
Â  Â  Â  Â  ids=[doc['metadata']['id']],Â  # å‡è®¾æ–‡æ¡£æœ‰å”¯ä¸€çš„id
Â  Â  Â  Â  embeddings=[embedding],
Â  Â  Â  Â  documents=[doc['page_content']]
Â  Â  )

# æŸ¥è¯¢ç¤ºä¾‹
query = "åˆåŒä¸­çš„ä¸»è¦ä¹‰åŠ¡æ˜¯ä»€ä¹ˆï¼Ÿ"
query_embedding = model.encode([query], batch_size=1)['dense_vecs'][0]

# æ‰§è¡Œå‘é‡æŸ¥è¯¢
results = documentation_collection.query(
Â  Â  query_embeddings=[query_embedding],
Â  Â  n_results=1Â  # è·å–æœ€ç›¸ä¼¼çš„ä¸€ä¸ªç»“æœ
)

# æå–æ£€ç´¢åˆ°çš„æ–‡æ¡£å†…å®¹
data = results['documents'][0]Â  # å‡è®¾åªæ£€ç´¢åˆ°ä¸€ä¸ªç»“æœ
document_content = dataÂ  # è¿™é‡Œå–å‡ºæ–‡æ¡£å†…å®¹

# å°†ä¸Šä¸‹æ–‡ä¸æŸ¥è¯¢ä¸€èµ·ä¼ é€’ç»™ Ollama LLM
prompt = f"æ ¹æ®ä»¥ä¸‹ä¿¡æ¯ï¼Œè¯·å›ç­”ï¼š{query}"

# ä½¿ç”¨Ollamaç”Ÿæˆå“åº”
output = ollama.chat(model='llama3', messages=[
Â  Â  {
Â  Â  Â  Â  'role': 'user',
Â  Â  Â  Â  'content': f"ä½¿ç”¨ä»¥ä¸‹æ•°æ®ï¼š{document_content}. å“åº”è¿™ä¸ªæç¤ºï¼š{prompt}"
Â  Â  },
])

# è¾“å‡ºç”Ÿæˆçš„ç»“æœ
print("ç”Ÿæˆçš„ç»“æœï¼š", output['message']['content'])
```

åœ¨è¿™æ®µä»£ç ä¸­ï¼ŒRAG æ¨¡å‹é€šè¿‡æ£€ç´¢ä¸é—®é¢˜ç›¸å…³çš„æ–‡æœ¬ç‰‡æ®µæ¥ç”Ÿæˆå›åº”ã€‚è¿™ç§æ–¹æ³•å¯ä»¥å‡å°‘é•¿æ–‡æœ¬å¤„ç†çš„è®¡ç®—è´Ÿæ‹…ï¼Œæé«˜å“åº”é€Ÿåº¦ã€‚

å¦ä¸€æ–¹é¢ï¼Œæ€ç»´é“¾æ–¹æ³•å¯ä»¥æå‡ç”Ÿæˆå†…å®¹çš„è´¨é‡ï¼Œä½†é•¿æ–‡æœ¬çš„ä¿¡æ¯é‡è¿‡å¤§æ—¶ï¼ŒLLMï¼ˆå¤§è¯­è¨€æ¨¡å‹ï¼‰çš„æŒ‡ä»¤ç†è§£èƒ½åŠ›ä¼šæ˜¾è‘—ä¸‹é™ã€‚è¿™ä¸æ€ç»´é“¾çš„ç›®æ ‡ï¼Œå³é€šè¿‡åˆ†è§£å’Œèšç„¦æŒ‡ä»¤ï¼Œæ­£å¥½ç›¸åã€‚é€šè¿‡æ€ç»´é“¾å¤šæ­¥æ¨ç†çš„ Python ä¾‹å­ï¼Œå¯ä»¥æ›´æ¸…æ¥šåœ°çœ‹åˆ°è¿™ä¸€ç‚¹ã€‚

```javascript
from langchain.chains import LLMChain, SequentialChain
from langchain_ollama.llms import OllamaLLM
from langchain.prompts import PromptTemplate

# åˆ›å»º LLM å®ä¾‹
llm = OllamaLLM(model="llama3")Â  # ä½¿ç”¨ Ollama æ¨¡å‹

def create_chain(template: str, input_vars: list, output_key: str) -> LLMChain:
Â  Â  """åˆ›å»º LLMChain å®ä¾‹"""
Â  Â  prompt = PromptTemplate(
Â  Â  Â  Â  input_variables=input_vars,
Â  Â  Â  Â  template=template
Â  Â  )
Â  Â  return LLMChain(llm=llm, prompt=prompt, output_key=output_key)

# ç¬¬ä¸€æ­¥ï¼šå¤´è„‘é£æš´è§£å†³æ–¹æ¡ˆ
template_step1 = """
æ­¥éª¤ 1:
æˆ‘é¢ä¸´ä¸€ä¸ªå…³äº{input}çš„é—®é¢˜ã€‚è¯·æä¾›ä¸‰ä¸ªä¸åŒçš„è§£å†³æ–¹æ¡ˆï¼Œè€ƒè™‘åˆ°ä»¥ä¸‹å› ç´ ï¼š{perfect_factors}ã€‚
A:
"""
chain1 = create_chain(template_step1, ["input", "perfect_factors"], "solutions")

# ç¬¬äºŒæ­¥ï¼šè¯„ä¼°è§£å†³æ–¹æ¡ˆ
template_step2 = """
æ­¥éª¤ 2:
è¯·è¯„ä¼°ä»¥ä¸‹è§£å†³æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹ã€å®æ–½éš¾åº¦å’Œé¢„æœŸç»“æœï¼Œå¹¶ä¸ºæ¯ä¸ªæ–¹æ¡ˆåˆ†é…æˆåŠŸæ¦‚ç‡å’Œä¿¡å¿ƒæ°´å¹³ã€‚
{solutions}
A:
"""
chain2 = create_chain(template_step2, ["solutions"], "review")

# ç¬¬ä¸‰æ­¥ï¼šæ·±åŒ–æ€è€ƒè¿‡ç¨‹
template_step3 = """
æ­¥éª¤ 3:
è¯·æ·±å…¥åˆ†ææ¯ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæä¾›å®æ–½ç­–ç•¥ã€æ‰€éœ€èµ„æºå’Œæ½œåœ¨éšœç¢ï¼ŒåŒæ—¶è€ƒè™‘æ„å¤–ç»“æœåŠåº”å¯¹æªæ–½ã€‚
{review}
A:
"""
chain3 = create_chain(template_step3, ["review"], "deepen_thought_process")

# ç¬¬å››æ­¥ï¼šæ’åºè§£å†³æ–¹æ¡ˆ
template_step4 = """
æ­¥éª¤ 4:
æ ¹æ®è¯„ä¼°å’Œåˆ†æç»“æœï¼Œå¯¹è§£å†³æ–¹æ¡ˆè¿›è¡Œæ’åºï¼Œè¯´æ˜ç†ç”±ï¼Œå¹¶ç»™å‡ºæœ€ç»ˆè€ƒè™‘ã€‚
{deepen_thought_process}
A:
"""
chain4 = create_chain(template_step4, ["deepen_thought_process"], "ranked_solutions")

# å°†å„ä¸ªé“¾æ¡è¿æ¥èµ·æ¥
overall_chain = SequentialChain(
Â  Â  chains=[chain1, chain2, chain3, chain4],
Â  Â  input_variables=["input", "perfect_factors"],
Â  Â  output_variables=["ranked_solutions"],
Â  Â  verbose=True
)

# ç¤ºä¾‹è¾“å…¥
result = overall_chain({
Â  Â  "input": "äººç±»å¯¹ç«æ˜Ÿçš„æ®–æ°‘",
Â  Â  "perfect_factors": "åœ°çƒä¸ç«æ˜Ÿä¹‹é—´çš„è·ç¦»éå¸¸é¥è¿œï¼Œä½¿å¾—å®šæœŸè¡¥ç»™å˜å¾—å›°éš¾"
})

print(result)

```

**å› æ­¤ï¼ŒCoT å’Œ RAG ä¾ç„¶æ˜¯æå‡é•¿æ–‡æœ¬ç”Ÿæˆè´¨é‡çš„é‡è¦æ–¹æ³•ï¼Œä»ç„¶å…·æœ‰ä¸å¯æˆ–ç¼ºçš„ä»·å€¼**ã€‚

## é¢å‘è¶…é•¿æ–‡æœ¬çš„å®šåˆ¶ä¸ä¼˜åŒ–

éšç€å¤§æ¨¡å‹æŠ€æœ¯çš„å‘å±•ï¼Œå¤„ç†è¶…é•¿æ–‡æœ¬çš„èƒ½åŠ›ä¹Ÿåœ¨ä¸æ–­æå‡ï¼Œé™¤äº†æˆ‘ä»¬å‰é¢æåˆ°çš„æ ‡å‡†ç‰ˆæœ¬ LLaMAä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸“é—¨é’ˆå¯¹è¶…é•¿æ–‡æœ¬å¤„ç†çš„å®šåˆ¶ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œé’ˆå¯¹æ³•å¾‹æ–‡ä¹¦çš„å¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ 1Mï¼ˆç™¾ä¸‡çº§åˆ«ï¼‰ä¸Šä¸‹æ–‡é•¿åº¦çš„æ¨¡å‹æ¥å¤„ç†å¤æ‚çš„æ³•å¾‹æ–‡æœ¬ã€‚è¿™äº›è¶…é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›å¯ä»¥æœ‰æ•ˆåœ°è§£å†³å…¨å±€ç”¨è¯ä¸€è‡´æ€§é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›é¢å‘é•¿æ–‡æœ¬çš„ä¼˜åŒ–ç‰ˆæœ¬ï¼š

```javascript
import ollama


with open('data/legal_document.txt', 'r', encoding='utf-8') as f:
Â  Â  legal_text = f.read()

# ç³»ç»Ÿæç¤ºè¯ï¼ŒæŒ‡å®šæ¨¡å‹çš„èƒŒæ™¯ä¿¡æ¯å’Œå›ç­”é£æ ¼
SYSTEM_PROMPT = f'æ³•å¾‹æ–‡ä¹¦å†…å®¹: {legal_text}\n\n' + """
ä¸Šä¸‹æ–‡: ä½ æ˜¯ä¸€ä¸ªæ³•å¾‹åŠ©æ‰‹ï¼ŒåŸºäºæä¾›çš„æ³•å¾‹æ–‡ä¹¦å†…å®¹æä¾›ç­”æ¡ˆã€‚
ä½ åªèƒ½è®¨è®ºæ–‡ä¹¦ä¸­çš„å†…å®¹ã€‚ç”¨æˆ·å°†è¯¢é—®æœ‰å…³æ–‡ä¹¦çš„å…·ä½“é—®é¢˜ï¼Œä½ éœ€è¦åŸºäºæ–‡ä¹¦å†…å®¹æä¾›è¯¦ç»†çš„å›ç­”ã€‚
å¦‚æœä¿¡æ¯ä¸è¶³ä»¥å›ç­”é—®é¢˜ï¼Œè¯·è¦æ±‚ç”¨æˆ·æä¾›æ›´å…·ä½“çš„æ–‡ä¹¦éƒ¨åˆ†ã€‚
"""
QUESTION = 'æ–‡ä¸­å…³äºåˆåŒä¸­çš„ä¸»è¦ä¹‰åŠ¡çš„æè¿°æ˜¯å¦ä¸€è‡´ï¼Ÿ'

# æ„é€ èŠå¤©æ¶ˆæ¯
messages = [
Â  Â  {'role': 'system', 'content': SYSTEM_PROMPT},
Â  Â  {'role': 'user', 'content': QUESTION},
]

# è°ƒç”¨Ollamaçš„LLMç”Ÿæˆç»“æœ
response = ollama.chat(model='llama3-gradient', messages=messages)

# è¾“å‡ºç»“æœ
print('\n\n')
print(f'ç³»ç»Ÿæç¤º: ...{SYSTEM_PROMPT[-500:]}')Â  # æ‰“å°æœ€å500ä¸ªå­—ç¬¦çš„ç³»ç»Ÿæç¤º
print(f'ç”¨æˆ·æé—®:', QUESTION)
print('å›ç­”:')
print(response['message']['content'])Â  # è¾“å‡ºç”Ÿæˆçš„å›ç­”
```

## å°ç»“

å¥½çš„ï¼Œæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹è¿™èŠ‚è¯¾çš„å†…å®¹å§ã€‚è¿™èŠ‚è¯¾æˆ‘ä»¬è®¨è®ºäº†é•¿æ–‡æœ¬å¤„ç†çš„å‡ ä¸ªå…³é”®ç‚¹ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬èŠåˆ°äº†é•¿æ–‡æœ¬å¤„ç†çš„ç°çŠ¶ä»¥åŠå®ƒåœ¨å¤šè½®å¯¹è¯ã€æ™ºèƒ½ä½“å’Œä¸Šä¸‹æ–‡åˆ†æä¸­çš„é‡è¦æ€§ã€‚é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›ç°åœ¨æˆäº†å„å¤§å…¬å¸äº‰ç›¸æå‡çš„ç„¦ç‚¹ï¼Œå› ä¸ºå®ƒåœ¨å¤„ç†å¤æ‚ä¿¡æ¯æ—¶çš„ä»·å€¼éå¸¸å¤§ã€‚

ä½†è¦æ³¨æ„ï¼Œé•¿æ–‡æœ¬å¤„ç†å¹¶ä¸æ˜¯ä¸‡èƒ½çš„è§£å†³æ–¹æ¡ˆã€‚ç”±äºLLMçš„Next Token Predictionçš„ç‰¹æ€§ï¼Œå¤„ç†é•¿æ–‡æœ¬ä¼šæ¶ˆè€—å¾ˆå¤šç®—åŠ›ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—åœ¨å¿…è¦æ—¶æ‰ç”¨å®ƒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè™½ç„¶é•¿æ–‡æœ¬å¤„ç†å¾ˆé‡è¦ï¼Œä½†å®ƒçš„é«˜è®¡ç®—å¼€é”€æ„å‘³ç€æˆ‘ä»¬è¦è°¨æ…ä½¿ç”¨ã€‚

å¦å¤–ï¼Œè™½ç„¶åƒCoTè¿™æ ·çš„å¤šæ­¥æ¨ç†æŠ€æœ¯åœ¨ä¼˜åŒ–æ€§èƒ½æ–¹é¢è¡¨ç°ä¸é”™ï¼Œä½†å®ƒä»¬è¿˜ä¸èƒ½å®Œå…¨æ›¿ä»£é•¿æ–‡æœ¬å¤„ç†çš„èƒ½åŠ›ã€‚è¿™è¯´æ˜æˆ‘ä»¬éœ€è¦å­¦ä¼šåœ¨å®é™…åº”ç”¨ä¸­ï¼Œåˆ¤æ–­ä»€ä¹ˆæ—¶å€™è¯¥ç”¨é•¿æ–‡æœ¬å¤„ç†ï¼Œä»€ä¹ˆæ—¶å€™å¯ä»¥ç”¨å…¶ä»–ä¼˜åŒ–æ–¹æ³•ã€‚

æœ€åï¼Œæˆ‘ä»¬ä¸¾äº†ä¸€ä¸ªä¾‹å­ï¼Œå±•ç¤ºäº†é’ˆå¯¹é•¿æ–‡æœ¬ä¼˜åŒ–çš„LLaMA 3æ¨¡å‹ã€‚è¿™ä¸ªæ¨¡å‹èƒ½å¤„ç†ç™¾ä¸‡çº§åˆ«çš„æ•°æ®ï¼Œå¹¶åœ¨ä¸€äº›ç‰¹å®šåœºæ™¯ä¸­å±•ç°äº†å®ƒçš„ç‹¬ç‰¹ä»·å€¼ã€‚è¿™ä¸ªä¾‹å­è¯´æ˜äº†é•¿æ–‡æœ¬å¤„ç†åœ¨å®é™…åº”ç”¨ä¸­çš„æ½œåŠ›å’Œå¿…è¦æ€§ã€‚

## æ€è€ƒé¢˜

å…·å¤‡é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›åï¼Œæ˜¯å¦æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰å†…å®¹ä¸€å¹¶äº¤ç»™å¤§æ¨¡å‹å¤„ç†å‘¢ï¼Ÿæ¬¢è¿ä½ æŠŠæ€è€ƒåçš„ç»“æœåˆ†äº«åˆ°ç•™è¨€åŒºï¼Œå’Œæˆ‘ä¸€èµ·è®¨è®ºï¼Œå¦‚æœä½ è§‰å¾—è¿™èŠ‚è¯¾çš„å†…å®¹å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œæ¬¢è¿ä½ åˆ†äº«ç»™å…¶ä»–æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ6ï¼‰</strong></div><ul>
<li><span>å°è™å­11ğŸ¯</span> ğŸ‘ï¼ˆ1ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>è¯¾ç¨‹ä»£ç åœ°å€ï¼šhttps:&#47;&#47;github.com&#47;tylerelyt&#47;LLaMa-in-Action</p>2024-11-25</li><br/><li><span>åˆå¤œä¿®é“ƒ</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>Windowsæœ¬åœ°æ¨¡å‹ï¼Œä½¿ç”¨ollamaæ—¶å¦‚ä½•è°ƒç”¨æœ¬åœ°æ˜¾å¡ï¼Ÿ</p>2024-12-17</li><br/><li><span>åˆå¤œä¿®é“ƒ</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>ç”Ÿæˆçš„ç»“æœï¼š æ ¹æ®ç»™å‡ºçš„æ•°æ®ï¼ŒåˆåŒä¸­çš„ä¸»è¦ä¹‰åŠ¡åŒ…æ‹¬ï¼š

1. ä»˜æ¬¾ä¹‰åŠ¡
2. å•†å“äº¤ä»˜ä¹‰åŠ¡
3. ç›¸å…³æœåŠ¡çš„æä¾›
Exception ignored in: &lt;function AbsEmbedder.__del__ at 0x00000174DDF64540&gt;
Traceback (most recent call last):
  File &quot;C:\Users\xxx\miniconda3\Lib\site-packages\FlagEmbedding\abc\inference\AbsEmbedder.py&quot;, line 270, in __del__
  File &quot;C:\Users\xxx\miniconda3\Lib\site-packages\FlagEmbedding\abc\inference\AbsEmbedder.py&quot;, line 89, in stop_self_pool
TypeError: &#39;NoneType&#39; object is not callable

è¿™é‡ŒæŠ¥é”™äº†ã€‚
flagembedding             1.3.3                   </p>2024-12-17</li><br/><li><span>æ±Ÿæ…§æ˜</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>å…·å¤‡é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›ï¼Œä¹Ÿæ„å‘³ç€éœ€è¦æ›´å¤šèµ„æºï¼Œæ˜¾å­˜èµ„æºï¼ŒCPUèµ„æºï¼Œä¹Ÿæ„å‘³ç€å›ç­”ç”¨æˆ·é—®é¢˜éœ€è¦æ›´é•¿æ—¶é—´ï¼Œæ‰€ä»¥å…·å¤‡é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›æ¨¡å‹ï¼Œåœ¨å…·ä½“å®è·µä¸­ä¹Ÿä¸èƒ½æ¯«æ— èŠ‚åˆ¶ä½¿ç”¨ï¼Œè€Œæ˜¯å……åˆ†æœ‰ç†ç”±ä½¿ç”¨ï¼Œä¸ºå–å¾—é€Ÿåº¦ã€èµ„æºã€ä¸Šä¸‹æ–‡çš„å¹³è¡¡ï¼Œæˆ‘ä»¬éœ€è¦å……åˆ†è®¾è®¡ï¼Œåˆ©ç”¨langchainå·¥å…·ï¼Œå¯ä»¥æŠŠé—®é¢˜æ‹†åˆ†å¤šä¸ªèšç„¦ç‚¹ï¼Œç„¶åç”¨LLMå¿«é€Ÿè·å¾—ç­”æ¡ˆï¼Œç„¶åå†è®²é—®é¢˜ç»„åˆ</p>2024-11-30</li><br/><li><span>æ—…æ¢¦å¼€å‘å›¢</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>åœ¨åˆåŒRAGçš„æ¡ˆä¾‹ä¸­ æˆ‘å®‰è£…FlagEmbeddingæŠ¥é”™äº†ï¼Œå¯èƒ½æ˜¯pythonç‰ˆæœ¬çš„é—®é¢˜ã€‚ æˆ‘ä½¿ç”¨nomic-embed-text:latest åµŒå…¥æ¨¡å‹ä»£æ›¿ï¼Œ å¤§å®¶ä¹Ÿå¯ä»¥è¯•è¯•ã€‚ æˆ‘çš„å®Œæ•´ä»£ç å¦‚ä¸‹
```python
# å‘é‡æ•°æ®åº“
import chromadb
# Settings é…ç½®
from chromadb.config import Settings
# ç”Ÿæˆå™¨åµŒå…¥ å›¾åƒå¤„ è‡ªç„¶è¯­è¨€å¤„ç†
# from FlagEmbedding import BGEM3FlagModel
import ollama

chroma_client = chromadb.PersistentClient(path=&quot;.&#47;chromadb&quot;)
# document, metadata embedding
documents = [
...
]

documentation_collection = chroma_client.get_or_create_collection(name=&quot;legal_docs&quot;)

for doc in documents:
  embedding = ollama.embeddings(model=&#39;nomic-embed-text:latest&#39;,prompt=doc[&#39;page_content&#39;])
  # print(embedding.get(&#39;embedding&#39;))
  # id, embedding, åŸå†…å®¹
  documentation_collection.add(
    ids=[doc[&#39;metadata&#39;][&#39;id&#39;]],
    embeddings=embedding.get(&#39;embeddings&#39;),
    documents=[doc[&#39;page_content&#39;]]
  )

query = &quot;åˆåŒæ˜¯ä»€ä¹ˆï¼Ÿ&quot;
query_embedding = ollama.embeddings(model=&#39;nomic-embed-text:latest&#39;, prompt=query)
query_embedding = query_embedding.get(&#39;embedding&#39;)[:384] 
# print(query_embedding.get())
# # # æ ¹æ®embedding æŸ¥è¯¢
results = documentation_collection.query(
  query_embeddings = query_embedding,
  n_results=1
)
# # # # å–å‡ºåŸå†…å®¹
data = results[&#39;documents&#39;][0]
document_content = data

prompt = f&quot;æ ¹æ®ä¸€ä¸‹ä¿¡æ¯ï¼Œ è¯·å›ç­”ï¼š{query}&quot;

output = ollama.chat(model=&#39;qwen2.5:latest&#39;, messages=[
  {
    &#39;role&#39;: &#39;user&#39;,
    &#39;content&#39;: f&quot;ä½¿ç”¨ä¸€ä¸‹æ•°æ®ï¼š{document_content},å“åº”è¿™ä¸ªæç¤ºï¼š{prompt}&quot;
  }
])

print(&quot;ç”Ÿæˆçš„ç»“æœï¼š&quot;, output[&#39;message&#39;][&#39;content&#39;])
```</p>2024-10-29</li><br/><li><span>willmyc</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<p>è¶…é•¿æ–‡æœ¬æ˜¯å¦åº”è¯¥è€ƒè™‘è·Ÿllama3å¤šè½®å¯¹è¯çš„æƒ…å†µï¼Œllama3å¦‚ä½•å¤„ç†ï¼Œå¯å¦ä»‹ç»ä¸€ä¸‹ï¼Œè°¢è°¢ï¼</p>2024-10-22</li><br/>
</ul>