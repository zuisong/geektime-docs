ä½ å¥½ï¼Œæˆ‘æ˜¯é»„é¸¿æ³¢ã€‚

åœ¨å‰é¢çš„è¯¾ç¨‹ä¸­è®²äº†å¾ˆå¤šå¬å›ç®—æ³•ï¼Œä¹Ÿè®²äº†å…³äºFlaskå’Œç”¨æˆ·ç•Œé¢ç›¸å…³çš„å†…å®¹ï¼Œä»Šå¤©æˆ‘ä»¬æŠŠæ‰€æœ‰çš„ä¸œè¥¿åšä¸€ä¸ªæµç¨‹ä¸²è”ã€‚

ä»Šå¤©ä¸»è¦ä¼šåšä¸‹é¢äº”ä»¶äº‹ã€‚

1. å°†æ•°æ®é‡‡é›†åˆ°ååŒè¿‡æ»¤ç®—æ³•çš„å¬å›ä¸­è®­ç»ƒååŒè¿‡æ»¤ç®—æ³•ã€‚
2. ä½¿ç”¨ååŒè¿‡æ»¤ç®—æ³•è®­ç»ƒå‡ºåŸºäºItemçš„ååŒè¿‡æ»¤çŸ©é˜µã€‚
3. åˆ©ç”¨åè°ƒè¿‡æ»¤çŸ©é˜µï¼Œå°†ç”¨æˆ·IDä¼ å…¥è¿›å»é¢„æµ‹å‡ºæ¯ä¸€ä¸ªç”¨æˆ·çš„Item listã€‚
4. å°†é¢„æµ‹å‡ºæ¥çš„ç»“æœå­˜å…¥åˆ°Redisæ•°æ®åº“ã€‚
5. é€šè¿‡WebServiceåšæˆæ¥å£ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é’ˆå¯¹ä¸Šé¢çš„å†…å®¹ï¼Œçœ‹çœ‹æ€ä¹ˆä¸€æ­¥æ­¥å®ç°ã€‚

## è®­ç»ƒååŒè¿‡æ»¤ç®—æ³•

è¦æƒ³æŠŠä¹‹å‰çš„é‚£ä¸€å¥—ååŒè¿‡æ»¤ç®—æ³•è·‘èµ·æ¥ï¼Œé¦–å…ˆè¦åšçš„å°±æ˜¯åšå¥½æ•°æ®ï¼Œå¹¶å–‚ç»™ååŒè¿‡æ»¤ç®—æ³•ã€‚

å…ˆæ¥å›é¡¾ä¸€ä¸‹åœ¨[ååŒè¿‡æ»¤](https://time.geekbang.org/column/article/662725)é‚£ä¸€èŠ‚å†™çš„è®­ç»ƒä»£ç ã€‚

```plain
def cf_Item_train(self):
	"""
Â 
	:return:ç›¸ä¼¼åº¦çŸ©é˜µï¼š{content_id:{content_id:score}}
	"""
	print("start train")
	self.Item_to_Item, self.Item_count = dict(), dict()
Â 
	for user, Items in self.train.Items():
		for i in Items.keys():
			self.Item_count.setdefault(i, 0)
			self.Item_count[i] += 1 Â # Item i å‡ºç°ä¸€æ¬¡å°±åŠ 1åˆ†
Â 
	for user, Items in self.train.Items():
		for i in Items.keys():
			self.Item_to_Item.setdefault(i, {})
			for j in Items.keys():
				if i == j:
					continue
				self.Item_to_Item[i].setdefault(j, 0)
				self.Item_to_Item[i][j] += 1 / (
					math.sqrt(self.Item_count[i] + self.Item_count[j])) # Item i å’Œ j å…±ç°ä¸€æ¬¡å°±åŠ 1
Â 
	# è®¡ç®—ç›¸ä¼¼åº¦çŸ©é˜µ
	for _Item in self.Item_to_Item:
		self.Item_to_Item[_Item] = dict(sorted(self.Item_to_Item[_Item].Items(),
											Â Â Â key=lambda x: x[1], reverse=True)[0:30])
```
<div><strong>ç²¾é€‰ç•™è¨€ï¼ˆ5ï¼‰</strong></div><ul>
<li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoG8icuhhcSLlEvJMDFnSQ3puSC2OIJdcew3bL997AJaXdkKXiaAJzaMylswgT4hI8xp8a60alJ2VqQ/132" width="30px"><span>panda_dou</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ2ï¼‰<div>è¯·é—®ä¸€ä¸‹ï¼Œæ–‡ç« ä¸­ä»£ç çš„GitHubçš„é“¾æ¥å¯ä»¥æä¾›ä¸€ä¸‹å—ï¼Ÿ</div>2023-08-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg" width="30px"><span>peter</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è¯·é—®ï¼šâ€œå…±ç°çŸ©é˜µâ€å°±æ˜¯â€œååŒè¿‡æ»¤çŸ©é˜µâ€å—ï¼Ÿ</div>2023-06-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/31/8a/be3b7ae6.jpg" width="30px"><span>å¶åœ£æ«</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>è¿™äº›è¡¨é‡Œçš„æ•°æ®ä»å“ªé‡Œæ¥ï¼Ÿ
self.mongo = MongoDB(db=&#39;recommendation&#39;)        
self.db_client = self.mongo.db_client        
self.read_collection = self.db_client[&#39;read&#39;]        
self.likes_collection = self.db_client[&#39;likes&#39;]        
self.collection = self.db_client[&#39;collection&#39;]        
self.content = self.db_client[&#39;content_labels&#39;]</div>2024-02-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/21/67/fe/5d17661a.jpg" width="30px"><span>æ‚Ÿå°˜</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ0ï¼‰<div>read_count = self.read_collection.find(query).count() æ‰§è¡ŒæŠ¥é”™ AttributeError: &#39;Cursor&#39; object has no attribute &#39;count&#39;:
è¿™ä¸ªé”™è¯¯æ˜¯å› ä¸ºåœ¨ MongoDB 3.6 åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œ`Cursor` å¯¹è±¡ä¸å†å…·æœ‰ `count()` æ–¹æ³•ã€‚ä½ éœ€è¦ä½¿ç”¨å…¶ä»–æ–¹æ³•æ¥è·å–æŸ¥è¯¢ç»“æœçš„æ•°é‡ã€‚
ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ä¹‹ä¸€æ¥è®¡ç®—åŒ¹é…æŸ¥è¯¢çš„æ–‡æ¡£æ•°é‡ï¼š

1. **`count_documents()`**ï¼š
   - ä½¿ç”¨ `count_documents()` æ–¹æ³•ç›´æ¥åœ¨é›†åˆä¸Šè¿›è¡Œè®¡æ•°ã€‚
     ```python
     read_count = self.read_collection.count_documents(query)
     ```

2. **`estimated_document_count()`**ï¼š
   - å¦‚æœä½ ä¸éœ€è¦ç²¾ç¡®çš„è®¡æ•°ï¼Œå¯ä»¥ä½¿ç”¨ `estimated_document_count()` æ–¹æ³•ï¼Œå®ƒé€šå¸¸æ¯” `count_documents()` æ›´å¿«ã€‚
     ```python
     read_count = self.read_collection.estimated_document_count()
     ```

è¯·ç¡®ä¿ä½ çš„ MongoDB ç‰ˆæœ¬æ”¯æŒè¿™äº›æ–¹æ³•ã€‚å¦‚æœä½ æ­£åœ¨ä½¿ç”¨çš„ç‰ˆæœ¬ä½äº 3.6ï¼Œè¯·æ›´æ–°åˆ°è¾ƒæ–°çš„ç‰ˆæœ¬ä»¥é¿å…å‡ºç°è¿™ä¸ªé—®é¢˜ã€‚</div>2023-12-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/21/67/fe/5d17661a.jpg" width="30px"><span>æ‚Ÿå°˜</span> ğŸ‘ï¼ˆ0ï¼‰ ğŸ’¬ï¼ˆ1ï¼‰<div>..&#47;data&#47;news_score&#47;news_log.csvï¼Œè¿™ä¸ªæ–‡ä»¶åœ¨å“ªï¼Ÿ</div>2023-12-15</li><br/>
</ul>